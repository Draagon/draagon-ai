# draagon.yaml - Configuration for draagon-ai and extensions
#
# This file configures draagon-ai core services and extensions.
# Environment variables can be used with ${VAR} or $VAR syntax.
#
# Location: Place in project root or specify via --config flag
# Discovery: Searches current and parent directories for:
#   - draagon.yaml, draagon.yml, .draagon.yaml, .draagon.yml

# =============================================================================
# CORE SERVICES
# =============================================================================
core:
  # LLM Provider Configuration
  llm:
    # Primary provider for most operations
    primary:
      provider: groq
      model: llama-3.3-70b-versatile
      api_key: ${GROQ_API_KEY}
      temperature: 0.1
      max_tokens: 2000

    # Fast provider for quick classifications
    fast:
      provider: groq
      model: llama-3.1-8b-instant
      api_key: ${GROQ_API_KEY}
      temperature: 0.0
      max_tokens: 500

    # Fallback provider if primary fails
    fallback:
      provider: anthropic
      model: claude-sonnet-4-20250514
      api_key: ${ANTHROPIC_API_KEY}

  # Memory Configuration (Qdrant)
  memory:
    provider: qdrant
    url: ${QDRANT_URL:-http://localhost:6333}
    nodes_collection: draagon_memory_nodes
    edges_collection: draagon_memory_edges
    embedding_dimensions: 768

  # Embedding Provider
  embeddings:
    provider: ollama
    url: ${OLLAMA_URL:-http://localhost:11434}
    model: nomic-embed-text

  # Scheduling System
  scheduling:
    # Persistence backend for scheduled tasks
    persistence: qdrant  # or "memory" for testing
    collection: draagon_scheduled_tasks

    # Default settings for tasks
    defaults:
      max_retries: 3
      retry_backoff_base: 2.0
      retry_backoff_max: 300.0

  # Evolution / Self-Improvement
  evolution:
    enabled: true
    min_interactions: 50
    auto_apply: false
    shadow_test_ratio: 0.1

# =============================================================================
# EXTENSIONS
# =============================================================================
extensions:
  # -------------------------------------------------------------------------
  # Security Monitor Extension
  # -------------------------------------------------------------------------
  security-monitor:
    enabled: true
    config:
      # How often to check for new alerts (seconds)
      check_interval_seconds: 300

      # LLM for analysis (inherits from core.llm if not specified)
      llm:
        model: llama-3.3-70b-versatile
        temperature: 0.1

      # Network context for accurate threat analysis
      network:
        # Your home network CIDR
        home_net: "192.168.168.0/24"

        # Known services (helps reduce false positives)
        # Note: Additional services can be learned via voice commands
        known_services:
          - name: "Plex"
            ip: "192.168.168.204"
            ports: [32400]
            protocols: ["http"]

          - name: "Home Assistant"
            ip: "192.168.168.206"
            ports: [8123]
            protocols: ["http", "websocket"]

          - name: "Pi-hole"
            ip: "192.168.168.208"
            ports: [53, 80]
            protocols: ["dns", "http"]

          - name: "NAS"
            ip: "192.168.168.202"
            ports: [445, 139]
            protocols: ["smb"]

        # IPs that are always trusted
        trusted_ips:
          - "192.168.168.1"  # Router

        # External services (for context in logs)
        external_services:
          - "Cloudflare"
          - "Google"
          - "Microsoft"

      # Monitor configurations
      monitors:
        suricata:
          enabled: true
          eve_log: /var/log/suricata/eve.json
          min_severity: low

        syslog:
          enabled: true
          paths:
            - /var/log/auth.log
            - /var/log/syslog
          patterns:
            - "Failed password"
            - "authentication failure"
            - "CRITICAL"
            - "segfault"

        system_health:
          enabled: true
          checks:
            nvme_temp:
              enabled: true
              warning_celsius: 60
              critical_celsius: 70
            disk_usage:
              enabled: true
              warning_percent: 85
              critical_percent: 95
            memory:
              enabled: true
              warning_percent: 90
            services:
              enabled: true
              watch:
                - docker
                - nginx
                - postgresql

      # Notification settings
      notifications:
        voice:
          enabled: true
          entity_id: "assist_satellite.home_assistant_voice_master_bedroom"
          min_severity: high
          quiet_hours:
            enabled: true
            start: "22:00"
            end: "08:00"
            # During quiet hours, only critical alerts speak
            quiet_min_severity: critical

        # Daily summary
        summary:
          enabled: true
          schedule: "09:00"  # Cron time
          include_noise: false

      # Memory settings
      memory:
        collection: security_investigations
        learn_from_noise: true
        retention_days: 90

  # -------------------------------------------------------------------------
  # Storytelling Extension (example)
  # -------------------------------------------------------------------------
  storytelling:
    enabled: false
    config:
      drama_intensity: 0.7
      narrative_style: "conversational"

  # -------------------------------------------------------------------------
  # Architect Extension (example)
  # -------------------------------------------------------------------------
  architect:
    enabled: false
    config:
      default_language: python
      prefer_simple: true

# =============================================================================
# APPLICATION SETTINGS
# =============================================================================
app:
  # Application name (for logging, metrics)
  name: "my-draagon-app"

  # Default behaviors to activate
  behaviors:
    - helpful_assistant
    - security_analyst  # From security-monitor extension

  # Logging
  logging:
    level: INFO
    format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

  # API settings (if serving as API)
  api:
    host: "0.0.0.0"
    port: 8000
    cors_origins:
      - "http://localhost:3000"

# =============================================================================
# NOTES
# =============================================================================
# Configuration Priority (highest to lowest):
# 1. Memory (user preferences set via voice/API)
# 2. Environment variables
# 3. This YAML file
# 4. Code defaults
#
# Voice-Configurable Settings:
# The following can be set via voice commands and will be stored in memory:
# - network.known_services (add new devices)
# - notifications.voice.quiet_hours.*
# - notifications.voice.min_severity
# - check_interval_seconds
#
# Examples:
# - "Add my NAS to known devices at 192.168.168.202"
# - "Set quiet hours from 10pm to 7am"
# - "Only tell me about critical security alerts"
# - "Check for security issues every 10 minutes"
