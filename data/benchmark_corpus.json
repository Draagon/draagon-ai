{
  "version": "1.0.0",
  "description": "Benchmark corpus built on 2026-01-02T20:42:12.420621",
  "metadata": {
    "total_documents": 345,
    "source_distribution": {
      "local": 137,
      "online": 35,
      "synthetic": 173
    },
    "category_distribution": {
      "knowledge_base": 8,
      "technical": 52,
      "conversational": 5,
      "narrative": 85,
      "academic": 3,
      "legal": 28,
      "synthetic": 164
    },
    "domain_distribution": {
      "documentation": 2,
      "java_framework": 50,
      "game_fiction": 85,
      "python": 7,
      "python_web": 3,
      "typescript": 3,
      "arxiv_ai": 3,
      "legal_license": 12,
      "legal_tos": 10,
      "legal_privacy": 6,
      "synthetic_technical": 44,
      "synthetic_conversational": 44,
      "synthetic_legal": 29,
      "synthetic_knowledge_base": 47
    },
    "distractor_count": 164,
    "distractor_ratio": 0.4753623188405797,
    "size_stats": {
      "min": 697,
      "max": 80747,
      "mean": 7771.034782608695,
      "median": 2529
    },
    "created_at": "2026-01-02T20:42:23.779791"
  },
  "documents": [
    {
      "doc_id": "local_TRANSFER-INSTRUCTIONS",
      "source": "local",
      "category": "knowledge_base",
      "domain": "documentation",
      "file_path": "/home/doug/Development/TRANSFER-INSTRUCTIONS.md",
      "content": "# How to Transfer Spec Kit Setup to MacBook\n\n## Package Location\n\n**File**: `~/Development/spec-kit-setup.zip` (32KB)\n\n## Transfer Options\n\n### Option 1: SCP from MacBook (Requires SSH Setup)\n\n```bash\n# From your MacBook terminal:\nscp doug@[this-machine-ip]:~/Development/spec-kit-setup.zip ~/Downloads/\n\n# Then extract on MacBook:\ncd ~/path/to/work-project\nunzip ~/Downloads/spec-kit-setup.zip\n```\n\n### Option 2: Cloud Storage (Easiest)\n\n```bash\n# From this Linux machine:\n# Upload to Dropbox/Google Drive/OneDrive\n# Then download on MacBook to your work project directory\n```\n\n### Option 3: USB Drive\n\n```bash\n# Copy to USB on this machine:\ncp ~/Development/spec-kit-setup.zip /media/[usb-drive]/\n\n# Then copy from USB on MacBook to project directory\n```\n\n### Option 4: HTTP Server (Quick and Simple)\n\n```bash\n# On this Linux machine (in another terminal):\ncd ~/Development\npython3 -m http.server 8000\n\n# On MacBook, open browser:\n# http://[this-machine-ip]:8000/spec-kit-setup.zip\n# Or use curl:\ncurl -O http://[this-machine-ip]:8000/spec-kit-setup.zip\n```\n\n## What to Tell MacBook Claude\n\nOnce the zip is on your MacBook in the work project directory:\n\n```\nI've placed spec-kit-setup.zip in the project root. Please:\n\n1. Extract it: unzip spec-kit-setup.zip\n2. Read QUICK-START-FOR-CLAUDE.md - that's written specifically for you\n3. Follow the installation steps to merge Spec Kit commands with our existing .claude setup\n4. Make sure to read our CLAUDE.md first to understand project context\n5. Customize the commands to match our project (not Party Lore)\n6. Run /constitution to initialize the .specify/ directory\n7. Let me know when setup is complete\n\nThe key is to MERGE with our existing setup, not replace it.\n```\n\n## What's in the Package\n\n```\nspec-kit-setup/\n‚îú‚îÄ‚îÄ QUICK-START-FOR-CLAUDE.md    # Step-by-step guide for Claude\n‚îú‚îÄ‚îÄ SETUP-INSTRUCTIONS.md        # Detailed human-readable instructions\n‚îú‚îÄ‚îÄ commands/                    # Slash commands for .claude/commands/\n‚îÇ   ‚îú‚îÄ‚îÄ specify.md              # Feature specification generator\n‚îÇ   ‚îú‚îÄ‚îÄ plan.md                 # Technical planning\n‚îÇ   ‚îú‚îÄ‚îÄ tasks.md                # Task breakdown\n‚îÇ   ‚îú‚îÄ‚îÄ implement.md            # Implementation executor\n‚îÇ   ‚îú‚îÄ‚îÄ constitution.md         # Project principles generator\n‚îÇ   ‚îú‚îÄ‚îÄ clarify.md              # Specification refinement\n‚îÇ   ‚îú‚îÄ‚îÄ review.md               # Comprehensive analysis\n‚îÇ   ‚îú‚îÄ‚îÄ test.md                 # Test execution (if applicable)\n‚îÇ   ‚îî‚îÄ‚îÄ README.md               # Command documentation\n‚îî‚îÄ‚îÄ specify-template/           # Template for .specify/ directory\n    ‚îî‚îÄ‚îÄ README.md               # Spec Kit overview template\n```\n\n## Expected Outcome\n\nAfter MacBook Claude completes setup:\n\n1. ‚úÖ Spec Kit commands available: `/specify`, `/plan`, `/tasks`, `/implement`, etc.\n2. ‚úÖ `.specify/` directory created with proper structure\n3. ‚úÖ Constitution generated with project-specific principles\n4. ‚úÖ Commands customized to match work project context (not Party Lore)\n5. ‚úÖ Integration with existing CLAUDE.md and workflow\n6. ‚úÖ Ready to use spec-driven development for new features\n\n## Verification\n\nAsk MacBook Claude to run:\n\n```bash\n# Verify commands are present\nls .claude/commands/specify.md\n\n# Verify directory structure\nls -d .specify/constitution .specify/requirements .specify/tasks\n\n# Verify constitution was generated\ncat .specify/constitution/constitution.md | head -20\n\n# Test a command\n/specify Simple test feature to verify setup works\n```\n\n## If Something Goes Wrong\n\nMacBook Claude can:\n- Read `SETUP-INSTRUCTIONS.md` for detailed troubleshooting\n- Check existing `CLAUDE.md` for project conventions\n- Ask you for clarification on project context\n- Re-extract the zip and start over if needed\n\n---\n\n**Package Created**: December 9, 2025\n**Source Project**: party-lore (Linux machine)\n**Destination**: Work project (MacBook)\n**Package Size**: 32KB\n\n**Remember**: The goal is to ADD Spec Kit methodology to the existing project, not replace existing workflows.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "TRANSFER-INSTRUCTIONS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "7cb546ae45760d4c",
      "size_bytes": 4094,
      "created_at": "2026-01-02T20:42:12.420837"
    },
    {
      "doc_id": "local_SPEC-KIT-PACKAGE-README",
      "source": "local",
      "category": "knowledge_base",
      "domain": "documentation",
      "file_path": "/home/doug/Development/SPEC-KIT-PACKAGE-README.md",
      "content": "# Spec Kit Setup Package - Complete\n\n## Package Location\n\n**File**: `~/Development/spec-kit-setup.zip` (37KB)\n**Created**: December 9, 2025\n**Purpose**: Transfer Spec Kit methodology to MacBook work project\n\n## What's Inside the Package\n\n```\nspec-kit-setup.zip\n‚îú‚îÄ‚îÄ QUICK-START-FOR-CLAUDE.md       # Installation guide for MacBook Claude\n‚îú‚îÄ‚îÄ SETUP-INSTRUCTIONS.md           # Detailed human-readable instructions\n‚îú‚îÄ‚îÄ TRANSFER-INSTRUCTIONS.md        # How to transfer (you're reading a copy)\n‚îú‚îÄ‚îÄ README-SPEC-KIT-UPDATES.md      # How to keep commands updated\n‚îú‚îÄ‚îÄ compare-spec-kit-updates.sh     # Script to check for official updates\n‚îú‚îÄ‚îÄ commands/                       # 10 Spec Kit slash commands\n‚îÇ   ‚îú‚îÄ‚îÄ specify.md\n‚îÇ   ‚îú‚îÄ‚îÄ plan.md\n‚îÇ   ‚îú‚îÄ‚îÄ tasks.md\n‚îÇ   ‚îú‚îÄ‚îÄ implement.md\n‚îÇ   ‚îú‚îÄ‚îÄ constitution.md\n‚îÇ   ‚îú‚îÄ‚îÄ clarify.md\n‚îÇ   ‚îú‚îÄ‚îÄ review.md\n‚îÇ   ‚îú‚îÄ‚îÄ test.md\n‚îÇ   ‚îú‚îÄ‚îÄ analyze-reports.md\n‚îÇ   ‚îî‚îÄ‚îÄ README.md\n‚îî‚îÄ‚îÄ specify-template/              # Template .specify/ directory\n    ‚îú‚îÄ‚îÄ README.md\n    ‚îî‚îÄ‚îÄ (empty directory structure)\n```\n\n## Quick Transfer (from MacBook)\n\n```bash\n# From MacBook terminal:\nscp doug@[this-linux-ip]:~/Development/spec-kit-setup.zip ~/Downloads/\n\n# Then in work project:\ncd ~/path/to/work-project\nunzip ~/Downloads/spec-kit-setup.zip\n```\n\n**To find this Linux machine's IP:**\n```bash\nhostname -I | awk '{print $1}'\n```\n\n## What MacBook Claude Will Do\n\nTell MacBook Claude:\n\n> \"I've placed spec-kit-setup.zip in the project. Please extract it and read QUICK-START-FOR-CLAUDE.md for installation instructions. Key points:\n>\n> 1. Read our existing CLAUDE.md first to understand the project\n> 2. Merge Spec Kit commands with our existing .claude/commands/ (don't replace)\n> 3. Customize the commands for our project (remove Party Lore references)\n> 4. Create .specify/ directory structure\n> 5. Run /constitution to initialize\n> 6. Set up the update comparison script\n>\n> The goal is to ADD Spec Kit methodology without disrupting our existing workflow.\"\n\n## What Gets Installed\n\n### Commands Available After Setup\n- `/specify` - Transform ideas into comprehensive specs\n- `/plan` - Generate technical implementation plans\n- `/tasks` - Break down into actionable tasks\n- `/implement` - Execute tasks systematically\n- `/constitution` - Generate project principles\n- `/clarify` - Refine specifications\n- `/review` - Comprehensive analysis\n\n### Directory Structure Created\n```\nwork-project/\n‚îú‚îÄ‚îÄ .claude/\n‚îÇ   ‚îî‚îÄ‚îÄ commands/          # Spec Kit commands merged here\n‚îî‚îÄ‚îÄ .specify/             # New spec-driven development structure\n    ‚îú‚îÄ‚îÄ constitution/\n    ‚îú‚îÄ‚îÄ requirements/\n    ‚îú‚îÄ‚îÄ specification/\n    ‚îú‚îÄ‚îÄ planning/\n    ‚îú‚îÄ‚îÄ tasks/\n    ‚îî‚îÄ‚îÄ scenarios/\n```\n\n### Update Management Tools\n```\nwork-project/\n‚îî‚îÄ‚îÄ scripts/\n    ‚îú‚îÄ‚îÄ compare-spec-kit-updates.sh    # Check for official updates\n    ‚îî‚îÄ‚îÄ README-SPEC-KIT-UPDATES.md     # Update guide\n```\n\n## Key Differences from Party Lore\n\n**Party Lore commands are customized for:**\n- SMS-based async RPG gameplay\n- Dual-channel architecture\n- Individual FR files (fr-001-*.md)\n- Sequential task numbering (TASK-001, TASK-002)\n- Manual commit workflow (stage-only)\n\n**MacBook commands will be customized for:**\n- Work project's domain (MacBook Claude will determine)\n- Work project's tech stack\n- Work project's workflow preferences\n- Work project's existing CLAUDE.md conventions\n\n## Keeping Commands Updated\n\nThe package includes update management tools:\n\n**Quarterly check for official updates:**\n```bash\ncd work-project\n./scripts/compare-spec-kit-updates.sh\n```\n\nThis compares your commands with official GitHub Spec Kit and shows what's changed.\n\n**Strategy:**\n- ‚úÖ Cherry-pick useful improvements manually\n- ‚úÖ Preserve project-specific customizations\n- ‚ùå Don't blindly replace with official versions\n\nSee `README-SPEC-KIT-UPDATES.md` in the package for details.\n\n## Official Spec Kit Info\n\n- **Repository**: https://github.com/github/spec-kit\n- **Latest Version**: v0.0.89 (December 4, 2025)\n- **Active Development**: Yes (updated 5 days ago)\n- **License**: Open source\n\n## Local Testing\n\nYou can test the comparison script on Party Lore right now:\n\n```bash\ncd ~/Development/party-lore\n./scripts/compare-spec-kit-updates.sh\n```\n\nThis will:\n1. Clone/update official Spec Kit to /tmp/spec-kit\n2. Compare your commands with official versions\n3. Show differences (expected: significant, you're heavily customized)\n4. Display next steps for reviewing changes\n\n## Verification After MacBook Setup\n\nMacBook Claude should verify:\n\n```bash\n# Commands installed\nls .claude/commands/specify.md\n\n# Directory structure created\nls -d .specify/constitution .specify/requirements\n\n# Constitution generated\ncat .specify/constitution/constitution.md | head -20\n\n# Test command works\n/specify Simple test feature to verify setup\n```\n\n## Support Files\n\n**For MacBook Claude:**\n- `QUICK-START-FOR-CLAUDE.md` - Step-by-step installation\n- `SETUP-INSTRUCTIONS.md` - Detailed reference\n- `.claude/commands/README.md` - Command documentation\n\n**For You:**\n- `TRANSFER-INSTRUCTIONS.md` - Transfer methods\n- `README-SPEC-KIT-UPDATES.md` - Update management\n\n**For Both:**\n- `compare-spec-kit-updates.sh` - Update comparison tool\n\n## Timeline\n\n1. **Now**: Package ready at `~/Development/spec-kit-setup.zip`\n2. **Transfer**: SCP to MacBook (or cloud/USB)\n3. **Install**: MacBook Claude follows QUICK-START-FOR-CLAUDE.md\n4. **Customize**: Commands adapted to work project\n5. **Test**: Try `/specify` with simple feature\n6. **Use**: Spec-driven development workflow active\n7. **Maintain**: Check for updates quarterly\n\n## Questions?\n\n**\"Will this overwrite my existing commands?\"**\n- No. MacBook Claude will merge, not replace.\n\n**\"What if my work project is different from Party Lore?\"**\n- Expected! Claude will customize for your project's domain.\n\n**\"How do I know it's working?\"**\n- Run `/specify test feature` and review the output\n\n**\"What about updates?\"**\n- Use `./scripts/compare-spec-kit-updates.sh` quarterly\n- Cherry-pick improvements, don't auto-update\n\n## Success Criteria\n\nAfter installation, you should be able to:\n\n1. ‚úÖ Run `/specify` to create functional requirements\n2. ‚úÖ Run `/plan` to generate implementation plans\n3. ‚úÖ Run `/tasks` to break down work\n4. ‚úÖ Run `/implement` to execute tasks\n5. ‚úÖ See `.specify/` directory with organized specs\n6. ‚úÖ Check for updates with comparison script\n\n---\n\n**Package Ready**: ‚úÖ\n**Location**: ~/Development/spec-kit-setup.zip (37KB)\n**Instructions Included**: ‚úÖ\n**Update Tools Included**: ‚úÖ\n**Ready to Transfer**: ‚úÖ\n\n**Next Step**: Transfer to MacBook and extract in work project directory.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "SPEC-KIT-PACKAGE-README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "install",
        "md",
        "readme"
      ],
      "content_hash": "c59d60d799355ca0",
      "size_bytes": 6795,
      "created_at": "2026-01-02T20:42:12.420910"
    },
    {
      "doc_id": "local_metaobjects-core_README",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/README.md",
      "content": "# MetaObjects\n\nMetaObjects is a comprehensive suite of tools for **metadata-driven development**, providing sophisticated control over applications beyond traditional model-driven development techniques. Version 6.3.1+ features a **completely modular architecture** with revolutionary **fluent constraint system** and **native isArray property** designed for modern software development practices.\n\n## üöÄ **Modern Modular Architecture (v6.3.1+)**\n\nMetaObjects Core has been refactored into **9 focused modules** that provide the foundation for metadata-driven development:\n\n### **Core Modules**\n- **`metaobjects-metadata`** - Core metadata definitions and revolutionary fluent constraint system\n- **`metaobjects-core`** - File-based metadata loading and core functionality\n\n### **Code Generation**\n- **`metaobjects-codegen-base`** - Base code generation framework\n- **`metaobjects-codegen-mustache`** - Mustache template-based code generation\n- **`metaobjects-codegen-plantuml`** - PlantUML diagram generation\n- **`metaobjects-maven-plugin`** - Maven integration for build-time code generation\n\n### **Framework Integration**\n- **`metaobjects-core-spring`** - Spring Framework integration and auto-configuration\n\n### **Project Tools**\n- **`archetype`** - Maven archetype for creating MetaObjects-based projects\n- **`examples`** - Complete working examples demonstrating all usage patterns\n\n### **Available Separately**\nThe following modules have been moved to separate projects for focused development:\n- Object Management (OM, OMDB, OMNOSQL) - Database and NoSQL persistence\n- Web Components - React TypeScript components and web utilities\n- Demo Applications - Full-featured demo applications\n\n## üì¶ **Quick Start**\n\n### **Basic Usage (Framework-Independent)**\n```xml\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-core</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</dependency>\n```\n\n### **Spring Integration**\n```xml\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-core-spring</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</dependency>\n```\n\n### **Fluent Constraint System**\n```xml\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-metadata</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</dependency>\n```\n\n### **Code Generation**\n```xml\n<plugin>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-maven-plugin</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n    <executions>\n        <execution>\n            <goals><goal>generate</goal></goals>\n        </execution>\n    </executions>\n</plugin>\n```\n\n## üéØ **Key Features**\n\n### **üöÄ Revolutionary Fluent Constraint System**\n- **Fluent API** - AttributeConstraintBuilder with chainable method calls for elegant constraint definitions\n- **115+ Constraints** - Comprehensive validation coverage (57 placement + 28 validation + 30 array-specific)\n- **Attribute-Specific Validation** - Enhanced ConstraintEnforcer with precise attribute-level constraint checking\n- **Type Safety** - Compile-time checking of constraint definitions with enhanced error reporting\n\n### **üé≤ Universal Array Support**\n- **@isArray Modifier** - Single universal modifier replaces array subtypes, eliminating type explosion\n- **Cross-Platform Ready** - Array types map cleanly to Java, C#, TypeScript\n- **Reduced Complexity** - 6 core field types instead of 12+ with unlimited array combinations\n\n### **üèóÔ∏è Modern Architecture**\n- **Metadata-Driven Development** - Define object structures, validation, and relationships through metadata\n- **Cross-Language Code Generation** - Generate Java, C#, TypeScript from metadata definitions\n- **Framework Integration** - Native support for Spring, OSGi frameworks\n- **JSON/XML Metadata** - Flexible metadata definition formats with inline attribute support\n- **OSGi Compatible** - Full bundle lifecycle support with WeakReference cleanup patterns\n- **Provider-Based Registration** - Clean service discovery with controlled loading order\n\n## üìö **Documentation & Examples**\n\n### **Examples Structure**\nThe `examples/` module provides complete working examples:\n\n- **`basic-example`** - Core functionality without framework dependencies\n- **`spring-example`** - Spring Framework integration patterns  \n- **`osgi-example`** - OSGi bundle lifecycle and service discovery\n- **`shared-resources`** - Common metadata used across examples\n\n### **Running Examples**\n```bash\n# Basic MetaObjects functionality - now with simplified execution!\ncd examples/basic-example && mvn exec:java\n\n# Spring integration - multiple options available\ncd examples/spring-example && mvn spring-boot:run\n# OR: cd examples/spring-example && mvn exec:java\n\n# OSGi patterns\ncd examples/osgi-example && mvn compile exec:java\n```\n\n## üèóÔ∏è **Architecture Benefits**\n\n### **Maven Publishing Ready**\nEach module can be published independently to Maven Central, allowing users to include only needed functionality without framework bloat.\n\n### **Framework Choice**\n- **Core modules**: Work in any Java environment\n- **Integration modules**: Provide native framework support when desired\n- **No forced dependencies**: Choose your stack\n\n### **Modular Development**\n- **Single Responsibility**: Each module has a focused purpose\n- **Clean Dependencies**: No circular dependencies\n- **OSGi Compatible**: Full bundle support with proper lifecycle management\n\n## üîß **Building & Testing**\n\n### **Build Requirements**\n- Java 21 LTS (Production Ready)\n- Maven 3.9+\n\n### **Full Build**\n```bash\nmvn clean compile    # Compile all modules\nmvn test            # Run full test suite\nmvn package         # Package all modules\n```\n\n### **Module Dependencies**\nBuild order: `metadata ‚Üí codegen-* ‚Üí maven-plugin ‚Üí core ‚Üí core-spring ‚Üí archetype ‚Üí examples`\n\n## üõ°Ô∏è **2024-2025 Comprehensive Modernization**\n\n**MetaObjects has undergone complete modernization across security, architecture, and infrastructure:**\n\n### **üîí Security Hardening**\n- **100% Critical Vulnerabilities Eliminated**: All high and critical severity issues resolved\n- **CVE-2015-7501 & CVE-2015-6420 FIXED**: Apache Commons Collections RCE vulnerabilities eliminated\n- **Dependency Management**: Centralized security overrides (SnakeYAML 1.30 ‚Üí 2.2, Gson ‚Üí 2.13.2)\n- **Modern Dependencies**: Spring 5.3.39, Jackson 2.18.1, Logback 1.5.19, secure versions throughout\n\n### **üöÄ Java 21 LTS Migration**\n- **Modern Platform**: Fully migrated to Java 21 LTS for enhanced performance and security\n- **Jakarta EE**: Updated servlet imports (javax.servlet ‚Üí jakarta.servlet) for Spring 6 compatibility\n- **Build Optimization**: Maven caching providing 60%+ build time improvement\n- **Cross-Platform**: Temurin JDK for consistent cross-platform builds\n\n### **üßπ Code Quality Modernization**\n- **400+ Lines Eliminated**: Deprecated/vulnerable code and legacy log4j configurations removed\n- **Modern APIs**: Zero @Deprecated annotations, Optional-based patterns throughout\n- **20+ Obsolete Files Removed**: Duplicate/legacy code cleanup across modules\n- **Enhanced Build System**: Updated Maven plugins (Surefire 3.5.2, Clean 3.4.0, Deploy 3.1.3)\n- **Consolidated Logging**: Standardized Logback configuration eliminating conflicts\n- **Developer Experience**: Added exec-maven-plugin for simplified example execution\n- **Professional Build Output**: Comprehensive logging cleanup with meaningful coverage thresholds\n\n### **‚öôÔ∏è CI/CD Infrastructure**\n- **GitHub Actions**: Latest secure actions (checkout@v4, setup-java@v4, cache@v4)\n- **Build Reliability**: 100% test success rate across 1,247+ tests\n- **OSGi Compatibility**: Full bundle lifecycle management preserved\n- **Architecture Compliance**: Read-optimized performance patterns maintained\n\n### **üìä Quality Metrics**\n- ‚úÖ **All 9 core modules**: Clean compilation and packaging\n- ‚úÖ **Security posture**: Zero critical vulnerabilities (CVE-2015-7501 & CVE-2015-6420 eliminated)\n- ‚úÖ **Updated dependencies**: Jackson 2.18.1, Logback 1.5.19, Commons Validator 1.10.0\n- ‚úÖ **Test coverage**: Comprehensive test suite passing across all modules\n- ‚úÖ **Build performance**: Optimized Maven build configuration\n- ‚úÖ **Working examples**: 3 complete example projects (basic, spring, osgi)\n- ‚úÖ **Fluent constraint system**: Advanced constraint definitions with AttributeConstraintBuilder\n- ‚úÖ **Universal @isArray**: Eliminates array subtype explosion while supporting all combinations\n- ‚úÖ **OSGi compatibility**: Full bundle lifecycle support with WeakReference cleanup patterns\n\n**This represents a comprehensive modernization suitable for enterprise production environments while maintaining the sophisticated architectural patterns that make MetaObjects unique.**\n\n## üìã **Migration from v5.1.x**\n\nThe v5.2.0+ modular architecture maintains full backward compatibility while providing cleaner dependency management:\n\n1. **Replace single dependency** with appropriate modular dependencies\n2. **Update imports** if using internal APIs (rare)\n3. **Spring users**: Switch to `metaobjects-core-spring` for optimal integration\n4. **Code generation**: Use modular codegen artifacts for specific template engines\n\nSee [Migration Guide](MIGRATION.md) for detailed instructions.\n\n## üöÄ **Release Notes**\nCurrent Development: **6.3.0-SNAPSHOT** (Fluent Constraint System + Universal @isArray)\nLatest Stable Release: **6.2.5** (Maven Central Publishing Ready)\n\n**Major v6.3.1 Features:**\n- üöÄ **Revolutionary Fluent Constraint System** with AttributeConstraintBuilder API\n- üé≤ **Universal @isArray Modifier** eliminating array subtype explosion\n- üîß **Enhanced ConstraintEnforcer** with attribute-specific validation\n- üìä **Comprehensive Constraints** with advanced validation patterns\n- üè¢ **Provider-Based Registration** with clean service discovery\n- üîí **Security Updates** - All critical vulnerabilities resolved\n- üè¢ **Modular Architecture** - 9 focused, independent modules\n- üìö **Working Examples** - Complete demonstration projects\n\nClick here for complete [Release Notes](RELEASE_NOTES.md).\n\n## License\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n<http://www.apache.org/licenses/LICENSE-2.0>\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n\n[Apache License 2.0](LICENSE)",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "readme"
      ],
      "content_hash": "2e1c591040c115a9",
      "size_bytes": 10696,
      "created_at": "2026-01-02T20:42:12.421020"
    },
    {
      "doc_id": "local_metaobjects-core_WARP",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/WARP.md",
      "content": "# WARP.md\n\nThis file provides guidance to WARP (warp.dev) when working with code in this repository.\n\n## Project Overview\n\nMetaObjects is a comprehensive Java suite for **metadata-driven development**, featuring a completely modular architecture (v5.2.0+) designed for modern enterprise software development. It provides sophisticated control over applications beyond traditional model-driven development techniques.\n\n**Key Facts:**\n- **Current Version:** 5.2.0-SNAPSHOT (Modular Architecture)\n- **Java Version:** Java 17 LTS (Production Ready)\n- **Build Tool:** Maven 3.9+\n- **License:** Apache License 2.0\n\n## Essential Build Commands\n\n### Full Project Build\n```bash\n# Clean build of all modules\nmvn clean compile\n\n# Run all tests across modules\nmvn test\n\n# Package all modules\nmvn package\n\n# Full clean build with packaging\nmvn clean package\n```\n\n### Module-Specific Building\n```bash\n# Build specific module (respect dependency order)\nmvn -pl metadata clean compile\nmvn -pl core clean compile\nmvn -pl web clean compile\n\n# Build with dependencies\nmvn -pl core -am clean compile\n```\n\n### Testing Commands\n```bash\n# Run all tests\nmvn test\n\n# Run tests for specific module\nmvn -pl metadata test\nmvn -pl core test\n\n# Run single test class\nmvn -Dtest=VehicleMetadataTest test\n\n# Run with detailed output\nmvn test -X\n```\n\n### Web Module (React/TypeScript)\n```bash\n# Navigate to web module\ncd web\n\n# Install dependencies\nnpm install\n\n# Development mode with TypeScript watch\nnpm run dev\n\n# Build TypeScript and CSS\nnpm run build\n\n# Run Jest tests\nnpm run test\n\n# Lint TypeScript/React code\nnpm run lint\nnpm run lint:fix\n```\n\n### Code Generation\n```bash\n# Generate code using Maven plugin\nmvn com.draagon:metaobjects-maven-plugin:generate\n\n# Clean and regenerate\nmvn clean compile com.draagon:metaobjects-maven-plugin:generate\n```\n\n### Examples and Demos\n```bash\n# Run basic example (core functionality)\ncd examples/basic-example && mvn compile exec:java\n\n# Run Spring integration example\ncd examples/spring-example && mvn compile exec:java\n\n# Run OSGi example\ncd examples/osgi-example && mvn compile exec:java\n```\n\n## High-Level Architecture\n\nMetaObjects follows a **READ-OPTIMIZED WITH CONTROLLED MUTABILITY** design pattern, analogous to Java's Class/Field reflection system with dynamic class loading.\n\n### Core Architectural Principles\n1. **Loading Phase vs Runtime Phase**: MetaData objects are loaded once during application startup and optimized for heavy read access\n2. **Permanent Memory Residence**: Like Java Class objects, MetaData stays in memory for the application lifetime\n3. **Thread-Safe Reads**: No synchronization needed for read operations (99.9% of use cases)\n4. **Copy-on-Write Updates**: Infrequent updates use atomic reference swapping to maintain read performance\n\n### Modular Architecture (v5.2.0+)\n\n#### Core Modules\n- **`metadata/`** - Core metadata definitions and constraint system\n- **`core/`** - File-based metadata loading and core functionality\n\n#### Code Generation\n- **`codegen-base/`** - Base code generation framework\n- **`codegen-mustache/`** - Mustache template-based code generation\n- **`codegen-plantuml/`** - PlantUML diagram generation\n- **`maven-plugin/`** - Maven integration for build-time code generation\n\n#### Framework Integration\n- **`core-spring/`** - Spring Framework integration\n- **`web-spring/`** - Spring Web integration with REST controllers\n\n#### Object Management\n- **`om/`** - Object Manager for metadata-driven object persistence\n- **`omdb/`** - Database Object Manager (SQL databases)\n- **`omnosql/`** - NoSQL Object Manager\n\n#### Web & Demo\n- **`web/`** - React TypeScript components and web utilities\n- **`demo/`** - Demo applications with complete examples\n- **`examples/`** - Comprehensive usage examples for all scenarios\n\n### Build Dependencies (Critical Order)\n```\nmetadata ‚Üí codegen-* ‚Üí core ‚Üí *-spring ‚Üí om ‚Üí web ‚Üí demo ‚Üí examples\n```\n\n### MetaData Type System\nThe framework uses a service-based type registry with these key components:\n\n#### MetaDataLoader Pattern (ClassLoader Analogy)\n```java\n// LOADING PHASE - Once at startup\nMetaDataLoader loader = new SimpleLoader(\"myLoader\");\nloader.setSourceURIs(Arrays.asList(URI.create(\"metadata.json\")));\nloader.init(); // Loads ALL metadata into permanent memory\n\n// RUNTIME PHASE - Read-only operations\nMetaObject userMeta = loader.getMetaObjectByName(\"User\");  // O(1) lookup\nMetaField field = userMeta.getMetaField(\"email\");          // Cached access\n```\n\n#### Cache Strategy\n- **ConcurrentHashMap**: Permanent cache for core metadata lookups\n- **WeakHashMap**: Computed cache for derived calculations (OSGi-compatible)\n- **Dual Strategy**: Balances performance with memory cleanup in long-running applications\n\n### Constraint System (v5.2.0+)\nConstraints are self-registered programmatically via static initializers in MetaData classes:\n\n```java\n@MetaDataType(type = \"field\", subType = \"string\")\npublic class StringField extends PrimitiveField<String> {\n    static {\n        // Self-registration with constraint setup\n        MetaDataTypeRegistry registry = new MetaDataTypeRegistry();\n        registry.registerHandler(\n            new MetaDataTypeId(TYPE_FIELD, SUBTYPE_STRING), \n            StringField.class\n        );\n        setupStringFieldConstraints();\n    }\n}\n```\n\n## Development Patterns\n\n### Thread-Safety Guidelines\n- **Loading Phase**: Use synchronization for writes/construction\n- **Runtime Phase**: No synchronization needed for reads (immutable after loading)\n- **Update Phase**: Copy-on-write for infrequent metadata updates\n\n### Critical Architectural Rules\n1. **DO NOT** treat MetaData as frequently mutable domain objects\n2. **DO NOT** replace WeakHashMap with strong references (breaks OSGi compatibility)\n3. **DO NOT** create new MetaDataLoader instances frequently\n4. **DO** follow ClassLoader patterns for caching and lifecycle management\n\n### Testing with Shared Registry\nAll tests inherit from `SharedRegistryTestBase` to prevent registry conflicts:\n```java\n@IsolatedTest // For tests that must manipulate registry directly\npublic class MyTest extends SharedRegistryTestBase {\n    // Test implementation\n}\n```\n\n### Spring Integration Patterns\n```java\n@Bean\n@Singleton\npublic MetaDataLoader applicationMetaDataLoader() {\n    SimpleLoader loader = new SimpleLoader(\"app-metadata\");\n    loader.setSourceURIs(getMetadataSourceURIs());\n    loader.init(); // Heavy one-time cost\n    return loader; // Permanent application bean\n}\n```\n\n### React MetaView Integration\n- Backend serves metadata as JSON via Spring REST controllers\n- Frontend uses TypeScript MetaView components for automatic form generation\n- State management with Redux Toolkit and React Query\n\n### Inline Attribute Support (v5.2.0+)\nReduce metadata verbosity with inline attributes:\n\n**JSON Format (@ prefixed):**\n```json\n{\n  \"field\": {\n    \"name\": \"email\",\n    \"type\": \"string\",\n    \"@required\": true,\n    \"@maxLength\": 255\n  }\n}\n```\n\n**XML Format (no prefix):**\n```xml\n<field name=\"email\" type=\"string\" required=\"true\" maxLength=\"255\" />\n```\n\n## OSGi Compatibility\n\nThe framework is designed for OSGi environments with dynamic bundle loading/unloading:\n- Service discovery uses ServiceLoader pattern\n- WeakReference patterns prevent memory leaks\n- Bundle classloader cleanup supported\n- Service registrations cleaned up automatically\n\n## Security & Modernization (2024-2025)\n\n**Comprehensive modernization completed:**\n- ‚úÖ **Security**: CVE-2015-7501 & CVE-2015-6420 vulnerabilities eliminated\n- ‚úÖ **Java 17 LTS**: Production-ready migration from Java 21\n- ‚úÖ **Dependencies**: Updated to secure versions (Spring 5.3.39, Commons Lang3 3.18.0)\n- ‚úÖ **Code Quality**: 341 lines of deprecated/vulnerable code removed\n- ‚úÖ **CI/CD**: GitHub Actions modernized with security improvements\n- ‚úÖ **Test Success**: 117+ tests passing with 100% success rate\n\n## Important Notes from CLAUDE.md\n\nWhen working with this codebase, remember:\n\n1. **Read-Optimized Architecture**: This is NOT a typical data access pattern - optimize for heavy reads, rare updates\n2. **ClassLoader Analogy**: MetaDataLoader operates like Java's ClassLoader with permanent memory residence\n3. **Constraint System Integration**: Constraints are programmatically self-registered, no external JSON files\n4. **Shared Registry Pattern**: Tests use static shared registry to prevent conflicts\n5. **OSGi Bundle Management**: WeakHashMap design is intentional for bundle lifecycle support\n6. **Performance Expectations**: \n   - Loading Phase: 100ms-1s (one-time cost)\n   - Runtime Reads: 1-10Œºs (cached, lock-free)\n   - Concurrent Readers: Unlimited (no lock contention)\n\nThe architecture is sophisticated and follows enterprise patterns for metadata-driven development with high-performance read characteristics.\n\n## Global Development Rules\n\nThese universally applicable principles should be followed for any software development:\n\n### Systematic Problem-Solving Methodology\n- Apply \"THINK HARD THROUGH THIS STEP BY STEP\" approach to complex problems\n- Break down problems into logical phases with clear objectives\n- Identify root causes before applying solutions\n- Use incremental validation at each step\n- Maintain zero-regression policy during major changes\n\n### Security & Quality\n- **Address CVE vulnerabilities immediately** using dependency exclusion + secure replacement\n- **Never use unsafe generic casting** - use stream-based conversion instead\n- **Prefer Optional-based APIs** for null-safe programming\n- **Use modern exception patterns** with rich context and suggestions\n\n### Testing Strategy\n- **Use shared registry patterns** to prevent test conflicts\n- **Achieve 100% test success rate** before considering features complete\n- **Validate incrementally**: Unit ‚Üí Integration ‚Üí Build ‚Üí Regression ‚Üí Performance\n- **Create `@IsolatedTest` annotations** for tests that manipulate shared state\n\n### Architecture & Documentation\n- **Design for enterprise publishing** with proper dependency management\n- **Use service discovery over hard-coding** with META-INF/services patterns\n- **Preserve APIs through deprecation** - never break backward compatibility\n- **Keep architecture documentation current** with every major change\n- **Categorize enhancements systematically**: HIGH/MEDIUM/LOW priority with clear success criteria\n\n### Performance & Scalability\n- **Optimize for the primary use case** (99% case, accommodate 1%)\n- **Use appropriate data structures** for access patterns\n- **Implement lock-free algorithms** where possible\n- **Support unlimited concurrent readers** when appropriate\n\n## MetaObjects Project-Specific Rules\n\nThese rules are specific to MetaObjects architecture and should NOT be applied to other projects:\n\n### READ-OPTIMIZED WITH CONTROLLED MUTABILITY Architecture\n- **MetaData objects follow ClassLoader pattern**: Load once, permanent in memory, thread-safe reads\n- **Optimize for 99.9% reads, 0.1% updates** - this is NOT a mutable domain model\n- **Use Copy-on-Write patterns** for infrequent metadata updates\n- **Performance expectations**: Loading 100ms-1s, Runtime reads 1-10Œºs, Unlimited concurrent readers\n\n### OSGI Bundle Lifecycle Compatibility\n- **Use WeakHashMap for computed caches** - allows cleanup when bundles unload\n- **Implement ServiceReference leak prevention** with proper cleanup patterns\n- **Use WeakReference patterns** for ClassLoader cleanup\n- **Never use global static state** that breaks modularization\n\n### Cache Strategy Requirements\n- **Respect dual cache strategy**: ConcurrentHashMap (permanent) + WeakHashMap (computed)\n- **Never replace WeakHashMap with strong references** - breaks OSGI compatibility\n- **Cache computed values can be GC'd and recomputed** during memory pressure\n- **Permanent cache for core metadata lookups** never gets GC'd\n\n### Provider-Based Registration System\n- **Use service discovery for type registration** via META-INF/services\n- **Implement priority-based provider loading**: 0=base, 10=concrete, 50+=extensions\n- **Enable extensibility without modifying parent classes**\n- **Support dynamic registration and cleanup**\n\n### Constraint System Integration\n- **Use programmatic self-registration** - no external JSON constraint files\n- **Check constraint system before adding validation** anywhere in codebase\n- **Use PlacementConstraint for \"X CAN be placed under Y\" rules**\n- **Use ValidationConstraint for value validation rules**\n- **Never add validation to type definitions, annotations, or constructors**\n\n### Constants Organization\n- **Constants live with classes that create the need for them**\n- **Core MetaData constants go in owning classes** (MetaData.java, MetaField.java)\n- **Service-specific constants go in service modules** (DatabaseAttributeConstants, JpaConstants)\n- **Never create centralized constant files** that violate dependency relationships\n\n### Anti-Patterns to Avoid\n- **‚ùå DON'T treat MetaData as mutable domain objects** - they're like Java Class objects\n- **‚ùå DON'T create MetaDataLoader instances frequently** - one per application context\n- **‚ùå DON'T add rigid validation to core types** - use constraint system instead\n- **‚ùå DON'T synchronize read operations after loading** - kills concurrent performance\n- **‚ùå DON'T add service-specific attributes to core types** - violates separation of concerns\n\n### Testing Patterns Specific to MetaObjects\n- **Use single static MetaDataRegistry shared across ALL tests**\n- **Don't tear down registry between tests** - creates conflicts\n- **All tests inherit from SharedRegistryTestBase**\n- **Use @IsolatedTest for tests that manipulate registry directly**\n- **Field names must follow pattern**: `^[a-zA-Z][a-zA-Z0-9_]*$` (no :: allowed)\n\n### API Usage Patterns\n- **Use existing Optional-based APIs**: `findString()`, `requireString()`, `getFieldsStream()`\n- **Use ObjectManager API correctly**: `om.createObject(connection, object)`\n- **Use MetaObjects exception constructors**: `new MetaDataNotFoundException(\"msg\", name)`\n- **Prefer inline attributes in JSON**: `\"@required\": true, \"@maxLength\": 255`\n\n### Architecture Compliance Validation\nBefore making ANY changes to MetaObjects code, verify:\n- Does it respect READ-OPTIMIZED WITH CONTROLLED MUTABILITY pattern?\n- Does it maintain OSGI compatibility with WeakHashMap design?\n- Does it optimize for read-heavy workloads (99.9% reads, 0.1% updates)?\n- Does it support future dynamic metadata updates without blocking readers?\n- Does it preserve extensibility without breaking existing functionality?\n\n### Success Criteria for MetaObjects Development\n- ‚úÖ **100% test success rate**: All 199+ tests must pass consistently\n- ‚úÖ **Registry health**: 33-35+ types properly registered without conflicts  \n- ‚úÖ **Architecture compliance**: READ-OPTIMIZED pattern maintained\n- ‚úÖ **OSGI compatibility**: WeakHashMap patterns and service discovery working\n- ‚úÖ **Constraint system**: Programmatic constraints enforcing without external files\n- ‚úÖ **Provider registration**: Service-based type discovery functioning correctly\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/WARP.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "3476cc82f47cba22",
      "size_bytes": 15057,
      "created_at": "2026-01-02T20:42:12.421245"
    },
    {
      "doc_id": "local_metaobjects-core_POST_RELEASE_COMMUNICATIONS",
      "source": "local",
      "category": "conversational",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/POST_RELEASE_COMMUNICATIONS.md",
      "content": "# MetaObjects 6.3.0 Post-Release Communications\n\n## üöÄ **Release Announcement - Social Media**\n\n### **LinkedIn/Twitter Post**\n```\nüöÄ MetaObjects 6.3.0 is now LIVE!\n\nRevolutionary features:\n‚ú® Fluent Constraint System (115 constraints)\nüé≤ Universal @isArray support (33% complexity reduction)\nüîß AI-optimized type system\nüì¶ All 19 modules available on Maven Central\n\nPerfect for metadata-driven development in Java, C#, TypeScript!\n\n#MetaObjects #Java #CodeGeneration #Metadata #OpenSource\nhttps://github.com/metaobjectsdev/metaobjects-core\n```\n\n### **GitHub Discussions Announcement**\n```markdown\n# üéâ MetaObjects 6.3.0 Released - Revolutionary Fluent Constraint System\n\nWe're excited to announce the release of MetaObjects 6.3.0, featuring our most significant architectural advancement yet!\n\n## üåü Key Highlights\n- **Fluent Constraint System**: 115 comprehensive constraints with elegant AttributeConstraintBuilder API\n- **Universal @isArray**: Eliminated array subtype explosion (33% complexity reduction)\n- **AI-Optimized Types**: Perfect for cross-language code generation (Java, C#, TypeScript)\n- **Production Ready**: 1,247+ tests passing, all 19 modules on Maven Central\n\n## üì¶ Get Started\n```xml\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-core</artifactId>\n    <version>6.3.0</version>\n</dependency>\n```\n\nFull release notes: [RELEASE_NOTES_6.3.0.md](RELEASE_NOTES_6.3.0.md)\n\nHappy coding! üöÄ\n```\n\n## üìß **Email to Users/Stakeholders**\n\n### **Subject**: MetaObjects 6.3.0 Released - Revolutionary Fluent Constraint System\n\n```\nHi [Name],\n\nI'm excited to share that MetaObjects 6.3.0 is now available on Maven Central!\n\nThis release represents a major evolutionary step with our new fluent constraint system and universal array support.\n\nüéØ KEY BENEFITS FOR YOU:\n- Simplified metadata definitions (33% less complexity)\n- Enhanced type safety with fluent constraint APIs\n- Better cross-language code generation support\n- Production-ready quality (1,247+ tests passing)\n\nüîß UPGRADE PATH:\nThe release maintains full backward compatibility. Simply update your version to 6.3.0:\n\n```xml\n<version>6.3.0</version>\n```\n\nüìã WHAT'S NEW:\n- Revolutionary fluent constraint system (115 constraints)\n- Universal @isArray modifier eliminates array type explosion\n- AI-optimized type system for Java, C#, TypeScript\n- Enhanced JSON array parsing with natural syntax\n- Professional build experience with clean output\n\nFull details: https://github.com/metaobjectsdev/metaobjects-core/releases/tag/v6.3.0\n\nQuestions? Reply to this email or open a GitHub issue.\n\nBest regards,\n[Your Name]\n```\n\n## üìù **Documentation Updates Needed**\n\n### **Priority Updates:**\n1. **Main Website** (if you have one)\n   - Update \"Current Version\" to 6.3.0\n   - Highlight fluent constraint system\n   - Update getting started guides\n\n2. **GitHub README Badges**\n   ```markdown\n   ![Maven Central](https://img.shields.io/maven-central/v/com.metaobjects/metaobjects-core?label=Maven%20Central&color=blue)\n   ![GitHub release](https://img.shields.io/github/v/release/metaobjectsdev/metaobjects-core?label=Latest%20Release)\n   ```\n\n3. **Documentation Site Updates**\n   - Add fluent constraint examples\n   - Update @isArray usage patterns\n   - Refresh getting started tutorials\n\n## üîç **Post-Release Verification Checklist**\n\n### **Maven Central Verification**\n- [ ] Check: https://central.sonatype.com/artifact/com.metaobjects/metaobjects-core/6.3.0\n- [ ] Verify all 19 modules are available\n- [ ] Test dependency resolution in a sample project\n\n### **GitHub Repository Verification**\n- [ ] Confirm version updated to 6.3.1-SNAPSHOT\n- [ ] Check release is tagged and published\n- [ ] Verify release notes are displayed correctly\n\n### **Functional Verification**\n- [ ] Create test project with 6.3.0 dependency\n- [ ] Test basic metadata loading\n- [ ] Verify fluent constraint system works\n- [ ] Test @isArray functionality\n\n## üìä **Metrics to Track**\n\n### **Download Metrics** (check in 1-2 weeks)\n- Maven Central download statistics\n- GitHub release download counts\n- Repository stars/forks growth\n\n### **Community Engagement**\n- GitHub issues/discussions activity\n- Social media engagement\n- Developer feedback and adoption\n\n## üéØ **Next Steps After Release**\n\n1. **Monitor for Issues** (first 48 hours)\n   - Watch GitHub issues for any user reports\n   - Monitor Maven Central sync status\n   - Check community channels for feedback\n\n2. **Community Outreach** (first week)\n   - Post announcements on relevant forums\n   - Update any third-party documentation/blogs\n   - Engage with users who provide feedback\n\n3. **Planning 6.3.1** (after initial feedback)\n   - Collect user enhancement requests\n   - Plan any critical fixes if needed\n   - Update roadmap based on adoption feedback",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/POST_RELEASE_COMMUNICATIONS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "http",
        "md"
      ],
      "content_hash": "54cad79f077a85e0",
      "size_bytes": 4813,
      "created_at": "2026-01-02T20:42:12.421323"
    },
    {
      "doc_id": "local_metaobjects-core_MIGRATION",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/MIGRATION.md",
      "content": "# Migration Guide: v5.1.x ‚Üí v6.2.6+\n\nThis guide helps existing MetaObjects users migrate to the new **metaobjects.com architecture** and **modular structure** introduced in v6.2.6+.\n\n## üéØ **Migration Overview**\n\nThe v6.3.1+ release represents a **major architectural enhancement** with comprehensive package refactoring, modular structure, and revolutionary fluent constraint system. The primary changes are package refactoring, modular structure, and enhanced constraint capabilities.\n\n### **What Changed**\n- **Package Structure**: `com.draagon.meta.*` ‚Üí `com.metaobjects.*`\n- **Group ID**: `com.draagon` ‚Üí `com.metaobjects`\n- **Domain**: Moved to `metaobjects.com` and `metaobjects.dev`\n- **Monolithic JAR** ‚Üí **Focused modules**\n- **Single dependency** ‚Üí **Choose what you need**\n- **Framework coupling** ‚Üí **Optional integrations**\n\n### **What Stayed the Same**\n- ‚úÖ **All APIs remain functionally identical** (just new packages)\n- ‚úÖ **Metadata formats unchanged**\n- ‚úÖ **Functionality preserved**\n- ‚úÖ **Configuration compatible**\n\n## üîÑ **Dependency Migration**\n\n### **Before (v5.1.x)**\n```xml\n<dependency>\n    <groupId>com.draagon</groupId>\n    <artifactId>metaobjects</artifactId>\n    <version>5.1.0</version>\n</dependency>\n```\n\n### **After (v6.3.1+) - Choose Your Modules**\n\n#### **Basic Usage (Core Only)**\n```xml\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-core</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</dependency>\n```\n\n#### **Spring Projects**\n```xml\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-core-spring</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</dependency>\n```\n*Note: Automatically includes `metaobjects-core`*\n\n#### **Code Generation**\n```xml\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-codegen-mustache</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</dependency>\n```\n\n#### **Maven Archetype for New Projects**\n```xml\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>archetype</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</dependency>\n```\n*Note: Database object management and web components have been moved to separate projects*\n\n## üì¶ **Migration Scenarios**\n\n### **Scenario 1: Basic MetaObjects Usage**\n\n**Before:**\n```java\n// Using old packages\nimport com.draagon.meta.loader.simple.SimpleLoader;\nimport com.draagon.meta.object.MetaObject;\nimport com.draagon.meta.object.value.ValueObject;\n\nSimpleLoader loader = new SimpleLoader(\"myLoader\");\n// ... rest of code unchanged\n```\n\n**After:**\n```java\n// Updated to new packages\nimport com.metaobjects.loader.simple.SimpleLoader;\nimport com.metaobjects.object.MetaObject;\nimport com.metaobjects.object.value.ValueObject;\n\nSimpleLoader loader = new SimpleLoader(\"myLoader\");\n// ... rest of code remains the same\n```\n- **Dependency**: Change to `metaobjects-core` with new groupId\n- **Code**: Update import statements to new package structure\n\n### **Scenario 2: Spring Integration**\n\n**Before:**\n```java\n// If you were using Spring features\n@Autowired\nprivate MetaDataLoader loader;\n```\n\n**After:**\n- **Dependency**: Change to `metaobjects-core-spring`\n- **Code**: **No changes required** (even better Spring integration available)\n- **New Features**: Access to `MetaDataService`, auto-configuration\n\n### **Scenario 3: Code Generation**\n\n**Before:**\n```xml\n<plugin>\n    <groupId>com.draagon</groupId>\n    <artifactId>metaobjects-maven-plugin</artifactId>\n    <version>5.1.0</version>\n</plugin>\n```\n\n**After:**\n```xml\n<plugin>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-maven-plugin</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</plugin>\n```\n- **Plugin usage**: **Identical**\n- **Templates**: **Fully compatible**\n\n### **Scenario 4: Web/React Components**\n\n**Note**: Web components and React MetaView components have been moved to a separate project. \nFor existing users:\n- **Migration**: Contact project maintainers for the new web components repository\n- **Alternative**: Use the core modules with your own web framework integration\n\n## üîß **Build Tool Migration**\n\n### **Maven Projects**\n\n#### **Update Parent POM (if using)**\n```xml\n<parent>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</parent>\n```\n\n#### **Update Plugin Versions**\n```xml\n<plugin>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-maven-plugin</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</plugin>\n```\n\n### **Gradle Projects**\n\n#### **Before**\n```gradle\nimplementation 'com.draagon:metaobjects:5.1.0'\n```\n\n#### **After**\n```gradle\nimplementation 'com.metaobjects:metaobjects-core:6.3.1-SNAPSHOT'\n// Add additional modules as needed\nimplementation 'com.metaobjects:metaobjects-core-spring:6.3.1-SNAPSHOT'\n```\n\n## üéÅ **Enhanced Features Available**\n\n### **New Spring Integration**\n```java\n// New optional convenience features\n@Autowired\nprivate MetaDataService metaDataService;\n\n// Improved API with Optional support\nOptional<MetaObject> userMeta = metaDataService.findMetaObjectByNameOptional(\"User\");\nboolean hasUser = metaDataService.metaObjectExists(\"User\");\n```\n\n### **Enhanced Examples**\n```bash\n# Try the new comprehensive examples\ncd examples/basic-example && mvn compile exec:java\ncd examples/spring-example && mvn compile exec:java\ncd examples/osgi-example && mvn compile exec:java\n```\n\n### **Better Error Messages**\nThe new modular architecture provides clearer error messages and better debugging information.\n\n## ‚ö° **Performance Improvements**\n\n### **Reduced Dependencies**\n- **Smaller JARs**: Include only needed functionality\n- **Faster startup**: No unused framework loading\n- **Better caching**: Optimized for specific use cases\n\n### **OSGi Enhancements**\n- **Improved bundle lifecycle** management\n- **Better WeakReference** cleanup patterns\n- **Optimized service discovery**\n\n## ‚ö†Ô∏è **Breaking Changes (Rare)**\n\n### **Internal API Changes**\nIf you were using internal APIs (rare), some package restructuring may require import updates:\n\n```java\n// If you were using these internal APIs (uncommon)\n// Before: com.metaobjects.generator.direct.*\n// After:   com.metaobjects.generator.mustache.*\n\n// Most users won't be affected\n```\n\n### **OSGi Bundle Names**\nOSGi bundle symbolic names have changed to reflect the new module structure:\n- `com.metaobjectsobjects` ‚Üí `com.metaobjectsobjects.core`\n- Add new bundles: `com.metaobjectsobjects.core.spring`, etc.\n\n## üß™ **Testing Your Migration**\n\n### **Verification Steps**\n1. **Update dependencies** to new modules\n2. **Clean build**: `mvn clean compile`\n3. **Run tests**: `mvn test`\n4. **Test functionality**: Verify your features work identically\n\n### **Common Issues & Solutions**\n\n#### **Issue: ClassNotFoundException**\n**Solution**: Add the appropriate module dependency\n\n#### **Issue: Spring beans not found**\n**Solution**: Switch to `metaobjects-core-spring` for auto-configuration\n\n#### **Issue: Maven plugin not found**\n**Solution**: Update plugin version to 6.3.1-SNAPSHOT and groupId to com.metaobjects\n\n## üìû **Support**\n\n### **Migration Help**\n- **Examples**: Check `examples/` for patterns matching your use case\n- **Documentation**: See README.md for comprehensive module guide\n- **Issues**: Report migration problems at [GitHub Issues](https://github.com/draagon/metaobjects/issues)\n\n### **Recommended Migration Path**\n1. **Start simple**: Migrate to `metaobjects-core` first\n2. **Add integrations**: Add Spring, web, or other modules as needed\n3. **Test thoroughly**: Verify all functionality before deployment\n4. **Optimize**: Remove unused dependencies after migration complete\n\n---\n\n**The modular architecture provides the same powerful MetaObjects functionality with better dependency management and enhanced framework integration options.**",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/MIGRATION.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "795a5452292fcfc0",
      "size_bytes": 7886,
      "created_at": "2026-01-02T20:42:12.421391"
    },
    {
      "doc_id": "local_metaobjects-core_METAOBJECTS_ARCHETYPE_DESIGN",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/METAOBJECTS_ARCHETYPE_DESIGN.md",
      "content": "# MetaObjects Maven Archetype Design\n\n## üéØ **RECOMMENDED APPROACH: Maven Archetype**\n\nBased on step-by-step analysis, **Maven Archetype is the superior solution** because:\n\n‚úÖ **Industry Standard**: Developers expect `mvn archetype:generate` for project scaffolding\n‚úÖ **Complete Project**: Creates entire working application structure, not just documentation\n‚úÖ **Zero Configuration**: All dependencies, plugins, and configuration included\n‚úÖ **Best Practices**: Demonstrates proper MetaObjects architecture through working code\n‚úÖ **Immediate Value**: Generated project compiles and runs without additional setup\n\n---\n\n## üèóÔ∏è **ARCHETYPE STRUCTURE**\n\n### **New Module: `archetype`**\n\n```\narchetype/\n‚îú‚îÄ‚îÄ pom.xml                                    # Archetype build configuration\n‚îî‚îÄ‚îÄ src/\n    ‚îî‚îÄ‚îÄ main/\n        ‚îî‚îÄ‚îÄ resources/\n            ‚îú‚îÄ‚îÄ META-INF/\n            ‚îÇ   ‚îî‚îÄ‚îÄ maven/\n            ‚îÇ       ‚îî‚îÄ‚îÄ archetype-metadata.xml  # Archetype definition\n            ‚îî‚îÄ‚îÄ archetype-resources/             # Template project\n                ‚îú‚îÄ‚îÄ pom.xml                      # Generated project POM\n                ‚îú‚îÄ‚îÄ .claude/\n                ‚îÇ   ‚îî‚îÄ‚îÄ CLAUDE.md               # Complete application guide\n                ‚îú‚îÄ‚îÄ src/\n                ‚îÇ   ‚îú‚îÄ‚îÄ main/\n                ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/\n                ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __packageInPathFormat__/\n                ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Application.java\n                ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ config/\n                ‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ MetaObjectsConfiguration.java\n                ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ service/\n                ‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ UserService.java\n                ‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ OrderService.java\n                ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ controller/\n                ‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ UserController.java\n                ‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ OrderController.java\n                ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ dto/\n                ‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ CreateUserRequest.java\n                ‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ OrderItemData.java\n                ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/\n                ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.properties\n                ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ metadata/\n                ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ application-metadata.json\n                ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ database-overlay.json\n                ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ templates/           # Custom Mustache templates\n                ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ java-domain-object.mustache\n                ‚îÇ   ‚îî‚îÄ‚îÄ test/\n                ‚îÇ       ‚îî‚îÄ‚îÄ java/\n                ‚îÇ           ‚îî‚îÄ‚îÄ __packageInPathFormat__/\n                ‚îÇ               ‚îú‚îÄ‚îÄ ApplicationTest.java\n                ‚îÇ               ‚îú‚îÄ‚îÄ service/\n                ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ UserServiceTest.java\n                ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ OrderServiceTest.java\n                ‚îÇ               ‚îî‚îÄ‚îÄ integration/\n                ‚îÇ                   ‚îî‚îÄ‚îÄ DatabaseIntegrationTest.java\n                ‚îî‚îÄ‚îÄ README.md                    # Generated project readme\n```\n\n---\n\n## üìã **ARCHETYPE IMPLEMENTATION PLAN**\n\n### **Phase 1: Archetype Module Creation**\n\n1. **Create new module** `archetype` in main project\n2. **Configure archetype POM** with proper parent and packaging\n3. **Define archetype metadata** with parameter placeholders\n4. **Create template project structure** with working examples\n\n### **Phase 2: Template Content Development**\n\n1. **Working Metadata Examples**: User/Order domain with proper Identity/Relationship patterns\n2. **Complete Configuration**: Maven, Spring, Database setup\n3. **Example Services**: CRUD operations using ObjectManagerDB\n4. **REST Controllers**: Complete API endpoints\n5. **Test Suite**: Unit and integration tests\n\n### **Phase 3: Documentation Integration**\n\n1. **Comprehensive CLAUDE.md**: Complete application guide (already created)\n2. **Project README**: Getting started instructions\n3. **Code Comments**: Extensive documentation in generated code\n4. **Architecture Notes**: Inline explanations of MetaObjects patterns\n\n### **Phase 4: Testing & Validation**\n\n1. **Generate test projects** using archetype\n2. **Verify complete build** without manual configuration\n3. **Test all examples** compile and run successfully\n4. **Validate documentation** accuracy and completeness\n\n---\n\n## ‚öôÔ∏è **ARCHETYPE CONFIGURATION**\n\n### **archetype-metadata.xml**\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<archetype-descriptor name=\"metaobjects-application\">\n    <requiredProperties>\n        <requiredProperty key=\"groupId\"/>\n        <requiredProperty key=\"artifactId\"/>\n        <requiredProperty key=\"version\"/>\n        <requiredProperty key=\"package\"/>\n    </requiredProperties>\n\n    <fileSets>\n        <fileSet filtered=\"true\" packaged=\"true\">\n            <directory>src/main/java</directory>\n            <includes>\n                <include>**/*.java</include>\n            </includes>\n        </fileSet>\n        <fileSet filtered=\"true\">\n            <directory>src/main/resources</directory>\n            <includes>\n                <include>**/*.properties</include>\n                <include>**/*.json</include>\n                <include>**/*.mustache</include>\n            </includes>\n        </fileSet>\n        <fileSet filtered=\"true\" packaged=\"true\">\n            <directory>src/test/java</directory>\n            <includes>\n                <include>**/*.java</include>\n            </includes>\n        </fileSet>\n        <fileSet filtered=\"false\">\n            <directory>.claude</directory>\n            <includes>\n                <include>**/*.md</include>\n            </includes>\n        </fileSet>\n    </fileSets>\n</archetype-descriptor>\n```\n\n### **Generated Project POM Template**\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0\n         http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>${groupId}</groupId>\n    <artifactId>${artifactId}</artifactId>\n    <version>${version}</version>\n    <packaging>jar</packaging>\n\n    <name>${artifactId}</name>\n    <description>MetaObjects Application: ${artifactId}</description>\n\n    <properties>\n        <maven.compiler.source>17</maven.compiler.source>\n        <maven.compiler.target>17</maven.compiler.target>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\n        <metaobjects.version>6.2.6</metaobjects.version>\n        <spring.boot.version>3.2.0</spring.boot.version>\n    </properties>\n\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-dependencies</artifactId>\n                <version>${spring.boot.version}</version>\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n\n    <dependencies>\n        <!-- MetaObjects Core -->\n        <dependency>\n            <groupId>com.metaobjects</groupId>\n            <artifactId>metaobjects-core</artifactId>\n            <version>${metaobjects.version}</version>\n        </dependency>\n\n        <!-- MetaObjects Database Persistence -->\n        <dependency>\n            <groupId>com.metaobjects</groupId>\n            <artifactId>metaobjects-omdb</artifactId>\n            <version>${metaobjects.version}</version>\n        </dependency>\n\n        <!-- MetaObjects Spring Integration -->\n        <dependency>\n            <groupId>com.metaobjects</groupId>\n            <artifactId>metaobjects-core-spring</artifactId>\n            <version>${metaobjects.version}</version>\n        </dependency>\n\n        <!-- Spring Boot Starter -->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-jpa</artifactId>\n        </dependency>\n\n        <!-- Database (H2 for getting started, replace with your choice) -->\n        <dependency>\n            <groupId>com.h2database</groupId>\n            <artifactId>h2</artifactId>\n            <scope>runtime</scope>\n        </dependency>\n\n        <!-- Testing -->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <!-- MetaObjects Code Generation -->\n            <plugin>\n                <groupId>com.metaobjects</groupId>\n                <artifactId>metaobjects-maven-plugin</artifactId>\n                <version>${metaobjects.version}</version>\n                <executions>\n                    <execution>\n                        <id>generate-domain-objects</id>\n                        <phase>generate-sources</phase>\n                        <goals>\n                            <goal>generate</goal>\n                        </goals>\n                        <configuration>\n                            <loader>\n                                <classname>com.metaobjects.loader.file.FileMetaDataLoader</classname>\n                                <name>app-metadata</name>\n                                <sourceURIs>\n                                    <sourceURI>classpath:metadata/application-metadata.json</sourceURI>\n                                    <sourceURI>classpath:metadata/database-overlay.json</sourceURI>\n                                </sourceURIs>\n                            </loader>\n                            <generators>\n                                <generator>\n                                    <classname>com.metaobjects.generator.mustache.java.JavaDomainObjectGenerator</classname>\n                                    <args>\n                                        <outputDir>${project.basedir}/src/main/java</outputDir>\n                                        <packageName>${package}.domain</packageName>\n                                    </args>\n                                </generator>\n                            </generators>\n                        </configuration>\n                    </execution>\n                </executions>\n            </plugin>\n\n            <!-- Spring Boot Maven Plugin -->\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <version>${spring.boot.version}</version>\n                <executions>\n                    <execution>\n                        <goals>\n                            <goal>repackage</goal>\n                        </goals>\n                    </execution>\n                </executions>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n```\n\n---\n\n## üöÄ **USAGE EXPERIENCE**\n\n### **Developer Workflow**\n\n```bash\n# 1. Generate new MetaObjects project\nmvn archetype:generate \\\n  -DarchetypeGroupId=com.metaobjects \\\n  -DarchetypeArtifactId=archetype \\\n  -DarchetypeVersion=6.2.6 \\\n  -DgroupId=com.mycompany \\\n  -DartifactId=my-awesome-app \\\n  -Dversion=1.0.0-SNAPSHOT \\\n  -Dpackage=com.mycompany.myapp \\\n  -DinteractiveMode=false\n\n# 2. Enter generated project\ncd my-awesome-app\n\n# 3. Build and run immediately (everything works out of the box)\nmvn clean compile\nmvn spring-boot:run\n\n# 4. Generated project includes:\n# - Complete working REST API (Users, Orders)\n# - H2 database with auto-created tables\n# - Sample data and CRUD operations\n# - Comprehensive .claude/CLAUDE.md guide for Claude Code assistance\n```\n\n### **Generated Project Features**\n\n‚úÖ **Immediate Value**: Project runs without any configuration\n‚úÖ **Working Examples**: CRUD operations for User and Order entities\n‚úÖ **REST API**: Complete API endpoints with proper HTTP methods\n‚úÖ **Database Integration**: Auto-created tables with sample data\n‚úÖ **Best Practices**: Demonstrates proper MetaObjects architecture patterns\n‚úÖ **Testing**: Unit and integration tests included\n‚úÖ **Documentation**: Comprehensive Claude Code guide in `.claude/CLAUDE.md`\n\n---\n\n## üìà **BENEFITS OVER BUNDLED GUIDE APPROACH**\n\n| Aspect | Bundled CLAUDE.md | Maven Archetype |\n|--------|-------------------|-----------------|\n| **Discoverability** | Manual extraction needed | Standard `mvn archetype:generate` |\n| **Immediate Value** | Documentation only | Complete working project |\n| **Learning Curve** | Must build from scratch | See working examples immediately |\n| **Best Practices** | Described in text | Demonstrated in code |\n| **Configuration** | Manual setup required | All dependencies included |\n| **Testing** | Must write from scratch | Sample tests provided |\n| **Maintenance** | Guide can become outdated | Template validated with each release |\n\n---\n\n## üéØ **IMPLEMENTATION RECOMMENDATION**\n\n### **HYBRID APPROACH: Best of Both Worlds**\n\n1. **Maven Archetype** (Primary): Complete project template with working examples\n2. **Bundled Guide** (Secondary): Include comprehensive CLAUDE.md in core JAR for reference\n\n### **Implementation Steps**\n\n1. ‚úÖ **Create comprehensive guide** (COMPLETED - saved to core module resources)\n2. **Create archetype module** in main MetaObjects project\n3. **Include guide in archetype** as `.claude/CLAUDE.md`\n4. **Add working examples** with User/Order domain\n5. **Test archetype generation** and verify complete functionality\n6. **Publish archetype** to Maven Central with framework releases\n\n### **Developer Experience**\n\n```bash\n# Quick start - get working project immediately\nmvn archetype:generate -DarchetypeGroupId=com.metaobjects \\\n  -DarchetypeArtifactId=archetype\n\n# Claude Code assistance - complete guide available\n# Generated project includes .claude/CLAUDE.md with everything needed\n```\n\n---\n\n## üèÜ **CONCLUSION**\n\n**Maven Archetype is the definitive solution** because it provides:\n\n‚úÖ **Industry Standard**: Follows established Maven project generation patterns\n‚úÖ **Complete Project**: Working application, not just documentation\n‚úÖ **Best Practices**: Demonstrates proper architecture through code\n‚úÖ **Immediate Value**: Builds and runs without additional configuration\n‚úÖ **Claude Integration**: Includes comprehensive CLAUDE.md guide\n‚úÖ **Maintenance**: Template validated with each framework release\n\n**Next Steps:**\n1. Create `archetype` module\n2. Implement template project with working examples\n3. Test archetype generation process\n4. Publish to Maven Central with v6.2.6 release\n\nThis approach will dramatically improve MetaObjects adoption by providing developers with a complete, working project template that demonstrates all framework capabilities.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/METAOBJECTS_ARCHETYPE_DESIGN.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "config",
        "md"
      ],
      "content_hash": "46e4608901b45837",
      "size_bytes": 15190,
      "created_at": "2026-01-02T20:42:12.421488"
    },
    {
      "doc_id": "local_metaobjects-core_core_src_main_resources_META-INF_metaobjects_METAOBJECTS_APPLICATION_GUIDE",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/core/src/main/resources/META-INF/metaobjects/METAOBJECTS_APPLICATION_GUIDE.md",
      "content": "# MetaObjects Application Development Guide\n\n## üöÄ **COMPREHENSIVE GUIDE TO BUILDING METAOBJECTS APPLICATIONS**\n\nThis guide provides everything needed to build a complete application using the MetaObjects framework, from metadata design to database persistence.\n\n### **Framework Version**: 6.2.6+\n### **Architecture**: READ-OPTIMIZED WITH CONTROLLED MUTABILITY\n### **Persistence**: ObjectManagerDB with Modern Identity System\n\n---\n\n## üìã **TABLE OF CONTENTS**\n\n1. [Quick Start Setup](#quick-start-setup)\n2. [Project Structure](#project-structure)\n3. [Metadata Design Patterns](#metadata-design-patterns)\n4. [Identity & Relationship System](#identity--relationship-system)\n5. [Code Generation Setup](#code-generation-setup)\n6. [Database Integration](#database-integration)\n7. [Complete Working Example](#complete-working-example)\n8. [Best Practices](#best-practices)\n9. [Troubleshooting](#troubleshooting)\n\n---\n\n## üèóÔ∏è **QUICK START SETUP**\n\n### **1. Maven Dependencies**\n\n**Core Dependencies (Required):**\n```xml\n<dependencies>\n    <!-- Core MetaObjects Framework -->\n    <dependency>\n        <groupId>com.metaobjects</groupId>\n        <artifactId>metaobjects-core</artifactId>\n        <version>6.2.6</version>\n    </dependency>\n\n    <!-- Database Persistence -->\n    <dependency>\n        <groupId>com.metaobjects</groupId>\n        <artifactId>metaobjects-omdb</artifactId>\n        <version>6.2.6</version>\n    </dependency>\n\n    <!-- Code Generation (Build Time) -->\n    <dependency>\n        <groupId>com.metaobjects</groupId>\n        <artifactId>metaobjects-codegen-mustache</artifactId>\n        <version>6.2.6</version>\n        <scope>provided</scope>\n    </dependency>\n</dependencies>\n```\n\n**Optional Framework Integrations:**\n```xml\n<!-- Spring Integration (if using Spring) -->\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-core-spring</artifactId>\n    <version>6.2.6</version>\n</dependency>\n\n<!-- Web Components (if building web UI) -->\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-web-spring</artifactId>\n    <version>6.2.6</version>\n</dependency>\n```\n\n### **2. Maven Plugin Configuration**\n\n```xml\n<build>\n    <plugins>\n        <!-- MetaObjects Code Generation Plugin -->\n        <plugin>\n            <groupId>com.metaobjects</groupId>\n            <artifactId>metaobjects-maven-plugin</artifactId>\n            <version>6.2.6</version>\n            <executions>\n                <execution>\n                    <id>generate-domain-objects</id>\n                    <phase>generate-sources</phase>\n                    <goals>\n                        <goal>generate</goal>\n                    </goals>\n                    <configuration>\n                        <loader>\n                            <classname>com.metaobjects.loader.file.FileMetaDataLoader</classname>\n                            <name>app-metadata</name>\n                            <sourceURIs>\n                                <sourceURI>classpath:metadata/application-metadata.json</sourceURI>\n                            </sourceURIs>\n                        </loader>\n                        <generators>\n                            <generator>\n                                <classname>com.metaobjects.generator.mustache.java.JavaDomainObjectGenerator</classname>\n                                <args>\n                                    <outputDir>${project.basedir}/src/main/java</outputDir>\n                                    <packageName>com.mycompany.domain</packageName>\n                                </args>\n                            </generator>\n                        </generators>\n                    </configuration>\n                </execution>\n            </executions>\n        </plugin>\n\n        <!-- Add generated sources to compilation -->\n        <plugin>\n            <groupId>org.codehaus.mojo</groupId>\n            <artifactId>build-helper-maven-plugin</artifactId>\n            <version>3.5.0</version>\n            <executions>\n                <execution>\n                    <phase>generate-sources</phase>\n                    <goals>\n                        <goal>add-source</goal>\n                    </goals>\n                    <configuration>\n                        <sources>\n                            <source>${project.basedir}/src/main/java</source>\n                        </sources>\n                    </configuration>\n                </execution>\n            </executions>\n        </plugin>\n    </plugins>\n</build>\n```\n\n---\n\n## üìÅ **PROJECT STRUCTURE**\n\n```\nmy-metaobjects-app/\n‚îú‚îÄ‚îÄ pom.xml\n‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îú‚îÄ‚îÄ main/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ com/mycompany/\n‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ domain/           # Generated domain objects\n‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ service/          # Business logic\n‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ repository/       # Data access\n‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Application.java  # Main application\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/\n‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ metadata/\n‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ application-metadata.json  # Core metadata\n‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ database-overlay.json      # DB-specific attributes\n‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ templates/            # Custom Mustache templates (optional)\n‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ application.properties\n‚îÇ   ‚îî‚îÄ‚îÄ test/\n‚îÇ       ‚îî‚îÄ‚îÄ java/\n‚îî‚îÄ‚îÄ .claude/\n    ‚îî‚îÄ‚îÄ CLAUDE.md                     # This file for Claude Code assistance\n```\n\n---\n\n## üéØ **METADATA DESIGN PATTERNS**\n\n### **Modern JSON Metadata Structure**\n\n**File: `src/main/resources/metadata/application-metadata.json`**\n\n```json\n{\n  \"metadata\": {\n    \"package\": \"com_mycompany_domain\",\n    \"children\": [\n      {\n        \"object\": {\n          \"name\": \"User\",\n          \"subType\": \"managed\",\n          \"description\": \"Application user with authentication\",\n          \"children\": [\n            {\n              \"field\": {\n                \"name\": \"id\",\n                \"subType\": \"long\",\n                \"description\": \"Unique user identifier\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"username\",\n                \"subType\": \"string\",\n                \"@required\": true,\n                \"@maxLength\": 50,\n                \"@pattern\": \"^[a-zA-Z][a-zA-Z0-9_]*$\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"email\",\n                \"subType\": \"string\",\n                \"@required\": true,\n                \"@maxLength\": 255,\n                \"@pattern\": \"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"firstName\",\n                \"subType\": \"string\",\n                \"@maxLength\": 100\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"lastName\",\n                \"subType\": \"string\",\n                \"@maxLength\": 100\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"createdAt\",\n                \"subType\": \"timestamp\",\n                \"@generation\": \"auto\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"isActive\",\n                \"subType\": \"boolean\",\n                \"@defaultValue\": \"true\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"user_pk\",\n                \"subType\": \"primary\",\n                \"fields\": [\"id\"],\n                \"@generation\": \"increment\",\n                \"description\": \"Primary key for User table\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"username_uk\",\n                \"subType\": \"secondary\",\n                \"fields\": [\"username\"],\n                \"description\": \"Unique constraint on username\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"email_uk\",\n                \"subType\": \"secondary\",\n                \"fields\": [\"email\"],\n                \"description\": \"Unique constraint on email\"\n              }\n            }\n          ]\n        }\n      },\n      {\n        \"object\": {\n          \"name\": \"Order\",\n          \"subType\": \"managed\",\n          \"description\": \"Customer order with items\",\n          \"children\": [\n            {\n              \"field\": {\n                \"name\": \"id\",\n                \"subType\": \"long\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"userId\",\n                \"subType\": \"long\",\n                \"@required\": true,\n                \"description\": \"Reference to User who placed order\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"orderNumber\",\n                \"subType\": \"string\",\n                \"@required\": true,\n                \"@maxLength\": 20,\n                \"@pattern\": \"^ORD-[0-9]{10}$\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"orderDate\",\n                \"subType\": \"timestamp\",\n                \"@generation\": \"auto\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"totalAmount\",\n                \"subType\": \"decimal\",\n                \"@precision\": 10,\n                \"@scale\": 2,\n                \"@minValue\": \"0.00\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"status\",\n                \"subType\": \"string\",\n                \"@required\": true,\n                \"@maxLength\": 20,\n                \"@defaultValue\": \"PENDING\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"order_pk\",\n                \"subType\": \"primary\",\n                \"fields\": [\"id\"],\n                \"@generation\": \"increment\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"order_number_uk\",\n                \"subType\": \"secondary\",\n                \"fields\": [\"orderNumber\"]\n              }\n            }\n          ]\n        }\n      },\n      {\n        \"object\": {\n          \"name\": \"OrderItem\",\n          \"subType\": \"managed\",\n          \"description\": \"Individual item within an order\",\n          \"children\": [\n            {\n              \"field\": {\n                \"name\": \"id\",\n                \"subType\": \"long\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"orderId\",\n                \"subType\": \"long\",\n                \"@required\": true\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"productName\",\n                \"subType\": \"string\",\n                \"@required\": true,\n                \"@maxLength\": 200\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"quantity\",\n                \"subType\": \"int\",\n                \"@required\": true,\n                \"@minValue\": 1\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"unitPrice\",\n                \"subType\": \"decimal\",\n                \"@precision\": 10,\n                \"@scale\": 2,\n                \"@minValue\": \"0.00\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"lineTotal\",\n                \"subType\": \"decimal\",\n                \"@precision\": 10,\n                \"@scale\": 2,\n                \"@computed\": \"quantity * unitPrice\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"order_item_pk\",\n                \"subType\": \"primary\",\n                \"fields\": [\"id\"],\n                \"@generation\": \"increment\"\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n```\n\n---\n\n## üîó **IDENTITY & RELATIONSHIP SYSTEM**\n\n### **Modern Identity Architecture**\n\n**MetaObjects uses a sophisticated Identity system (replaces deprecated MetaKey):**\n\n#### **Identity Types**\n\n1. **Primary Identity (`subType: \"primary\"`)**\n   - **ONE per object** - main identifier for database persistence\n   - **Required for ObjectManagerDB** - enables CRUD operations\n   - **Generation strategies**: `increment`, `uuid`, `assigned`\n\n2. **Secondary Identity (`subType: \"secondary\"`)**\n   - **Multiple allowed** - business keys, unique constraints, indexes\n   - **Used for queries** - alternate lookup patterns\n   - **No generation** - typically assigned by application\n\n#### **Identity Generation Strategies**\n\n```json\n{\n  \"identity\": {\n    \"name\": \"user_pk\",\n    \"subType\": \"primary\",\n    \"fields\": [\"id\"],\n    \"@generation\": \"increment\",     // Auto-incrementing integer\n    \"description\": \"Database-generated primary key\"\n  }\n}\n\n{\n  \"identity\": {\n    \"name\": \"session_pk\",\n    \"subType\": \"primary\",\n    \"fields\": [\"sessionId\"],\n    \"@generation\": \"uuid\",          // UUID/GUID generation\n    \"description\": \"UUID-based session identifier\"\n  }\n}\n\n{\n  \"identity\": {\n    \"name\": \"lookup_pk\",\n    \"subType\": \"primary\",\n    \"fields\": [\"code\"],\n    \"@generation\": \"assigned\",      // Application assigns value\n    \"description\": \"Application-controlled identifier\"\n  }\n}\n```\n\n#### **Composite Identities**\n\n```json\n{\n  \"identity\": {\n    \"name\": \"user_role_pk\",\n    \"subType\": \"primary\",\n    \"fields\": [\"userId\", \"roleId\"],  // Multiple fields\n    \"@generation\": \"assigned\",       // Application controlled\n    \"description\": \"Composite primary key for junction table\"\n  }\n}\n```\n\n### **Relationship Patterns**\n\n#### **One-to-Many Relationship**\n\n```json\n{\n  \"object\": {\n    \"name\": \"User\",\n    \"children\": [\n      {\n        \"relationship\": {\n          \"name\": \"orders\",\n          \"subType\": \"reference\",\n          \"description\": \"Orders placed by this user\",\n          \"@targetObject\": \"Order\",\n          \"@cardinality\": \"one-to-many\",\n          \"@sourceIdentity\": \"user_pk\",\n          \"@targetField\": \"userId\"\n        }\n      }\n    ]\n  }\n}\n```\n\n#### **Many-to-One Relationship**\n\n```json\n{\n  \"object\": {\n    \"name\": \"Order\",\n    \"children\": [\n      {\n        \"relationship\": {\n          \"name\": \"user\",\n          \"subType\": \"reference\",\n          \"description\": \"User who placed this order\",\n          \"@targetObject\": \"User\",\n          \"@cardinality\": \"many-to-one\",\n          \"@sourceField\": \"userId\",\n          \"@targetIdentity\": \"user_pk\"\n        }\n      }\n    ]\n  }\n}\n```\n\n#### **One-to-Many with Cascade**\n\n```json\n{\n  \"object\": {\n    \"name\": \"Order\",\n    \"children\": [\n      {\n        \"relationship\": {\n          \"name\": \"orderItems\",\n          \"subType\": \"reference\",\n          \"description\": \"Items in this order\",\n          \"@targetObject\": \"OrderItem\",\n          \"@cardinality\": \"one-to-many\",\n          \"@sourceIdentity\": \"order_pk\",\n          \"@targetField\": \"orderId\",\n          \"@cascade\": \"delete\"\n        }\n      }\n    ]\n  }\n}\n```\n\n---\n\n## ‚öôÔ∏è **CODE GENERATION SETUP**\n\n### **Mustache Template Configuration**\n\n**Built-in Templates**: MetaObjects includes production-ready Mustache templates for:\n- **Java Domain Objects** with JPA annotations\n- **Spring Repository interfaces**\n- **REST Controllers** with CRUD operations\n- **TypeScript interfaces** for frontend\n- **Database DDL scripts**\n\n#### **Custom Template Override (Optional)**\n\n**File: `src/main/resources/templates/java-domain-object.mustache`**\n\n```mustache\npackage {{packageName}};\n\nimport javax.persistence.*;\nimport javax.validation.constraints.*;\nimport java.time.LocalDateTime;\nimport java.math.BigDecimal;\nimport java.util.List;\nimport java.util.Objects;\n\n/**\n * {{description}}\n * Generated by MetaObjects v6.2.6\n */\n@Entity\n@Table(name = \"{{dbTable}}\")\npublic class {{name}} {\n\n    {{#fields}}\n    {{#isIdField}}\n    @Id\n    {{#hasGeneration}}\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    {{/hasGeneration}}\n    {{/isIdField}}\n    @Column(name = \"{{dbColumn}}\"{{#hasMaxLength}}, length = {{maxLength}}{{/hasMaxLength}}{{#isRequired}}, nullable = false{{/isRequired}})\n    {{#hasValidation}}\n    {{#isRequired}}\n    @NotNull\n    {{/isRequired}}\n    {{#hasMaxLength}}\n    @Size(max = {{maxLength}})\n    {{/hasMaxLength}}\n    {{#hasPattern}}\n    @Pattern(regexp = \"{{pattern}}\")\n    {{/hasPattern}}\n    {{/hasValidation}}\n    private {{javaType}} {{name}};\n\n    {{/fields}}\n\n    // Constructors\n    public {{name}}() {}\n\n    {{#fields}}\n    // {{description}}\n    public {{javaType}} get{{capitalizedName}}() {\n        return {{name}};\n    }\n\n    public void set{{capitalizedName}}({{javaType}} {{name}}) {\n        this.{{name}} = {{name}};\n    }\n\n    {{/fields}}\n\n    // equals and hashCode based on identity\n    @Override\n    public boolean equals(Object obj) {\n        if (this == obj) return true;\n        if (obj == null || getClass() != obj.getClass()) return false;\n        {{name}} that = ({{name}}) obj;\n        return Objects.equals({{primaryKeyField}}, that.{{primaryKeyField}});\n    }\n\n    @Override\n    public int hashCode() {\n        return Objects.hash({{primaryKeyField}});\n    }\n\n    @Override\n    public String toString() {\n        return \"{{name}}{\" +\n            {{#fields}}\n            \"{{name}}=\" + {{name}} +\n            {{/fields}}\n            '}';\n    }\n}\n```\n\n### **Generation Execution**\n\n```bash\n# Generate domain objects\nmvn metaobjects:generate\n\n# Or integrate with build process\nmvn clean compile\n```\n\n---\n\n## üóÑÔ∏è **DATABASE INTEGRATION**\n\n### **Database Overlay Configuration**\n\n**File: `src/main/resources/metadata/database-overlay.json`**\n\n```json\n{\n  \"metadata\": {\n    \"package\": \"com_mycompany_domain\",\n    \"children\": [\n      {\n        \"object\": {\n          \"name\": \"User\",\n          \"@dbTable\": \"users\",\n          \"children\": [\n            {\n              \"field\": {\n                \"name\": \"id\",\n                \"@dbColumn\": \"user_id\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"username\",\n                \"@dbColumn\": \"username\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"email\",\n                \"@dbColumn\": \"email_address\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"firstName\",\n                \"@dbColumn\": \"first_name\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"lastName\",\n                \"@dbColumn\": \"last_name\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"createdAt\",\n                \"@dbColumn\": \"created_at\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"isActive\",\n                \"@dbColumn\": \"is_active\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"user_pk\",\n                \"@dbIndexName\": \"pk_users\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"username_uk\",\n                \"@dbIndexName\": \"uk_users_username\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"email_uk\",\n                \"@dbIndexName\": \"uk_users_email\"\n              }\n            }\n          ]\n        }\n      },\n      {\n        \"object\": {\n          \"name\": \"Order\",\n          \"@dbTable\": \"orders\",\n          \"children\": [\n            {\n              \"field\": {\n                \"name\": \"id\",\n                \"@dbColumn\": \"order_id\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"userId\",\n                \"@dbColumn\": \"user_id\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"orderNumber\",\n                \"@dbColumn\": \"order_number\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"orderDate\",\n                \"@dbColumn\": \"order_date\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"totalAmount\",\n                \"@dbColumn\": \"total_amount\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"status\",\n                \"@dbColumn\": \"order_status\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"order_pk\",\n                \"@dbIndexName\": \"pk_orders\"\n              }\n            },\n            {\n              \"identity\": {\n                \"name\": \"order_number_uk\",\n                \"@dbIndexName\": \"uk_orders_number\"\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n```\n\n### **ObjectManagerDB Configuration**\n\n#### **Application Setup**\n\n```java\npackage com.mycompany.config;\n\nimport com.metaobjects.manager.db.ObjectManagerDB;\nimport com.metaobjects.manager.db.driver.*;\nimport com.metaobjects.manager.db.validator.MetaClassDBValidatorService;\nimport com.metaobjects.loader.file.FileMetaDataLoader;\nimport com.metaobjects.registry.MetaDataLoaderRegistry;\nimport com.metaobjects.registry.ServiceRegistryFactory;\n\nimport javax.sql.DataSource;\nimport org.apache.derby.jdbc.EmbeddedDataSource; // or your preferred database\n\n@Configuration\npublic class MetaObjectsConfiguration {\n\n    @Bean\n    public FileMetaDataLoader metaDataLoader() throws Exception {\n        FileMetaDataLoader loader = new FileMetaDataLoader(\"app-metadata\");\n\n        // Load core application metadata\n        loader.addSourceURI(getClass().getResource(\"/metadata/application-metadata.json\").toURI());\n\n        // Load database overlay\n        loader.addSourceURI(getClass().getResource(\"/metadata/database-overlay.json\").toURI());\n\n        loader.init();\n        return loader;\n    }\n\n    @Bean\n    public DataSource dataSource() {\n        // Example with Derby - replace with your database\n        EmbeddedDataSource dataSource = new EmbeddedDataSource();\n        dataSource.setDatabaseName(\"myapp\");\n        dataSource.setCreateDatabase(\"create\");\n        return dataSource;\n    }\n\n    @Bean\n    public ObjectManagerDB objectManagerDB(DataSource dataSource) {\n        ObjectManagerDB objectManager = new ObjectManagerDB();\n\n        // Configure database driver (Derby example)\n        objectManager.setDriverClass(\"com.metaobjects.manager.db.driver.DerbyDriver\");\n        objectManager.setDataSource(dataSource);\n\n        return objectManager;\n    }\n\n    @Bean\n    public MetaClassDBValidatorService dbValidator(\n            ObjectManagerDB objectManagerDB,\n            FileMetaDataLoader metaDataLoader) {\n\n        MetaClassDBValidatorService validator = new MetaClassDBValidatorService();\n        validator.setObjectManager(objectManagerDB);\n        validator.setAutoCreate(true); // Automatically create missing tables\n\n        // Connect to metadata loader\n        MetaDataLoaderRegistry registry = new MetaDataLoaderRegistry(ServiceRegistryFactory.getDefault());\n        registry.registerLoader(metaDataLoader);\n        validator.setMetaDataLoaderRegistry(registry);\n\n        return validator;\n    }\n}\n```\n\n#### **Service Layer with ObjectManagerDB**\n\n```java\npackage com.mycompany.service;\n\nimport com.metaobjects.manager.db.ObjectManagerDB;\nimport com.metaobjects.manager.ObjectConnection;\nimport com.metaobjects.object.ValueMetaObject;\nimport com.metaobjects.MetaObject;\nimport com.metaobjects.util.MetaDataUtil;\n\n@Service\n@Transactional\npublic class UserService {\n\n    private final ObjectManagerDB objectManager;\n    private final MetaObject userMetaObject;\n\n    public UserService(ObjectManagerDB objectManager) throws Exception {\n        this.objectManager = objectManager;\n        this.userMetaObject = MetaDataUtil.findMetaObjectByName(\"User\", this);\n    }\n\n    public ValueMetaObject createUser(String username, String email, String firstName, String lastName)\n            throws Exception {\n\n        try (ObjectConnection connection = objectManager.getConnection()) {\n            // Create new user object\n            ValueMetaObject user = new ValueMetaObject(userMetaObject);\n\n            // Set field values\n            user.setString(\"username\", username);\n            user.setString(\"email\", email);\n            user.setString(\"firstName\", firstName);\n            user.setString(\"lastName\", lastName);\n            user.setBoolean(\"isActive\", true);\n            user.setTimestamp(\"createdAt\", LocalDateTime.now());\n\n            // Persist to database (ID auto-generated)\n            objectManager.createObject(connection, user);\n\n            return user;\n        }\n    }\n\n    public ValueMetaObject findUserById(Long userId) throws Exception {\n        try (ObjectConnection connection = objectManager.getConnection()) {\n            ValueMetaObject user = new ValueMetaObject(userMetaObject);\n            user.setLong(\"id\", userId);\n\n            return objectManager.loadObject(connection, user);\n        }\n    }\n\n    public ValueMetaObject findUserByUsername(String username) throws Exception {\n        try (ObjectConnection connection = objectManager.getConnection()) {\n            // Use secondary identity for lookup\n            ValueMetaObject user = new ValueMetaObject(userMetaObject);\n            user.setString(\"username\", username);\n\n            return objectManager.loadObject(connection, user, \"username_uk\");\n        }\n    }\n\n    public List<ValueMetaObject> findActiveUsers() throws Exception {\n        try (ObjectConnection connection = objectManager.getConnection()) {\n            String whereClause = \"is_active = ?\";\n            Object[] parameters = {true};\n\n            return objectManager.loadObjects(connection, userMetaObject, whereClause, parameters);\n        }\n    }\n\n    public void updateUser(ValueMetaObject user) throws Exception {\n        try (ObjectConnection connection = objectManager.getConnection()) {\n            objectManager.updateObject(connection, user);\n        }\n    }\n\n    public void deleteUser(Long userId) throws Exception {\n        try (ObjectConnection connection = objectManager.getConnection()) {\n            ValueMetaObject user = new ValueMetaObject(userMetaObject);\n            user.setLong(\"id\", userId);\n\n            objectManager.deleteObject(connection, user);\n        }\n    }\n}\n```\n\n#### **Relationship Handling**\n\n```java\n@Service\n@Transactional\npublic class OrderService {\n\n    private final ObjectManagerDB objectManager;\n    private final MetaObject orderMetaObject;\n    private final MetaObject orderItemMetaObject;\n\n    public OrderService(ObjectManagerDB objectManager) throws Exception {\n        this.objectManager = objectManager;\n        this.orderMetaObject = MetaDataUtil.findMetaObjectByName(\"Order\", this);\n        this.orderItemMetaObject = MetaDataUtil.findMetaObjectByName(\"OrderItem\", this);\n    }\n\n    @Transactional\n    public ValueMetaObject createOrderWithItems(Long userId, String orderNumber,\n            List<OrderItemData> items) throws Exception {\n\n        try (ObjectConnection connection = objectManager.getConnection()) {\n            // Create order\n            ValueMetaObject order = new ValueMetaObject(orderMetaObject);\n            order.setLong(\"userId\", userId);\n            order.setString(\"orderNumber\", orderNumber);\n            order.setTimestamp(\"orderDate\", LocalDateTime.now());\n            order.setString(\"status\", \"PENDING\");\n\n            // Calculate total\n            BigDecimal total = items.stream()\n                .map(item -> item.getUnitPrice().multiply(new BigDecimal(item.getQuantity())))\n                .reduce(BigDecimal.ZERO, BigDecimal::add);\n            order.setDecimal(\"totalAmount\", total);\n\n            // Save order (gets auto-generated ID)\n            objectManager.createObject(connection, order);\n            Long orderId = order.getLong(\"id\");\n\n            // Create order items\n            for (OrderItemData itemData : items) {\n                ValueMetaObject orderItem = new ValueMetaObject(orderItemMetaObject);\n                orderItem.setLong(\"orderId\", orderId);\n                orderItem.setString(\"productName\", itemData.getProductName());\n                orderItem.setInt(\"quantity\", itemData.getQuantity());\n                orderItem.setDecimal(\"unitPrice\", itemData.getUnitPrice());\n                orderItem.setDecimal(\"lineTotal\",\n                    itemData.getUnitPrice().multiply(new BigDecimal(itemData.getQuantity())));\n\n                objectManager.createObject(connection, orderItem);\n            }\n\n            return order;\n        }\n    }\n\n    public List<ValueMetaObject> findOrdersForUser(Long userId) throws Exception {\n        try (ObjectConnection connection = objectManager.getConnection()) {\n            String whereClause = \"user_id = ? ORDER BY order_date DESC\";\n            Object[] parameters = {userId};\n\n            return objectManager.loadObjects(connection, orderMetaObject, whereClause, parameters);\n        }\n    }\n\n    public List<ValueMetaObject> findOrderItemsForOrder(Long orderId) throws Exception {\n        try (ObjectConnection connection = objectManager.getConnection()) {\n            String whereClause = \"order_id = ?\";\n            Object[] parameters = {orderId};\n\n            return objectManager.loadObjects(connection, orderItemMetaObject, whereClause, parameters);\n        }\n    }\n}\n```\n\n---\n\n## üíº **COMPLETE WORKING EXAMPLE**\n\n### **Main Application Class**\n\n```java\npackage com.mycompany;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.transaction.annotation.EnableTransactionManagement;\n\n@SpringBootApplication\n@EnableTransactionManagement\npublic class MyMetaObjectsApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(MyMetaObjectsApplication.class, args);\n    }\n}\n```\n\n### **REST Controller Example**\n\n```java\npackage com.mycompany.controller;\n\nimport com.mycompany.service.UserService;\nimport com.metaobjects.object.ValueMetaObject;\nimport org.springframework.web.bind.annotation.*;\nimport java.util.List;\n\n@RestController\n@RequestMapping(\"/api/users\")\npublic class UserController {\n\n    private final UserService userService;\n\n    public UserController(UserService userService) {\n        this.userService = userService;\n    }\n\n    @PostMapping\n    public ValueMetaObject createUser(@RequestBody CreateUserRequest request) throws Exception {\n        return userService.createUser(\n            request.getUsername(),\n            request.getEmail(),\n            request.getFirstName(),\n            request.getLastName()\n        );\n    }\n\n    @GetMapping(\"/{id}\")\n    public ValueMetaObject getUser(@PathVariable Long id) throws Exception {\n        return userService.findUserById(id);\n    }\n\n    @GetMapping\n    public List<ValueMetaObject> getActiveUsers() throws Exception {\n        return userService.findActiveUsers();\n    }\n\n    @PutMapping(\"/{id}\")\n    public ValueMetaObject updateUser(@PathVariable Long id, @RequestBody UpdateUserRequest request)\n            throws Exception {\n        ValueMetaObject user = userService.findUserById(id);\n\n        if (request.getFirstName() != null) {\n            user.setString(\"firstName\", request.getFirstName());\n        }\n        if (request.getLastName() != null) {\n            user.setString(\"lastName\", request.getLastName());\n        }\n        if (request.getEmail() != null) {\n            user.setString(\"email\", request.getEmail());\n        }\n\n        userService.updateUser(user);\n        return user;\n    }\n\n    @DeleteMapping(\"/{id}\")\n    public void deleteUser(@PathVariable Long id) throws Exception {\n        userService.deleteUser(id);\n    }\n}\n```\n\n### **Application Properties**\n\n```properties\n# Database Configuration (H2 Example)\nspring.datasource.url=jdbc:h2:mem:metaobjects-app\nspring.datasource.driver-class-name=org.h2.Driver\nspring.datasource.username=sa\nspring.datasource.password=password\n\n# H2 Console (Development)\nspring.h2.console.enabled=true\nspring.h2.console.path=/h2-console\n\n# MetaObjects Configuration\nmetaobjects.auto-create-tables=true\nmetaobjects.validate-schema=true\n\n# Logging\nlogging.level.com.metaobjects=DEBUG\nlogging.level.com.mycompany=DEBUG\n```\n\n---\n\n## üèÜ **BEST PRACTICES**\n\n### **1. Metadata Organization**\n\n‚úÖ **DO:**\n- Use meaningful package names (`com_mycompany_domain`)\n- Separate core metadata from database-specific overlays\n- Include comprehensive descriptions for all objects and fields\n- Use consistent naming conventions\n\n‚ùå **DON'T:**\n- Mix application logic with metadata definitions\n- Use spaces or special characters in metadata names\n- Create overly complex inheritance hierarchies\n\n### **2. Identity Design**\n\n‚úÖ **DO:**\n- Always include one primary identity per managed object\n- Use `increment` generation for most primary keys\n- Create secondary identities for business keys and unique constraints\n- Use descriptive identity names (`user_pk`, `email_uk`)\n\n‚ùå **DON'T:**\n- Create objects without primary identities\n- Use composite primary keys unless absolutely necessary\n- Forget to specify generation strategies\n\n### **3. Field Design**\n\n‚úÖ **DO:**\n- Use appropriate field types (`decimal` for money, `timestamp` for dates)\n- Include validation constraints (`@required`, `@maxLength`, `@pattern`)\n- Provide default values where appropriate\n- Use meaningful field names\n\n‚ùå **DON'T:**\n- Use `string` for everything\n- Skip validation constraints\n- Use overly long field names\n\n### **4. Database Integration**\n\n‚úÖ **DO:**\n- Use database overlays for DB-specific attributes\n- Enable auto-table creation in development\n- Use connection pooling in production\n- Implement proper transaction boundaries\n\n‚ùå **DON'T:**\n- Put database attributes in core metadata\n- Skip database validation setup\n- Ignore connection lifecycle management\n\n### **5. Code Generation**\n\n‚úÖ **DO:**\n- Keep generated code in version control\n- Customize templates for your coding standards\n- Regenerate after metadata changes\n- Use build automation\n\n‚ùå **DON'T:**\n- Manually edit generated code\n- Skip regeneration after metadata updates\n- Mix generated and hand-written code in same files\n\n### **6. Performance Optimization**\n\n‚úÖ **DO:**\n- Cache MetaDataLoader instances (they're heavy to create)\n- Use connection pooling for database access\n- Batch operations when possible\n- Monitor query performance\n\n‚ùå **DON'T:**\n- Create new MetaDataLoader instances frequently\n- Ignore connection leaks\n- Perform N+1 queries\n\n---\n\n## üîß **TROUBLESHOOTING**\n\n### **Common Issues & Solutions**\n\n#### **1. \"MetaData not found\" Errors**\n```\nCaused by: MetaDataNotFoundException: No MetaObject found with name 'User'\n```\n\n**Solution:**\n- Verify metadata file is in classpath (`src/main/resources/metadata/`)\n- Check package name matches (`com_mycompany_domain::User`)\n- Ensure FileMetaDataLoader is properly configured and initialized\n\n#### **2. \"Non-resolvable parent POM\" During Build**\n```\nNon-resolvable parent POM for com.metaobjects:metaobjects-examples:6.2.6-SNAPSHOT\n```\n\n**Solution:**\n- Add `<relativePath>../pom.xml</relativePath>` to parent POM references\n- Verify MetaObjects version matches across all dependencies\n\n#### **3. Identity Generation Issues**\n```\nSQLException: Attempt to modify an identity column 'ID'\n```\n\n**Solution:**\n- Ensure primary identity has `@generation` attribute\n- Use `increment` for auto-generated database IDs\n- Don't manually set ID values for auto-generated fields\n\n#### **4. Database Connection Issues**\n```\nUnable to find database driver for: com.metaobjects.manager.db.driver.H2Driver\n```\n\n**Solution:**\n- Add database driver dependency to Maven\n- Verify driver class name matches your database\n- Check database URL and credentials\n\n#### **5. Code Generation Template Issues**\n```\nUnable to resolve template: java-domain-object.mustache\n```\n\n**Solution:**\n- Verify template exists in `src/main/resources/templates/`\n- Check template name in generator configuration\n- Use built-in templates first, then customize\n\n### **Debug Configuration**\n\n```properties\n# Enable detailed MetaObjects logging\nlogging.level.com.metaobjects=DEBUG\nlogging.level.com.metaobjects.loader=TRACE\nlogging.level.com.metaobjects.manager=TRACE\n\n# SQL logging for database debugging\nlogging.level.org.hibernate.SQL=DEBUG\nlogging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE\n```\n\n---\n\n## üìö **ADDITIONAL RESOURCES**\n\n### **Framework Documentation**\n- **Official Docs**: https://docs.metaobjects.com\n- **GitHub Repository**: https://github.com/metaobjectsdev/metaobjects-core\n- **Maven Central**: https://central.sonatype.com/artifact/com.metaobjects/metaobjects-core\n\n### **Community Examples**\n- **Sample Applications**: https://github.com/metaobjectsdev/metaobjects-examples\n- **Tutorial Videos**: https://youtube.com/metaobjects\n- **Community Forum**: https://discuss.metaobjects.com\n\n### **Migration Guides**\n- **v5.x ‚Üí v6.x Migration**: See `MIGRATION.md` in project root\n- **MetaKey ‚Üí MetaIdentity**: See architecture documentation\n\n---\n\n## ü§ù **GETTING HELP**\n\n### **Claude Code Integration**\nThis guide is optimized for Claude Code assistance. When asking Claude for help:\n\n‚úÖ **Include context**: \"I'm building a MetaObjects application...\"\n‚úÖ **Reference this guide**: \"Following the MetaObjects application guide...\"\n‚úÖ **Be specific**: \"My metadata defines User object with primary identity...\"\n‚úÖ **Share relevant files**: Include metadata JSON and configuration\n\n### **Support Channels**\n- **GitHub Issues**: Bug reports and feature requests\n- **Discussion Forum**: Architecture questions and best practices\n- **Commercial Support**: Enterprise consulting available\n\n---\n\n**This guide covers the complete MetaObjects application development lifecycle. Follow the patterns and examples provided for production-ready applications with proper metadata design, code generation, and database persistence.**\n\n---\n\n## üìã **METADATA REFERENCE QUICK CARD**\n\n### **Core Field Types**\n- `string` - Text data with length/pattern validation\n- `int` - Integer numbers (-2B to +2B range)\n- `long` - Long integers (large range)\n- `decimal` - High precision numbers (financial)\n- `double` - Floating point numbers\n- `boolean` - True/false values\n- `timestamp` - Date and time\n- `date` - Date only\n- `time` - Time only\n\n### **Identity Patterns**\n```json\n{\"identity\": {\"name\": \"pk\", \"subType\": \"primary\", \"fields\": [\"id\"], \"@generation\": \"increment\"}}\n{\"identity\": {\"name\": \"uk\", \"subType\": \"secondary\", \"fields\": [\"code\"]}}\n```\n\n### **Relationship Patterns**\n```json\n{\"relationship\": {\"name\": \"items\", \"subType\": \"reference\", \"@targetObject\": \"Item\", \"@cardinality\": \"one-to-many\"}}\n```\n\n### **Validation Attributes**\n- `@required` - Field cannot be null/empty\n- `@maxLength` - Maximum string length\n- `@minLength` - Minimum string length\n- `@pattern` - Regular expression validation\n- `@minValue` - Minimum numeric value\n- `@maxValue` - Maximum numeric value\n- `@defaultValue` - Default field value\n\n### **Database Attributes**\n- `@dbTable` - Database table name\n- `@dbColumn` - Database column name\n- `@dbIndexName` - Database index name\n- `@generation` - ID generation strategy\n\n---\n\n**üöÄ Ready to build amazing applications with MetaObjects! üöÄ**",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/core/src/main/resources/META-INF/metaobjects/METAOBJECTS_APPLICATION_GUIDE.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "md"
      ],
      "content_hash": "250877dd054d3089",
      "size_bytes": 39113,
      "created_at": "2026-01-02T20:42:12.422954"
    },
    {
      "doc_id": "local_metaobjects-core_core-spring_README",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/core-spring/README.md",
      "content": "# MetaObjects Spring Integration\n\nThis module provides comprehensive Spring Framework integration for MetaObjects, including auto-configuration, dependency injection, and Spring Boot support.\n\n## üöÄ **Quick Start**\n\n### **Add Dependency**\n```xml\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-core-spring</artifactId>\n    <version>6.3.1-SNAPSHOT</version>\n</dependency>\n```\n*Note: Automatically includes `metaobjects-core`*\n\n### **Spring Boot Auto-Configuration**\nAdd to your `application.properties`:\n```properties\n# Optional: Configure MetaObjects (defaults shown)\nmetaobjects.auto-configuration.enabled=true\nmetaobjects.loader.name=primaryLoader\nmetaobjects.loader.sources=classpath:metadata/\n```\n\n### **Basic Usage**\n```java\n@RestController\npublic class MetaDataController {\n    \n    @Autowired\n    private MetaDataService metaDataService;\n    \n    @GetMapping(\"/metadata/{objectName}\")\n    public ResponseEntity<List<String>> getFieldNames(@PathVariable String objectName) {\n        Optional<MetaObject> metaObject = metaDataService.findMetaObjectByNameOptional(objectName);\n        \n        if (metaObject.isPresent()) {\n            List<String> fieldNames = metaObject.get().getMetaFields().stream()\n                .map(MetaField::getName)\n                .collect(Collectors.toList());\n            return ResponseEntity.ok(fieldNames);\n        }\n        \n        return ResponseEntity.notFound().build();\n    }\n}\n```\n\n## üéØ **Integration Options**\n\n### **Option 1: MetaDataService (Recommended)**\nHigh-level service wrapper with convenience methods:\n```java\n@Component\npublic class UserService {\n    \n    @Autowired\n    private MetaDataService metaDataService;\n    \n    public boolean validateUser(String userData) {\n        // Optional-based null-safe access\n        Optional<MetaObject> userMeta = metaDataService.findMetaObjectByNameOptional(\"User\");\n        \n        if (userMeta.isPresent()) {\n            // Check if specific objects exist\n            boolean hasRequiredFields = metaDataService.metaObjectExists(\"User\");\n            \n            // Get all available MetaObjects\n            List<MetaObject> allObjects = metaDataService.getAllMetaObjects();\n            \n            return true;\n        }\n        \n        return false;\n    }\n}\n```\n\n### **Option 2: Direct MetaDataLoader (Backward Compatible)**\nDirect access to MetaDataLoader instances:\n```java\n@Service\npublic class MetaDataProcessor {\n    \n    @Autowired\n    private MetaDataLoader primaryMetaDataLoader;\n    \n    public void processMetadata() {\n        // Traditional MetaDataLoader API\n        MetaObject userMeta = primaryMetaDataLoader.getMetaObjectByName(\"User\");\n        List<MetaField> fields = userMeta.getMetaFields();\n        \n        // Process fields...\n    }\n}\n```\n\n### **Option 3: Full Registry Access (Advanced)**\nComplete registry control for complex scenarios:\n```java\n@Configuration\npublic class MetaDataConfiguration {\n    \n    @Autowired\n    private MetaDataLoaderRegistry metaDataLoaderRegistry;\n    \n    @Bean\n    public CustomMetaDataProcessor customProcessor() {\n        // Advanced registry operations\n        for (MetaDataLoader loader : metaDataLoaderRegistry.getDataLoaders()) {\n            // Process each registered loader\n        }\n        \n        return new CustomMetaDataProcessor();\n    }\n}\n```\n\n## ‚öôÔ∏è **Auto-Configuration Features**\n\n### **MetaDataAutoConfiguration**\nAutomatically configures:\n- **MetaDataService**: High-level service wrapper\n- **MetaDataLoaderRegistry**: Registry for multiple loaders\n- **Primary MetaDataLoader**: Default loader for backward compatibility\n\n### **Conditional Configuration**\n```java\n@ConditionalOnProperty(name = \"metaobjects.auto-configuration.enabled\", havingValue = \"true\", matchIfMissing = true)\n@Configuration\npublic class MetaDataAutoConfiguration {\n    // Auto-configuration implementation\n}\n```\n\n### **Custom Loader Configuration**\n```java\n@Configuration\npublic class CustomMetaDataConfiguration {\n    \n    @Bean\n    @Primary\n    public MetaDataLoader customMetaDataLoader() throws Exception {\n        SimpleLoader loader = new SimpleLoader(\"custom\");\n        loader.setSourceURIs(Arrays.asList(\n            URI.create(\"classpath:metadata/custom-metadata.json\")\n        ));\n        loader.init();\n        return loader;\n    }\n}\n```\n\n## üîß **Configuration Properties**\n\n### **Application Properties**\n```properties\n# Enable/disable auto-configuration\nmetaobjects.auto-configuration.enabled=true\n\n# Primary loader configuration\nmetaobjects.loader.name=primaryLoader\nmetaobjects.loader.sources=classpath:metadata/\n\n# Registry settings\nmetaobjects.registry.auto-discovery=true\n```\n\n### **YAML Configuration**\n```yaml\nmetaobjects:\n  auto-configuration:\n    enabled: true\n  loader:\n    name: primaryLoader\n    sources:\n      - classpath:metadata/user-metadata.json\n      - classpath:metadata/product-metadata.json\n  registry:\n    auto-discovery: true\n```\n\n## üß™ **Testing Integration**\n\n### **Test Configuration**\n```java\n@TestConfiguration\npublic class TestMetaDataConfiguration {\n    \n    @Bean\n    @Primary\n    public MetaDataLoader testMetaDataLoader() throws Exception {\n        SimpleLoader loader = new SimpleLoader(\"test\");\n        loader.setSourceURIs(Arrays.asList(\n            URI.create(\"classpath:test-metadata/test-objects.json\")\n        ));\n        loader.init();\n        return loader;\n    }\n}\n```\n\n### **Integration Tests**\n```java\n@SpringBootTest\nclass MetaDataServiceIntegrationTest {\n    \n    @Autowired\n    private MetaDataService metaDataService;\n    \n    @Test\n    void testMetaObjectDiscovery() {\n        List<MetaObject> allObjects = metaDataService.getAllMetaObjects();\n        assertThat(allObjects).isNotEmpty();\n        \n        Optional<MetaObject> userMeta = metaDataService.findMetaObjectByNameOptional(\"User\");\n        assertThat(userMeta).isPresent();\n        \n        boolean hasUser = metaDataService.metaObjectExists(\"User\");\n        assertThat(hasUser).isTrue();\n    }\n}\n```\n\n### **Mock Testing**\n```java\n@ExtendWith(MockitoExtension.class)\nclass UserServiceTest {\n    \n    @Mock\n    private MetaDataService metaDataService;\n    \n    @InjectMocks\n    private UserService userService;\n    \n    @Test\n    void testUserValidation() {\n        MetaObject userMeta = mock(MetaObject.class);\n        when(metaDataService.findMetaObjectByNameOptional(\"User\"))\n            .thenReturn(Optional.of(userMeta));\n        \n        boolean result = userService.validateUser(\"test data\");\n        assertThat(result).isTrue();\n    }\n}\n```\n\n## üåê **Web Integration**\n\n### **REST Controllers**\n```java\n@RestController\n@RequestMapping(\"/api/metadata\")\npublic class MetaDataApiController {\n    \n    @Autowired\n    private MetaDataService metaDataService;\n    \n    @GetMapping(\"/objects\")\n    public ResponseEntity<List<String>> getAllObjectNames() {\n        List<String> objectNames = metaDataService.getAllMetaObjects().stream()\n            .map(MetaObject::getName)\n            .collect(Collectors.toList());\n        return ResponseEntity.ok(objectNames);\n    }\n    \n    @GetMapping(\"/objects/{objectName}\")\n    public ResponseEntity<MetaObjectDto> getMetaObject(@PathVariable String objectName) {\n        Optional<MetaObject> metaObject = metaDataService.findMetaObjectByNameOptional(objectName);\n        \n        return metaObject\n            .map(obj -> ResponseEntity.ok(convertToDto(obj)))\n            .orElse(ResponseEntity.notFound().build());\n    }\n    \n    @GetMapping(\"/objects/{objectName}/fields\")\n    public ResponseEntity<List<FieldDto>> getFields(@PathVariable String objectName) {\n        return metaDataService.findMetaObjectByNameOptional(objectName)\n            .map(obj -> {\n                List<FieldDto> fields = obj.getMetaFields().stream()\n                    .map(this::convertFieldToDto)\n                    .collect(Collectors.toList());\n                return ResponseEntity.ok(fields);\n            })\n            .orElse(ResponseEntity.notFound().build());\n    }\n}\n```\n\n### **Data Transfer Objects**\n```java\npublic class MetaObjectDto {\n    private String name;\n    private String packageName;\n    private List<FieldDto> fields;\n    // getters, setters, constructors\n}\n\npublic class FieldDto {\n    private String name;\n    private String type;\n    private Map<String, String> attributes;\n    // getters, setters, constructors\n}\n```\n\n## üîÑ **Advanced Patterns**\n\n### **Custom Service Implementations**\n```java\n@Service\npublic class CustomMetaDataService {\n    \n    @Autowired\n    private MetaDataLoaderRegistry registry;\n    \n    public Stream<MetaObject> getAllMetaObjectsStream() {\n        return registry.getDataLoaders().stream()\n            .flatMap(loader -> loader.getChildren(MetaObject.class).stream());\n    }\n    \n    public Map<String, MetaObject> getMetaObjectsByPackage(String packageName) {\n        return getAllMetaObjectsStream()\n            .filter(obj -> packageName.equals(obj.getPackage()))\n            .collect(Collectors.toMap(MetaObject::getName, Function.identity()));\n    }\n}\n```\n\n### **Event-Driven Updates**\n```java\n@Component\npublic class MetaDataEventHandler {\n    \n    @EventListener\n    public void handleMetaDataUpdate(MetaDataUpdateEvent event) {\n        // Handle metadata changes\n        MetaObject updatedObject = event.getMetaObject();\n        // Refresh caches, notify subscribers, etc.\n    }\n}\n```\n\n### **Caching Integration**\n```java\n@Service\npublic class CachedMetaDataService {\n    \n    @Autowired\n    private MetaDataService metaDataService;\n    \n    @Cacheable(\"metaObjects\")\n    public Optional<MetaObject> findMetaObjectByNameCached(String name) {\n        return metaDataService.findMetaObjectByNameOptional(name);\n    }\n    \n    @CacheEvict(value = \"metaObjects\", allEntries = true)\n    public void clearCache() {\n        // Clear all cached metadata\n    }\n}\n```\n\n## üîç **Troubleshooting**\n\n### **Common Issues**\n\n#### **Auto-Configuration Not Working**\n1. Ensure `metaobjects-core-spring` is on classpath\n2. Check `application.properties` for correct configuration\n3. Verify Spring Boot version compatibility\n\n#### **MetaDataService Bean Not Found**\n```java\n// Add explicit configuration if auto-configuration fails\n@Configuration\n@EnableAutoConfiguration\npublic class MetaDataConfiguration {\n    // Configuration beans\n}\n```\n\n#### **Multiple Loader Conflicts**\n```java\n// Use @Primary to designate default loader\n@Bean\n@Primary\npublic MetaDataLoader primaryLoader() {\n    // Primary loader implementation\n}\n```\n\n### **Debug Information**\nEnable debug logging:\n```properties\nlogging.level.com.metaobjects.spring=DEBUG\nlogging.level.com.metaobjects.registry=DEBUG\n```\n\n## üìä **Performance Considerations**\n\n### **Lazy Loading**\n```java\n// MetaDataService uses lazy initialization\n@Autowired\nprivate MetaDataService metaDataService; // Fast injection\n\n// Actual metadata loading happens on first access\nOptional<MetaObject> user = metaDataService.findMetaObjectByNameOptional(\"User\"); // Triggers loading\n```\n\n### **Registry Caching**\n- MetaDataLoaderRegistry caches loader discovery\n- MetaObject lookups are cached after first access\n- Thread-safe for concurrent access\n\n### **Memory Management**\n- Uses WeakHashMap patterns for OSGi compatibility\n- Automatic cleanup when Spring context shuts down\n- Minimal memory overhead for Spring integration\n\n---\n\n**This Spring integration provides seamless MetaObjects functionality within Spring applications while maintaining all the framework's powerful features.**",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/core-spring/README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "config",
        "md",
        "readme"
      ],
      "content_hash": "f2ce68adb263aaf6",
      "size_bytes": 11516,
      "created_at": "2026-01-02T20:42:12.423716"
    },
    {
      "doc_id": "local_metaobjects-core_docs_README",
      "source": "local",
      "category": "conversational",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/docs/README.md",
      "content": "# MetaObjects Documentation\n\nThis directory contains the complete documentation system for the MetaObjects framework, designed to be deployed as a professional documentation website.\n\n## üèóÔ∏è Documentation Structure\n\n```\ndocs/\n‚îú‚îÄ‚îÄ README.md                           # This file\n‚îú‚îÄ‚îÄ DOCUMENTATION_PLAN.md               # Master plan for 40+ page documentation\n‚îú‚îÄ‚îÄ DEPLOYMENT.md                       # Deployment and hosting guide\n‚îú‚îÄ‚îÄ requirements.txt                    # Python dependencies for MkDocs\n‚îú‚îÄ‚îÄ index.html                          # Root redirect page\n‚îî‚îÄ‚îÄ src/site/documentation/             # MkDocs source\n    ‚îú‚îÄ‚îÄ mkdocs.yml                      # Site configuration\n    ‚îú‚îÄ‚îÄ docs/                           # Documentation content\n    ‚îÇ   ‚îú‚îÄ‚îÄ index.md                    # Homepage\n    ‚îÇ   ‚îú‚îÄ‚îÄ getting-started/            # Quick start guides\n    ‚îÇ   ‚îú‚îÄ‚îÄ user-guide/                 # Comprehensive user documentation\n    ‚îÇ   ‚îú‚îÄ‚îÄ developer-guide/            # Advanced developer topics\n    ‚îÇ   ‚îú‚îÄ‚îÄ architecture/               # Framework architecture details\n    ‚îÇ   ‚îú‚îÄ‚îÄ examples/                   # Usage examples\n    ‚îÇ   ‚îú‚îÄ‚îÄ reference/                  # API reference\n    ‚îÇ   ‚îú‚îÄ‚îÄ migration/                  # Migration guides\n    ‚îÇ   ‚îú‚îÄ‚îÄ stylesheets/extra.css       # Custom styling\n    ‚îÇ   ‚îî‚îÄ‚îÄ javascripts/extra.js        # Custom functionality\n    ‚îî‚îÄ‚îÄ site/                           # Generated static site (after build)\n```\n\n## üöÄ Quick Start\n\n### Local Development\n\n```bash\n# Install dependencies\npip install -r requirements.txt\n\n# Serve documentation locally\ncd src/site/documentation\nmkdocs serve\n\n# Open browser to http://127.0.0.1:8000\n```\n\n### Building for Production\n\n```bash\n# Build static site\ncd src/site/documentation\nmkdocs build\n\n# Output will be in site/ directory\n```\n\n## üåê Live Documentation Website\n\nThe documentation is configured to be automatically deployed to:\n\n**Live Documentation**: `https://metaobjects.dev/metaobjects-core/`\n\n### Automatic Deployment\n\nDocumentation is automatically deployed via GitHub Actions when:\n- Changes are pushed to `main`, `master`, or `develop` branches\n- Changes are made to any files in the `docs/` directory\n- Workflow can also be triggered manually from GitHub Actions tab\n\n## üìù Documentation Standards\n\n### Writing Guidelines\n\n1. **Architecture-First**: Always explain concepts in terms of the READ-OPTIMIZED WITH CONTROLLED MUTABILITY pattern\n2. **Code Examples**: Include working, tested code examples for all concepts\n3. **Performance Notes**: Mention performance characteristics where relevant\n4. **Cross-References**: Link between related concepts and APIs\n5. **Progressive Disclosure**: Start simple, then add complexity\n\n### Content Organization\n\n- **Getting Started**: 5-minute quick wins for new users\n- **User Guide**: Comprehensive how-to documentation\n- **Developer Guide**: Advanced topics and integration patterns\n- **Architecture**: Deep technical implementation details\n- **API Reference**: Complete API documentation with examples\n- **Examples**: Real-world usage patterns and complete implementations\n\n### Technical Writing Standards\n\n- Use **active voice** (\"Configure the loader\" not \"The loader should be configured\")\n- Include **performance characteristics** for all major operations\n- Provide **complete, runnable examples** rather than code fragments\n- Use **consistent terminology** (see DOCUMENTATION_PLAN.md for glossary)\n- Include **troubleshooting sections** for complex topics\n\n## üé® Customization\n\n### Styling\n\nCustom styles are in `docs/stylesheets/extra.css`:\n- Material Design theme extensions\n- MetaObjects brand colors and styling\n- Responsive design enhancements\n- Print-friendly styles\n- Accessibility improvements\n\n### Functionality\n\nCustom JavaScript in `docs/javascripts/extra.js`:\n- Enhanced code block features\n- Interactive performance metrics\n- Improved navigation\n- Accessibility enhancements\n- Usage analytics (privacy-conscious)\n\n### Theme Configuration\n\nThe site uses Material for MkDocs with these key features:\n- **Dark/light mode toggle**\n- **Advanced search** with highlighting\n- **Code copy buttons**\n- **Navigation breadcrumbs**\n- **Git revision dates**\n- **Responsive design**\n\n## üìä Current Status\n\n### Completed Documentation (Phase 1)\n\n‚úÖ **Infrastructure**: MkDocs site with Material theme\n‚úÖ **Getting Started**: Quick start and core concepts\n‚úÖ **Metadata Module**: Foundation, constraints, attributes (5 pages)\n‚úÖ **Code Generation Module**: Architecture and built-in generators (2 pages)\n‚úÖ **Core Module**: Loader system and file handling (1 page)\n‚úÖ **API Reference**: Complete API coverage (1 page)\n\n**Total**: 14 documentation files created, 40+ pages planned\n\n### Planned Documentation (Future Phases)\n\nüìã **Additional Modules**: OM, Web, Demo modules\nüìã **Advanced Topics**: Performance optimization, troubleshooting\nüìã **Integration Guides**: Spring, OSGi, cloud platforms\nüìã **Examples**: Complete working applications\nüìã **Migration Guides**: Version upgrade paths\n\n## üîß Maintenance\n\n### Updating Documentation\n\n1. **Edit Content**: Modify markdown files in `docs/` directory\n2. **Test Locally**: Use `mkdocs serve` to preview changes\n3. **Commit Changes**: Push to repository\n4. **Automatic Deployment**: GitHub Actions builds and deploys site\n\n### Adding New Pages\n\n1. **Create Markdown File**: Add to appropriate directory under `docs/`\n2. **Update Navigation**: Edit `mkdocs.yml` nav section\n3. **Cross-Link**: Add references from related pages\n4. **Test Build**: Verify `mkdocs build` succeeds\n\n### Theme Updates\n\n1. **Modify Styles**: Edit `extra.css` for visual changes\n2. **Add Features**: Update `extra.js` for functionality\n3. **Test Responsive**: Verify mobile and desktop layouts\n4. **Accessibility**: Ensure screen reader compatibility\n\n## üéØ Goals and Metrics\n\n### Success Criteria\n\n- **User Experience**: Easy navigation, fast search, mobile-friendly\n- **Content Quality**: Comprehensive, accurate, up-to-date information\n- **Performance**: Site loads in < 3 seconds, builds in < 2 minutes\n- **Accessibility**: WCAG 2.1 AA compliance\n- **SEO**: Discoverable by search engines\n\n### Analytics\n\nThe site includes privacy-conscious analytics:\n- Page view tracking (no personal data)\n- Search usage patterns\n- Code copy frequency\n- Time spent per page\n\n## üöÄ Deployment\n\nSee [DEPLOYMENT.md](DEPLOYMENT.md) for complete deployment instructions including:\n- GitHub Pages setup\n- Custom domain configuration\n- Performance optimization\n- Monitoring and maintenance\n\n## ü§ù Contributing\n\n### Adding Documentation\n\n1. **Follow the Plan**: Reference DOCUMENTATION_PLAN.md for content structure\n2. **Match Standards**: Use established writing and formatting guidelines\n3. **Test Locally**: Verify changes work correctly before committing\n4. **Update Navigation**: Ensure new content is discoverable\n\n### Reporting Issues\n\n1. **Documentation Errors**: Create GitHub issue with page URL and description\n2. **Missing Content**: Reference DOCUMENTATION_PLAN.md for planned coverage\n3. **Deployment Issues**: Check DEPLOYMENT.md troubleshooting section first\n\nThe MetaObjects documentation system is designed to grow with the framework while maintaining professional quality and user experience standards.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/docs/README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "readme"
      ],
      "content_hash": "9927a44ab92cfc53",
      "size_bytes": 7430,
      "created_at": "2026-01-02T20:42:12.424056"
    },
    {
      "doc_id": "local_metaobjects-core_docs_DOCUMENTATION_PLAN",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/docs/DOCUMENTATION_PLAN.md",
      "content": "# MetaObjects Comprehensive Documentation Plan\n\n## Overview\n\nThis document outlines a complete documentation strategy for the MetaObjects framework, focusing initially on the **metadata**, **codegen-base**, and **core** modules. The plan is based on analysis of successful Java framework documentation patterns from Spring, Hibernate, Jackson, and Maven.\n\n## Documentation Framework & Technical Infrastructure\n\n### Technology Stack\n- **MkDocs** with Material theme for modern, navigable documentation\n- **Markdown** for content authoring with code syntax highlighting\n- **PlantUML** integration for architectural diagrams\n- **JavaDoc** integration for API reference\n- **GitHub Pages** deployment for accessibility\n\n### Site Structure\n```\ndocs/\n‚îú‚îÄ‚îÄ mkdocs.yml                     # MkDocs configuration\n‚îú‚îÄ‚îÄ docs/                          # Documentation content\n‚îÇ   ‚îú‚îÄ‚îÄ index.md                   # Landing page\n‚îÇ   ‚îú‚îÄ‚îÄ getting-started/           # Quick start guides\n‚îÇ   ‚îú‚îÄ‚îÄ user-guide/               # Complete user documentation\n‚îÇ   ‚îú‚îÄ‚îÄ developer-guide/          # Advanced development topics\n‚îÇ   ‚îú‚îÄ‚îÄ architecture/             # Architectural documentation\n‚îÇ   ‚îú‚îÄ‚îÄ api-reference/            # Generated API docs\n‚îÇ   ‚îú‚îÄ‚îÄ examples/                 # Code examples and tutorials\n‚îÇ   ‚îî‚îÄ‚îÄ migration/                # Version migration guides\n‚îî‚îÄ‚îÄ diagrams/                     # PlantUML source files\n```\n\n## Target Audience Analysis\n\n### Primary Audiences\n1. **New Developers** - Need quick starts and clear examples\n2. **Integration Developers** - Framework integration and advanced features\n3. **Plugin Developers** - Extension patterns and architectural insights\n4. **Enterprise Architects** - Design decisions and performance characteristics\n\n### Documentation Personas\n- **Sarah (New Java Developer)**: Needs step-by-step tutorials with working examples\n- **Marcus (Senior Developer)**: Wants comprehensive API reference and architectural insights\n- **Elena (Plugin Developer)**: Requires extension patterns and provider-based registration examples\n- **David (Enterprise Architect)**: Needs performance characteristics and design decisions\n\n## Documentation Organization Strategy\n\n### Information Architecture\nFollowing the **Progressive Disclosure** pattern used by Spring Framework:\n\n1. **Introduction Layer**: What is MetaObjects, why use it\n2. **Getting Started Layer**: Quick wins with working examples\n3. **User Guide Layer**: Comprehensive feature documentation\n4. **Developer Guide Layer**: Advanced topics and extension patterns\n5. **Reference Layer**: Complete API documentation\n\n### Navigation Patterns\n- **Breadcrumb navigation** for hierarchical content\n- **Cross-references** between related concepts\n- **Progressive complexity** within each section\n- **Multiple entry points** for different user needs\n\n## Core Documentation Sections\n\n### 1. Introduction & Getting Started (Estimated: 8-10 pages)\n\n#### 1.1 Project Overview (`docs/index.md`)\n- **What is MetaObjects**: Metadata-driven development framework\n- **Key Benefits**: Type safety, code generation, framework integration\n- **Architecture Highlights**: Read-optimized design, OSGi compatibility\n- **Use Cases**: When to use MetaObjects vs alternatives\n\n#### 1.2 Quick Start Guide (`docs/getting-started/`)\n- **Installation**: Maven dependencies for different use cases\n- **First Example**: Simple metadata definition and usage\n- **Core Concepts**: MetaData, MetaObject, MetaField overview\n- **Hello World**: Complete working example in 5 minutes\n\n#### 1.3 Core Concepts Introduction (`docs/getting-started/core-concepts.md`)\n- **Metadata vs Data**: Understanding the distinction\n- **Loading Phase vs Runtime Phase**: Architecture overview\n- **Basic Terminology**: Types, subtypes, attributes, constraints\n- **Framework Integration**: How MetaObjects fits in applications\n\n### 2. Metadata Module Documentation (Estimated: 15-20 pages)\n\n#### 2.1 Metadata Core Architecture (`docs/user-guide/metadata/`)\n\n##### 2.1.1 The MetaData Foundation (`metadata-foundation.md`)\n```markdown\n# MetaData Foundation\n\n## Architecture Overview\n- READ-OPTIMIZED WITH CONTROLLED MUTABILITY pattern\n- ClassLoader analogy and lifecycle management\n- Performance characteristics and memory model\n- Thread safety and concurrency patterns\n\n## Core Classes\n- `MetaData`: Base class for all metadata\n- `MetaObject`: Object structure definitions\n- `MetaField`: Field definitions and types\n- `MetaAttribute`: Cross-cutting attributes\n- `MetaValidator`: Validation logic\n- `MetaView`: View layer definitions\n```\n\n##### 2.1.2 Type System (`type-system.md`)\n```markdown\n# MetaObjects Type System\n\n## Type Registration Architecture\n- Provider-based registration (eliminates @MetaDataType annotations)\n- MetaDataTypeProvider service discovery\n- Priority-based loading order\n- Cross-module type resolution\n\n## Built-in Types\n- Field types: string, int, long, double, boolean, date\n- Object types: pojo, proxy, mapped\n- Attribute types: string, int, boolean, class\n- Validator types: required, length, pattern\n- Key types: primary, foreign, secondary\n```\n\n##### 2.1.3 Inheritance System (`inheritance.md`)\n```markdown\n# Metadata Inheritance\n\n## Inheritance Patterns\n- Base type definitions (field.base, object.base, etc.)\n- Inheritance chain resolution\n- Cross-module inheritance support\n- Deferred resolution for complex dependencies\n\n## Extension Examples\n- Creating custom field types\n- Extending base object functionality\n- Plugin development patterns\n```\n\n#### 2.2 Constraint System (`docs/user-guide/metadata/constraints/`)\n\n##### 2.2.1 Constraint Architecture (`constraint-architecture.md`)\n```markdown\n# Constraint System Architecture\n\n## Design Principles\n- Placement constraints: \"X CAN be placed under Y\"\n- Validation constraints: \"X must have valid Y\"\n- Real-time enforcement during metadata construction\n- Extensible through provider pattern\n\n## Constraint Types\n- Naming patterns and identifier validation\n- Required attributes and data types\n- Uniqueness constraints\n- Parent-child relationship rules\n```\n\n##### 2.2.2 Custom Constraints (`custom-constraints.md`)\n```markdown\n# Creating Custom Constraints\n\n## PlacementConstraint Implementation\n- Implementing placement logic\n- Integration with MetaDataRegistry\n- Testing constraint enforcement\n\n## ValidationConstraint Implementation\n- Value validation patterns\n- Error message customization\n- Performance considerations\n```\n\n#### 2.3 Attribute System (`docs/user-guide/metadata/attributes/`)\n\n##### 2.3.1 Attribute Framework (`attribute-framework.md`)\n```markdown\n# Attribute System\n\n## Attribute Types\n- StringAttribute: Text values with pattern validation\n- IntAttribute: Numeric values with range validation\n- BooleanAttribute: True/false flags\n- ClassAttribute: Type-safe class references\n- PropertiesAttribute: Key-value collections\n\n## Inline Attributes\n- JSON format (@-prefixed): `\"@required\": true`\n- XML format (no prefix): `required=\"true\"`\n- Type casting and validation\n- Parse-time error detection\n```\n\n#### 2.4 I/O and Serialization (`docs/user-guide/metadata/io/`)\n\n##### 2.4.1 JSON Processing (`json-processing.md`)\n```markdown\n# JSON Metadata Processing\n\n## JsonMetaDataParser\n- Direct JSON‚ÜíMetaData parsing\n- Inline attribute support\n- Cross-file reference resolution\n- Error handling and debugging\n\n## JsonObjectWriter\n- MetaData‚ÜíJSON serialization\n- Format options and customization\n- Integration with Spring REST controllers\n```\n\n### 3. Code Generation Documentation (Estimated: 12-15 pages)\n\n#### 3.1 Generator Framework (`docs/user-guide/codegen/`)\n\n##### 3.1.1 Generator Architecture (`generator-architecture.md`)\n```markdown\n# Code Generation Architecture\n\n## Generator Types\n- Direct generators: Immediate output from metadata\n- Template generators: Using template engines (Mustache, etc.)\n- Schema generators: JSON Schema, XSD validation\n\n## Generator Lifecycle\n- Registration and discovery\n- Configuration and parameters\n- Execution and output management\n- Error handling and debugging\n```\n\n##### 3.1.2 Built-in Generators (`built-in-generators.md`)\n```markdown\n# Built-in Code Generators\n\n## Schema Generators\n- MetaDataFileJsonSchemaGenerator: Validates metadata file structure\n- MetaDataFileXSDGenerator: XML schema for metadata validation\n- AIDocumentationGenerator: AI-friendly metadata documentation\n\n## Java Code Generators\n- POJOGenerator: Plain Java objects from metadata\n- JPA Entity Generator: Database entity generation\n- Builder Pattern Generator: Type-safe builders\n```\n\n#### 3.2 Template System (`docs/user-guide/codegen/templates/`)\n\n##### 3.2.1 Mustache Integration (`mustache-integration.md`)\n```markdown\n# Mustache Template System\n\n## Template Organization\n- Template discovery and loading\n- Helper function registration\n- Context object preparation\n- Output file management\n\n## Built-in Helpers\n- Type checking: `{{#isIdField}}`, `{{#shouldGenerateJpa}}`\n- String manipulation: formatting, case conversion\n- Metadata traversal: field iteration, relationship navigation\n```\n\n### 4. Core Module Documentation (Estimated: 10-12 pages)\n\n#### 4.1 Loader System (`docs/user-guide/core/loaders/`)\n\n##### 4.1.1 MetaDataLoader Architecture (`loader-architecture.md`)\n```markdown\n# MetaDataLoader System\n\n## Loader Types\n- SimpleLoader: JSON metadata loading\n- FileMetaDataLoader: File-based metadata with XML support\n- XMLMetaDataLoader: Legacy XML metadata support\n\n## Loading Process\n- URI resolution and source discovery\n- Parser selection and format detection\n- Metadata construction and validation\n- Cross-file reference resolution\n```\n\n##### 4.1.2 Parser System (`parser-system.md`)\n```markdown\n# Metadata Parser System\n\n## Parser Architecture\n- BaseMetaDataParser: Common parsing functionality\n- JsonMetaDataParser: JSON format support with inline attributes\n- XMLMetaDataParser: XML format support\n\n## Advanced Features\n- Package resolution and inheritance\n- Overlay patterns for metadata augmentation\n- Error context and debugging information\n```\n\n#### 4.2 Object Management (`docs/user-guide/core/objects/`)\n\n##### 4.2.1 Object Types (`object-types.md`)\n```markdown\n# MetaObject Implementation Types\n\n## ValueMetaObject\n- Dynamic objects with public getter/setter access\n- Runtime property management\n- Type-safe value handling\n\n## DataMetaObject\n- Wrapped objects with protected access\n- Builder pattern integration\n- Immutable object support\n\n## ProxyMetaObject\n- Proxy implementations without concrete classes\n- Dynamic method generation\n- Interface-based object creation\n```\n\n### 5. Advanced Topics (Estimated: 8-10 pages)\n\n#### 5.1 Performance and Optimization (`docs/developer-guide/performance/`)\n\n##### 5.1.1 Performance Characteristics (`performance-characteristics.md`)\n```markdown\n# Performance and Memory Model\n\n## Performance Expectations\n- Loading Phase: 100ms-1s (one-time cost)\n- Runtime Reads: 1-10Œºs (cached, immutable access)\n- Memory Overhead: 10-50MB (permanent metadata residence)\n- Concurrent Readers: Unlimited (no lock contention)\n\n## Optimization Patterns\n- Cache strategies and WeakHashMap usage\n- OSGI bundle lifecycle management\n- Read-path optimization techniques\n```\n\n#### 5.2 Framework Integration (`docs/developer-guide/integration/`)\n\n##### 5.2.1 Spring Integration (`spring-integration.md`)\n```markdown\n# Spring Framework Integration\n\n## Auto-Configuration\n- MetaDataAutoConfiguration setup\n- Service bean registration\n- Configuration properties\n\n## Integration Patterns\n- Service wrapper approach: `MetaDataService`\n- Direct loader injection: `MetaDataLoader`\n- Full registry access: `MetaDataLoaderRegistry`\n```\n\n##### 5.2.2 OSGi Integration (`osgi-integration.md`)\n```markdown\n# OSGi Bundle Integration\n\n## Bundle Lifecycle\n- Service discovery via ServiceLoader\n- WeakReference patterns for classloader cleanup\n- Bundle unloading and memory management\n\n## Service Patterns\n- ServiceRegistryFactory auto-detection\n- Bundle-safe metadata registration\n- Service lifecycle management\n```\n\n#### 5.3 Plugin Development (`docs/developer-guide/plugins/`)\n\n##### 5.3.1 Creating Extensions (`creating-extensions.md`)\n```markdown\n# Plugin Development Guide\n\n## Extension Patterns\n- Provider-based registration without annotations\n- Custom field type development\n- Constraint system extensions\n- Generator plugin development\n\n## Example: Currency Field Plugin\n```java\npublic class CurrencyField extends PrimitiveField<BigDecimal> {\n    public static void registerTypes(MetaDataRegistry registry) {\n        registry.registerType(CurrencyField.class, def -> def\n            .type(\"field\").subType(\"currency\")\n            .inheritsFrom(\"field\", \"base\")\n            .optionalAttribute(\"precision\", \"int\")\n            .optionalAttribute(\"currencyCode\", \"string\")\n            .description(\"Currency field with precision and formatting\")\n        );\n    }\n}\n```\n\n### 6. API Reference (`docs/api-reference/`)\n\n#### 6.1 Generated JavaDoc Integration\n- Module-level API documentation\n- Cross-reference between modules\n- Code examples in JavaDoc\n- Architecture decision context\n\n#### 6.2 Key Classes Reference\n- MetaData hierarchy and inheritance\n- Loader system classes and interfaces\n- Generator framework APIs\n- Constraint system interfaces\n\n### 7. Examples and Tutorials (`docs/examples/`)\n\n#### 7.1 Complete Working Examples\n- Basic metadata definition and usage\n- Code generation pipeline setup\n- Spring application integration\n- Plugin development tutorial\n\n#### 7.2 Migration Guides\n- Upgrading from v5.x to v6.x\n- Annotation to provider-based migration\n- Performance optimization checklist\n\n## Implementation Priority\n\n### Phase 1: Foundation (Weeks 1-2)\n1. ‚úÖ **Documentation Plan** (this document)\n2. **MkDocs Setup** - Configure site structure and navigation\n3. **Getting Started Guide** - Quick start and core concepts\n4. **Metadata Core Documentation** - Foundation and type system\n\n### Phase 2: Core Features (Weeks 3-4)\n5. **Constraint System Documentation** - Architecture and custom constraints\n6. **Code Generation Guide** - Generator framework and templates\n7. **Core Module Documentation** - Loaders and parsers\n8. **API Reference Setup** - JavaDoc integration\n\n### Phase 3: Advanced Topics (Weeks 5-6)\n9. **Performance Documentation** - Optimization and memory model\n10. **Framework Integration** - Spring and OSGi patterns\n11. **Plugin Development Guide** - Extension patterns and examples\n12. **Migration Guides** - Version upgrade documentation\n\n### Phase 4: Polish and Launch (Week 7)\n13. **Example Integration** - Complete working examples\n14. **Cross-reference Cleanup** - Internal linking and navigation\n15. **Review and Testing** - Documentation validation\n16. **Deployment** - GitHub Pages setup and launch\n\n## Content Standards\n\n### Writing Guidelines\n- **Clear, actionable language** avoiding jargon\n- **Code examples** for every major concept\n- **Architecture context** explaining design decisions\n- **Performance implications** for optimization guidance\n\n### Code Example Standards\n```java\n// ‚úÖ GOOD - Complete, working example with context\npublic class UserMetadataExample {\n    public static void main(String[] args) {\n        // 1. Create loader\n        SimpleLoader loader = new SimpleLoader(\"user-metadata\");\n        loader.setSourceURIs(Arrays.asList(URI.create(\"user-metadata.json\")));\n        loader.init();\n\n        // 2. Access metadata\n        MetaObject userMeta = loader.getMetaObjectByName(\"User\");\n        MetaField emailField = userMeta.getMetaField(\"email\");\n\n        // 3. Use metadata\n        System.out.println(\"Email field type: \" + emailField.getSubTypeName());\n    }\n}\n```\n\n### Diagram Standards\n- **PlantUML source** for all architectural diagrams\n- **Sequence diagrams** for complex interactions\n- **Class diagrams** for inheritance relationships\n- **Component diagrams** for module architecture\n\n## Success Metrics\n\n### Quantitative Goals\n- **Complete coverage** of metadata, codegen-base, and core modules\n- **40+ documentation pages** with comprehensive content\n- **100+ code examples** across all features\n- **Zero broken links** or missing references\n\n### Qualitative Goals\n- **New developer onboarding** in under 30 minutes\n- **Clear plugin development path** with working examples\n- **Performance guidance** for optimization decisions\n- **Architectural understanding** for enterprise adoption\n\n## Maintenance Strategy\n\n### Content Lifecycle\n- **Version-specific documentation** with clear migration paths\n- **Automated link checking** in CI/CD pipeline\n- **Regular content review** for accuracy and currency\n- **Community contribution** guidelines and templates\n\n### Update Triggers\n- **New feature releases** require documentation updates\n- **API changes** trigger reference documentation refresh\n- **Performance improvements** update optimization guides\n- **Bug fixes** may require example corrections\n\n---\n\n## Next Steps\n\nThis plan serves as the roadmap for comprehensive MetaObjects documentation. Each phase builds upon the previous, ensuring a logical progression from basic concepts to advanced topics.\n\n**Ready to begin implementation with Phase 1: MkDocs Setup and Getting Started Guide.**\n\n## Cross-Chat Coordination\n\n### Current Status\n- ‚úÖ **Documentation plan completed** (this document)\n- ‚è≥ **MkDocs configuration** (next task)\n- ‚è≥ **Content creation** (ongoing)\n\n### Handoff Notes for Future Chats\n1. **Start with MkDocs setup** using the structure defined above\n2. **Follow the phase priorities** for systematic progress\n3. **Use the content standards** for consistency\n4. **Update this plan** as implementation reveals new requirements\n\n**This plan provides the complete roadmap for MetaObjects documentation across multiple development sessions.**",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/docs/DOCUMENTATION_PLAN.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "abd24a2779d3db99",
      "size_bytes": 17792,
      "created_at": "2026-01-02T20:42:12.424133"
    },
    {
      "doc_id": "local_metaobjects-core_docs_DEPLOYMENT",
      "source": "local",
      "category": "knowledge_base",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/docs/DEPLOYMENT.md",
      "content": "# Documentation Deployment Guide\n\nThis guide explains how to deploy the MetaObjects documentation as a live website using GitHub Pages.\n\n## üöÄ Quick Deployment Setup\n\n### Prerequisites\n\n- GitHub repository with documentation content\n- GitHub Actions enabled (free for public repositories)\n- Admin access to repository settings\n\n### Step 1: Enable GitHub Pages\n\n1. **Navigate to Repository Settings**\n   - Go to your GitHub repository\n   - Click **Settings** tab\n   - Scroll down to **Pages** section in left sidebar\n\n2. **Configure GitHub Pages**\n   - **Source**: Select \"GitHub Actions\"\n   - **Branch**: This will be configured automatically by the workflow\n   - **Custom domain** (optional): Add your domain if you have one\n\n3. **Save Settings**\n   - Click **Save**\n   - **Custom Domain**: Set to `metaobjects.dev`\n   - Note the live URL: `https://metaobjects.dev/metaobjects-core/`\n\n### Step 2: Verify Workflow Files\n\nThe repository includes these deployment files:\n\n```\n.github/workflows/deploy-docs.yml    # GitHub Actions workflow\ndocs/requirements.txt                # Python dependencies\ndocs/src/site/documentation/        # MkDocs source files\n‚îú‚îÄ‚îÄ mkdocs.yml                      # Site configuration\n‚îú‚îÄ‚îÄ docs/                           # Documentation content\n‚îú‚îÄ‚îÄ stylesheets/extra.css           # Custom styling\n‚îî‚îÄ‚îÄ javascripts/extra.js            # Custom functionality\n```\n\n### Step 3: Trigger Deployment\n\n**Automatic Deployment** (recommended):\n```bash\n# Make any change to documentation\necho \"Updated deployment guide\" >> docs/DEPLOYMENT.md\ngit add docs/DEPLOYMENT.md\ngit commit -m \"Update documentation\"\ngit push origin main\n```\n\n**Manual Deployment**:\n1. Go to repository **Actions** tab\n2. Select **Deploy Documentation** workflow\n3. Click **Run workflow** button\n4. Select branch (main/master)\n5. Click **Run workflow**\n\n### Step 4: Verify Deployment\n\n1. **Check Workflow Status**\n   - Go to **Actions** tab\n   - Verify \"Deploy Documentation\" shows green checkmark\n   - Review logs if there are any issues\n\n2. **Visit Live Site**\n   - Open: `https://metaobjects.dev/metaobjects-core/`\n   - Verify site loads correctly\n   - Test navigation and search functionality\n\n## üîß Advanced Configuration\n\n### Custom Domain Setup\n\n1. **Add Custom Domain** (Already configured)\n   ```bash\n   # CNAME file already created\n   # Contains: metaobjects.dev\n   ```\n\n2. **Update mkdocs.yml** (Already configured)\n   ```yaml\n   site_url: 'https://metaobjects.dev/metaobjects-core/'\n   ```\n\n3. **Configure DNS** (Should be already configured)\n   - Add CNAME record: `metaobjects.dev` ‚Üí `metaobjectsdev.github.io`\n   - Wait for DNS propagation (up to 24 hours)\n\n### Environment-Specific Deployments\n\n**Staging Environment**:\n```yaml\n# .github/workflows/deploy-docs-staging.yml\nname: Deploy Documentation (Staging)\n\non:\n  push:\n    branches: [ develop ]\n    paths: [ 'docs/**' ]\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      # ... same steps as main deployment\n      # Deploy to different URL or environment\n```\n\n**Production Release**:\n```yaml\n# Only deploy on tags\non:\n  push:\n    tags:\n      - 'v*'\n```\n\n### Performance Optimization\n\n**Enable Compression**:\n```yaml\n# In mkdocs.yml\nplugins:\n  - search\n  - minify:\n      minify_html: true\n      minify_js: true\n      minify_css: true\n```\n\n**CDN Integration**:\n```yaml\n# Use CDN for assets\nextra_css:\n  - 'https://cdn.jsdelivr.net/npm/custom-styles@1.0.0/metaobjects.css'\n```\n\n### Analytics Setup\n\n**Google Analytics 4**:\n```yaml\n# In mkdocs.yml\nextra:\n  analytics:\n    provider: google\n    property: G-XXXXXXXXXX\n```\n\n**Privacy-Conscious Analytics**:\n```javascript\n// In extra.js\n// Simple, privacy-focused usage tracking\nfunction trackPageView() {\n    fetch('/api/analytics', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n            page: window.location.pathname,\n            referrer: document.referrer,\n            timestamp: Date.now()\n        })\n    });\n}\n```\n\n## üîç Troubleshooting\n\n### Common Deployment Issues\n\n**1. Workflow Fails to Run**\n```bash\n# Check workflow permissions\n# Repository Settings ‚Üí Actions ‚Üí General\n# Ensure \"Read and write permissions\" is selected\n```\n\n**2. Build Fails - Missing Dependencies**\n```bash\n# Check requirements.txt includes all needed packages\npip install -r docs/requirements.txt\ncd docs/src/site/documentation\nmkdocs build --strict\n```\n\n**3. Site Loads But Styles Missing**\n```bash\n# Verify file paths in mkdocs.yml\nextra_css:\n  - stylesheets/extra.css  # Relative to docs/ directory\n```\n\n**4. Search Not Working**\n```bash\n# Ensure search plugin is enabled\nplugins:\n  - search\n```\n\n**5. Custom Domain Not Working**\n- Verify CNAME file is in correct location\n- Check DNS propagation: `nslookup docs.metaobjects.com`\n- Ensure SSL certificate is provisioned (automatic with GitHub Pages)\n\n### Local Development\n\n**Setup Local Environment**:\n```bash\n# Install dependencies\npip install -r docs/requirements.txt\n\n# Serve locally\ncd docs/src/site/documentation\nmkdocs serve\n\n# Open browser to http://127.0.0.1:8000\n```\n\n**Live Reload Development**:\n```bash\n# Enable live reload with auto-refresh\nmkdocs serve --livereload\n\n# Watch for changes and rebuild automatically\nmkdocs serve --watch-theme\n```\n\n**Build Validation**:\n```bash\n# Test production build\nmkdocs build --strict --verbose\n\n# Check for broken links\npip install mkdocs-htmlproofer-plugin\nmkdocs build\nhtmlproofer ./site\n```\n\n## üìä Monitoring and Maintenance\n\n### Deployment Health Checks\n\n**Automated Testing**:\n```yaml\n# Add to workflow\n- name: Test documentation links\n  run: |\n    pip install requests beautifulsoup4\n    python scripts/test-links.py\n\n- name: Validate site structure\n  run: |\n    test -f site/index.html\n    test -f site/search/search_index.json\n    test -d site/assets\n```\n\n**Performance Monitoring**:\n```javascript\n// Monitor site performance\nwindow.addEventListener('load', function() {\n    const perfData = performance.timing;\n    const loadTime = perfData.loadEventEnd - perfData.navigationStart;\n\n    if (loadTime > 3000) {\n        console.warn('Site loading slowly:', loadTime + 'ms');\n    }\n});\n```\n\n### Update Procedures\n\n**Documentation Updates**:\n1. Edit markdown files in `docs/src/site/documentation/docs/`\n2. Test locally with `mkdocs serve`\n3. Commit and push changes\n4. Verify automatic deployment completes\n\n**Theme/Style Updates**:\n1. Modify `extra.css` and `extra.js`\n2. Test responsive design on multiple devices\n3. Validate accessibility with screen readers\n4. Deploy and monitor for issues\n\n**Dependency Updates**:\n```bash\n# Update requirements.txt\npip list --outdated\npip install --upgrade mkdocs mkdocs-material\n\n# Test compatibility\nmkdocs build --strict\n```\n\n## üéØ Success Metrics\n\n### Key Performance Indicators\n\n**Technical Metrics**:\n- ‚úÖ Build time < 2 minutes\n- ‚úÖ Site load time < 3 seconds\n- ‚úÖ Zero broken links\n- ‚úÖ 100% uptime\n\n**User Experience Metrics**:\n- ‚úÖ Search functionality working\n- ‚úÖ Mobile responsive design\n- ‚úÖ Accessibility score > 95%\n- ‚úÖ SEO score > 90%\n\n**Content Quality Metrics**:\n- ‚úÖ All navigation links functional\n- ‚úÖ Code examples tested and working\n- ‚úÖ Cross-references accurate\n- ‚úÖ Images and diagrams displaying correctly\n\n### Deployment Checklist\n\nBefore going live:\n\n- [ ] All workflow files present and configured\n- [ ] GitHub Pages enabled in repository settings\n- [ ] Custom CSS and JavaScript files included\n- [ ] Site builds successfully locally\n- [ ] All navigation links work\n- [ ] Search functionality tested\n- [ ] Mobile responsive design verified\n- [ ] Accessibility features working\n- [ ] Performance optimized\n- [ ] Analytics configured (if desired)\n- [ ] Custom domain configured (if applicable)\n- [ ] SSL certificate active\n- [ ] Monitoring and alerts set up\n\n## üöÄ Go Live!\n\nWith everything configured, your MetaObjects documentation website will be live at:\n\n**Custom Domain**: `https://metaobjects.dev/metaobjects-core/`\n**GitHub Pages URL**: `https://metaobjectsdev.github.io/metaobjects-core/` (mirrors custom domain)\n\nThe site will automatically update whenever documentation changes are pushed to the main branch, providing a professional, always-current documentation experience for MetaObjects framework users.\n\n## üìû Support\n\nIf you encounter issues with deployment:\n\n1. Check GitHub Actions workflow logs\n2. Verify all file paths and configurations\n3. Test build locally with same environment\n4. Review GitHub Pages status at [githubstatus.com](https://githubstatus.com)\n5. Open issue in repository for persistent problems\n\nThe deployment system is designed to be robust and self-healing, providing reliable documentation hosting for the MetaObjects community.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/docs/DEPLOYMENT.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "5a887fb0608b0cb5",
      "size_bytes": 8765,
      "created_at": "2026-01-02T20:42:12.424207"
    },
    {
      "doc_id": "local_metaobjects-core_docs_src_site_documentation_docs_index",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/docs/src/site/documentation/docs/index.md",
      "content": "# MetaObjects Documentation\n\nWelcome to the comprehensive documentation for **MetaObjects**, a sophisticated framework for metadata-driven development that provides unprecedented control over your applications beyond traditional model-driven development techniques.\n\n<div class=\"grid cards\" markdown>\n\n-   :material-rocket-launch:{ .lg .middle } **Quick Start**\n\n    ---\n\n    Get up and running with MetaObjects in minutes with our step-by-step guide\n\n    [:octicons-arrow-right-24: Getting Started](getting-started/quick-start.md)\n\n-   :material-cog:{ .lg .middle } **User Guide**\n\n    ---\n\n    Comprehensive documentation covering all MetaObjects features and modules\n\n    [:octicons-arrow-right-24: User Guide](user-guide/metadata/metadata-foundation.md)\n\n-   :material-code-braces:{ .lg .middle } **API Reference**\n\n    ---\n\n    Complete API documentation for all MetaObjects modules and classes\n\n    [:octicons-arrow-right-24: API Reference](api-reference/metadata.md)\n\n-   :material-puzzle:{ .lg .middle } **Examples**\n\n    ---\n\n    Working examples and tutorials for common use cases and integration patterns\n\n    [:octicons-arrow-right-24: Examples](examples/basic-usage.md)\n\n</div>\n\n## What is MetaObjects?\n\nMetaObjects is a comprehensive suite of tools designed for **metadata-driven development**, offering:\n\n### :material-database: **Metadata-First Architecture**\n\nDefine your object structures, validation rules, and relationships through rich metadata definitions rather than scattered annotations or configuration files.\n\n```json\n{\n  \"metadata\": {\n    \"children\": [\n      {\n        \"object\": {\n          \"name\": \"User\",\n          \"type\": \"pojo\",\n          \"@dbTable\": \"users\",\n          \"children\": [\n            {\n              \"field\": {\n                \"name\": \"email\",\n                \"type\": \"string\",\n                \"@required\": true,\n                \"@maxLength\": 255,\n                \"@pattern\": \"^[\\\\w._%+-]+@[\\\\w.-]+\\\\.[A-Za-z]{2,}$\"\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n```\n\n### :material-code-tags: **Cross-Language Code Generation**\n\nGenerate type-safe code for multiple languages from a single metadata definition:\n\n- **Java**: POJOs, JPA entities, builders, validators\n- **TypeScript**: Interfaces, classes, React components\n- **C#**: Classes, entities, validation attributes\n- **SQL**: Database schemas, constraints, indexes\n\n### :material-spring: **Framework Integration**\n\nNative support for popular frameworks without forcing dependencies:\n\n=== \"Spring Boot\"\n\n    ```xml\n    <dependency>\n        <groupId>com.metaobjects</groupId>\n        <artifactId>metaobjects-core-spring</artifactId>\n        <version>6.2.6-SNAPSHOT</version>\n    </dependency>\n    ```\n\n=== \"Plain Java\"\n\n    ```xml\n    <dependency>\n        <groupId>com.metaobjects</groupId>\n        <artifactId>metaobjects-core</artifactId>\n        <version>6.2.6-SNAPSHOT</version>\n    </dependency>\n    ```\n\n=== \"OSGi Bundle\"\n\n    ```xml\n    <dependency>\n        <groupId>com.metaobjects</groupId>\n        <artifactId>metaobjects-metadata</artifactId>\n        <version>6.2.6-SNAPSHOT</version>\n    </dependency>\n    ```\n\n### :material-shield-check: **Type-Safe Constraints**\n\nComprehensive validation and constraint system that enforces rules at metadata definition time:\n\n- **Naming patterns** and identifier validation\n- **Required attributes** and data type enforcement\n- **Uniqueness constraints** and relationship validation\n- **Custom business rules** through extensible constraint providers\n\n## Key Features\n\n### :material-lightning-bolt: **Performance Optimized**\n\nBuilt on a **READ-OPTIMIZED WITH CONTROLLED MUTABILITY** pattern analogous to Java's Class/Field reflection system:\n\n- **Load once** during application startup (100ms-1s)\n- **Read thousands of times** with microsecond performance (1-10Œºs)\n- **Thread-safe** concurrent access without synchronization overhead\n- **Memory efficient** with intelligent caching strategies (10-50MB)\n\n### :material-puzzle-outline: **Modular Architecture**\n\nIndependent modules that can be used individually or combined as needed:\n\n| Module | Purpose | Dependencies |\n|--------|---------|--------------|\n| `metaobjects-metadata` | Core metadata definitions | None |\n| `metaobjects-core` | File loading and parsing | metadata |\n| `metaobjects-codegen-*` | Code generation engines | metadata, core |\n| `metaobjects-*-spring` | Spring integrations | Optional |\n\n### :material-power-plug: **Extensible Plugin System**\n\nCreate custom field types, validators, and generators through a clean provider-based registration system:\n\n```java\npublic class CurrencyField extends PrimitiveField<BigDecimal> {\n    public static void registerTypes(MetaDataRegistry registry) {\n        registry.registerType(CurrencyField.class, def -> def\n            .type(\"field\").subType(\"currency\")\n            .inheritsFrom(\"field\", \"base\")\n            .optionalAttribute(\"precision\", \"int\")\n            .optionalAttribute(\"currencyCode\", \"string\")\n        );\n    }\n}\n```\n\n## Architecture Highlights\n\n### :material-memory: **Memory Model**\n\nMetaObjects follows a **ClassLoader pattern** where metadata is loaded once at startup and remains in memory for the application lifetime, similar to how `java.lang.Class` objects work.\n\n### :material-sync: **OSGI Compatible**\n\nFull support for OSGi bundle lifecycle with proper cleanup patterns:\n\n- **ServiceLoader discovery** for dynamic service registration\n- **WeakReference patterns** for bundle unloading cleanup\n- **Service registry integration** for enterprise environments\n\n### :material-speedometer: **Concurrent Read Optimization**\n\nDesigned for high-throughput applications with massive concurrent read access:\n\n- **Immutable after loading** - no synchronization needed for reads\n- **ConcurrentHashMap** for high-frequency lookups\n- **Lock-free algorithms** in runtime read paths\n\n## Getting Started\n\nReady to experience metadata-driven development? Choose your path:\n\n<div class=\"grid cards\" markdown>\n\n-   :material-school:{ .lg .middle } **New to MetaObjects?**\n\n    ---\n\n    Start with our comprehensive getting started guide\n\n    [:octicons-arrow-right-24: Quick Start Guide](getting-started/quick-start.md)\n\n-   :material-spring:{ .lg .middle } **Spring Developer?**\n\n    ---\n\n    Jump into Spring-specific integration patterns\n\n    [:octicons-arrow-right-24: Spring Integration](developer-guide/integration/spring-integration.md)\n\n-   :material-code-tags:{ .lg .middle } **Code Generation?**\n\n    ---\n\n    Learn about template-based code generation\n\n    [:octicons-arrow-right-24: Code Generation](user-guide/codegen/generator-architecture.md)\n\n-   :material-puzzle:{ .lg .middle } **Plugin Development?**\n\n    ---\n\n    Extend MetaObjects with custom types and generators\n\n    [:octicons-arrow-right-24: Plugin Guide](developer-guide/plugins/creating-extensions.md)\n\n</div>\n\n## MetaObjects Ecosystem\n\nThis documentation covers the **core platform**. For the complete MetaObjects experience:\n\n<div class=\"grid cards\" markdown>\n\n-   :material-web:{ .lg .middle } **MetaObjects Platform**\n\n    ---\n\n    Enterprise solutions, case studies, and business context\n\n    [:octicons-arrow-right-24: metaobjects.com](https://metaobjects.com)\n\n-   :material-account-supervisor:{ .lg .middle } **Developer Portal**\n\n    ---\n\n    Community hub, tutorials, and developer resources\n\n    [:octicons-arrow-right-24: metaobjects.dev](https://metaobjects.dev)\n\n-   :material-account:{ .lg .middle } **About the Creator**\n\n    ---\n\n    Meet Doug Mealing, architect of the MetaObjects framework\n\n    [:octicons-arrow-right-24: dougmealing.com](https://dougmealing.com)\n\n</div>\n\n## Community & Support\n\n- **GitHub Repository**: [metaobjectsdev/metaobjects-core](https://github.com/metaobjectsdev/metaobjects-core)\n- **Issue Tracker**: Report bugs and request features\n- **Discussions**: Community support and questions\n- **License**: Apache License 2.0\n\n---\n\n*MetaObjects is actively developed and maintained with comprehensive modernization completed in 2024-2025, including security hardening, Java 21 LTS migration, and complete code quality modernization.*\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/docs/src/site/documentation/docs/index.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "md"
      ],
      "content_hash": "36a5535a1a16f09b",
      "size_bytes": 8146,
      "created_at": "2026-01-02T20:42:12.424298"
    },
    {
      "doc_id": "local_metaobjects-core_docs_src_site_documentation_docs_user-guide_core_loader-system",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/docs/src/site/documentation/docs/user-guide/core/loader-system.md",
      "content": "# Loader System Architecture\n\nThe MetaObjects core module provides a comprehensive file-based loading system that implements the READ-OPTIMIZED WITH CONTROLLED MUTABILITY pattern. The loader system is responsible for discovering, loading, and parsing metadata files from various sources while maintaining the framework's performance characteristics.\n\n## Core Architecture Overview\n\nThe loader system follows a **ClassLoader pattern** analogous to Java's class loading mechanism:\n\n- **Load once at startup**: Metadata loaded into permanent memory structures\n- **Read many at runtime**: Ultra-fast cached access with no synchronization\n- **OSGi compatibility**: WeakReference patterns for bundle lifecycle management\n- **Multiple source support**: Files, URIs, classpath resources, and bundle files\n\n## FileMetaDataLoader\n\n### Purpose and Design\n\n`FileMetaDataLoader` is the primary implementation of the metadata loading system, designed for file-based metadata sources including JSON, XML, and bundle files.\n\n**Key Features**:\n- **Multi-format support**: JSON and XML metadata files with automatic parser selection\n- **ClassLoader integration**: OSGi-compatible class loading with fallback chains\n- **Bundle file support**: Load multiple metadata files from bundle manifests\n- **Source flexibility**: Local files, URIs, and classpath resources\n- **Performance optimization**: In-memory caching and lazy initialization\n\n### Basic Usage\n\n**Simple File Loading**:\n```java\n// Create loader with basic configuration\nFileMetaDataLoader loader = new FileMetaDataLoader(\"myLoader\");\n\n// Configure file sources\nLocalFileMetaDataSources sources = new LocalFileMetaDataSources(\"/metadata\");\nsources.add(\"user-metadata.json\");\nsources.add(\"product-metadata.xml\");\n\n// Initialize and load\nloader.init(sources);\n\n// Access loaded metadata\nMetaObject userMeta = loader.getMetaObjectByName(\"User\");\nMetaField emailField = userMeta.getMetaField(\"email\");\n```\n\n**URI-based Loading**:\n```java\n// Load from multiple URI sources\nList<URI> uriSources = Arrays.asList(\n    URI.create(\"file:///metadata/core-types.json\"),\n    URI.create(\"classpath://com/mycompany/metadata/business-types.xml\"),\n    URI.create(\"https://api.example.com/metadata/external-types.json\")\n);\n\nURIFileMetaDataSources uriSourceProvider = new URIFileMetaDataSources(uriSources);\nFileMetaDataLoader loader = new FileMetaDataLoader(\"uriLoader\");\nloader.init(uriSourceProvider);\n```\n\n### Advanced Configuration\n\n**Custom FileLoaderOptions**:\n```java\nFileLoaderOptions options = new FileLoaderOptions()\n    .setVerbose(true)\n    .setCacheEnabled(true)\n    .setValidationEnabled(true);\n\nFileMetaDataLoader loader = new FileMetaDataLoader(options, \"advancedLoader\");\n```\n\n**OSGi ClassLoader Integration**:\n```java\n// Provide bundle-specific classloader for OSGi environments\nClassLoader bundleClassLoader = MyBundle.class.getClassLoader();\nFileMetaDataLoader loader = new FileMetaDataLoader(\"osgiLoader\");\nloader.setMetaDataClassLoader(bundleClassLoader);\n\n// Sources will use the bundle classloader for resource discovery\nLocalFileMetaDataSources sources = new LocalFileMetaDataSources(metadataFiles);\nsources.setLoaderClassLoader(bundleClassLoader);\nloader.init(sources);\n```\n\n## File Source System\n\n### FileMetaDataSources Hierarchy\n\nThe source system provides flexible metadata discovery with multiple implementations:\n\n#### LocalFileMetaDataSources\n\n**Purpose**: Load metadata from local filesystem with optional base directory.\n\n```java\n// Load from specific directory\nLocalFileMetaDataSources localSources = new LocalFileMetaDataSources(\n    \"/project/metadata\",  // Base directory\n    Arrays.asList(\"core.json\", \"extensions.xml\", \"business-rules.json\")\n);\n\n// Load from current directory\nLocalFileMetaDataSources currentDirSources = new LocalFileMetaDataSources(\n    Arrays.asList(\"metadata.json\", \"types.xml\")\n);\n```\n\n**Features**:\n- **Base directory support**: All relative paths resolved against base directory\n- **File existence validation**: Immediate failure for missing files\n- **Recursive bundle loading**: Support for bundle files that reference other files\n\n#### URIFileMetaDataSources\n\n**Purpose**: Load metadata from URI sources including classpath resources, HTTP endpoints, and file URLs.\n\n```java\nList<URI> sources = Arrays.asList(\n    URI.create(\"classpath://metadata/core-types.json\"),\n    URI.create(\"file:///opt/metadata/business-types.xml\"),\n    URI.create(\"https://config.example.com/metadata/external-types.json\")\n);\n\nURIFileMetaDataSources uriSources = new URIFileMetaDataSources(sources);\n```\n\n**URI Schemes Supported**:\n- `file://` - Local filesystem access\n- `classpath://` - Classpath resource loading\n- `http://` / `https://` - Remote metadata loading\n- `jar://` - JAR file resource access\n\n### Bundle File System\n\n**Bundle files** (`.bundle` extension) contain lists of other metadata files to load, enabling modular metadata organization.\n\n**Bundle File Format**:\n```\n# Core business types bundle\n# Lines starting with # are comments\n\ncore-fields.json\nbusiness-objects.xml\nvalidation-rules.json\n\n# Load another bundle\nextended-types.bundle\n```\n\n**Bundle Loading Usage**:\n```java\nLocalFileMetaDataSources sources = new LocalFileMetaDataSources(\"metadata\");\nsources.add(\"complete-system.bundle\");  // Loads all files referenced in bundle\nloader.init(sources);\n```\n\n**Bundle Processing Features**:\n- **Recursive loading**: Bundles can reference other bundles\n- **Comment support**: Lines starting with `#` are ignored\n- **Relative path resolution**: File paths resolved relative to bundle location\n- **Error isolation**: Bundle loading failures don't affect other sources\n\n## ClassLoader Integration\n\n### OSGi Compatibility\n\nThe loader system is designed for complex ClassLoader scenarios including OSGi bundles:\n\n**ClassLoader Chain Resolution**:\n```java\n// FileMetaDataSources uses sophisticated ClassLoader chain\nURL resource = getResourceViaClassLoaderChain(filename);\n\n// Resolution order:\n// 1. Source class ClassLoader (OSGi bundle ClassLoader)\n// 2. Configured loader ClassLoader (from setMetaDataClassLoader)\n// 3. System ClassLoader (fallback)\n```\n\n**Bundle Lifecycle Management**:\n```java\npublic class OSGIMetaDataBundle implements BundleActivator {\n\n    private FileMetaDataLoader loader;\n\n    @Override\n    public void start(BundleContext context) throws Exception {\n        // Create loader with bundle ClassLoader\n        loader = new FileMetaDataLoader(\"bundleLoader\");\n        loader.setMetaDataClassLoader(getClass().getClassLoader());\n\n        // Load bundle-specific metadata\n        LocalFileMetaDataSources sources = new LocalFileMetaDataSources(\n            Arrays.asList(\"bundle-metadata.json\")\n        );\n        sources.setLoaderClassLoader(getClass().getClassLoader());\n        loader.init(sources);\n\n        // Register as OSGi service\n        context.registerService(MetaDataLoader.class, loader, null);\n    }\n\n    @Override\n    public void stop(BundleContext context) throws Exception {\n        // Loader cleanup handled by WeakReference patterns\n        // No explicit cleanup needed\n        loader = null;\n    }\n}\n```\n\n### Class Loading for Metadata Types\n\nThe loader system supports loading Java classes referenced in metadata:\n\n```java\n// loadClass() uses the ClassLoader chain for type resolution\nClass<?> customFieldClass = loader.loadClass(\"com.mycompany.CustomField\");\n\n// Useful for dynamic type loading in metadata definitions\n{\n  \"field\": {\n    \"name\": \"customField\",\n    \"type\": \"custom\",\n    \"implementationClass\": \"com.mycompany.CustomField\"\n  }\n}\n```\n\n## Parser Integration\n\n### Automatic Parser Selection\n\nThe loader automatically selects the appropriate parser based on file extensions:\n\n```java\n// FileMetaDataLoader.loadSourceFiles() - automatic parser selection\nif (filename.endsWith(\".json\")) {\n    JsonMetaDataParser parser = new JsonMetaDataParser(this, filename);\n    parser.loadFromStream(new ByteArrayInputStream(data.getBytes()));\n} else if (filename.endsWith(\".xml\")) {\n    XMLMetaDataParser parser = new XMLMetaDataParser(this, filename);\n    parser.loadFromStream(new ByteArrayInputStream(data.getBytes()));\n}\n```\n\n**Supported File Types**:\n- `.json` - JSON metadata files with inline attribute support\n- `.xml` - XML metadata files with schema validation\n- `.bundle` - Bundle manifest files\n\n### Parser Configuration\n\n**JSON Parser Integration**:\n```java\n// JsonMetaDataParser automatically handles:\n// - Inline attribute syntax (@-prefixed)\n// - Cross-file reference resolution\n// - Type-aware attribute casting\n// - Package overlay patterns\n\n// Example metadata with inline attributes\n{\n  \"metadata\": {\n    \"package\": \"com_example_model\",\n    \"children\": [\n      {\n        \"field\": {\n          \"name\": \"email\",\n          \"type\": \"string\",\n          \"@required\": true,           // Boolean attribute\n          \"@maxLength\": 255,           // Integer attribute\n          \"@pattern\": \"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\"\n        }\n      }\n    ]\n  }\n}\n```\n\n**XML Parser Integration**:\n```java\n// XMLMetaDataParser automatically handles:\n// - XSD schema validation\n// - Namespace-aware parsing\n// - Inline attribute syntax (no prefix required)\n// - Complex type hierarchies\n\n<!-- Example XML with inline attributes -->\n<metadata package=\"com_example_model\">\n  <children>\n    <field name=\"email\" type=\"string\" required=\"true\" maxLength=\"255\"\n           pattern=\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$\" />\n  </children>\n</metadata>\n```\n\n## Performance Characteristics\n\n### Memory Management\n\nThe loader system implements the READ-OPTIMIZED architecture:\n\n**Loading Phase (Startup)**:\n- **Duration**: 100ms - 1s for typical metadata sets\n- **Memory Usage**: 10-50MB for metadata definitions\n- **CPU**: Intensive parsing and validation during init()\n- **I/O**: Sequential file reading with buffering\n\n**Runtime Phase (Application Lifetime)**:\n- **Access Time**: 1-10Œºs for cached metadata lookups\n- **Memory Model**: Permanent residence, no garbage collection\n- **CPU**: Zero parsing overhead, direct object access\n- **Concurrency**: Unlimited concurrent readers with no contention\n\n### Caching Strategy\n\n**Dual Cache Architecture**:\n```java\n// FileMetaDataLoader maintains efficient caching\nprivate final Map<String, MetaObject> objectCache = new ConcurrentHashMap<>();\nprivate final Map<String, MetaField> fieldCache = new ConcurrentHashMap<>();\n\n// Computed value cache (WeakHashMap for OSGi compatibility)\nprivate final Map<Object, Object> computedCache =\n    Collections.synchronizedMap(new WeakHashMap<>());\n```\n\n**Cache Benefits**:\n- **Permanent Cache**: Core metadata lookups never require recomputation\n- **Computed Cache**: Derived values cached but can be GC'd under memory pressure\n- **OSGi Safety**: WeakHashMap allows bundle unloading without memory leaks\n- **Thread Safety**: ConcurrentHashMap provides lock-free concurrent access\n\n### File I/O Optimization\n\n**Efficient File Loading**:\n```java\n// All files loaded into memory during initialization\nList<SourceData> loadedFiles = sources.getSourceData();\n\n// SourceData structure optimizes memory usage\npublic static class SourceData {\n    public final String filename;\n    public final Class<? extends FileMetaDataSources> sourceClass;\n    public final String sourceData;  // Complete file content in memory\n}\n```\n\n**I/O Strategy Benefits**:\n- **Sequential Access**: All files read sequentially during startup\n- **Memory Buffering**: Complete file contents loaded into memory\n- **No Runtime I/O**: Zero file system access after initialization\n- **Error Isolation**: File loading errors detected immediately during init()\n\n## Error Handling and Diagnostics\n\n### Comprehensive Error Context\n\n**MetaDataException Integration**:\n```java\ntry {\n    loader.init(sources);\n} catch (MetaDataException e) {\n    // Rich error context provided\n    System.err.println(\"Loading failed: \" + e.getMessage());\n    System.err.println(\"Source: \" + e.getSource());\n\n    if (e.getMetaDataPath().isPresent()) {\n        System.err.println(\"Path: \" + e.getMetaDataPath().get());\n    }\n\n    if (e.getCause() instanceof IOException) {\n        System.err.println(\"File I/O issue: \" + e.getCause().getMessage());\n    }\n}\n```\n\n**Common Error Scenarios**:\n\n| Error Type | Cause | Resolution |\n|------------|-------|------------|\n| `IllegalStateException` | No sources configured | Add FileMetaDataSources before init() |\n| `MetaDataException: file not found` | Missing metadata file | Verify file paths and ClassLoader setup |\n| `MetaDataException: unsupported file type` | Unknown extension | Use .json, .xml, or .bundle files |\n| `ClassNotFoundException` | Missing implementation class | Add required classes to ClassLoader path |\n| `ConstraintViolationException` | Invalid metadata structure | Fix metadata to comply with constraints |\n\n### Debugging and Monitoring\n\n**Verbose Logging Configuration**:\n```java\nFileLoaderOptions options = new FileLoaderOptions().setVerbose(true);\nFileMetaDataLoader loader = new FileMetaDataLoader(options, \"debugLoader\");\n\n// Produces detailed logging:\n// INFO - METADATA - (3) Source Files Loaded in FileMetaDataLoader{name=debugLoader}\n// DEBUG - LOADING: user-metadata.json\n// DEBUG - Retrieved from Source LocalFileMetaDataSources's ClassLoader: user-metadata.json\n```\n\n**Load Monitoring**:\n```java\n// Track loading performance\nlong startTime = System.currentTimeMillis();\nloader.init(sources);\nlong loadTime = System.currentTimeMillis() - startTime;\n\nSystem.out.println(\"Loaded \" + loader.getMetaObjects().size() +\n                   \" metadata objects in \" + loadTime + \"ms\");\n```\n\n## Integration Patterns\n\n### Spring Framework Integration\n\n**Spring Bean Configuration**:\n```java\n@Configuration\npublic class MetaDataConfiguration {\n\n    @Bean\n    @Primary\n    public FileMetaDataLoader primaryMetaDataLoader() {\n        FileMetaDataLoader loader = new FileMetaDataLoader(\"primary\");\n\n        // Load from classpath resources\n        LocalFileMetaDataSources sources = new LocalFileMetaDataSources(\n            Arrays.asList(\"core-metadata.json\", \"business-metadata.xml\")\n        );\n\n        return loader.init(sources);\n    }\n\n    @Bean\n    @Qualifier(\"external\")\n    public FileMetaDataLoader externalMetaDataLoader() {\n        // Load from external configuration\n        String metadataUrl = environment.getProperty(\"metadata.external.url\");\n        List<URI> uriSources = Arrays.asList(URI.create(metadataUrl));\n\n        URIFileMetaDataSources sources = new URIFileMetaDataSources(uriSources);\n        return new FileMetaDataLoader(\"external\").init(sources);\n    }\n}\n```\n\n**Spring Boot Auto-Configuration**:\n```java\n@ConfigurationProperties(prefix = \"metaobjects.loader\")\npublic class MetaDataLoaderProperties {\n    private List<String> sources = new ArrayList<>();\n    private String sourceDirectory = \"metadata\";\n    private boolean verbose = false;\n\n    // Getters and setters...\n}\n\n@AutoConfiguration\n@EnableConfigurationProperties(MetaDataLoaderProperties.class)\npublic class MetaDataLoaderAutoConfiguration {\n\n    @Bean\n    @ConditionalOnMissingBean\n    public FileMetaDataLoader fileMetaDataLoader(MetaDataLoaderProperties properties) {\n        FileLoaderOptions options = new FileLoaderOptions()\n            .setVerbose(properties.isVerbose());\n\n        FileMetaDataLoader loader = new FileMetaDataLoader(options, \"autoConfigured\");\n\n        LocalFileMetaDataSources sources = new LocalFileMetaDataSources(\n            properties.getSourceDirectory(),\n            properties.getSources()\n        );\n\n        return loader.init(sources);\n    }\n}\n```\n\n### Maven Plugin Integration\n\n**Plugin Configuration**:\n```xml\n<plugin>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-maven-plugin</artifactId>\n    <configuration>\n        <loader>\n            <classname>com.metaobjects.loader.file.FileMetaDataLoader</classname>\n            <name>maven-build-loader</name>\n            <sourceDir>${project.basedir}/src/main/resources/metadata</sourceDir>\n            <sources>\n                <source>core-types.json</source>\n                <source>business-types.xml</source>\n                <source>database-config.bundle</source>\n            </sources>\n        </loader>\n    </configuration>\n</plugin>\n```\n\n**Plugin Configuration Processing**:\n```java\n// FileMetaDataLoader.configure() handles Maven plugin args\n@Override\npublic void configure(LoaderConfiguration config) {\n    // Process sourceDir and sources from plugin configuration\n    Map<String, String> args = config.getArguments();\n    String sourceDir = args.get(\"sourceDir\");\n    List<String> sources = config.getSources();\n\n    // Create appropriate FileMetaDataSources\n    processSources(sourceDir, sources);\n\n    // Initialize with processed sources\n    super.configure(config);\n}\n```\n\n### Multi-Module Projects\n\n**Shared Metadata Loading**:\n```java\n// Parent module: Core metadata loader\npublic class CoreMetaDataModule {\n\n    public static FileMetaDataLoader createCoreLoader() {\n        FileMetaDataLoader loader = new FileMetaDataLoader(\"core\");\n\n        LocalFileMetaDataSources sources = new LocalFileMetaDataSources(\n            Arrays.asList(\"base-types.json\", \"core-constraints.json\")\n        );\n\n        return loader.init(sources);\n    }\n}\n\n// Child module: Extended metadata loader\npublic class BusinessMetaDataModule {\n\n    public static FileMetaDataLoader createBusinessLoader() {\n        FileMetaDataLoader loader = new FileMetaDataLoader(\"business\");\n\n        // Load core types first\n        FileMetaDataLoader coreLoader = CoreMetaDataModule.createCoreLoader();\n        loader.addParentLoader(coreLoader);\n\n        // Add business-specific metadata\n        LocalFileMetaDataSources sources = new LocalFileMetaDataSources(\n            Arrays.asList(\"business-objects.xml\", \"workflow-types.json\")\n        );\n\n        return loader.init(sources);\n    }\n}\n```\n\n## Best Practices\n\n### Loader Configuration\n\n**Choose LocalFileMetaDataSources when**:\n- Loading from development environment with local files\n- Using Maven/Gradle build-time metadata processing\n- Working with file-based metadata editing workflows\n- Requiring immediate file system feedback during development\n\n**Choose URIFileMetaDataSources when**:\n- Loading from classpath resources in packaged applications\n- Integrating with external metadata services\n- Building cloud-native applications with remote configuration\n- Supporting multiple metadata source types in a single loader\n\n**Choose Bundle Files when**:\n- Managing complex metadata with multiple interdependent files\n- Building modular metadata systems with optional components\n- Simplifying deployment with metadata manifests\n- Supporting environment-specific metadata loading\n\n### Performance Optimization\n\n**For Large Metadata Sets**:\n```java\n// Use streaming initialization for very large metadata sets\nFileLoaderOptions options = new FileLoaderOptions()\n    .setVerbose(false)          // Reduce logging overhead\n    .setCacheEnabled(true)      // Enable all caching optimizations\n    .setParallelLoading(true);  // Process files in parallel if supported\n\nFileMetaDataLoader loader = new FileMetaDataLoader(options, \"optimized\");\n```\n\n**For Memory-Constrained Environments**:\n```java\n// Minimize memory usage during loading\nFileLoaderOptions options = new FileLoaderOptions()\n    .setCompactMode(true)       // Use compact internal representations\n    .setEagerGC(true);          // Trigger GC after loading phases\n\n// Load only essential metadata\nLocalFileMetaDataSources sources = new LocalFileMetaDataSources(\n    Arrays.asList(\"essential-types.json\")  // Avoid loading optional metadata\n);\n```\n\n### Error Resilience\n\n**Graceful Degradation**:\n```java\npublic class ResilientMetaDataLoader {\n\n    private FileMetaDataLoader primaryLoader;\n    private FileMetaDataLoader fallbackLoader;\n\n    public MetaDataLoader createResilientLoader() {\n        try {\n            // Attempt primary loading\n            primaryLoader = new FileMetaDataLoader(\"primary\");\n            primaryLoader.init(createPrimarySources());\n            return primaryLoader;\n\n        } catch (MetaDataException e) {\n            log.warn(\"Primary metadata loading failed, using fallback\", e);\n\n            // Fall back to embedded metadata\n            fallbackLoader = new FileMetaDataLoader(\"fallback\");\n            fallbackLoader.init(createFallbackSources());\n            return fallbackLoader;\n        }\n    }\n\n    private FileMetaDataSources createFallbackSources() {\n        // Load from embedded classpath resources\n        return new URIFileMetaDataSources(Arrays.asList(\n            URI.create(\"classpath://metadata/embedded-types.json\")\n        ));\n    }\n}\n```\n\n**Validation and Recovery**:\n```java\npublic class ValidatingMetaDataLoader {\n\n    public FileMetaDataLoader createValidatedLoader() {\n        FileMetaDataLoader loader = new FileMetaDataLoader(\"validated\");\n\n        try {\n            loader.init(sources);\n\n            // Validate loaded metadata\n            validateMetaDataConsistency(loader);\n            validateConstraintIntegrity(loader);\n\n            return loader;\n\n        } catch (ValidationException e) {\n            // Attempt recovery or provide detailed diagnostics\n            generateValidationReport(e);\n            throw new MetaDataException(\"Metadata validation failed\", e);\n        }\n    }\n}\n```\n\nThis loader system provides the foundation for all metadata access in MetaObjects applications, implementing the READ-OPTIMIZED WITH CONTROLLED MUTABILITY pattern while maintaining flexibility for diverse deployment scenarios.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/docs/src/site/documentation/docs/user-guide/core/loader-system.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "md"
      ],
      "content_hash": "ee554a44dce71c2b",
      "size_bytes": 21599,
      "created_at": "2026-01-02T20:42:12.424387"
    },
    {
      "doc_id": "local_metaobjects-core_docs_src_site_documentation_docs_user-guide_persistence_objectmanager",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/docs/src/site/documentation/docs/user-guide/persistence/objectmanager.md",
      "content": "# ObjectManager Persistence Framework\n\n!!! info \"Documentation Moved to MetaObjects Dynamic\"\n    The ObjectManager persistence framework and dynamic object types have been moved to the **MetaObjects Dynamic** project for better architectural separation.\n\n## Quick Links\n\n### üìö **Complete Documentation**\n- **[ObjectManager Persistence Guide](https://github.com/metaobjectsdev/metaobjects-dynamic/docs/src/site/documentation/docs/user-guide/persistence/objectmanager.md)** - Complete setup, configuration, and usage patterns\n- **[Dynamic Object Types](https://github.com/metaobjectsdev/metaobjects-dynamic/docs/src/site/documentation/docs/user-guide/objects/dynamic-object-types.md)** - ValueObject, DataObject, ProxyObject implementations\n\n### üöÄ **Getting Started**\n- **[Installation Guide](https://github.com/metaobjectsdev/metaobjects-dynamic/docs/src/site/documentation/docs/getting-started/installation.md)** - Dependencies and setup\n- **[First Dynamic Object](https://github.com/metaobjectsdev/metaobjects-dynamic/docs/src/site/documentation/docs/getting-started/first-dynamic-object.md)** - Hello World example\n- **[Persistence Setup](https://github.com/metaobjectsdev/metaobjects-dynamic/docs/src/site/documentation/docs/getting-started/persistence-setup.md)** - ObjectManager configuration\n\n## Why the Move?\n\nThe architectural split provides better separation of concerns:\n\n### **MetaObjects Core** (This Project)\n- ‚úÖ **Metadata Framework**: Type system, constraints, validation\n- ‚úÖ **Code Generation**: Template-based generation framework\n- ‚úÖ **Loading System**: JSON/XML metadata parsing and loading\n- ‚úÖ **Service Registry**: Provider-based type registration\n\n### **MetaObjects Dynamic** (Separate Project)\n- üîÑ **Runtime Object Construction**: ValueObject, DataObject, ProxyObject\n- üîÑ **Persistence Framework**: ObjectManagerDB, ObjectManagerNoSQL\n- üîÑ **Dynamic Property Access**: Runtime property manipulation\n- üîÑ **Template Generation**: ValueObject/DataObject code generation\n\n## Migration Path\n\nIf you're currently using ObjectManager with MetaObjects Core:\n\n### 1. Update Dependencies\n\n**Replace:**\n```xml\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-om</artifactId>\n    <version>6.2.6</version>\n</dependency>\n```\n\n**With:**\n```xml\n<!-- Keep core for metadata framework -->\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-core</artifactId>\n    <version>6.2.6</version>\n</dependency>\n\n<!-- Add dynamic for ObjectManager and dynamic objects -->\n<dependency>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-dynamic-core</artifactId>\n    <version>6.2.6</version>\n</dependency>\n```\n\n### 2. Update Imports\n\n**Change package imports:**\n```java\n// OLD - Core project packages\nimport com.metaobjects.manager.ObjectManager;\nimport com.metaobjects.object.value.ValueObject;\n\n// NEW - Dynamic project packages\nimport com.metaobjects.dynamic.manager.ObjectManager;\nimport com.metaobjects.dynamic.object.ValueObject;\n```\n\n### 3. No Code Changes Required\n\nYour existing ObjectManager code should work without changes once the imports are updated.\n\n## Quick Example\n\nHere's a simple example of what ObjectManager provides (see full documentation in Dynamic project):\n\n```java\n// 1. Define metadata (same as before)\nMetaObject userMeta = loader.getMetaObjectByName(\"User\");\n\n// 2. Create dynamic object\nValueObject user = new ValueObject();\nuser.setMetaData(userMeta);\nuser.setAttrValue(\"username\", \"john_doe\");\nuser.setAttrValue(\"email\", \"john@example.com\");\n\n// 3. Persist with ObjectManager\nObjectManagerDB objectManager = new ObjectManagerDB();\nobjectManager.setDataSource(dataSource);\n\nObjectConnection connection = objectManager.getConnection();\ntry {\n    objectManager.createObject(connection, user);\n    System.out.println(\"Created user with ID: \" + user.getAttrValue(\"id\"));\n} finally {\n    connection.close();\n}\n```\n\n## Architecture Benefits\n\nThis separation provides:\n\n- üéØ **Focused Dependencies**: Include only what you need\n- üîß **Independent Evolution**: Core and Dynamic can evolve separately\n- üì¶ **Smaller Artifacts**: Reduced JAR sizes for specific use cases\n- üöÄ **Better Testing**: Clearer testing boundaries between metadata and runtime\n\n## Need Help?\n\n- **üìñ Documentation**: See the [MetaObjects Dynamic Documentation](https://github.com/metaobjectsdev/metaobjects-dynamic/docs/)\n- **üí¨ Questions**: Open an issue in the [MetaObjects Dynamic repository](https://github.com/metaobjectsdev/metaobjects-dynamic/issues)\n- **üîÑ Migration Issues**: Check the [migration guide](https://github.com/metaobjectsdev/metaobjects-dynamic/docs/src/site/documentation/docs/migration/)\n\n---\n\n**This architectural split strengthens both projects while maintaining full compatibility for existing ObjectManager users.**",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/docs/src/site/documentation/docs/user-guide/persistence/objectmanager.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "config",
        "http",
        "md"
      ],
      "content_hash": "c38741fe7a581a5c",
      "size_bytes": 4849,
      "created_at": "2026-01-02T20:42:12.424473"
    },
    {
      "doc_id": "local_metaobjects-core_docs_src_site_documentation_docs_getting-started_quick-start",
      "source": "local",
      "category": "knowledge_base",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/docs/src/site/documentation/docs/getting-started/quick-start.md",
      "content": "# Quick Start Guide\n\nGet up and running with MetaObjects in just a few minutes. This guide will walk you through creating your first metadata definition, loading it, and using it in your application.\n\n## Prerequisites\n\n- **Java 21 LTS** or higher\n- **Maven 3.9+** (or Gradle with equivalent configuration)\n- Basic knowledge of Java development\n\n## Step 1: Add Dependencies\n\nChoose the appropriate dependency based on your project type:\n\n=== \"Plain Java Project\"\n\n    ```xml title=\"pom.xml\"\n    <dependencies>\n        <dependency>\n            <groupId>com.metaobjects</groupId>\n            <artifactId>metaobjects-core</artifactId>\n            <version>6.2.6-SNAPSHOT</version>\n        </dependency>\n    </dependencies>\n    ```\n\n=== \"Spring Boot Project\"\n\n    ```xml title=\"pom.xml\"\n    <dependencies>\n        <dependency>\n            <groupId>com.metaobjects</groupId>\n            <artifactId>metaobjects-spring</artifactId>\n            <version>6.2.6-SNAPSHOT</version>\n        </dependency>\n    </dependencies>\n    ```\n\n=== \"Code Generation Only\"\n\n    ```xml title=\"pom.xml\"\n    <dependencies>\n        <dependency>\n            <groupId>com.metaobjects</groupId>\n            <artifactId>metaobjects-codegen-mustache</artifactId>\n            <version>6.2.6-SNAPSHOT</version>\n        </dependency>\n    </dependencies>\n\n    <plugins>\n        <plugin>\n            <groupId>com.metaobjects</groupId>\n            <artifactId>metaobjects-maven-plugin</artifactId>\n            <version>6.2.5-SNAPSHOT</version>\n            <executions>\n                <execution>\n                    <goals><goal>generate</goal></goals>\n                </execution>\n            </executions>\n        </plugin>\n    </plugins>\n    ```\n\n## Step 2: Create Your First Metadata\n\nCreate a JSON metadata file that defines a simple User object:\n\n```json title=\"src/main/resources/metadata/user-metadata.json\"\n{\n  \"metadata\": {\n    \"package\": \"example\",\n    \"children\": [\n      {\n        \"object\": {\n          \"name\": \"User\",\n          \"subType\": \"pojo\",\n          \"@dbTable\": \"users\",\n          \"children\": [\n            {\n              \"field\": {\n                \"name\": \"id\",\n                \"subType\": \"long\",\n                \"@dbColumn\": \"user_id\",\n                \"children\": [\n                  {\n                    \"validator\": {\n                      \"name\": \"required\",\n                      \"subType\": \"required\"\n                    }\n                  }\n                ]\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"email\",\n                \"subType\": \"string\",\n                \"@dbColumn\": \"email_address\",\n                \"children\": [\n                  {\n                    \"validator\": {\n                      \"name\": \"required\",\n                      \"subType\": \"required\"\n                    }\n                  },\n                  {\n                    \"validator\": {\n                      \"name\": \"length\",\n                      \"subType\": \"length\",\n                      \"@max\": \"255\"\n                    }\n                  },\n                  {\n                    \"validator\": {\n                      \"name\": \"pattern\",\n                      \"subType\": \"pattern\",\n                      \"@pattern\": \"^[\\\\w._%+-]+@[\\\\w.-]+\\\\.[A-Za-z]{2,}$\"\n                    }\n                  }\n                ]\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"firstName\",\n                \"subType\": \"string\",\n                \"@dbColumn\": \"first_name\",\n                \"children\": [\n                  {\n                    \"validator\": {\n                      \"name\": \"length\",\n                      \"subType\": \"length\",\n                      \"@max\": \"100\"\n                    }\n                  }\n                ]\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"lastName\",\n                \"subType\": \"string\",\n                \"@dbColumn\": \"last_name\",\n                \"children\": [\n                  {\n                    \"validator\": {\n                      \"name\": \"length\",\n                      \"subType\": \"length\",\n                      \"@max\": \"100\"\n                    }\n                  }\n                ]\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"createdAt\",\n                \"subType\": \"date\",\n                \"@dbColumn\": \"created_at\"\n              }\n            },\n            {\n              \"key\": {\n                \"name\": \"primary\",\n                \"subType\": \"primary\",\n                \"@keys\": [\"id\"],\n                \"@autoIncrementStrategy\": \"sequential\"\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n```\n\n!!! tip \"Architecture Patterns\"\n    Notice the discrete validator children for validation rules like required and length constraints. Database attributes like `@dbTable` and `@dbColumn` use inline attribute syntax with the `@` prefix. This separation ensures validation is first-class metadata while keeping configuration attributes concise.\n\n## Step 3: Load and Use Metadata\n\nCreate a simple Java application that loads and uses the metadata:\n\n=== \"Plain Java\"\n\n    ```java title=\"src/main/java/com/example/QuickStartExample.java\"\n    package com.example;\n\n    import com.metaobjects.loader.simple.SimpleLoader;\n    import com.metaobjects.object.MetaObject;\n    import com.metaobjects.field.MetaField;\n    import com.metaobjects.attr.MetaAttribute;\n\n    import java.net.URI;\n    import java.util.Arrays;\n\n    public class QuickStartExample {\n\n        public static void main(String[] args) throws Exception {\n            // 1. Create and initialize the metadata loader\n            SimpleLoader loader = new SimpleLoader(\"user-metadata\");\n            loader.setSourceURIs(Arrays.asList(\n                URI.create(\"classpath:metadata/user-metadata.json\")\n            ));\n            loader.init();\n\n            // 2. Get the User metadata\n            MetaObject userMeta = loader.getMetaObjectByName(\"User\");\n            System.out.println(\"Loaded metadata for: \" + userMeta.getName());\n\n            // 3. Explore the metadata structure\n            System.out.println(\"Database table: \" +\n                userMeta.getMetaAttr(\"dbTable\").getValueAsString());\n\n            // 4. Examine fields\n            System.out.println(\"\\nFields:\");\n            for (MetaField field : userMeta.getChildren(MetaField.class)) {\n                System.out.printf(\"  %s (%s)\",\n                    field.getName(),\n                    field.getSubTypeName()\n                );\n\n                // Check for database column mapping\n                if (field.hasMetaAttr(\"dbColumn\")) {\n                    System.out.printf(\" -> %s\",\n                        field.getMetaAttr(\"dbColumn\").getValueAsString()\n                    );\n                }\n\n                // Check for validation attributes\n                if (field.hasMetaAttr(\"required\")) {\n                    System.out.print(\" [REQUIRED]\");\n                }\n\n                if (field.hasMetaAttr(\"maxLength\")) {\n                    System.out.printf(\" [MAX:%s]\",\n                        field.getMetaAttr(\"maxLength\").getValueAsString()\n                    );\n                }\n\n                System.out.println();\n            }\n\n            // 5. Access specific field metadata\n            MetaField emailField = userMeta.getMetaField(\"email\");\n            if (emailField.hasMetaAttr(\"pattern\")) {\n                System.out.println(\"\\nEmail validation pattern: \" +\n                    emailField.getMetaAttr(\"pattern\").getValueAsString());\n            }\n        }\n    }\n    ```\n\n=== \"Spring Boot\"\n\n    ```java title=\"src/main/java/com/example/Application.java\"\n    package com.example;\n\n    import com.metaobjects.object.MetaObject;\n    import com.metaobjects.field.MetaField;\n    import com.metaobjects.spring.MetaDataService;\n    import org.springframework.beans.factory.annotation.Autowired;\n    import org.springframework.boot.CommandLineRunner;\n    import org.springframework.boot.SpringApplication;\n    import org.springframework.boot.autoconfigure.SpringBootApplication;\n\n    @SpringBootApplication\n    public class Application implements CommandLineRunner {\n\n        @Autowired\n        private MetaDataService metaDataService;\n\n        public static void main(String[] args) {\n            SpringApplication.run(Application.class, args);\n        }\n\n        @Override\n        public void run(String... args) throws Exception {\n            // MetaDataService automatically discovers and loads metadata\n            MetaObject userMeta = metaDataService.getMetaObjectByName(\"User\")\n                .orElseThrow(() -> new RuntimeException(\"User metadata not found\"));\n\n            System.out.println(\"Loaded metadata for: \" + userMeta.getName());\n\n            // Use the metadata same as plain Java example above\n            System.out.println(\"Database table: \" +\n                userMeta.getMetaAttr(\"dbTable\").getValueAsString());\n\n            // ... rest of exploration code\n        }\n    }\n    ```\n\n    ```yaml title=\"src/main/resources/application.yml\"\n    metaobjects:\n      metadata:\n        sources:\n          - \"classpath:metadata/user-metadata.json\"\n        auto-discovery: true\n    ```\n\n## Step 4: Run the Example\n\nRun your application and you should see output like:\n\n```\nLoaded metadata for: User\nDatabase table: users\n\nFields:\n  id (long) -> user_id [REQUIRED]\n  email (string) -> email_address [REQUIRED] [MAX:255]\n  firstName (string) -> first_name [MAX:100]\n  lastName (string) -> last_name [MAX:100]\n  createdAt (date) -> created_at\n\nEmail validation pattern: ^[\\w._%+-]+@[\\w.-]+\\.[A-Za-z]{2,}$\n```\n\n## What Just Happened?\n\nCongratulations! You've just:\n\n1. **Defined metadata** for a User object in JSON format\n2. **Loaded the metadata** using MetaObjects' SimpleLoader\n3. **Accessed metadata programmatically** to inspect object structure\n4. **Used inline attributes** for validation and database mapping\n5. **Explored the metadata** to understand field types and constraints\n\n## Key Concepts Demonstrated\n\n### :material-database: **Metadata Definition**\n- **JSON format** with hierarchical structure\n- **Inline attributes** using `@` prefix for concise syntax\n- **Type system** with built-in field types (string, long, date)\n\n### :material-cog: **Loader Pattern**\n- **SimpleLoader** for JSON metadata files\n- **URI-based** source specification\n- **Classpath resource** loading\n\n### :material-code-braces: **Runtime Access**\n- **Type-safe** metadata exploration\n- **Attribute access** for validation and mapping rules\n- **Field iteration** and inspection\n\n## Next Steps\n\nNow that you have the basics working, explore these areas:\n\n<div class=\"grid cards\" markdown>\n\n-   :material-school:{ .lg .middle } **Core Concepts**\n\n    ---\n\n    Understand the fundamental architecture and patterns\n\n    [:octicons-arrow-right-24: Core Concepts](core-concepts.md)\n\n-   :material-database:{ .lg .middle } **Metadata Guide**\n\n    ---\n\n    Learn about the complete metadata system\n\n    [:octicons-arrow-right-24: Metadata Foundation](../user-guide/metadata/metadata-foundation.md)\n\n-   :material-code-tags:{ .lg .middle } **Code Generation**\n\n    ---\n\n    Generate Java classes from your metadata\n\n    [:octicons-arrow-right-24: Code Generation](../user-guide/codegen/generator-architecture.md)\n\n-   :material-puzzle:{ .lg .middle } **Examples**\n\n    ---\n\n    Explore more comprehensive examples\n\n    [:octicons-arrow-right-24: Examples](../examples/basic-usage.md)\n\n</div>\n\n## Common Issues\n\n### ClassPath Resource Not Found\n\nIf you get `FileNotFoundException`, ensure your metadata file is in the correct location:\n\n```\nsrc/main/resources/metadata/user-metadata.json\n```\n\n### JSON Parsing Errors\n\nValidate your JSON syntax and ensure:\n- Proper escaping of regex patterns in `@pattern` attributes\n- Correct nesting of `metadata` ‚Üí `children` ‚Üí object/field structures\n\n### Missing Dependencies\n\nIf you get `ClassNotFoundException`, verify you have the correct MetaObjects dependencies for your use case.\n\n---\n\nReady to dive deeper? Continue with [Core Concepts](core-concepts.md) to understand the architecture behind what you just built!",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/docs/src/site/documentation/docs/getting-started/quick-start.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "config",
        "def",
        "md"
      ],
      "content_hash": "a8431b8988b86d35",
      "size_bytes": 12237,
      "created_at": "2026-01-02T20:42:12.425235"
    },
    {
      "doc_id": "local_metaobjects-core_metadata_API_USAGE_PATTERNS",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/metadata/API_USAGE_PATTERNS.md",
      "content": "# MetaObjects Framework: API Usage Patterns and Examples\n\n## Table of Contents\n1. [Core API Patterns](#core-api-patterns)\n2. [MetaData Access Patterns](#metadata-access-patterns)\n3. [MetaObject Field Management](#metaobject-field-management)\n4. [MetaField Views and Validators](#metafield-views-and-validators)\n5. [Type-Safe Utilities](#type-safe-utilities)\n6. [Best Practices](#best-practices)\n7. [Migration Guide](#migration-guide)\n\n---\n\n## Core API Patterns\n\n### The find/require/stream Pattern\n\nThe MetaObjects framework follows a consistent API pattern for accessing child objects:\n\n- **`find*()`** - Returns `Optional<T>` for safe access\n- **`require*()`** - Returns `T` directly or throws descriptive exception\n- **`get*Stream()`** - Returns `Stream<T>` for functional operations\n- **`has*()`** - Returns `boolean` for existence checks\n\n```java\n// Safe optional access\nOptional<MetaField> field = metaObject.findMetaField(\"name\");\nif (field.isPresent()) {\n    // Use the field\n    System.out.println(\"Field type: \" + field.get().getDataType());\n}\n\n// Require pattern - fails fast if missing\ntry {\n    MetaField requiredField = metaObject.requireMetaField(\"id\");\n    // Field is guaranteed to exist here\n} catch (MetaFieldNotFoundException e) {\n    // Handle missing field\n}\n\n// Stream operations for functional programming\nList<MetaField> stringFields = metaObject.getMetaFieldsStream()\n    .filter(f -> f.getDataType() == DataTypes.STRING)\n    .collect(Collectors.toList());\n\n// Existence check\nif (metaObject.hasMetaField(\"email\")) {\n    // Field exists, safe to access\n}\n```\n\n---\n\n## MetaData Access Patterns\n\n### Working with MetaData Hierarchies\n\n```java\n// Find child by name and type\nOptional<MetaObject> childObject = parentMetaData.findChild(\"User\", MetaObject.class);\n\n// Get all children of a specific type\nStream<MetaObject> allObjects = parentMetaData.findChildren(MetaObject.class);\n\n// Collect children with criteria\nList<MetaField> requiredFields = metaData.getChildrenStream()\n    .filter(child -> child instanceof MetaField)\n    .map(child -> (MetaField) child)\n    .filter(field -> field.hasAttribute(\"required\"))\n    .collect(Collectors.toList());\n```\n\n### Attribute Management\n\n```java\n// Safe attribute access\nOptional<MetaAttribute> displayAttr = field.findAttribute(\"display\");\ndisplayAttr.ifPresent(attr -> {\n    System.out.println(\"Display name: \" + attr.getValueAsString());\n});\n\n// Required attribute access\ntry {\n    MetaAttribute requiredAttr = field.requireAttribute(\"validation\");\n    // Use the attribute\n} catch (MetaAttributeNotFoundException e) {\n    // Handle missing attribute\n}\n\n// Get all attributes as stream\nfield.getAttributesStream()\n    .filter(attr -> attr.getName().startsWith(\"ui_\"))\n    .forEach(attr -> processUIAttribute(attr));\n```\n\n---\n\n## MetaObject Field Management\n\n### Field Discovery and Access\n\n```java\npublic class UserObjectExample {\n    \n    public void demonstrateFieldAccess(MetaObject userObject) {\n        // Modern API - Safe access\n        Optional<MetaField> nameField = userObject.findMetaField(\"name\");\n        nameField.ifPresent(field -> {\n            System.out.println(\"Name field type: \" + field.getDataType());\n        });\n        \n        // Modern API - Required access\n        MetaField idField = userObject.requireMetaField(\"id\");\n        \n        // Find fields by criteria\n        List<MetaField> requiredFields = userObject.getMetaFieldsStream()\n            .filter(this::isRequired)\n            .collect(Collectors.toList());\n            \n        // Find fields by data type\n        List<MetaField> stringFields = userObject.findFieldsByType(DataTypes.STRING)\n            .collect(Collectors.toList());\n    }\n    \n    private boolean isRequired(MetaField field) {\n        return field.findValidator(\"required\").isPresent();\n    }\n}\n```\n\n### Field Validation Patterns\n\n```java\npublic class FieldValidationExample {\n    \n    public void validateFieldConfiguration(MetaField field) {\n        // Check if field has validators\n        if (field.hasValidator(\"required\")) {\n            System.out.println(\"Field is required\");\n        }\n        \n        // Get all validators for analysis\n        List<MetaValidator> validators = field.getValidatorsStream()\n            .collect(Collectors.toList());\n            \n        // Find specific validator types\n        Optional<MetaValidator> lengthValidator = field.findValidator(\"length\");\n        lengthValidator.ifPresent(validator -> {\n            // Configure length validation\n        });\n        \n        // Require critical validators\n        try {\n            MetaValidator requiredValidator = field.requireValidator(\"required\");\n            // Validator is guaranteed to exist\n        } catch (MetaValidatorNotFoundException e) {\n            // Handle missing critical validator\n        }\n    }\n}\n```\n\n---\n\n## MetaField Views and Validators\n\n### View Management\n\n```java\npublic class ViewManagementExample {\n    \n    public void configureFieldViews(MetaField field) {\n        // Safe view access\n        Optional<MetaView> htmlView = field.findView(\"html\");\n        htmlView.ifPresent(view -> {\n            // Configure HTML view\n            System.out.println(\"HTML template: \" + view.getTemplate());\n        });\n        \n        // Get all views for processing\n        field.getViewsStream()\n            .filter(view -> view.isType(\"mobile\"))\n            .forEach(view -> configureMobileView(view));\n            \n        // Require specific view\n        try {\n            MetaView defaultView = field.requireView(\"default\");\n            // View is guaranteed to exist\n        } catch (MetaViewNotFoundException e) {\n            // Create default view if missing\n            createDefaultView(field);\n        }\n    }\n    \n    private void configureMobileView(MetaView view) {\n        // Mobile-specific view configuration\n    }\n    \n    private void createDefaultView(MetaField field) {\n        // Create and add default view\n    }\n}\n```\n\n### Validator Configuration\n\n```java\npublic class ValidatorExample {\n    \n    public void setupFieldValidation(MetaField field) {\n        // Add required validator if missing\n        if (!field.hasValidator(\"required\")) {\n            field.addMetaValidator(new RequiredValidator(\"required\"));\n        }\n        \n        // Configure length validation for string fields\n        if (field.getDataType() == DataTypes.STRING) {\n            Optional<MetaValidator> lengthValidator = field.findValidator(\"length\");\n            if (lengthValidator.isEmpty()) {\n                field.addMetaValidator(new LengthValidator(\"length\"));\n            }\n        }\n        \n        // Process all validators\n        field.getValidatorsStream()\n            .forEach(validator -> {\n                System.out.println(\"Validator: \" + validator.getName());\n                // Configure validator\n            });\n    }\n}\n```\n\n---\n\n## Type-Safe Utilities\n\n### Using MetaDataCasting\n\n```java\nimport com.metaobjects.util.MetaDataCasting;\n\npublic class CastingExample {\n    \n    public void safeCastingExample(MetaData metadata) {\n        // Safe casting with Optional\n        Optional<MetaField> field = MetaDataCasting.safeCast(metadata, MetaField.class);\n        field.ifPresent(f -> {\n            System.out.println(\"Field name: \" + f.getName());\n        });\n        \n        // Required casting (throws if fails)\n        try {\n            MetaObject object = MetaDataCasting.requireCast(metadata, MetaObject.class);\n            // Object is guaranteed to be MetaObject\n        } catch (MetaDataException e) {\n            System.err.println(\"Cast failed: \" + e.getMessage());\n        }\n        \n        // Filter stream by type\n        List<MetaField> fields = MetaDataCasting.filterByType(\n            parentMetaData.getChildrenStream(), \n            MetaField.class\n        ).collect(Collectors.toList());\n    }\n}\n```\n\n### Using TypedMetaDataAccess\n\n```java\nimport com.metaobjects.util.TypedMetaDataAccess;\n\npublic class TypedAccessExample {\n    \n    public void typedAccessExample(MetaObject userObject) {\n        // Type-safe field access\n        Optional<MetaField> nameField = TypedMetaDataAccess.findField(userObject, \"name\");\n        \n        // Required field access\n        MetaField idField = TypedMetaDataAccess.requireField(userObject, \"id\");\n        \n        // Get all fields with proper typing\n        List<MetaField> allFields = TypedMetaDataAccess.getFields(userObject);\n        \n        // Attribute access\n        nameField.ifPresent(field -> {\n            Optional<MetaAttribute> displayAttr = TypedMetaDataAccess.findAttribute(field, \"display\");\n            displayAttr.ifPresent(attr -> {\n                System.out.println(\"Display: \" + attr.getValueAsString());\n            });\n        });\n    }\n}\n```\n\n---\n\n## Best Practices\n\n### 1. Prefer Modern APIs\n\n```java\n// ‚úÖ GOOD - Use modern Optional-based APIs\nOptional<MetaField> field = metaObject.findMetaField(\"name\");\nfield.ifPresent(f -> processField(f));\n\n// ‚ùå AVOID - Legacy exception-based APIs (where available)\ntry {\n    MetaField field = metaObject.getMetaField(\"name\");\n    processField(field);\n} catch (MetaFieldNotFoundException e) {\n    // Handle missing field\n}\n```\n\n### 2. Use Streams for Collection Operations\n\n```java\n// ‚úÖ GOOD - Functional programming with streams\nList<String> fieldNames = metaObject.getMetaFieldsStream()\n    .filter(field -> field.isRequired())\n    .map(MetaField::getName)\n    .sorted()\n    .collect(Collectors.toList());\n\n// ‚ùå AVOID - Imperative iteration\nList<String> fieldNames = new ArrayList<>();\nfor (MetaField field : metaObject.getMetaFields()) {\n    if (field.isRequired()) {\n        fieldNames.add(field.getName());\n    }\n}\nCollections.sort(fieldNames);\n```\n\n### 3. Handle Missing Elements Gracefully\n\n```java\n// ‚úÖ GOOD - Graceful handling with defaults\nString displayName = field.findAttribute(\"display\")\n    .map(MetaAttribute::getValueAsString)\n    .orElse(field.getName()); // Fallback to field name\n\n// ‚úÖ GOOD - Fail fast when element is critical\nMetaValidator requiredValidator = field.requireValidator(\"required\");\n```\n\n### 4. Use Type-Safe Utilities\n\n```java\n// ‚úÖ GOOD - Use utility classes for common patterns\nOptional<MetaField> field = MetaDataCasting.safeCast(child, MetaField.class);\nList<MetaField> fields = TypedMetaDataAccess.getFields(metaObject);\n\n// ‚ùå AVOID - Manual casting and type checking\nif (child instanceof MetaField) {\n    MetaField field = (MetaField) child;\n    // Process field\n}\n```\n\n---\n\n## Migration Guide\n\n### From Legacy APIs to Modern APIs\n\n#### Field Access Migration\n\n```java\n// OLD - Exception-based access\ntry {\n    MetaField field = metaObject.getMetaField(\"name\");\n    processField(field);\n} catch (MetaFieldNotFoundException e) {\n    handleMissingField();\n}\n\n// NEW - Optional-based access\nOptional<MetaField> field = metaObject.findMetaField(\"name\");\nfield.ifPresentOrElse(\n    this::processField,\n    this::handleMissingField\n);\n\n// NEW - Required access when you need to fail fast\ntry {\n    MetaField field = metaObject.requireMetaField(\"name\");\n    processField(field);\n} catch (MetaFieldNotFoundException e) {\n    handleMissingField();\n}\n```\n\n#### View Access Migration\n\n```java\n// OLD - hasView() with exception handling\nif (field.hasView(\"html\")) {\n    try {\n        MetaView view = field.getView(\"html\");\n        configureView(view);\n    } catch (MetaViewNotFoundException e) {\n        // This should not happen since hasView() returned true\n    }\n}\n\n// NEW - Modern Optional-based access\nfield.findView(\"html\").ifPresent(this::configureView);\n\n// NEW - Required access for critical views\ntry {\n    MetaView view = field.requireView(\"html\");\n    configureView(view);\n} catch (MetaViewNotFoundException e) {\n    createDefaultView(field);\n}\n```\n\n#### Validator Access Migration\n\n```java\n// OLD - Manual iteration and casting\nfor (MetaData child : field.getChildren()) {\n    if (child instanceof MetaValidator) {\n        MetaValidator validator = (MetaValidator) child;\n        if (\"required\".equals(validator.getName())) {\n            configureValidator(validator);\n        }\n    }\n}\n\n// NEW - Stream-based access\nfield.getValidatorsStream()\n    .filter(v -> \"required\".equals(v.getName()))\n    .findFirst()\n    .ifPresent(this::configureValidator);\n\n// NEW - Direct access\nfield.findValidator(\"required\").ifPresent(this::configureValidator);\n```\n\n---\n\n## Performance Considerations\n\n### Efficient Operations\n\n```java\n// ‚úÖ EFFICIENT - O(1) lookup using modern APIs\nOptional<MetaField> field = metaObject.findMetaField(\"name\");\n\n// ‚úÖ EFFICIENT - Stream operations with early termination\nboolean hasRequiredFields = metaObject.getMetaFieldsStream()\n    .anyMatch(field -> field.hasValidator(\"required\"));\n\n// ‚úÖ EFFICIENT - Batch operations\nMap<String, MetaField> fieldMap = metaObject.getMetaFieldsStream()\n    .collect(Collectors.toMap(MetaField::getName, Function.identity()));\n```\n\n### Avoiding Common Performance Pitfalls\n\n```java\n// ‚ùå INEFFICIENT - Repeated lookups in loops\nfor (String fieldName : fieldNames) {\n    if (metaObject.hasMetaField(fieldName)) {\n        MetaField field = metaObject.requireMetaField(fieldName); // Second lookup!\n        processField(field);\n    }\n}\n\n// ‚úÖ EFFICIENT - Single lookup per field\nfor (String fieldName : fieldNames) {\n    metaObject.findMetaField(fieldName).ifPresent(this::processField);\n}\n```\n\n---\n\n## Conclusion\n\nThe enhanced MetaObjects API provides:\n\n- **Type Safety**: Compile-time validation and runtime safety\n- **Consistency**: Uniform patterns across all access methods\n- **Performance**: Efficient O(1) lookups and stream operations\n- **Flexibility**: Optional-based access with functional programming support\n- **Maintainability**: Clear, self-documenting code patterns\n\nBy following these patterns and examples, you can write more robust, maintainable, and efficient code with the MetaObjects framework.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/metadata/API_USAGE_PATTERNS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "api",
        "example",
        "md",
        "usage"
      ],
      "content_hash": "9223d0645848f89d",
      "size_bytes": 13917,
      "created_at": "2026-01-02T20:42:12.425386"
    },
    {
      "doc_id": "local_metaobjects-core_metadata_src_test_resources_relationship-examples_README",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/metadata/src/test/resources/relationship-examples/README.md",
      "content": "# MetaRelationship Examples\n\nThis directory contains example metadata JSON files demonstrating the MetaObjects relationship system. The relationship system is designed for AI code generation simplicity while supporting common relational database and document store patterns.\n\n## Core Relationship Patterns\n\n### Essential Attributes (AI specifies these 4)\n\n1. **`@targetObject`** - The target object this relationship points to\n2. **`@cardinality`** - Either \"one\" or \"many\"\n3. **`@ownership`** - Either \"owns\" or \"references\"\n4. **`@referencedBy`** - Field name that implements the relationship\n\n### Derived Properties (automatic)\n\n- **Semantic Type**: \"composition\" (owns) or \"association\" (references)\n- **Lifecycle**: \"dependent\" (owns) or \"independent\" (references)\n\n## Four Common RDB Relationship Patterns\n\n### 1. One-to-One Composition (owns + one)\n```json\n{\n  \"relationship\": {\n    \"name\": \"profile\",\n    \"@targetObject\": \"UserProfile\",\n    \"@cardinality\": \"one\",\n    \"@ownership\": \"owns\",\n    \"@referencedBy\": \"profileId\"\n  }\n}\n```\n**Meaning**: Parent object owns exactly one child object. When parent is deleted, child is also deleted.\n**RDB Implementation**: Foreign key in child table, cascade delete\n**Examples**: User ‚Üí Profile, Order ‚Üí PaymentInfo\n\n### 2. One-to-Many Composition (owns + many)\n```json\n{\n  \"relationship\": {\n    \"name\": \"addresses\",\n    \"@targetObject\": \"Address\",\n    \"@cardinality\": \"many\",\n    \"@ownership\": \"owns\",\n    \"@referencedBy\": \"addressIds\"\n  }\n}\n```\n**Meaning**: Parent object owns multiple child objects. When parent is deleted, all children are deleted.\n**RDB Implementation**: Foreign key in child table, cascade delete\n**Examples**: User ‚Üí Addresses, Order ‚Üí OrderItems\n\n### 3. One-to-One Association (references + one)\n```json\n{\n  \"relationship\": {\n    \"name\": \"manager\",\n    \"@targetObject\": \"User\",\n    \"@cardinality\": \"one\",\n    \"@ownership\": \"references\",\n    \"@referencedBy\": \"managerId\"\n  }\n}\n```\n**Meaning**: Parent object references exactly one independent object. Lifecycle is independent.\n**RDB Implementation**: Foreign key in parent table, no cascade delete\n**Examples**: Employee ‚Üí Manager, Order ‚Üí Customer\n\n### 4. One-to-Many Association (references + many)\n```json\n{\n  \"relationship\": {\n    \"name\": \"favoriteProducts\",\n    \"@targetObject\": \"Product\",\n    \"@cardinality\": \"many\",\n    \"@ownership\": \"references\",\n    \"@referencedBy\": \"favoriteProductIds\"\n  }\n}\n```\n**Meaning**: Parent object references multiple independent objects. Lifecycle is independent.\n**RDB Implementation**: Junction table or array of foreign keys\n**Examples**: User ‚Üí FavoriteProducts, Category ‚Üí Products\n\n## Example Files\n\n### 1. `simple-relationship-patterns.json`\nDemonstrates all four core relationship patterns with clear examples and descriptions.\n\n### 2. `ecommerce-relationships.json`\nComprehensive e-commerce domain model showing:\n- User compositions (profile, addresses)\n- User associations (orders, manager)\n- Order compositions (orderItems)\n- Order associations (addresses)\n- Product associations (category)\n- Self-referencing relationships (category hierarchy)\n\n### 3. `blog-relationships.json`\nBlog domain model showing:\n- Author compositions (posts, profile)\n- Post compositions (comments)\n- Post associations (tags, category)\n- Self-referencing relationships (comment replies, category hierarchy)\n\n## AI Code Generation Benefits\n\n### Simple Decision Tree\nAI only needs to choose:\n1. **Target Object** - What object does this point to?\n2. **Cardinality** - One or many?\n3. **Ownership** - Does parent own the child or just reference it?\n4. **Field Name** - What field implements this relationship?\n\n### Cross-Language Mapping\nThe semantic model maps directly to:\n- **Java**: JPA annotations (@OneToOne, @OneToMany, @ManyToOne)\n- **C#**: Entity Framework relationships\n- **TypeScript**: Interface relationships\n- **SQL**: Foreign keys and junction tables\n- **MongoDB**: Embedded documents vs references\n\n### Hidden Complexity\nComplex attributes are derived automatically:\n- **semanticType**: composition vs association\n- **lifecycle**: dependent vs independent\n- **direction**: unidirectional (default)\n- **implementation**: reference (default)\n\n## Usage in Code Generation\n\n### JPA Generation Example\n```java\n// One-to-One Composition: @ownership=\"owns\", @cardinality=\"one\"\n@OneToOne(cascade = CascadeType.ALL, fetch = FetchType.LAZY)\n@JoinColumn(name = \"profile_id\")\nprivate UserProfile profile;\n\n// One-to-Many Association: @ownership=\"references\", @cardinality=\"many\"\n@ManyToMany(fetch = FetchType.LAZY)\n@JoinTable(name = \"user_favorite_products\",\n    joinColumns = @JoinColumn(name = \"user_id\"),\n    inverseJoinColumns = @JoinColumn(name = \"product_id\"))\nprivate List<Product> favoriteProducts;\n```\n\n### TypeScript Interface Generation Example\n```typescript\n// One-to-One Composition\ninterface User {\n  id: number;\n  name: string;\n  profile: UserProfile;  // Embedded object\n}\n\n// One-to-Many Association\ninterface User {\n  id: number;\n  name: string;\n  favoriteProductIds: number[];  // Array of IDs\n}\n```\n\n## Migration from MetaKey\n\nThe relationship system replaces the database-specific MetaKey system:\n\n### Before (MetaKey - Database Specific)\n```json\n{\n  \"key\": {\n    \"name\": \"userOrderFK\",\n    \"subType\": \"foreign\",\n    \"@foreignObjectRef\": \"User\",\n    \"@foreignKey\": \"userId\"\n  }\n}\n```\n\n### After (MetaRelationship - Model Driven)\n```json\n{\n  \"relationship\": {\n    \"name\": \"user\",\n    \"@targetObject\": \"User\",\n    \"@cardinality\": \"one\",\n    \"@ownership\": \"references\",\n    \"@referencedBy\": \"userId\"\n  }\n}\n```\n\nThe relationship approach is more semantic and works across different persistence technologies (RDB, document stores, graph databases).",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/metadata/src/test/resources/relationship-examples/README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "example",
        "md",
        "readme"
      ],
      "content_hash": "1bc7bae9e0812778",
      "size_bytes": 5727,
      "created_at": "2026-01-02T20:42:12.426720"
    },
    {
      "doc_id": "local_metaobjects-core_metadata_src_main_java_com_metaobjects_constraint_ENHANCED_PLACEMENT_CONSTRAINT_USAGE",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/metadata/src/main/java/com/metaobjects/constraint/ENHANCED_PLACEMENT_CONSTRAINT_USAGE.md",
      "content": "# Enhanced PlacementConstraint with Constant-Based API\n\n## Overview\n\nThe PlacementConstraint class has been enhanced with type-safe constructors and static factory methods that use existing constants instead of error-prone string literals.\n\n## Key Improvements\n\n### ‚úÖ BEFORE vs AFTER Comparison\n\n**BEFORE (Error-prone string literals):**\n```java\n// ‚ùå Old way - string concatenation with potential typos\nregistry.addConstraint(new PlacementConstraint(\n    \"stringfield.maxlength.placement\",\n    \"StringField can have maxLength attribute\",\n    \"field.string\",           // Could have typos\n    \"attr.int[maxLength]\",    // Could have typos\n    true\n));\n```\n\n**AFTER (Type-safe with constants):**\n```java\n// ‚úÖ New way - compile-time checked constants\nregistry.addConstraint(PlacementConstraint.allowAttribute(\n    \"stringfield.maxlength.placement\",\n    \"StringField can have maxLength attribute\",\n    TYPE_FIELD, SUBTYPE_STRING,           // Parent: field.string\n    IntAttribute.SUBTYPE_INT, ATTR_MAX_LENGTH    // Child: attr.int[maxLength]\n));\n```\n\n## New Constructor\n\n```java\npublic PlacementConstraint(String constraintId, String description,\n                          String parentType, String parentSubType,\n                          String childType, String childSubType, String childName,\n                          boolean allowed)\n```\n\n**Parameters:**\n- `parentType` - Use constants like `MetaField.TYPE_FIELD`\n- `parentSubType` - Use constants like `StringField.SUBTYPE_STRING`\n- `childType` - Use constants like `MetaAttribute.TYPE_ATTR`\n- `childSubType` - Use constants like `StringAttribute.SUBTYPE_STRING`\n- `childName` - Use constants like `StringField.ATTR_MAX_LENGTH`\n\n## Static Factory Methods\n\n### 1. `allowAttribute()` - Allow specific attribute on specific parent\n\n```java\nPlacementConstraint constraint = PlacementConstraint.allowAttribute(\n    \"stringfield.maxlength\",\n    \"StringField can have maxLength attribute\",\n    MetaField.TYPE_FIELD, StringField.SUBTYPE_STRING,    // Parent: field.string\n    IntAttribute.SUBTYPE_INT, StringField.ATTR_MAX_LENGTH // Child: attr.int[maxLength]\n);\n```\n\n### 2. `allowAttributeOnAnyField()` - Allow attribute on any field type\n\n```java\nPlacementConstraint constraint = PlacementConstraint.allowAttributeOnAnyField(\n    \"field.required\",\n    \"Any field can have required attribute\",\n    BooleanAttribute.SUBTYPE_BOOLEAN, MetaField.ATTR_REQUIRED\n);\n// Produces: parent=\"field.*\", child=\"attr.boolean[required]\"\n```\n\n### 3. `allowAttributeOnAnyObject()` - Allow attribute on any object type\n\n```java\nPlacementConstraint constraint = PlacementConstraint.allowAttributeOnAnyObject(\n    \"object.dbTable\",\n    \"Any object can have dbTable attribute\",\n    StringAttribute.SUBTYPE_STRING, \"dbTable\"\n);\n// Produces: parent=\"object.*\", child=\"attr.string[dbTable]\"\n```\n\n### 4. `allowChildType()` - Allow child type under parent (no name constraint)\n\n```java\nPlacementConstraint constraint = PlacementConstraint.allowChildType(\n    \"metadata.fields\",\n    \"Metadata can contain fields\",\n    \"metadata\", \"base\",               // Parent: metadata.base\n    MetaField.TYPE_FIELD, \"*\"         // Child: field.*\n);\n```\n\n### 5. `forbidAttribute()` - Forbid specific attribute\n\n```java\nPlacementConstraint constraint = PlacementConstraint.forbidAttribute(\n    \"object.maxlength.forbidden\",\n    \"Objects cannot have maxLength attribute\",\n    MetaObject.TYPE_OBJECT, \"*\",\n    IntAttribute.SUBTYPE_INT, StringField.ATTR_MAX_LENGTH\n);\n```\n\n## Constants Reference\n\n### Type Constants\n```java\nMetaField.TYPE_FIELD        // \"field\"\nMetaObject.TYPE_OBJECT      // \"object\"\nMetaAttribute.TYPE_ATTR     // \"attr\"\n```\n\n### Field Subtype Constants\n```java\nStringField.SUBTYPE_STRING         // \"string\"\nIntegerField.SUBTYPE_INT           // \"int\"\nLongField.SUBTYPE_LONG             // \"long\"\nDoubleField.SUBTYPE_DOUBLE         // \"double\"\nBooleanField.SUBTYPE_BOOLEAN       // \"boolean\"\n```\n\n### Attribute Subtype Constants\n```java\nStringAttribute.SUBTYPE_STRING     // \"string\"\nIntAttribute.SUBTYPE_INT           // \"int\"\nLongAttribute.SUBTYPE_LONG         // \"long\"\nDoubleAttribute.SUBTYPE_DOUBLE     // \"double\"\nBooleanAttribute.SUBTYPE_BOOLEAN   // \"boolean\"\n```\n\n### Attribute Name Constants\n```java\n// MetaField level attributes\nMetaField.ATTR_REQUIRED            // \"required\"\nMetaField.ATTR_DEFAULT_VALUE       // \"defaultValue\"\nMetaField.ATTR_DEFAULT_VIEW        // \"defaultView\"\n\n// StringField specific attributes\nStringField.ATTR_PATTERN           // \"pattern\"\nStringField.ATTR_MAX_LENGTH        // \"maxLength\"\nStringField.ATTR_MIN_LENGTH        // \"minLength\"\n```\n\n## Usage Patterns\n\n### Pattern 1: Field-Specific Attributes\n```java\n// StringField can have pattern attribute\nPlacementConstraint.allowAttribute(\n    \"stringfield.pattern\",\n    \"StringField can have pattern attribute\",\n    TYPE_FIELD, SUBTYPE_STRING,\n    StringAttribute.SUBTYPE_STRING, ATTR_PATTERN\n);\n\n// StringField can have maxLength attribute\nPlacementConstraint.allowAttribute(\n    \"stringfield.maxlength\",\n    \"StringField can have maxLength attribute\",\n    TYPE_FIELD, SUBTYPE_STRING,\n    IntAttribute.SUBTYPE_INT, ATTR_MAX_LENGTH\n);\n```\n\n### Pattern 2: Cross-Cutting Attributes\n```java\n// Any field can have required attribute\nPlacementConstraint.allowAttributeOnAnyField(\n    \"field.required\",\n    \"Fields can have required attribute\",\n    BooleanAttribute.SUBTYPE_BOOLEAN, ATTR_REQUIRED\n);\n```\n\n### Pattern 3: Type Containment Rules\n```java\n// Objects can contain fields\nPlacementConstraint.allowChildType(\n    \"object.fields\",\n    \"Objects can contain fields\",\n    TYPE_OBJECT, \"*\",\n    TYPE_FIELD, \"*\"\n);\n```\n\n## Unified with ChildRequirement\n\nPlacementConstraint and ChildRequirement can now use the same constants:\n\n```java\n// PlacementConstraint (for validation)\nPlacementConstraint placement = PlacementConstraint.allowAttribute(\n    \"stringfield.maxlength\",\n    \"StringField can have maxLength\",\n    TYPE_FIELD, SUBTYPE_STRING,\n    IntAttribute.SUBTYPE_INT, ATTR_MAX_LENGTH\n);\n\n// ChildRequirement (for schema generation)\nChildRequirement child = ChildRequirement.optional(\n    ATTR_MAX_LENGTH,                // Same constant!\n    TYPE_ATTR,                      // Same constant!\n    IntAttribute.SUBTYPE_INT        // Same constant!\n);\n```\n\n## Benefits\n\n1. **Type Safety**: Compile-time checking prevents typos\n2. **Constant Reuse**: Uses existing constants from MetaField, StringField, etc.\n3. **Clean API**: Static factory methods for common patterns\n4. **Unified Approach**: Works seamlessly with ChildRequirement\n5. **Backward Compatible**: Legacy string-based constructor still works\n6. **Easy Migration**: Can migrate usage incrementally\n\n## Migration Strategy\n\n1. **Immediate**: Use new factory methods for new constraints\n2. **Gradual**: Update existing high-frequency usage sites\n3. **Eventually**: Deprecate string-based constructor\n4. **Future**: Consider merging ChildRequirement functionality",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/metadata/src/main/java/com/metaobjects/constraint/ENHANCED_PLACEMENT_CONSTRAINT_USAGE.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "api",
        "class",
        "md"
      ],
      "content_hash": "a11ca5cd71ba4d50",
      "size_bytes": 6937,
      "created_at": "2026-01-02T20:42:12.426937"
    },
    {
      "doc_id": "local_metaobjects-core_archetype_src_main_resources_archetype-resources_README",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/archetype/src/main/resources/archetype-resources/README.md",
      "content": "# ${artifactId}\n\nA MetaObjects application for building metadata-driven domain objects with automatic code generation and database persistence.\n\n## Quick Start\n\n### Prerequisites\n\n- Java 21 or higher\n- Maven 3.6 or higher\n\n### Running the Application\n\n```bash\n# Clean and compile\nmvn clean compile\n\n# Run the application\nmvn spring-boot:run\n```\n\nThe application will start on http://localhost:8080\n\n### Testing\n\n```bash\n# Run all tests\nmvn test\n\n# Run integration tests only\nmvn test -Dtest=\"**/*IntegrationTest\"\n```\n\n## Project Structure\n\n```\n${artifactId}/\n‚îú‚îÄ‚îÄ src/main/java/${package}/\n‚îÇ   ‚îú‚îÄ‚îÄ Application.java              # Spring Boot main class\n‚îÇ   ‚îú‚îÄ‚îÄ config/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MetaObjectsConfiguration.java  # MetaObjects setup\n‚îÇ   ‚îú‚îÄ‚îÄ controller/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserController.java       # User REST API\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OrderController.java      # Order REST API\n‚îÇ   ‚îî‚îÄ‚îÄ service/\n‚îÇ       ‚îú‚îÄ‚îÄ UserService.java          # User business logic\n‚îÇ       ‚îî‚îÄ‚îÄ OrderService.java         # Order business logic\n‚îú‚îÄ‚îÄ src/main/resources/\n‚îÇ   ‚îú‚îÄ‚îÄ metadata/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ application-metadata.json # Core domain metadata\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database-overlay.json     # Database mappings\n‚îÇ   ‚îî‚îÄ‚îÄ application.properties        # App configuration\n‚îî‚îÄ‚îÄ src/test/java/${package}/\n    ‚îú‚îÄ‚îÄ service/\n    ‚îÇ   ‚îî‚îÄ‚îÄ UserServiceTest.java      # Unit tests\n    ‚îî‚îÄ‚îÄ integration/\n        ‚îî‚îÄ‚îÄ ApplicationIntegrationTest.java  # Integration tests\n```\n\n## MetaObjects Features\n\n### Metadata-Driven Development\n\nThis project uses JSON metadata to define domain objects:\n\n- **User**: Core user entity with validation and relationships\n- **Order**: Order management with lifecycle states\n- **OrderItem**: Line items with automatic total calculations\n\n### Core Patterns Demonstrated\n\n1. **ValueMetaObject**: Type-safe field access with automatic validation\n2. **MetaIdentity System**: Modern primary/secondary key management\n3. **ObjectManagerDB**: Database persistence with connection management\n4. **Relationship Management**: Foreign keys and associations\n5. **Business Logic**: Order lifecycle and calculation patterns\n\n## API Endpoints\n\n### User Management\n\n```bash\n# Create user\nPOST /api/users\nContent-Type: application/json\n{\n  \"username\": \"johndoe\",\n  \"email\": \"john.doe@example.com\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\"\n}\n\n# Get user by ID\nGET /api/users/{id}\n\n# Search users by name\nGET /api/users/search?name=john\n\n# Update user\nPUT /api/users/{id}\n{\n  \"email\": \"new.email@example.com\"\n}\n```\n\n### Order Management\n\n```bash\n# Create order\nPOST /api/orders\n{\n  \"userId\": 1,\n  \"shippingAddress\": \"123 Main St, City, State 12345\"\n}\n\n# Add order item\nPOST /api/orders/{orderId}/items\n{\n  \"productName\": \"Wireless Headphones\",\n  \"quantity\": 2,\n  \"unitPrice\": 99.99\n}\n\n# Confirm order\nPOST /api/orders/{orderId}/confirm\n```\n\n## Database Schema\n\nThe application uses H2 in-memory database for development. Database tables are automatically created from metadata definitions:\n\n- **users**: User information with unique constraints\n- **orders**: Order headers with status tracking\n- **order_items**: Order line items with totals\n\n### Database Access\n\nDevelopment H2 Console: http://localhost:8080/h2-console\n- JDBC URL: `jdbc:h2:mem:${artifactId}`\n- Username: `sa`\n- Password: `password`\n\n## Configuration\n\n### MetaObjects Configuration\n\nKey configuration in `application.properties`:\n\n```properties\n# MetaObjects settings\nmetaobjects.auto-create-tables=true\nmetaobjects.validate-schema=true\nmetaobjects.cache-metadata=true\n```\n\n### Database Configuration\n\n```properties\n# Development database (H2)\nspring.datasource.url=jdbc:h2:mem:${artifactId}\nspring.datasource.username=sa\nspring.datasource.password=password\n```\n\n## Adding New Entities\n\n### 1. Define Metadata\n\nCreate metadata in `src/main/resources/metadata/application-metadata.json`:\n\n```json\n{\n  \"object\": {\n    \"name\": \"Product\",\n    \"subType\": \"managed\",\n    \"description\": \"Product catalog item\",\n    \"children\": [\n      {\n        \"field\": {\n          \"name\": \"id\",\n          \"subType\": \"long\",\n          \"description\": \"Product ID\"\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"name\",\n          \"subType\": \"string\",\n          \"@required\": true,\n          \"@maxLength\": 200,\n          \"description\": \"Product name\"\n        }\n      },\n      {\n        \"identity\": {\n          \"name\": \"product_pk\",\n          \"subType\": \"primary\",\n          \"fields\": [\"id\"],\n          \"@generation\": \"increment\"\n        }\n      }\n    ]\n  }\n}\n```\n\n### 2. Create Service Class\n\n```java\n@Service\n@Transactional\npublic class ProductService {\n\n    private final ObjectManagerDB objectManager;\n    private final MetaObject productMetaObject;\n\n    public ProductService(ObjectManagerDB objectManager) throws Exception {\n        this.objectManager = objectManager;\n        this.productMetaObject = MetaDataUtil.findMetaObjectByName(\"Product\", this);\n    }\n\n    public ValueMetaObject createProduct(String name, String description) throws Exception {\n        try (ObjectConnection connection = objectManager.getConnection()) {\n            ValueMetaObject product = new ValueMetaObject(productMetaObject);\n            product.setString(\"name\", name);\n            product.setString(\"description\", description);\n            objectManager.createObject(connection, product);\n            return product;\n        }\n    }\n}\n```\n\n### 3. Create REST Controller\n\n```java\n@RestController\n@RequestMapping(\"/api/products\")\npublic class ProductController {\n\n    @Autowired\n    private ProductService productService;\n\n    @PostMapping\n    public ResponseEntity<Map<String, Object>> createProduct(@RequestBody Map<String, Object> request) {\n        // Implementation\n    }\n}\n```\n\n## Development Tips\n\n### MetaObjects Best Practices\n\n1. **Use ValueMetaObject for new objects**: Provides type-safe field access\n2. **Always use try-with-resources**: For ObjectConnection management\n3. **Leverage MetaIdentity**: Modern approach for primary/secondary keys\n4. **Test with real metadata**: Integration tests validate complete flow\n\n### Testing Patterns\n\n1. **Unit Tests**: Mock MetaObjects components for isolated testing\n2. **Integration Tests**: Use @SpringBootTest with @Transactional\n3. **Test Data**: Create reusable test fixtures in @BeforeEach methods\n\n### Debugging\n\n1. **Enable SQL logging**: Set `spring.jpa.show-sql=true` for development\n2. **MetaObjects logging**: Set `logging.level.com.metaobjects=DEBUG`\n3. **H2 Console**: Use web interface to inspect database state\n\n## Architecture\n\nThis project demonstrates:\n\n- **Metadata-Driven Architecture**: Domain objects defined in JSON metadata\n- **Service Layer Pattern**: Business logic separated from controllers\n- **Repository Pattern**: ObjectManagerDB provides data persistence abstraction\n- **REST API Design**: Clean HTTP endpoints with proper status codes\n- **Transaction Management**: @Transactional ensures data consistency\n\n## Technology Stack\n\n- **MetaObjects Framework**: Metadata-driven development\n- **Spring Boot 3.2.0**: Application framework\n- **H2 Database**: In-memory database for development\n- **Jackson**: JSON serialization\n- **JUnit 5**: Testing framework\n- **Mockito**: Mocking for unit tests\n\n## Next Steps\n\n1. **Add Security**: Implement Spring Security for authentication\n2. **Add Validation**: Extend MetaObjects validators for business rules\n3. **Production Database**: Configure PostgreSQL or MySQL\n4. **API Documentation**: Add OpenAPI/Swagger documentation\n5. **Monitoring**: Add Micrometer metrics and health checks\n\n## Support\n\nFor MetaObjects framework documentation and examples, see:\n- Project documentation in `.claude/CLAUDE.md`\n- MetaObjects GitHub repository\n- Example metadata files in `src/main/resources/metadata/`\n\n## License\n\nThis project is generated from the MetaObjects archetype.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/archetype/src/main/resources/archetype-resources/README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "http",
        "md",
        "readme",
        "test"
      ],
      "content_hash": "69565e0378d4ec8c",
      "size_bytes": 7937,
      "created_at": "2026-01-02T20:42:12.428062"
    },
    {
      "doc_id": "local_metaobjects-core_archetype_src_main_resources_archetype-resources__claude_CLAUDE",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/archetype/src/main/resources/archetype-resources/.claude/CLAUDE.md",
      "content": "# MetaObjects Application Guide: ${artifactId}\n\n## üéØ **YOUR PROJECT OVERVIEW**\n\n**Generated Project**: `${groupId}.${artifactId}`\n**Package**: `${package}`\n**Version**: `${version}`\n**Framework**: MetaObjects v6.2.6 with Spring Boot 3.2.0\n\nThis project was generated using the MetaObjects application archetype and includes everything needed to build a complete metadata-driven application with database persistence.\n\n---\n\n## üèóÔ∏è **YOUR PROJECT STRUCTURE**\n\n```\n${artifactId}/\n‚îú‚îÄ‚îÄ .claude/\n‚îÇ   ‚îî‚îÄ‚îÄ CLAUDE.md                          # This comprehensive guide\n‚îú‚îÄ‚îÄ pom.xml                                # Complete Maven configuration\n‚îú‚îÄ‚îÄ src/main/\n‚îÇ   ‚îú‚îÄ‚îÄ java/${packageInPathFormat}/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ${artifactId}Application.java        # Spring Boot application\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MetaObjectsConfiguration.java    # MetaObjects setup\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/                               # Generated domain objects\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.java                         # Generated from metadata\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Order.java                        # Generated from metadata\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OrderItem.java                    # Generated from metadata\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/                              # Business logic layer\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserService.java                 # User CRUD operations\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OrderService.java                # Order CRUD operations\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/                           # REST API layer\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserController.java              # User REST endpoints\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OrderController.java             # Order REST endpoints\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dto/                                  # Data transfer objects\n‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ CreateUserRequest.java           # User creation DTO\n‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ UpdateUserRequest.java           # User update DTO\n‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ OrderItemData.java               # Order item DTO\n‚îÇ   ‚îî‚îÄ‚îÄ resources/\n‚îÇ       ‚îú‚îÄ‚îÄ application.properties                # Spring configuration\n‚îÇ       ‚îú‚îÄ‚îÄ metadata/                             # MetaObjects metadata\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ application-metadata.json        # YOUR CORE DOMAIN MODEL\n‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ database-overlay.json            # YOUR DATABASE MAPPING\n‚îÇ       ‚îî‚îÄ‚îÄ templates/                            # Custom Mustache templates\n‚îÇ           ‚îî‚îÄ‚îÄ java-domain-object.mustache      # Domain object template\n‚îî‚îÄ‚îÄ src/test/\n    ‚îî‚îÄ‚îÄ java/${packageInPathFormat}/\n        ‚îú‚îÄ‚îÄ ${artifactId}ApplicationTest.java    # Application tests\n        ‚îú‚îÄ‚îÄ service/                              # Service layer tests\n        ‚îÇ   ‚îú‚îÄ‚îÄ UserServiceTest.java             # User service tests\n        ‚îÇ   ‚îî‚îÄ‚îÄ OrderServiceTest.java            # Order service tests\n        ‚îî‚îÄ‚îÄ integration/                          # Integration tests\n            ‚îî‚îÄ‚îÄ DatabaseIntegrationTest.java     # Database integration tests\n```\n\n---\n\n## üöÄ **GETTING STARTED WITH YOUR PROJECT**\n\n### **1. Generate Domain Objects from Metadata**\n```bash\ncd ${artifactId}\nmvn metaobjects:generate\n```\n\n### **2. Compile and Run Your Application**\n```bash\nmvn spring-boot:run\n```\n\n### **3. Test Your Generated REST API**\n```bash\n# List all users\ncurl http://localhost:8080/api/users\n\n# Create a new user\ncurl -X POST http://localhost:8080/api/users \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\":\"john_doe\",\"email\":\"john@example.com\",\"firstName\":\"John\",\"lastName\":\"Doe\"}'\n\n# Get user by ID\ncurl http://localhost:8080/api/users/1\n\n# List all orders\ncurl http://localhost:8080/api/orders\n```\n\n### **4. Access H2 Database Console**\n```\nURL: http://localhost:8080/h2-console\nJDBC URL: jdbc:h2:mem:${artifactId}\nUsername: sa\nPassword: password\n```\n\n---\n\n## üìã **YOUR METADATA FILES**\n\n### **Core Domain Model**: `src/main/resources/metadata/application-metadata.json`\n\nThis file defines your User, Order, and OrderItem entities with proper MetaIdentity patterns:\n\n- **User Entity**: Primary identity with auto-increment, secondary identities for username/email uniqueness\n- **Order Entity**: Primary identity, relationship to User, proper decimal handling for amounts\n- **OrderItem Entity**: Primary identity, relationship to Order, computed line totals\n\n### **Database Mapping**: `src/main/resources/metadata/database-overlay.json`\n\nThis file maps your entities to H2 database tables:\n\n- **Table Names**: users, orders, order_items\n- **Column Mappings**: Proper snake_case database columns\n- **Index Names**: Explicit index naming for performance\n\n---\n\n## üîß **CUSTOMIZING YOUR PROJECT**\n\n### **Adding a New Entity (Example: Product)**\n\n**Step 1**: Add Product metadata to `application-metadata.json`:\n```json\n{\n  \"object\": {\n    \"name\": \"Product\",\n    \"subType\": \"managed\",\n    \"description\": \"Product catalog item\",\n    \"children\": [\n      {\n        \"field\": {\n          \"name\": \"id\",\n          \"subType\": \"long\"\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"name\",\n          \"subType\": \"string\",\n          \"@required\": true,\n          \"@maxLength\": 200\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"description\",\n          \"subType\": \"string\",\n          \"@maxLength\": 1000\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"price\",\n          \"subType\": \"decimal\",\n          \"@precision\": 10,\n          \"@scale\": 2,\n          \"@minValue\": \"0.00\"\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"isActive\",\n          \"subType\": \"boolean\",\n          \"@defaultValue\": \"true\"\n        }\n      },\n      {\n        \"identity\": {\n          \"name\": \"product_pk\",\n          \"subType\": \"primary\",\n          \"fields\": [\"id\"],\n          \"@generation\": \"increment\"\n        }\n      }\n    ]\n  }\n}\n```\n\n**Step 2**: Add Product database mapping to `database-overlay.json`:\n```json\n{\n  \"object\": {\n    \"name\": \"Product\",\n    \"@dbTable\": \"products\",\n    \"children\": [\n      {\n        \"field\": {\n          \"name\": \"id\",\n          \"@dbColumn\": \"product_id\"\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"name\",\n          \"@dbColumn\": \"product_name\"\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"description\",\n          \"@dbColumn\": \"description\"\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"price\",\n          \"@dbColumn\": \"price\"\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"isActive\",\n          \"@dbColumn\": \"is_active\"\n        }\n      }\n    ]\n  }\n}\n```\n\n**Step 3**: Generate the Product domain class:\n```bash\nmvn metaobjects:generate\n```\n\n**Step 4**: Create ProductService following the existing UserService pattern:\n```java\npackage ${package}.service;\n\nimport ${package}.domain.Product;\nimport com.metaobjects.manager.db.ObjectManagerDB;\nimport com.metaobjects.object.ValueMetaObject;\nimport com.metaobjects.MetaObject;\nimport com.metaobjects.util.MetaDataUtil;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\n@Service\n@Transactional\npublic class ProductService {\n\n    private final ObjectManagerDB objectManager;\n    private final MetaObject productMetaObject;\n\n    public ProductService(ObjectManagerDB objectManager) throws Exception {\n        this.objectManager = objectManager;\n        this.productMetaObject = MetaDataUtil.findMetaObjectByName(\"Product\", this);\n    }\n\n    public ValueMetaObject createProduct(String name, String description, BigDecimal price) throws Exception {\n        // Implementation following UserService pattern\n    }\n\n    public List<ValueMetaObject> findActiveProducts() throws Exception {\n        // Implementation following UserService pattern\n    }\n}\n```\n\n**Step 5**: Create ProductController following the existing UserController pattern:\n```java\npackage ${package}.controller;\n\nimport ${package}.service.ProductService;\nimport org.springframework.web.bind.annotation.*;\n\n@RestController\n@RequestMapping(\"/api/products\")\npublic class ProductController {\n    // Implementation following UserController pattern\n}\n```\n\n---\n\n## üéØ **UNDERSTANDING YOUR GENERATED CODE**\n\n### **Domain Objects**: `src/main/java/${packageInPathFormat}/domain/`\n\nThese classes are **generated automatically** from your metadata:\n\n- **User.java**: Complete JPA entity with validation annotations\n- **Order.java**: Order entity with decimal handling and relationships\n- **OrderItem.java**: Order item entity with computed fields\n\n**Key Features**:\n- JPA annotations based on database overlay\n- Bean validation constraints from metadata\n- Proper equals/hashCode based on identity\n- Clean toString implementations\n\n### **Service Layer**: `src/main/java/${packageInPathFormat}/service/`\n\nThese classes demonstrate **MetaObjects patterns**:\n\n- **ObjectManagerDB integration**: Direct database operations using metadata\n- **MetaObject lookups**: Dynamic object resolution by name\n- **ValueMetaObject usage**: Type-safe field access with metadata validation\n- **Transaction management**: Proper Spring transaction boundaries\n\n### **REST Controllers**: `src/main/java/${packageInPathFormat}/controller/`\n\nThese classes provide **complete CRUD APIs**:\n\n- **Standard HTTP methods**: GET, POST, PUT, DELETE\n- **Proper status codes**: 200, 201, 404, etc.\n- **JSON serialization**: Automatic ValueMetaObject to JSON conversion\n- **Validation**: Bean validation integration\n\n---\n\n## üîç **METAOBJECTS PATTERNS IN YOUR PROJECT**\n\n### **Identity System (Modern Approach)**\n\nYour project uses the **modern MetaIdentity system** (not deprecated MetaKey):\n\n```json\n{\n  \"identity\": {\n    \"name\": \"user_pk\",\n    \"subType\": \"primary\",\n    \"fields\": [\"id\"],\n    \"@generation\": \"increment\",\n    \"description\": \"Primary key for User table\"\n  }\n}\n```\n\n**Key Benefits**:\n- **Auto-generation**: Database handles ID assignment\n- **Composite support**: Multiple fields in identity\n- **Type safety**: Proper field validation\n- **Relationship clarity**: Named identities for foreign keys\n\n### **Relationship Patterns**\n\nYour project demonstrates **proper relationship modeling**:\n\n```java\n// In OrderService - finding orders for a user\npublic List<ValueMetaObject> findOrdersForUser(Long userId) throws Exception {\n    String whereClause = \"user_id = ? ORDER BY order_date DESC\";\n    Object[] parameters = {userId};\n    return objectManager.loadObjects(connection, orderMetaObject, whereClause, parameters);\n}\n\n// In OrderService - finding items for an order\npublic List<ValueMetaObject> findOrderItemsForOrder(Long orderId) throws Exception {\n    String whereClause = \"order_id = ?\";\n    Object[] parameters = {orderId};\n    return objectManager.loadObjects(connection, orderItemMetaObject, whereClause, parameters);\n}\n```\n\n### **Validation Integration**\n\nYour metadata drives **automatic validation**:\n\n- **@required**: Fields cannot be null\n- **@maxLength**: String length validation\n- **@pattern**: Regular expression validation\n- **@minValue/@maxValue**: Numeric range validation\n\nThese constraints are enforced both in:\n- **Generated domain objects** (Bean validation annotations)\n- **MetaObjects framework** (Metadata validation)\n- **Database schema** (Column constraints)\n\n---\n\n## üíæ **DATABASE INTEGRATION**\n\n### **Your Database Configuration**\n\nThe project is configured with **H2 in-memory database** for immediate testing:\n\n```properties\n# application.properties\nspring.datasource.url=jdbc:h2:mem:${artifactId}\nspring.datasource.driver-class-name=org.h2.Driver\nspring.datasource.username=sa\nspring.datasource.password=password\nspring.h2.console.enabled=true\n```\n\n### **Switching to Production Database**\n\nTo use PostgreSQL (example):\n\n**Step 1**: Update dependencies in `pom.xml`:\n```xml\n<dependency>\n    <groupId>org.postgresql</groupId>\n    <artifactId>postgresql</artifactId>\n    <scope>runtime</scope>\n</dependency>\n```\n\n**Step 2**: Update `application.properties`:\n```properties\nspring.datasource.url=jdbc:postgresql://localhost:5432/${artifactId}\nspring.datasource.driver-class-name=org.postgresql.Driver\nspring.datasource.username=your_username\nspring.datasource.password=your_password\n```\n\n**Step 3**: Update ObjectManagerDB configuration in `MetaObjectsConfiguration.java`:\n```java\nobjectManager.setDriverClass(\"com.metaobjects.manager.db.driver.PostgreSQLDriver\");\n```\n\n### **Schema Management**\n\nYour project includes **automatic table creation**:\n\n```java\n// MetaObjectsConfiguration.java\nvalidator.setAutoCreate(true); // Creates missing tables automatically\n```\n\nFor production, consider:\n- **Flyway**: Database migration management\n- **Liquibase**: Database change management\n- **Manual DDL**: Generated from metadata schemas\n\n---\n\n## üß™ **TESTING YOUR APPLICATION**\n\n### **Unit Tests**: `src/test/java/${packageInPathFormat}/service/`\n\nYour project includes **complete service tests**:\n\n```java\n@SpringBootTest\nclass UserServiceTest {\n\n    @Autowired\n    private UserService userService;\n\n    @Test\n    void createUser_ShouldGenerateIdAndPersist() throws Exception {\n        // Test auto-generation of IDs\n        // Verify database persistence\n        // Check constraint validation\n    }\n}\n```\n\n### **Integration Tests**: `src/test/java/${packageInPathFormat}/integration/`\n\nYour project includes **database integration tests**:\n\n```java\n@SpringBootTest\n@Transactional\nclass DatabaseIntegrationTest {\n\n    @Test\n    void metaObjectsSchemaCreation_ShouldCreateAllTables() throws Exception {\n        // Verify table creation from metadata\n        // Test relationship constraints\n        // Validate index creation\n    }\n}\n```\n\n### **API Testing**\n\nTest your REST endpoints:\n\n```bash\n# Create test script\ncat > test-api.sh << 'EOF'\n#!/bin/bash\necho \"Testing ${artifactId} API...\"\n\n# Create user\nUSER_ID=$(curl -s -X POST http://localhost:8080/api/users \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\":\"testuser\",\"email\":\"test@example.com\",\"firstName\":\"Test\",\"lastName\":\"User\"}' \\\n  | jq -r '.id')\n\necho \"Created user with ID: $USER_ID\"\n\n# Get user\ncurl -s http://localhost:8080/api/users/$USER_ID | jq '.'\n\n# Create order\nORDER_ID=$(curl -s -X POST http://localhost:8080/api/orders \\\n  -H \"Content-Type: application/json\" \\\n  -d \"{\\\"userId\\\":$USER_ID,\\\"orderNumber\\\":\\\"ORD-1234567890\\\",\\\"totalAmount\\\":99.99,\\\"status\\\":\\\"PENDING\\\"}\" \\\n  | jq -r '.id')\n\necho \"Created order with ID: $ORDER_ID\"\n\n# List orders for user\ncurl -s \"http://localhost:8080/api/orders?userId=$USER_ID\" | jq '.'\nEOF\n\nchmod +x test-api.sh\n./test-api.sh\n```\n\n---\n\n## üìà **PERFORMANCE OPTIMIZATION**\n\n### **MetaObjects Performance Patterns**\n\nYour project follows **MetaObjects performance best practices**:\n\n```java\n// ‚úÖ GOOD - Cache MetaDataLoader instances\n@Bean\n@Singleton\npublic FileMetaDataLoader metaDataLoader() throws Exception {\n    // Loaded once at startup, cached permanently\n}\n\n// ‚úÖ GOOD - Reuse MetaObject references\nprivate final MetaObject userMetaObject; // Cached at service startup\n\n// ‚úÖ GOOD - Batch operations when possible\npublic void createMultipleUsers(List<CreateUserRequest> requests) throws Exception {\n    try (ObjectConnection connection = objectManager.getConnection()) {\n        for (CreateUserRequest request : requests) {\n            // Process in single transaction\n        }\n    }\n}\n```\n\n### **Database Performance**\n\nYour project includes **database optimization patterns**:\n\n- **Connection pooling**: Configured via Spring Boot\n- **Transaction management**: Service-level boundaries\n- **Index creation**: Driven by metadata identities\n- **Query optimization**: Proper WHERE clause usage\n\n### **Memory Management**\n\nYour project follows **MetaObjects memory patterns**:\n\n- **WeakHashMap caches**: Automatic cleanup during memory pressure\n- **Permanent metadata**: Loaded once, cached forever\n- **OSGI compatibility**: Bundle-safe classloader patterns\n\n---\n\n## üîß **TROUBLESHOOTING**\n\n### **Common Issues in Your Project**\n\n#### **\"MetaData not found\" Errors**\n```\nMetaDataNotFoundException: No MetaObject found with name 'User'\n```\n\n**Solution**: Check metadata file loading in `MetaObjectsConfiguration.java`:\n```java\n// Verify paths are correct\nloader.addSourceURI(getClass().getResource(\"/metadata/application-metadata.json\").toURI());\nloader.addSourceURI(getClass().getResource(\"/metadata/database-overlay.json\").toURI());\n```\n\n#### **Database Connection Issues**\n```\nUnable to connect to database: jdbc:h2:mem:${artifactId}\n```\n\n**Solution**: Check H2 configuration in `application.properties`:\n- Verify database URL format\n- Check H2 dependency is included\n- Ensure Spring Boot autoconfiguration is enabled\n\n#### **Code Generation Issues**\n```\nUnable to generate domain objects from metadata\n```\n\n**Solution**: Run generation manually and check output:\n```bash\nmvn metaobjects:generate -X  # Debug output\nmvn clean compile           # Full rebuild\n```\n\n#### **Identity Generation Issues**\n```\nSQLException: Attempt to modify an identity column 'ID'\n```\n\n**Solution**: Check identity configuration in metadata:\n- Ensure `@generation\": \"increment\"` is set\n- Verify primary identity exists\n- Don't manually set ID values for auto-generated fields\n\n### **Debug Configuration**\n\nAdd to `application.properties` for detailed logging:\n```properties\n# MetaObjects debug logging\nlogging.level.com.metaobjects=DEBUG\nlogging.level.${package}=DEBUG\n\n# SQL logging\nlogging.level.org.hibernate.SQL=DEBUG\nlogging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE\n\n# H2 database logging\nlogging.level.org.h2=DEBUG\n```\n\n---\n\n## üìö **NEXT STEPS FOR YOUR PROJECT**\n\n### **Immediate Enhancements**\n\n1. **Add Product Entity**: Follow the example in this guide\n2. **Implement Product-Order Relationships**: Many-to-many through OrderItem\n3. **Add User Authentication**: Spring Security integration\n4. **Create Web UI**: React frontend with MetaObjects components\n\n### **Production Readiness**\n\n1. **Switch Database**: PostgreSQL, MySQL, or SQL Server\n2. **Add Monitoring**: Spring Boot Actuator + Micrometer\n3. **Implement Caching**: Redis or Hazelcast integration\n4. **Security Hardening**: HTTPS, authentication, authorization\n5. **Container Deployment**: Docker + Kubernetes\n\n### **MetaObjects Advanced Features**\n\n1. **Dynamic Metadata Updates**: Runtime metadata modification\n2. **Custom Code Generation**: Specialized Mustache templates\n3. **Multi-Database Support**: Different databases per entity\n4. **Event-Driven Architecture**: MetaObjects with message queues\n5. **Microservices Patterns**: MetaObjects in distributed systems\n\n---\n\n## ü§ù **GETTING HELP**\n\n### **Claude Code Integration**\n\nThis guide is optimized for **Claude Code assistance**. When asking Claude for help:\n\n‚úÖ **Include context**: \"I'm working on the ${artifactId} MetaObjects project...\"\n‚úÖ **Reference files**: \"Based on my application-metadata.json and UserService.java...\"\n‚úÖ **Be specific**: \"Following the pattern in OrderService, how do I...\"\n‚úÖ **Share errors**: Include complete stack traces and configuration\n\n### **Example Claude Interactions**\n\n```\nQ: \"How do I add a Category entity that has a many-to-many relationship with Product?\"\n\nA: \"Based on your ${artifactId} project structure, I can see you're following\nMetaObjects patterns. Here's how to add Category with many-to-many Product relationship:\n\n1. Add Category metadata to your application-metadata.json following your\n   existing User/Order pattern...\n2. Create a ProductCategory junction entity following your OrderItem pattern...\n3. Update your ProductService following the relationship patterns in OrderService...\"\n```\n\n### **Support Resources**\n\n- **Framework Documentation**: https://docs.metaobjects.com\n- **GitHub Issues**: https://github.com/metaobjectsdev/metaobjects-core/issues\n- **Community Examples**: https://github.com/metaobjectsdev/metaobjects-examples\n- **This Project**: All examples and patterns included in your generated code\n\n---\n\n## üèÜ **PROJECT SUCCESS METRICS**\n\n### **Immediate Success Indicators**\n\n‚úÖ **Application starts**: `mvn spring-boot:run` works without errors\n‚úÖ **Database creates**: H2 tables created automatically\n‚úÖ **API responds**: All REST endpoints return valid responses\n‚úÖ **Tests pass**: Unit and integration tests execute successfully\n‚úÖ **Code generates**: Domain objects update when metadata changes\n\n### **Development Velocity Indicators**\n\n‚úÖ **New entities**: Can add new entities in minutes, not hours\n‚úÖ **Database changes**: Schema updates driven by metadata changes\n‚úÖ **API expansion**: New endpoints follow established patterns\n‚úÖ **Testing**: Comprehensive test coverage with minimal boilerplate\n‚úÖ **Documentation**: Self-documenting through metadata and generation\n\n### **Architecture Quality Indicators**\n\n‚úÖ **Separation of concerns**: Clear boundaries between layers\n‚úÖ **Metadata consistency**: Single source of truth for domain model\n‚úÖ **Database independence**: Easy database switching\n‚úÖ **Framework independence**: Clean architecture patterns\n‚úÖ **Maintenance efficiency**: Changes propagate automatically through generation\n\n---\n\n**üöÄ Your ${artifactId} MetaObjects application is ready for amazing development! üöÄ**\n\n**Key Success Factors:**\n- **Metadata-driven development** eliminates boilerplate\n- **Automatic code generation** maintains consistency\n- **Database integration** handles persistence complexity\n- **Spring Boot integration** provides production features\n- **Comprehensive testing** ensures reliability\n- **Claude Code integration** accelerates development\n\n**Start building features immediately - the foundation is complete!**\n\n---\n\n## Context7 Integration\n\nWhen answering questions about libraries, frameworks, or APIs, use the Context7 MCP tools to fetch current documentation rather than relying on training data. This ensures responses include up-to-date, version-specific information.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/archetype/src/main/resources/archetype-resources/.claude/CLAUDE.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "claude",
        "database",
        "md"
      ],
      "content_hash": "0c0cb6ec12cb727d",
      "size_bytes": 21998,
      "created_at": "2026-01-02T20:42:12.428192"
    },
    {
      "doc_id": "local_metaobjects-core__claude_README",
      "source": "local",
      "category": "knowledge_base",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/README.md",
      "content": "# MetaObjects Core - Claude Code Guide\n\n**Universal metadata-driven development platform for enterprise AI at scale**\n\n---\n\n## Quick Reference\n\n| Topic | File | Description |\n|-------|------|-------------|\n| **Architecture** | [ARCHITECTURE.md](ARCHITECTURE.md) | Core design principles, patterns, OSGI compatibility |\n| **Setup & Build** | [SETUP.md](SETUP.md) | Maven commands, IDE setup, dependencies |\n| **Current Work** | [CONTEXT.md](CONTEXT.md) | Recent changes, what's in progress, session notes |\n| **Known Issues** | [KNOWN-ISSUES.md](KNOWN-ISSUES.md) | Bugs, limitations, lessons learned |\n| **Type System** | [docs/type-system.md](docs/type-system.md) | AI-optimized field types, cross-language mapping |\n| **Constraints** | [docs/constraints.md](docs/constraints.md) | Fluent constraint system, validation patterns |\n| **Persistence** | [docs/persistence.md](docs/persistence.md) | ObjectManager, database integration patterns |\n| **Testing** | [docs/testing.md](docs/testing.md) | Unit test setup, best practices |\n| **React Integration** | [docs/react-integration.md](docs/react-integration.md) | MetaView components, TypeScript integration |\n\n---\n\n## Project Overview\n\n**MetaObjects Core** is a Java-based metadata framework providing sophisticated control over applications beyond traditional model-driven development.\n\n- **Version:** 6.2.5-SNAPSHOT (Maven Central Ready)\n- **Java:** 17 LTS (Production Ready)\n- **Build:** Maven\n- **License:** Apache License 2.0\n- **URL:** https://metaobjects.com\n\n### What is MetaObjects?\n\nMetaObjects is analogous to Java's reflection system, but for runtime metadata:\n\n| Java Reflection | MetaObjects Framework |\n|----------------|----------------------|\n| `Class.forName()` | `loader.getMetaObjectByName()` |\n| `Class.getFields()` | `metaObject.getMetaFields()` |\n| `Field.get(object)` | `metaField.getValue(object)` |\n| Permanent in memory | Permanent MetaData cache |\n| Thread-safe reads | Thread-safe metadata access |\n\n**Key Principle:** Read-optimized with controlled mutability (99.9% reads, rare updates)\n\n---\n\n## Quick Start\n\n### Build Entire Project\n```bash\ncd ~/Development/metaobjects-core\nmvn clean compile      # Compile all modules\nmvn test              # Run all tests\nmvn package           # Build JARs\n```\n\n### Build Specific Module\n```bash\ncd metadata && mvn compile\ncd core && mvn compile\n```\n\n### Run Tests\n```bash\nmvn test                                    # All tests\ncd metadata && mvn test -Dtest=ConstraintSystemTest  # Specific test\n```\n\n---\n\n## Project Structure\n\n```\nmetaobjects-core/\n‚îú‚îÄ‚îÄ metadata/          # Core metadata models (MetaObject, MetaField, etc.)\n‚îú‚îÄ‚îÄ codegen/          # Code generation utilities\n‚îú‚îÄ‚îÄ core/             # Core framework implementation\n‚îú‚îÄ‚îÄ maven-plugin/     # Maven plugin for schema generation\n‚îú‚îÄ‚îÄ objectmanager/    # Persistence layer base\n‚îú‚îÄ‚îÄ objectmanager-rdb/   # Relational database support\n‚îú‚îÄ‚îÄ objectmanager-nosql/ # NoSQL database support\n‚îú‚îÄ‚îÄ web/              # Web integration (React, Spring)\n‚îú‚îÄ‚îÄ demo/             # Demo applications (FishStore)\n‚îî‚îÄ‚îÄ archetype/        # Maven archetype for new projects\n```\n\n**Total:** 10 Maven modules\n\n---\n\n## Module Dependency Order\n\nBuild respects this dependency hierarchy:\n1. `metadata` - Base metadata models\n2. `codegen` - Code generation (depends on metadata)\n3. `core` - Core framework (depends on metadata, codegen)\n4. `maven-plugin` - Maven tooling (depends on core)\n5. `objectmanager` - Persistence base (depends on core)\n6. `objectmanager-rdb` - RDB support (depends on objectmanager)\n7. `objectmanager-nosql` - NoSQL support (depends on objectmanager)\n8. `web` - Web integration (depends on core)\n9. `demo` - Demos (depends on web, objectmanager)\n10. `archetype` - Project templates\n\n---\n\n## Recent Major Achievements\n\n### ‚úÖ AI-Optimized Type System (v6.3.0+)\n- **33% complexity reduction** in field types\n- 8 fragmented types ‚Üí 6 core semantic types\n- Universal `@isArray` modifier eliminates type explosion\n- Cross-language mapping: Java, C#, TypeScript, Node.js\n- See [docs/type-system.md](docs/type-system.md) for details\n\n### ‚úÖ Maven Central Publishing Ready (v6.2.5)\n- Complete POM metadata\n- Source/Javadoc JARs configured\n- Nexus deployment profile ready\n- Apache License 2.0\n\n### ‚úÖ Comprehensive Modernization (2024-2025)\n- Java 17 LTS migration\n- Constraint system refactoring\n- Test coverage improvements\n- ServiceLoader resolution\n- See [CONTEXT.md](CONTEXT.md) for details\n\n---\n\n## Core Technologies\n\n- **Java 21** (source/target: 17 LTS)\n- **Maven 3.8+**\n- **SLF4J + Logback** (logging)\n- **JUnit 4.13.2** (testing)\n- **Gson 2.13.1** (JSON)\n- **React + TypeScript** (web UI)\n- **Redux Toolkit** (state management)\n- **OSGi** compatible (Apache Felix)\n\n---\n\n## Development Workflow\n\n### 1. Make Changes\n```bash\n# Edit files in appropriate module\nvim metadata/src/main/java/com/draagon/meta/...\n```\n\n### 2. Test Locally\n```bash\ncd metadata\nmvn test\n```\n\n### 3. Build & Verify\n```bash\ncd ~/Development/metaobjects-core\nmvn clean package\n```\n\n### 4. Generate Schemas (if metadata changed)\n```bash\ncd core\nmvn metaobjects:generate@gen-schemas\n```\n\n---\n\n## Critical Architectural Principles\n\n### ‚ö†Ô∏è READ-OPTIMIZED DESIGN\n\nMetaObjects is **NOT** a typical data access pattern. It's analogous to Java's ClassLoader:\n\n1. **Heavy startup, fast runtime** - Metadata loaded once at startup\n2. **Permanent in memory** - Like `Class` objects, stays loaded\n3. **Thread-safe reads** - No synchronization needed (99.9% of operations)\n4. **Rare controlled updates** - Copy-on-Write for dynamic changes\n5. **OSGI compatible** - WeakReference caching for bundle unload safety\n\n**DO NOT** treat MetaData objects as frequently mutable domain objects!\n\nSee [ARCHITECTURE.md](ARCHITECTURE.md) for deep dive.\n\n---\n\n## Getting Help\n\n### Documentation Navigation\n\n**Start here:**\n1. Read this README for overview\n2. Check [CONTEXT.md](CONTEXT.md) for recent work\n3. Review [ARCHITECTURE.md](ARCHITECTURE.md) for design principles\n4. Follow [SETUP.md](SETUP.md) for build details\n\n**Specific topics:**\n- Type system design ‚Üí [docs/type-system.md](docs/type-system.md)\n- Validation ‚Üí [docs/constraints.md](docs/constraints.md)\n- Database integration ‚Üí [docs/persistence.md](docs/persistence.md)\n- Testing ‚Üí [docs/testing.md](docs/testing.md)\n- React/TypeScript ‚Üí [docs/react-integration.md](docs/react-integration.md)\n\n### Known Issues & Lessons\n\nCheck [KNOWN-ISSUES.md](KNOWN-ISSUES.md) for:\n- OSGI compatibility pitfalls (avoid these mistakes!)\n- ServiceLoader resolution patterns\n- Testing gotchas\n- Performance considerations\n\n---\n\n## Next Steps\n\n### For New Claude Code Sessions\n\n1. Read [CONTEXT.md](CONTEXT.md) - See what's currently in progress\n2. Check [KNOWN-ISSUES.md](KNOWN-ISSUES.md) - Avoid known pitfalls\n3. Review relevant docs/ files for your task\n4. **Update CONTEXT.md** at end of session with changes made\n\n### For Development Work\n\n1. Understand the architecture ([ARCHITECTURE.md](ARCHITECTURE.md))\n2. Set up build environment ([SETUP.md](SETUP.md))\n3. Read topic-specific docs as needed\n4. Run tests after changes\n5. Update CONTEXT.md with progress\n\n---\n\n**Last Updated:** 2025-11-15\n**Maintainer:** Doug Mealing (doug@dougmealing.com)\n**Organization:** Doug Mealing LLC dba MetaObjects\n**License:** Apache License 2.0\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "readme"
      ],
      "content_hash": "58bbfda4c32b7566",
      "size_bytes": 7381,
      "created_at": "2026-01-02T20:42:12.428335"
    },
    {
      "doc_id": "local_metaobjects-core__claude_CONTEXT",
      "source": "local",
      "category": "knowledge_base",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/CONTEXT.md",
      "content": "# MetaObjects Core - Current Context\n\n**What's happening now, recent changes, and active work**\n\n**Last Updated:** 2025-11-15\n\n---\n\n## Current Version Status\n\n- **Version:** 6.2.5-SNAPSHOT\n- **Status:** ‚úÖ Maven Central Publishing Ready\n- **Java:** 17 LTS (Production Ready)\n- **Build:** All tests passing\n- **License:** Apache License 2.0\n\n---\n\n## Recent Major Achievements\n\n### ‚úÖ AI-Optimized Type System (v6.3.0+) - COMPLETED\n\n**Achievement:** 33% complexity reduction in field type system\n\n**What Changed:**\n- Reduced from 8 fragmented field types to 6 core semantic types\n- Removed separate array types (ByteArrayField, IntArrayField, etc.)\n- Added universal `@isArray` modifier - eliminates type explosion\n- Added `DecimalField` for high-precision financial calculations\n- Fixed mathematically incorrect precision/scale on floating point types\n\n**Final Field Types:**\n| Type | Java | C# | TypeScript | Usage |\n|------|------|----|-----------| ------|\n| `string` | String | string | string | Text data |\n| `int` | Integer | int | number | Whole numbers, normal range |\n| `long` | Long | long | number | Whole numbers, large range |\n| `float` | Float | float | number | Decimal, standard precision |\n| `double` | Double | double | number | Decimal, high precision |\n| `decimal` | BigDecimal | decimal | Decimal | Financial, exact precision |\n\n**Impact:**\n- Better AI code generation across Java, C#, TypeScript, Node.js\n- Cleaner metadata definitions\n- Simplified validation logic\n- Cross-language semantic consistency\n\n**Documentation:** See [docs/type-system.md](docs/type-system.md)\n\n---\n\n### ‚úÖ Maven Central Publishing Readiness (v6.2.5) - COMPLETED\n\n**What Was Done:**\n- Complete POM metadata (name, description, URL, organization)\n- Source and Javadoc JAR configuration\n- Nexus deployment profile created\n- GPG signing configuration\n- Apache License 2.0 files included\n- SCM information added\n\n**Status:** Ready to publish when needed\n\n**Next Step:** Deploy to Maven Central staging repository\n\n---\n\n### ‚úÖ Comprehensive Modernization (2024-2025) - COMPLETED\n\n**Major Updates:**\n1. **Java 17 LTS Migration**\n   - Updated from Java 8\n   - Leveraged new language features\n   - Maintained compatibility with Java 21\n\n2. **Constraint System Refactoring**\n   - Provider-based registration system\n   - PlacementConstraint and ValidationConstraint patterns\n   - Build-time validation\n   - See [docs/constraints.md](docs/constraints.md)\n\n3. **Test Coverage Improvements**\n   - All modules have comprehensive tests\n   - Constraint naming tests added\n   - ServiceLoader discovery tests\n   - See [docs/testing.md](docs/testing.md)\n\n4. **ServiceLoader Resolution**\n   - Fixed provider discovery issues\n   - OSGi compatibility ensured\n   - Proper META-INF/services configuration\n\n5. **Documentation Overhaul**\n   - Organized .claude/ directory structure\n   - Topic-specific documentation files\n   - Improved navigation and discoverability\n\n---\n\n## Active Work Areas\n\n### üîÑ Currently In Progress\n\n**None** - All major work completed, stable state\n\n### üìã Planned Next Steps\n\n1. **Publish to Maven Central**\n   - Deploy 6.2.5 release\n   - Announce availability\n   - Update documentation with Maven coordinates\n\n2. **Enhance React Integration**\n   - Additional MetaView components\n   - TypeScript type improvements\n   - Redux Toolkit enhancements\n\n3. **Performance Profiling**\n   - Benchmark metadata loading times\n   - Optimize cache access patterns\n   - Memory usage analysis\n\n4. **Documentation Expansion**\n   - More code examples\n   - Tutorial series\n   - Video walkthroughs\n\n---\n\n## Recent Bug Fixes\n\n### Fixed in Recent Sessions\n\n1. **ServiceLoader Provider Discovery**\n   - **Issue:** Providers not being discovered at runtime\n   - **Fix:** Proper META-INF/services file configuration\n   - **Status:** ‚úÖ Resolved\n\n2. **Constraint Naming Validation**\n   - **Issue:** Inconsistent constraint naming across providers\n   - **Fix:** Enforced naming conventions in tests\n   - **Status:** ‚úÖ Resolved\n\n3. **OSGi Bundle Compatibility**\n   - **Issue:** Memory leaks when bundles unload\n   - **Fix:** WeakHashMap usage for computed caches\n   - **Status:** ‚úÖ Resolved\n\n4. **Schema Generation Errors**\n   - **Issue:** Maven plugin not generating schemas correctly\n   - **Fix:** Updated plugin configuration\n   - **Status:** ‚úÖ Resolved\n\n---\n\n## Technical Debt\n\n### Known Areas for Future Improvement\n\n1. **ObjectManager Modernization**\n   - Legacy code in objectmanager modules\n   - Could benefit from modern Java patterns\n   - Works fine, but not urgent\n   - Priority: LOW\n\n2. **Demo Application Updates**\n   - FishStore demo could use UI refresh\n   - Add more complex examples\n   - Priority: LOW\n\n3. **Test Logging Cleanup**\n   - Some verbose logging in tests\n   - Could be quieter by default\n   - Priority: LOW\n\n4. **React Component Library**\n   - Limited MetaView components currently\n   - Opportunity to expand component set\n   - Priority: MEDIUM\n\n---\n\n## Dependencies to Watch\n\n### Potential Updates Needed\n\n- **Gson 2.13.1** - Check for newer versions periodically\n- **JUnit 4.13.2** - Consider migrating to JUnit 5 eventually\n- **Logback 1.5.16** - Keep updated with SLF4J\n- **React/TypeScript** - Web module dependencies\n\n**Current Status:** All dependencies current and stable\n\n---\n\n## Breaking Changes Since Last Major Version\n\n### v6.2.5 vs v6.1.0\n\n**Field Type System Changes:**\n- Removed: `ByteField`, `ShortField`, separate array field types\n- Added: `DecimalField`, `@isArray` modifier\n- Migration: Update metadata JSON files to use new types\n\n**Constraint System Changes:**\n- Provider-based registration now required\n- Direct MetaDataRegistry manipulation deprecated\n- Migration: Implement MetaDataTypeProvider for custom types\n\n**No other breaking changes** - Most updates are internal improvements\n\n---\n\n## Session Notes\n\n### 2025-11-15: .claude Directory Restructuring\n\n**What Happened:**\n- Reorganized massive 226KB CLAUDE.md into structured documentation\n- Created README.md, ARCHITECTURE.md, SETUP.md, CONTEXT.md\n- Created KNOWN-ISSUES.md for common pitfalls\n- Organized topic-specific docs in docs/ directory\n- Improved navigation and discoverability\n\n**Files Created:**\n- `.claude/README.md` - Quick overview and navigation\n- `.claude/ARCHITECTURE.md` - Core design principles (719 lines)\n- `.claude/SETUP.md` - Build and IDE setup guide\n- `.claude/CONTEXT.md` - This file\n- `.claude/KNOWN-ISSUES.md` - Common problems and solutions\n- `.claude/docs/` - Topic-specific documentation\n\n**Benefits:**\n- Faster context loading for Claude Code\n- Easier navigation to relevant information\n- Better organization for future updates\n- Reduced cognitive load when switching contexts\n\n---\n\n## Quick Reference for Next Session\n\n### If Working On:\n\n**New Field Type:**\n1. Read [ARCHITECTURE.md](ARCHITECTURE.md) - Abstract Base + Concrete Subtypes pattern\n2. Review [docs/type-system.md](docs/type-system.md) - Current field types\n3. Check [docs/constraints.md](docs/constraints.md) - Validation patterns\n4. Follow [SETUP.md](SETUP.md) - Build and test\n\n**Persistence:**\n1. Read [docs/persistence.md](docs/persistence.md) - ObjectManager patterns\n2. Check RDB and NoSQL modules for examples\n\n**Web/React:**\n1. Read [docs/react-integration.md](docs/react-integration.md)\n2. Review web module for existing components\n\n**Bug Fix:**\n1. Check [KNOWN-ISSUES.md](KNOWN-ISSUES.md) first\n2. Review [docs/testing.md](docs/testing.md) for test patterns\n3. Follow [SETUP.md](SETUP.md) for build commands\n\n---\n\n## Status Summary\n\n**Overall Status:** ‚úÖ Healthy, stable, ready for Maven Central publication\n\n**Build Status:** ‚úÖ All tests passing\n**Dependencies:** ‚úÖ All current and secure\n**Documentation:** ‚úÖ Well-organized and comprehensive\n**Technical Debt:** ‚ö†Ô∏è Minimal, low priority items only\n\n**Confidence Level:** HIGH - Ready for production use\n\n---\n\n**End of Context**\n\n*Update this file at the end of each coding session with:*\n- *What was worked on*\n- *What changed*\n- *What's next*\n- *Any new issues discovered*\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/CONTEXT.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "9f1fa8d67c0d6338",
      "size_bytes": 8039,
      "created_at": "2026-01-02T20:42:12.428399"
    },
    {
      "doc_id": "local_metaobjects-core__claude_KNOWN-ISSUES",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/KNOWN-ISSUES.md",
      "content": "# MetaObjects Core - Known Issues & Lessons Learned\n\n**Common problems, gotchas, and hard-learned lessons**\n\n**Last Updated:** 2025-11-15\n\n---\n\n## üö® Critical Lessons Learned\n\n### DON'T Treat MetaData as Mutable Domain Objects\n\n**‚ùå WRONG:**\n```java\nMetaObject userMeta = loader.getMetaObjectByName(\"User\");\nuserMeta.addMetaField(new StringField(\"dynamicField\")); // ‚ùå Runtime mutation\n```\n\n**‚úÖ RIGHT:**\n```java\nMetaObject userMeta = loader.getMetaObjectByName(\"User\");\nMetaField field = userMeta.getMetaField(\"email\"); // ‚úÖ Read-only access\n```\n\n**Why:** MetaObjects is like Java's ClassLoader - load once, read many times. Treating it like a mutable entity breaks the read-optimized architecture and causes thread-safety issues.\n\n---\n\n### DON'T Replace WeakHashMap with Strong References\n\n**‚ùå WRONG:**\n```java\nprivate final Map<Object, Object> cache = new ConcurrentHashMap<>(); // ‚ùå Causes memory leaks\n```\n\n**‚úÖ RIGHT:**\n```java\nprivate final Map<Object, Object> cache = Collections.synchronizedMap(new WeakHashMap<>()); // ‚úÖ\n```\n\n**Why:** In OSGi environments, bundles can be unloaded. Strong references prevent garbage collection of computed caches, causing memory leaks. WeakHashMap allows GC cleanup when bundles unload.\n\n---\n\n###DON'T Create New MetaDataLoader Instances Frequently\n\n**‚ùå WRONG:**\n```java\nfor (String source : sources) {\n    MetaDataLoader loader = new SimpleLoader(source); // ‚ùå Expensive!\n    loader.init();\n}\n```\n\n**‚úÖ RIGHT:**\n```java\nMetaDataLoader appLoader = new SimpleLoader(\"appMetadata\");\nappLoader.setSourceURIs(allSources);\nappLoader.init(); // ‚úÖ Load once, use forever\n```\n\n**Why:** MetaDataLoader is analogous to ClassLoader - expensive initialization, meant to be created once per application context.\n\n---\n\n### DON'T Synchronize Read Operations After Loading\n\n**‚ùå WRONG:**\n```java\npublic synchronized MetaField getMetaField(String name) { // ‚ùå Kills performance\n    return fieldCache.get(name);\n}\n```\n\n**‚úÖ RIGHT:**\n```java\npublic MetaField getMetaField(String name) { // ‚úÖ Lock-free reads\n    return fieldCache.get(name); // Immutable after loading\n}\n```\n\n**Why:** After loading phase, metadata is immutable. Synchronization on reads creates unnecessary contention and destroys the performance benefits of read-optimization.\n\n---\n\n### DON'T Use Single Concrete Classes with String-Based Subtype Checking\n\n**‚ùå WRONG:**\n```java\npublic class MetaValidator extends MetaData {\n    public boolean isRequired() {\n        return \"required\".equals(getSubTypeName()); // ‚ùå String checking\n    }\n}\n```\n\n**‚úÖ RIGHT:**\n```java\npublic abstract class MetaValidator extends MetaData { /* base class */ }\n\npublic class RequiredValidator extends MetaValidator {\n    // ‚úÖ Type-specific implementation\n    @Override\n    public void validate(Object value) { /* ... */ }\n}\n```\n\n**Why:** Abstract Base + Concrete Subtypes pattern provides type safety, better APIs, and cleaner code. See [ARCHITECTURE.md](ARCHITECTURE.md) for details.\n\n---\n\n## ‚ö†Ô∏è OSGi Compatibility Pitfalls\n\n### Issue: Memory Leaks When Bundles Unload\n\n**Problem:** Strong references to computed caches prevent GC when OSGi bundles unload\n\n**Solution:**\n- Use `WeakHashMap` for computed/derived caches\n- Use `ConcurrentHashMap` only for permanent metadata references\n- Use `WeakReference` for ClassLoader references\n\n**Example:**\n```java\n// PERMANENT CACHE - Strong references\nprivate final Map<String, Object> permanentCache = new ConcurrentHashMap<>();\n\n// COMPUTED CACHE - Weak references\nprivate final Map<Object, Object> computedCache = Collections.synchronizedMap(new WeakHashMap<>());\n```\n\n**Status:** ‚úÖ Implemented correctly throughout framework\n\n---\n\n### Issue: ServiceLoader Not Finding Providers in OSGi\n\n**Problem:** `META-INF/services/` files not being read correctly in OSGi bundles\n\n**Solution:**\n1. Ensure `META-INF/services/` directory is in the bundle\n2. Use proper ClassLoader for ServiceLoader:\n   ```java\n   ServiceLoader.load(MetaDataTypeProvider.class, this.getClass().getClassLoader())\n   ```\n3. Verify OSGi manifest includes service files\n\n**Status:** ‚úÖ Fixed with proper ClassLoader usage\n\n---\n\n## üêõ Common Build Issues\n\n### Issue: \"Cannot Find Symbol\" Errors\n\n**Cause:** Module dependencies not resolved in local Maven repository\n\n**Solution:**\n```bash\nmvn clean install  # Install all modules to ~/.m2/repository\n```\n\n**Prevention:** Always `mvn install` after pulling latest code\n\n---\n\n### Issue: Tests Fail with ServiceLoader Errors\n\n**Cause:** Missing or incorrect `META-INF/services/` provider files\n\n**Solution:**\n1. Check file exists: `src/main/resources/META-INF/services/com.draagon.meta.loader.types.MetaDataTypeProvider`\n2. Verify provider class name is correct (fully qualified)\n3. Ensure provider class is on classpath\n\n**Example Provider File:**\n```\n# META-INF/services/com.draagon.meta.loader.types.MetaDataTypeProvider\ncom.draagon.meta.field.FieldTypesMetaDataProvider\ncom.draagon.meta.validator.ValidatorTypesMetaDataProvider\n```\n\n---\n\n### Issue: OSGi Manifest Generation Fails\n\n**Cause:** Module not configured as OSGi bundle\n\n**Solution:**\nEnsure `pom.xml` has:\n```xml\n<packaging>bundle</packaging>\n\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.apache.felix</groupId>\n            <artifactId>maven-bundle-plugin</artifactId>\n        </plugin>\n    </plugins>\n</build>\n```\n\n---\n\n### Issue: Schema Generation Doesn't Run\n\n**Cause:** MetaObjects Maven Plugin not finding metadata files\n\n**Solution:**\n1. Verify metadata files in `src/main/resources/metadata/`\n2. Run from `core` module: `cd core && mvn metaobjects:generate@gen-schemas`\n3. Check plugin configuration in `core/pom.xml`\n\n---\n\n## üîß Development Gotchas\n\n### Gotcha: Adding Validation to Core Types\n\n**Problem:** Adding rigid validation to base classes prevents extensibility\n\n**DON'T:**\n```java\npublic class MetaField extends MetaData {\n    private static final Set<String> ALLOWED_SUBTYPES = Set.of(\"string\", \"int\"); // ‚ùå Rigid!\n\n    public MetaField(String subType) {\n        if (!ALLOWED_SUBTYPES.contains(subType)) { // ‚ùå Prevents plugins!\n            throw new IllegalArgumentException(\"Invalid subtype\");\n        }\n    }\n}\n```\n\n**DO:**\n```java\n// Use constraint system for validation\n// Add constraints in META-INF/constraints/*.json\n// Allows extensibility through provider system\n```\n\n**Why:** Hardcoded validation prevents downstream implementations from extending subtypes through the provider system.\n\n---\n\n### Gotcha: Forgetting to Flush Caches After Structural Changes\n\n**Problem:** After adding/removing child metadata during loading, caches may be stale\n\n**Solution:**\n```java\npublic synchronized void addChild(MetaData child) {\n    children.add(child);\n    flushCaches(); // ‚ö†Ô∏è Don't forget this!\n}\n```\n\n**Why:** Computed caches (like field lookups) may return stale data if not flushed after structural changes.\n\n---\n\n### Gotcha: Using Wrong ClassLoader for Resource Loading\n\n**Problem:** Resources not found in OSGi environments\n\n**Solution:**\n```java\n// ‚ùå WRONG\nInputStream stream = ClassLoader.getSystemResourceAsStream(\"metadata.json\");\n\n// ‚úÖ RIGHT\nInputStream stream = this.getClass().getClassLoader().getResourceAsStream(\"metadata.json\");\n```\n\n**Why:** In OSGi, `getSystemClassLoader()` doesn't have access to bundle resources.\n\n---\n\n## üìä Performance Considerations\n\n### Issue: Slow Metadata Loading\n\n**Expected:** 100ms-1s for typical metadata sets\n**If Slower:** Check for:\n- Excessive validation during loading\n- Large metadata files (>10MB)\n- Network-based URIs (use local files when possible)\n- Recursive/circular dependencies\n\n**Optimization:**\n- Cache loaded metadata at application level\n- Use file-based URIs instead of HTTP\n- Lazy-load non-critical metadata\n\n---\n\n### Issue: High Memory Usage\n\n**Expected:** 10-50MB for typical metadata sets\n**If Higher:** Check for:\n- Memory leaks (strong references in computed caches)\n- Duplicate loaders (should have one loader per context)\n- Excessive computed cache entries\n\n**Monitoring:**\n```java\n// Add to HybridCache for monitoring\npublic int getCacheSize() {\n    return modernCache.size() + legacyCache.size();\n}\n```\n\n---\n\n## üß™ Testing Gotchas\n\n### Gotcha: Tests Pass Individually, Fail Together\n\n**Cause:** Static state not being reset between tests\n\n**Solution:**\n```java\n@After\npublic void tearDown() {\n    // Clear any static caches\n    MetaDataCache.clear();\n    MetaDataRegistry.reset(); // If available\n}\n```\n\n---\n\n### Gotcha: Constraint Tests Failing with \"Name Required\"\n\n**Cause:** Constraint naming conventions not followed\n\n**Solution:**\nEnsure all constraints have format: `{domain}:{type}:{operation}`\n\nExample:\n```json\n{\n  \"name\": \"metadata:field:placement\",\n  \"type\": \"placement\",\n  ...\n}\n```\n\nSee [docs/constraints.md](docs/constraints.md) for naming conventions.\n\n---\n\n## üîÑ Migration Issues\n\n### Migrating from v6.1.0 to v6.2.5\n\n**Breaking Changes:**\n\n1. **Field Type Changes:**\n   - `ByteField`, `ShortField` removed ‚Üí use `IntegerField`\n   - Separate array types removed ‚Üí use `@isArray: true`\n   - Added `DecimalField` for high-precision decimals\n\n   **Migration:**\n   ```json\n   // OLD\n   { \"field\": { \"type\": \"field\", \"subType\": \"byteArray\", \"name\": \"data\" } }\n\n   // NEW\n   { \"field\": { \"type\": \"field\", \"subType\": \"int\", \"name\": \"data\", \"@isArray\": true } }\n   ```\n\n2. **Provider Registration:**\n   - Direct `MetaDataRegistry` manipulation deprecated\n   - Must implement `MetaDataTypeProvider`\n\n   **Migration:**\n   ```java\n   // OLD (deprecated)\n   MetaDataRegistry.getInstance().registerType(...);\n\n   // NEW (required)\n   public class MyProvider implements MetaDataTypeProvider {\n       @Override\n       public void registerTypes(MetaDataRegistry registry) {\n           MyField.registerTypes(registry);\n       }\n   }\n   ```\n\n3. **Constraint Naming:**\n   - All constraints must have format: `{domain}:{type}:{operation}`\n   - Old constraints without this format will fail validation\n\n---\n\n## üìù Documentation Gaps\n\n**Areas that need more examples:**\n- Complex MetaRelationship scenarios\n- Custom MetaView implementations\n- Advanced ObjectManager usage\n- Performance tuning guide\n\n**Status:** Low priority, framework is well-documented overall\n\n---\n\n## üîÆ Future Concerns\n\n### Potential Issues to Watch\n\n1. **JUnit 4 ‚Üí JUnit 5 Migration**\n   - Currently using JUnit 4.13.2\n   - JUnit 5 has better features\n   - Migration would be significant effort\n   - **Priority:** LOW\n\n2. **React/TypeScript Version Updates**\n   - Web module uses React 18, TypeScript 5\n   - Major version updates may require changes\n   - **Priority:** MEDIUM - Monitor for breaking changes\n\n3. **Java LTS Updates**\n   - Currently Java 17 LTS (supported until 2029)\n   - Java 21 LTS available (supported until 2031)\n   - Migration straightforward but requires testing\n   - **Priority:** LOW - Java 17 is fine for years\n\n---\n\n## üÜò Getting Help\n\n### If You Encounter an Issue Not Listed Here:\n\n1. **Check existing docs:**\n   - [ARCHITECTURE.md](ARCHITECTURE.md) - Design principles\n   - [SETUP.md](SETUP.md) - Build and environment\n   - [docs/*.md](docs/) - Topic-specific guides\n\n2. **Search codebase:**\n   ```bash\n   grep -r \"your error message\" .\n   ```\n\n3. **Check tests:**\n   - Look for similar test cases\n   - Tests often show correct usage patterns\n\n4. **Review provider implementations:**\n   - `metadata/src/main/java/.../types/` - Provider examples\n   - Shows correct patterns for registration\n\n5. **Add issue here:**\n   - Document the problem\n   - Document the solution\n   - Help future developers\n\n---\n\n**Remember:** Most issues stem from treating MetaObjects like a traditional data framework instead of a metadata framework analogous to Java reflection. When in doubt, think \"ClassLoader\" not \"Hibernate\".\n\n---\n\n**Last Updated:** 2025-11-15\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/KNOWN-ISSUES.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "c06f04e751f2bd7f",
      "size_bytes": 11821,
      "created_at": "2026-01-02T20:42:12.428489"
    },
    {
      "doc_id": "local_metaobjects-core__claude_ARCHITECTURE",
      "source": "local",
      "category": "conversational",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/ARCHITECTURE.md",
      "content": "\n## ‚ö†Ô∏è CRITICAL ARCHITECTURAL PRINCIPLE ‚ö†Ô∏è\n\n**MetaObjects follows a READ-OPTIMIZED WITH CONTROLLED MUTABILITY design pattern analogous to Java's Class/Field reflection system with dynamic class loading:**\n\n- **MetaData objects are loaded once during application startup and optimized for heavy read access**\n- **They are permanent in memory for the application lifetime (like Java Class objects)**\n- **Thread-safe for concurrent READ operations (primary use case: 99.9% of operations)**\n- **Support INFREQUENT controlled updates** (metadata repository pushes, dynamic editing)\n- **Updates use Copy-on-Write patterns to maintain read performance during changes**\n- **DO NOT treat MetaData as frequently mutable domain objects - optimize for heavy reads, rare updates**\n\n### Framework Analogy\n| Java Reflection | MetaObjects Framework | Dynamic Updates |\n|----------------|----------------------|----------------|\n| `Class.forName()` | `MetaDataLoader.load()` | `loader.reload()` |\n| `Class.getFields()` | `MetaObject.getMetaFields()` | Copy-on-write fields |\n| `Field.get(object)` | `MetaField.getValue(object)` | Read during update |\n| Permanent in memory | Permanent MetaData objects | Versioned references |\n| Thread-safe reads | Thread-safe metadata access | Concurrent read-during-update |\n| ClassLoader registry | MetaDataTypeRegistry | Hot-swappable types |\n| Class reloading | Dynamic metadata updates | Central repository pushes |\n\n## üèóÔ∏è **DETAILED ARCHITECTURE GUIDE**\n\n### MetaDataLoader as ClassLoader Pattern\n\n**MetaDataLoader operates exactly like Java's ClassLoader** - it loads metadata definitions once at startup and keeps them permanently in memory for the application lifetime. This is NOT a typical data access pattern.\n\n#### **Loading Phase vs Runtime Phase**\n```java\n// LOADING PHASE - Happens once at startup\nMetaDataLoader loader = new SimpleLoader(\"myLoader\");\nloader.setSourceURIs(Arrays.asList(URI.create(\"metadata.json\")));\nloader.init(); // Loads ALL metadata into permanent memory structures\n\n// RUNTIME PHASE - All operations are READ-ONLY\nMetaObject userMeta = loader.getMetaObjectByName(\"User\");  // O(1) lookup\nMetaField field = userMeta.getMetaField(\"email\");          // Cached access\nObject value = field.getValue(userObject);                // Thread-safe read\n```\n\n#### **Key Architectural Principles**\n1. **Startup Cost, Runtime Speed**: Heavy initialization, ultra-fast runtime access\n2. **Read-Optimized with Controlled Mutability**: Optimized for 99.9% reads, rare controlled updates\n3. **Permanent References**: Like `Class` objects, MetaData stays in memory until app shutdown\n4. **Thread-Safe Reads**: No synchronization needed for read operations (primary use case)\n5. **Copy-on-Write Updates**: Infrequent updates use atomic reference swapping to maintain read performance\n6. **Abstract Base + Concrete Subtypes**: ALL MetaData type hierarchies use abstract base classes with concrete subtype implementations for type safety and enhanced APIs\n\n#### **ClassLoader Analogy Mapping**\n| ClassLoader Operation | MetaDataLoader Operation | Purpose |\n|----------------------|-------------------------|---------|\n| `Class.forName(\"String\")` | `loader.getMetaObjectByName(\"User\")` | Resolve by name |\n| `String.class.getDeclaredFields()` | `userMeta.getMetaFields()` | Get structure info |\n| `field.get(object)` | `metaField.getValue(object)` | Access object data |\n| `Class` object caching | MetaData object caching | Permanent memory residence |\n| ClassLoader hierarchy | MetaDataLoader inheritance | Package resolution |\n\n### üîÑ **OSGI Compatibility & Bundle Management**\n\n**Critical Design Decision**: MetaObjects framework is designed for OSGI environments where bundles can be loaded/unloaded dynamically.\n\n#### **OSGI Bundle Lifecycle Considerations**\n```java\n// When OSGI bundle unloads:\n// 1. Bundle classloader becomes invalid\n// 2. WeakReferences allow GC of computed caches\n// 3. Core MetaData objects remain (referenced by application)\n// 4. Service registrations are cleaned up automatically\n```\n\n#### **Service Discovery Pattern**\n```java\n// OSGI-compatible service loading\nServiceRegistry registry = ServiceRegistryFactory.getDefault();\nMetaDataTypeRegistry typeRegistry = registry.getService(MetaDataTypeRegistry.class);\n\n// Uses ServiceLoader under the hood - works in both OSGI and standalone\nList<MetaDataTypeProvider> providers = ServiceLoader.load(MetaDataTypeProvider.class);\n```\n\n#### **Bundle Unload Safety**\n- **MetaData objects**: Permanent references prevent GC\n- **Computed caches**: WeakHashMap allows cleanup when bundle unloads\n- **Service references**: Released automatically by OSGI container\n- **ClassLoader references**: WeakReference pattern prevents memory leaks\n\n### üíæ **Cache Strategy & WeakHashMap Design**\n\n**CRITICAL**: The HybridCache design with WeakHashMap is architecturally sophisticated and intentional.\n\n#### **Dual Cache Strategy Explained**\n```java\npublic class HybridCache {\n    // PERMANENT CACHE - Strong references for core metadata lookups\n    private final Map<String, Object> modernCache = new ConcurrentHashMap<>();\n    \n    // COMPUTED CACHE - Weak references for derived calculations\n    private final Map<Object, Object> legacyCache = Collections.synchronizedMap(new WeakHashMap<>());\n}\n```\n\n#### **Cache Usage Patterns**\n| Cache Type | Purpose | Content | GC Behavior |\n|-----------|---------|---------|-------------|\n| **ConcurrentHashMap** | Core lookups | MetaData references, field mappings | Never GC'd |\n| **WeakHashMap** | Computed values | Derived calculations, transformations | GC'd when memory pressure |\n\n#### **Why WeakHashMap is Essential**\n1. **OSGI Bundle Unloading**: Computed caches get cleaned up when bundles unload\n2. **Memory Pressure**: Non-essential computed values can be GC'd and recomputed\n3. **Long-Running Applications**: Prevents memory leaks over application lifetime\n4. **Dynamic Metadata**: Allows for metadata enhancement without permanent memory growth\n\n#### **Cache Access Pattern**\n```java\n// Fast path: Check modern cache first (permanent data)\nObject value = modernCache.get(key);\nif (value != null) return value;\n\n// Fallback: Check computed cache (may be GC'd)\nvalue = legacyCache.get(key);\nif (value != null) {\n    modernCache.put(key, value); // Promote to permanent if frequently accessed\n    return value;\n}\n\n// Miss: Compute and cache\nvalue = expensiveComputation();\nlegacyCache.put(key, value); // Weak reference - can be GC'd\n```\n\n### üßµ **Thread-Safety for Read-Heavy Workloads**\n\n**Performance Pattern**: After loading phase, MetaObjects is optimized for massively concurrent read access.\n\n#### **Read-Optimized Synchronization**\n```java\n// LOADING PHASE - Synchronized writes\npublic synchronized void addChild(MetaData child) {\n    // Constraint validation and structural changes\n    children.add(child);\n    flushCaches(); // Clear derived computations\n}\n\n// RUNTIME PHASE - Lock-free reads\npublic MetaField getMetaField(String name) {\n    // No synchronization needed - data is immutable\n    return useCache(\"getMetaField()\", name, this::computeField);\n}\n```\n\n#### **Concurrency Design Patterns**\n1. **Copy-on-Write Collections**: For metadata collections that rarely change\n2. **ConcurrentHashMap**: For high-frequency lookup tables\n3. **Volatile References**: For immutable object references\n4. **Lock-Free Algorithms**: For read-heavy operations after loading\n\n#### **Performance Characteristics**\n- **Loading Phase**: ~100ms-1s (one-time cost)\n- **Runtime Reads**: ~1-10Œºs (cached, lock-free)\n- **Concurrent Readers**: Unlimited (no contention)\n- **Memory Overhead**: 10-50MB for typical metadata sets\n- **Update Phase**: ~50-200ms (infrequent, atomic replacement)\n\n### üîÑ **Dynamic Metadata Updates**\n\n**Future Capability**: The framework is designed to support infrequent controlled metadata updates while maintaining read performance.\n\n#### **Use Cases for Dynamic Updates**\n1. **Central Repository Pushes**: Metadata server pushes updated model definitions to running services\n2. **Dynamic Editors**: Live system behavior modification through metadata editing interfaces\n3. **Version Updates**: Hot-swapping metadata when new model versions are deployed\n4. **A/B Testing**: Runtime metadata switching for behavioral experiments\n\n#### **Copy-on-Write Update Pattern**\n```java\n// UPDATE PATTERN - Infrequent, atomic replacement\npublic class MetaDataUpdateManager {\n    private volatile MetaObject currentUserMetaData; // Atomic reference\n    \n    public void updateMetaData(MetaObject newMetaData) {\n        // 1. Validate new metadata\n        validateMetaData(newMetaData);\n        \n        // 2. Build derived caches for new metadata\n        newMetaData.buildCaches();\n        \n        // 3. Atomic swap - readers see old OR new, never partial state\n        MetaObject old = currentUserMetaData;\n        currentUserMetaData = newMetaData; // Atomic reference assignment\n        \n        // 4. Invalidate related caches\n        invalidateDerivedCaches();\n        \n        // 5. Notify observers of change\n        notifyMetaDataChanged(old, newMetaData);\n    }\n    \n    // READ PATH - Still lock-free and fast\n    public MetaObject getUserMetaData() {\n        return currentUserMetaData; // Volatile read - no locks needed\n    }\n}\n```\n\n#### **Thread-Safety During Updates**\n1. **Volatile References**: Atomic visibility of metadata changes\n2. **Immutable Metadata Objects**: Each version is immutable, preventing partial updates\n3. **Cache Invalidation**: Related caches cleared atomically after swap\n4. **No Reader Blocking**: Readers continue accessing old version until swap completes\n\n#### **Update Performance Considerations**\n- **Frequency**: Designed for infrequent updates (minutes/hours, not seconds)\n- **Update Time**: 50-200ms for metadata replacement (acceptable for rare operations)\n- **Reader Impact**: Zero performance impact during updates (atomic swap)\n- **Memory Usage**: Temporary 2x memory during update transition\n\n#### **OSGI Compatibility with Updates**\n```java\n// Update mechanism works in OSGI environments\npublic void updateFromBundle(Bundle metadataBundle) {\n    // 1. Load metadata from new bundle\n    MetaDataLoader tempLoader = new SimpleLoader(\"update\");\n    tempLoader.loadFromBundle(metadataBundle);\n    \n    // 2. Atomic replacement of loader reference\n    MetaDataLoader old = currentLoader;\n    currentLoader = tempLoader; // Volatile assignment\n    \n    // 3. WeakHashMap caches naturally clean up old references\n    // No explicit cleanup needed - OSGI + WeakHashMap handles it\n}\n```\n\n#### **Cache Strategy for Updates**\n- **Permanent Cache**: Core metadata references updated atomically\n- **WeakHashMap Cache**: Derived computations invalidated and recomputed on demand\n- **Version Tracking**: Each metadata version can be tracked for rollback capability\n\n### üèóÔ∏è **ABSTRACT BASE + CONCRETE SUBTYPES ARCHITECTURAL PATTERN**\n\n**CRITICAL DESIGN PRINCIPLE**: ALL MetaData type hierarchies MUST follow the Abstract Base + Concrete Subtypes pattern for type safety, enhanced APIs, and maintainable extensibility.\n\n#### **The Architectural Pattern**\n\n**ALWAYS use this pattern when creating MetaData type families:**\n\n1. **Abstract Base Class**: Defines shared behavior and common functionality\n2. **Concrete Subtype Classes**: Implement specific behavior for each subtype\n3. **Type-Safe APIs**: Methods return specific concrete types instead of generic base types\n4. **Provider-Based Registration**: Each concrete type registers itself through MetaDataTypeProvider\n\n#### **Pattern Implementation Example**\n\n```java\n// ‚úÖ CORRECT PATTERN - Abstract base class\npublic abstract class MetaIdentity extends MetaData {\n    // Shared constants and functionality\n    public static final String TYPE_IDENTITY = \"identity\";\n    public static final String SUBTYPE_PRIMARY = \"primary\";\n    public static final String SUBTYPE_SECONDARY = \"secondary\";\n\n    // Shared constructor for subtypes\n    protected MetaIdentity(String subType, String name) {\n        super(TYPE_IDENTITY, subType, name);\n    }\n\n    // Shared methods available to all identity types\n    public List<String> getFieldNames() { /* shared implementation */ }\n    public boolean hasFields() { /* shared implementation */ }\n}\n\n// ‚úÖ CORRECT PATTERN - Concrete subtype class\npublic class PrimaryIdentity extends MetaIdentity {\n\n    // Automatic subtype assignment\n    public PrimaryIdentity(String name) {\n        super(SUBTYPE_PRIMARY, name);\n    }\n\n    // Type-specific methods only available on PrimaryIdentity\n    public boolean hasAutoGeneration() { /* primary-specific logic */ }\n    public boolean usesIncrement() { /* primary-specific logic */ }\n    public boolean usesUuid() { /* primary-specific logic */ }\n\n    // Self-registration through provider pattern\n    public static void registerTypes(MetaDataRegistry registry) {\n        registry.registerType(PrimaryIdentity.class, def -> def\n            .type(TYPE_IDENTITY).subType(SUBTYPE_PRIMARY)\n            .description(\"Primary identity for object identification\")\n            .inheritsFrom(\"metadata\", \"base\")\n            .optionalAttribute(\"generation\", \"string\")\n            .optionalAttribute(\"fields\", \"string\")\n        );\n    }\n}\n\n// ‚úÖ CORRECT PATTERN - Concrete subtype class\npublic class SecondaryIdentity extends MetaIdentity {\n\n    // Automatic subtype assignment\n    public SecondaryIdentity(String name) {\n        super(SUBTYPE_SECONDARY, name);\n    }\n\n    // Type-specific methods only available on SecondaryIdentity\n    public boolean isUniqueKey() { /* secondary-specific logic */ }\n    public boolean isBusinessKey() { /* secondary-specific logic */ }\n    public boolean supportsLookup() { /* secondary-specific logic */ }\n\n    // Self-registration through provider pattern\n    public static void registerTypes(MetaDataRegistry registry) {\n        registry.registerType(SecondaryIdentity.class, def -> def\n            .type(TYPE_IDENTITY).subType(SUBTYPE_SECONDARY)\n            .description(\"Secondary identity for business keys and alternate identifiers\")\n            .inheritsFrom(\"metadata\", \"base\")\n            .optionalAttribute(\"fields\", \"string\")\n        );\n    }\n}\n```\n\n#### **Type-Safe API Design**\n\n**ALWAYS provide type-specific API methods that return concrete types:**\n\n```java\n// ‚úÖ CORRECT - Type-safe APIs returning concrete types\npublic class MetaObject extends MetaData {\n\n    // Returns specific PrimaryIdentity type\n    public PrimaryIdentity getPrimaryIdentity() {\n        return useCache(\"getPrimaryIdentity()\", () -> {\n            Collection<PrimaryIdentity> primaries = getChildren(PrimaryIdentity.class);\n            return primaries.isEmpty() ? null : primaries.iterator().next();\n        });\n    }\n\n    // Returns collection of specific SecondaryIdentity types\n    public Collection<SecondaryIdentity> getSecondaryIdentities() {\n        return useCache(\"getSecondaryIdentities()\", () -> {\n            return getChildren(SecondaryIdentity.class);\n        });\n    }\n\n    // Type-specific finder methods\n    public PrimaryIdentity findPrimaryIdentity() throws MetaDataNotFoundException {\n        PrimaryIdentity primary = getPrimaryIdentity();\n        if (primary == null) {\n            throw new MetaDataNotFoundException(\"No primary identity found for object: \" + getName());\n        }\n        return primary;\n    }\n}\n\n// ‚ùå WRONG - Generic API returning base type\npublic MetaIdentity getIdentity(String subType) {\n    // Forces users to cast and check subtypes manually\n    return findChildBySubType(MetaIdentity.class, subType);\n}\n```\n\n#### **Provider-Based Registration Pattern**\n\n**ALWAYS use provider-based registration with proper dependency ordering:**\n\n```java\n// ‚úÖ CORRECT - Provider registers concrete types\npublic class IdentityTypesMetaDataProvider implements MetaDataTypeProvider {\n\n    @Override\n    public void registerTypes(MetaDataRegistry registry) {\n        // Register each concrete type\n        PrimaryIdentity.registerTypes(registry);\n        SecondaryIdentity.registerTypes(registry);\n    }\n\n    @Override\n    public int getPriority() {\n        return 25; // After base types, before application-specific\n    }\n}\n```\n\n#### **Benefits of This Pattern**\n\n‚úÖ **Type Safety**: No casting required - methods return specific types\n‚úÖ **Enhanced APIs**: Type-specific methods available on each concrete class\n‚úÖ **Clear Intent**: Each class focused on its specific subtype responsibilities\n‚úÖ **Better Extensibility**: Easy to add new subtypes without modifying existing code\n‚úÖ **Improved Documentation**: Each subtype class documents its specific purpose\n‚úÖ **Reduced Errors**: Compile-time checking prevents subtype misuse\n‚úÖ **Cleaner Code**: No string-based subtype checking in client code\n\n#### **When to Apply This Pattern**\n\n**MANDATORY for these MetaData type families:**\n- **MetaField subtypes**: StringField, IntegerField, LongField, etc.\n- **MetaValidator subtypes**: RequiredValidator, LengthValidator, PatternValidator, etc.\n- **MetaAttribute subtypes**: StringAttribute, IntAttribute, BooleanAttribute, etc.\n- **MetaView subtypes**: TextView, FormView, ListViewm etc.\n- **MetaIdentity subtypes**: PrimaryIdentity, SecondaryIdentity (COMPLETED)\n- **MetaRelationship subtypes**: ReferenceRelationship, EmbeddedRelationship, etc.\n\n#### **Migration from Single Class + Subtypes**\n\n**When you encounter existing single-class patterns, refactor them:**\n\n```java\n// ‚ùå OLD PATTERN - Single class with string subtypes\npublic class MetaValidator extends MetaData {\n    public MetaValidator(String subType, String name) {\n        super(\"validator\", subType, name);\n    }\n\n    // Generic methods that check subtype strings\n    public boolean isRequired() {\n        return \"required\".equals(getSubTypeName());\n    }\n}\n\n// ‚úÖ NEW PATTERN - Abstract base + concrete subtypes\npublic abstract class MetaValidator extends MetaData {\n    protected MetaValidator(String subType, String name) {\n        super(\"validator\", subType, name);\n    }\n}\n\npublic class RequiredValidator extends MetaValidator {\n    public RequiredValidator(String name) {\n        super(\"required\", name);\n    }\n\n    // Type-specific validation logic\n    public void validateRequired(Object value) throws ValidationException {\n        // Implementation specific to required validation\n    }\n}\n```\n\n#### **Code Review Guidelines**\n\n**When reviewing MetaData type implementations:**\n\n‚úÖ **DO Look For:**\n- Abstract base class with shared functionality\n- Concrete subtype classes with specific behavior\n- Type-safe API methods returning concrete types\n- Provider-based registration for each concrete type\n- Self-documenting class purposes\n\n‚ùå **RED FLAGS:**\n- Single concrete class handling multiple subtypes via string checking\n- Generic APIs that force clients to cast or check subtypes\n- Missing type-specific methods on concrete classes\n- Registration mixing base and concrete classes\n\n#### **Future Extension Example**\n\n**When adding new subtypes, follow this pattern:**\n\n```java\n// Adding new IdentityComposite type\npublic class CompositeIdentity extends MetaIdentity {\n\n    public CompositeIdentity(String name) {\n        super(\"composite\", name);\n    }\n\n    // Composite-specific methods\n    public List<MetaIdentity> getComponentIdentities() { /* implementation */ }\n    public boolean isComplete() { /* implementation */ }\n\n    public static void registerTypes(MetaDataRegistry registry) {\n        registry.registerType(CompositeIdentity.class, def -> def\n            .type(TYPE_IDENTITY).subType(\"composite\")\n            .description(\"Composite identity combining multiple identity components\")\n            .inheritsFrom(\"metadata\", \"base\")\n            .optionalAttribute(\"components\", \"string\")\n        );\n    }\n}\n\n// Update provider to include new type\npublic class IdentityTypesMetaDataProvider implements MetaDataTypeProvider {\n    @Override\n    public void registerTypes(MetaDataRegistry registry) {\n        PrimaryIdentity.registerTypes(registry);\n        SecondaryIdentity.registerTypes(registry);\n        CompositeIdentity.registerTypes(registry); // Add new type\n    }\n}\n\n// Update MetaObject with new type-safe API\npublic class MetaObject extends MetaData {\n    public Collection<CompositeIdentity> getCompositeIdentities() {\n        return getChildren(CompositeIdentity.class);\n    }\n}\n```\n\n**This pattern ensures the MetaObjects framework maintains type safety, clear APIs, and extensibility while providing excellent developer experience.**\n\n### ‚ö†Ô∏è **COMMON ARCHITECTURAL PITFALLS**\n\n**Critical mistakes to avoid when working with MetaObjects framework:**\n\n#### **‚ùå DON'T: Treat MetaData as Mutable Domain Objects**\n```java\n// WRONG - Treating MetaData like a mutable entity\nMetaObject userMeta = loader.getMetaObjectByName(\"User\");\nuserMeta.addMetaField(new StringField(\"dynamicField\")); // ‚ùå Runtime mutation\n\n// RIGHT - MetaData is loaded once and immutable\nMetaObject userMeta = loader.getMetaObjectByName(\"User\"); \nMetaField field = userMeta.getMetaField(\"email\"); // ‚úÖ Read-only access\n```\n\n#### **‚ùå DON'T: Replace WeakHashMap with Strong References**\n```java\n// WRONG - Would cause memory leaks in OSGI\nprivate final Map<Object, Object> cache = new ConcurrentHashMap<>(); // ‚ùå Strong refs\n\n// RIGHT - Allows GC cleanup when bundles unload\nprivate final Map<Object, Object> cache = Collections.synchronizedMap(new WeakHashMap<>()); // ‚úÖ\n```\n\n#### **‚ùå DON'T: Create New MetaDataLoader Instances Frequently**\n```java\n// WRONG - MetaDataLoader is like ClassLoader, create once\nfor (String source : sources) {\n    MetaDataLoader loader = new SimpleLoader(source); // ‚ùå Expensive, wasteful\n    loader.init();\n}\n\n// RIGHT - One loader per application context\nMetaDataLoader appLoader = new SimpleLoader(\"appMetadata\");\nappLoader.setSourceURIs(allSources);\nappLoader.init(); // ‚úÖ Load once, use forever\n```\n\n#### **‚ùå DON'T: Synchronize Read Operations After Loading**\n```java\n// WRONG - Unnecessary synchronization kills performance\npublic synchronized MetaField getMetaField(String name) { // ‚ùå Blocks concurrent reads\n    return fieldCache.get(name);\n}\n\n// RIGHT - Lock-free reads after loading\npublic MetaField getMetaField(String name) { // ‚úÖ Concurrent reads\n    return fieldCache.get(name); // Immutable after loading\n}\n```\n\n#### **‚úÖ DO: Follow ClassLoader Patterns**\n```java\n// Cache expensive lookups (like Class.forName())\nprivate static final Map<String, MetaObject> METADATA_CACHE = new ConcurrentHashMap<>();\n\npublic static MetaObject getMetaObject(String name) {\n    return METADATA_CACHE.computeIfAbsent(name, \n        key -> loader.getMetaObjectByName(key)); // Cache like Class objects\n}\n```\n\n#### **‚ùå DON'T: Add Rigid Validation to Core Types**\n```java\n// WRONG - Hardcoded restrictions prevent extensibility\npublic class MetaField extends MetaData {\n    private static final Set<String> ALLOWED_SUBTYPES = Set.of(\"string\", \"int\", \"long\"); // ‚ùå Rigid, not extensible\n\n    public MetaField(String subType) {\n        if (!ALLOWED_SUBTYPES.contains(subType)) { // ‚ùå Prevents plugins\n            throw new IllegalArgumentException(\"Invalid subtype\");\n        }\n    }\n}\n\n// RIGHT - Use constraint system for validation\npublic class MetaField extends MetaData {\n    // No hardcoded restrictions - validation handled by constraint system\n    // Downstream implementations can extend subtypes through provider system\n}\n```\n\n#### **‚ùå DON'T: Create New Validation Mechanisms**\n```java\n// WRONG - Bypassing existing constraint system\npublic void validateSubType(String subType) {\n    if (!myCustomValidation(subType)) { // ‚ùå Redundant validation\n        throw new ValidationException(\"Invalid\");\n    }\n}\n\n// RIGHT - Use existing constraint system\n// Add constraints to META-INF/constraints/*.json\n// Constraints automatically enforce during construction\n```\n\n#### **‚ùå DON'T: Use Single Concrete Classes with String-Based Subtype Checking**\n```java\n// WRONG - Single concrete class handling multiple subtypes\npublic class MetaValidator extends MetaData {\n    public MetaValidator(String subType, String name) {\n        super(\"validator\", subType, name);\n    }\n\n    // ‚ùå Generic methods that check subtype strings\n    public boolean isRequired() {\n        return \"required\".equals(getSubTypeName());\n    }\n\n    public boolean isLength() {\n        return \"length\".equals(getSubTypeName());\n    }\n\n    // ‚ùå Forces clients to cast and check subtypes\n    public void validate(Object value) {\n        if (isRequired()) {\n            // Required validation logic mixed with other types\n        } else if (isLength()) {\n            // Length validation logic mixed with other types\n        }\n    }\n}\n\n// RIGHT - Abstract base + concrete subtypes pattern\npublic abstract class MetaValidator extends MetaData {\n    protected MetaValidator(String subType, String name) {\n        super(\"validator\", subType, name);\n    }\n\n    // Abstract method for type-specific validation\n    public abstract void validate(Object value) throws ValidationException;\n}\n\npublic class RequiredValidator extends MetaValidator {\n    public RequiredValidator(String name) {\n        super(\"required\", name);\n    }\n\n    // ‚úÖ Type-specific validation logic\n    @Override\n    public void validate(Object value) throws ValidationException {\n        if (value == null || (value instanceof String && ((String) value).trim().isEmpty())) {\n            throw new ValidationException(\"Value is required\");\n        }\n    }\n\n    // ‚úÖ Type-specific methods\n    public boolean allowsEmptyString() { return false; }\n}\n\npublic class LengthValidator extends MetaValidator {\n    public LengthValidator(String name) {\n        super(\"length\", name);\n    }\n\n    // ‚úÖ Type-specific validation logic\n    @Override\n    public void validate(Object value) throws ValidationException {\n        if (value instanceof String) {\n            String str = (String) value;\n            if (str.length() < getMinLength() || str.length() > getMaxLength()) {\n                throw new ValidationException(\"String length must be between \" + getMinLength() + \" and \" + getMaxLength());\n            }\n        }\n    }\n\n    // ‚úÖ Type-specific methods\n    public int getMinLength() { return getIntAttribute(\"minLength\", 0); }\n    public int getMaxLength() { return getIntAttribute(\"maxLength\", Integer.MAX_VALUE); }\n}\n```\n\n#### **‚úÖ DO: Check Constraint System Before Adding Validation**\n```java\n// ALWAYS search these first before adding validation:\n// 1. Provider-based registration in MetaDataTypeProvider classes\n// 2. MetaDataRegistry integrated constraint system\n// 3. Existing PlacementConstraint/ValidationConstraint patterns\n\n// If validation needed, extend provider-based pattern:\n// 1. Add constraint to appropriate MetaDataTypeProvider.registerTypes() method\n// 2. Use PlacementConstraint for \"X CAN be placed under Y\" rules\n// 3. Use ValidationConstraint for value validation rules\n// 4. Test with build verification\n```\n\n#### **‚úÖ DO: Separate Loading Logic from Runtime Logic**\n```java\n// Loading phase - builders, validation, construction\npublic class MetaDataBuilder {\n    public MetaObject build() {\n        validate(); // ‚úÖ Validate during construction\n        return new ImmutableMetaObject(fields, attributes);\n    }\n}\n\n// Runtime phase - pure read operations\npublic class MetaObject {\n    public MetaField getMetaField(String name) {\n        return immutableFields.get(name); // ‚úÖ Read-only after construction\n    }\n}\n```\n\n### üéØ **Architecture Summary**\n\n**Remember**: MetaObjects is a **metadata definition framework**, not a data access framework. Think `java.lang.Class` and `java.lang.reflect.Field`, not Hibernate entities or REST resources.\n\n- **Load Once**: Like ClassLoader, expensive startup for permanent benefit\n- **Read Many**: Optimized for thousands of concurrent read operations\n- **OSGI Ready**: WeakHashMap and service patterns handle dynamic class loading\n- **Thread Safe**: Immutable after loading, no synchronization needed for reads\n- **Memory Efficient**: Smart caching balances performance with memory cleanup\n\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/ARCHITECTURE.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "md",
        "memory"
      ],
      "content_hash": "9fa79a1a0d05dd78",
      "size_bytes": 28147,
      "created_at": "2026-01-02T20:42:12.428588"
    },
    {
      "doc_id": "local_metaobjects-core__claude_SETUP",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/SETUP.md",
      "content": "# MetaObjects Core - Build & Setup Guide\n\n**Complete guide to building, testing, and developing MetaObjects Core**\n\n---\n\n## Prerequisites\n\n- **Java 21** (JDK 21 or higher)\n- **Maven 3.8+**\n- **Git** for version control\n- **IDE** (IntelliJ IDEA or Eclipse recommended)\n\n---\n\n## Quick Start\n\n### Clone and Build\n```bash\ncd ~/Development/metaobjects-core\nmvn clean compile      # Compile all 10 modules\nmvn test              # Run all tests\nmvn package           # Build JARs\n```\n\n### Verify Build\n```bash\nmvn clean test\n# Should show:  BUILD SUCCESS\n# All modules: metadata, codegen, core, maven-plugin, objectmanager, etc.\n```\n\n---\n\n## Key Build Commands\n\n### Full Build Cycle\n```bash\n# Clean and build entire project (all 10 modules)\nmvn clean compile\n\n# Full test suite execution\nmvn test\n\n# Complete package with code generation\nmvn package\n\n# Install to local Maven repository\nmvn install\n```\n\n### Targeted Builds\n```bash\n# Generate MetaDataFile schemas (automatic during package)\ncd core && mvn metaobjects:generate@gen-schemas\n\n# Run constraint system tests specifically\ncd metadata && mvn test -Dtest=ConstraintSystemTest\n\n# Run Maven plugin tests\ncd maven-plugin && mvn test\n\n# Build specific module (respects dependency order)\ncd metadata && mvn compile\ncd codegen && mvn compile\ncd core && mvn compile\n```\n\n### Clean Operations\n```bash\n# Clean all build artifacts\nmvn clean\n\n# Clean specific module\ncd metadata && mvn clean\n```\n\n---\n\n## Build Status\n\n### ‚úÖ Latest Verification Results\n\n**Clean Build:** All artifacts removed successfully\n**Full Compilation:** All 10 modules compiled without errors\n**Constraint Tests:** 8/8 tests passing with proper naming enforcement\n**Maven Plugin:** 4/4 tests passing with ServiceLoader discovery\n**Schema Generation:** Both JSON and XSD schemas generated correctly\n**Package Build:** All modules packaged successfully\n\n### Reactor Summary\n```\n[INFO] Reactor Summary for MetaObjects 6.2.5-SNAPSHOT:\n[INFO] MetaObjects ........................................ SUCCESS\n[INFO] MetaObjects :: MetaData ............................ SUCCESS\n[INFO] MetaObjects :: Code Generation ..................... SUCCESS\n[INFO] MetaObjects :: Core ................................ SUCCESS\n[INFO] MetaObjects :: Maven Plugin ........................ SUCCESS\n[INFO] MetaObjects :: ObjectManager ....................... SUCCESS\n[INFO] MetaObjects :: ObjectManager :: RDB ................ SUCCESS\n[INFO] MetaObjects :: ObjectManager :: NoSQL .............. SUCCESS\n[INFO] MetaObjects :: Web ................................. SUCCESS\n[INFO] MetaObjects :: Demo ................................ SUCCESS\n[INFO] BUILD SUCCESS\n```\n\n---\n\n## Module Dependency Order\n\nMetaObjects uses a strict module dependency hierarchy:\n\n```\n1. metadata          # Base metadata models (no dependencies)\n2. codegen           # Code generation (depends on metadata)\n3. core              # Core framework (depends on metadata, codegen)\n4. maven-plugin      # Maven tooling (depends on core)\n5. objectmanager     # Persistence base (depends on core)\n6. objectmanager-rdb # RDB support (depends on objectmanager)\n7. objectmanager-nosql # NoSQL support (depends on objectmanager)\n8. web               # Web integration (depends on core)\n9. demo              # Demos (depends on web, objectmanager)\n10. archetype        # Project templates\n```\n\n**Building individual modules:** Maven automatically builds dependencies first.\n\n---\n\n## Maven Configuration\n\n### Parent POM\n- All modules inherit from parent `pom.xml`\n- Dependency versions managed centrally\n- Consistent build configuration across modules\n\n### Compiler Settings\n```xml\n<maven.compiler.source>17</maven.compiler.source>\n<maven.compiler.target>17</maven.compiler.target>\n<maven.compiler.release>17</maven.compiler.release>\n```\n\n### OSGi Bundle Support\n- Enabled via Apache Felix Maven Bundle Plugin\n- Generates OSGi manifests automatically\n- Bundle-SymbolicName and Export-Package configured\n\n### Distribution Profiles\n- **default (Draagon):** Internal Draagon repository\n- **nexus (Maven Central):** Maven Central repository\n\n---\n\n## Critical Files for Development\n\n### Source Code Locations\n\n**Core Framework:**\n- `core/src/main/java/com/draagon/meta/` - Core implementation\n- `metadata/src/main/java/com/draagon/meta/` - Metadata models\n- `codegen/src/main/java/com/draagon/meta/` - Code generation\n\n**Persistence:**\n- `objectmanager/src/main/java/com/draagon/meta/object/` - Base persistence\n- `objectmanager-rdb/src/main/java/com/draagon/meta/object/rdb/` - Relational DB\n- `objectmanager-nosql/src/main/java/com/draagon/meta/object/nosql/` - NoSQL DB\n\n**Web & React:**\n- `web/src/typescript/components/metaviews/` - React MetaView components\n- `web/src/typescript/components/forms/` - React form components\n- `web/src/typescript/types/metadata.ts` - TypeScript types\n- `web/src/main/java/com/draagon/meta/web/react/api/` - Spring controllers\n\n**Demo Application:**\n- `demo/src/main/java/com/draagon/meta/demo/fishstore/api/` - Demo controllers\n- `demo/src/main/resources/metadata/fishstore-metadata.json` - Demo metadata\n\n**Tests:**\n- `*/src/test/java/` - JUnit tests in each module\n- `*/src/test/resources/` - Test resources\n\n### Configuration Files\n\n**Maven:**\n- `pom.xml` - Parent POM (root)\n- `*/pom.xml` - Module POMs\n- `maven-plugin/src/main/resources/META-INF/maven/plugin.xml` - Plugin descriptor\n\n**React/TypeScript:**\n- `web/package.json` - NPM dependencies\n- `web/tsconfig.json` - TypeScript configuration\n- `web/webpack.config.js` - Webpack bundler\n\n**OSGi:**\n- Generated in `META-INF/MANIFEST.MF` by Felix plugin\n\n**Service Discovery:**\n- `META-INF/services/com.draagon.meta.loader.types.MetaDataTypeProvider` - ServiceLoader registration\n\n**Metadata:**\n- `*/src/main/resources/metadata/*.json` - JSON metadata definitions\n- `*/src/main/resources/metadata/*.xsd` - XSD schemas\n\n### Documentation\n\n- `README.md` - Main project README\n- `RELEASE_NOTES.md` - Version history\n- `.claude/` - Claude Code documentation (this directory)\n\n---\n\n## Key Technologies & Dependencies\n\n### Core Java Stack\n- **Java 21** with Maven compiler plugin 3.13.0\n- **SLF4J 2.0.16** + **Logback 1.5.16** for logging\n- **JUnit 4.13.2** for testing\n- **Gson 2.13.1** for JSON handling\n- **Commons Validator 1.9.0** for validation\n\n### OSGi & Services\n- **Apache Felix Maven Bundle Plugin 5.1.9** for OSGi bundles\n- **ServiceLoader** for provider discovery\n\n### Frontend (Web Module)\n- **React 18+** for UI components\n- **TypeScript 5+** for type-safe JavaScript\n- **Redux Toolkit** for state management\n- **Webpack 5** for bundling\n\n### Build Tools\n- **Maven 3.8+** (required)\n- **maven-compiler-plugin 3.13.0**\n- **maven-surefire-plugin 3.5.2** for testing\n- **metaobjects-maven-plugin** for schema generation\n\n---\n\n## IDE Setup\n\n### IntelliJ IDEA (Recommended)\n\n1. **Import Project:**\n   - File ‚Üí Open ‚Üí Select `metaobjects-core/pom.xml`\n   - Choose \"Open as Project\"\n   - IntelliJ auto-detects Maven structure\n\n2. **Set JDK:**\n   - File ‚Üí Project Structure ‚Üí Project\n   - Set SDK to Java 21\n   - Set language level to 17\n\n3. **Enable Annotation Processing:**\n   - Settings ‚Üí Build, Execution, Deployment ‚Üí Compiler ‚Üí Annotation Processors\n   - Check \"Enable annotation processing\"\n\n4. **Install Plugins:**\n   - Lombok (if using)\n   - Maven Helper\n   - OSGi (optional)\n\n5. **Run Configurations:**\n   - Create \"Maven\" run configuration\n   - Working directory: `$ProjectFileDir$`\n   - Command line: `clean test`\n\n### Eclipse\n\n1. **Import Maven Project:**\n   - File ‚Üí Import ‚Üí Maven ‚Üí Existing Maven Projects\n   - Select `metaobjects-core` directory\n\n2. **Set JDK:**\n   - Window ‚Üí Preferences ‚Üí Java ‚Üí Installed JREs\n   - Add JDK 21 if not present\n   - Project ‚Üí Properties ‚Üí Java Build Path ‚Üí Set to JDK 21\n\n3. **Install Plugins:**\n   - M2Eclipse (Maven integration)\n   - Eclipse Checkstyle Plugin (optional)\n\n### VS Code\n\n1. **Install Extensions:**\n   - Extension Pack for Java (Microsoft)\n   - Maven for Java\n   - Spring Boot Extension Pack (if working with web module)\n\n2. **Open Folder:**\n   - Open `metaobjects-core` directory\n   - VS Code auto-detects Maven project\n\n3. **Configure Java:**\n   - Set `java.configuration.runtimes` to Java 21 in settings.json\n\n---\n\n## Testing\n\n### Run All Tests\n```bash\nmvn test\n```\n\n### Run Specific Module Tests\n```bash\ncd metadata && mvn test\ncd core && mvn test\n```\n\n### Run Specific Test Class\n```bash\ncd metadata && mvn test -Dtest=ConstraintSystemTest\ncd maven-plugin && mvn test -Dtest=ServiceLoaderTest\n```\n\n### Run Single Test Method\n```bash\nmvn test -Dtest=ConstraintSystemTest#testPlacementConstraints\n```\n\n### Skip Tests\n```bash\nmvn package -DskipTests\n```\n\n### Test Coverage\n```bash\n# Run tests with coverage (if jacoco plugin configured)\nmvn clean test jacoco:report\n```\n\nSee [docs/testing.md](docs/testing.md) for detailed testing guidelines.\n\n---\n\n## Schema Generation\n\nThe MetaObjects Maven Plugin generates JSON and XSD schemas from metadata definitions.\n\n### Automatic Generation\n```bash\ncd core\nmvn package  # Schemas generated automatically\n```\n\n### Manual Generation\n```bash\ncd core\nmvn metaobjects:generate@gen-schemas\n```\n\n### Generated Files\n- `core/target/generated-resources/metadata/*.json`\n- `core/target/generated-resources/metadata/*.xsd`\n\n---\n\n## Common Development Tasks\n\n### Add New MetaData Type\n\n1. **Create Concrete Class:**\n   ```java\n   // metadata/src/main/java/com/draagon/meta/field/MyField.java\n   public class MyField extends MetaField {\n       public MyField(String name) {\n           super(\"mytype\", name);\n       }\n\n       public static void registerTypes(MetaDataRegistry registry) {\n           registry.registerType(MyField.class, def -> def\n               .type(\"field\").subType(\"mytype\")\n               .description(\"My custom field type\")\n               .inheritsFrom(\"metadata\", \"field\")\n           );\n       }\n   }\n   ```\n\n2. **Register in Provider:**\n   ```java\n   // metadata/src/main/java/.../MyTypesMetaDataProvider.java\n   public class MyTypesMetaDataProvider implements MetaDataTypeProvider {\n       @Override\n       public void registerTypes(MetaDataRegistry registry) {\n           MyField.registerTypes(registry);\n       }\n\n       @Override\n       public int getPriority() { return 30; }\n   }\n   ```\n\n3. **Add ServiceLoader Registration:**\n   ```\n   # metadata/src/main/resources/META-INF/services/\n   # com.draagon.meta.loader.types.MetaDataTypeProvider\n\n   com.draagon.meta.field.MyTypesMetaDataProvider\n   ```\n\n4. **Test:**\n   ```bash\n   cd metadata && mvn test\n   ```\n\n### Update Dependency Version\n\n1. Edit parent `pom.xml`:\n   ```xml\n   <properties>\n       <gson.version>2.13.1</gson.version>\n   </properties>\n   ```\n\n2. Rebuild:\n   ```bash\n   mvn clean install\n   ```\n\n### Add Module to Reactor\n\n1. Create module directory with `pom.xml`\n2. Add to parent `pom.xml`:\n   ```xml\n   <modules>\n       <module>my-new-module</module>\n   </modules>\n   ```\n3. Set parent in module `pom.xml`\n4. Rebuild reactor:\n   ```bash\n   mvn clean install\n   ```\n\n---\n\n## Troubleshooting\n\n### Build Fails with \"Cannot find symbol\"\n**Cause:** Module dependencies not resolved\n**Fix:**\n```bash\nmvn clean install  # Install dependencies to local repo\n```\n\n### Tests Fail with ServiceLoader Issues\n**Cause:** Missing `META-INF/services/` entries\n**Fix:** Verify provider files exist in `src/main/resources/META-INF/services/`\n\n### OSGi Manifest Generation Fails\n**Cause:** Felix plugin configuration issue\n**Fix:** Check `<packaging>bundle</packaging>` in module `pom.xml`\n\n### Schema Generation Fails\n**Cause:** Core module not built\n**Fix:**\n```bash\ncd core && mvn clean install\n```\n\n### IDE Can't Find Classes\n**Cause:** Maven project not imported correctly\n**Fix:** Reimport Maven project or run \"Maven ‚Üí Reload Project\"\n\n---\n\n## Publishing to Maven Central\n\n### Prerequisites\n- GPG key for signing\n- Sonatype OSSRH account\n- Configure `~/.m2/settings.xml` with credentials\n\n### Build with Nexus Profile\n```bash\nmvn clean deploy -P nexus\n```\n\n### Steps\n1. `mvn clean verify` - Verify build\n2. `mvn deploy -P nexus` - Deploy to staging\n3. Login to https://oss.sonatype.org\n4. Close staging repository\n5. Release to Maven Central\n\nSee Maven Central Publishing docs for details.\n\n---\n\n## Next Steps\n\n- Review [ARCHITECTURE.md](ARCHITECTURE.md) for design principles\n- Read [docs/testing.md](docs/testing.md) for testing best practices\n- Check [KNOWN-ISSUES.md](KNOWN-ISSUES.md) for common pitfalls\n- See [CONTEXT.md](CONTEXT.md) for recent changes\n\n---\n\n**Last Updated:** 2025-11-15\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/SETUP.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "8e8173e18078d618",
      "size_bytes": 12552,
      "created_at": "2026-01-02T20:42:12.428688"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_outdated-planning-docs_IMPLEMENTATION_PROMPT",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/outdated-planning-docs/IMPLEMENTATION_PROMPT.md",
      "content": "# Implementation Prompt: Unified MetaData Registry Architecture\n\n## üìã **Context: What You're Implementing**\n\nYou are implementing a major architectural unification for the MetaObjects framework that eliminates dual registry patterns and integrates child requirements into type definitions. This is a sophisticated metadata-driven development framework that follows a **READ-OPTIMIZED WITH CONTROLLED MUTABILITY** pattern similar to Java's Class/Field reflection system.\n\n## üéØ **Your Mission**\n\n**Unify the dual MetaDataTypeRegistry implementations and eliminate constraint coupling issues by creating a single registry with integrated generic child requirements.**\n\n## üîç **Current Problems You're Solving**\n\n### **Problem 1: Dual MetaDataTypeRegistry Pattern**\n```java\n// TWO DIFFERENT REGISTRIES EXIST:\ncom.metaobjects.type.MetaDataTypeRegistry          // Singleton, uses registerType()\ncom.metaobjects.registry.MetaDataTypeRegistry      // Service-based, uses registerHandler()\n```\n\n### **Problem 2: Fragmented Constraint Management**\n```java\n// CURRENT PROBLEMATIC PATTERN:\nstatic {\n    // 1. Register type in one registry\n    MetaDataTypeRegistry registry = new MetaDataTypeRegistry();\n    registry.registerHandler(typeId, StringField.class);\n    \n    // 2. Register constraints in separate registry\n    ConstraintRegistry constraintRegistry = ConstraintRegistry.getInstance();\n    constraintRegistry.addConstraint(placementConstraint);\n}\n```\n\n### **Problem 3: Overly Broad Placement Rules**\n```java\n// CURRENT WRONG PATTERN - StringAttribute.java\nPlacementConstraint attributePlacement = new PlacementConstraint(\n    \"stringattr.placement\",\n    \"StringAttribute can be placed under any MetaData type\", // TOO BROAD!\n    (parent) -> parent instanceof MetaData, // WRONG - too permissive\n    (child) -> child instanceof StringAttribute\n);\n```\n\n## üèóÔ∏è **Solution Architecture You're Implementing**\n\n### **Key Design Principles**\n\n1. **Constants From Source Classes** - No central constants class, each class owns its identity\n2. **Parent-Defines-Children** - Parent types define what children they require/accept\n3. **Generic Child Requirements** - Support any MetaData type as children (not just attributes)\n4. **Enhanced Static Registration** - Single registration point with fluent API\n5. **Service-Based Extensions** - Cross-cutting concerns via service providers\n\n### **Target Architecture**\n\n```java\n// UNIFIED REGISTRY with integrated child requirements\npublic class MetaDataRegistry {\n    // UNIFIED: Single registry with both singleton and service-based access\n    private final Map<MetaDataTypeId, TypeDefinition> typeDefinitions;\n    private final Map<String, List<ChildRequirement>> globalRequirements;\n    \n    // UNIFIED REGISTRATION API\n    public static void registerType(Class<? extends MetaData> clazz, \n                                   Consumer<TypeDefinitionBuilder> configurator) { ... }\n    \n    public static class TypeDefinitionBuilder {\n        public TypeDefinitionBuilder type(String type) { ... }\n        public TypeDefinitionBuilder subType(String subType) { ... }\n        \n        // GENERIC CHILD REQUIREMENTS (any MetaData type)\n        public TypeDefinitionBuilder requiredChild(String childType, String childSubType, String childName) { ... }\n        public TypeDefinitionBuilder optionalChild(String childType, String childSubType, String childName) { ... }\n        \n        // CONVENIENCE METHOD for common attribute case\n        public TypeDefinitionBuilder optionalAttribute(String attrName, String attrSubType) { ... }\n    }\n}\n```\n\n## üîß **Implementation Steps**\n\n### **STEP 1: Create Enhanced MetaDataRegistry (Week 1)**\n\n**File: `metadata/src/main/java/com/draagon/meta/registry/MetaDataRegistry.java`**\n\nReplace the existing service-based registry with unified version:\n\n```java\npackage com.metaobjects.registry;\n\nimport java.util.*;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.function.Consumer;\n\n/**\n * Unified registry for MetaData type definitions with integrated child requirements.\n * Replaces dual registry pattern with single registration point.\n */\npublic class MetaDataRegistry {\n    \n    private static volatile MetaDataRegistry instance;\n    private static final Object INSTANCE_LOCK = new Object();\n    \n    private final ServiceRegistry serviceRegistry;\n    private final Map<MetaDataTypeId, TypeDefinition> typeDefinitions = new ConcurrentHashMap<>();\n    private final Map<String, List<ChildRequirement>> globalRequirements = new ConcurrentHashMap<>();\n    private volatile boolean initialized = false;\n    \n    // UNIFIED ACCESS PATTERNS\n    public static MetaDataRegistry getInstance() {\n        if (instance == null) {\n            synchronized (INSTANCE_LOCK) {\n                if (instance == null) {\n                    instance = new MetaDataRegistry();\n                }\n            }\n        }\n        return instance;\n    }\n    \n    public MetaDataRegistry(ServiceRegistry serviceRegistry) {\n        this.serviceRegistry = serviceRegistry;\n    }\n    \n    public MetaDataRegistry() {\n        this(ServiceRegistryFactory.getDefault());\n    }\n    \n    // UNIFIED REGISTRATION API\n    public static void registerType(Class<? extends MetaData> clazz, \n                                   Consumer<TypeDefinitionBuilder> configurator) {\n        TypeDefinitionBuilder builder = new TypeDefinitionBuilder(clazz);\n        configurator.accept(builder);\n        getInstance().register(builder.build());\n    }\n    \n    // CHILD REQUIREMENT LOOKUP (for schema generation and validation)\n    public List<ChildRequirement> getChildRequirements(String parentType, String parentSubType) { ... }\n    public ChildRequirement getChildRequirement(String parentType, String parentSubType, String childName) { ... }\n    \n    // SERVICE-BASED EXTENSIONS\n    public void addGlobalChildRequirement(String parentType, String parentSubType, ChildRequirement requirement) { ... }\n}\n```\n\n**File: `metadata/src/main/java/com/draagon/meta/registry/TypeDefinitionBuilder.java`**\n\n```java\npublic class TypeDefinitionBuilder {\n    private final Class<? extends MetaData> implementationClass;\n    private String type;\n    private String subType;\n    private String description;\n    private final Map<String, ChildRequirement> childRequirements = new HashMap<>();\n    \n    public TypeDefinitionBuilder(Class<? extends MetaData> clazz) {\n        this.implementationClass = clazz;\n    }\n    \n    public TypeDefinitionBuilder type(String type) {\n        this.type = type;\n        return this;\n    }\n    \n    public TypeDefinitionBuilder subType(String subType) {\n        this.subType = subType;\n        return this;\n    }\n    \n    public TypeDefinitionBuilder description(String description) {\n        this.description = description;\n        return this;\n    }\n    \n    // GENERIC CHILD REQUIREMENTS (any MetaData type)\n    public TypeDefinitionBuilder requiredChild(String childType, String childSubType, String childName) {\n        childRequirements.put(childName, new ChildRequirement(childName, childType, childSubType, true));\n        return this;\n    }\n    \n    public TypeDefinitionBuilder optionalChild(String childType, String childSubType, String childName) {\n        childRequirements.put(childName, new ChildRequirement(childName, childType, childSubType, false));\n        return this;\n    }\n    \n    // CONVENIENCE METHOD for common attribute case\n    public TypeDefinitionBuilder optionalAttribute(String attrName, String attrSubType) {\n        return optionalChild(\"attr\", attrSubType, attrName);\n    }\n    \n    // WILDCARD SUPPORT for flexible matching\n    public TypeDefinitionBuilder optionalChild(String childType, String childSubType) {\n        return optionalChild(childType, childSubType, \"*\"); // Any name\n    }\n    \n    public TypeDefinition build() {\n        return new TypeDefinition(implementationClass, type, subType, description, childRequirements);\n    }\n}\n```\n\n**File: `metadata/src/main/java/com/draagon/meta/registry/ChildRequirement.java`**\n\n```java\npublic class ChildRequirement {\n    private final String name;           // \"pattern\", \"email\", \"*\" for any\n    private final String expectedType;   // \"field\", \"attr\", \"validator\", \"*\" for any\n    private final String expectedSubType; // \"string\", \"int\", \"*\" for any  \n    private final boolean required;\n    \n    public ChildRequirement(String name, String expectedType, String expectedSubType, boolean required) {\n        this.name = name;\n        this.expectedType = expectedType;\n        this.expectedSubType = expectedSubType;\n        this.required = required;\n    }\n    \n    // WILDCARD MATCHING SUPPORT\n    public boolean matches(String childType, String childSubType, String childName) {\n        return matchesPattern(this.expectedType, childType) &&\n               matchesPattern(this.expectedSubType, childSubType) &&\n               matchesPattern(this.name, childName);\n    }\n    \n    private boolean matchesPattern(String pattern, String value) {\n        return \"*\".equals(pattern) || pattern.equals(value);\n    }\n    \n    // Getters...\n}\n```\n\n### **STEP 2: Update Core MetaData Classes (Week 2)**\n\n**File: `metadata/src/main/java/com/draagon/meta/field/MetaField.java`**\n\n```java\npublic abstract class MetaField extends MetaData {\n    // FIELD CONSTANTS (owned by this class)\n    public static final String TYPE_FIELD = \"field\";\n    public static final String ATTR_REQUIRED = \"required\";\n    public static final String ATTR_DEFAULT_VALUE = \"defaultValue\";\n    \n    static {\n        MetaDataRegistry.registerType(MetaField.class, def -> def\n            .type(TYPE_FIELD).subType(\"base\")\n            .description(\"Base field metadata\")\n            \n            // COMMON FIELD ATTRIBUTES (all field types inherit these)\n            .optionalAttribute(ATTR_REQUIRED, \"boolean\")\n            .optionalAttribute(ATTR_DEFAULT_VALUE, \"string\")\n        );\n    }\n}\n```\n\n**File: `metadata/src/main/java/com/draagon/meta/field/StringField.java`**\n\n```java\npublic class StringField extends PrimitiveField<String> {\n    public static final String SUBTYPE_STRING = \"string\";\n    public static final String ATTR_PATTERN = \"pattern\";\n    \n    static {\n        MetaDataRegistry.registerType(StringField.class, def -> def\n            .type(TYPE_FIELD).subType(SUBTYPE_STRING)\n            .description(\"String field with pattern validation\")\n            \n            // STRING-SPECIFIC ATTRIBUTES\n            .optionalAttribute(ATTR_PATTERN, \"string\")\n            // Inherits: required, defaultValue from MetaField\n        );\n    }\n    \n    // Remove existing static registration block completely\n}\n```\n\n**File: `metadata/src/main/java/com/draagon/meta/field/IntegerField.java`**\n\n```java\npublic class IntegerField extends PrimitiveField<Integer> {\n    public static final String SUBTYPE_INT = \"int\";\n    public static final String ATTR_MIN_VALUE = \"minValue\";\n    public static final String ATTR_MAX_VALUE = \"maxValue\";\n    \n    static {\n        MetaDataRegistry.registerType(IntegerField.class, def -> def\n            .type(TYPE_FIELD).subType(SUBTYPE_INT)\n            .description(\"Integer field with range validation\")\n            \n            // NUMERIC-SPECIFIC ATTRIBUTES\n            .optionalAttribute(ATTR_MIN_VALUE, \"int\")\n            .optionalAttribute(ATTR_MAX_VALUE, \"int\")\n            // Inherits: required, defaultValue from MetaField\n        );\n    }\n    \n    // Remove existing static registration block completely\n}\n```\n\n**File: `metadata/src/main/java/com/draagon/meta/object/MetaObject.java`**\n\n```java\npublic class MetaObject extends MetaData {\n    public static final String TYPE_OBJECT = \"object\";\n    \n    static {\n        MetaDataRegistry.registerType(MetaObject.class, def -> def\n            .type(TYPE_OBJECT).subType(\"base\")\n            .description(\"Object containing fields and attributes\")\n            \n            // OBJECTS CONTAIN FIELDS (any field type, any name)\n            .optionalChild(\"field\", \"*\", \"*\")\n            \n            // OBJECTS CAN HAVE ATTRIBUTES\n            .optionalAttribute(\"description\", \"string\")\n        );\n    }\n}\n```\n\n**File: `metadata/src/main/java/com/draagon/meta/attr/StringAttribute.java`**\n\n```java\npublic class StringAttribute extends MetaAttribute<String> {\n    public static final String TYPE_ATTR = \"attr\";\n    public static final String SUBTYPE_STRING = \"string\";\n    \n    static {\n        MetaDataRegistry.registerType(StringAttribute.class, def -> def\n            .type(TYPE_ATTR).subType(SUBTYPE_STRING)\n            .description(\"String attribute value\")\n            // NO CHILD REQUIREMENTS - just registers identity\n        );\n    }\n    \n    // Remove existing placement constraint registration completely\n}\n```\n\n### **STEP 3: Remove Dual Registry Pattern (Week 2)**\n\n**File: `metadata/src/main/java/com/draagon/meta/type/MetaDataTypeRegistry.java`**\n\n**ACTION: DELETE THIS FILE** - It's the obsolete singleton registry\n\n**File: `metadata/src/main/java/com/draagon/meta/constraint/ConstraintRegistry.java`**\n\n**ACTION: DELETE THIS FILE** - Constraints now integrated into type definitions\n\n**Files to Update:**\n- Remove all imports of `com.metaobjects.type.MetaDataTypeRegistry`\n- Remove all imports of `com.metaobjects.constraint.ConstraintRegistry`\n- Remove all `ConstraintRegistry.getInstance().addConstraint()` calls\n\n### **STEP 4: Create Service-Based Extensions (Week 3)**\n\n**File: `metadata/src/main/java/com/draagon/meta/registry/DatabaseAttributeProvider.java`**\n\n```java\npublic class DatabaseAttributeProvider implements MetaDataTypeProvider {\n    public static final String ATTR_DB_COLUMN = \"dbColumn\";\n    public static final String ATTR_DB_TABLE = \"dbTable\";\n    public static final String ATTR_DB_NULLABLE = \"dbNullable\";\n    \n    @Override\n    public void enhanceTypes(MetaDataRegistry registry) {\n        // ALL FIELD TYPES can have database column attributes\n        registry.addGlobalChildRequirement(\"field\", \"*\",\n            new ChildRequirement(ATTR_DB_COLUMN, \"attr\", \"string\", false));\n            \n        registry.addGlobalChildRequirement(\"field\", \"*\", \n            new ChildRequirement(ATTR_DB_NULLABLE, \"attr\", \"boolean\", false));\n            \n        // ALL OBJECT TYPES can have database table attributes  \n        registry.addGlobalChildRequirement(\"object\", \"*\",\n            new ChildRequirement(ATTR_DB_TABLE, \"attr\", \"string\", false));\n    }\n}\n```\n\n### **STEP 5: Enhanced Validation (Week 4)**\n\n**File: `metadata/src/main/java/com/draagon/meta/MetaData.java`**\n\nUpdate the `addChild()` method:\n\n```java\npublic void addChild(MetaData child) {\n    // VALIDATE: Does this parent accept this child?\n    ChildRequirement req = MetaDataRegistry.getInstance()\n        .getChildRequirement(this.getType(), this.getSubType(), child.getName());\n        \n    if (req == null) {\n        // CHECK WILDCARD MATCHES\n        List<ChildRequirement> allReqs = MetaDataRegistry.getInstance()\n            .getChildRequirements(this.getType(), this.getSubType());\n            \n        boolean matches = allReqs.stream()\n            .anyMatch(r -> r.matches(child.getType(), child.getSubType(), child.getName()));\n            \n        if (!matches) {\n            throw new MetaDataException(String.format(\n                \"%s.%s does not accept child '%s' of type %s.%s. Supported children: %s\",\n                this.getType(), this.getSubType(), child.getName(),\n                child.getType(), child.getSubType(), getSupportedChildrenDescription()));\n        }\n    } else {\n        // VALIDATE SPECIFIC REQUIREMENT\n        if (!req.matches(child.getType(), child.getSubType(), child.getName())) {\n            throw new MetaDataException(String.format(\n                \"Child '%s' expects %s.%s but got %s.%s\",\n                child.getName(), req.getExpectedType(), req.getExpectedSubType(),\n                child.getType(), child.getSubType()));\n        }\n    }\n    \n    super.addChild(child);\n}\n```\n\n### **STEP 6: Schema Generation Enhancement (Week 4)**\n\n**File: `codegen/src/main/java/com/draagon/meta/generator/direct/metadata/file/xsd/MetaDataFileXSDWriter.java`**\n\nUpdate to use child requirements:\n\n```java\nprivate void generateElementSchema(String elementType, String elementSubType) {\n    TypeDefinition def = MetaDataRegistry.getInstance().getTypeDefinition(elementType, elementSubType);\n    List<ChildRequirement> children = def.getChildRequirements();\n    \n    // GENERATE XSD ELEMENTS for each child requirement\n    for (ChildRequirement child : children) {\n        if (child.getExpectedType().equals(\"attr\")) {\n            // Generate attribute element in XSD\n            generateAttributeElement(child.getName(), child.getExpectedSubType(), child.isRequired());\n        } else {\n            // Generate child element in XSD  \n            generateChildElement(child.getExpectedType(), child.getExpectedSubType(), child.isRequired());\n        }\n    }\n}\n```\n\n## üß™ **Testing Requirements**\n\n### **STEP 7: Update Tests**\n\n**File: `metadata/src/test/java/com/draagon/meta/registry/UnifiedRegistryTest.java`** (NEW)\n\n```java\npublic class UnifiedRegistryTest {\n    \n    @Test\n    public void testSingleRegistrationPoint() {\n        // Verify StringField registration includes pattern attribute\n        TypeDefinition def = MetaDataRegistry.getInstance().getTypeDefinition(\"field\", \"string\");\n        assertNotNull(def);\n        \n        ChildRequirement patternReq = def.getChildRequirement(\"pattern\");\n        assertNotNull(patternReq);\n        assertEquals(\"attr\", patternReq.getExpectedType());\n        assertEquals(\"string\", patternReq.getExpectedSubType());\n        assertFalse(patternReq.isRequired());\n    }\n    \n    @Test\n    public void testChildValidation() {\n        StringField stringField = new StringField(\"email\");\n        StringAttribute patternAttr = new StringAttribute(\"pattern\");\n        \n        // Should succeed - StringField accepts pattern attribute\n        assertDoesNotThrow(() -> stringField.addChild(patternAttr));\n        \n        StringAttribute invalidAttr = new StringAttribute(\"invalidAttribute\");\n        \n        // Should fail - StringField doesn't accept invalidAttribute\n        assertThrows(MetaDataException.class, () -> stringField.addChild(invalidAttr));\n    }\n    \n    @Test\n    public void testServiceBasedExtensions() {\n        // Verify database service adds global requirements\n        List<ChildRequirement> fieldReqs = MetaDataRegistry.getInstance()\n            .getChildRequirements(\"field\", \"string\");\n            \n        boolean hasDbColumn = fieldReqs.stream()\n            .anyMatch(req -> req.getName().equals(\"dbColumn\"));\n        assertTrue(hasDbColumn);\n    }\n}\n```\n\n### **STEP 8: Validation Tests**\n\nRun these commands to verify implementation:\n\n```bash\n# Compile everything\nmvn clean compile\n\n# Run tests\nmvn test\n\n# Verify specific tests\ncd metadata && mvn test -Dtest=UnifiedRegistryTest\n```\n\n**Expected Results:**\n- All existing tests continue to pass\n- No compilation errors\n- New unified registry functionality works\n- Child validation prevents invalid placements\n- Schema generation uses child requirements\n\n## ‚úÖ **Success Criteria**\n\n### **Technical Validation**\n- [ ] Single MetaDataRegistry class replaces dual pattern\n- [ ] All MetaData classes use unified registration API\n- [ ] Child requirements integrated (no separate ConstraintRegistry)\n- [ ] Constants owned by appropriate classes (no central constants)\n- [ ] Generic child requirements support any MetaData type\n- [ ] Service-based extensions work for cross-cutting concerns\n- [ ] All existing tests continue to pass\n- [ ] Better error messages with supported children lists\n\n### **Code Quality Validation**\n- [ ] No `com.metaobjects.type.MetaDataTypeRegistry` imports remain\n- [ ] No `ConstraintRegistry` imports or usage remain\n- [ ] Each class owns its own constants (TYPE_*, SUBTYPE_*, ATTR_*)\n- [ ] Parent types define what children they accept\n- [ ] Child types just register their identity\n- [ ] No overly broad placement rules (like \"any MetaData\")\n\n### **Functional Validation**\n- [ ] StringField accepts pattern attribute but rejects invalid attributes\n- [ ] MetaObject can contain MetaField children\n- [ ] EmailValidator requires specific pattern attribute\n- [ ] Database service adds cross-cutting attributes to all field types\n- [ ] Schema generation knows required/optional children\n- [ ] Inline attribute parsing works with type validation\n\n## üö® **Critical Implementation Notes**\n\n### **Architecture Compliance**\n- **Read-Optimized Pattern**: This is a READ-OPTIMIZED framework like Java Class/Field reflection\n- **OSGI Compatibility**: Maintain WeakHashMap patterns and service discovery\n- **Thread Safety**: Registry access must be thread-safe for concurrent reads\n- **Performance**: Optimize for heavy read access, infrequent registration\n\n### **Migration Strategy**\n- **Backward Compatibility**: Maintain deprecated wrapper methods during transition\n- **Gradual Migration**: Update classes incrementally, test continuously\n- **Service Discovery**: Ensure OSGI service loading continues to work\n\n### **Error Handling**\n- **Rich Error Messages**: Include supported children lists in validation errors\n- **Context Preservation**: Maintain metadata paths in exceptions\n- **Validation Context**: Use ValidationContext for detailed error reporting\n\n## üéØ **Final Deliverables**\n\n1. **Unified MetaDataRegistry** - Single registry with integrated child requirements\n2. **Updated Core Classes** - All MetaData classes using new registration pattern\n3. **Service Providers** - Database/security cross-cutting attribute providers\n4. **Enhanced Validation** - Child requirement validation in addChild()\n5. **Schema Generation** - XSD/JSON generators using child requirements\n6. **Comprehensive Tests** - Verify all functionality and edge cases\n7. **Migration Complete** - No dual registry references remain\n\n**This implementation will eliminate the dual registry pattern, integrate child requirements with type definitions, and provide a clean foundation for schema generation and service-based extensions while maintaining the flexibility needed for a power-user metadata framework.**",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/outdated-planning-docs/IMPLEMENTATION_PROMPT.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "def",
        "md"
      ],
      "content_hash": "66af2f35ee9131d7",
      "size_bytes": 22177,
      "created_at": "2026-01-02T20:42:12.428829"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_outdated-planning-docs_README",
      "source": "local",
      "category": "conversational",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/outdated-planning-docs/README.md",
      "content": "# Archived Planning Documents\n\n## Purpose\nThese documents have been archived because they contain outdated planning and analysis information that could confuse future Claude sessions. The current architecture and build system information is now comprehensively documented in the main `.claude/CLAUDE.md` file.\n\n## Archived Files (2025-09-21)\n\n### 1. COMPREHENSIVE_CONSTRAINT_SPECIFICATION.md\n- **Purpose**: Detailed 882-line analysis of constraint system architecture\n- **Status**: Pre-implementation analysis document  \n- **Why Archived**: Constraint system has been implemented and unified. Current status documented in main CLAUDE.md\n- **Replacement**: See \"Constraint System Unification (v6.0.0+)\" section in CLAUDE.md\n\n### 2. IMPLEMENTATION_PROMPT.md  \n- **Purpose**: Implementation plan for unified MetaData registry architecture\n- **Status**: Planning document for registry unification work\n- **Why Archived**: Some work completed, but approach may have evolved. Could cause confusion about current state\n- **Replacement**: See \"Self-Registration Pattern (v5.2.0+)\" and build system insights in CLAUDE.md\n\n### 3. UNIFIED_REGISTRY_ARCHITECTURE_PLAN.md\n- **Purpose**: Plan for simplifying dual MetaDataTypeRegistry pattern\n- **Status**: Acknowledges some v6.0.0+ work completed but proposes additional changes  \n- **Why Archived**: Current architecture working well as documented in main CLAUDE.md\n- **Replacement**: See build system insights and architectural principles in CLAUDE.md\n\n## Current Documentation\nFor up-to-date architectural information, constraint system status, and build system insights, refer to:\n- **Primary**: `.claude/CLAUDE.md` - Comprehensive, current guide\n- **Architecture**: `.claude/architectural-summary.md` - High-level overview\n- **Enhancements**: `.claude/ENHANCEMENTS.md` - Prioritized improvement tasks\n\n## Historical Value\nThese documents are preserved for historical reference and contain detailed analysis that may be useful for understanding the evolution of the MetaObjects framework architecture.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/outdated-planning-docs/README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "readme"
      ],
      "content_hash": "7a08d8b624560db8",
      "size_bytes": 2041,
      "created_at": "2026-01-02T20:42:12.428892"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_outdated-planning-docs_CONTINUE_ID_ANNOTATION_FIX",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/outdated-planning-docs/CONTINUE_ID_ANNOTATION_FIX.md",
      "content": "# Continue @Id Annotation Fix - Session Handoff Prompt\n\n## üéØ **CURRENT STATUS: 82% SUCCESS ACHIEVED**\n\n**Context**: We systematically fixed a completely broken build (17 errors) down to just **3 minor test failures** - an **82% improvement**! The systematic \"THINK HARD THROUGH THIS STEP BY STEP\" approach was highly effective.\n\n### ‚úÖ **MAJOR ISSUES ALREADY FIXED**\n- ‚úÖ **JavaObjectDirectGeneratorTest**: All 6 tests now passing\n- ‚úÖ **Package naming constraint violations**: Fixed `com.example.model` ‚Üí `com_example_model`\n- ‚úÖ **File generation paths**: Updated all directory references for underscore package names\n- ‚úÖ **Package declarations**: Fixed all test expectations\n- ‚úÖ **Compilation errors**: Resolved all dependency and class issues\n- ‚úÖ **MustacheTemplateGeneratorTest**: 8/9 tests passing (89% success)\n- ‚úÖ **MustacheTemplateEngineTest**: 6/8 tests passing (75% success)\n\n## üîç **REMAINING ISSUE: @Id Annotation Generation**\n\n### **Problem Summary**\nThe final 3 test failures are all related to **@Id annotation not being generated** in code templates. Root cause: **Inline attribute type detection issue**.\n\n### **Technical Issue**\nInline attributes with boolean values are being processed as **StringAttribute** instead of **BooleanAttribute**:\n\n```json\n{\n  \"field\": {\n    \"name\": \"id\",\n    \"type\": \"long\", \n    \"@isId\": true,           // Should create BooleanAttribute\n    \"@dbColumn\": \"user_id\"   // Should create StringAttribute  \n  }\n}\n```\n\n**Error Pattern:**\n```\n[StringAttribute:isId] field.long does not accept child 'isId' of type attr.string\n```\n\n**Expected:**\n```\n[BooleanAttribute:isId] field.long accepts child 'isId' of type attr.boolean\n```\n\n### **Current Test Failures**\n\n1. **MustacheTemplateGeneratorTest.testGenerateJpaEntity:96** - \"Should contain @Id\"\n2. **MustacheTemplateEngineTest.testJpaEntityTemplate:63** - \"Should contain @Id annotation\"  \n3. **MustacheTemplateEngineTest.testHelperFunctions:109** - Helper function issue\n\n**Tests Expect**: `@Id` annotation in generated Java code when `@isId: true` in metadata\n\n## üîß **LIKELY SOLUTION AREA**\n\n### **Primary Investigation Target**\n**File**: `metadata/src/main/java/com/draagon/meta/loader/parser/json/JsonMetaDataParser.java`\n- **Focus**: `parseInlineAttribute()` method\n- **Issue**: Type detection logic defaulting to \"string\" instead of detecting boolean type from JSON value\n\n### **Supporting Configuration**\n**File**: `core/src/main/resources/com/draagon/meta/loader/xml/metaobjects.types.xml`\n- **Status**: Already correctly configured with `<child type=\"attr\" subType=\"boolean\" name=\"isId\"/>`\n- **Verification**: The XML config supports boolean isId attributes\n\n### **Type Registration**\n**Files**: `metadata/src/main/java/com/draagon/meta/field/*Field.java`\n- **Status**: Already correctly configured with `.optionalAttribute(\"isId\", \"boolean\")`\n- **Verification**: Field types support boolean isId attributes\n\n## üéØ **NEXT STEPS FOR NEW SESSION**\n\n### **Step 1: Investigate Inline Attribute Parser**\n```bash\n# Read the inline attribute parsing logic\nRead: metadata/src/main/java/com/draagon/meta/loader/parser/json/JsonMetaDataParser.java\n# Look for parseInlineAttribute() or similar method\n# Focus on type detection from JSON values\n```\n\n### **Step 2: Analyze Type Detection Logic**\nLook for code that processes `@attribute: value` pairs and determines attribute subtype:\n- **Expected**: `@isId: true` should detect boolean type and create BooleanAttribute\n- **Actual**: Creating StringAttribute instead\n\n### **Step 3: Fix Type Detection**\nLikely needs enhanced logic to:\n```java\n// Detect JSON value type and map to appropriate attribute subtype\nif (value instanceof Boolean) {\n    attributeSubType = \"boolean\";\n} else if (value instanceof Number) {\n    attributeSubType = \"int\"; // or \"double\" based on type\n} else {\n    attributeSubType = \"string\"; // default\n}\n```\n\n### **Step 4: Test the Fix**\n```bash\n# After fixing inline attribute type detection:\ncd codegen && mvn clean compile test-compile\ncd codegen && mvn surefire:test -Dtest=MustacheTemplateGeneratorTest\n# Should see reduction from 3 failures to 0-1 failures\n```\n\n### **Step 5: Final Verification**\n```bash\n# Run full codegen test suite\ncd codegen && mvn surefire:test\n# Target: All 55 tests passing (currently 52/55 passing)\n```\n\n## üìã **CONTEXT FOR DEBUGGING**\n\n### **Metadata Registration Status**\n- **Java Self-Registration**: ‚úÖ Working - All field types register isId as boolean\n- **XML Configuration**: ‚úÖ Working - metaobjects.types.xml has correct boolean isId\n- **Field Type Support**: ‚úÖ Working - LongField, IntegerField, etc. accept boolean isId\n\n### **Template System**\n- **Mustache Templates**: ‚úÖ Working - Templates expect `{{#isId}}@Id{{/isId}}` pattern\n- **Code Generation**: ‚úÖ Working - File generation, package structures all correct\n- **Only Issue**: Boolean attributes not being created from inline JSON syntax\n\n### **Build System Health**\n- **Dependencies**: ‚úÖ All resolved - metadata test-jar installed\n- **Compilation**: ‚úÖ All modules compile successfully  \n- **Test Infrastructure**: ‚úÖ SimpleLoaderTestBase accessible\n- **Overall**: System is stable and ready for targeted fix\n\n## üóÇÔ∏è **REFERENCE DOCUMENTATION**\n\n**Updated Documentation**: The main `.claude/CLAUDE.md` file has been comprehensively updated with:\n- Build system insights and critical lessons learned\n- Package naming constraint documentation  \n- Systematic troubleshooting methodology\n- Common build failure patterns and solutions\n\n**Key Insight**: The inline attribute type detection is the ONLY remaining architectural issue preventing 100% test success.\n\n## üéØ **SUCCESS CRITERIA**\n\n**Goal**: Reduce remaining failures from 3 to 0\n**Approach**: Fix inline attribute type detection for boolean values\n**Verification**: All 55 codegen tests passing\n**Impact**: 100% build success, fully operational code generation system\n\n**This is the final piece to complete the systematic build restoration!** üöÄ",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/outdated-planning-docs/CONTINUE_ID_ANNOTATION_FIX.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "example",
        "md",
        "test"
      ],
      "content_hash": "41f1d43b5f09ab53",
      "size_bytes": 6009,
      "created_at": "2026-01-02T20:42:12.428956"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_outdated-planning-docs_UNIFIED_REGISTRY_ARCHITECTURE_PLAN",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/outdated-planning-docs/UNIFIED_REGISTRY_ARCHITECTURE_PLAN.md",
      "content": "# Simplified MetaData Registry Architecture Plan (v6.0.0+ Updated)\n\n## üéØ **Executive Summary**\n\n**STATUS UPDATE**: The constraint system unification described in the original plan has been **COMPLETED** in v6.0.0+. This updated plan focuses on the **REAL remaining issue**: simplifying the dual MetaDataTypeRegistry pattern based on the user's explicit preference for static self-registration over provider complexity.\n\n**Key Decision**: Use static self-registration as the PRIMARY pattern, eliminate provider complexity while maintaining plugin extensibility through simpler mechanisms.\n\n## ‚úÖ **Already Completed in v6.0.0+**\n\n### **Constraint System Unification - DONE ‚úÖ**\n- **Unified ConstraintRegistry**: Single storage, no dual JSON/programmatic pattern\n- **Real-Time Enforcement**: Constraints enforced during addChild(), 3x performance improvement\n- **Self-Registration**: MetaData classes register constraints via static blocks\n- **Rich Error Context**: ValidationContext with detailed error messages\n- **Module JSON Constraints**: Domain-specific constraints working (database, web modules)\n\n### **Type Definition System - DONE ‚úÖ**\n- **TypeDefinition + ChildRequirement**: Parent-child relationships defined\n- **Generic Child Requirements**: Support any MetaData type as children (not just attributes)\n- **MetaDataRegistry Integration**: Child requirements integrated with type registration\n\n### **Performance Optimizations - DONE ‚úÖ**\n- **Single Enforcement Loop**: Replaced 4 separate paths with 1 unified loop\n- **Constraint Caching**: Applicability cached, indexed by type\n- **Early Termination**: Open policy for placement constraints\n\n## üîç **REAL REMAINING PROBLEM**\n\n### **Problem: Dual MetaDataTypeRegistry Confusion**\n```java\n// CURRENT ISSUE - Two different registries with different APIs\nimport com.metaobjects.type.MetaDataTypeRegistry;              // Singleton pattern\nimport com.metaobjects.registry.MetaDataTypeRegistry;          // Service pattern\n\n// Different access patterns creating confusion\nMetaDataTypeRegistry typeRegistry = MetaDataTypeRegistry.getInstance();    // Singleton\nMetaDataTypeRegistry serviceRegistry = new MetaDataTypeRegistry();         // Service\n```\n\n### **Problem: Provider Pattern Complexity**\n```java\n// CURRENT COMPLEXITY - Multiple registration layers\npublic class CoreMetaDataTypeProvider implements MetaDataTypeProvider {\n    @Override\n    public void registerTypes(MetaDataTypeRegistry registry) { /* 50+ registrations */ }\n    @Override\n    public void enhanceValidation(MetaDataTypeRegistry registry) { /* deprecated */ }\n    @Override\n    public void registerDefaults(MetaDataTypeRegistry registry) { /* defaults */ }\n}\n\n// PLUS individual self-registration\npublic class StringField extends PrimitiveField<String> {\n    static {\n        MetaDataRegistry.registerType(StringField.class, def -> def /* self-registration */);\n    }\n}\n```\n\n### **User's Explicit Decision**\n> *\"I didn't want the CoreMetaDataTypeProvider, I wanted the self registration approach. This is better for when there are additional MetaData derived types created in downstream modules.\"*\n\n> *\"Isn't there a better design for the Registry and Providers, where it's simpler and easier to use? It should allow MetaData to statically register itself individually, as well as have a plugin or service register metadata configurations.\"*\n\n## üèóÔ∏è **SIMPLIFIED SOLUTION ARCHITECTURE**\n\n### **Core Design Principles**\n\n#### **1. Static Self-Registration as PRIMARY Pattern**\n```java\n// PRIMARY PATTERN - Individual classes self-register\npublic class StringField extends PrimitiveField<String> {\n    static {\n        // Single registration point - type + constraints + child requirements\n        MetaDataRegistry.registerType(StringField.class, def -> def\n            .type(TYPE_FIELD).subType(SUBTYPE_STRING)\n            .description(\"String field with pattern validation\")\n            \n            // Child requirements (what this type accepts)\n            .optionalAttribute(ATTR_PATTERN, \"string\")\n            .optionalAttribute(ATTR_MAX_LENGTH, \"int\")\n            .optionalChild(\"validator\", \"*\")\n            .optionalChild(\"view\", \"*\")\n        );\n    }\n}\n```\n\n#### **2. Simplified Plugin Pattern (SECONDARY)**\n```java\n// SECONDARY PATTERN - Simple service registration for plugins/modules\npublic class DatabaseFieldsPlugin implements MetaDataPlugin {\n    @Override\n    public void registerTypes(MetaDataRegistry registry) {\n        // Plugin registers its types simply\n        registry.registerType(DatabaseField.class, def -> def /* plugin fields */);\n        registry.registerType(SQLField.class, def -> def /* plugin fields */);\n    }\n}\n```\n\n#### **3. Eliminate Provider Complexity**\n- **Remove**: Complex MetaDataTypeProvider hierarchy\n- **Remove**: Dual registry pattern confusion\n- **Keep**: Extensibility through simpler plugin interface\n- **Keep**: All existing constraint functionality (documented in COMPREHENSIVE_CONSTRAINT_SPECIFICATION.md)\n\n### **Unified Registry API**\n\n```java\n// SINGLE REGISTRY - No more dual pattern\npublic class MetaDataRegistry {\n    private static volatile MetaDataRegistry instance;\n    \n    // PRIMARY API - Static self-registration\n    public static void registerType(Class<? extends MetaData> clazz, \n                                   Consumer<TypeDefinitionBuilder> configurator) {\n        getInstance().doRegisterType(clazz, configurator);\n    }\n    \n    // PLUGIN API - Simple service registration\n    public void registerPlugin(MetaDataPlugin plugin) {\n        plugin.registerTypes(this);\n    }\n    \n    // RUNTIME API - Type lookup and creation\n    public TypeDefinition getTypeDefinition(String type, String subType) { /* ... */ }\n    public <T extends MetaData> T createInstance(String type, String subType, String name) { /* ... */ }\n    \n    // CONSTRAINT INTEGRATION - Already working\n    public boolean acceptsChild(String parentType, String parentSubType, \n                               String childType, String childSubType, String childName) { /* ... */ }\n}\n\n// SIMPLIFIED PLUGIN INTERFACE\npublic interface MetaDataPlugin {\n    void registerTypes(MetaDataRegistry registry);\n    default String getPluginName() { return getClass().getSimpleName(); }\n    default int getPriority() { return 100; }\n}\n```\n\n### **TypeDefinitionBuilder - Enhanced API**\n\n```java\npublic static class TypeDefinitionBuilder {\n    // BASIC TYPE DEFINITION\n    public TypeDefinitionBuilder type(String type) { /* ... */ }\n    public TypeDefinitionBuilder subType(String subType) { /* ... */ }\n    public TypeDefinitionBuilder description(String description) { /* ... */ }\n    \n    // CHILD REQUIREMENTS (using existing ChildRequirement system)\n    public TypeDefinitionBuilder requiredChild(String childType, String childSubType, String childName) { /* ... */ }\n    public TypeDefinitionBuilder optionalChild(String childType, String childSubType, String childName) { /* ... */ }\n    \n    // CONVENIENCE METHODS\n    public TypeDefinitionBuilder optionalAttribute(String attrName, String attrSubType) {\n        return optionalChild(\"attr\", attrSubType, attrName);\n    }\n    public TypeDefinitionBuilder optionalChild(String childType, String childSubType) {\n        return optionalChild(childType, childSubType, \"*\"); // Any name\n    }\n    \n    // CONSTRAINT INTEGRATION - Use existing constraint system\n    public TypeDefinitionBuilder addConstraint(Constraint constraint) { /* ... */ }\n}\n```\n\n## üîß **Implementation Examples**\n\n### **Core Fields - Static Self-Registration**\n\n```java\n// StringField.java - SIMPLIFIED SELF-REGISTRATION\npublic class StringField extends PrimitiveField<String> {\n    public static final String TYPE_FIELD = \"field\";\n    public static final String SUBTYPE_STRING = \"string\";\n    public static final String ATTR_PATTERN = \"pattern\";\n    public static final String ATTR_MAX_LENGTH = \"maxLength\";\n    \n    static {\n        MetaDataRegistry.registerType(StringField.class, def -> def\n            .type(TYPE_FIELD).subType(SUBTYPE_STRING)\n            .description(\"String field with pattern validation\")\n            \n            // What this field type accepts\n            .optionalAttribute(ATTR_PATTERN, \"string\")\n            .optionalAttribute(ATTR_MAX_LENGTH, \"int\")\n            .optionalChild(\"validator\", \"*\")\n            .optionalChild(\"view\", \"*\")\n        );\n    }\n}\n\n// IntegerField.java - CONSISTENT PATTERN\npublic class IntegerField extends PrimitiveField<Integer> {\n    public static final String SUBTYPE_INT = \"int\";\n    public static final String ATTR_MIN_VALUE = \"minValue\";\n    public static final String ATTR_MAX_VALUE = \"maxValue\";\n    \n    static {\n        MetaDataRegistry.registerType(IntegerField.class, def -> def\n            .type(TYPE_FIELD).subType(SUBTYPE_INT)\n            .description(\"Integer field with range validation\")\n            \n            .optionalAttribute(ATTR_MIN_VALUE, \"int\")\n            .optionalAttribute(ATTR_MAX_VALUE, \"int\")\n            .optionalChild(\"validator\", \"*\")\n            .optionalChild(\"view\", \"*\")\n        );\n    }\n}\n```\n\n### **Plugin Registration - Simplified**\n\n```java\n// DatabasePlugin.java - SIMPLE PLUGIN PATTERN\npublic class DatabasePlugin implements MetaDataPlugin {\n    \n    @Override\n    public void registerTypes(MetaDataRegistry registry) {\n        // Plugin registers its types using same API\n        registry.registerType(DatabaseField.class, def -> def\n            .type(\"field\").subType(\"database\")\n            .description(\"Database-backed field\")\n            .optionalAttribute(\"dbTable\", \"string\")\n            .optionalAttribute(\"dbColumn\", \"string\")\n        );\n        \n        registry.registerType(SQLField.class, def -> def\n            .type(\"field\").subType(\"sql\")\n            .description(\"SQL query field\")\n            .optionalAttribute(\"sqlQuery\", \"string\")\n        );\n    }\n    \n    @Override\n    public String getPluginName() {\n        return \"Database Fields Plugin\";\n    }\n}\n\n// Plugin discovery via ServiceLoader (existing pattern)\n// META-INF/services/com.metaobjects.MetaDataPlugin\n// com.company.database.DatabasePlugin\n```\n\n### **Eliminate Provider Complexity**\n\n```java\n// REMOVE: CoreMetaDataTypeProvider complexity\n// REMOVE: BasicMetaViewTypeProvider complexity  \n// REMOVE: Dual registry access patterns\n\n// REPLACE WITH: Simple ServiceLoader discovery\npublic class MetaDataRegistryInitializer {\n    \n    public static void initializeRegistry() {\n        MetaDataRegistry registry = MetaDataRegistry.getInstance();\n        \n        // Discover and register plugins\n        ServiceLoader<MetaDataPlugin> plugins = ServiceLoader.load(MetaDataPlugin.class);\n        for (MetaDataPlugin plugin : plugins) {\n            registry.registerPlugin(plugin);\n        }\n        \n        // Static registrations happen automatically via class loading\n        // No explicit provider registration needed\n    }\n}\n```\n\n## üìã **Implementation Plan**\n\n### **PHASE 1: Registry Simplification (Week 1)**\n\n**1. Create Single MetaDataRegistry**\n- Eliminate dual MetaDataTypeRegistry pattern\n- Provide single access point: `MetaDataRegistry.getInstance()`\n- Maintain backward compatibility during transition\n\n**2. Simplify Plugin Interface**\n- Create simple `MetaDataPlugin` interface\n- Replace complex `MetaDataTypeProvider` hierarchy\n- ServiceLoader discovery for plugins\n\n**3. Enhanced TypeDefinitionBuilder**\n- Integrate with existing constraint system\n- Support for child requirements (already implemented)\n- Convenience methods for common patterns\n\n### **PHASE 2: Core Type Migration (Week 2)**\n\n**4. Migrate Core Fields to Static Registration**\n- Update StringField, IntegerField, etc. to use simplified API\n- Remove dependency on CoreMetaDataTypeProvider\n- Ensure all child requirements preserved\n\n**5. Migrate View Types to Static Registration**\n- Update BasicMetaView registration\n- Remove BasicMetaViewTypeProvider complexity\n- Maintain all view subtypes\n\n**6. Update Service Discovery**\n- Simplify ServiceLoader usage\n- Remove complex provider initialization\n- Maintain OSGI compatibility\n\n### **PHASE 3: Plugin Migration (Week 3)**\n\n**7. Create Plugin Examples**\n- Database plugin for cross-cutting attributes\n- Security plugin for access control\n- Demonstrate simplified extension pattern\n\n**8. Migration Guide**\n- Document transition from provider to plugin pattern\n- Provide migration examples for existing providers\n- Maintain backward compatibility where possible\n\n### **PHASE 4: Testing & Performance (Week 4)**\n\n**9. Comprehensive Testing**\n- All existing functionality preserved\n- Plugin registration and discovery working\n- Performance matches or exceeds current system\n\n**10. Documentation Update**\n- Update architecture documentation\n- Create plugin development guide\n- Remove outdated provider documentation\n\n## üéØ **Expected Benefits**\n\n### **Simplified Architecture**\n- **Single registry** instead of dual pattern confusion\n- **Static-first registration** as primary approach\n- **Simple plugin interface** for extensibility\n- **Consistent API** across all registration patterns\n\n### **Maintained Functionality**\n- **All constraint functionality preserved** (documented in COMPREHENSIVE_CONSTRAINT_SPECIFICATION.md)\n- **All child requirements preserved** (TypeDefinition + ChildRequirement system)\n- **All performance optimizations preserved** (unified enforcement, caching)\n- **All module constraints preserved** (database, web JSON constraints)\n\n### **Enhanced Developer Experience**\n- **Clear primary pattern**: Static self-registration for most cases\n- **Simple extension**: Plugin interface for cross-cutting concerns\n- **No dual registration**: Single API eliminates confusion\n- **Better IDE support**: Static registration discoverable in class\n\n### **Plugin Extensibility**\n- **Simplified interface**: Single method registration vs complex provider\n- **ServiceLoader discovery**: Standard Java pattern, OSGI compatible\n- **Priority support**: Plugin ordering for dependency resolution\n- **Clean separation**: Plugins vs individual type registration\n\n## üîÑ **Before/After Transformation**\n\n### **Current Complex Pattern (BEFORE):**\n```java\n// Complex provider hierarchy\npublic class CoreMetaDataTypeProvider implements MetaDataTypeProvider {\n    @Override public void registerTypes(MetaDataTypeRegistry registry) { /* 50+ lines */ }\n    @Override public void enhanceValidation(MetaDataTypeRegistry registry) { /* deprecated */ }\n    @Override public void registerDefaults(MetaDataTypeRegistry registry) { /* defaults */ }\n}\n\n// PLUS dual registry access\nMetaDataTypeRegistry typeRegistry = MetaDataTypeRegistry.getInstance();\nMetaDataTypeRegistry serviceRegistry = new MetaDataTypeRegistry();\n\n// PLUS individual self-registration\nstatic { MetaDataRegistry.registerType(/* duplicate patterns */); }\n```\n\n### **Simplified Pattern (AFTER):**\n```java\n// Primary pattern - static self-registration\npublic class StringField extends PrimitiveField<String> {\n    static {\n        MetaDataRegistry.registerType(StringField.class, def -> def\n            .type(TYPE_FIELD).subType(SUBTYPE_STRING)\n            .optionalAttribute(\"pattern\", \"string\")\n            .optionalChild(\"validator\", \"*\")\n        );\n    }\n}\n\n// Secondary pattern - simple plugins\npublic class DatabasePlugin implements MetaDataPlugin {\n    @Override\n    public void registerTypes(MetaDataRegistry registry) {\n        registry.registerType(DatabaseField.class, def -> def /* ... */);\n    }\n}\n\n// Single registry access\nMetaDataRegistry registry = MetaDataRegistry.getInstance();\n```\n\n## ‚úÖ **Success Criteria**\n\n### **Technical Success**\n- [ ] Single MetaDataRegistry replaces dual pattern\n- [ ] Static self-registration works for all core types\n- [ ] Simple plugin interface replaces complex providers\n- [ ] All existing constraint functionality preserved\n- [ ] All existing child requirements preserved\n- [ ] Performance matches or exceeds current system\n- [ ] OSGI compatibility maintained\n\n### **Architectural Success**\n- [ ] Primary pattern: Static self-registration (user preference)\n- [ ] Secondary pattern: Simple plugins for cross-cutting concerns\n- [ ] No dual registry confusion\n- [ ] Clean separation of individual vs module registration\n- [ ] Consistent API across all registration types\n\n### **Developer Experience Success**\n- [ ] Simpler registration (single method vs dual)\n- [ ] Clear primary pattern guidance\n- [ ] Easy plugin development\n- [ ] Better IDE discoverability\n- [ ] Reduced cognitive overhead\n\nThis simplified architecture eliminates the dual registry confusion while maintaining all existing functionality and providing a clean, extensible foundation for future development based on the user's explicit preference for static self-registration over provider complexity.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/outdated-planning-docs/UNIFIED_REGISTRY_ARCHITECTURE_PLAN.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "a06f5d7967954931",
      "size_bytes": 16780,
      "created_at": "2026-01-02T20:42:12.429050"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_architectural-analysis_original-comprehensive-guide",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/architectural-analysis/original-comprehensive-guide.md",
      "content": "# MetaObjects Project - Claude AI Assistant Guide\n\n## Project Overview\nMetaObjects is a Java-based suite of tools for metadata-driven development, providing sophisticated control over applications beyond traditional model-driven development techniques.\n\n- **Current Version**: 5.2.0 (development) - Overlay Functionality Restoration & Service Architecture Enhancement  \n- **Previous Stable**: 5.1.0\n- **License**: Apache License 2.0\n- **Java Version**: Java 21 (upgraded from Java 1.8)\n- **Build Tool**: Maven\n- **Organization**: Doug Mealing LLC\n\n## Project Structure\n\n```\n‚îú‚îÄ‚îÄ core/               # Core MetaObjects functionality\n‚îú‚îÄ‚îÄ metadata/           # Metadata models and types\n‚îú‚îÄ‚îÄ codegen/# Code generation libraries (separated v6.0.0)\n‚îú‚îÄ‚îÄ maven-plugin/       # Maven plugin for code generation\n‚îú‚îÄ‚îÄ om/                # Object Manager module\n‚îú‚îÄ‚îÄ demo/              # Demo applications with React MetaView integration\n‚îú‚îÄ‚îÄ web/               # Web-related utilities with React MetaView components\n‚îú‚îÄ‚îÄ omdb/              # Database Object Manager\n‚îú‚îÄ‚îÄ omnosql/           # NoSQL Object Manager\n‚îî‚îÄ‚îÄ docs/              # Documentation\n```\n\n## Key Build Commands\n\n```bash\n# Build the project\nmvn clean compile\n\n# Run tests\nmvn test\n\n# Package the project\nmvn package\n\n# Generate code using MetaObjects plugin\nmvn metaobjects:generate\n\n# Launch MetaObjects Editor (planned feature)\nmvn metaobjects:editor\n```\n\n## Key Technologies & Dependencies\n\n- **Java 21** with Maven compiler plugin 3.13.0\n- **SLF4J + Logback** for logging (migrated from Commons Logging)\n- **JUnit 4.13.2** for testing\n- **OSGi Bundle Support** via Apache Felix Maven Bundle Plugin\n- **Gson 2.13.1** for JSON handling\n- **Commons Validator 1.9.0** for validation\n- **Maven Build System** with comprehensive plugin configuration\n\n## Core Concepts\n\n### MetaObjects Types\n- **ValueMetaObject**: Dynamic objects with public getter/setter access and Optional-based find methods\n- **DataMetaObject**: Wrapped objects with public accessors and Builder pattern support\n- **ProxyMetaObject**: Proxy implementations without concrete classes\n- **MappedMetaObject**: Works with Map interface objects\n\n### Key Features\n- **Metadata-driven development** with sophisticated control mechanisms\n- **Code generation** support for Java interfaces and XML overlays\n- **JSON/XML serialization** with custom type adapters\n- **Validation framework** with field-level and object-level validators\n- **Default field values** support in meta models\n- **PlantUML diagram generation** from metadata definitions\n- **Maven plugin integration** for build-time code generation\n- **React MetaView System** with TypeScript components and automatic form generation\n\n## Recent Major Changes (v5.1.0)\n\n### Java Modernization\n- Upgraded from Java 1.8 to Java 21\n- Updated Maven compiler to use --release flag\n- Resolved OSGi bundle compatibility for Java 21\n\n### Performance Improvements\n- Intelligent caching in ArrayValidator\n- Optimized getAttrValueAsInt() methods\n- Enhanced error handling with fallback strategies\n\n### Code Quality Enhancements\n- Migrated from Commons Logging to SLF4J (46 files)\n- Replaced StringBuffer with StringBuilder (8 files)\n- Added comprehensive JavaDoc documentation\n- Resolved 25+ critical TODO items\n\n### Multi-Module Enhancement Project (September 2025)\nA comprehensive modernization initiative that enhanced all core modules:\n\n#### Phase 4A: Core Module API Consistency\n- **Fixed Visibility Inconsistency**: DataObject methods now public (consistent with ValueObject)\n- **Added Optional-Based APIs**: `findString()`, `requireString()`, `findInt()` for null-safe access\n- **Implemented Builder Patterns**: ValueObject.Builder, DataObject.Builder, PlantUMLGenerator.Builder\n- **Added Stream APIs**: `getKeysStream()`, `getValuesStream()`, `getEntriesStream()`\n- **Enhanced JavaDoc**: Comprehensive examples and usage patterns\n\n#### Phase 4B: Maven-Plugin Critical Fixes\n- **Fixed Critical Bug**: GeneratorParam.setFilters() parameter assignment issue\n- **Modernized Deprecated Code**: Replaced Class.newInstance() with Constructor.newInstance()\n- **Added Builder Patterns**: GeneratorParam.Builder, LoaderParam.Builder\n- **Enhanced Documentation**: Usage examples and fluent configuration patterns\n\n#### Phase 4C: OM Module Polish\n- **Added Optional APIs**: `findObjectByRef()`, `findFirst()`, `firstOptional()`\n- **Enhanced QueryBuilder**: 50+ lines of comprehensive usage examples\n- **Documented Event System**: Auditing, caching, validation patterns with real-world examples\n- **Added Async Methods**: `findObjectByRefAsync()`, `firstOptionalAsync()`\n\n#### Project Impact\n- **Zero Regressions**: 100% backward compatibility maintained\n- **Enhanced Developer Experience**: Modern, type-safe APIs across all modules\n- **Comprehensive Documentation**: 200+ lines of new JavaDoc with practical examples\n- **Build Success**: All modules compile and test successfully\n\n### React MetaView System Implementation (September 2025)\nA comprehensive React.js integration that extends the JSP-based MetaView system to modern web development:\n\n#### React Components & TypeScript\n- **Complete TypeScript Integration**: Type-safe React components with Redux Toolkit state management\n- **MetaView Component Library**: TextView, NumericView, DateView, SelectView, CheckboxView React components\n- **Dynamic Form Generation**: MetaObjectForm component that automatically renders forms from MetaObject definitions\n- **State Management**: Redux-based form state with React Query for data fetching and caching\n\n#### Backend Integration Architecture\n- **Spring REST API Controllers**: MetaDataApiController serves metadata as JSON to React frontend\n- **Existing IO Package Usage**: Leverages JsonObjectWriter from MetaObjects IO package for proper serialization\n- **FileMetaDataLoader Support**: JSON metadata loading via existing FileMetaDataLoader with JsonMetaDataParser\n- **ObjectManagerDB Integration**: Full database persistence with Derby driver and auto table creation\n\n#### Fishstore Demo Enhancement\n- **Complete React Demo**: Full fishstore storefront application with React components and routing\n- **JSON Metadata Definitions**: Rich metadata with React-specific view configurations, validators, and field attributes\n- **Sample Data Management**: Automated sample data creation with Store, Breed, Tank, and Fish entities\n- **End-to-End Integration**: React frontend ‚Üí Spring API ‚Üí MetaObjects metadata ‚Üí Derby database\n\n#### Key Architectural Lessons\n- **Use Existing Infrastructure**: Always leverage existing MetaObjects patterns (FileMetaDataLoader, IO package) vs custom solutions\n- **Module Dependency Management**: Controllers belong in demo module when referencing demo classes, not web module\n- **JSON Metadata Location**: Place JSON metadata in `/src/main/resources/metadata/` for proper classpath loading\n- **API Consistency**: Use correct ObjectManager methods (`createObject()` not `insertObject()`) and constructor signatures\n\n### TypesConfig Replacement Architecture Implementation (v6.0.0)\nA comprehensive architectural redesign that replaces the TypesConfig system with modern service-based architecture supporting cross-language implementations:\n\n#### Core Architecture Transformation (Phases A, B, C)\n\n**Phase A: Service-Based Type Registry (Completed ‚úÖ)**\n- **MetaDataTypeRegistry**: Service-based type registry replacing global TypesConfig\n- **ServiceRegistry Abstraction**: OSGI-compatible service discovery with fallback to standard ServiceLoader  \n- **MetaDataLoaderRegistry**: Pluggable loader discovery system\n- **CoreMetaDataTypeProvider**: Centralized registration of built-in types (fields, validators, views)\n- **Complete Parser Migration**: MetaModelParser, SimpleModelParser, FileMetaDataParser updated\n- **API Compatibility**: Maintained existing method signatures where possible\n\n**Phase B: Attribute-Driven Service Architecture (Completed ‚úÖ)**  \n- **MetaDataAttributeProvider**: Service interface for discoverable attribute providers\n- **MetaDataEnhancer**: Service interface for context-aware metadata enhancement\n- **Shared Attribute Libraries**: DatabaseAttributeProvider, IOAttributeProvider, ValidationAttributeProvider\n- **Template-Based Enhancement**: Annotation-driven attribute requirements (@RequiresAttributeProviders)\n- **MetaDataEnhancementService**: Central registry for cross-cutting attribute concerns\n- **ServiceLoader Discovery**: Automatic provider discovery with priority-based loading\n\n**Phase C: Legacy System Elimination (Completed ‚úÖ)**\n- **Schema Generators Disabled**: XSD/JSON schema writers cleanly disabled pending ValidationChain implementation\n- **File Parser Updates**: FileMetaDataParser, JsonMetaDataParser, XMLMetaDataParser fully migrated to registry system\n- **Method Call Migration**: All TypesConfig method calls updated (`getTypesConfig()` ‚Üí `getTypeRegistry()`, `getOrCreateTypeConfig()` ‚Üí `validateTypeConfig()`)\n- **Registry Integration**: Added missing `hasType(String type)` method to MetaDataTypeRegistry for parser compatibility\n- **Full Project Compilation**: BUILD SUCCESS across all 10 modules - TypesConfig elimination complete\n- **Code Generation Separation**: All generator code moved to dedicated `codegen` module (v6.0.0)\n\n#### Key Benefits Achieved\n\n**Cross-Language Compatibility** ‚úÖ\n- **No Java Class Dependencies**: String-based type/subtype system works across languages\n- **Standard Service Patterns**: Interface-based discovery maps to C#/.NET DI and TypeScript modules\n- **Portable Architecture**: Service registry pattern universal across enterprise ecosystems\n\n**OSGI & Enterprise Integration** ‚úÖ\n- **Zero Global Static State**: All services discoverable and pluggable\n- **Context-Aware Registries**: Different environments can use different service implementations\n- **Dynamic Service Loading**: Runtime discovery and registration of new providers\n\n**Extensibility & Maintainability** ‚úÖ\n- **Child-Declares-Parent Pattern**: Unlimited extensibility without parent type constraints\n- **Separation of Concerns**: Type registration vs. attribute enhancement cleanly separated\n- **Template-Driven Development**: Templates declare their attribute requirements declaratively\n\n#### Usage Patterns\n\n**ObjectManagerDB Integration:**\n```java\nMetaDataEnhancementService enhancer = new MetaDataEnhancementService();\nfor (MetaObject metaObject : loader.getChildren(MetaObject.class)) {\n    enhancer.enhanceForService(metaObject, \"objectManagerDB\", \n        Map.of(\"dialect\", \"postgresql\", \"schema\", \"public\"));\n}\n// Now objects have dbTable, dbCol, dbNullable attributes\n```\n\n**Template-Based Code Generation:**\n```java\n@RequiresAttributeProviders({\"DatabaseAttributes\", \"ValidationAttributes\", \"IOAttributes\"})\n@ForServices({\"ormCodeGen\", \"jpaCodeGen\"})\npublic class JPAEntityTemplate {\n    // Template can assume all required attributes exist\n}\n```\n\n**Cross-Service Attribute Sharing:**\n- Same DatabaseAttributeProvider used by ObjectManagerDB AND ORM code generators\n- ValidationAttributeProvider shared by UI form generation AND server-side validation  \n- IOAttributeProvider used by JSON, XML, and CSV serialization systems\n\n#### Migration Impact\n- **100% API Compatibility**: Existing MetaData usage unchanged\n- **Enhanced Functionality**: New attribute enhancement capabilities\n- **Performance Improvements**: Eliminated global static state and improved caching\n- **Cross-Language Ready**: Architecture designed for C# and TypeScript implementations\n\n### Enhanced Error Reporting System Implementation (v5.2.0)\nA comprehensive enhancement of exception handling across all MetaObjects modules, providing rich contextual error information while maintaining 100% backward compatibility:\n\n#### Core Components (metadata module)\n\n**MetaDataPath Utility**\n- **Hierarchical Path Building**: Creates human-readable paths through metadata structures\n- **Multiple Format Support**: Hierarchical (`object:User(domain) ‚Üí field:email(string)`), simple (`User.email`), and type-only formats\n- **Thread-Safe**: Immutable path representations suitable for concurrent access\n- **Optional Integration**: Safe path access with `Optional<MetaDataPath>` APIs\n\n**Enhanced MetaDataException**\n- **Rich Context Information**: Automatic collection of metadata source, operation, thread, and timestamp\n- **Structured Context Maps**: Programmatic access to error context via `Map<String, Object>`\n- **Enhanced Message Building**: Automatic formatting with hierarchical paths and operational context\n- **Backward Compatible**: All existing constructors preserved, enhanced features are additive\n\n**ErrorFormatter Utility**\n- **Consistent Message Patterns**: Standardized error formatting across all exception types\n- **Context-Aware Formatting**: Automatic inclusion of available alternatives for \"not found\" errors\n- **Multi-Purpose Methods**: Validation, type mismatch, configuration, loading, and generic error formatting\n- **Value Formatting**: Intelligent handling of null, empty, and oversized values in error messages\n\n#### Enhanced Exception Classes Across All Modules\n\n**Metadata Module Exceptions**\n- `MetaDataNotFoundException` ‚Üí Enhanced with factory methods (`forField()`, `forValidator()`, `forView()`, etc.)\n- `MetaFieldNotFoundException` ‚Üí Contextual field lookup errors with available field suggestions\n- `MetaViewNotFoundException` ‚Üí Enhanced view lookup with context-aware error messages\n- `MetaObjectNotFoundException` ‚Üí Object lookup errors with instance-based factory methods\n- `MetaAttributeNotFoundException` ‚Üí Attribute access errors with hierarchical context\n- `InvalidValueException` ‚Üí Rich validation errors with expected/actual value comparisons\n\n**Object Manager Module (om)**\n- `ObjectNotFoundException` ‚Üí Enhanced with object context tracking and search-type categorization\n- `PersistenceException` ‚Üí Comprehensive persistence error reporting with operation-specific factory methods\n\n**Database Module (omdb)**\n- `TableDoesNotExistException` ‚Üí Database table errors with schema and connection context\n- `DirtyWriteException` ‚Üí Concurrency conflict errors with version/timestamp tracking\n\n**Web Module (web)**\n- `WebViewException` ‚Üí Web-specific error reporting with request context and user information\n\n**Code Generation Module (codegen)**\n- `GeneratorException` ‚Üí Code generation errors with template and file context\n- `GeneratorIOException` ‚Üí I/O errors during generation with writer and operation context\n\n#### Key Features Delivered\n\n**Factory Method Patterns**\n```java\n// Object not found with search context\nObjectNotFoundException.forId(userId, metaObject, \"userLookup\");\nObjectNotFoundException.forQuery(searchCriteria, metaObject, \"advancedSearch\");\n\n// Persistence errors with operation context  \nPersistenceException.forSave(entity, metaObject, sqlException);\nPersistenceException.forValidation(validationErrors, metaObject);\n\n// Concurrency conflicts with detailed context\nDirtyWriteException.forVersionConflict(entity, expectedVersion, actualVersion, metaObject);\nDirtyWriteException.forTimestampConflict(entity, expectedTime, actualTime, metaObject);\n\n// Code generation errors with file context\nGeneratorException.forTemplate(\"user.java.vm\", metaObject, templateException);\nGeneratorException.forSyntax(\"Missing semicolon\", \"User.java\", 42, metaObject);\n```\n\n**Rich Error Context Access**\n```java\ntry {\n    // MetaObjects operation\n} catch (MetaDataException e) {\n    // Access structured context\n    Optional<MetaDataPath> path = e.getMetaDataPath();\n    Optional<String> operation = e.getOperation();\n    Map<String, Object> context = e.getContext();\n    \n    // Timing and thread information\n    long timestamp = e.getTimestamp();\n    String threadName = e.getThreadName();\n    \n    // Specific context values\n    String errorType = (String) e.getContextValue(\"errorType\").orElse(\"unknown\");\n}\n```\n\n**Enhanced Error Messages**\n```\nBefore: \"Field not found\"\n\nAfter: \"Field 'invalidField' not found in User:\n  Available: age, email, name\n  Path: object:User(domain)\n\n--- Error Details ---\nPath: object:User(domain)\nOperation: lookup\nThread: main\nTimestamp: 2025-09-17T20:45:11.123Z\nContext:\n  itemType: field\n  itemName: invalidField\n  sourceClass: MetaObject\n  sourceType: object\n  sourceName: User\"\n```\n\n#### Implementation Benefits\n\n**Developer Experience**\n- **Instant Context**: No more digging through stack traces to understand error location\n- **Available Alternatives**: \"Not found\" errors list what options are available\n- **Operational Context**: Clear indication of what operation was being performed\n- **Hierarchical Navigation**: Easy navigation through metadata structure\n\n**Debugging & Troubleshooting**\n- **Thread Safety**: Thread name and timestamp for concurrent debugging\n- **Structured Data**: Programmatic access to error context for tooling integration\n- **Search Context**: Query parameters and search criteria preserved in error context\n- **Operation Tracing**: Clear audit trail of operations leading to errors\n\n**Backward Compatibility**\n- **Zero Breaking Changes**: All existing exception handling code continues to work unchanged\n- **Additive Enhancement**: New features available through new constructors and factory methods\n- **API Consistency**: Enhanced exceptions follow existing MetaObjects patterns\n- **Migration Path**: Gradual adoption of enhanced features without forced migration\n\n#### Project Impact\n- **15+ Enhanced Exception Classes**: Comprehensive coverage across all major modules\n- **25+ Factory Methods**: Convenient creation of context-rich exceptions\n- **100% Backward Compatibility**: Zero regressions in existing functionality\n- **Cross-Module Integration**: Shared utilities and consistent error patterns\n- **Build Success**: All enhanced modules compile and function correctly\n\nThe Enhanced Error Reporting System represents a major quality-of-life improvement for MetaObjects developers, providing rich contextual information for faster debugging and troubleshooting while maintaining the framework's commitment to backward compatibility.\n\n### Code Generation Module Simplification (v6.0.0+)\nA comprehensive simplification of the direct code generation package, removing unnecessary complexity and improving maintainability:\n\n#### CodeFragment System Removal\n- **Complete Elimination**: Removed CodeFragment class and all related infrastructure (~730 lines)\n- **Redundancy Resolution**: CodeFragment provided ${variable} template substitution that duplicated Mustache templating\n- **Affected Components**: Simplified BaseGenerationContext, GenerationContext, and JavaCodeWriter\n- **Backward Compatibility**: JavaCodeWriter (deprecated) now uses hardcoded strings instead of template fragments\n\n#### FileIndentor Package Relocation\n- **Proper Scoping**: Moved FileIndentor from `generator.util` to `generator.direct.util` package\n- **Usage Analysis**: Only used by direct generators, so proper package scoping achieved\n- **Import Updates**: Updated FileDirectWriter and JavaCodeWriter import statements\n- **Architectural Consistency**: Utility now properly scoped to its actual usage domain\n\n#### GenerationContext Simplification\n- **Complex Plugin System Removed**: Eliminated plugin lifecycle management and code fragment hooks\n- **Simplified to Property Holder**: Reduced from complex templating system to basic property and cache management\n- **Maven Plugin Compatibility**: Verified Generator.setArgs() and Generator.execute() remain unchanged\n- **100% Backward Compatibility**: External integrations continue to work without modification\n\n#### Architectural Analysis\n**XML/XSD Generator Placement Decision**\n- **Analyzed Moving to Core**: Considered relocating XML/XSD generators to core module since only core supports XML metadata\n- **Maintained v6.0.0 Separation**: Decided to keep all generators in codegen module to preserve architectural consistency\n- **Schema Generation Strategy**: Core can generate its own schemas via Maven plugin (already configured in pom.xml)\n- **ValidationChain Priority**: Focus remains on implementing ValidationChain-based XSD generation for disabled generators\n\n#### Implementation Benefits\n\n**Complexity Reduction**\n- **Eliminated Duplicate Systems**: Removed redundant template system (CodeFragment vs Mustache)\n- **Reduced Codebase Size**: ~730 lines of unnecessary complexity removed\n- **Cleaner Architecture**: Single responsibility principle better enforced\n\n**Maintainability Improvements**\n- **Proper Package Scoping**: Utilities located where they're actually used\n- **Simplified Inheritance**: GenerationContext hierarchy dramatically simplified\n- **Reduced Dependencies**: Fewer internal dependencies between generation components\n\n**Developer Experience**\n- **Clearer Intent**: Simplified codebase easier to understand and modify\n- **Faster Builds**: Reduced compilation complexity\n- **Better Testing**: Simplified components easier to unit test\n\n#### Project Impact\n- **Zero Breaking Changes**: 100% backward compatibility for Maven plugin and external integrations\n- **Architectural Consistency**: Maintains v6.0.0 separation between metadata and code generation\n- **Build Success**: All tests pass, full compilation success across all modules\n- **Future Readiness**: Cleaner foundation for Mustache-based template system implementation\n\nThe Code Generation Module Simplification represents a successful architectural cleanup that removed unnecessary complexity while maintaining complete backward compatibility and preparing the foundation for future template system enhancements.\n\n## Claude AI Documentation\n\n### Architectural Understanding\n- **CLAUDE_ARCHITECTURAL_SUMMARY.md**: Quick reference with key insights and anti-patterns\n- **CLAUDE_ARCHITECTURAL_ANALYSIS.md**: Comprehensive architectural analysis and assessment\n- **CLAUDE_ENHANCEMENTS.md**: Detailed enhancement plan with implementation roadmap\n- **CLAUDE_ARCHITECTURE.md**: Complete architecture guide with design patterns\n\n### Cross-Language Template System Architecture\n- **TEMPLATE_SYSTEM_ARCHITECTURE.md**: Complete architectural design for Mustache-based cross-language template system\n- **TEMPLATE_IMPLEMENTATION_GUIDE.md**: Step-by-step implementation guide for Java, C#, and TypeScript\n- **MUSTACHE_TEMPLATE_EXAMPLES.md**: Comprehensive template examples for JPA entities, ValueObjects, and React components\n- **CROSS_LANGUAGE_INTEGRATION.md**: Language-specific integration details and helper function implementations\n\n**üéØ Template System Design Decision**: Based on comprehensive industry research, **Mustache** was selected as the optimal template engine for MetaObjects cross-language requirements. Key findings: Mustache provides the best performance (8.8s vs 11.8s FreeMarker, 147s Handlebars), has mature implementations across Java (JMustache), C# (Stubble), and TypeScript (Mustache.js), and is used successfully by major frameworks like OpenAPI Generator (40+ languages) and GraphQL Code Generator. The logic-less template + helper function architecture enables shared template definitions while maintaining language-specific helper implementations for complex scenarios like JPA entities, ValueObject patterns, and React component generation.\n\n### ‚ö†Ô∏è Critical Understanding for Claude AI\n**MetaObjects is a load-once immutable metadata system** (like Java's Class/Field reflection API). DO NOT treat MetaData objects as mutable domain models. They are permanent, immutable metadata definitions that are thread-safe for reads after the loading phase.\n\n**v6.0.0 Service-Based Architecture**: The system now uses service discovery instead of static configuration. MetaDataTypeRegistry and MetaDataEnhancementService are the core services that replace TypesConfig. All type registration and attribute enhancement happens through pluggable service providers discovered via ServiceLoader.\n\n## Development Guidelines\n\n### Code Style\n- Use SLF4J for all logging\n- Follow existing naming conventions\n- Maintain backward compatibility\n- Add comprehensive JavaDoc for public APIs\n- Use StringBuilder instead of StringBuffer in non-thread-safe contexts\n\n### Testing\n- All modules compile successfully with Java 21\n- Comprehensive test coverage required\n- Use JUnit 4.13.2 for testing\n- Test files should follow existing patterns\n\n### React & Frontend Integration\n- **Use Existing MetaObjects Infrastructure**: Always leverage FileMetaDataLoader, JsonObjectWriter from IO package\n- **JSON Metadata**: Place in `/src/main/resources/metadata/` for proper classpath loading via FileMetaDataLoader\n- **Spring Integration**: Use proper controller module placement - demo controllers in demo module, web controllers in web module\n- **TypeScript Components**: Follow React MetaView patterns for metadata-driven UI component generation\n- **State Management**: Use Redux Toolkit with React Query for form state and data fetching\n\n### Maven Configuration\n- Uses parent POM for dependency management\n- OSGi bundle support enabled\n- Two distribution profiles: default (Draagon) and nexus (Maven Central)\n- Comprehensive plugin configuration for Java 21 compatibility\n\n## Module Dependencies\n\nBuild order (important for development):\n1. `metadata` - Base metadata models\n2. `codegen` - Code generation libraries (separated v6.0.0)\n3. `maven-plugin` - Code generation plugin (depends on codegen)\n4. `core` - Core functionality (depends on generated models)\n5. `om` - Object Manager\n6. `omdb` - Database Object Manager (extends om)\n7. `omnosql` - NoSQL Object Manager (extends om)\n8. `web` - Web utilities with React MetaView components\n9. `demo` - Demo applications with React integration\n\n### Module Integration Notes\n- **codegen** module: Contains all code generation functionality (moved from metadata v6.0.0)\n- **web** module: Contains React TypeScript components and Spring controllers for metadata APIs\n- **demo** module: Contains fishstore React demo, data controllers, and JSON metadata definitions\n- **Controllers**: Demo-specific controllers belong in demo module, generic web controllers in web module\n\n## Key Files for Development\n\n- `pom.xml` - Main project configuration\n- `README.md` - Basic project information\n- `RELEASE_NOTES.md` - Detailed version history and features\n- `LICENSE` - Apache 2.0 license\n- Core source: `core/src/main/java/com/draagon/meta/`\n- Metadata: `metadata/src/main/java/com/draagon/meta/`\n- Tests: `*/src/test/java/`\n\n### React MetaView Files\n- React components: `web/src/typescript/components/metaviews/`\n- React forms: `web/src/typescript/components/forms/`\n- TypeScript types: `web/src/typescript/types/metadata.ts`\n- Spring controllers: `web/src/main/java/com/draagon/meta/web/react/api/`\n- Demo controllers: `demo/src/main/java/com/draagon/meta/demo/fishstore/api/`\n- JSON metadata: `demo/src/main/resources/metadata/fishstore-metadata.json`\n- Package configuration: `web/package.json`, `web/tsconfig.json`\n\n## Upcoming Features (v4.4.0 Planned)\n\n- Native support for Abstract and Interface MetaData\n- TypedMetaDataLoader enhancements\n- Enhanced MetaData IO (YAML, HOCON, TOML support)\n- Integrated MetaObjects Editor\n- Plugin support for IO readers/writers\n- Namespace support in XML serialization\n\n## Development Notes\n\nThis project follows metadata-driven development principles where the structure and behavior of applications are controlled through metadata definitions rather than hard-coded implementations. The build system is sophisticated with OSGi bundle support and comprehensive Maven plugin configuration.\n\nFor Claude AI: When working with this codebase, pay attention to the metadata-driven architecture and maintain the established patterns for MetaObject implementations, validation, and serialization.\n\n## VERSION MANAGEMENT FOR CLAUDE AI\n\n**CRITICAL**: When user requests \"increment version\", \"update version\", or \"release new version\":\n\n1. **AUTOMATICALLY UPDATE ALL VERSION REFERENCES**:\n   - All pom.xml files (root + 8 modules)\n   - README.md \"Current Release:\" line\n   - RELEASE_NOTES.md (add new version section)\n   - CLAUDE.md version references\n\n2. **FOLLOW VERSION STRATEGY**:\n   - Release: Remove -SNAPSHOT from current version\n   - Next Dev: Increment version + add -SNAPSHOT\n   - Ensure ALL modules have identical versions\n\n3. **VERIFY BUILD**: Run `mvn clean compile` after changes\n\n4. **SEE**: CLAUDE_VERSION_MANAGEMENT.md for complete process\n\nThis ensures complete version synchronization across the entire project when versions are updated.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/architectural-analysis/original-comprehensive-guide.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "function",
        "md"
      ],
      "content_hash": "b777a97ace0c0d1b",
      "size_bytes": 28576,
      "created_at": "2026-01-02T20:42:12.429441"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_completed-2025-09-21-refactoring_README",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/completed-2025-09-21-refactoring/README.md",
      "content": "# Archive: Completed Architectural Refactoring (2025-09-21)\n\nThis directory contains Claude documentation files that became outdated after the successful completion of the major architectural refactoring on September 21, 2025.\n\n## üéâ **What Was Completed**\n\nThe complete architectural refactoring was successfully implemented, transforming MetaObjects from a monolithic structure to **14 focused modules** with:\n\n- ‚úÖ **All 5 phases completed** successfully\n- ‚úÖ **Framework independence** achieved  \n- ‚úÖ **Maven publishing ready** with clean dependencies\n- ‚úÖ **All tests passing** with comprehensive examples\n- ‚úÖ **Complete documentation** and migration guides\n\n## üìÅ **Archived Files**\n\n### **CONTINUE_CLEAN_IMPLEMENTATION.md**\n- **Purpose**: Continuation guide for clean implementation work\n- **Status**: **SUPERSEDED** - The clean implementation work was completed as part of the broader architectural refactoring\n- **Archived because**: Specific implementation tasks are now complete\n\n### **react-metaview-system.md**\n- **Purpose**: Documentation for React MetaView system implementation\n- **Status**: **SUPERSEDED** - React components are now part of the modular `web` and `web-spring` modules\n- **Archived because**: References v6.0.0+ architecture which was replaced by v5.2.0 modular architecture\n\n### **unified-registry-csharp-design.md**\n- **Purpose**: C# implementation design for unified registry\n- **Status**: **SUPERSEDED** - Registry architecture completed with Java implementation\n- **Archived because**: Planning document for work that has been completed\n\n### **unified-registry-typescript-design.md**\n- **Purpose**: TypeScript implementation design for unified registry  \n- **Status**: **SUPERSEDED** - Registry architecture completed with Java implementation\n- **Archived because**: Planning document for work that has been completed\n\n## üöÄ **Current Active Documentation**\n\nFor current MetaObjects documentation, see:\n\n- **`.claude/CLAUDE.md`** - Main architectural guide (updated for v5.2.0 modular architecture)\n- **`.claude/ARCHITECTURAL_REFACTORING_PLAN.md`** - Completed refactoring plan\n- **`.claude/ENHANCEMENTS.md`** - Updated enhancement roadmap (superseded by architectural refactoring)\n- **Root `README.md`** - User-facing documentation for the new modular architecture\n- **`MIGRATION.md`** - Migration guide for existing users\n\n---\n\n**These archived files represent successful completion of a major architectural transformation that exceeded the original scope and delivered a modern, modular, framework-independent MetaObjects system.**",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/completed-2025-09-21-refactoring/README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "readme"
      ],
      "content_hash": "a302fe0409241bfd",
      "size_bytes": 2584,
      "created_at": "2026-01-02T20:42:12.430018"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_completed-2025-09-21-refactoring_react-metaview-system",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/completed-2025-09-21-refactoring/react-metaview-system.md",
      "content": "# MetaObjects React MetaView Implementation - Production Ready\n\n## Overview\n\nThe React MetaView system is a comprehensive, production-ready implementation that extends the original JSP-based MetaView system to support modern React.js development. This implementation maintains full compatibility with the existing MetaObjects v6.0.0+ service-based architecture and demonstrates the cross-language portability of the MetaObjects metadata-driven approach.\n\n## What Was Delivered\n\n### 1. Complete React MetaView Architecture\n\n**Location**: `web/src/typescript/`\n\n- **Base Components** (`components/metaviews/base/`):\n  - `BaseMetaView.tsx` - Common functionality for all MetaViews\n  - Hooks for field logic and state management\n\n- **MetaView Components** (`components/metaviews/`):\n  - `TextView.tsx` - Text input fields with validation\n  - `TextAreaView.tsx` - Multi-line text areas\n  - `DateView.tsx` - Date picker with formatting\n  - `NumericView.tsx` - Number inputs (int, long, double)\n  - `SelectView.tsx` - Dropdown selections with options\n  - `MetaViewRenderer.tsx` - Main orchestrator component\n\n- **Form Management** (`components/forms/`):\n  - `MetaObjectForm.tsx` - Complete form renderer for MetaObjects\n  - Redux-based state management with Redux Toolkit\n  - Real-time validation and error handling\n\n### 2. Java Backend JSON API\n\n**Location**: `web/src/main/java/com/draagon/meta/web/react/`\n\n- **JSON Serialization**:\n  - `MetaDataJsonSerializer.java` - Converts MetaData to JSON\n  - Full support for MetaObjects, MetaFields, MetaViews, and MetaAttributes\n  - Type-safe serialization with proper data type mapping\n\n- **REST API**:\n  - `MetaDataApiController.java` - Servlet-based REST endpoints\n  - Endpoints for objects, fields, views, and packages\n  - CORS support for development\n\n- **API Endpoints**:\n  - `GET /api/metadata/objects` - List all MetaObjects\n  - `GET /api/metadata/objects/{name}` - Get specific MetaObject\n  - `GET /api/metadata/packages/{packageName}` - Get entire package\n  - `GET /api/metadata/fields/{objectName}/{fieldName}` - Get specific field\n  - `GET /api/metadata/views/{objectName}/{fieldName}/{viewName}` - Get specific view\n\n### 3. Demo Fishstore Application\n\n**Location**: `demo/src/main/webapp/react/`\n\n- **Complete React Application**:\n  - Modern React 18 with TypeScript\n  - Webpack build system with hot reload\n  - Responsive design with mobile support\n\n- **Pages Implemented**:\n  - `Dashboard.tsx` - Overview with architecture explanation\n  - `StoreManagement.tsx` - Full CRUD operations with MetaObject forms\n  - Navigation and layout components\n\n- **Metadata Definitions**:\n  - `fishstore-metadata.json` - Complete JSON metadata for demo objects\n  - Store, Tank, Breed, Fish objects with proper field definitions\n  - Validation rules and view configurations\n\n### 4. Type-Safe TypeScript Integration\n\n**Location**: `web/src/typescript/types/`\n\n- **Type Definitions**:\n  - `metadata.ts` - Complete TypeScript interfaces\n  - Enums for ViewMode and FieldType\n  - Props interfaces for all components\n\n- **Service Layer**:\n  - `MetaDataService.ts` - HTTP client for API calls\n  - React Query hooks for caching and state management\n  - Error handling and timeout support\n\n### 5. Testing and Build Infrastructure\n\n- **Unit Tests**:\n  - Jest configuration with TypeScript support\n  - Sample tests for React components\n  - Testing utilities and setup\n\n- **Build System**:\n  - NPM package configuration\n  - TypeScript compilation\n  - ESLint for code quality\n  - CSS processing and optimization\n\n## Key Architecture Decisions\n\n### 1. MVC Pattern Selection\n\n**Chosen**: Redux Toolkit + React Query\n\n**Why**: \n- Excellent TypeScript support\n- Easy to port to C# (similar to MediatR pattern)\n- Clear separation of concerns\n- Predictable state management\n\n### 2. Component Strategy\n\n**Approach**: Composition over inheritance\n\n- `BaseMetaView` provides common functionality\n- Specific view components handle their field types\n- `MetaViewRenderer` orchestrates component selection\n- Registry pattern allows custom view components\n\n### 3. API Design\n\n**REST with JSON**: Clean, cacheable, language-agnostic\n\n- Metadata served as JSON from Java backend\n- React Query handles caching and invalidation\n- CORS support for development workflow\n\n## Integration Points\n\n### 1. With Existing MetaObjects (v6.0.0+ Compatible)\n\n- Uses service-based `MetaDataTypeRegistry` for object discovery  \n- Leverages `MetaField` and `MetaView` definitions via JSON serialization\n- Compatible with enhanced error reporting system from v5.2.0\n- Maintains backward compatibility with JSP implementation\n- Integrates with `MetaDataEnhancementService` for context-aware metadata\n\n### 2. Build Integration\n\n- Maven builds Java components\n- NPM builds React components\n- Web module contains both systems\n- Demo module demonstrates integration\n\n### 3. Deployment Strategy\n\n- Java components deploy as WAR/JAR\n- React components can be:\n  - Served from Java webapp\n  - Published as NPM package\n  - Integrated into existing React apps\n\n## Benefits Delivered\n\n### 1. Developer Experience\n\n- **Rapid Form Development**: Forms generated automatically from metadata\n- **Type Safety**: Full TypeScript support prevents runtime errors\n- **Hot Reload**: Instant feedback during development\n- **Modern Tooling**: ESLint, Jest, Webpack integration\n\n### 2. User Experience\n\n- **Responsive Design**: Works on desktop and mobile\n- **Real-time Validation**: Immediate feedback on form errors\n- **Performance**: Client-side rendering with smart caching\n- **Accessibility**: Semantic HTML with ARIA support\n\n### 3. Enterprise Benefits\n\n- **Consistency**: All forms follow same patterns and styling\n- **Maintainability**: Metadata changes automatically update UI\n- **Portability**: Pattern easily adaptable to C# and TypeScript\n- **Scalability**: Component registry supports custom extensions\n\n## Technical Highlights\n\n### 1. Field Type Mapping\n\n```typescript\n// Automatic field type to component mapping\nswitch (field.type) {\n  case FieldType.STRING:\n    return field.length > 255 ? TextAreaView : TextView;\n  case FieldType.INT:\n  case FieldType.LONG:\n  case FieldType.DOUBLE:\n    return NumericView;\n  case FieldType.DATE:\n    return DateView;\n  case FieldType.BOOLEAN:\n    return SelectView; // with Yes/No options\n  default:\n    return TextView;\n}\n```\n\n### 2. Validation Integration\n\n```typescript\n// Client-side validation from metadata\nconst validators = field.validators.map(rule => ({\n  type: rule.type,\n  message: rule.message,\n  validate: createValidator(rule.type, rule.params)\n}));\n```\n\n### 3. Form State Management\n\n```typescript\n// Redux-based form state\nconst formState: ObjectFormState = {\n  objectName: \"Store\",\n  values: {\n    name: { value: \"Pet Store\", isValid: true, errors: [] },\n    maxTanks: { value: 25, isValid: true, errors: [] }\n  },\n  isValid: true,\n  isDirty: false\n};\n```\n\n## Demo Application Features\n\n### 1. Store Management\n\n- Create, read, update, delete stores\n- Form validation with real-time feedback\n- Responsive table with actions\n- Mode switching (READ/EDIT)\n\n### 2. Architecture Visualization\n\n- Component hierarchy diagram\n- Data flow explanation\n- Feature comparison with JSP implementation\n\n### 3. Interactive Examples\n\n- Text inputs with length validation\n- Numeric inputs with range constraints\n- Select dropdowns with custom options\n- Date pickers with format handling\n\n## File Structure Summary\n\n```\nweb/\n‚îú‚îÄ‚îÄ package.json                    # React dependencies\n‚îú‚îÄ‚îÄ tsconfig.json                   # TypeScript configuration\n‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îú‚îÄ‚îÄ typescript/                 # React components\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/             # MetaView components\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/               # API services\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ store/                  # Redux store\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types/                  # TypeScript definitions\n‚îÇ   ‚îî‚îÄ‚îÄ main/java/                  # Java backend\n‚îÇ       ‚îî‚îÄ‚îÄ com/draagon/meta/web/react/\n‚îú‚îÄ‚îÄ styles/main.css                 # Component styles\n‚îî‚îÄ‚îÄ README_REACT.md                 # Implementation guide\n\ndemo/\n‚îú‚îÄ‚îÄ src/main/webapp/\n‚îÇ   ‚îú‚îÄ‚îÄ react/                      # Demo React app\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/                    # App components\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ package.json            # Demo dependencies\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ webpack.config.js       # Build configuration\n‚îÇ   ‚îî‚îÄ‚îÄ static/metadata/            # JSON metadata\n‚îî‚îÄ‚îÄ README.md                       # Demo instructions\n```\n\n## Next Steps\n\n### 1. Immediate\n\n1. **Deploy Demo**: Set up servlet container and run demo\n2. **Test Integration**: Verify API connectivity with React app\n3. **Documentation**: Create developer setup guide\n\n### 2. Short Term\n\n1. **Additional Components**: File upload, rich text, data grids\n2. **Performance**: Virtual scrolling, lazy loading\n3. **Accessibility**: Screen reader testing, keyboard navigation\n\n### 3. Long Term\n\n1. **C# Port**: Adapt patterns for .NET applications\n2. **Enterprise Features**: Role-based security, audit logging\n3. **Developer Tools**: CLI generators, visual form builder\n\n## v6.0.0+ Architecture Alignment\n\n### Service-Based Integration\n- **Type Registry Compatibility**: React components work seamlessly with `MetaDataTypeRegistry` services\n- **Cross-Language Proof of Concept**: Demonstrates metadata portability to TypeScript/React\n- **Template System Ready**: Component architecture prepared for Mustache-based template generation\n- **Enhanced Error Handling**: Integrates with v5.2.0 rich error context system for better user feedback\n\n### Future Template Integration\nThe React components serve as validation for the upcoming template-based code generation:\n- **Component Patterns**: React MetaView patterns inform TypeScript template design\n- **Helper Function Architecture**: Component logic demonstrates helper function patterns for templates\n- **Cross-Language Validation**: Proves metadata system works effectively across Java/TypeScript boundary\n\n## Success Metrics\n\n‚úÖ **Complete Architecture**: Full MVC implementation with React + Redux  \n‚úÖ **v6.0.0+ Compatibility**: Seamless integration with service-based MetaObjects architecture  \n‚úÖ **Type Safety**: 100% TypeScript coverage with strong typing  \n‚úÖ **Build Success**: All Java and TypeScript code compiles cleanly  \n‚úÖ **Demo Implementation**: Working fishstore application  \n‚úÖ **Documentation**: Comprehensive guides and examples  \n‚úÖ **Cross-Language Validation**: Proves metadata portability for template system design  \n\n## Conclusion\n\nThis implementation provides a production-ready foundation for React-based MetaObject forms while serving as a critical validation of the v6.0.0+ cross-language architecture. The system demonstrates that MetaObjects metadata can effectively drive modern web development through service-based discovery and JSON serialization.\n\nThe React MetaView system successfully validates the architectural decisions made in v6.0.0+, proving that the service-based, string-typed metadata system works effectively across language boundaries and can support sophisticated UI generation patterns. This implementation serves as both a production-ready React solution and a proof-of-concept for the upcoming Mustache-based template system.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/completed-2025-09-21-refactoring/react-metaview-system.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "5c80c432694aa426",
      "size_bytes": 11335,
      "created_at": "2026-01-02T20:42:12.430077"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_completed-2025-09-21-refactoring_CONTINUE_CLEAN_IMPLEMENTATION",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/completed-2025-09-21-refactoring/CONTINUE_CLEAN_IMPLEMENTATION.md",
      "content": "# CONTINUE CLEAN IMPLEMENTATION (Started 2025-09-21)\n\n## üöÄ **CONTINUATION CONTEXT FOR NEW CLAUDE SESSIONS**\n\n**CRITICAL**: This project has undergone a major architectural breakthrough. **ALL backward compatibility has been eliminated** and replaced with a **pure inference-based system**. \n\n## ‚úÖ **WHAT WAS COMPLETED (2025-09-21)**\n\n### **1. Complete Backward Compatibility Elimination**\n- **Removed all hardcoded attributes**: No more `\"@isId\": true`, `\"@hasJpa\": true`, `\"@hasValidation\": true`\n- **Clean helper methods**: Zero fallback logic, pure inference-based approach\n- **Type-aware parsing**: MetaField determines correct Java types for attribute conversion\n\n### **2. Inference-Based Architecture Implemented**\n- **JPA Generation**: Inferred from database attributes (`dbTable`, `dbColumn`) and metadata presence\n- **ID Field Detection**: Smart pattern recognition (`\"id\"`, `\"userId\"`, `\"user_id\"`, etc.)\n- **Validation Logic**: Checks actual MetaValidator children, not hardcoded flags\n- **Key System**: Full support for PrimaryKey, ForeignKey, SecondaryKey metadata\n\n### **3. Type-Aware Parsing System**\n- **MetaField.getExpectedAttributeType()**: Determines correct Java types (Boolean, Integer, String)\n- **BaseMetaDataParser.parseInlineAttribute()**: Uses MetaField self-registration instead of guessing\n- **Working Evidence**: Build logs show `REFACTORED PARSE: attribute [required] - expectedType=[Boolean]`\n\n### **4. Enhanced Dependencies**\n- **Added metaobjects-core dependency** to codegen module for XML configuration access\n- **XML configuration updated** to support key children in all object subtypes\n- **Test success**: `Tests run: 1, Failures: 0, Errors: 0, Skipped: 0`\n\n## ‚ö†Ô∏è **KNOWN ISSUES TO CONTINUE FIXING**\n\n### **1. XML Configuration Loading Challenges**\n- Some PrimaryKey metadata parsing issues in test environment\n- Need to resolve configuration loading vs. test execution conflicts\n\n### **2. Attribute Type Warnings**\n- Log messages show: `Failed to create MetaAttribute [required] on parent record`\n- Type conflicts between expected boolean attributes and string validation\n- Need to clean up attribute definitions in XML configuration\n\n### **3. Test Metadata Modernization**\n- Some test files still need conversion to inference-based patterns\n- Should add proper PrimaryKey metadata instead of relying only on naming patterns\n\n### **4. Full Test Suite Verification**\n- Only tested individual helper functions - need to run complete test suite\n- May discover additional issues when testing full code generation pipeline\n\n## üéØ **IMMEDIATE NEXT STEPS**\n\n### **Priority 1: Fix Remaining Test Issues**\n1. Run full codegen test suite: `cd codegen && mvn test`\n2. Identify and fix any remaining test failures\n3. Clean up attribute type conflicts in logs\n\n### **Priority 2: XML Configuration Refinement**\n1. Ensure XML configuration properly loads in all test environments\n2. Fix any remaining PrimaryKey metadata parsing issues\n3. Verify all object subtypes support key children correctly\n\n### **Priority 3: Test Metadata Enhancement**\n1. Add proper PrimaryKey metadata to test files where appropriate\n2. Remove any remaining hardcoded attributes\n3. Test both inference patterns AND proper metadata approach\n\n### **Priority 4: Full Integration Testing**\n1. Test complete code generation pipeline\n2. Verify JPA annotation generation with inference\n3. Validate ID field detection across different scenarios\n\n## üîß **CRITICAL BUILD SEQUENCE**\n\nAlways follow this sequence when working on the project:\n\n```bash\n# 1. Install core module first (skip tests if needed)\ncd core && mvn clean install -Dmaven.test.skip=true\n\n# 2. Install metadata module (for test-jar dependency)\ncd metadata && mvn clean install\n\n# 3. Test codegen module (requires both dependencies)\ncd codegen && mvn test\n```\n\n## üìÅ **KEY FILES TO KNOW**\n\n### **Core Implementation Files**\n- `codegen/src/main/java/com/draagon/meta/generator/mustache/HelperRegistry.java` - All helper methods (isIdField, shouldGenerateJpa, etc.)\n- `metadata/src/main/java/com/draagon/meta/loader/parser/BaseMetaDataParser.java` - Type-aware parsing system\n- `metadata/src/main/java/com/draagon/meta/field/MetaField.java` - getExpectedAttributeType() method\n\n### **Configuration Files**\n- `core/src/main/resources/com/draagon/meta/loader/xml/metaobjects.types.xml` - XML type configuration with key support\n- `codegen/pom.xml` - Updated dependencies including metaobjects-core\n- `codegen/src/test/resources/mustache-test-metadata.json` - Test metadata (partially modernized)\n\n### **Documentation**\n- `.claude/CLAUDE.md` - Updated with complete clean implementation section (v6.1.0+)\n\n## üß† **ARCHITECTURAL PRINCIPLES TO MAINTAIN**\n\n### **DO:**\n‚úÖ **Extend inference patterns** - Add smarter detection logic\n‚úÖ **Use proper metadata** - PrimaryKey, ForeignKey, MetaValidator children\n‚úÖ **Follow type-aware parsing** - Let MetaField determine types\n‚úÖ **Test with real metadata** - Don't rely only on naming patterns\n\n### **DON'T:**\n‚ùå **Add backward compatibility** - Keep the clean implementation pure\n‚ùå **Use hardcoded attributes** - Always prefer inference over configuration\n‚ùå **Bypass constraint system** - Use constraint definitions\n‚ùå **Treat MetaData as mutable** - Maintain read-optimized architecture\n\n## üîç **DEBUGGING EVIDENCE**\n\nWhen working correctly, you should see build logs like:\n```\n[INFO] c.d.m.r.CoreMetaDataContextProvider - Loaded 4 attribute rules and 4 subtype-specific rules from context providers\n[WARN] c.d.m.l.parser.BaseMetaDataParser - REFACTORED PARSE: attribute [dbTable] on [object:pojo:com_example_model::User] - expectedType=[String], subType=[string]\n[WARN] c.d.m.l.parser.BaseMetaDataParser - REFACTORED PARSE: attribute [required] on [field:string:username] - expectedType=[Boolean], subType=[boolean]\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0\n```\n\n## üìû **COMMUNICATION WITH PROJECT OWNER**\n\nThe project owner specifically requested:\n> \"THINK HARD THROUGH THIS STEP BY STEP: can you remove all the backwards compatibility, as it is not needed since this is all new code\"\n\nThis directive has been **fully implemented**. The clean architecture is now in place and should be maintained and refined, not reverted.\n\n## üéØ **SUCCESS CRITERIA**\n\nThe next Claude session should aim to achieve:\n1. **Full test suite passing**: All codegen module tests working correctly\n2. **Clean logs**: No attribute type warning messages\n3. **Proper metadata usage**: Tests using PrimaryKey metadata where appropriate\n4. **Complete JPA generation**: Working end-to-end with inference\n5. **Documentation**: Any additional patterns documented in CLAUDE.md\n\n---\n\n**Ready to continue refining this clean, inference-based implementation!** üöÄ",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/completed-2025-09-21-refactoring/CONTINUE_CLEAN_IMPLEMENTATION.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "f21e52bf61a65163",
      "size_bytes": 6777,
      "created_at": "2026-01-02T20:42:12.430153"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_completed-2025-09-21-refactoring_unified-registry-csharp-design",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/completed-2025-09-21-refactoring/unified-registry-csharp-design.md",
      "content": "# Unified Registry Architecture - C# (.NET) Implementation Design\n\n## üéØ **C# ServiceRegistry Pattern Design**\n\n### **Core Architecture**\n\n```csharp\n// Universal service registry interface\npublic interface IServiceRegistry\n{\n    IEnumerable<T> GetServices<T>() where T : class;\n    void RegisterService<T>(T service) where T : class;\n    bool UnregisterService<T>(T service) where T : class;\n    bool IsAvailable { get; }\n    string Description { get; }\n}\n\n// .NET DI-based implementation\npublic class NetServiceRegistry : IServiceRegistry\n{\n    private readonly IServiceProvider _serviceProvider;\n    \n    public NetServiceRegistry(IServiceProvider serviceProvider)\n    {\n        _serviceProvider = serviceProvider;\n    }\n    \n    public IEnumerable<T> GetServices<T>() where T : class\n    {\n        return _serviceProvider.GetServices<T>();\n    }\n    \n    // Additional implementation...\n}\n```\n\n### **ConstraintProvider Pattern**\n\n```csharp\n// C# ConstraintProvider interface\npublic interface IConstraintProvider\n{\n    void RegisterConstraints(IConstraintRegistry registry);\n    string Description { get; }\n}\n\n// Implementation for field constraints\n[Service] // Custom attribute for service registration\npublic class CoreFieldConstraintProvider : IConstraintProvider\n{\n    public string Description => \"Core field validation constraints\";\n    \n    public void RegisterConstraints(IConstraintRegistry registry)\n    {\n        // String field constraints\n        registry.AddConstraint(new PlacementConstraint(\n            \"stringfield.maxlength.placement\",\n            parent => parent is StringField,\n            child => child is IntAttribute && child.Name == \"maxLength\"\n        ));\n        \n        // Integer field constraints\n        registry.AddConstraint(new ValidationConstraint(\n            \"intfield.range.validation\",\n            field => field is IntegerField,\n            (field, value) => ValidateIntegerRange(field, value)\n        ));\n    }\n    \n    private static bool ValidateIntegerRange(IMetaData field, object value)\n    {\n        // C# validation logic\n        if (field.GetAttribute(\"minValue\") is IntAttribute minAttr &&\n            field.GetAttribute(\"maxValue\") is IntAttribute maxAttr)\n        {\n            // Range validation\n            return true;\n        }\n        return true;\n    }\n}\n```\n\n### **MetaDataRegistry C# Implementation**\n\n```csharp\n// C# MetaDataRegistry using .NET DI\npublic class MetaDataRegistry : IMetaDataRegistry\n{\n    private readonly IServiceRegistry _serviceRegistry;\n    private readonly ConcurrentDictionary<MetaDataTypeId, TypeDefinition> _typeDefinitions;\n    private readonly ConcurrentDictionary<string, List<ChildRequirement>> _globalRequirements;\n    \n    public MetaDataRegistry(IServiceRegistry serviceRegistry)\n    {\n        _serviceRegistry = serviceRegistry;\n        _typeDefinitions = new ConcurrentDictionary<MetaDataTypeId, TypeDefinition>();\n        _globalRequirements = new ConcurrentDictionary<string, List<ChildRequirement>>();\n        LoadTypeProviders();\n    }\n    \n    private void LoadTypeProviders()\n    {\n        var providers = _serviceRegistry.GetServices<IMetaDataTypeProvider>();\n        foreach (var provider in providers)\n        {\n            provider.RegisterTypes(this);\n        }\n    }\n    \n    public T CreateInstance<T>(string type, string subType, string name) where T : class, IMetaData\n    {\n        var typeId = new MetaDataTypeId(type, subType);\n        if (_typeDefinitions.TryGetValue(typeId, out var definition))\n        {\n            return (T)Activator.CreateInstance(definition.ImplementationClass, type, subType, name);\n        }\n        throw new MetaDataException($\"No type registered for: {typeId.ToQualifiedName()}\");\n    }\n}\n```\n\n### **Dependency Injection Setup**\n\n```csharp\n// Startup.cs configuration\npublic void ConfigureServices(IServiceCollection services)\n{\n    // Register service registry\n    services.AddSingleton<IServiceRegistry, NetServiceRegistry>();\n    \n    // Auto-register all constraint providers\n    services.Scan(scan => scan\n        .FromAssembliesOf<CoreFieldConstraintProvider>()\n        .AddClasses(classes => classes.AssignableTo<IConstraintProvider>())\n        .AsImplementedInterfaces()\n        .WithSingletonLifetime());\n    \n    // Auto-register all type providers\n    services.Scan(scan => scan\n        .FromAssembliesOf<CoreMetaDataTypeProvider>()\n        .AddClasses(classes => classes.AssignableTo<IMetaDataTypeProvider>())\n        .AsImplementedInterfaces()\n        .WithSingletonLifetime());\n    \n    // Register registries\n    services.AddSingleton<IMetaDataRegistry, MetaDataRegistry>();\n    services.AddSingleton<IConstraintRegistry, ConstraintRegistry>();\n}\n\n// Initialization service\npublic class MetaDataInitializationService : IHostedService\n{\n    private readonly IMetaDataRegistry _metaDataRegistry;\n    private readonly IConstraintRegistry _constraintRegistry;\n    \n    public MetaDataInitializationService(\n        IMetaDataRegistry metaDataRegistry,\n        IConstraintRegistry constraintRegistry)\n    {\n        _metaDataRegistry = metaDataRegistry;\n        _constraintRegistry = constraintRegistry;\n    }\n    \n    public Task StartAsync(CancellationToken cancellationToken)\n    {\n        // Registries auto-initialize via DI\n        // Force any lazy initialization here if needed\n        return Task.CompletedTask;\n    }\n    \n    public Task StopAsync(CancellationToken cancellationToken)\n    {\n        // Cleanup if needed\n        return Task.CompletedTask;\n    }\n}\n```\n\n### **Type Registration with Static Constructors**\n\n```csharp\n// C# field implementation with static registration\npublic class StringField : MetaField<string>\n{\n    static StringField()\n    {\n        // Static constructor ensures registration happens once\n        RuntimeHelpers.RunClassConstructor(typeof(StringFieldTypeProvider).TypeHandle);\n    }\n    \n    public StringField(string type, string subType, string name) \n        : base(type, subType, name)\n    {\n    }\n}\n\n// Separate type provider for dependency injection\n[Service]\npublic class StringFieldTypeProvider : IMetaDataTypeProvider\n{\n    public void RegisterTypes(IMetaDataRegistry registry)\n    {\n        registry.Register(typeof(StringField), def => def\n            .Type(\"field\").SubType(\"string\")\n            .Description(\"String field with pattern validation\"));\n    }\n}\n```\n\n### **C# Advantages**\n\n1. **Native DI**: .NET Core dependency injection is first-class\n2. **Assembly Scanning**: Scrutor package provides excellent auto-registration\n3. **Static Constructors**: Reliable one-time initialization with `RuntimeHelpers`\n4. **Hosted Services**: Perfect lifecycle management for initialization\n5. **Strongly Typed**: Generics provide compile-time safety\n6. **Concurrent Collections**: Built-in thread-safe collections\n\n### **Plugin Architecture**\n\n```csharp\n// Plugin interface\npublic interface IMetaDataPlugin\n{\n    void Initialize(IServiceCollection services);\n    string Name { get; }\n    Version Version { get; }\n}\n\n// Plugin implementation\npublic class DatabasePlugin : IMetaDataPlugin\n{\n    public string Name => \"Database MetaData Plugin\";\n    public Version Version => new Version(1, 0, 0);\n    \n    public void Initialize(IServiceCollection services)\n    {\n        services.AddSingleton<IConstraintProvider, DatabaseConstraintProvider>();\n        services.AddSingleton<IMetaDataTypeProvider, DatabaseTypeProvider>();\n    }\n}\n\n// Plugin loading\npublic static void LoadPlugins(IServiceCollection services)\n{\n    var pluginAssemblies = Directory.GetFiles(\"plugins\", \"*.dll\")\n        .Select(Assembly.LoadFrom);\n        \n    foreach (var assembly in pluginAssemblies)\n    {\n        var pluginTypes = assembly.GetTypes()\n            .Where(t => typeof(IMetaDataPlugin).IsAssignableFrom(t) && !t.IsInterface);\n            \n        foreach (var pluginType in pluginTypes)\n        {\n            var plugin = (IMetaDataPlugin)Activator.CreateInstance(pluginType);\n            plugin.Initialize(services);\n        }\n    }\n}\n```\n\n### **Performance Considerations**\n\n- **Singleton Registries**: Registries registered as singletons for performance\n- **Concurrent Collections**: Thread-safe operations without locks\n- **Lazy Initialization**: Services initialized on first access\n- **Memory Management**: .NET GC handles cleanup automatically\n- **Caching**: Built-in DI container caching for service instances\n\n### **Testing Strategy**\n\n```csharp\n// Test setup\n[TestClass]\npublic class MetaDataRegistryTests\n{\n    private IServiceProvider _serviceProvider;\n    private IMetaDataRegistry _registry;\n    \n    [TestInitialize]\n    public void Setup()\n    {\n        var services = new ServiceCollection();\n        \n        // Register test-specific providers\n        services.AddSingleton<IServiceRegistry, TestServiceRegistry>();\n        services.AddSingleton<IMetaDataRegistry, MetaDataRegistry>();\n        services.AddSingleton<IConstraintProvider, TestConstraintProvider>();\n        \n        _serviceProvider = services.BuildServiceProvider();\n        _registry = _serviceProvider.GetRequiredService<IMetaDataRegistry>();\n    }\n    \n    [TestMethod]\n    public void Should_CreateStringField_When_TypeRegistered()\n    {\n        // Test implementation\n        var field = _registry.CreateInstance<StringField>(\"field\", \"string\", \"testField\");\n        Assert.IsNotNull(field);\n        Assert.AreEqual(\"testField\", field.Name);\n    }\n}\n```\n\nThis C# design leverages .NET's native dependency injection and provides a clean, strongly-typed approach to the unified registry pattern that will work seamlessly with the Java OSGi-compatible approach.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/completed-2025-09-21-refactoring/unified-registry-csharp-design.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "md"
      ],
      "content_hash": "ee1636951aa8947a",
      "size_bytes": 9641,
      "created_at": "2026-01-02T20:42:12.430222"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_completed-2025-09-21-refactoring_unified-registry-typescript-design",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/completed-2025-09-21-refactoring/unified-registry-typescript-design.md",
      "content": "# Unified Registry Architecture - TypeScript Implementation Design\n\n## üéØ **TypeScript ServiceRegistry Pattern Design**\n\n### **Core Challenge: Module System Constraints**\n\nTypeScript's ES module system executes code immediately on import, which fundamentally conflicts with deferred registration patterns. Our solution uses **Factory Registry Pattern** with controlled registration timing.\n\n### **Factory Registry Architecture**\n\n```typescript\n// Core interfaces\ninterface ServiceRegistry {\n    getServices<T>(serviceClass: Constructor<T>): T[];\n    registerService<T>(serviceClass: Constructor<T>, service: T): void;\n    unregisterService<T>(serviceClass: Constructor<T>, service: T): boolean;\n    readonly isAvailable: boolean;\n    readonly description: string;\n}\n\ninterface ConstraintProvider {\n    registerConstraints(registry: ConstraintRegistry): void;\n    readonly description: string;\n}\n\ninterface MetaDataTypeProvider {\n    registerTypes(registry: MetaDataRegistry): void;\n    readonly description: string;\n}\n\ntype Constructor<T = {}> = new (...args: any[]) => T;\n```\n\n### **Factory-Based Registration Pattern**\n\n```typescript\n// Instead of immediate registration, use factory pattern\nexport interface FieldRegistration {\n    readonly type: string;\n    readonly subType: string;\n    readonly factory: () => Constructor<MetaField>;\n    readonly constraints?: ConstraintDefinition[];\n}\n\n// StringField.ts - No immediate side effects\nexport class StringField extends MetaField<string> {\n    constructor(type: string, subType: string, name: string) {\n        super(type, subType, name);\n    }\n    \n    // Field-specific logic\n    validatePattern(pattern: string): boolean {\n        // Implementation\n        return true;\n    }\n}\n\n// Export registration factory (not immediate registration)\nexport const StringFieldRegistration: FieldRegistration = {\n    type: 'field',\n    subType: 'string',\n    factory: () => StringField,\n    constraints: [\n        {\n            type: 'placement',\n            id: 'stringfield.maxlength.placement',\n            description: 'String fields can have maxLength attribute',\n            parentMatch: (parent) => parent instanceof StringField,\n            childMatch: (child) => child instanceof IntAttribute && child.name === 'maxLength'\n        },\n        {\n            type: 'validation',\n            id: 'stringfield.pattern.validation',\n            description: 'String field pattern validation',\n            appliesTo: (field) => field instanceof StringField,\n            validate: (field, value) => {\n                const pattern = field.getAttribute('pattern');\n                return pattern ? new RegExp(pattern).test(String(value)) : true;\n            }\n        }\n    ]\n};\n```\n\n### **Provider-Based Module Orchestration**\n\n```typescript\n// CoreFieldProvider.ts - Orchestrates field registrations\nexport class CoreFieldConstraintProvider implements ConstraintProvider {\n    readonly description = 'Core field validation constraints';\n    \n    registerConstraints(registry: ConstraintRegistry): void {\n        // Import registrations (modules execute but don't auto-register)\n        const fieldRegistrations = [\n            StringFieldRegistration,\n            IntegerFieldRegistration,\n            BooleanFieldRegistration,\n            LongFieldRegistration,\n            DoubleFieldRegistration\n        ];\n        \n        // Register constraints from all field registrations\n        fieldRegistrations.forEach(registration => {\n            if (registration.constraints) {\n                registration.constraints.forEach(constraintDef => {\n                    const constraint = this.createConstraint(constraintDef);\n                    registry.addConstraint(constraint);\n                });\n            }\n        });\n    }\n    \n    private createConstraint(def: ConstraintDefinition): Constraint {\n        switch (def.type) {\n            case 'placement':\n                return new PlacementConstraint(def.id, def.description, def.parentMatch, def.childMatch);\n            case 'validation':\n                return new ValidationConstraint(def.id, def.description, def.appliesTo, def.validate);\n            default:\n                throw new Error(`Unknown constraint type: ${def.type}`);\n        }\n    }\n}\n\nexport class CoreFieldTypeProvider implements MetaDataTypeProvider {\n    readonly description = 'Core field type registrations';\n    \n    registerTypes(registry: MetaDataRegistry): void {\n        const fieldRegistrations = [\n            StringFieldRegistration,\n            IntegerFieldRegistration,\n            BooleanFieldRegistration,\n            LongFieldRegistration,\n            DoubleFieldRegistration\n        ];\n        \n        fieldRegistrations.forEach(registration => {\n            registry.register(\n                registration.type,\n                registration.subType,\n                registration.factory()\n            );\n        });\n    }\n}\n```\n\n### **Registry Implementation**\n\n```typescript\n// StandardServiceRegistry.ts - TypeScript ServiceLoader equivalent\nexport class StandardServiceRegistry implements ServiceRegistry {\n    private readonly services = new Map<Constructor<any>, Set<any>>();\n    private closed = false;\n    \n    get isAvailable(): boolean {\n        return !this.closed;\n    }\n    \n    get description(): string {\n        return 'TypeScript Standard Service Registry';\n    }\n    \n    getServices<T>(serviceClass: Constructor<T>): T[] {\n        if (this.closed) {\n            throw new Error('ServiceRegistry has been closed');\n        }\n        \n        const services = this.services.get(serviceClass);\n        return services ? Array.from(services) as T[] : [];\n    }\n    \n    registerService<T>(serviceClass: Constructor<T>, service: T): void {\n        if (this.closed) {\n            throw new Error('ServiceRegistry has been closed');\n        }\n        \n        if (!(service instanceof serviceClass)) {\n            throw new Error(`Service ${service.constructor.name} does not implement ${serviceClass.name}`);\n        }\n        \n        if (!this.services.has(serviceClass)) {\n            this.services.set(serviceClass, new Set());\n        }\n        this.services.get(serviceClass)!.add(service);\n    }\n    \n    unregisterService<T>(serviceClass: Constructor<T>, service: T): boolean {\n        if (this.closed) return false;\n        \n        const services = this.services.get(serviceClass);\n        if (services) {\n            const removed = services.delete(service);\n            if (services.size === 0) {\n                this.services.delete(serviceClass);\n            }\n            return removed;\n        }\n        return false;\n    }\n    \n    close(): void {\n        this.services.clear();\n        this.closed = true;\n    }\n}\n```\n\n### **MetaDataRegistry TypeScript Implementation**\n\n```typescript\n// MetaDataRegistry.ts\nexport class MetaDataRegistry {\n    private readonly serviceRegistry: ServiceRegistry;\n    private readonly typeDefinitions = new Map<string, Constructor<MetaData>>();\n    private readonly globalRequirements = new Map<string, ChildRequirement[]>();\n    private initialized = false;\n    \n    constructor(serviceRegistry?: ServiceRegistry) {\n        this.serviceRegistry = serviceRegistry || new StandardServiceRegistry();\n        this.loadTypeProviders();\n    }\n    \n    private loadTypeProviders(): void {\n        if (this.initialized) return;\n        \n        const providers = this.serviceRegistry.getServices(MetaDataTypeProvider);\n        providers.forEach(provider => {\n            provider.registerTypes(this);\n        });\n        \n        this.initialized = true;\n    }\n    \n    register(type: string, subType: string, implementationClass: Constructor<MetaData>): void {\n        const typeId = `${type}.${subType}`;\n        \n        const existing = this.typeDefinitions.get(typeId);\n        if (existing && existing !== implementationClass) {\n            throw new Error(\n                `Type already registered with different implementation: ${typeId}. ` +\n                `Existing: ${existing.name}, New: ${implementationClass.name}`\n            );\n        }\n        \n        this.typeDefinitions.set(typeId, implementationClass);\n    }\n    \n    createInstance<T extends MetaData>(type: string, subType: string, name: string): T {\n        const typeId = `${type}.${subType}`;\n        const implementationClass = this.typeDefinitions.get(typeId);\n        \n        if (!implementationClass) {\n            throw new Error(\n                `No type registered for: ${typeId}. ` +\n                `Available types: ${Array.from(this.typeDefinitions.keys()).join(', ')}`\n            );\n        }\n        \n        return new implementationClass(type, subType, name) as T;\n    }\n    \n    getRegisteredTypes(): string[] {\n        return Array.from(this.typeDefinitions.keys());\n    }\n}\n```\n\n### **Application Bootstrap Pattern**\n\n```typescript\n// ApplicationBootstrap.ts - Controlled initialization\nexport class MetaDataBootstrap {\n    private static instance: MetaDataBootstrap | null = null;\n    private readonly serviceRegistry: ServiceRegistry;\n    private readonly metaDataRegistry: MetaDataRegistry;\n    private readonly constraintRegistry: ConstraintRegistry;\n    \n    private constructor() {\n        this.serviceRegistry = new StandardServiceRegistry();\n        \n        // Register providers\n        this.registerProviders();\n        \n        // Initialize registries (triggers provider loading)\n        this.metaDataRegistry = new MetaDataRegistry(this.serviceRegistry);\n        this.constraintRegistry = new ConstraintRegistry(this.serviceRegistry);\n    }\n    \n    static getInstance(): MetaDataBootstrap {\n        if (!MetaDataBootstrap.instance) {\n            MetaDataBootstrap.instance = new MetaDataBootstrap();\n        }\n        return MetaDataBootstrap.instance;\n    }\n    \n    private registerProviders(): void {\n        // Type providers\n        this.serviceRegistry.registerService(MetaDataTypeProvider, new CoreFieldTypeProvider());\n        this.serviceRegistry.registerService(MetaDataTypeProvider, new CoreObjectTypeProvider());\n        this.serviceRegistry.registerService(MetaDataTypeProvider, new CoreAttributeTypeProvider());\n        \n        // Constraint providers\n        this.serviceRegistry.registerService(ConstraintProvider, new CoreFieldConstraintProvider());\n        this.serviceRegistry.registerService(ConstraintProvider, new CoreObjectConstraintProvider());\n        this.serviceRegistry.registerService(ConstraintProvider, new CoreValidatorConstraintProvider());\n    }\n    \n    getMetaDataRegistry(): MetaDataRegistry {\n        return this.metaDataRegistry;\n    }\n    \n    getConstraintRegistry(): ConstraintRegistry {\n        return this.constraintRegistry;\n    }\n    \n    // Force initialization (call from main application)\n    static initialize(): void {\n        MetaDataBootstrap.getInstance();\n    }\n}\n\n// main.ts - Application entry point\nimport { MetaDataBootstrap } from './MetaDataBootstrap';\n\n// Initialize MetaData system\nMetaDataBootstrap.initialize();\n\n// Now registries are available\nconst metaDataRegistry = MetaDataBootstrap.getInstance().getMetaDataRegistry();\nconst constraintRegistry = MetaDataBootstrap.getInstance().getConstraintRegistry();\n\n// Use registries...\nconst userField = metaDataRegistry.createInstance<StringField>('field', 'string', 'username');\n```\n\n### **Plugin Architecture**\n\n```typescript\n// Plugin interface\nexport interface MetaDataPlugin {\n    readonly name: string;\n    readonly version: string;\n    initialize(serviceRegistry: ServiceRegistry): void;\n}\n\n// Plugin implementation\nexport class DatabasePlugin implements MetaDataPlugin {\n    readonly name = 'Database MetaData Plugin';\n    readonly version = '1.0.0';\n    \n    initialize(serviceRegistry: ServiceRegistry): void {\n        serviceRegistry.registerService(ConstraintProvider, new DatabaseConstraintProvider());\n        serviceRegistry.registerService(MetaDataTypeProvider, new DatabaseTypeProvider());\n    }\n}\n\n// Plugin loading\nexport class PluginManager {\n    static async loadPlugins(serviceRegistry: ServiceRegistry, pluginPaths: string[]): Promise<void> {\n        for (const pluginPath of pluginPaths) {\n            try {\n                const pluginModule = await import(pluginPath);\n                const plugin: MetaDataPlugin = new pluginModule.default();\n                plugin.initialize(serviceRegistry);\n            } catch (error) {\n                console.error(`Failed to load plugin ${pluginPath}:`, error);\n            }\n        }\n    }\n}\n```\n\n### **Testing Strategy**\n\n```typescript\n// Test utilities\nexport class TestServiceRegistry extends StandardServiceRegistry {\n    constructor() {\n        super();\n    }\n    \n    reset(): void {\n        this.services.clear();\n    }\n}\n\n// Test setup\ndescribe('MetaDataRegistry', () => {\n    let serviceRegistry: TestServiceRegistry;\n    let metaDataRegistry: MetaDataRegistry;\n    let constraintRegistry: ConstraintRegistry;\n    \n    beforeEach(() => {\n        serviceRegistry = new TestServiceRegistry();\n        \n        // Register test providers\n        serviceRegistry.registerService(MetaDataTypeProvider, new CoreFieldTypeProvider());\n        serviceRegistry.registerService(ConstraintProvider, new CoreFieldConstraintProvider());\n        \n        metaDataRegistry = new MetaDataRegistry(serviceRegistry);\n        constraintRegistry = new ConstraintRegistry(serviceRegistry);\n    });\n    \n    afterEach(() => {\n        serviceRegistry.reset();\n    });\n    \n    it('should create StringField when type is registered', () => {\n        const field = metaDataRegistry.createInstance<StringField>('field', 'string', 'testField');\n        expect(field).toBeInstanceOf(StringField);\n        expect(field.name).toBe('testField');\n    });\n    \n    it('should throw error for unregistered type', () => {\n        expect(() => {\n            metaDataRegistry.createInstance('field', 'unknown', 'test');\n        }).toThrow('No type registered for: field.unknown');\n    });\n});\n```\n\n### **Webpack/Build Configuration**\n\n```typescript\n// webpack.config.js - Ensure modules aren't tree-shaken\nmodule.exports = {\n    // ...\n    optimization: {\n        usedExports: false, // Disable tree-shaking for provider modules\n        sideEffects: false  // Mark provider modules as having side effects\n    },\n    // ...\n};\n\n// package.json\n{\n    \"sideEffects\": [\n        \"./src/providers/**/*.ts\",\n        \"./src/types/**/*.ts\"\n    ]\n}\n```\n\n### **TypeScript Advantages**\n\n1. **Type Safety**: Compile-time checking for service interfaces\n2. **Module System**: Clean import/export for provider orchestration\n3. **Factory Pattern**: Deferred instantiation without immediate side effects\n4. **Testing**: Easy mocking and service replacement\n5. **Build Integration**: Webpack/Rollup can optimize provider loading\n\n### **Key Differences from Java**\n\n- **No Static Blocks**: Use factory registrations instead\n- **Controlled Timing**: Bootstrap class manages initialization order\n- **Module Orchestration**: Providers import and register factories\n- **No ServiceLoader**: Manual service registration in bootstrap\n- **Type Safety**: TypeScript generics provide compile-time safety\n\nThis TypeScript design provides a clean, type-safe approach that works with ES modules while maintaining the same architectural patterns as the Java OSGi-compatible approach.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/completed-2025-09-21-refactoring/unified-registry-typescript-design.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "def",
        "md"
      ],
      "content_hash": "7e9191323d3336a8",
      "size_bytes": 15369,
      "created_at": "2026-01-02T20:42:12.430298"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_implementation-summaries_GENERATOR_ENHANCEMENT_SUMMARY",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/implementation-summaries/GENERATOR_ENHANCEMENT_SUMMARY.md",
      "content": "# MetaObjects Code Generation - Architecture Evolution Summary\n\n## Overview\n\nThe MetaObjects code generation system has undergone significant architectural evolution, progressing from enhanced direct generators through hybrid systems to the current v6.0.0+ simplified architecture focused on template-based cross-language generation.\n\n## Historical Evolution\n\n### Phase 1: Enhanced Direct Generation (v5.x) - DEPRECATED\nEnhanced the original direct Java code generation with plugin support and configurable fragments.\n\n**Key Components (Now Removed):**\n- **GenerationContext**: Complex context management with plugin lifecycle\n- **CodeFragment**: Template variable substitution (duplicated Mustache functionality)\n- **GenerationPlugin**: Pluggable generation behavior\n- **EnhancedJavaCodeWriter/Generator**: Plugin-orchestrated generation\n\n### Phase 2: Hybrid Script Integration (v5.x) - DEPRECATED  \nAdded Groovy scripting capability to direct generators for runtime customization.\n\n**Key Components (Now Removed):**\n- **ScriptEngine Architecture**: Groovy script compilation and execution\n- **HybridJavaCodeGenerator/Writer**: Script execution hooks\n- **Script Integration Points**: Multiple trigger points for customization\n\n### Phase 3: Service-Based Architecture (v6.0.0)\n**CURRENT ARCHITECTURE** - Complete replacement of TypesConfig with service-based type registration and attribute enhancement.\n\n**Key Components (Active):**\n- **MetaDataTypeRegistry**: Service-based type registry replacing global TypesConfig\n- **MetaDataEnhancementService**: Context-aware metadata enhancement\n- **ServiceLoader Discovery**: Automatic provider discovery with priority loading\n- **Cross-Language Compatibility**: String-based type system works across Java/C#/TypeScript\n\n## Current v6.0.0+ Architecture\n\n### Code Generation Module Simplification\nThe current generation system has been dramatically simplified by removing unnecessary complexity:\n\n**Removed Components (~730 lines eliminated):**\n- **CodeFragment System**: Redundant template substitution (Mustache handles this better)\n- **Complex Plugin Lifecycle**: Overly complex generation context management  \n- **Hybrid Script Integration**: Groovy dependencies and script execution hooks\n\n**Simplified Components:**\n- **GenerationContext**: Reduced to basic property and cache management\n- **JavaCodeWriter**: Simplified to use hardcoded strings instead of fragments\n- **FileIndentor**: Properly scoped to `generator.direct.util` package\n\n## üöÄ **Current Benefits (v6.0.0+)**\n\n### **Simplified Architecture**\n- **Complexity Reduction**: Eliminated ~730 lines of unnecessary code\n- **Single Responsibility**: Clear separation between type registration and code generation\n- **Reduced Dependencies**: No more Groovy dependencies for basic generation\n\n### **Cross-Language Readiness**\n- **Template-Based Future**: Prepared for Mustache-based template system\n- **String-Based Types**: Type system works across Java, C#, and TypeScript\n- **Service Discovery**: Universal service patterns across enterprise ecosystems\n\n### **Maintainability**\n- **Simplified Codebase**: Easier to understand and modify\n- **Proper Package Scoping**: Utilities located where they're actually used\n- **Zero Breaking Changes**: 100% backward compatibility maintained\n\n## üìÅ **Current File Structure (v6.0.0+)**\n\n### Codegen Module (Separated v6.0.0)\n```\ncodegen/src/main/java/com/draagon/meta/generator/\n‚îú‚îÄ‚îÄ direct/\n‚îÇ   ‚îú‚îÄ‚îÄ GenerationContext.java           # Simplified property holder\n‚îÇ   ‚îú‚îÄ‚îÄ util/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FileIndentor.java           # Properly scoped utility\n‚îÇ   ‚îî‚îÄ‚îÄ javacode/simple/\n‚îÇ       ‚îú‚îÄ‚îÄ JavaCodeWriter.java         # Simplified (deprecated)  \n‚îÇ       ‚îî‚îÄ‚îÄ SimpleJavaCodeGenerator.java # Core direct generator\n‚îî‚îÄ‚îÄ Generator.java                       # Base generator interface\n```\n\n### Service-Based Architecture (metadata module)\n```\nmetadata/src/main/java/com/draagon/meta/\n‚îú‚îÄ‚îÄ MetaDataTypeRegistry.java           # Service-based type registry\n‚îú‚îÄ‚îÄ MetaDataEnhancementService.java     # Context-aware enhancement\n‚îú‚îÄ‚îÄ attr/\n‚îÇ   ‚îú‚îÄ‚îÄ DatabaseAttributeProvider.java  # Database attribute provider\n‚îÇ   ‚îú‚îÄ‚îÄ IOAttributeProvider.java        # I/O attribute provider  \n‚îÇ   ‚îî‚îÄ‚îÄ ValidationAttributeProvider.java # Validation attribute provider\n‚îî‚îÄ‚îÄ loader/\n    ‚îú‚îÄ‚îÄ MetaDataLoaderRegistry.java     # Pluggable loader discovery\n    ‚îî‚îÄ‚îÄ CoreMetaDataTypeProvider.java   # Built-in type registration\n```\n\n### Template System Documentation (docs/)\n```\ndocs/\n‚îú‚îÄ‚îÄ TEMPLATE_SYSTEM_ARCHITECTURE.md     # Mustache-based design\n‚îú‚îÄ‚îÄ TEMPLATE_IMPLEMENTATION_GUIDE.md    # Java/C#/TypeScript implementation\n‚îú‚îÄ‚îÄ MUSTACHE_TEMPLATE_EXAMPLES.md       # Template examples  \n‚îî‚îÄ‚îÄ CROSS_LANGUAGE_INTEGRATION.md       # Language-specific integration\n```\n\n## üéØ **Current Usage (v6.0.0+)**\n\n### **Service-Based Type Registration**\n```java\n// Automatic service discovery\nMetaDataTypeRegistry registry = MetaDataTypeRegistry.getInstance();\nMetaDataEnhancementService enhancer = new MetaDataEnhancementService();\n\n// Context-aware attribute enhancement\nfor (MetaObject metaObject : loader.getChildren(MetaObject.class)) {\n    enhancer.enhanceForService(metaObject, \"objectManagerDB\", \n        Map.of(\"dialect\", \"postgresql\", \"schema\", \"public\"));\n}\n```\n\n### **Direct Code Generation (Simplified)**\n```java\n// Maven plugin integration (unchanged)\nSimpleJavaCodeGenerator generator = new SimpleJavaCodeGenerator();\ngenerator.setArgs(Map.of(\n    \"packageName\", \"com.example.generated\",\n    \"outputDirectory\", \"target/generated-sources\"\n));\ngenerator.execute(metaDataLoader);\n```\n\n### **Future Template-Based Generation**\n```java\n// Planned Mustache-based system\nMustacheGenerator generator = new MustacheGenerator()\n    .withTemplate(\"jpa-entity.mustache\")\n    .withHelpers(new JPAEntityHelpers())\n    .withOutput(\"src/main/java/{{packagePath}}/{{className}}.java\");\ngenerator.execute(metaObject);\n```\n\n## üé® **Future Roadmap**\n\n### Template System Implementation\n- **Mustache Engine Integration**: Logic-less templates with helper functions\n- **Cross-Language Templates**: Shared templates for Java, C#, TypeScript\n- **Helper Function Libraries**: JPA, ValueObject, React component helpers\n- **Template Registry**: Discoverable template system via ServiceLoader\n\n### Code Generation Enhancements\n- **Multi-Language Support**: C# Entity Framework, TypeScript interfaces\n- **Modern Framework Support**: Spring Boot, ASP.NET Core, React/Angular\n- **Custom Generator Registration**: Plugin-based generator discovery\n- **Visual Template Editor**: Web-based template design and testing\n\n## üèóÔ∏è **Current Architecture Principles (v6.0.0+)**\n\n1. **Simplicity First**: Remove unnecessary complexity, focus on essential functionality\n2. **Service-Based Discovery**: Use ServiceLoader for extensibility without tight coupling\n3. **Cross-Language Compatibility**: Design for Java/C#/TypeScript implementations\n4. **Template-Based Future**: Prepare for Mustache-based generation system\n5. **Zero Breaking Changes**: Maintain 100% backward compatibility\n\n## ‚úÖ **Current Status**\n\nThe v6.0.0+ simplification is complete and production-ready:\n\n- **‚úÖ Code Generation Module Separated**: All generators moved to dedicated codegen module\n- **‚úÖ Complexity Eliminated**: ~730 lines of unnecessary code removed\n- **‚úÖ Service Architecture**: Type registration and enhancement through pluggable services\n- **‚úÖ Build Success**: All modules compile and test successfully\n- **‚úÖ Backward Compatibility**: Existing Maven plugin integration unchanged\n- **‚úÖ Template Readiness**: Foundation prepared for Mustache-based template system\n\nThe simplified architecture provides a clean foundation for the upcoming template-based code generation system while maintaining all existing functionality and performance characteristics.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/implementation-summaries/GENERATOR_ENHANCEMENT_SUMMARY.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "config",
        "md"
      ],
      "content_hash": "f7bd73bce3581a8f",
      "size_bytes": 7960,
      "created_at": "2026-01-02T20:42:12.430377"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_implementation-summaries_ENHANCEMENTS_SUMMARY",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/implementation-summaries/ENHANCEMENTS_SUMMARY.md",
      "content": "# ObjectManager Enhancements Summary v5.1.0+\n\nThis document summarizes all the enhancements and improvements made to the ObjectManager implementations, which are compatible with the v6.0.0+ service-based MetaObjects architecture.\n\n## Overview\n\nThe ObjectManager framework has been comprehensively modernized with Java 21 patterns, enhanced performance optimizations, event-driven architecture, and improved resource management. These enhancements are fully compatible with the v6.0.0+ service-based type registry and metadata enhancement systems.\n\n## Major Enhancements\n\n### 1. Modern Java Patterns (Java 21)\n\n#### Pattern Matching & Switch Expressions\n- **Before**: Traditional switch statements with multiple if-else blocks\n- **After**: Modern switch expressions with pattern matching\n```java\n// Old style\nswitch (f.getType()) {\n    case MetaField.BOOLEAN: {\n        boolean bv = rs.getBoolean(j);\n        if (rs.wasNull()) {\n            f.setBoolean(o, null);\n        } else {\n            f.setBoolean(o, new Boolean(bv));\n        }\n    }\n    break;\n}\n\n// New style\nswitch (f.getType()) {\n    case MetaField.BOOLEAN -> {\n        boolean bv = rs.getBoolean(j);\n        f.setBoolean(o, rs.wasNull() ? null : bv);\n    }\n}\n```\n\n#### Stream API Integration\n- **Before**: Manual iteration with raw types\n- **After**: Stream-based operations with type safety\n```java\n// Old style\nfor (Iterator i = mc.getMetaFields().iterator(); i.hasNext(); ) {\n    MetaField f = (MetaField) i.next();\n    if (isPrimaryKey(f)) fields.add(f);\n}\n\n// New style\nreturn mc.getMetaFields().stream()\n    .filter(this::isPrimaryKey)\n    .collect(Collectors.toList());\n```\n\n#### Enhanced Resource Management\n- **Before**: Manual connection management\n- **After**: AutoCloseable support with try-with-resources\n```java\n// New usage\ntry (ObjectConnection connection = objectManager.getConnection()) {\n    objectManager.createObject(connection, obj);\n    connection.commit();\n} // Connection automatically closed\n```\n\n### 2. Performance Optimizations\n\n#### Intelligent Caching\n- **ConcurrentHashMap-based caching** for thread-safe operations\n- **Cache keys by MetaObject name** to avoid memory leaks\n- **Automatic cache population** using computeIfAbsent()\n\n```java\nprivate final Map<String, List<MetaField>> autoFieldsCache = new ConcurrentHashMap<>();\nprivate final Map<String, Collection<MetaField>> primaryKeysCache = new ConcurrentHashMap<>();\n\nprotected List<MetaField> getAutoFields(MetaObject mc) {\n    String cacheKey = mc.getName() + \":autoFields\";\n    return autoFieldsCache.computeIfAbsent(cacheKey, key -> \n        mc.getMetaFields().stream()\n            .filter(f -> f.hasAttribute(AUTO))\n            .collect(Collectors.toList())\n    );\n}\n```\n\n#### Bulk Operations Support\n- **Grouped bulk operations** by MetaObject type\n- **Database-specific optimizations** through BulkOperationSupport interface\n- **Batch processing** with configurable batch sizes\n- **Transaction management** for bulk operations\n\n```java\npublic void createObjects(ObjectConnection c, Collection<?> objs) throws MetaDataException {\n    // Group objects by MetaObject type for better performance\n    var objectsByType = objs.stream()\n        .collect(Collectors.groupingBy(obj -> getMetaObjectFor(obj)));\n    \n    for (var entry : objectsByType.entrySet()) {\n        MetaObject mc = entry.getKey();\n        List<Object> objectsOfType = entry.getValue();\n        \n        // Process bulk creation with events\n        createObjectsBulk(c, mc, objectsOfType);\n    }\n}\n```\n\n### 3. Event-Driven Architecture\n\n#### Comprehensive Event System\n- **PersistenceEventListener interface** with default methods\n- **Before/After events** for all CRUD operations\n- **Error handling events** for failed operations\n- **Thread-safe event firing** with synchronized listeners\n\n```java\npublic interface PersistenceEventListener {\n    default void onBeforeCreate(MetaObject mc, Object obj) {}\n    default void onAfterCreate(MetaObject mc, Object obj) {}\n    default void onBeforeUpdate(MetaObject mc, Object obj, Collection<MetaField> modifiedFields) {}\n    default void onAfterUpdate(MetaObject mc, Object obj, Collection<MetaField> modifiedFields) {}\n    default void onBeforeDelete(MetaObject mc, Object obj) {}\n    default void onAfterDelete(MetaObject mc, Object obj) {}\n    default void onError(MetaObject mc, Object obj, String operation, Exception error) {}\n}\n```\n\n#### Event Integration\n- **Automatic event firing** in prePersistence/postPersistence\n- **Error event propagation** in async operations\n- **Bulk operation events** for each object in collections\n\n### 4. Asynchronous Operations\n\n#### CompletableFuture Integration\n- **Async CRUD operations** returning CompletableFuture\n- **Configurable executor** for async operations\n- **Proper error handling** with event integration\n\n```java\npublic CompletableFuture<Collection<?>> getObjectsAsync(MetaObject mc, QueryOptions options) {\n    return CompletableFuture.supplyAsync(() -> {\n        try (var connection = getConnection()) {\n            return getObjects(connection, mc, options);\n        } catch (Exception e) {\n            throw new RuntimeException(\"Error retrieving objects asynchronously\", e);\n        }\n    }, asyncExecutor);\n}\n```\n\n#### Async Bulk Operations\n- **Batch async creates/updates/deletes**\n- **Parallel processing** where appropriate\n- **Transaction safety** in async contexts\n\n### 5. Query Builder Pattern\n\n#### Fluent API Design\n- **Method chaining** for readable queries\n- **Type-safe operations** with compile-time validation\n- **Flexible query construction** with AND/OR operations\n\n```java\nCollection<?> results = objectManager.query(\"User\")\n    .where(\"status\", \"ACTIVE\")\n    .and(\"createdDate\", System.currentTimeMillis())\n    .or(new Expression(\"priority\", \"HIGH\"))\n    .orderByDesc(\"createdDate\")\n    .limit(100)\n    .execute();\n```\n\n#### Enhanced Query Methods\n- **first()** and **firstAsync()** for single object retrieval\n- **count()** and **countAsync()** for result counting\n- **Pagination support** with limit() methods\n- **Distinct results** support\n\n### 6. Enhanced Resource Management\n\n#### Connection Management\n- **AutoCloseable compliance** for ObjectConnection\n- **Connection validation** before use\n- **Improved error handling** in connection management\n- **Transaction helper methods** (beginTransaction, endTransaction)\n\n```java\npublic interface ObjectConnection extends AutoCloseable {\n    @Override\n    void close() throws MetaDataException;\n    \n    default void beginTransaction() throws PersistenceException {\n        setAutoCommit(false);\n    }\n    \n    default void endTransaction(boolean commit) throws PersistenceException {\n        if (commit) {\n            commit();\n        } else {\n            rollback();\n        }\n    }\n}\n```\n\n### 7. Database-Specific Enhancements\n\n#### ObjectManagerDB Improvements\n- **Enhanced error handling** with specific exception types\n- **Connection validation** before operations\n- **Improved SQL type handling** with modern patterns\n- **Batch operation fallbacks** when bulk operations aren't supported\n\n#### BulkOperationSupport Interface\n- **Database-specific bulk operations** for maximum performance\n- **Configurable batch sizes** based on database capabilities\n- **Intelligent fallback** to individual operations when needed\n\n```java\npublic interface BulkOperationSupport {\n    int createBulk(Connection conn, MetaObject mc, ObjectMappingDB mapping, Collection<Object> objects) throws SQLException;\n    int updateBulk(Connection conn, MetaObject mc, ObjectMappingDB mapping, Collection<Object> objects) throws SQLException;\n    int deleteBulk(Connection conn, MetaObject mc, ObjectMappingDB mapping, Collection<Object> objects) throws SQLException;\n    \n    default int getOptimalBatchSize() { return 1000; }\n    default boolean shouldUseBulkOperations(int collectionSize) { return collectionSize >= 10; }\n}\n```\n\n## Benefits\n\n### Performance Improvements\n- **10-50x faster bulk operations** depending on database and operation type\n- **Reduced memory usage** through intelligent caching\n- **Better connection utilization** with proper resource management\n- **Parallel processing** through async operations\n\n### Code Quality\n- **Type safety** with generics and modern Java patterns\n- **Reduced boilerplate** through streams and method references\n- **Better error handling** with specific exceptions\n- **Improved maintainability** through event-driven architecture\n\n### Developer Experience\n- **Fluent API** with query builder pattern\n- **Try-with-resources** support for automatic cleanup\n- **Comprehensive events** for monitoring and debugging\n- **Async support** for non-blocking operations\n\n### Enterprise Features\n- **Transaction management** with helper methods\n- **Event-driven monitoring** for operational insights\n- **Bulk operation optimization** for large datasets\n- **Resource pooling** compatibility\n\n## Migration Path\n\nThe enhancements are **backward compatible** - existing code continues to work while new features are opt-in:\n\n1. **Existing synchronous operations** continue to work unchanged\n2. **New async operations** are additional methods\n3. **Query builder** is an alternative to existing query methods\n4. **Events** are optional - no listeners means no overhead\n5. **Bulk operations** automatically optimize existing batch methods\n\n## Usage Examples\n\nSee `EnhancedObjectManagerExample.java` for comprehensive usage examples including:\n- Resource management patterns\n- Event listener setup\n- Async operation chaining\n- Transaction management\n- Query builder usage\n- Bulk operation patterns\n\n## v6.0.0+ Architecture Compatibility\n\n### Service-Based Integration\nThe ObjectManager enhancements work seamlessly with the v6.0.0+ service-based architecture:\n\n- **MetaDataTypeRegistry Integration**: ObjectManager uses service-based type discovery for metadata\n- **Enhanced Error Reporting**: Leverages v5.2.0 rich error context system for detailed persistence errors\n- **MetaDataEnhancementService**: Compatible with context-aware metadata enhancement for database attributes\n- **Cross-Language Preparedness**: Service abstractions support future C# and TypeScript ObjectManager implementations\n\n### Database Attribute Enhancement\n```java\n// ObjectManagerDB integration with service-based enhancement\nMetaDataEnhancementService enhancer = new MetaDataEnhancementService();\nfor (MetaObject metaObject : loader.getChildren(MetaObject.class)) {\n    enhancer.enhanceForService(metaObject, \"objectManagerDB\", \n        Map.of(\"dialect\", \"postgresql\", \"schema\", \"public\"));\n    // Now objects have dbTable, dbCol, dbNullable attributes\n}\n```\n\n## Future Compatibility\n\nThe enhancements position the framework for:\n- **NoSQL implementations** (MongoDB, Cassandra) using the same abstractions\n- **Microservice architectures** with async patterns\n- **Cloud-native deployments** with proper resource management\n- **Template-Based Persistence**: Integration with upcoming Mustache template system for ORM code generation\n- **Cross-Language Object Managers**: C# Entity Framework and TypeScript implementations\n- **Modern Java features** as they become available",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/implementation-summaries/ENHANCEMENTS_SUMMARY.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "719c729fe93db86c",
      "size_bytes": 11155,
      "created_at": "2026-01-02T20:42:12.430438"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_template-system_MUSTACHE_TEMPLATE_EXAMPLES",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/template-system/MUSTACHE_TEMPLATE_EXAMPLES.md",
      "content": "# MetaObjects Mustache Template Examples\n\n## Overview\n\nThis document provides comprehensive examples of Mustache templates for MetaObjects cross-language code generation. These templates demonstrate the power and flexibility of the Mustache + Helper Functions approach for generating sophisticated code across Java, C#, and TypeScript.\n\n## Template Structure and Conventions\n\n### Template Definition Format\n\nAll templates follow this YAML structure:\n\n```yaml\nname: \"Template Name\"\nversion: \"1.0.0\"\ndescription: \"Template description\"\ntargetLanguage: \"java|csharp|typescript\"\noutputFileExtension: \"java|cs|ts\"\npackagePath: true|false\nrequirements:\n  attributes: [\"attr1\", \"attr2\"]  # Required MetaObject attributes\n  helpers: [\"helper1\", \"helper2\"] # Required helper functions\ntemplate: |\n  # Mustache template content here\npartials:\n  partial_name: |\n    # Reusable template partial\n```\n\n## Java Template Examples\n\n### 1. JPA Entity Template\n\n**File: `templates/java/jpa-entity.mustache.yaml`**\n\n```yaml\nname: \"JPA Entity Template\"\nversion: \"1.0.0\"\ndescription: \"Generate JPA entities with database annotations\"\ntargetLanguage: \"java\"\noutputFileExtension: \"java\"\npackagePath: true\nrequirements:\n  attributes: [\"dbTable\"]\n  helpers: [\"capitalize\", \"javaType\", \"dbColumnName\", \"isIdField\", \"isNullable\"]\ntemplate: |\n  package {{packageName}};\n  \n  import javax.persistence.*;\n  import java.io.Serializable;\n  {{#imports}}\n  import {{.}};\n  {{/imports}}\n  \n  /**\n   * JPA Entity for {{className}}\n   * Generated from MetaObject: {{fullName}}\n   */\n  @Entity\n  @Table(name = \"{{dbTableName}}\")\n  public class {{className}} implements Serializable {\n      \n      private static final long serialVersionUID = 1L;\n      \n      {{#fields}}\n      {{#isIdField}}\n      @Id\n      @GeneratedValue(strategy = GenerationType.IDENTITY)\n      {{/isIdField}}\n      @Column(name = \"{{dbColumnName}}\"{{^isNullable}}, nullable = false{{/isNullable}})\n      private {{javaType}} {{name}};\n      \n      {{/fields}}\n      \n      // Default constructor\n      public {{className}}() {}\n      \n      // Full constructor\n      public {{className}}({{#fields}}{{^isIdField}}{{javaType}} {{name}}{{^isLast}}, {{/isLast}}{{/isIdField}}{{/fields}}) {\n          {{#fields}}\n          {{^isIdField}}\n          this.{{name}} = {{name}};\n          {{/isIdField}}\n          {{/fields}}\n      }\n      \n      {{#fields}}\n      // Getter for {{name}}\n      public {{javaType}} {{#capitalize}}get{{name}}{{/capitalize}}() {\n          return this.{{name}};\n      }\n      \n      // Setter for {{name}}\n      public void {{#capitalize}}set{{name}}{{/capitalize}}({{javaType}} {{name}}) {\n          this.{{name}} = {{name}};\n      }\n      \n      {{/fields}}\n      \n      // Static factory method using MetaObjects\n      public static {{className}} newInstance() {\n          com.metaobjects.object.MetaObject metaObject = \n              com.metaobjects.loader.MetaDataRegistry.findMetaObject(\"{{fullName}}\");\n          if (metaObject == null) {\n              throw new IllegalStateException(\"MetaObject not found: {{fullName}}\");\n          }\n          return new {{className}}();\n      }\n      \n      @Override\n      public boolean equals(Object obj) {\n          if (this == obj) return true;\n          if (obj == null || getClass() != obj.getClass()) return false;\n          {{className}} that = ({{className}}) obj;\n          {{#fields}}\n          {{#isIdField}}\n          return Objects.equals({{name}}, that.{{name}});\n          {{/isIdField}}\n          {{/fields}}\n      }\n      \n      @Override\n      public int hashCode() {\n          {{#fields}}\n          {{#isIdField}}\n          return Objects.hash({{name}});\n          {{/isIdField}}\n          {{/fields}}\n      }\n      \n      @Override\n      public String toString() {\n          return \"{{className}}{\" +\n              {{#fields}}\n              \"{{name}}=\" + {{name}} +\n              {{^isLast}}\", \" +{{/isLast}}\n              {{/fields}}\n              '}';\n      }\n  }\n```\n\n### 2. ValueObject Extension Template\n\n**File: `templates/java/valueobject-extension.mustache.yaml`**\n\n```yaml\nname: \"ValueObject Extension Template\"\nversion: \"1.0.0\"\ndescription: \"Generate classes extending ValueObject with dynamic property access\"\ntargetLanguage: \"java\"\noutputFileExtension: \"java\"\npackagePath: true\nrequirements:\n  helpers: [\"capitalize\", \"javaType\"]\ntemplate: |\n  package {{packageName}};\n  \n  import com.metaobjects.object.value.ValueObject;\n  import com.metaobjects.object.MetaObject;\n  import com.metaobjects.loader.MetaDataRegistry;\n  {{#imports}}\n  import {{.}};\n  {{/imports}}\n  \n  /**\n   * ValueObject extension for {{className}}\n   * Uses dynamic property access via MetaObjects\n   */\n  public class {{className}} extends ValueObject {\n      \n      private static final String META_OBJECT_NAME = \"{{fullName}}\";\n      \n      // Static factory method that finds MetaObject by full name\n      public static {{className}} newInstance() {\n          MetaObject metaObject = MetaDataRegistry.findMetaObject(META_OBJECT_NAME);\n          if (metaObject == null) {\n              throw new IllegalStateException(\"MetaObject not found: \" + META_OBJECT_NAME);\n          }\n          return new {{className}}(metaObject);\n      }\n      \n      // Constructor with MetaObject\n      public {{className}}(MetaObject metaObject) {\n          super(metaObject);\n      }\n      \n      // Type-safe property accessors using dynamic get/set methods\n      {{#fields}}\n      \n      /**\n       * Get {{name}} property\n       * @return {{javaType}} value or null if not set\n       */\n      public {{javaType}} {{#capitalize}}get{{name}}{{/capitalize}}() {\n          return ({{javaType}}) getAttrValue(\"{{name}}\");\n      }\n      \n      /**\n       * Set {{name}} property\n       * @param {{name}} the {{javaType}} value to set\n       */\n      public void {{#capitalize}}set{{name}}{{/capitalize}}({{javaType}} {{name}}) {\n          setAttrValue(\"{{name}}\", {{name}});\n      }\n      \n      /**\n       * Check if {{name}} property is set\n       * @return true if {{name}} has a value\n       */\n      public boolean {{#capitalize}}has{{name}}{{/capitalize}}() {\n          return hasAttr(\"{{name}}\");\n      }\n      \n      {{/fields}}\n      \n      // Fluent builder methods for method chaining\n      {{#fields}}\n      \n      /**\n       * Fluent setter for {{name}}\n       * @param {{name}} the {{javaType}} value to set\n       * @return this instance for method chaining\n       */\n      public {{className}} {{name}}({{javaType}} {{name}}) {\n          {{#capitalize}}set{{name}}{{/capitalize}}({{name}});\n          return this;\n      }\n      \n      {{/fields}}\n      \n      /**\n       * Create a copy of this object with all current values\n       * @return new {{className}} instance with copied values\n       */\n      public {{className}} copy() {\n          {{className}} copy = newInstance();\n          {{#fields}}\n          if ({{#capitalize}}has{{name}}{{/capitalize}}()) {\n              copy.{{#capitalize}}set{{name}}{{/capitalize}}({{#capitalize}}get{{name}}{{/capitalize}}());\n          }\n          {{/fields}}\n          return copy;\n      }\n      \n      /**\n       * Get the MetaObject name for this class\n       * @return the fully qualified MetaObject name\n       */\n      public static String getMetaObjectName() {\n          return META_OBJECT_NAME;\n      }\n  }\n```\n\n### 3. Spring Repository Template\n\n**File: `templates/java/spring-repository.mustache.yaml`**\n\n```yaml\nname: \"Spring Repository Template\"\nversion: \"1.0.0\"\ndescription: \"Generate Spring Data JPA repositories\"\ntargetLanguage: \"java\"\noutputFileExtension: \"java\"\npackagePath: true\nrequirements:\n  helpers: [\"capitalize\", \"javaType\", \"getIdType\", \"getIdFieldName\"]\ntemplate: |\n  package {{packageName}}.repository;\n  \n  import org.springframework.data.jpa.repository.JpaRepository;\n  import org.springframework.data.jpa.repository.Query;\n  import org.springframework.data.repository.query.Param;\n  import org.springframework.stereotype.Repository;\n  import {{packageName}}.{{className}};\n  import java.util.List;\n  import java.util.Optional;\n  \n  /**\n   * Spring Data JPA repository for {{className}}\n   * Generated from MetaObject: {{fullName}}\n   */\n  @Repository\n  public interface {{className}}Repository extends JpaRepository<{{className}}, {{idType}}> {\n      \n      {{#fields}}\n      {{^isIdField}}\n      {{#isSearchable}}\n      /**\n       * Find {{className}} entities by {{name}}\n       * @param {{name}} the {{javaType}} to search for\n       * @return list of matching entities\n       */\n      List<{{className}}> findBy{{#capitalize}}{{name}}{{/capitalize}}({{javaType}} {{name}});\n      \n      /**\n       * Find first {{className}} entity by {{name}}\n       * @param {{name}} the {{javaType}} to search for\n       * @return optional containing the first match\n       */\n      Optional<{{className}}> findFirstBy{{#capitalize}}{{name}}{{/capitalize}}({{javaType}} {{name}});\n      \n      {{/isSearchable}}\n      {{/isIdField}}\n      {{/fields}}\n      \n      /**\n       * Custom query to find active {{className}} entities\n       * @return list of active entities\n       */\n      @Query(\"SELECT e FROM {{className}} e WHERE e.active = true\")\n      List<{{className}}> findAllActive();\n      \n      /**\n       * Count entities by status\n       * @param status the status to count\n       * @return count of entities with the given status\n       */\n      long countByStatus(String status);\n  }\n```\n\n## C# Template Examples\n\n### 4. Entity Framework Entity Template\n\n**File: `templates/csharp/ef-entity.mustache.yaml`**\n\n```yaml\nname: \"Entity Framework Entity Template\"\nversion: \"1.0.0\"\ndescription: \"Generate Entity Framework entities with database annotations\"\ntargetLanguage: \"csharp\"\noutputFileExtension: \"cs\"\npackagePath: true\nrequirements:\n  attributes: [\"dbTable\"]\n  helpers: [\"capitalize\", \"csharpType\", \"dbColumnName\", \"isIdField\", \"isNullable\"]\ntemplate: |\n  using System;\n  using System.ComponentModel.DataAnnotations;\n  using System.ComponentModel.DataAnnotations.Schema;\n  {{#imports}}\n  using {{.}};\n  {{/imports}}\n  \n  namespace {{namespaceName}}\n  {\n      /// <summary>\n      /// Entity Framework entity for {{className}}\n      /// Generated from MetaObject: {{fullName}}\n      /// </summary>\n      [Table(\"{{dbTableName}}\")]\n      public class {{className}}\n      {\n          {{#fields}}\n          {{#isIdField}}\n          /// <summary>\n          /// Primary key for {{className}}\n          /// </summary>\n          [Key]\n          [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n          {{/isIdField}}\n          [Column(\"{{dbColumnName}}\")]\n          {{^isNullable}}\n          [Required]\n          {{/isNullable}}\n          public {{csharpType}} {{#capitalize}}{{name}}{{/capitalize}} { get; set; }\n          \n          {{/fields}}\n          \n          /// <summary>\n          /// Default constructor\n          /// </summary>\n          public {{className}}()\n          {\n          }\n          \n          /// <summary>\n          /// Constructor with required parameters\n          /// </summary>\n          public {{className}}({{#fields}}{{^isIdField}}{{csharpType}} {{name}}{{^isLast}}, {{/isLast}}{{/isIdField}}{{/fields}})\n          {\n              {{#fields}}\n              {{^isIdField}}\n              this.{{#capitalize}}{{name}}{{/capitalize}} = {{name}};\n              {{/isIdField}}\n              {{/fields}}\n          }\n          \n          /// <summary>\n          /// Static factory method using MetaObjects\n          /// </summary>\n          /// <returns>New instance of {{className}}</returns>\n          public static {{className}} NewInstance()\n          {\n              var metaObject = MetaDataRegistry.FindMetaObject(\"{{fullName}}\");\n              if (metaObject == null)\n              {\n                  throw new InvalidOperationException(\"MetaObject not found: {{fullName}}\");\n              }\n              return new {{className}}();\n          }\n          \n          /// <summary>\n          /// Equality comparison based on ID\n          /// </summary>\n          public override bool Equals(object obj)\n          {\n              if (obj is {{className}} other)\n              {\n                  {{#fields}}\n                  {{#isIdField}}\n                  return {{#capitalize}}{{name}}{{/capitalize}} == other.{{#capitalize}}{{name}}{{/capitalize}};\n                  {{/isIdField}}\n                  {{/fields}}\n              }\n              return false;\n          }\n          \n          /// <summary>\n          /// Hash code based on ID\n          /// </summary>\n          public override int GetHashCode()\n          {\n              {{#fields}}\n              {{#isIdField}}\n              return {{#capitalize}}{{name}}{{/capitalize}}.GetHashCode();\n              {{/isIdField}}\n              {{/fields}}\n          }\n          \n          /// <summary>\n          /// String representation of the entity\n          /// </summary>\n          public override string ToString()\n          {\n              return $\"{{className}} {{ {{#fields}}{{#capitalize}}{{name}}{{/capitalize}} = {{{#capitalize}}{{name}}{{/capitalize}}}{{^isLast}}, {{/isLast}}{{/fields}} }}\";\n          }\n      }\n  }\n```\n\n## TypeScript Template Examples\n\n### 5. TypeScript Interface Template\n\n**File: `templates/typescript/interface.mustache.yaml`**\n\n```yaml\nname: \"TypeScript Interface Template\"\nversion: \"1.0.0\"\ndescription: \"Generate TypeScript interfaces with optional properties\"\ntargetLanguage: \"typescript\"\noutputFileExtension: \"ts\"\npackagePath: false\nrequirements:\n  helpers: [\"camelCase\", \"typeScriptType\", \"isOptional\"]\ntemplate: |\n  {{#imports}}\n  import { {{.}} } from './{{.}}';\n  {{/imports}}\n  \n  /**\n   * TypeScript interface for {{className}}\n   * Generated from MetaObject: {{fullName}}\n   */\n  export interface {{className}} {\n    {{#fields}}\n    /**\n     * {{description}}\n     */\n    {{#camelCase}}{{name}}{{/camelCase}}{{#isOptional}}?{{/isOptional}}: {{typeScriptType}};\n    {{/fields}}\n  }\n  \n  /**\n   * Factory function to create {{className}} instances\n   */\n  export function create{{className}}(data: Partial<{{className}}>): {{className}} {\n    return {\n      {{#fields}}\n      {{#camelCase}}{{name}}{{/camelCase}}: data.{{#camelCase}}{{name}}{{/camelCase}}{{#hasDefaultValue}} ?? {{defaultValue}}{{/hasDefaultValue}},\n      {{/fields}}\n    } as {{className}};\n  }\n  \n  /**\n   * Type guard to check if object is {{className}}\n   */\n  export function is{{className}}(obj: any): obj is {{className}} {\n    return obj !== null && \n           typeof obj === 'object' &&\n           {{#fields}}\n           {{^isOptional}}\n           '{{#camelCase}}{{name}}{{/camelCase}}' in obj &&\n           {{/isOptional}}\n           {{/fields}}\n           true;\n  }\n  \n  /**\n   * Validation function for {{className}}\n   */\n  export function validate{{className}}(obj: {{className}}): string[] {\n    const errors: string[] = [];\n    \n    {{#fields}}\n    {{^isOptional}}\n    if (obj.{{#camelCase}}{{name}}{{/camelCase}} === undefined || obj.{{#camelCase}}{{name}}{{/camelCase}} === null) {\n      errors.push('{{#camelCase}}{{name}}{{/camelCase}} is required');\n    }\n    {{/isOptional}}\n    {{#hasValidation}}\n    if (obj.{{#camelCase}}{{name}}{{/camelCase}} !== undefined && !{{validationFunction}}(obj.{{#camelCase}}{{name}}{{/camelCase}})) {\n      errors.push('{{#camelCase}}{{name}}{{/camelCase}} {{validationMessage}}');\n    }\n    {{/hasValidation}}\n    {{/fields}}\n    \n    return errors;\n  }\n  \n  /**\n   * MetaObject name constant\n   */\n  export const META_OBJECT_NAME = '{{fullName}}';\n```\n\n### 6. React Component Template\n\n**File: `templates/typescript/react-component.mustache.yaml`**\n\n```yaml\nname: \"React Component Template\"\nversion: \"1.0.0\"\ndescription: \"Generate React components for MetaObject forms\"\ntargetLanguage: \"typescript\"\noutputFileExtension: \"tsx\"\npackagePath: false\nrequirements:\n  helpers: [\"camelCase\", \"capitalize\", \"typeScriptType\", \"getInputType\"]\ntemplate: |\n  import React, { useState, useEffect } from 'react';\n  import { {{className}} } from '../types/{{className}}';\n  {{#imports}}\n  import { {{.}} } from '{{path}}';\n  {{/imports}}\n  \n  interface {{className}}FormProps {\n    initialData?: Partial<{{className}}>;\n    onSubmit: (data: {{className}}) => void;\n    onCancel?: () => void;\n    readonly?: boolean;\n  }\n  \n  /**\n   * React form component for {{className}}\n   * Generated from MetaObject: {{fullName}}\n   */\n  export const {{className}}Form: React.FC<{{className}}FormProps> = ({\n    initialData = {},\n    onSubmit,\n    onCancel,\n    readonly = false\n  }) => {\n    const [formData, setFormData] = useState<Partial<{{className}}>>(initialData);\n    const [errors, setErrors] = useState<Record<string, string>>({});\n    \n    const handleSubmit = (e: React.FormEvent) => {\n      e.preventDefault();\n      \n      // Validate form data\n      const validationErrors = validate{{className}}(formData as {{className}});\n      if (validationErrors.length > 0) {\n        const errorMap: Record<string, string> = {};\n        validationErrors.forEach(error => {\n          const fieldName = error.split(' ')[0];\n          errorMap[fieldName] = error;\n        });\n        setErrors(errorMap);\n        return;\n      }\n      \n      setErrors({});\n      onSubmit(formData as {{className}});\n    };\n    \n    const handleInputChange = (field: keyof {{className}}, value: any) => {\n      if (readonly) return;\n      \n      setFormData(prev => ({\n        ...prev,\n        [field]: value\n      }));\n      \n      // Clear error for this field\n      if (errors[field as string]) {\n        setErrors(prev => ({\n          ...prev,\n          [field as string]: ''\n        }));\n      }\n    };\n    \n    return (\n      <form onSubmit={handleSubmit} className=\"{{#camelCase}}{{name}}{{/camelCase}}-form\">\n        <h2>{{className}} Form</h2>\n        \n        {{#fields}}\n        {{^isIdField}}\n        <div className=\"form-group\">\n          <label htmlFor=\"{{#camelCase}}{{name}}{{/camelCase}}\">\n            {{#capitalize}}{{name}}{{/capitalize}}\n            {{^isOptional}}<span className=\"required\">*</span>{{/isOptional}}\n          </label>\n          \n          {{#isSelectField}}\n          <select\n            id=\"{{#camelCase}}{{name}}{{/camelCase}}\"\n            value={formData.{{#camelCase}}{{name}}{{/camelCase}} || ''}\n            onChange={(e) => handleInputChange('{{#camelCase}}{{name}}{{/camelCase}}', e.target.value)}\n            disabled={readonly}\n            className={errors.{{#camelCase}}{{name}}{{/camelCase}} ? 'error' : ''}\n          >\n            <option value=\"\">Select {{#capitalize}}{{name}}{{/capitalize}}</option>\n            {{#selectOptions}}\n            <option value=\"{{value}}\">{{label}}</option>\n            {{/selectOptions}}\n          </select>\n          {{/isSelectField}}\n          \n          {{#isTextArea}}\n          <textarea\n            id=\"{{#camelCase}}{{name}}{{/camelCase}}\"\n            value={formData.{{#camelCase}}{{name}}{{/camelCase}} || ''}\n            onChange={(e) => handleInputChange('{{#camelCase}}{{name}}{{/camelCase}}', e.target.value)}\n            disabled={readonly}\n            className={errors.{{#camelCase}}{{name}}{{/camelCase}} ? 'error' : ''}\n            rows={4}\n          />\n          {{/isTextArea}}\n          \n          {{^isSelectField}}\n          {{^isTextArea}}\n          <input\n            type=\"{{getInputType}}\"\n            id=\"{{#camelCase}}{{name}}{{/camelCase}}\"\n            value={formData.{{#camelCase}}{{name}}{{/camelCase}} || ''}\n            onChange={(e) => handleInputChange('{{#camelCase}}{{name}}{{/camelCase}}', e.target.value)}\n            disabled={readonly}\n            className={errors.{{#camelCase}}{{name}}{{/camelCase}} ? 'error' : ''}\n          />\n          {{/isTextArea}}\n          {{/isSelectField}}\n          \n          {errors.{{#camelCase}}{{name}}{{/camelCase}} && (\n            <span className=\"error-message\">{errors.{{#camelCase}}{{name}}{{/camelCase}}}</span>\n          )}\n        </div>\n        \n        {{/isIdField}}\n        {{/fields}}\n        \n        <div className=\"form-actions\">\n          {!readonly && (\n            <button type=\"submit\" className=\"btn btn-primary\">\n              Save {{className}}\n            </button>\n          )}\n          \n          {onCancel && (\n            <button type=\"button\" onClick={onCancel} className=\"btn btn-secondary\">\n              Cancel\n            </button>\n          )}\n        </div>\n      </form>\n    );\n  };\n  \n  export default {{className}}Form;\n```\n\n## Advanced Template Features\n\n### 7. Template with Partials\n\n**File: `templates/java/complex-entity.mustache.yaml`**\n\n```yaml\nname: \"Complex Entity with Partials\"\nversion: \"1.0.0\"\ndescription: \"Demonstrates template partials for code reuse\"\ntargetLanguage: \"java\"\noutputFileExtension: \"java\"\npackagePath: true\npartials:\n  constructor: |\n    // Default constructor\n    public {{className}}() {}\n    \n    // Constructor with required fields\n    public {{className}}({{#requiredFields}}{{javaType}} {{name}}{{^isLast}}, {{/isLast}}{{/requiredFields}}) {\n        {{#requiredFields}}\n        this.{{name}} = {{name}};\n        {{/requiredFields}}\n    }\n  \n  getters_setters: |\n    {{#fields}}\n    public {{javaType}} {{#capitalize}}get{{name}}{{/capitalize}}() {\n        return this.{{name}};\n    }\n    \n    public void {{#capitalize}}set{{name}}{{/capitalize}}({{javaType}} {{name}}) {\n        this.{{name}} = {{name}};\n    }\n    \n    {{/fields}}\n\ntemplate: |\n  package {{packageName}};\n  \n  public class {{className}} {\n      {{#fields}}\n      private {{javaType}} {{name}};\n      {{/fields}}\n      \n      {{>constructor}}\n      \n      {{>getters_setters}}\n  }\n```\n\n### 8. Conditional Template Logic\n\n**File: `templates/java/conditional-entity.mustache.yaml`**\n\n```yaml\nname: \"Entity with Conditional Logic\"\nversion: \"1.0.0\"\ndescription: \"Shows complex conditional logic in templates\"\ntargetLanguage: \"java\"\noutputFileExtension: \"java\"\npackagePath: true\ntemplate: |\n  package {{packageName}};\n  \n  {{#hasAuditing}}\n  import java.time.LocalDateTime;\n  {{/hasAuditing}}\n  {{#hasJpa}}\n  import javax.persistence.*;\n  {{/hasJpa}}\n  {{#hasValidation}}\n  import javax.validation.constraints.*;\n  {{/hasValidation}}\n  \n  {{#hasJpa}}\n  @Entity\n  @Table(name = \"{{dbTableName}}\")\n  {{/hasJpa}}\n  public class {{className}} {{#extendsClass}}extends {{extendsClass}}{{/extendsClass}} {{#implementsInterfaces}}implements {{#interfaces}}{{name}}{{^isLast}}, {{/isLast}}{{/interfaces}}{{/implementsInterfaces}} {\n      \n      {{#fields}}\n      {{#isIdField}}\n      {{#hasJpa}}\n      @Id\n      @GeneratedValue(strategy = GenerationType.IDENTITY)\n      {{/hasJpa}}\n      {{/isIdField}}\n      {{#hasJpa}}\n      @Column(name = \"{{dbColumnName}}\")\n      {{/hasJpa}}\n      {{#hasValidation}}\n      {{#isRequired}}\n      @NotNull\n      {{/isRequired}}\n      {{#hasLength}}\n      @Size(max = {{maxLength}})\n      {{/hasLength}}\n      {{/hasValidation}}\n      private {{javaType}} {{name}};\n      \n      {{/fields}}\n      \n      {{#hasAuditing}}\n      @Column(name = \"created_at\")\n      private LocalDateTime createdAt;\n      \n      @Column(name = \"updated_at\")  \n      private LocalDateTime updatedAt;\n      {{/hasAuditing}}\n  }\n```\n\n## Testing Templates\n\n### 9. Template Test Metadata\n\n**File: `codegen/src/test/resources/template-test-metadata.json`**\n\n```json\n{\n  \"metadata\": [\n    {\n      \"type\": \"object\",\n      \"name\": \"User\",\n      \"package\": \"com.example.model\",\n      \"attributes\": {\n        \"dbTable\": \"users\",\n        \"hasAuditing\": \"true\",\n        \"hasJpa\": \"true\",\n        \"hasValidation\": \"true\"\n      },\n      \"fields\": [\n        {\n          \"name\": \"id\",\n          \"dataType\": \"long\",\n          \"attributes\": {\n            \"isId\": \"true\",\n            \"dbColumn\": \"user_id\"\n          }\n        },\n        {\n          \"name\": \"username\",\n          \"dataType\": \"string\",\n          \"attributes\": {\n            \"required\": \"true\",\n            \"dbColumn\": \"username\",\n            \"maxLength\": \"50\",\n            \"isSearchable\": \"true\"\n          }\n        },\n        {\n          \"name\": \"email\",\n          \"dataType\": \"string\",\n          \"attributes\": {\n            \"required\": \"true\",\n            \"dbColumn\": \"email_address\",\n            \"maxLength\": \"255\",\n            \"isSearchable\": \"true\"\n          }\n        },\n        {\n          \"name\": \"age\",\n          \"dataType\": \"int\",\n          \"attributes\": {\n            \"dbColumn\": \"user_age\",\n            \"isOptional\": \"true\"\n          }\n        },\n        {\n          \"name\": \"status\",\n          \"dataType\": \"string\",\n          \"attributes\": {\n            \"dbColumn\": \"status\",\n            \"isSelectField\": \"true\",\n            \"selectOptions\": \"[{\\\"value\\\":\\\"active\\\",\\\"label\\\":\\\"Active\\\"},{\\\"value\\\":\\\"inactive\\\",\\\"label\\\":\\\"Inactive\\\"}]\"\n          }\n        }\n      ]\n    }\n  ]\n}\n```\n\nThese templates demonstrate the full power of the Mustache + Helper Functions approach, showing how the same template structure can generate sophisticated code while remaining readable and maintainable across different programming languages.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/template-system/MUSTACHE_TEMPLATE_EXAMPLES.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "def",
        "example",
        "function",
        "md"
      ],
      "content_hash": "7fca6c638fb90705",
      "size_bytes": 25079,
      "created_at": "2026-01-02T20:42:12.430508"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_template-system_TEMPLATE_SYSTEM_ARCHITECTURE",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/template-system/TEMPLATE_SYSTEM_ARCHITECTURE.md",
      "content": "# MetaObjects Cross-Language Template System Architecture\n\n## Executive Summary\n\nThis document defines the architecture for MetaObjects' cross-language template system, designed to support code generation across Java, C#, and TypeScript implementations while sharing template definitions. Based on comprehensive industry research, **Mustache** has been selected as the optimal template engine for this cross-language approach.\n\n## Research Findings and Rationale\n\n### Industry Analysis Results\n\n**Template Engine Performance Benchmarks (2024):**\n- **Mustache (JMustache): 8.8 seconds** ‚≠ê **FASTEST**\n- **FreeMarker: 11.8 seconds** \n- **Handlebars: 147 seconds**\n- **Velocity: 23.1 seconds** (deprecated)\n\n**Cross-Language Template Systems Analyzed:**\n- **OpenAPI Generator**: Mustache-based, supports 40+ languages\n- **GraphQL Code Generator**: Handlebars-based with custom plugins\n- **JHipster**: EJS templates via Yeoman, blueprint system\n- **Protocol Buffers**: IDL-based with language-specific generators\n- **Apache Thrift**: Template-driven for 28+ languages\n\n**Key Industry Insights:**\n1. **Logic-less templates** (Mustache) excel at cross-language compatibility\n2. **Helper function patterns** separate complex logic from templates\n3. **Template precompilation** provides 5-7x performance improvements\n4. **Shared template definitions** reduce maintenance overhead\n\n## Architectural Decision: Mustache + Helper Functions\n\n### Why Mustache Was Selected\n\n‚úÖ **Cross-Language Implementations Available:**\n- **Java**: JMustache (mature, actively maintained)\n- **C#**: Stubble/Mustachio (robust .NET implementations)\n- **TypeScript**: Mustache.js (official implementation)\n\n‚úÖ **Industry Validation:**\n- Used by OpenAPI Generator (40+ language support)\n- Powers GraphQL Code Generator's template system\n- Proven at enterprise scale across multiple languages\n\n‚úÖ **Performance Leader:**\n- Fastest among all tested template engines\n- Logic-less design optimizes for speed\n\n‚úÖ **Maintainability:**\n- Simple syntax reduces complexity\n- Helper functions handle language-specific logic\n- Same template files work across all languages\n\n### Architecture Overview\n\n```\nMetaObjects Template System\n‚îú‚îÄ‚îÄ Shared Template Definitions (.mustache files)\n‚îú‚îÄ‚îÄ Language-Specific Helper Functions\n‚îú‚îÄ‚îÄ Cross-Language Template Engine Implementations\n‚îî‚îÄ‚îÄ Integration with Existing Build Systems\n```\n\n## Core Architecture Components\n\n### 1. Template Definition Format\n\n**Enhanced Template Metadata:**\n```yaml\nname: \"JPA Entity Template\"\nversion: \"1.0.0\"\ndescription: \"Generate JPA entities with database annotations\"\ntargetLanguage: \"java\"\noutputFileExtension: \"java\"\npackagePath: true\nrequirements:\n  attributes: [\"dbTable\", \"dbColumn\"]\n  helpers: [\"capitalize\", \"javaType\", \"dbColumnName\", \"isIdField\"]\ntemplate: |\n  package {{packageName}};\n  \n  {{#imports}}\n  import {{.}};\n  {{/imports}}\n  \n  @Entity\n  @Table(name = \"{{dbTableName}}\")\n  public class {{className}} {\n      {{#fields}}\n      {{#isIdField}}@Id{{/isIdField}}\n      @Column(name = \"{{dbColumnName}}\")\n      private {{javaType}} {{name}};\n      {{/fields}}\n  }\n```\n\n### 2. Helper Function System\n\n**Language-Specific Helper Libraries:**\n```\nhelpers/\n‚îú‚îÄ‚îÄ java/\n‚îÇ   ‚îú‚îÄ‚îÄ TypeHelpers.java       # javaType(), isPrimitive()\n‚îÇ   ‚îú‚îÄ‚îÄ DatabaseHelpers.java   # dbColumnName(), isIdField()\n‚îÇ   ‚îî‚îÄ‚îÄ StringHelpers.java     # capitalize(), camelCase()\n‚îú‚îÄ‚îÄ csharp/\n‚îÇ   ‚îú‚îÄ‚îÄ TypeHelpers.cs         # CSharpType(), IsNullable()\n‚îÇ   ‚îú‚îÄ‚îÄ DatabaseHelpers.cs     # DbColumnName(), IsIdField()\n‚îÇ   ‚îî‚îÄ‚îÄ StringHelpers.cs       # Capitalize(), PascalCase()\n‚îî‚îÄ‚îÄ typescript/\n    ‚îú‚îÄ‚îÄ TypeHelpers.ts         # TypeScriptType(), IsOptional()\n    ‚îú‚îÄ‚îÄ DatabaseHelpers.ts     # dbColumnName(), isIdField()\n    ‚îî‚îÄ‚îÄ StringHelpers.ts       # capitalize(), camelCase()\n```\n\n### 3. Cross-Language Template Engine Architecture\n\n**Java Implementation:**\n```java\npublic class MustacheTemplateEngine implements TemplateEngine {\n    private final Mustache.Compiler compiler;\n    private final HelperRegistry helpers;\n    \n    @Override\n    public String generateCode(Template template, MetaObject metaObject) {\n        // JMustache implementation with MetaObjects integration\n    }\n}\n```\n\n**C# Implementation:**\n```csharp\npublic class MustacheTemplateEngine : ITemplateEngine {\n    private readonly StubbleVisitorRenderer renderer;\n    private readonly IHelperRegistry helpers;\n    \n    public string GenerateCode(Template template, MetaObject metaObject) {\n        // Stubble implementation with MetaObjects integration\n    }\n}\n```\n\n**TypeScript Implementation:**\n```typescript\nexport class MustacheTemplateEngine implements TemplateEngine {\n    private readonly helpers: HelperRegistry;\n    \n    generateCode(template: Template, metaObject: MetaObject): string {\n        // Mustache.js implementation with MetaObjects integration\n    }\n}\n```\n\n## Integration with MetaObjects Architecture\n\n### Service-Based Integration (v6.0.0+)\n\n**Template System as MetaData Service:**\n```java\n@Service\npublic class TemplateCodeGeneratorService implements MetaDataEnhancer {\n    \n    @Override\n    public void enhanceForService(MetaObject metaObject, String serviceName, Map<String, Object> context) {\n        // Integrate with existing service registry\n        // Use MetaDataTypeRegistry for template discovery\n        // Leverage MetaDataEnhancementService for attribute requirements\n    }\n}\n```\n\n**Template Discovery via ServiceLoader:**\n```java\npublic interface TemplateProvider {\n    List<Template> getAvailableTemplates();\n    boolean supportsLanguage(String language);\n    TemplateEngine createEngine(String language);\n}\n```\n\n### Maven Plugin Integration\n\n**Extend Existing MultiFileDirectGeneratorBase:**\n```java\npublic class MustacheTemplateGenerator extends MultiFileDirectGeneratorBase {\n    \n    @Override\n    protected void generateFiles(MetaObject metaObject, GeneratorIOManager manager) throws GeneratorIOException {\n        // Leverage existing Maven plugin architecture\n        // Use templatePath, outputDir, packagePrefix parameters\n        // Integrate with existing file generation patterns\n    }\n}\n```\n\n## Template Repository Structure\n\n```\ntemplates/\n‚îú‚îÄ‚îÄ shared/                    # Cross-language templates\n‚îÇ   ‚îú‚îÄ‚îÄ entity.mustache       # Basic entity template\n‚îÇ   ‚îú‚îÄ‚îÄ jpa-entity.mustache   # JPA-specific entity\n‚îÇ   ‚îú‚îÄ‚îÄ valueobject.mustache  # ValueObject extension\n‚îÇ   ‚îî‚îÄ‚îÄ dto.mustache          # Data Transfer Object\n‚îú‚îÄ‚îÄ java/                     # Java-specific templates\n‚îÇ   ‚îú‚îÄ‚îÄ spring-controller.mustache\n‚îÇ   ‚îî‚îÄ‚îÄ repository.mustache\n‚îú‚îÄ‚îÄ csharp/                   # C#-specific templates  \n‚îÇ   ‚îú‚îÄ‚îÄ ef-entity.mustache\n‚îÇ   ‚îî‚îÄ‚îÄ controller.mustache\n‚îî‚îÄ‚îÄ typescript/               # TypeScript-specific templates\n    ‚îú‚îÄ‚îÄ interface.mustache\n    ‚îî‚îÄ‚îÄ service.mustache\n```\n\n## Performance and Scalability Considerations\n\n### Template Compilation Strategy\n- **Build-time compilation** for production deployments\n- **Runtime compilation** for development/testing\n- **Template caching** to avoid recompilation overhead\n\n### Memory Management\n- **Lazy template loading** for large template repositories\n- **Template instance pooling** for high-throughput scenarios\n- **Metadata context caching** to reduce object creation\n\n## Security Considerations\n\n### Template Sandboxing\n- **No arbitrary code execution** in templates (logic-less advantage)\n- **Helper function validation** to prevent injection attacks  \n- **Template source validation** for untrusted template sources\n\n### Cross-Language Consistency\n- **Shared validation rules** across language implementations\n- **Consistent error handling** and reporting\n- **Unified security policies** for template processing\n\n## Migration Strategy\n\n### Phase 1: Foundation (Weeks 1-2)\n- Implement Java Mustache template engine\n- Create template definition parser\n- Develop core helper function system\n- Integrate with existing Maven plugin\n\n### Phase 2: Template Conversion (Weeks 3-4)  \n- Convert existing YAML/JSON templates to Mustache format\n- Implement comprehensive helper functions\n- Create template validation system\n- Extensive testing with existing MetaObjects\n\n### Phase 3: Cross-Language Implementation (Weeks 5-8)\n- Implement C# template engine with Stubble\n- Implement TypeScript template engine with Mustache.js\n- Create language-specific helper libraries\n- Cross-language integration testing\n\n### Phase 4: Production Readiness (Weeks 9-10)\n- Performance optimization and benchmarking\n- Documentation and developer guides\n- Template repository management system\n- Production deployment and monitoring\n\n## Success Metrics\n\n### Performance Targets\n- **Template processing**: < 50ms per template for typical MetaObjects\n- **Memory usage**: < 100MB for complete template repository\n- **Cross-language consistency**: 100% identical output for shared templates\n\n### Developer Experience Goals\n- **Template creation time**: < 30 minutes for new templates\n- **Cross-language deployment**: < 5 minutes to deploy across all languages\n- **Error debugging**: Clear error messages with line numbers and context\n\nThis architecture provides the foundation for a robust, performant, and maintainable cross-language template system that leverages industry best practices while integrating seamlessly with MetaObjects' existing service-based architecture.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/template-system/TEMPLATE_SYSTEM_ARCHITECTURE.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "def",
        "md"
      ],
      "content_hash": "606baf3518e2a0e4",
      "size_bytes": 9516,
      "created_at": "2026-01-02T20:42:12.430575"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_template-system_CROSS_LANGUAGE_INTEGRATION",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/template-system/CROSS_LANGUAGE_INTEGRATION.md",
      "content": "# MetaObjects Cross-Language Template Integration Guide\n\n## Overview\n\nThis document provides comprehensive integration details for implementing the Mustache-based template system across Java, C#, and TypeScript. Each language implementation maintains architectural consistency while leveraging language-specific best practices and libraries.\n\n## Architecture Consistency Across Languages\n\n### Shared Interface Contract\n\nAll language implementations follow this consistent interface:\n\n```\nITemplateEngine\n‚îú‚îÄ‚îÄ generateCode(template, metaObject) ‚Üí string\n‚îú‚îÄ‚îÄ registerHelper(name, function) ‚Üí void\n‚îú‚îÄ‚îÄ loadTemplate(path) ‚Üí Template\n‚îî‚îÄ‚îÄ validateTemplate(template) ‚Üí ValidationResult\n\nIHelperRegistry  \n‚îú‚îÄ‚îÄ register(name, helper) ‚Üí void\n‚îú‚îÄ‚îÄ get(name) ‚Üí Helper\n‚îú‚îÄ‚îÄ contains(name) ‚Üí boolean\n‚îî‚îÄ‚îÄ getAll() ‚Üí Map<string, Helper>\n```\n\n### Common Template Structure\n\nAll languages use identical template definition format:\n\n```yaml\nname: \"Template Name\"\ntargetLanguage: \"java|csharp|typescript\"\ntemplate: |\n  # Mustache template content - IDENTICAL across languages\nhelpers: [\"helper1\", \"helper2\"]  # Language-specific implementations\n```\n\n## Java Implementation Details\n\n### Dependencies and Setup\n\n**Maven Configuration (`pom.xml`):**\n\n```xml\n<dependencies>\n    <!-- JMustache - Best performing Java Mustache implementation -->\n    <dependency>\n        <groupId>com.github.spullara.mustache.java</groupId>\n        <artifactId>compiler</artifactId>\n        <version>0.9.10</version>\n    </dependency>\n    \n    <!-- Jackson for YAML template definitions -->\n    <dependency>\n        <groupId>com.fasterxml.jackson.dataformat</groupId>\n        <artifactId>jackson-dataformat-yaml</artifactId>\n        <version>2.15.2</version>\n    </dependency>\n    \n    <!-- MetaObjects dependencies -->\n    <dependency>\n        <groupId>com.metaobjects</groupId>\n        <artifactId>metadata</artifactId>\n        <version>${project.version}</version>\n    </dependency>\n</dependencies>\n```\n\n### Core Java Implementation\n\n**Java Template Engine (`MustacheTemplateEngine.java`):**\n\n```java\npackage com.metaobjects.generator.mustache;\n\nimport com.metaobjects.object.MetaObject;\nimport com.metaobjects.field.MetaField;\nimport com.github.mustachejava.*;\nimport java.io.*;\nimport java.util.*;\nimport java.util.concurrent.ConcurrentHashMap;\n\npublic class MustacheTemplateEngine implements ITemplateEngine {\n    \n    private final MustacheFactory mustacheFactory;\n    private final HelperRegistry helperRegistry;\n    private final Map<String, Mustache> templateCache;\n    \n    public MustacheTemplateEngine() {\n        this.mustacheFactory = new DefaultMustacheFactory();\n        this.helperRegistry = new JavaHelperRegistry();\n        this.templateCache = new ConcurrentHashMap<>();\n    }\n    \n    @Override\n    public String generateCode(TemplateDefinition template, MetaObject metaObject) {\n        try {\n            // Get or compile template\n            Mustache mustache = getCompiledTemplate(template);\n            \n            // Create context with helper functions\n            Map<String, Object> context = createContext(metaObject);\n            \n            // Execute template\n            StringWriter writer = new StringWriter();\n            mustache.execute(writer, context);\n            \n            return writer.toString();\n            \n        } catch (Exception e) {\n            throw new TemplateException(\"Failed to generate code\", e);\n        }\n    }\n    \n    private Mustache getCompiledTemplate(TemplateDefinition template) {\n        return templateCache.computeIfAbsent(template.getName(), \n            name -> mustacheFactory.compile(\n                new StringReader(template.getTemplate()), \n                name\n            )\n        );\n    }\n    \n    private Map<String, Object> createContext(MetaObject metaObject) {\n        Map<String, Object> context = new HashMap<>();\n        \n        // Basic MetaObject properties\n        context.put(\"className\", metaObject.getName());\n        context.put(\"packageName\", getPackageName(metaObject));\n        context.put(\"fullName\", metaObject.getFullName());\n        \n        // Process fields with helper functions\n        List<Map<String, Object>> fields = metaObject.getFields().stream()\n            .map(this::createFieldContext)\n            .collect(Collectors.toList());\n        context.put(\"fields\", fields);\n        \n        // Add lambda helpers for template use\n        addLambdaHelpers(context);\n        \n        return context;\n    }\n    \n    private void addLambdaHelpers(Map<String, Object> context) {\n        // Capitalize helper\n        context.put(\"capitalize\", (Mustache.Lambda) (frag, out) -> {\n            String text = frag.execute().trim();\n            out.write(helperRegistry.get(\"capitalize\").apply(text).toString());\n        });\n        \n        // Java type helper\n        context.put(\"javaType\", (Mustache.Lambda) (frag, out) -> {\n            String dataType = frag.execute().trim();\n            out.write(helperRegistry.get(\"javaType\").apply(dataType).toString());\n        });\n    }\n}\n```\n\n**Java Helper Registry (`JavaHelperRegistry.java`):**\n\n```java\npackage com.metaobjects.generator.mustache;\n\nimport com.metaobjects.field.MetaField;\nimport org.apache.commons.lang3.StringUtils;\nimport java.util.function.Function;\n\npublic class JavaHelperRegistry extends BaseHelperRegistry {\n    \n    @Override\n    protected void registerLanguageSpecificHelpers() {\n        // Java-specific type mappings\n        register(\"javaType\", this::getJavaType);\n        register(\"javaImport\", this::getJavaImport);\n        register(\"javaDefault\", this::getJavaDefault);\n        register(\"isJavaPrimitive\", this::isJavaPrimitive);\n        \n        // JPA-specific helpers\n        register(\"jpaColumnType\", this::getJpaColumnType);\n        register(\"jpaAnnotations\", this::getJpaAnnotations);\n        \n        // Spring-specific helpers\n        register(\"springValidation\", this::getSpringValidation);\n    }\n    \n    private Object getJavaType(Object input) {\n        if (input instanceof MetaField) {\n            MetaField field = (MetaField) input;\n            return mapDataTypeToJava(field.getDataType());\n        }\n        if (input instanceof String) {\n            return mapDataTypeToJava((String) input);\n        }\n        return \"Object\";\n    }\n    \n    private String mapDataTypeToJava(String dataType) {\n        switch (dataType.toLowerCase()) {\n            case \"string\": return \"String\";\n            case \"int\": case \"integer\": return \"Integer\";\n            case \"long\": return \"Long\";\n            case \"boolean\": return \"Boolean\";\n            case \"double\": return \"Double\";\n            case \"float\": return \"Float\";\n            case \"date\": return \"java.time.LocalDate\";\n            case \"datetime\": return \"java.time.LocalDateTime\";\n            case \"decimal\": return \"java.math.BigDecimal\";\n            case \"uuid\": return \"java.util.UUID\";\n            default: return \"Object\";\n        }\n    }\n    \n    private Object getJavaImport(Object input) {\n        String javaType = getJavaType(input).toString();\n        if (javaType.contains(\".\")) {\n            return javaType;\n        }\n        return null; // No import needed for primitives\n    }\n    \n    private Object isJavaPrimitive(Object input) {\n        String javaType = getJavaType(input).toString();\n        return Arrays.asList(\"int\", \"long\", \"boolean\", \"double\", \"float\", \"char\", \"byte\", \"short\")\n                .contains(javaType.toLowerCase());\n    }\n}\n```\n\n### Java Build Integration\n\n**Maven Plugin Configuration:**\n\n```xml\n<plugin>\n    <groupId>com.metaobjects</groupId>\n    <artifactId>metaobjects-maven-plugin</artifactId>\n    <version>${project.version}</version>\n    <executions>\n        <execution>\n            <phase>generate-sources</phase>\n            <goals>\n                <goal>generate</goal>\n            </goals>\n            <configuration>\n                <generator>mustache</generator>\n                <templatePath>src/main/resources/templates/</templatePath>\n                <outputDirectory>target/generated-sources/metaobjects</outputDirectory>\n                <packagePrefix>com.example.generated</packagePrefix>\n            </configuration>\n        </execution>\n    </executions>\n</plugin>\n```\n\n## C# Implementation Details\n\n### Dependencies and Setup\n\n**NuGet Package Configuration (`.csproj`):**\n\n```xml\n<Project Sdk=\"Microsoft.NET.Sdk\">\n  <PropertyGroup>\n    <TargetFramework>net6.0</TargetFramework>\n  </PropertyGroup>\n  \n  <ItemGroup>\n    <!-- Stubble - High performance .NET Mustache implementation -->\n    <PackageReference Include=\"Stubble.Core\" Version=\"1.10.8\" />\n    <PackageReference Include=\"Stubble.Extensions.Loaders\" Version=\"1.10.8\" />\n    \n    <!-- YAML Configuration -->\n    <PackageReference Include=\"YamlDotNet\" Version=\"13.1.1\" />\n    \n    <!-- JSON.NET for complex object handling -->\n    <PackageReference Include=\"Newtonsoft.Json\" Version=\"13.0.3\" />\n  </ItemGroup>\n</Project>\n```\n\n### Core C# Implementation\n\n**C# Template Engine (`MustacheTemplateEngine.cs`):**\n\n```csharp\nusing Stubble.Core.Builders;\nusing Stubble.Core.Contexts;\nusing Stubble.Core.Renderers.StringRenderer;\nusing System;\nusing System.Collections.Generic;\nusing System.Threading.Tasks;\n\nnamespace MetaObjects.CodeGen.Mustache\n{\n    public class MustacheTemplateEngine : ITemplateEngine\n    {\n        private readonly StubbleVisitorRenderer _renderer;\n        private readonly IHelperRegistry _helperRegistry;\n        private readonly Dictionary<string, string> _templateCache;\n        \n        public MustacheTemplateEngine()\n        {\n            _renderer = new StubbleBuilder()\n                .Configure(settings => {\n                    settings.SetIgnoreCaseOnKeyLookup(true);\n                    settings.SetMaxRecursionDepth(512);\n                })\n                .Build();\n                \n            _helperRegistry = new CSharpHelperRegistry();\n            _templateCache = new Dictionary<string, string>();\n        }\n        \n        public string GenerateCode(TemplateDefinition template, MetaObject metaObject)\n        {\n            try\n            {\n                // Create context with helper functions\n                var context = CreateContext(metaObject);\n                \n                // Render template\n                return _renderer.Render(template.Template, context);\n            }\n            catch (Exception ex)\n            {\n                throw new TemplateException($\"Failed to generate code: {ex.Message}\", ex);\n            }\n        }\n        \n        private object CreateContext(MetaObject metaObject)\n        {\n            var context = new Dictionary<string, object>\n            {\n                [\"className\"] = metaObject.Name,\n                [\"namespaceName\"] = GetNamespaceName(metaObject),\n                [\"fullName\"] = metaObject.FullName,\n                [\"fields\"] = metaObject.Fields.Select(CreateFieldContext).ToList()\n            };\n            \n            // Add helper functions as lambda expressions\n            AddLambdaHelpers(context);\n            \n            return context;\n        }\n        \n        private void AddLambdaHelpers(Dictionary<string, object> context)\n        {\n            // C# specific helpers using lambda expressions\n            context[\"capitalize\"] = new Func<string, object>(text => \n                _helperRegistry.Get(\"capitalize\").Invoke(text));\n                \n            context[\"csharpType\"] = new Func<object, object>(input => \n                _helperRegistry.Get(\"csharpType\").Invoke(input));\n                \n            context[\"pascalCase\"] = new Func<string, object>(text => \n                _helperRegistry.Get(\"pascalCase\").Invoke(text));\n        }\n        \n        private string GetNamespaceName(MetaObject metaObject)\n        {\n            return metaObject.HasAttribute(\"namespace\") \n                ? metaObject.GetAttributeValue(\"namespace\").ToString()\n                : \"Generated.Models\";\n        }\n    }\n}\n```\n\n**C# Helper Registry (`CSharpHelperRegistry.cs`):**\n\n```csharp\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\n\nnamespace MetaObjects.CodeGen.Mustache\n{\n    public class CSharpHelperRegistry : BaseHelperRegistry\n    {\n        protected override void RegisterLanguageSpecificHelpers()\n        {\n            // C# specific type mappings\n            Register(\"csharpType\", GetCSharpType);\n            Register(\"csharpDefault\", GetCSharpDefault);\n            Register(\"csharpUsing\", GetCSharpUsing);\n            Register(\"isNullable\", IsNullableType);\n            \n            // Entity Framework specific\n            Register(\"efColumnType\", GetEfColumnType);\n            Register(\"efAnnotations\", GetEfAnnotations);\n            \n            // ASP.NET specific\n            Register(\"aspNetValidation\", GetAspNetValidation);\n            Register(\"pascalCase\", ToPascalCase);\n        }\n        \n        private object GetCSharpType(object input)\n        {\n            var dataType = ExtractDataType(input);\n            \n            return dataType?.ToLowerInvariant() switch\n            {\n                \"string\" => \"string\",\n                \"int\" or \"integer\" => \"int\",\n                \"long\" => \"long\",\n                \"boolean\" => \"bool\",\n                \"double\" => \"double\",\n                \"float\" => \"float\",\n                \"date\" => \"DateTime\",\n                \"datetime\" => \"DateTime\",\n                \"decimal\" => \"decimal\",\n                \"uuid\" => \"Guid\",\n                _ => \"object\"\n            };\n        }\n        \n        private object GetCSharpDefault(object input)\n        {\n            var csharpType = GetCSharpType(input).ToString();\n            \n            return csharpType switch\n            {\n                \"string\" => \"string.Empty\",\n                \"int\" => \"0\",\n                \"long\" => \"0L\",\n                \"bool\" => \"false\",\n                \"double\" => \"0.0\",\n                \"float\" => \"0.0f\",\n                \"DateTime\" => \"DateTime.MinValue\",\n                \"decimal\" => \"0m\",\n                \"Guid\" => \"Guid.Empty\",\n                _ => \"null\"\n            };\n        }\n        \n        private object ToPascalCase(object input)\n        {\n            if (input?.ToString() is string text && !string.IsNullOrEmpty(text))\n            {\n                return char.ToUpperInvariant(text[0]) + text.Substring(1);\n            }\n            return input?.ToString() ?? string.Empty;\n        }\n        \n        private object IsNullableType(object input)\n        {\n            // Check if field is marked as nullable/optional\n            if (input is MetaField field)\n            {\n                return !field.HasAttribute(\"required\") || \n                       !bool.Parse(field.GetAttributeValue(\"required\")?.ToString() ?? \"false\");\n            }\n            return true;\n        }\n    }\n}\n```\n\n### C# Build Integration\n\n**MSBuild Integration (`MetaObjects.targets`):**\n\n```xml\n<Project>\n  <UsingTask TaskName=\"MetaObjectsCodeGenTask\" AssemblyFile=\"$(MSBuildThisFileDirectory)MetaObjects.CodeGen.dll\" />\n  \n  <Target Name=\"GenerateMetaObjectsCode\" BeforeTargets=\"CoreCompile\">\n    <MetaObjectsCodeGenTask \n      TemplateEngine=\"mustache\"\n      TemplatePath=\"$(ProjectDir)Templates\\\"\n      MetadataPath=\"$(ProjectDir)Metadata\\\"\n      OutputPath=\"$(IntermediateOutputPath)Generated\\\"\n      Namespace=\"$(RootNamespace).Generated\" />\n  </Target>\n  \n  <ItemGroup>\n    <Compile Include=\"$(IntermediateOutputPath)Generated\\**\\*.cs\" />\n  </ItemGroup>\n</Project>\n```\n\n## TypeScript Implementation Details\n\n### Dependencies and Setup\n\n**NPM Configuration (`package.json`):**\n\n```json\n{\n  \"name\": \"metaobjects-codegen\",\n  \"version\": \"1.0.0\",\n  \"dependencies\": {\n    \"mustache\": \"^4.2.0\",\n    \"js-yaml\": \"^4.1.0\",\n    \"typescript\": \"^5.0.0\"\n  },\n  \"devDependencies\": {\n    \"@types/mustache\": \"^4.2.0\",\n    \"@types/js-yaml\": \"^4.0.0\",\n    \"@types/node\": \"^18.0.0\"\n  }\n}\n```\n\n### Core TypeScript Implementation\n\n**TypeScript Template Engine (`MustacheTemplateEngine.ts`):**\n\n```typescript\nimport * as Mustache from 'mustache';\nimport * as yaml from 'js-yaml';\nimport { ITemplateEngine, TemplateDefinition, MetaObject, HelperRegistry } from './types';\n\nexport class MustacheTemplateEngine implements ITemplateEngine {\n    private readonly helperRegistry: HelperRegistry;\n    private readonly templateCache: Map<string, string> = new Map();\n    \n    constructor() {\n        this.helperRegistry = new TypeScriptHelperRegistry();\n    }\n    \n    generateCode(template: TemplateDefinition, metaObject: MetaObject): string {\n        try {\n            // Create context with helper functions\n            const context = this.createContext(metaObject);\n            \n            // Configure Mustache\n            Mustache.tags = ['{{', '}}'];\n            \n            // Render template\n            return Mustache.render(template.template, context, {}, {\n                escape: (text: string) => text // Disable HTML escaping for code generation\n            });\n            \n        } catch (error) {\n            throw new Error(`Failed to generate code: ${error.message}`);\n        }\n    }\n    \n    private createContext(metaObject: MetaObject): any {\n        const context = {\n            className: metaObject.name,\n            packageName: this.getPackageName(metaObject),\n            fullName: metaObject.fullName,\n            fields: metaObject.fields.map(field => this.createFieldContext(field)),\n            \n            // Helper functions as lambda expressions\n            capitalize: () => (text: string, render: Function) => \n                this.helperRegistry.get('capitalize')!(render(text)),\n                \n            camelCase: () => (text: string, render: Function) => \n                this.helperRegistry.get('camelCase')!(render(text)),\n                \n            typeScriptType: () => (input: any, render: Function) => \n                this.helperRegistry.get('typeScriptType')!(render(input))\n        };\n        \n        return context;\n    }\n    \n    private createFieldContext(field: any): any {\n        return {\n            name: field.name,\n            typeScriptType: this.helperRegistry.get('typeScriptType')!(field),\n            isOptional: this.helperRegistry.get('isOptional')!(field),\n            camelCaseName: this.helperRegistry.get('camelCase')!(field.name),\n            hasDefaultValue: field.attributes?.defaultValue !== undefined,\n            defaultValue: field.attributes?.defaultValue,\n            description: field.description || `Property ${field.name}`\n        };\n    }\n    \n    private getPackageName(metaObject: MetaObject): string {\n        return metaObject.attributes?.package || 'generated';\n    }\n}\n```\n\n**TypeScript Helper Registry (`TypeScriptHelperRegistry.ts`):**\n\n```typescript\nimport { BaseHelperRegistry } from './BaseHelperRegistry';\n\nexport class TypeScriptHelperRegistry extends BaseHelperRegistry {\n    \n    protected registerLanguageSpecificHelpers(): void {\n        // TypeScript specific type mappings\n        this.register('typeScriptType', this.getTypeScriptType.bind(this));\n        this.register('typeScriptDefault', this.getTypeScriptDefault.bind(this));\n        this.register('typeScriptImport', this.getTypeScriptImport.bind(this));\n        this.register('isOptional', this.isOptional.bind(this));\n        \n        // React specific helpers\n        this.register('reactPropType', this.getReactPropType.bind(this));\n        this.register('getInputType', this.getInputType.bind(this));\n        \n        // Validation helpers\n        this.register('hasValidation', this.hasValidation.bind(this));\n        this.register('getValidationRules', this.getValidationRules.bind(this));\n    }\n    \n    private getTypeScriptType(input: any): string {\n        const dataType = this.extractDataType(input);\n        \n        switch (dataType?.toLowerCase()) {\n            case 'string': return 'string';\n            case 'int':\n            case 'integer':\n            case 'long':\n            case 'double':\n            case 'float':\n            case 'decimal': return 'number';\n            case 'boolean': return 'boolean';\n            case 'date':\n            case 'datetime': return 'Date';\n            case 'uuid': return 'string';\n            case 'array': return 'any[]';\n            case 'object': return 'any';\n            default: return 'any';\n        }\n    }\n    \n    private getTypeScriptDefault(input: any): string {\n        const tsType = this.getTypeScriptType(input);\n        \n        switch (tsType) {\n            case 'string': return \"''\";\n            case 'number': return '0';\n            case 'boolean': return 'false';\n            case 'Date': return 'new Date()';\n            case 'any[]': return '[]';\n            case 'any': return 'undefined';\n            default: return 'undefined';\n        }\n    }\n    \n    private isOptional(input: any): boolean {\n        if (typeof input === 'object' && input.attributes) {\n            return !input.attributes.required || input.attributes.isOptional === 'true';\n        }\n        return true;\n    }\n    \n    private getInputType(input: any): string {\n        const tsType = this.getTypeScriptType(input);\n        \n        switch (tsType) {\n            case 'string': return 'text';\n            case 'number': return 'number';\n            case 'boolean': return 'checkbox';\n            case 'Date': return 'datetime-local';\n            default: return 'text';\n        }\n    }\n    \n    private getReactPropType(input: any): string {\n        const tsType = this.getTypeScriptType(input);\n        const isOptional = this.isOptional(input);\n        \n        return isOptional ? `${tsType} | undefined` : tsType;\n    }\n}\n```\n\n### TypeScript Build Integration\n\n**Webpack Plugin Configuration (`webpack.config.js`):**\n\n```javascript\nconst MetaObjectsCodeGenPlugin = require('./plugins/MetaObjectsCodeGenPlugin');\n\nmodule.exports = {\n    plugins: [\n        new MetaObjectsCodeGenPlugin({\n            templateEngine: 'mustache',\n            templatePath: './src/templates/',\n            metadataPath: './src/metadata/',\n            outputPath: './src/generated/',\n            watch: process.env.NODE_ENV === 'development'\n        })\n    ]\n};\n```\n\n**Custom Webpack Plugin (`MetaObjectsCodeGenPlugin.js`):**\n\n```javascript\nconst { MustacheTemplateEngine } = require('./MustacheTemplateEngine');\n\nclass MetaObjectsCodeGenPlugin {\n    constructor(options) {\n        this.options = options;\n        this.templateEngine = new MustacheTemplateEngine();\n    }\n    \n    apply(compiler) {\n        compiler.hooks.beforeCompile.tapAsync('MetaObjectsCodeGen', (params, callback) => {\n            this.generateCode().then(() => callback()).catch(callback);\n        });\n    }\n    \n    async generateCode() {\n        // Load templates and metadata\n        // Generate code using template engine\n        // Write output files\n    }\n}\n\nmodule.exports = MetaObjectsCodeGenPlugin;\n```\n\n## Cross-Language Template Sharing\n\n### Shared Template Repository Structure\n\n```\ntemplates/\n‚îú‚îÄ‚îÄ shared/                    # Cross-language templates\n‚îÇ   ‚îú‚îÄ‚îÄ entity.mustache       # Basic entity (works in all languages)\n‚îÇ   ‚îú‚îÄ‚îÄ dto.mustache          # Data transfer object\n‚îÇ   ‚îî‚îÄ‚îÄ interface.mustache    # Interface/contract definition\n‚îú‚îÄ‚îÄ java/                     # Java-specific templates\n‚îÇ   ‚îú‚îÄ‚îÄ jpa-entity.mustache\n‚îÇ   ‚îú‚îÄ‚îÄ spring-controller.mustache\n‚îÇ   ‚îî‚îÄ‚îÄ repository.mustache\n‚îú‚îÄ‚îÄ csharp/                   # C#-specific templates\n‚îÇ   ‚îú‚îÄ‚îÄ ef-entity.mustache\n‚îÇ   ‚îú‚îÄ‚îÄ controller.mustache\n‚îÇ   ‚îî‚îÄ‚îÄ service.mustache\n‚îî‚îÄ‚îÄ typescript/               # TypeScript-specific templates\n    ‚îú‚îÄ‚îÄ interface.mustache\n    ‚îú‚îÄ‚îÄ react-component.mustache\n    ‚îî‚îÄ‚îÄ service.mustache\n```\n\n### Template Versioning and Compatibility\n\n**Template Compatibility Matrix:**\n\n| Template Version | Java Support | C# Support | TypeScript Support |\n|-----------------|-------------|------------|-------------------|\n| 1.0.x           | ‚úÖ JDK 8+   | ‚úÖ .NET 5+  | ‚úÖ TS 4.0+        |\n| 1.1.x           | ‚úÖ JDK 11+  | ‚úÖ .NET 6+  | ‚úÖ TS 4.5+        |\n| 2.0.x           | ‚úÖ JDK 17+  | ‚úÖ .NET 7+  | ‚úÖ TS 5.0+        |\n\n### Cross-Language Testing Strategy\n\n**Shared Test Cases (`test-cases.yaml`):**\n\n```yaml\ntestCases:\n  - name: \"Basic Entity Generation\"\n    metadata: \"test-user.json\"\n    expectedOutputs:\n      java: \"User.java\"\n      csharp: \"User.cs\"\n      typescript: \"User.ts\"\n    \n  - name: \"JPA/EF Entity Generation\"\n    metadata: \"test-user-with-db.json\"\n    expectedOutputs:\n      java: \"UserEntity.java\"\n      csharp: \"UserEntity.cs\"\n      typescript: \"UserInterface.ts\"\n```\n\nThis cross-language integration approach ensures that the same template definitions can generate appropriate code for each target language while maintaining consistency in the generated output structure and functionality.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/template-system/CROSS_LANGUAGE_INTEGRATION.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "a18cab1ca5b2c7f2",
      "size_bytes": 24958,
      "created_at": "2026-01-02T20:42:12.430652"
    },
    {
      "doc_id": "local_metaobjects-core__claude_archive_template-system_TEMPLATE_DESIGN",
      "source": "local",
      "category": "knowledge_base",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/archive/template-system/TEMPLATE_DESIGN.md",
      "content": "# Cross-Language Template Design\n\n## Overview\nTemplate definitions that can be shared across Java, C#, and TypeScript implementations of MetaObjects.\n\n## Template Definition Format\n\n### Basic Structure\n```yaml\ntemplate:\n  metadata:\n    name: \"entity-class\"\n    version: \"1.0.0\"\n    description: \"Generates entity classes\"\n    author: \"MetaObjects\"\n    \n  requirements:\n    metaObjectTypes: [\"object\"]\n    attributes: [\"dbTable\", \"validation\"]\n    services: [\"codeGen\"]\n    \n  variables:\n    className: \"${metaObject.name}\"\n    packageName: \"${metaObject.attr.package}\"\n    tableName: \"${metaObject.attr.dbTable}\"\n    \n  sections:\n    - name: \"class-declaration\"\n      pattern: \"${targetLanguage.classDeclaration}\"\n      variables:\n        className: \"${className}\"\n        baseClass: \"${metaObject.attr.baseClass}\"\n        \n    - name: \"properties\"\n      pattern: \"${targetLanguage.propertyDeclaration}\"\n      forEach: \"${metaObject.fields}\"\n      variables:\n        fieldName: \"${field.name}\"\n        fieldType: \"${targetLanguage.mapType(field.dataType)}\"\n        \n    - name: \"constructor\"\n      pattern: \"${targetLanguage.constructor}\"\n      conditional: \"${metaObject.attr.generateConstructor}\"\n```\n\n### Language-Specific Mappings\nTemplates reference language-neutral patterns that each implementation maps to target syntax:\n\n```yaml\nlanguageMappings:\n  java:\n    classDeclaration: \"public class ${className} extends ${baseClass} {\"\n    propertyDeclaration: \"private ${fieldType} ${fieldName};\"\n    constructor: \"public ${className}() {}\"\n    \n  csharp:\n    classDeclaration: \"public class ${className} : ${baseClass} {\"\n    propertyDeclaration: \"public ${fieldType} ${fieldName} { get; set; }\"\n    constructor: \"public ${className}() {}\"\n    \n  typescript:\n    classDeclaration: \"export class ${className} extends ${baseClass} {\"\n    propertyDeclaration: \"${fieldName}: ${fieldType};\"\n    constructor: \"constructor() { super(); }\"\n```\n\n## Key Design Principles\n\n1. **Language Neutral**: Templates define WHAT to generate, not HOW\n2. **Pattern-Based**: Use symbolic patterns that each language implements\n3. **Variable Resolution**: MetaObject properties map to template variables\n4. **Conditional Logic**: Templates can include conditional sections\n5. **Iteration Support**: Templates can iterate over collections (fields, etc.)\n\n## Template Engine Contract\n\nEach language implementation must provide:\n- Template parser (JSON/YAML)\n- Variable resolver (MetaObject ‚Üí variables)\n- Language mappings (patterns ‚Üí target syntax)\n- Type mapper (MetaObjects types ‚Üí target types)\n- Code formatter (target language formatting)\n\n## Integration with v6.0.0\n\nTemplates integrate with service architecture:\n- Template discovery via ServiceLoader\n- Attribute requirements through MetaDataEnhancementService\n- Service-specific template variants\n- Plugin-based language mapping providers",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/archive/template-system/TEMPLATE_DESIGN.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "def",
        "md"
      ],
      "content_hash": "7d2b9baf062c2207",
      "size_bytes": 2883,
      "created_at": "2026-01-02T20:42:12.430713"
    },
    {
      "doc_id": "local_metaobjects-core__claude_docs_ENHANCEMENTS",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/docs/ENHANCEMENTS.md",
      "content": "# MetaObjects Code Quality Enhancement Roadmap\n\n## üéâ **COMPREHENSIVE MODERNIZATION COMPLETE (2024-2025)**\n\n**üöÄ LATEST ACHIEVEMENT - COMPREHENSIVE MODERNIZATION**: Building on the successful architectural refactoring, the MetaObjects project has achieved **comprehensive modernization** across security, infrastructure, and code quality.\n\n### üîí **SECURITY MODERNIZATION ACHIEVED**\n- **‚úÖ CRITICAL CVE FIXES**: Eliminated CVE-2015-7501 & CVE-2015-6420 (Apache Commons Collections RCE)\n- **‚úÖ DEPENDENCY SECURITY**: Upgraded to commons-collections4 4.5.0-M2 (secure)\n- **‚úÖ FRAMEWORK UPDATES**: Spring 5.3.39, Commons Lang3 3.18.0, latest secure versions\n- **‚úÖ PROACTIVE SCANNING**: Vulnerability management integrated into workflow\n\n### üöÄ **CODE MODERNIZATION ACHIEVED**\n- **‚úÖ DEPRECATED API ELIMINATION**: 341 lines of deprecated code removed across 34+ files\n- **‚úÖ TYPE SAFETY**: Modern Optional-based APIs replacing legacy null-return patterns\n- **‚úÖ API MODERNIZATION**: Complete replacement of getTypeName() ‚Üí getType(), getSubTypeName() ‚Üí getSubType()\n- **‚úÖ QUERY BUILDER**: Upgraded to null-safe firstOptional() patterns\n\n### üèóÔ∏è **INFRASTRUCTURE MODERNIZATION ACHIEVED**\n- **‚úÖ JAVA 17 LTS**: Production-ready migration from Java 21\n- **‚úÖ GITHUB ACTIONS**: Modern CI/CD with checkout@v4, setup-java@v4, Maven caching\n- **‚úÖ BUILD OPTIMIZATION**: Enhanced performance with intelligent caching\n- **‚úÖ CROSS-PLATFORM**: Temurin JDK for reliable multi-platform builds\n\n### üìä **QUALITY ACHIEVEMENTS**\n- **‚úÖ ZERO CRITICAL VULNERABILITIES**: Comprehensive security remediation\n- **‚úÖ 117+ TESTS PASSING**: Full test suite validation\n- **‚úÖ 19 MODULES BUILDING**: Clean compilation across entire project\n- **‚úÖ BACKWARD COMPATIBILITY**: API evolution without breaking changes\n\n---\n\n## üéâ **MAJOR MILESTONE ACHIEVED - ARCHITECTURAL REFACTORING COMPLETE**\n\n**üöÄ FOUNDATION COMPLETED (2025-09-21)**: The individual enhancement items in this roadmap were **superseded by a complete architectural refactoring** that delivered the foundation for our comprehensive modernization.\n\n## ‚úÖ **ARCHITECTURAL REFACTORING ACHIEVEMENTS**\n\n**STATUS**: **COMPLETE SUCCESS** - All 5 phases of architectural refactoring successfully implemented:\n\n- ‚úÖ **Phase 1: Preparation** - Build system and dependencies\n- ‚úÖ **Phase 2: Codegen Modularization** - 3 focused code generation modules  \n- ‚úÖ **Phase 3: Spring Integration** - core-spring and web-spring modules\n- ‚úÖ **Phase 4: Examples Structure** - 4 working examples with comprehensive documentation\n- ‚úÖ **Phase 5: Cleanup & Documentation** - Complete docs and migration guides\n\n**IMPACT**: **14 focused modules** replacing monolithic structure, **framework independence**, **Maven publishing ready**, **all tests passing**.\n\n## üìä **Legacy Enhancement Progress** *(Superseded)*\n\n**Status**: 8 of 15 items completed + CONSTRAINT SYSTEM UNIFICATION + **COMPLETE ARCHITECTURAL REFACTORING**  \n**Architecture Compliance**: All recommendations exceeded with modular architecture implementation\n\n---\n\n## üöÄ **How to Use This File**\n\n**For Future Claude Sessions:**\n```\n\"Please read .claude/ENHANCEMENTS.md and work on the next priority item. \nFollow the architectural guidelines in .claude/CLAUDE.md.\"\n```\n\n**Progress Tracking:**\n- Update status from `üî≤ TODO` ‚Üí `üîÑ IN_PROGRESS` ‚Üí `‚úÖ COMPLETED`\n- Add completion date and notes\n- Move to next priority item\n\n---\n\n## üéØ **HIGH PRIORITY** - Critical Technical Debt (Complete First)\n\n### HIGH-1: Type Safety in DataConverter ‚ö†Ô∏è CRITICAL\n**Status**: ‚úÖ COMPLETED (2025-09-19)  \n**Effort**: 2-3 hours  \n**Files**: `metadata/src/main/java/com/draagon/meta/util/DataConverter.java`\n\n**Problem**: Unsafe `List<?>` to `List<String>` casting at lines 106 and 170\n```java\n// Line 106 - UNSAFE\nreturn (List<String>) val; // ClassCastException risk\n\n// Line 170 - UNSAFE  \nreturn (List<Object>) val; // ClassCastException risk\n```\n\n**Solution**: Replace with existing safe methods `toStringArraySafe()` and `toObjectArraySafe()`\n\n**Success Criteria**:\n- [x] Remove unsafe casts from `toStringArray()` method\n- [x] Remove unsafe casts from `toObjectArray()` method  \n- [x] Use stream-based conversion with proper null handling\n- [x] All existing tests pass\n- [x] No ClassCastException risk remains\n\n**Completion Notes**: \n- Implemented stream-based conversion for `toStringArray()` with proper null handling\n- Implemented hybrid approach for `toObjectArray()` that preserves reference semantics when safe\n- All 117 metadata module tests pass\n- Full project compilation successful across all 10 modules\n\n**Architecture Notes**: Type safety critical regardless of LOAD-ONCE pattern\n\n---\n\n### HIGH-2: Thread-Safety for Read-Heavy with Dynamic Updates ‚ö†Ô∏è ELEVATED\n**Status**: üîÑ DEFERRED  \n**Effort**: 6-8 hours  \n**Files**: `metadata/src/main/java/com/draagon/meta/MetaData.java`\n\n**Problem**: Over-synchronization in read-heavy operations + need for concurrent read-during-update support\n```java\n// Lines 862+ - addChildren() method has complex synchronized logic\n// Need volatile references for atomic visibility during updates\n// Current synchronization may block reads during metadata updates\n```\n\n**Solution**: Implement read-optimized concurrency with atomic update support\n- Use `ConcurrentHashMap` for field lookups\n- Implement volatile references for atomic metadata swapping\n- Support concurrent reads during infrequent metadata updates\n- Copy-on-write patterns for metadata collections\n\n**Success Criteria**:\n- [ ] Replace synchronized blocks with lock-free reads where possible\n- [ ] Implement volatile references for metadata object references\n- [ ] Add support for atomic metadata swapping (future dynamic updates)\n- [ ] Ensure no reader blocking during metadata updates\n- [ ] Performance improvement measurable in concurrent access tests\n- [ ] Update scenarios tested and working\n\n**Deferral Notes**: \n- User prioritized OSGI bundle lifecycle work (HIGH-4) over thread-safety improvements\n- Current thread-safety is adequate for existing read-heavy workloads\n- Will be revisited when dynamic update requirements become immediate priority\n\n**Architecture Notes**: Critical for both read performance AND future dynamic update capability\n\n---\n\n### HIGH-3: Dynamic Metadata Update Infrastructure üöÄ NEW\n**Status**: üîÑ DEFERRED  \n**Effort**: 8-10 hours  \n**Files**: \n- `metadata/src/main/java/com/draagon/meta/loader/MetaDataLoader.java`\n- New: `metadata/src/main/java/com/draagon/meta/update/MetaDataUpdateManager.java`\n\n**Problem**: Framework needs infrastructure for controlled metadata updates (central repository pushes, dynamic editing)\n\n**Solution**: Implement Copy-on-Write update mechanism with atomic swapping\n- Create MetaDataUpdateManager with volatile references\n- Support for metadata validation before updates\n- Atomic reference swapping to prevent partial state visibility\n- Cache invalidation strategies for updates\n- Observer pattern for update notifications\n\n**Success Criteria**:\n- [ ] Create MetaDataUpdateManager class with volatile references\n- [ ] Implement atomic metadata swapping mechanism\n- [ ] Add metadata validation pipeline for updates\n- [ ] Create cache invalidation strategies\n- [ ] Add observer pattern for change notifications\n- [ ] Ensure zero reader impact during updates (atomic swap)\n- [ ] Support rollback capability for failed updates\n- [ ] Integration tests for update scenarios\n\n**Deferral Notes**: \n- Depends on HIGH-2 (Thread-Safety) completion first\n- User prioritized immediate OSGI compatibility over future dynamic update capabilities\n- Framework currently handles static metadata loading perfectly\n- Will implement when dynamic update use cases become concrete requirements\n\n**Architecture Notes**: Foundation for future central repository pushes and dynamic editing capabilities\n\n---\n\n### HIGH-4: OSGI Bundle Lifecycle Compatibility Review\n**Status**: ‚úÖ COMPLETED (2025-09-19)  \n**Effort**: 3-4 hours  \n**Files**: \n- `metadata/src/main/java/com/draagon/meta/type/MetaDataTypeRegistry.java`\n- `metadata/src/main/java/com/draagon/meta/registry/ServiceRegistryFactory.java`\n- `metadata/src/main/java/com/draagon/meta/registry/OSGIServiceRegistry.java`\n- `metadata/src/main/java/com/draagon/meta/registry/StandardServiceRegistry.java`\n- New: `metadata/src/main/java/com/draagon/meta/registry/osgi/BundleLifecycleManager.java`\n\n**Problem**: Service discovery may not properly handle OSGI bundle dynamics with metadata updates\n\n**Solution**: Verify and enhance OSGI compatibility\n- Ensure proper bundle lifecycle listeners\n- Verify WeakReference usage for classloader cleanup\n- Test bundle unload/reload scenarios\n\n**Success Criteria**:\n- [x] Review ServiceLoader usage for OSGI compatibility\n- [x] Add bundle lifecycle event handling if missing\n- [x] Verify WeakReference patterns for classloader cleanup\n- [x] Test metadata persistence through bundle reload cycles\n- [x] Document OSGI deployment patterns\n\n**Completion Notes**:\n- Enhanced OSGIServiceRegistry with ServiceTracker-based discovery and proper ServiceReference cleanup\n- Implemented WeakReference patterns in StandardServiceRegistry for ClassLoader cleanup\n- Created BundleLifecycleManager with BundleListener implementation using reflection (zero compile-time OSGI dependencies)\n- Added bundle-aware MetaDataTypeRegistry instances with WeakReference cleanup\n- Comprehensive test suite: OSGILifecycleTest and ServiceReferenceLeakTest with mock OSGI classes\n- All 208 tests passing across all modules after integration\n\n**Architecture Notes**: Essential for OSGI environments - WeakHashMap design depends on this\n\n---\n\n### HIGH-5: Exception Hierarchy Consolidation\n**Status**: ‚úÖ COMPLETED (2025-09-19)  \n**Effort**: 3-4 hours (Actual: 2.5 hours)  \n**Files**: `metadata/src/main/java/com/draagon/meta/*Exception.java` (15+ files)\n\n**Problem**: Fragmented exception hierarchy with inconsistent patterns\n- `MetaDataNotFoundException` vs `MetaFieldNotFoundException` vs `MetaAttributeNotFoundException`\n- Inconsistent error context builders\n- Mixed checked/unchecked exception patterns\n\n**Solution**: Create unified exception hierarchy\n```java\n// Target structure:\nMetaDataException (base RuntimeException)\n‚îú‚îÄ‚îÄ MetaDataNotFoundException\n‚îú‚îÄ‚îÄ MetaDataLoadingException  \n‚îú‚îÄ‚îÄ ConstraintViolationException\n‚îî‚îÄ‚îÄ MetaDataConfigurationException\n```\n\n**Success Criteria**:\n- [x] Consolidate duplicate exception types\n- [x] Implement consistent error context builders\n- [x] Standardize on RuntimeException base with optional context\n- [x] Update all throw sites to use consolidated exceptions\n- [x] Maintain backward compatibility where possible\n\n**Completion Notes**:\n- Created MetaDataConfigurationException for configuration-related errors\n- Deprecated redundant exceptions (MetaFieldNotFoundException, MetaAttributeNotFoundException, etc.)\n- Enhanced factory methods for context-rich exception creation\n- Maintained backward compatibility through deprecation rather than removal\n\n**Architecture Notes**: Better error handling for framework-level operations\n\n---\n\n## üîß **MEDIUM PRIORITY** - Design Pattern Improvements\n\n### MEDIUM-1: Loading vs Runtime Phase Separation\n**Status**: üî≤ TODO  \n**Effort**: 5-6 hours  \n**Files**: \n- `metadata/src/main/java/com/draagon/meta/MetaDataBuilder.java`\n- `metadata/src/main/java/com/draagon/meta/object/MetaObjectBuilder.java`\n- `metadata/src/main/java/com/draagon/meta/field/MetaFieldBuilder.java`\n\n**Problem**: Validation and construction logic mixed throughout codebase\n\n**Solution**: Clear separation between loading (mutable) and runtime (immutable) phases\n- Builders only for loading phase\n- Runtime operations purely read-only\n- Validation during construction, not runtime\n\n**Success Criteria**:\n- [ ] Review all builder usage patterns\n- [ ] Ensure builders are only used during loading phase\n- [ ] Move validation logic to construction time\n- [ ] Create clear APIs for each phase\n- [ ] Document phase separation in JavaDoc\n\n**Architecture Notes**: Aligns with ClassLoader pattern of distinct loading vs usage\n\n---\n\n### MEDIUM-2: Cache Key Strategy Optimization\n**Status**: ‚úÖ COMPLETED (2025-09-19)  \n**Effort**: 2-3 hours (Actual: 2 hours)  \n**Files**: `metadata/src/main/java/com/draagon/meta/cache/HybridCache.java`\n\n**Problem**: String-based cache keys may not be optimal for permanent object references\n\n**Solution**: Optimize cache keys for permanent object lifecycle\n- Use object identity-based keys where appropriate\n- Implement canonical string interning for repeated keys\n- Optimize for permanent reference patterns\n\n**Success Criteria**:\n- [x] Review current cache key strategies\n- [x] Implement object identity-based keys where beneficial\n- [x] Add string interning for repeated cache keys\n- [x] Measure memory usage improvement\n- [x] Maintain WeakHashMap behavior for OSGI compatibility\n\n**Completion Notes**:\n- Added object identity-based cache for MetaData objects\n- Implemented string interning for frequently used keys\n- Created dual cache strategy (ConcurrentHashMap + WeakHashMap + IdentityCache)\n- Added optimization statistics and manual optimization methods\n\n**Architecture Notes**: Optimizes for permanent object references like Class objects\n\n---\n\n### MEDIUM-3: Metadata Versioning and Compatibility System üöÄ NEW\n**Status**: üî≤ TODO  \n**Effort**: 4-5 hours  \n**Files**: \n- New: `metadata/src/main/java/com/draagon/meta/version/MetaDataVersion.java`\n- `metadata/src/main/java/com/draagon/meta/loader/MetaDataLoader.java`\n\n**Problem**: Dynamic updates need version tracking and compatibility checking\n\n**Solution**: Implement metadata versioning system for safe updates\n- Version metadata objects with semantic versioning\n- Compatibility checking before updates\n- Migration strategies for breaking changes\n- Rollback capability based on versions\n\n**Success Criteria**:\n- [ ] Create MetaDataVersion class with semantic versioning\n- [ ] Add version tracking to all MetaData objects\n- [ ] Implement compatibility checking algorithms\n- [ ] Create migration strategy framework\n- [ ] Add rollback capability using version history\n- [ ] Version-aware update validation\n- [ ] Documentation for version management best practices\n\n**Architecture Notes**: Supports safe dynamic updates with rollback capability\n\n---\n\n### MEDIUM-4: Complex Method Extraction\n**Status**: ‚úÖ COMPLETED (2025-09-19)  \n**Effort**: 4-5 hours (Actual: 1.5 hours)  \n**Files**: \n- `metadata/src/main/java/com/draagon/meta/loader/MetaDataLoader.java:451+` (`performInitializationInternal`)\n- `metadata/src/main/java/com/draagon/meta/MetaData.java:862+` (`addChildren`)\n\n**Problem**: Methods exceed 50+ lines with complex logic\n\n**Solution**: Extract smaller, focused methods using appropriate patterns\n- Strategy pattern for complex operations\n- Command pattern for initialization sequences\n- Single responsibility principle\n\n**Success Criteria**:\n- [x] Extract `performInitializationInternal` into focused methods\n- [x] Simplify `addChildren` with functional approach\n- [x] Create service classes for complex operations\n- [x] Improve testability through smaller methods\n- [x] Maintain existing behavior and performance\n\n**Completion Notes**:\n- Refactored `performInitializationInternal` into 8 focused single-responsibility methods\n- Transformed `addChildren` to use Stream API with functional filters\n- Each extracted method has clear purpose and improved testability\n- All tests pass, performance maintained\n\n**Architecture Notes**: Improves maintainability without affecting runtime performance\n\n---\n\n### MEDIUM-5: String Operations Optimization\n**Status**: ‚úÖ COMPLETED (2025-09-19)  \n**Effort**: 2-3 hours (Actual: 1.5 hours)  \n**Files**: Multiple files with string operations\n\n**Problem**: Heavy string concatenation and mixed constant usage\n\n**Solution**: Optimize string operations\n- Use `String.format()` for complex formatting\n- Consolidate constants in dedicated class\n- Implement proper `toString()` methods\n\n**Success Criteria**:\n- [x] Replace StringBuilder chains with String.format()\n- [x] Create `MetaDataConstants` class for string constants\n- [x] Standardize toString() implementations\n- [x] Measure performance improvement\n- [x] Maintain readability\n\n**Completion Notes**:\n- Created comprehensive MetaDataConstants class with 50+ constants and helper methods\n- Replaced StringBuilder chains in ErrorFormatter and MetaDataTypeRegistry with String.format()\n- Standardized display values (DISPLAY_NULL, DISPLAY_EMPTY, DISPLAY_NONE)\n- Enhanced string formatting with consistent patterns\n\n**Architecture Notes**: Performance optimization that doesn't affect architecture\n\n---\n\n## üìã **LOW PRIORITY** - Clean-up & Optimization\n\n### LOW-1: TODO and Legacy Code Cleanup\n**Status**: ‚úÖ COMPLETED (2025-09-19)  \n**Effort**: 3-4 hours (Actual: 1 hour)  \n**Files**: 18+ files with TODO comments (see grep results)\n\n**Problem**: 18+ TODO comments and incomplete implementations\n\n**Solution**: Complete or remove TODO implementations\n- Complete actionable TODOs\n- Remove obsolete TODOs  \n- Create GitHub issues for future enhancements\n- Remove deprecated methods with migration path\n\n**Success Criteria**:\n- [x] Review all 18 TODO comments\n- [x] Complete or remove each TODO\n- [x] Create GitHub issues for future work\n- [x] Remove deprecated methods with clear migration documentation\n- [x] Clean up obsolete comments\n\n**Completion Notes**:\n- Cleaned up 8 major TODO comments across key files\n- Implemented Character.toUpperCase() optimization in PojoMetaObject\n- Replaced obsolete IDE template comments with proper copyright headers\n- Converted TODOs to architectural documentation where appropriate\n- Enhanced ProxyObject validation documentation\n\n**Architecture Notes**: Code cleanliness improvement\n\n---\n\n### LOW-2: JavaDoc and Documentation Enhancement\n**Status**: ‚úÖ COMPLETED (2025-01-27)  \n**Effort**: 4-6 hours (Actual: 2 hours)  \n**Files**: All public API classes\n\n**Problem**: Inconsistent documentation quality\n\n**Solution**: Comprehensive JavaDoc enhancement\n- Add missing @param and @return documentation\n- Include usage examples for complex APIs\n- Update version information\n\n**Success Criteria**:\n- [x] Review all public API documentation\n- [x] Add comprehensive JavaDoc for public methods\n- [x] Include code examples where appropriate\n- [x] Update copyright and version information\n- [x] Generate documentation and verify quality\n\n**Completion Notes**:\n- Enhanced class-level JavaDoc for core classes: MetaData, MetaDataLoader, MetaField\n- Added comprehensive method documentation with @param, @return, @see, @since tags\n- Included practical usage examples showcasing the READ-OPTIMIZED architecture\n- Emphasized architectural patterns (ClassLoader analogy, loading vs runtime phases)\n- Added proper copyright headers to key files (MetaData.java, MetaField.java)\n- Updated version information to 6.0.0 for enhanced documentation\n- All tests continue to pass after documentation improvements\n\n**Architecture Notes**: Significantly improved developer experience with architecture-aligned documentation\n\n---\n\n### LOW-3: Performance Profiling and Optimization\n**Status**: üî≤ TODO  \n**Effort**: 3-4 hours  \n**Files**: Various performance-sensitive areas\n\n**Problem**: Potential performance anti-patterns\n\n**Solution**: Identify and fix performance issues\n- Profile excessive synchronization\n- Optimize string operations in loops\n- Review Optional wrapper chains\n\n**Success Criteria**:\n- [ ] Create performance benchmark tests\n- [ ] Profile current performance characteristics\n- [ ] Identify optimization opportunities\n- [ ] Implement optimizations without affecting behavior\n- [ ] Verify performance improvements\n\n**Architecture Notes**: Must respect LOAD-ONCE IMMUTABLE performance characteristics\n\n---\n\n### LOW-4: Test Infrastructure Improvements\n**Status**: üî≤ TODO  \n**Effort**: 2-3 hours  \n**Files**: Test-related code mixed with production\n\n**Problem**: Testing concerns mixed with business logic\n\n**Solution**: Clean separation of test utilities\n- Move test-specific code to test packages\n- Add proper validation with meaningful messages\n- Create dedicated test fixtures\n\n**Success Criteria**:\n- [ ] Identify test-specific code in production classes\n- [ ] Move test utilities to appropriate test packages\n- [ ] Add proper validation for production use\n- [ ] Create test builders and fixtures\n- [ ] Ensure clean separation of concerns\n\n**Architecture Notes**: Better production stability\n\n---\n\n## üèÅ **Completion Guidelines**\n\n### **When Starting an Item:**\n1. Read `.claude/CLAUDE.md` for architectural context\n2. Update status to üîÑ IN_PROGRESS\n3. Create tests for the area you're modifying\n4. Follow architectural guidelines strictly\n\n### **Before Marking Complete:**\n1. All success criteria must be met\n2. All existing tests must pass\n3. Code must follow architectural patterns\n4. Add completion date and notes\n5. Update status to ‚úÖ COMPLETED\n\n### **Architecture Compliance Check:**\n- Does it respect the READ-OPTIMIZED WITH CONTROLLED MUTABILITY pattern?\n- Does it maintain OSGI compatibility?\n- Does it optimize for read-heavy workloads (99.9% reads, 0.1% updates)?\n- Does it preserve WeakHashMap design decisions?\n- Does it support future dynamic metadata updates without blocking readers?\n\n---\n\n**Last Updated**: 2025-09-19  \n**Next Review**: After completing HIGH priority items  \n\n---\n\n## üîÑ **DYNAMIC UPDATE CAPABILITY NOTES**\n\n**Architecture Evolution**: The framework has evolved from pure LOAD-ONCE IMMUTABLE to READ-optimized with controlled mutability to support future requirements:\n\n1. **Central Repository Pushes**: Metadata server pushes updated model definitions\n2. **Dynamic Editors**: Live system behavior modification interfaces  \n3. **A/B Testing**: Runtime metadata switching for experiments\n4. **Version Updates**: Hot-swapping metadata during deployments\n\n**Implementation Priority**: HIGH-2, HIGH-3, and MEDIUM-3 are specifically designed to build this capability while maintaining the core read-optimized performance characteristics.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/docs/ENHANCEMENTS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "c85d95ffd9149e8f",
      "size_bytes": 22130,
      "created_at": "2026-01-02T20:42:12.430863"
    },
    {
      "doc_id": "local_metaobjects-core__claude_docs_persistence",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/docs/persistence.md",
      "content": "# MetaObjects Persistence Patterns\n\n**ObjectManager database integration for MetaObjects**\n\n---\n\n## Overview\n\nObjectManagerDB provides database persistence for MetaObjects-based applications with automatic table creation, CRUD operations, and query support.\n\n**Key Principle:** Metadata-driven database mapping.\n\n---\n\n## Core Components\n\n### ObjectManagerDB\n- Main persistence interface\n- Connection management\n- CRUD operations\n- Query execution\n\n### MetaIdentity\n- Defines primary keys\n- Generation strategies\n- Composite key support\n- Replaces deprecated MetaKey\n\n### Database Drivers\n- **DerbyDriver** - Apache Derby (embedded/network)\n- **PostgreSQLDriver** - PostgreSQL\n- **MySQLDriver** - MySQL/MariaDB\n- **OracleDriver** - Oracle Database\n\n---\n\n## MetaIdentity - MANDATORY for Persistence\n\n### ‚ö†Ô∏è CRITICAL REQUIREMENT\n\n**All persistent objects MUST have MetaIdentity metadata.**\n\nWithout it, ObjectManagerDB fails with \"Attempt to modify an identity column\" errors.\n\n### Simple Primary Key\n\n```json\n{\n  \"object\": {\n    \"name\": \"User\",\n    \"subType\": \"managed\",\n    \"@dbTable\": \"users\",\n    \"children\": [\n      {\n        \"field\": {\n          \"name\": \"id\",\n          \"subType\": \"long\",\n          \"@dbColumn\": \"user_id\"\n        }\n      },\n      {\n        \"identity\": {\n          \"name\": \"user_pk\",\n          \"subType\": \"primary\",\n          \"fields\": [\"id\"],\n          \"@generation\": \"increment\"\n        }\n      }\n    ]\n  }\n}\n```\n\n**Key Points:**\n- `subType`: \"primary\" (required)\n- `fields`: Array of field names\n- `@generation`: How ID is generated\n\n### Composite Primary Key\n\n```json\n{\n  \"object\": {\n    \"name\": \"UserRole\",\n    \"subType\": \"managed\",\n    \"children\": [\n      {\n        \"field\": {\"name\": \"userId\", \"subType\": \"long\"}\n      },\n      {\n        \"field\": {\"name\": \"roleId\", \"subType\": \"long\"}\n      },\n      {\n        \"identity\": {\n          \"name\": \"user_role_pk\",\n          \"subType\": \"primary\",\n          \"fields\": [\"userId\", \"roleId\"],\n          \"@generation\": \"assigned\"\n        }\n      }\n    ]\n  }\n}\n```\n\n---\n\n## Generation Strategies\n\n### Auto-Increment\n\n```json\n{\n  \"identity\": {\n    \"name\": \"pk\",\n    \"subType\": \"primary\",\n    \"fields\": [\"id\"],\n    \"@generation\": \"increment\"\n  }\n}\n```\n\n**Database mapping:**\n- PostgreSQL: `SERIAL` or `IDENTITY`\n- MySQL: `AUTO_INCREMENT`\n- Oracle: `IDENTITY COLUMN` or sequence\n- Derby: `GENERATED ALWAYS AS IDENTITY`\n\n### UUID/GUID\n\n```json\n{\n  \"identity\": {\n    \"name\": \"pk\",\n    \"subType\": \"primary\",\n    \"fields\": [\"id\"],\n    \"@generation\": \"uuid\"\n  }\n}\n```\n\n**Application-generated UUID before insert.**\n\n### Assigned\n\n```json\n{\n  \"identity\": {\n    \"name\": \"pk\",\n    \"subType\": \"primary\",\n    \"fields\": [\"id\"],\n    \"@generation\": \"assigned\"\n  }\n}\n```\n\n**Application must set ID before insert.**\n\n### Natural Key (No Generation)\n\n```json\n{\n  \"identity\": {\n    \"name\": \"pk\",\n    \"subType\": \"primary\",\n    \"fields\": [\"username\"]\n  }\n}\n```\n\n**No `@generation` attribute - natural key.**\n\n---\n\n## Database Mapping Attributes\n\n### Object Level\n\n```json\n{\n  \"object\": {\n    \"name\": \"User\",\n    \"@dbTable\": \"USERS\",           // Table name\n    \"@dbSchema\": \"public\",         // Schema name (optional)\n    \"@dbCatalog\": \"mydb\"           // Catalog name (optional)\n  }\n}\n```\n\n### Field Level\n\n```json\n{\n  \"field\": {\n    \"name\": \"email\",\n    \"@dbColumn\": \"EMAIL_ADDRESS\",  // Column name\n    \"@dbType\": \"VARCHAR(255)\",     // SQL type override\n    \"@dbNullable\": false,          // NOT NULL constraint\n    \"@dbUnique\": true              // UNIQUE constraint\n  }\n}\n```\n\n### Identity Level\n\n```json\n{\n  \"identity\": {\n    \"name\": \"pk\",\n    \"@generation\": \"increment\",\n    \"@dbIndexName\": \"pk_users\",    // Index/constraint name\n    \"@dbClustered\": true           // Clustered index (SQL Server)\n  }\n}\n```\n\n---\n\n## ObjectManagerDB Setup\n\n### Basic Configuration\n\n```java\n// 1. Initialize MetaData Loader\nFileMetaDataLoader loader = new FileMetaDataLoader(options, \"myLoader\");\nloader.init();\nloader.register(); // Register for MetaDataUtil discovery\n\n// 2. Initialize Database\nEmbeddedDataSource dataSource = new EmbeddedDataSource();\ndataSource.setDatabaseName(\"memory:testdb\");\ndataSource.setCreateDatabase(\"create\");\n\n// 3. Initialize ObjectManagerDB\nObjectManagerDB objectManager = new ObjectManagerDB();\nobjectManager.setDriverClass(\"com.metaobjects.manager.db.driver.DerbyDriver\");\nobjectManager.setDataSource(dataSource);\n\n// 4. Auto-create tables\nMetaClassDBValidatorService validator = new MetaClassDBValidatorService();\nvalidator.setObjectManager(objectManager);\nvalidator.setAutoCreate(true);\n\nMetaDataLoaderRegistry registry = new MetaDataLoaderRegistry(ServiceRegistryFactory.getDefault());\nregistry.registerLoader(loader);\nvalidator.setMetaDataLoaderRegistry(registry);\nvalidator.init();\n```\n\n---\n\n## CRUD Operations\n\n### Create\n\n```java\nObjectConnection connection = objectManager.getConnection();\ntry {\n    User user = new User();\n    user.setMetaData(loader.getMetaObjectByName(\"User\")); // REQUIRED!\n    user.setUsername(\"john\");\n    user.setEmail(\"john@example.com\");\n\n    objectManager.createObject(connection, user);\n    // Auto-increment ID assigned by database\n    System.out.println(\"Created user with ID: \" + user.getId());\n} finally {\n    connection.close();\n}\n```\n\n### Read\n\n```java\nObjectConnection connection = objectManager.getConnection();\ntry {\n    User user = (User) objectManager.getObject(connection, User.class, userId);\n    System.out.println(\"Found: \" + user.getUsername());\n} finally {\n    connection.close();\n}\n```\n\n### Update\n\n```java\nObjectConnection connection = objectManager.getConnection();\ntry {\n    User user = (User) objectManager.getObject(connection, User.class, userId);\n    user.setEmail(\"newemail@example.com\");\n    objectManager.updateObject(connection, user);\n} finally {\n    connection.close();\n}\n```\n\n### Delete\n\n```java\nObjectConnection connection = objectManager.getConnection();\ntry {\n    User user = (User) objectManager.getObject(connection, User.class, userId);\n    objectManager.destroyObject(connection, user);\n} finally {\n    connection.close();\n}\n```\n\n---\n\n## Query Patterns\n\n### By Primary Key\n\n```java\nUser user = (User) objectManager.getObject(connection, User.class, userId);\n```\n\n### By Query\n\n```java\nQueryBuilder query = objectManager.getQueryBuilder(User.class);\nquery.where(\"email = ?\", \"john@example.com\");\n\nList<User> users = objectManager.query(connection, query);\n```\n\n### Count\n\n```java\nlong count = objectManager.count(connection, User.class);\n```\n\n---\n\n## Database Overlay Pattern\n\n**Separate database config from core metadata:**\n\n### base-metadata.json\n```json\n{\n  \"object\": {\n    \"name\": \"Store\",\n    \"subType\": \"managed\",\n    \"children\": [\n      {\"field\": {\"name\": \"id\", \"subType\": \"long\"}},\n      {\"identity\": {\"name\": \"store_pk\", \"subType\": \"primary\", \"fields\": [\"id\"]}}\n    ]\n  }\n}\n```\n\n### db-overlay.json\n```json\n{\n  \"object\": {\n    \"name\": \"Store\",\n    \"@dbTable\": \"STORE\",\n    \"children\": [\n      {\"field\": {\"name\": \"id\", \"@dbColumn\": \"ID\"}},\n      {\"identity\": {\"name\": \"store_pk\", \"@generation\": \"increment\", \"@dbIndexName\": \"pk_store\"}}\n    ]\n  }\n}\n```\n\n**Load both:**\n```java\nloader.addSourceURI(URI.create(\"base-metadata.json\"));\nloader.addSourceURI(URI.create(\"db-overlay.json\")); // Overlays attributes\n```\n\n---\n\n## Common Patterns\n\n### ‚ùå INCORRECT - Deprecated Patterns\n\n**DON'T use @isPrimaryKey:**\n```json\n{\"field\": {\"name\": \"id\", \"@isPrimaryKey\": true}}  // ‚ùå Deprecated\n```\n\n**DON'T use MetaKey:**\n```json\n{\"key\": {\"name\": \"primary\", \"@keys\": [\"id\"]}}  // ‚ùå Use MetaIdentity\n```\n\n**DON'T use field-level @autoIncrementStrategy:**\n```json\n{\"field\": {\"name\": \"id\", \"@autoIncrementStrategy\": \"sequential\"}}  // ‚ùå Use MetaIdentity @generation\n```\n\n### ‚úÖ CORRECT - Current Pattern\n\n**Use MetaIdentity:**\n```json\n{\n  \"identity\": {\n    \"name\": \"pk\",\n    \"subType\": \"primary\",\n    \"fields\": [\"id\"],\n    \"@generation\": \"increment\"\n  }\n}\n```\n\n---\n\n## Critical Requirements\n\n### Before Persistence Operations\n\n1. **MetaIdentity Required**\n   - All objects MUST have MetaIdentity\n   - Must be `subType=\"primary\"`\n   - Must specify `@generation` for auto-generated IDs\n\n2. **setMetaData() Required**\n   ```java\n   user.setMetaData(loader.getMetaObjectByName(\"User\"));\n   ```\n\n3. **Registry Connection**\n   - Tests MUST use MetaDataLoaderRegistry\n   - Connects services to loaders\n\n---\n\n## Database Type Mappings\n\n| MetaObjects | PostgreSQL | MySQL | SQL Server | Oracle |\n|-------------|-----------|-------|------------|--------|\n| string | VARCHAR | VARCHAR | VARCHAR | VARCHAR2 |\n| int | INTEGER | INT | INT | NUMBER(10) |\n| long | BIGINT | BIGINT | BIGINT | NUMBER(19) |\n| float | REAL | FLOAT | REAL | FLOAT(24) |\n| double | DOUBLE PRECISION | DOUBLE | FLOAT | FLOAT(53) |\n| decimal | DECIMAL(19,2) | DECIMAL(19,2) | DECIMAL(19,2) | NUMBER(19,2) |\n| boolean | BOOLEAN | TINYINT(1) | BIT | NUMBER(1) |\n| date | DATE | DATE | DATE | DATE |\n| timestamp | TIMESTAMP | DATETIME | DATETIME2 | TIMESTAMP |\n| binary | BYTEA | BLOB | VARBINARY | BLOB |\n\n---\n\n## Testing\n\n### Example Test\n\n```java\n@Test\npublic void testPersistence() throws Exception {\n    ObjectConnection conn = objectManager.getConnection();\n    try {\n        // Create\n        User user = new User();\n        user.setMetaData(loader.getMetaObjectByName(\"User\"));\n        user.setUsername(\"test\");\n        objectManager.createObject(conn, user);\n\n        Long id = user.getId();\n        assertNotNull(id);\n\n        // Read\n        User loaded = (User) objectManager.getObject(conn, User.class, id);\n        assertEquals(\"test\", loaded.getUsername());\n\n        // Update\n        loaded.setUsername(\"updated\");\n        objectManager.updateObject(conn, loaded);\n\n        // Verify\n        User updated = (User) objectManager.getObject(conn, User.class, id);\n        assertEquals(\"updated\", updated.getUsername());\n\n        // Delete\n        objectManager.destroyObject(conn, updated);\n\n        // Verify deleted\n        User deleted = (User) objectManager.getObject(conn, User.class, id);\n        assertNull(deleted);\n    } finally {\n        conn.close();\n    }\n}\n```\n\n---\n\n## See Also\n\n- [type-system.md](type-system.md) - Field types and mappings\n- [testing.md](testing.md) - Unit test patterns\n- [SETUP.md](../SETUP.md) - Building and running tests\n\n---\n\n**Last Updated:** 2025-11-15\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/docs/persistence.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "def",
        "md",
        "query"
      ],
      "content_hash": "a19fed15ef8f6b80",
      "size_bytes": 10306,
      "created_at": "2026-01-02T20:42:12.431127"
    },
    {
      "doc_id": "local_metaobjects-core__claude_docs_ARCHITECTURAL_REFACTORING_PLAN",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/docs/ARCHITECTURAL_REFACTORING_PLAN.md",
      "content": "# ‚úÖ **COMPLETED** - MetaObjects Architectural Refactoring Implementation Plan\n\n## üéâ **COMPLETION STATUS: SUCCESS**\n\n**üöÄ ALL PHASES COMPLETED SUCCESSFULLY - September 21, 2025**\n\n- ‚úÖ **Phase 1: Preparation** - Completed\n- ‚úÖ **Phase 2: Codegen Modularization** - Completed (3 focused modules)\n- ‚úÖ **Phase 3: Spring Integration Restructuring** - Completed (core-spring, web-spring)  \n- ‚úÖ **Phase 4: Examples Structure** - Completed (4 working examples)\n- ‚úÖ **Phase 5: Cleanup & Documentation** - Completed (comprehensive docs)\n\n**RESULT**: **14 focused modules** with clean dependencies, **all tests passing**, **complete documentation**, and **Maven publishing ready**.\n\n---\n\n## üéØ **ORIGINAL OVERVIEW** *(Successfully Implemented)*\n\nThis document outlines the comprehensive architectural refactoring to create a modular, Maven-repository-ready structure for MetaObjects. The refactoring addresses:\n\n1. **Granular dependency management** for published libraries\n2. **Codegen module breakout** for specialized generators  \n3. **Proper Spring integration** at the core level\n4. **Example projects** demonstrating usage patterns\n5. **Industry-standard patterns** for Maven Central publishing\n\n## üèóÔ∏è **CURRENT vs PROPOSED ARCHITECTURE**\n\n### **Current Structure (Before Refactoring)**\n```\nmetaobjects/\n‚îú‚îÄ‚îÄ metadata/                    # Core metadata (no framework deps)\n‚îú‚îÄ‚îÄ spring/                     # Spring integration (depends on metadata) \n‚îú‚îÄ‚îÄ codegen/                    # All code generation (depends on metadata)\n‚îú‚îÄ‚îÄ maven-plugin/               # Maven plugin (depends on codegen)\n‚îú‚îÄ‚îÄ core/                       # Core functionality (depends on metadata only)\n‚îú‚îÄ‚îÄ om/, omdb/, omnosql/        # Object managers\n‚îú‚îÄ‚îÄ web/                        # Web components (depends on metadata + spring)\n‚îî‚îÄ‚îÄ demo/                       # Demo app (depends on web + spring)\n```\n\n### **Proposed Structure (After Refactoring)**\n```\nmetaobjects/\n‚îú‚îÄ‚îÄ metadata/                    # Core metadata (no framework deps)\n‚îú‚îÄ‚îÄ codegen-base/               # Base code generation (depends on metadata)\n‚îú‚îÄ‚îÄ codegen-mustache/           # Mustache generator (depends on codegen-base)\n‚îú‚îÄ‚îÄ codegen-plantuml/           # PlantUML generator (depends on codegen-base)\n‚îú‚îÄ‚îÄ maven-plugin/               # Maven plugin (depends on codegen-base)\n‚îú‚îÄ‚îÄ core/                       # Enhanced core (depends on metadata + maven-plugin + codegen-base)\n‚îú‚îÄ‚îÄ core-spring/                # Spring integration (depends on core)\n‚îú‚îÄ‚îÄ om/, omdb/, omnosql/        # Object managers\n‚îú‚îÄ‚îÄ web/                        # Web components (minimal deps)\n‚îú‚îÄ‚îÄ web-spring/                 # Web + Spring (depends on web + core-spring)\n‚îú‚îÄ‚îÄ demo/                       # Demo app (depends on web-spring)\n‚îî‚îÄ‚îÄ examples/\n    ‚îú‚îÄ‚îÄ shared-resources/       # Common example metadata\n    ‚îú‚îÄ‚îÄ basic-example/          # Basic usage (depends on core + shared-resources)\n    ‚îú‚îÄ‚îÄ osgi-example/          # OSGI usage (depends on core + shared-resources)\n    ‚îî‚îÄ‚îÄ spring-example/        # Spring usage (depends on core-spring + shared-resources)\n```\n\n## üìã **DETAILED IMPLEMENTATION PHASES**\n\n### **Phase 1: Codegen Modularization**\n\n#### **Step 1.1: Create codegen-base module**\n\n**File:** `codegen-base/pom.xml`\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n<modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects</artifactId>\n        <version>5.2.0-SNAPSHOT</version>\n    </parent>\n  \n    <artifactId>metaobjects-codegen-base</artifactId>\n    <packaging>bundle</packaging>\n\n    <name>MetaObjects :: Code Generation :: Base</name>\n    <description>Base code generation framework for MetaObjects</description>\n\n    <dependencies>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-metadata</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n    </dependencies>\n</project>\n```\n\n**Content to move from current codegen:**\n- Base generator interfaces: `Generator.java`, `TemplateEngine.java`\n- Abstract base classes: `AbstractGenerator.java`, `BaseTemplateGenerator.java`  \n- Common utilities: `FileWriter.java`, `GeneratorUtil.java`\n- MetaDataFile generators: `MetaDataFileJsonSchemaGenerator.java`, `MetaDataFileXSDGenerator.java`\n- Core generation framework classes\n- **Keep common, reusable generation logic**\n\n**Content to NOT move (stays in specific modules):**\n- Mustache-specific code\n- PlantUML-specific code  \n- Framework-specific generators\n\n#### **Step 1.2: Create codegen-mustache module**\n\n**File:** `codegen-mustache/pom.xml`\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n<modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects</artifactId>\n        <version>5.2.0-SNAPSHOT</version>\n    </parent>\n  \n    <artifactId>metaobjects-codegen-mustache</artifactId>\n    <packaging>bundle</packaging>\n\n    <name>MetaObjects :: Code Generation :: Mustache</name>\n    <description>Mustache template-based code generation for MetaObjects</description>\n\n    <dependencies>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-codegen-base</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>com.github.spullara.mustache.java</groupId>\n            <artifactId>compiler</artifactId>\n            <version>0.9.14</version>\n        </dependency>\n    </dependencies>\n</project>\n```\n\n**Content to move from current codegen:**\n- `com.metaobjects.generator.mustache.MustacheTemplateEngine`\n- `com.metaobjects.generator.mustache.MustacheTemplateGenerator`\n- `com.metaobjects.generator.mustache.HelperRegistry`\n- All Mustache helper classes and utilities\n- Mustache-specific test files\n- Mustache template resources\n\n#### **Step 1.3: Create codegen-plantuml module**\n\n**File:** `codegen-plantuml/pom.xml`\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n<modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects</artifactId>\n        <version>5.2.0-SNAPSHOT</version>\n    </parent>\n  \n    <artifactId>metaobjects-codegen-plantuml</artifactId>\n    <packaging>bundle</packaging>\n\n    <name>MetaObjects :: Code Generation :: PlantUML</name>\n    <description>PlantUML diagram generation for MetaObjects</description>\n\n    <dependencies>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-codegen-base</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>net.sourceforge.plantuml</groupId>\n            <artifactId>plantuml</artifactId>\n            <version>1.2024.6</version>\n        </dependency>\n    </dependencies>\n</project>\n```\n\n**Content to move from current codegen:**\n- Any existing PlantUML-specific generators\n- UML diagram generation utilities\n- PlantUML template processing\n\n#### **Step 1.4: Update dependent modules**\n\n**Update maven-plugin/pom.xml:**\n```xml\n<dependency>\n    <groupId>com.draagon</groupId>\n    <artifactId>metaobjects-codegen-base</artifactId>\n    <version>${project.version}</version>\n</dependency>\n<!-- Add specific generators as needed -->\n<dependency>\n    <groupId>com.draagon</groupId>\n    <artifactId>metaobjects-codegen-mustache</artifactId>\n    <version>${project.version}</version>\n</dependency>\n```\n\n### **Phase 2: Core Enhancement**\n\n#### **Step 2.1: Update core module dependencies**\n\n**Update core/pom.xml:**\n```xml\n<dependencies>\n    <dependency>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects-metadata</artifactId>\n        <version>${project.version}</version>\n    </dependency>\n    <dependency>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects-codegen-base</artifactId>\n        <version>${project.version}</version>\n    </dependency>\n    <dependency>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects-maven-plugin</artifactId>\n        <version>${project.version}</version>\n    </dependency>\n    <!-- Existing dependencies -->\n</dependencies>\n```\n\n### **Phase 3: Spring Integration Restructuring**\n\n#### **Step 3.1: Create core-spring module**\n\n**File:** `core-spring/pom.xml`\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n<modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects</artifactId>\n        <version>5.2.0-SNAPSHOT</version>\n    </parent>\n  \n    <artifactId>metaobjects-core-spring</artifactId>\n    <packaging>bundle</packaging>\n\n    <name>MetaObjects :: Core :: Spring Integration</name>\n    <description>Spring Framework integration for MetaObjects Core</description>\n\n    <dependencies>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-core</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        \n        <!-- Spring Framework dependencies -->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-context</artifactId>\n            <version>5.3.31</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-autoconfigure</artifactId>\n            <version>2.7.18</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n            <version>5.3.31</version>\n        </dependency>\n        \n        <!-- Test Dependencies -->\n        <dependency>\n            <groupId>junit</groupId>\n            <artifactId>junit</artifactId>\n            <version>${junit.version}</version>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-test</artifactId>\n            <version>5.3.31</version>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n</project>\n```\n\n**Content to move from current spring module:**\n- `com.metaobjects.spring.MetaDataAutoConfiguration`\n- `com.metaobjects.spring.MetaDataService` \n- `com.metaobjects.spring.MetaDataLoaderConfiguration`\n- All Spring integration test files\n- Spring auto-configuration resources\n\n#### **Step 3.2: Create web-spring module**\n\n**File:** `web-spring/pom.xml`\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n<modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects</artifactId>\n        <version>5.2.0-SNAPSHOT</version>\n    </parent>\n  \n    <artifactId>metaobjects-web-spring</artifactId>\n    <packaging>bundle</packaging>\n\n    <name>MetaObjects :: Web :: Spring Integration</name>\n    <description>Spring Web integration for MetaObjects</description>\n\n    <dependencies>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-web</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-core-spring</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        \n        <!-- Spring Web dependencies -->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-webmvc</artifactId>\n            <version>5.3.31</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n            <version>2.7.18</version>\n        </dependency>\n    </dependencies>\n</project>\n```\n\n**Content to include:**\n- Spring-specific web controllers and auto-configuration\n- Web-specific Spring Boot starters\n- Spring MVC integration utilities\n\n#### **Step 3.3: Update dependent modules**\n\n**Update web/pom.xml** - Remove Spring dependencies:\n```xml\n<!-- Remove these Spring dependencies -->\n<!-- <dependency>\n    <groupId>org.springframework</groupId>\n    <artifactId>spring-beans</artifactId>\n</dependency> -->\n```\n\n**Update demo/pom.xml** - Use web-spring:\n```xml\n<dependency>\n    <groupId>com.draagon</groupId>\n    <artifactId>metaobjects-web-spring</artifactId>\n    <version>${project.version}</version>\n</dependency>\n<!-- Remove direct Spring dependencies - they come transitively -->\n```\n\n### **Phase 4: Examples Structure**\n\n#### **Step 4.1: Create examples parent module**\n\n**File:** `examples/pom.xml`\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n<modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects</artifactId>\n        <version>5.2.0-SNAPSHOT</version>\n    </parent>\n  \n    <artifactId>metaobjects-examples</artifactId>\n    <packaging>pom</packaging>\n\n    <name>MetaObjects :: Examples</name>\n    <description>Example projects demonstrating MetaObjects usage patterns</description>\n\n    <modules>\n        <module>shared-resources</module>\n        <module>basic-example</module>\n        <module>osgi-example</module>\n        <module>spring-example</module>\n    </modules>\n</project>\n```\n\n#### **Step 4.2: Create shared-resources module**\n\n**File:** `examples/shared-resources/pom.xml`\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n<modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects-examples</artifactId>\n        <version>5.2.0-SNAPSHOT</version>\n    </parent>\n  \n    <artifactId>metaobjects-examples-shared</artifactId>\n    <packaging>jar</packaging>\n\n    <name>MetaObjects :: Examples :: Shared Resources</name>\n    <description>Common metadata and templates for all examples</description>\n\n    <!-- No dependencies - this is just resources -->\n</project>\n```\n\n**File:** `examples/shared-resources/src/main/resources/metadata/examples-metadata.json`\n```json\n{\n  \"metadata\": {\n    \"package\": \"com_example_model\",\n    \"children\": [\n      {\n        \"object\": {\n          \"name\": \"User\",\n          \"type\": \"pojo\",\n          \"@dbTable\": \"users\",\n          \"children\": [\n            {\n              \"field\": {\n                \"name\": \"id\",\n                \"type\": \"long\",\n                \"@required\": true,\n                \"@dbColumn\": \"user_id\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"username\", \n                \"type\": \"string\",\n                \"@required\": true,\n                \"@maxLength\": 50,\n                \"@dbColumn\": \"username\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"email\",\n                \"type\": \"string\", \n                \"@required\": true,\n                \"@maxLength\": 255,\n                \"@dbColumn\": \"email\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"createdDate\",\n                \"type\": \"timestamp\",\n                \"@dbColumn\": \"created_date\"\n              }\n            }\n          ]\n        }\n      },\n      {\n        \"object\": {\n          \"name\": \"Product\",\n          \"type\": \"pojo\",\n          \"@dbTable\": \"products\",\n          \"children\": [\n            {\n              \"field\": {\n                \"name\": \"id\",\n                \"type\": \"long\",\n                \"@required\": true,\n                \"@dbColumn\": \"product_id\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"name\",\n                \"type\": \"string\",\n                \"@required\": true,\n                \"@maxLength\": 100,\n                \"@dbColumn\": \"product_name\"\n              }\n            },\n            {\n              \"field\": {\n                \"name\": \"price\",\n                \"type\": \"double\",\n                \"@required\": true,\n                \"@dbColumn\": \"price\"\n              }\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n```\n\n**File:** `examples/shared-resources/src/main/resources/templates/basic-pojo.mustache`\n```mustache\npackage {{package}};\n\n{{#imports}}\nimport {{.}};\n{{/imports}}\n\n/**\n * {{description}}\n * \n * Generated by MetaObjects - do not modify manually\n */\npublic class {{className}} {\n    \n    {{#fields}}\n    private {{javaType}} {{fieldName}};\n    {{/fields}}\n    \n    // Constructors\n    public {{className}}() {}\n    \n    {{#fields}}\n    // {{fieldName}} accessor methods\n    public {{javaType}} get{{capitalizedFieldName}}() {\n        return {{fieldName}};\n    }\n    \n    public void set{{capitalizedFieldName}}({{javaType}} {{fieldName}}) {\n        this.{{fieldName}} = {{fieldName}};\n    }\n    \n    {{/fields}}\n    \n    @Override\n    public String toString() {\n        return \"{{className}}{\" +\n        {{#fields}}\n            \"{{fieldName}}=\" + {{fieldName}} + {{#hasNext}}\",\" + {{/hasNext}}\n        {{/fields}}\n        \"}\";\n    }\n}\n```\n\n#### **Step 4.3: Create basic-example module**\n\n**File:** `examples/basic-example/pom.xml`\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n<modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects-examples</artifactId>\n        <version>5.2.0-SNAPSHOT</version>\n    </parent>\n  \n    <artifactId>metaobjects-example-basic</artifactId>\n    <packaging>jar</packaging>\n\n    <name>MetaObjects :: Examples :: Basic Usage</name>\n    <description>Basic MetaObjects usage without frameworks</description>\n\n    <dependencies>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-core</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-codegen-mustache</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-examples-shared</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n    </dependencies>\n</project>\n```\n\n**File:** `examples/basic-example/src/main/java/com/draagon/meta/examples/basic/BasicMetaObjectsExample.java`\n```java\npackage com.metaobjects.examples.basic;\n\nimport com.metaobjects.loader.simple.SimpleLoader;\nimport com.metaobjects.object.MetaObject;\nimport com.metaobjects.object.value.ValueObject;\nimport com.metaobjects.field.MetaField;\nimport com.metaobjects.generator.mustache.MustacheTemplateGenerator;\nimport com.metaobjects.ValidationResult;\n\nimport java.net.URI;\nimport java.util.Arrays;\n\n/**\n * Basic example demonstrating MetaObjects core functionality without any framework integration.\n * \n * This example shows:\n * 1. Loading metadata from JSON files\n * 2. Generating Java POJO classes using Mustache templates\n * 3. Working with metadata directly\n * 4. Creating and validating objects using metadata\n */\npublic class BasicMetaObjectsExample {\n    \n    public static void main(String[] args) {\n        try {\n            System.out.println(\"=== MetaObjects Basic Example ===\");\n            \n            // 1. Load metadata from shared resources\n            System.out.println(\"\\n1. Loading metadata...\");\n            SimpleLoader loader = new SimpleLoader(\"examples\");\n            \n            // Load from classpath (provided by shared-resources module)\n            URI metadataUri = BasicMetaObjectsExample.class\n                .getResource(\"/metadata/examples-metadata.json\").toURI();\n            loader.setSourceURIs(Arrays.asList(metadataUri));\n            loader.init();\n            \n            System.out.println(\"   Loaded \" + loader.getChildren().size() + \" metadata items\");\n            \n            // 2. Generate POJO classes using Mustache templates\n            System.out.println(\"\\n2. Generating Java POJO classes...\");\n            MustacheTemplateGenerator generator = new MustacheTemplateGenerator();\n            \n            // Generate to target/generated-sources directory\n            String outputDir = \"./target/generated-sources/java/\";\n            generator.setOutputDirectory(outputDir);\n            generator.setTemplatePath(\"/templates/basic-pojo.mustache\");\n            \n            // Generate classes for all MetaObjects\n            generator.generate(loader);\n            System.out.println(\"   Generated classes to: \" + outputDir);\n            \n            // 3. Work with metadata directly\n            System.out.println(\"\\n3. Working with metadata...\");\n            MetaObject userMeta = loader.getMetaObjectByName(\"User\");\n            System.out.println(\"   Found MetaObject: \" + userMeta.getName());\n            System.out.println(\"   Fields: \" + userMeta.getMetaFields().size());\n            \n            for (MetaField field : userMeta.getMetaFields()) {\n                System.out.println(\"     - \" + field.getName() + \" (\" + field.getSubTypeName() + \")\");\n            }\n            \n            // 4. Create and manipulate objects using metadata\n            System.out.println(\"\\n4. Creating and validating objects...\");\n            \n            // Create a user object\n            ValueObject user = ValueObject.builder()\n                .field(\"id\", 1L)\n                .field(\"username\", \"john_doe\")\n                .field(\"email\", \"john@example.com\")\n                .field(\"createdDate\", new java.util.Date())\n                .build();\n                \n            System.out.println(\"   Created user: \" + user);\n            \n            // Validate using metadata\n            ValidationResult result = userMeta.validate(user);\n            System.out.println(\"   Validation result: \" + \n                (result.isValid() ? \"VALID\" : \"INVALID\"));\n            \n            if (!result.isValid()) {\n                result.getErrors().forEach(error -> \n                    System.out.println(\"     Error: \" + error));\n            }\n            \n            // 5. Direct metadata manipulation examples\n            System.out.println(\"\\n5. Direct metadata access...\");\n            \n            MetaField emailField = userMeta.getMetaField(\"email\");\n            Object emailValue = emailField.getValue(user);\n            System.out.println(\"   Email field value: \" + emailValue);\n            \n            // Check field attributes\n            if (emailField.hasMetaAttr(\"required\")) {\n                boolean required = Boolean.parseBoolean(\n                    emailField.getMetaAttr(\"required\").getValueAsString());\n                System.out.println(\"   Email field is required: \" + required);\n            }\n            \n            if (emailField.hasMetaAttr(\"maxLength\")) {\n                int maxLength = Integer.parseInt(\n                    emailField.getMetaAttr(\"maxLength\").getValueAsString());\n                System.out.println(\"   Email field max length: \" + maxLength);\n            }\n            \n            System.out.println(\"\\n=== Example completed successfully ===\");\n            \n        } catch (Exception e) {\n            System.err.println(\"Error running example: \" + e.getMessage());\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n#### **Step 4.4: Create osgi-example module**\n\n**File:** `examples/osgi-example/pom.xml`\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n<modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects-examples</artifactId>\n        <version>5.2.0-SNAPSHOT</version>\n    </parent>\n  \n    <artifactId>metaobjects-example-osgi</artifactId>\n    <packaging>bundle</packaging>\n\n    <name>MetaObjects :: Examples :: OSGI Usage</name>\n    <description>MetaObjects usage in OSGI environments</description>\n\n    <dependencies>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-core</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-examples-shared</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        \n        <!-- OSGI dependencies -->\n        <dependency>\n            <groupId>org.osgi</groupId>\n            <artifactId>osgi.core</artifactId>\n            <version>8.0.0</version>\n            <scope>provided</scope>\n        </dependency>\n        <dependency>\n            <groupId>org.osgi</groupId>\n            <artifactId>osgi.cmpn</artifactId>\n            <version>8.0.0</version>\n            <scope>provided</scope>\n        </dependency>\n    </dependencies>\n</project>\n```\n\n**File:** `examples/osgi-example/src/main/java/com/draagon/meta/examples/osgi/OSGiMetaObjectsExample.java`\n```java\npackage com.metaobjects.examples.osgi;\n\nimport com.metaobjects.registry.MetaDataLoaderRegistry;\nimport com.metaobjects.registry.ServiceRegistryFactory;\nimport com.metaobjects.loader.MetaDataLoader;\nimport com.metaobjects.object.MetaObject;\n\nimport org.osgi.service.component.annotations.Component;\nimport org.osgi.service.component.annotations.Reference;\nimport org.osgi.service.component.annotations.Activate;\nimport org.osgi.service.component.annotations.Deactivate;\n\n/**\n * OSGI example demonstrating MetaObjects usage in bundle environments.\n * \n * This example shows:\n * 1. OSGI service discovery patterns\n * 2. Bundle lifecycle handling with WeakHashMap cleanup\n * 3. ServiceRegistry usage for environment auto-detection\n * 4. Proper resource management in dynamic environments\n */\n@Component(immediate = true)\npublic class OSGiMetaObjectsExample {\n    \n    @Reference\n    private MetaDataLoaderRegistry registry;\n    \n    @Activate\n    public void activate() {\n        System.out.println(\"=== MetaObjects OSGI Example Activated ===\");\n        \n        try {\n            demonstrateOSGiIntegration();\n        } catch (Exception e) {\n            System.err.println(\"Error in OSGI example: \" + e.getMessage());\n            e.printStackTrace();\n        }\n    }\n    \n    @Deactivate  \n    public void deactivate() {\n        System.out.println(\"=== MetaObjects OSGI Example Deactivated ===\");\n        \n        // Cleanup happens automatically via WeakHashMap patterns\n        // and OSGI service lifecycle management\n    }\n    \n    private void demonstrateOSGiIntegration() {\n        System.out.println(\"\\n1. OSGI Service Discovery...\");\n        \n        // The registry was injected via @Reference - shows OSGI service discovery\n        System.out.println(\"   MetaDataLoaderRegistry service discovered: \" + \n            (registry != null ? \"SUCCESS\" : \"FAILED\"));\n        \n        // Show ServiceRegistryFactory auto-detection\n        System.out.println(\"   ServiceRegistry type: \" + \n            ServiceRegistryFactory.getDefault().getClass().getSimpleName());\n        \n        // 2. Working with registered loaders\n        System.out.println(\"\\n2. Working with registered loaders...\");\n        \n        for (MetaDataLoader loader : registry.getDataLoaders()) {\n            System.out.println(\"   Found loader: \" + loader.getName());\n            \n            for (MetaObject metaObject : loader.getChildren(MetaObject.class)) {\n                System.out.println(\"     - MetaObject: \" + metaObject.getName());\n            }\n        }\n        \n        // 3. Demonstrate bundle lifecycle awareness\n        System.out.println(\"\\n3. Bundle lifecycle patterns...\");\n        \n        // Show WeakHashMap cleanup - computed caches can be GC'd\n        // when bundles unload, while core metadata remains\n        System.out.println(\"   Computed caches use WeakHashMap for bundle cleanup\");\n        System.out.println(\"   Core metadata uses strong references for permanence\");\n        \n        // 4. Environment detection\n        System.out.println(\"\\n4. Environment detection...\");\n        System.out.println(\"   OSGI environment detected: \" + \n            ServiceRegistryFactory.getDefault().getClass().getName().contains(\"OSGI\"));\n        \n        System.out.println(\"\\n=== OSGI Example completed ===\");\n    }\n}\n```\n\n#### **Step 4.5: Create spring-example module**\n\n**File:** `examples/spring-example/pom.xml`\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n<modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.draagon</groupId>\n        <artifactId>metaobjects-examples</artifactId>\n        <version>5.2.0-SNAPSHOT</version>\n    </parent>\n  \n    <artifactId>metaobjects-example-spring</artifactId>\n    <packaging>jar</packaging>\n\n    <name>MetaObjects :: Examples :: Spring Usage</name>\n    <description>MetaObjects usage with Spring Framework integration</description>\n\n    <dependencies>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-core-spring</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>com.draagon</groupId>\n            <artifactId>metaobjects-examples-shared</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        \n        <!-- Spring Boot -->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n            <version>2.7.18</version>\n        </dependency>\n    </dependencies>\n</project>\n```\n\n**File:** `examples/spring-example/src/main/java/com/draagon/meta/examples/spring/SpringMetaObjectsExample.java`\n```java\npackage com.metaobjects.examples.spring;\n\nimport com.metaobjects.spring.MetaDataService;\nimport com.metaobjects.loader.MetaDataLoader;\nimport com.metaobjects.registry.MetaDataLoaderRegistry;\nimport com.metaobjects.object.MetaObject;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.CommandLineRunner;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.context.annotation.Bean;\n\nimport java.net.URI;\nimport java.util.Arrays;\n\n/**\n * Spring example demonstrating MetaObjects integration with Spring Framework.\n * \n * This example shows:\n * 1. Spring auto-configuration of MetaObjects\n * 2. Dependency injection patterns\n * 3. MetaDataService wrapper usage\n * 4. Spring Boot integration\n */\n@SpringBootApplication\npublic class SpringMetaObjectsExample implements CommandLineRunner {\n    \n    // Option 1: Convenient service wrapper (recommended)\n    @Autowired\n    private MetaDataService metaDataService;\n    \n    // Option 2: Backward compatible loader injection\n    @Autowired\n    private MetaDataLoader primaryMetaDataLoader;\n    \n    // Option 3: Full registry access for advanced operations\n    @Autowired\n    private MetaDataLoaderRegistry metaDataLoaderRegistry;\n    \n    public static void main(String[] args) {\n        SpringApplication.run(SpringMetaObjectsExample.class, args);\n    }\n    \n    @Override\n    public void run(String... args) throws Exception {\n        System.out.println(\"=== MetaObjects Spring Example ===\");\n        \n        demonstrateSpringIntegration();\n    }\n    \n    private void demonstrateSpringIntegration() {\n        System.out.println(\"\\n1. Spring auto-configuration verification...\");\n        \n        // Verify all injection options work\n        System.out.println(\"   MetaDataService injected: \" + \n            (metaDataService != null ? \"SUCCESS\" : \"FAILED\"));\n        System.out.println(\"   Primary MetaDataLoader injected: \" + \n            (primaryMetaDataLoader != null ? \"SUCCESS\" : \"FAILED\"));  \n        System.out.println(\"   MetaDataLoaderRegistry injected: \" + \n            (metaDataLoaderRegistry != null ? \"SUCCESS\" : \"FAILED\"));\n        \n        // 2. Using MetaDataService (recommended approach)\n        System.out.println(\"\\n2. Using MetaDataService wrapper...\");\n        \n        // Get all available MetaObjects\n        var allObjects = metaDataService.getAllMetaObjects();\n        System.out.println(\"   Found \" + allObjects.size() + \" MetaObjects via service\");\n        \n        for (MetaObject obj : allObjects) {\n            System.out.println(\"     - \" + obj.getName());\n        }\n        \n        // Optional-based null-safe access\n        var userMeta = metaDataService.findMetaObjectByNameOptional(\"User\");\n        if (userMeta.isPresent()) {\n            System.out.println(\"   User MetaObject found via optional access\");\n        }\n        \n        // Check if specific objects exist\n        boolean hasUser = metaDataService.metaObjectExists(\"User\");\n        boolean hasProduct = metaDataService.metaObjectExists(\"Product\");\n        System.out.println(\"   User exists: \" + hasUser + \", Product exists: \" + hasProduct);\n        \n        // 3. Backward compatible loader access\n        System.out.println(\"\\n3. Backward compatible loader access...\");\n        System.out.println(\"   Primary loader name: \" + primaryMetaDataLoader.getName());\n        System.out.println(\"   Primary loader objects: \" + \n            primaryMetaDataLoader.getChildren(MetaObject.class).size());\n        \n        // 4. Advanced registry operations\n        System.out.println(\"\\n4. Advanced registry operations...\");\n        System.out.println(\"   Total registered loaders: \" + \n            metaDataLoaderRegistry.getDataLoaders().size());\n        \n        for (MetaDataLoader loader : metaDataLoaderRegistry.getDataLoaders()) {\n            System.out.println(\"     - Loader: \" + loader.getName() + \n                \" (\" + loader.getChildren().size() + \" children)\");\n        }\n        \n        System.out.println(\"\\n=== Spring Example completed ===\");\n    }\n    \n    /**\n     * Bean to configure test MetaDataLoader for the example\n     */\n    @Bean\n    public MetaDataLoader exampleMetaDataLoader() throws Exception {\n        SimpleLoader loader = new SimpleLoader(\"spring-example\");\n        \n        // Load example metadata from shared resources\n        URI metadataUri = getClass().getResource(\"/metadata/examples-metadata.json\").toURI();\n        loader.setSourceURIs(Arrays.asList(metadataUri));\n        loader.init();\n        \n        return loader;\n    }\n}\n```\n\n### **Phase 5: Parent POM Updates**\n\n#### **Step 5.1: Update root pom.xml module order**\n\n```xml\n<modules>\n    <module>metadata</module>\n    <module>codegen-base</module>\n    <module>codegen-mustache</module>\n    <module>codegen-plantuml</module>\n    <module>maven-plugin</module>\n    <module>core</module>\n    <module>core-spring</module>\n    <module>om</module>\n    <module>omdb</module>\n    <module>omnosql</module>\n    <module>web</module>\n    <module>web-spring</module>\n    <module>demo</module>\n    <module>examples</module>\n</modules>\n```\n\n## üîÑ **MIGRATION SEQUENCE & EXECUTION ORDER**\n\n### **Phase 1: Preparation (‚úÖ COMPLETED 2025-09-21)**\n1. ‚úÖ **Create implementation plan documentation** (this document)\n2. ‚úÖ **Update CLAUDE.md with lessons learned** - Added critical OSGi & Spring integration lessons\n3. **Fix current build issues** (omdb tests, etc.) - IN PROGRESS\n\n**Lessons Learned:**\n- **OSGi compatibility violations** can be subtle and critical - always use service-based patterns\n- **Maven repository publishing concerns** require separate modules for framework dependencies  \n- **Centralized utility patterns** prevent architectural violations and maintenance nightmares\n- **Test registry connectivity** is essential for proper database test functionality\n\n### **Phase 2: Codegen Breakout (Critical First)**\n1. Create codegen-base, codegen-mustache, codegen-plantuml modules\n2. Move code from existing codegen module\n3. Update maven-plugin dependencies\n4. Update parent pom module order\n5. **Test build after each module creation**\n\n### **Phase 3: Spring Restructuring**\n1. Create core-spring module\n2. Move Spring integration from current spring module  \n3. Create web-spring module\n4. Update demo module dependencies\n5. Delete old spring module\n6. **Test all Spring functionality**\n\n### **Phase 4: Examples Implementation**\n1. Create examples parent and shared-resources\n2. Create basic-example with comprehensive functionality\n3. Create osgi-example with bundle patterns\n4. Create spring-example with injection patterns\n5. **Test all examples work independently**\n\n### **Phase 5: Cleanup & Documentation**\n1. Update all documentation\n2. Verify all builds and tests pass\n3. Update README files for new structure\n4. Create migration guides for existing users\n\n## üéØ **SUCCESS CRITERIA**\n\n### **Build Requirements**\n- ‚úÖ All modules compile successfully\n- ‚úÖ All tests pass\n- ‚úÖ Maven dependency resolution works\n- ‚úÖ OSGI bundle manifests correct\n- ‚úÖ No circular dependencies\n\n### **Functional Requirements**\n- ‚úÖ Basic MetaObjects functionality preserved\n- ‚úÖ Spring integration works identically\n- ‚úÖ OSGI compatibility maintained\n- ‚úÖ Code generation works with new structure\n- ‚úÖ Examples demonstrate all usage patterns\n\n### **Architecture Requirements**\n- ‚úÖ Clean separation of concerns\n- ‚úÖ Minimal dependencies in published artifacts\n- ‚úÖ Maven Central publishing ready\n- ‚úÖ Extensible for future generators\n- ‚úÖ Clear upgrade path for existing users\n\n## üîß **CRITICAL IMPLEMENTATION INSIGHTS (MUST READ BEFORE STARTING)**\n\n### **‚ö†Ô∏è OSGi Compatibility Requirements**\n\n**FUNDAMENTAL PRINCIPLE**: All new modules MUST be OSGi-compatible from day one.\n\n#### **Mandatory Patterns for All New Modules:**\n```java\n// ‚úÖ CORRECT - Always use service-based registry patterns\nimport com.metaobjects.registry.MetaDataLoaderRegistry;\nimport com.metaobjects.registry.ServiceRegistryFactory;\nimport com.metaobjects.util.MetaDataUtil;\n\n// In any class needing MetaDataLoader access:\nMetaObject obj = MetaDataUtil.findMetaObjectByName(\"ObjectName\", this);\n```\n\n#### **Forbidden Patterns (Will Break OSGi):**\n```java\n// ‚ùå NEVER USE - These break OSGi bundle lifecycle\nimport com.metaobjects.loader.MetaDataRegistry; // Legacy static registry\nMetaDataRegistry.registerLoader(loader); // Memory leaks in OSGi\nMetaDataRegistry.findMetaObject(obj); // ClassLoader issues\n```\n\n#### **Module Dependencies - OSGi Considerations:**\n- **WeakHashMap**: Essential for bundle cleanup, never replace with strong references\n- **ServiceRegistryFactory**: Required for auto-detection of OSGi vs standalone environments\n- **Bundle manifests**: All modules must have proper OSGi headers via Maven Bundle Plugin\n\n### **üçÉ Framework Integration Strategy**\n\n#### **Spring Integration Pattern (PROVEN APPROACH):**\n\n**Rule**: Framework-specific dependencies MUST be in separate modules.\n\n```\nBase Module (No Framework Dependencies):\n‚îú‚îÄ‚îÄ metaobjects-metadata\n‚îú‚îÄ‚îÄ metaobjects-codegen-base  \n‚îú‚îÄ‚îÄ metaobjects-core\n\nFramework Modules (Optional):\n‚îú‚îÄ‚îÄ metaobjects-core-spring (depends on core + spring)\n‚îú‚îÄ‚îÄ metaobjects-web-spring (depends on web + core-spring)\n```\n\n**Benefits of This Pattern:**\n1. **Maven Repository Publishing**: Non-Spring projects don't get Spring dependencies\n2. **Modular Choice**: Projects include exactly what they need\n3. **Framework Flexibility**: Easy to add Quarkus, Micronaut support later\n4. **Dependency Management**: Clear separation of concerns\n\n#### **Testing Integration Requirements:**\n\n**CRITICAL**: All new modules must implement proper test registry connectivity:\n\n```java\n// Required test setup pattern for any module with MetaDataLoader usage\n@BeforeClass\npublic static void setUpClass() throws Exception {\n    // OSGi-compatible test registry\n    registry = new MetaDataLoaderRegistry(ServiceRegistryFactory.getDefault());\n    \n    // Register test loaders\n    TestMetaDataLoader loader = new TestMetaDataLoader(\"test-data.xml\");\n    loader.register(); // Backward compatibility\n    registry.registerLoader(loader); // Test connectivity\n}\n\n// In services requiring registry access during testing:\nserviceUnderTest.setMetaDataLoaderRegistry(registry); // Explicit connection\n```\n\n### **üì¶ Build System Requirements**\n\n#### **Maven Module Dependencies - STRICT ORDER:**\n\n```\nPhase 1: metadata ‚Üí codegen-base ‚Üí codegen-mustache/codegen-plantuml\nPhase 2: maven-plugin (depends on codegen-base)\nPhase 3: core (depends on metadata + codegen-base + maven-plugin)\nPhase 4: core-spring (depends on core + spring)\nPhase 5: web ‚Üí web-spring (depends on web + core-spring)\nPhase 6: examples (depends on appropriate combinations)\n```\n\n**CRITICAL**: Test dependencies must be carefully managed:\n- `metaobjects-metadata` must build test-jar for codegen module\n- All modules need consistent OSGi bundle configuration\n- Spring modules need optional dependencies properly configured\n\n#### **POM Configuration Standards:**\n\n```xml\n<!-- Required for all modules -->\n<packaging>bundle</packaging>\n\n<!-- OSGi Bundle Plugin (MANDATORY) -->\n<plugin>\n    <groupId>org.apache.felix</groupId>\n    <artifactId>maven-bundle-plugin</artifactId>\n    <extensions>true</extensions>\n</plugin>\n\n<!-- For framework-specific modules only -->\n<dependency>\n    <groupId>org.springframework</groupId>\n    <artifactId>spring-context</artifactId>\n    <scope>provided</scope> <!-- Key: Don't force on downstream -->\n</dependency>\n```\n\n### **üß™ Testing Strategy Requirements**\n\n#### **Multi-Environment Testing (MANDATORY):**\n\nEvery module must be tested in:\n1. **Standalone Java**: Normal JUnit execution\n2. **OSGi Simulation**: ServiceRegistryFactory auto-detection\n3. **Spring Integration** (if applicable): Auto-configuration testing\n\n#### **Database Test Patterns:**\n\nFor modules with database integration (omdb, etc.):\n```java\n// Required pattern for database validation services\npublic class TestDatabaseValidatorService {\n    private MetaDataLoaderRegistry testRegistry;\n    \n    public void setMetaDataLoaderRegistry(MetaDataLoaderRegistry registry) {\n        this.testRegistry = registry; // Allow test registry injection\n    }\n    \n    private MetaDataLoaderRegistry getEffectiveRegistry() {\n        return testRegistry != null ? testRegistry : \n               new MetaDataLoaderRegistry(ServiceRegistryFactory.getDefault());\n    }\n}\n```\n\n### **‚è±Ô∏è Implementation Timeline Lessons**\n\n#### **Critical Path Dependencies:**\n\n1. **Fix Current Issues FIRST**: Don't start major refactoring until existing build is stable\n2. **OSGi Registry Migration**: This affects ALL modules, must be completed before other work\n3. **Test Infrastructure**: Database tests are fragile, require special attention\n4. **Framework Modules**: Spring integration can be done in parallel once OSGi is stable\n\n#### **Risk Mitigation Strategies:**\n\n- **Incremental Module Creation**: Create one module at a time, test thoroughly\n- **Backward Compatibility**: Maintain old APIs during transition period  \n- **Build Verification**: `mvn clean compile test` must pass after each module\n- **Example Projects**: Implement early to validate architecture decisions\n\n#### **Success Metrics for Each Phase:**\n\n**Phase 1** (Preparation): All current tests pass, OSGi patterns documented\n**Phase 2** (Codegen Breakout): Code generation works identically after module split\n**Phase 3** (Spring Restructuring): Spring Boot auto-configuration works seamlessly\n**Phase 4** (Examples): All three example projects run independently\n\n## üìö **BENEFITS ACHIEVED**\n\n1. **Granular Dependencies**: Projects can include exactly what they need\n2. **Published Library Standards**: Follows Maven Central best practices\n3. **Framework Choice**: Non-Spring projects don't get Spring dependencies\n4. **Future Extensibility**: Ready for additional codegen modules\n5. **Clear Examples**: Concrete usage patterns for all scenarios\n6. **Better Maintainability**: Clear module boundaries and responsibilities\n\n## üö® **RISKS & MITIGATION**\n\n### **Risk: Breaking Existing Users**\n**Mitigation**: Maintain artifact compatibility, provide clear migration guides\n\n### **Risk: Complex Build Dependencies**\n**Mitigation**: Careful dependency management, extensive testing\n\n### **Risk: Example Maintenance Overhead**  \n**Mitigation**: Simple, focused examples with shared resources\n\n### **Risk: Module Explosion**\n**Mitigation**: Only create modules with clear business value\n\n---\n\n**This refactoring transforms MetaObjects into a professionally structured, Maven-repository-ready framework while maintaining all existing functionality and providing clear upgrade paths for existing users.**",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/docs/ARCHITECTURAL_REFACTORING_PLAN.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "example",
        "md"
      ],
      "content_hash": "d91e14a4abf87f36",
      "size_bytes": 46162,
      "created_at": "2026-01-02T20:42:12.431254"
    },
    {
      "doc_id": "local_metaobjects-core__claude_docs_react-integration",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/docs/react-integration.md",
      "content": "# React Integration & MetaView Components\n\n**React/TypeScript integration for metadata-driven UIs**\n\n---\n\n## Overview\n\nMetaObjects includes React components that automatically generate UIs from metadata definitions.\n\n**Key Principle:** Metadata drives UI generation.\n\n---\n\n## MetaView System\n\n### What is MetaView?\n\n**MetaView** components render metadata as interactive UI elements:\n- Forms\n- Tables\n- Lists\n- Detail views\n\n**Driven by:** MetaObject metadata definitions\n\n---\n\n## Project Structure\n\n### Web Module\n\n```\nweb/\n‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îú‚îÄ‚îÄ typescript/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metaviews/       # MetaView components\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ forms/           # Form components\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metadata.ts      # TypeScript types\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ store/               # Redux store\n‚îÇ   ‚îú‚îÄ‚îÄ main/java/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ com/draagon/meta/web/react/api/\n‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ MetadataController.java\n‚îÇ   ‚îî‚îÄ‚îÄ main/resources/\n‚îÇ       ‚îî‚îÄ‚îÄ metadata/\n‚îÇ           ‚îî‚îÄ‚îÄ web-metadata.json\n‚îú‚îÄ‚îÄ package.json\n‚îú‚îÄ‚îÄ tsconfig.json\n‚îî‚îÄ‚îÄ webpack.config.js\n```\n\n---\n\n## Core Components\n\n### MetaObjectView\n\n**Renders complete object view:**\n\n```typescript\nimport { MetaObjectView } from './components/metaviews';\n\n<MetaObjectView\n  metaObjectName=\"User\"\n  objectId={userId}\n  mode=\"view\"\n/>\n```\n\n**Props:**\n- `metaObjectName`: Name of MetaObject\n- `objectId`: ID of object instance\n- `mode`: \"view\" | \"edit\" | \"create\"\n\n### MetaFieldView\n\n**Renders individual field:**\n\n```typescript\nimport { MetaFieldView } from './components/metaviews';\n\n<MetaFieldView\n  field={metaField}\n  value={fieldValue}\n  onChange={handleChange}\n/>\n```\n\n**Automatically renders:**\n- String ‚Üí Text input\n- Int/Long ‚Üí Number input\n- Boolean ‚Üí Checkbox\n- Date ‚Üí Date picker\n- Object reference ‚Üí Dropdown\n\n### MetaFormView\n\n**Renders complete form:**\n\n```typescript\nimport { MetaFormView } from './components/forms';\n\n<MetaFormView\n  metaObjectName=\"User\"\n  onSubmit={handleSubmit}\n  initialValues={userData}\n/>\n```\n\n---\n\n## TypeScript Types\n\n### Metadata Types\n\n```typescript\n// types/metadata.ts\n\nexport interface MetaObject {\n  name: string;\n  type: string;\n  subType?: string;\n  fields: MetaField[];\n  attributes: Record<string, any>;\n}\n\nexport interface MetaField {\n  name: string;\n  type: string;\n  subType: string;\n  label?: string;\n  required?: boolean;\n  validators?: MetaValidator[];\n}\n\nexport interface MetaValidator {\n  name: string;\n  type: string;\n  message?: string;\n  params?: Record<string, any>;\n}\n```\n\n---\n\n## Spring Boot Integration\n\n### API Endpoints\n\n```java\n@RestController\n@RequestMapping(\"/api/metadata\")\npublic class MetadataController {\n\n    @GetMapping(\"/{objectName}\")\n    public MetaObject getMetadata(@PathVariable String objectName) {\n        return metaDataLoader.getMetaObjectByName(objectName);\n    }\n\n    @GetMapping(\"/{objectName}/{id}\")\n    public Object getObject(\n        @PathVariable String objectName,\n        @PathVariable Long id\n    ) {\n        return objectManager.getObject(connection, objectName, id);\n    }\n\n    @PostMapping(\"/{objectName}\")\n    public Object createObject(\n        @PathVariable String objectName,\n        @RequestBody Map<String, Object> data\n    ) {\n        // Create object from metadata + data\n    }\n}\n```\n\n---\n\n## Redux Integration\n\n### State Management\n\n```typescript\n// store/metadataSlice.ts\nimport { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\n\nexport const fetchMetadata = createAsyncThunk(\n  'metadata/fetch',\n  async (objectName: string) => {\n    const response = await fetch(`/api/metadata/${objectName}`);\n    return response.json();\n  }\n);\n\nconst metadataSlice = createSlice({\n  name: 'metadata',\n  initialState: {\n    objects: {},\n    loading: false,\n    error: null\n  },\n  reducers: {},\n  extraReducers: (builder) => {\n    builder\n      .addCase(fetchMetadata.pending, (state) => {\n        state.loading = true;\n      })\n      .addCase(fetchMetadata.fulfilled, (state, action) => {\n        state.objects[action.payload.name] = action.payload;\n        state.loading = false;\n      });\n  }\n});\n```\n\n---\n\n## Example Usage\n\n### Complete Form\n\n```typescript\nimport React, { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { MetaFormView } from './components/forms';\nimport { fetchMetadata } from './store/metadataSlice';\n\nexport const UserForm: React.FC = () => {\n  const dispatch = useDispatch();\n  const metadata = useSelector(state => state.metadata.objects['User']);\n\n  useEffect(() => {\n    dispatch(fetchMetadata('User'));\n  }, [dispatch]);\n\n  const handleSubmit = async (values) => {\n    await fetch('/api/metadata/User', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(values)\n    });\n  };\n\n  if (!metadata) return <div>Loading...</div>;\n\n  return (\n    <MetaFormView\n      metaObject={metadata}\n      onSubmit={handleSubmit}\n    />\n  );\n};\n```\n\n---\n\n## Field Type Rendering\n\n### Automatic Field Rendering\n\n**Based on field subType:**\n\n| subType | Component | Notes |\n|---------|-----------|-------|\n| string | `<input type=\"text\">` | Standard text input |\n| int, long | `<input type=\"number\">` | Number input |\n| float, double, decimal | `<input type=\"number\" step=\"0.01\">` | Decimal input |\n| boolean | `<input type=\"checkbox\">` | Checkbox |\n| date | `<input type=\"date\">` | Date picker |\n| timestamp | `<input type=\"datetime-local\">` | DateTime picker |\n| object | `<select>` | Dropdown with object list |\n\n### Custom Renderers\n\n```typescript\nconst customRenderers = {\n  email: (props) => <input type=\"email\" {...props} />,\n  phone: (props) => <input type=\"tel\" {...props} />,\n  currency: (props) => <CurrencyInput {...props} />\n};\n\n<MetaFieldView\n  field={field}\n  value={value}\n  customRenderers={customRenderers}\n/>\n```\n\n---\n\n## Building & Deployment\n\n### Build React Components\n\n```bash\ncd ~/Development/metaobjects-core/web\nnpm install\nnpm run build\n```\n\n**Output:** `web/target/classes/static/`\n\n### Include in Spring Boot\n\n```xml\n<!-- pom.xml -->\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.codehaus.mojo</groupId>\n            <artifactId>exec-maven-plugin</artifactId>\n            <executions>\n                <execution>\n                    <id>npm-install</id>\n                    <goals><goal>exec</goal></goals>\n                    <phase>generate-resources</phase>\n                    <configuration>\n                        <executable>npm</executable>\n                        <arguments><argument>install</argument></arguments>\n                    </configuration>\n                </execution>\n                <execution>\n                    <id>npm-build</id>\n                    <goals><goal>exec</goal></goals>\n                    <phase>generate-resources</phase>\n                    <configuration>\n                        <executable>npm</executable>\n                        <arguments><argument>run</argument><argument>build</argument></arguments>\n                    </configuration>\n                </execution>\n            </executions>\n        </plugin>\n    </plugins>\n</build>\n```\n\n---\n\n## Demo Application\n\n### FishStore Demo\n\n**Location:** `demo/src/main/java/com/draagon/meta/demo/fishstore/`\n\n**Features:**\n- Complete CRUD operations\n- MetaView component usage\n- Spring Boot + React integration\n- PostgreSQL persistence\n\n**Running:**\n```bash\ncd ~/Development/metaobjects-core/demo\nmvn spring-boot:run\n```\n\n**Access:** http://localhost:8080\n\n---\n\n## Future Enhancements\n\n### Planned Components\n\n- **MetaTableView** - Sortable, filterable tables\n- **MetaSearchView** - Advanced search forms\n- **MetaChartView** - Metadata-driven charts\n- **MetaWizardView** - Multi-step wizards\n\n### TypeScript Improvements\n\n- Stricter type definitions\n- Better validation integration\n- Performance optimizations\n\n---\n\n## See Also\n\n- [type-system.md](type-system.md) - Field types and mappings\n- [persistence.md](persistence.md) - Backend data integration\n- [SETUP.md](../SETUP.md) - Building web module\n\n---\n\n**Last Updated:** 2025-11-15\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/docs/react-integration.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "def",
        "md"
      ],
      "content_hash": "13b3b08a27eebb17",
      "size_bytes": 8191,
      "created_at": "2026-01-02T20:42:12.431508"
    },
    {
      "doc_id": "local_metaobjects-core__claude_docs_CLAUDE_COMMANDS",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/docs/CLAUDE_COMMANDS.md",
      "content": "# MetaObjects - Common Commands for Claude AI\n\n## Build & Compilation\n\n```bash\n# Clean and compile entire project\nmvn clean compile\n\n# Package all modules\nmvn clean package\n\n# Install to local repository\nmvn clean install\n\n# Skip tests during build\nmvn clean install -DskipTests\n\n# Compile specific module\ncd core && mvn compile\ncd metadata && mvn compile\ncd maven-plugin && mvn compile\n```\n\n## Testing\n\n```bash\n# Run all tests\nmvn test\n\n# Run specific test class\nmvn test -Dtest=FileMetaDataLoaderTestXml\n\n# Run tests for specific module\ncd core && mvn test\n\n# Run tests with verbose output\nmvn test -X\n```\n\n## MetaObjects Code Generation\n\n```bash\n# Generate code using MetaObjects Maven plugin\nmvn metaobjects:generate\n\n# Generate with specific configuration\nmvn metaobjects:generate -Dloader.config=path/to/config.xml\n\n# Future: Launch MetaObjects Editor (v4.4.0+)\nmvn metaobjects:editor\n```\n\n## Development Utilities\n\n```bash\n# Check for dependency updates\nmvn versions:display-dependency-updates\n\n# Check plugin versions\nmvn versions:display-plugin-updates\n\n# Validate POM structure\nmvn help:effective-pom\n\n# Show dependency tree\nmvn dependency:tree\n\n# Analyze dependencies\nmvn dependency:analyze\n```\n\n## Code Quality & Analysis\n\n```bash\n# Compile with detailed warnings\nmvn compile -X\n\n# Check for outdated dependencies\nmvn versions:display-dependency-updates\n\n# Generate Javadocs\nmvn javadoc:javadoc\n\n# Generate site documentation\nmvn site\n```\n\n## OSGi Bundle Operations\n\n```bash\n# Generate OSGi manifest\nmvn org.apache.felix:maven-bundle-plugin:manifest\n\n# Bundle JAR with OSGi metadata\nmvn package\n```\n\n## Distribution & Release\n\n```bash\n# Deploy to Draagon repository (default profile)\nmvn deploy\n\n# Deploy to Maven Central (nexus profile)\nmvn deploy -Pnexus -Duse-nexus=true\n\n# Prepare release\nmvn release:prepare\n\n# Perform release\nmvn release:perform\n```\n\n## Module-Specific Commands\n\n```bash\n# Build in correct dependency order\ncd metadata && mvn clean install\ncd ../maven-plugin && mvn clean install  \ncd ../core && mvn clean install\ncd ../om && mvn clean install\n\n# Generate XSD from TypesConfig\nmvn metaobjects:generate -Dgenerator=xsd\n\n# Generate PlantUML diagrams\nmvn metaobjects:generate -Dgenerator=plantuml\n```\n\n## Debugging & Troubleshooting\n\n```bash\n# Enable debug output\nmvn clean compile -X\n\n# Show effective settings\nmvn help:effective-settings\n\n# Show active profiles\nmvn help:active-profiles\n\n# Resolve dependencies issues\nmvn dependency:resolve\n\n# Clean workspace thoroughly\nmvn clean && rm -rf ~/.m2/repository/com/draagon/metaobjects\n```\n\n## Java 21 Specific\n\n```bash\n# Verify Java version compatibility\nmvn clean compile -Djava.version=21\n\n# Check compiler configuration\nmvn help:effective-pom | grep -A5 \"maven-compiler-plugin\"\n```\n\n## Working with MetaData Files\n\n```bash\n# Validate MetaModel files\nmvn validate\n\n# Generate Java interfaces from MetaModel\nmvn metaobjects:generate -Dgenerator=interfaces\n\n# Convert XML metadata to JSON\nmvn metaobjects:generate -Dgenerator=json\n```\n\n## IDE Integration\n\n```bash\n# Generate IDE project files\nmvn idea:idea          # IntelliJ IDEA\nmvn eclipse:eclipse    # Eclipse\n\n# Import into IDE after generation\n# File -> Open -> select root pom.xml\n```\n\n## Version Management Commands\n\n```bash\n# After version updates, verify all versions match\ngrep -r \"<version>\" */pom.xml | grep -v \"plugin\\|dependency\"\n\n# Check README version\ngrep \"Current Release:\" README.md\n\n# Verify RELEASE_NOTES has new version  \nhead -20 RELEASE_NOTES.md | grep \"Version\"\n\n# Build after version changes\nmvn clean compile\n```\n\n## Notes for Claude AI\n\n- **VERSION UPDATES**: When user requests version increment, automatically update ALL files (see CLAUDE_VERSION_MANAGEMENT.md)\n- Always build `metadata` module before `core` due to code generation dependencies\n- Use `-DskipTests` if tests are failing and you need to build quickly\n- The project uses Java 21 features, ensure compatibility when making changes\n- OSGi bundle generation is automatic during package phase\n- MetaObjects plugin commands may not work until the plugin is built and installed locally",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/docs/CLAUDE_COMMANDS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "claude",
        "install",
        "md",
        "test"
      ],
      "content_hash": "e13900a8caddfae2",
      "size_bytes": 4106,
      "created_at": "2026-01-02T20:42:12.431561"
    },
    {
      "doc_id": "local_metaobjects-core__claude_docs_CLAUDE_VERSION_MANAGEMENT",
      "source": "local",
      "category": "knowledge_base",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/docs/CLAUDE_VERSION_MANAGEMENT.md",
      "content": "# MetaObjects Version Management - Claude AI Guide\n\n## Version Update Trigger\n\n**WHEN USER SAYS**: \"increment version\", \"update version\", \"release new version\", or similar version-related commands, Claude MUST automatically perform ALL the following steps:\n\n## Automatic Version Update Process\n\n### Step 1: Determine Version Strategy\n```\nCurrent: 4.5.0-SNAPSHOT\nRelease: 4.5.0 (remove -SNAPSHOT)\nNext Development: 4.6.0-SNAPSHOT (increment minor + add -SNAPSHOT)\n```\n\nVersion patterns:\n- **Major**: X.0.0 (breaking changes)\n- **Minor**: X.Y.0 (new features, backward compatible)\n- **Patch**: X.Y.Z (bug fixes only)\n\n### Step 2: Update All POM Files (CRITICAL)\nUpdate version in ALL module pom.xml files:\n\n```\nRoot: ./pom.xml (line ~11)\nModules:\n- ./metadata/pom.xml (line ~7)\n- ./maven-plugin/pom.xml (line ~5)\n- ./core/pom.xml (line ~7)\n- ./om/pom.xml (line ~8)\n- ./demo/pom.xml (line ~7)\n- ./web/pom.xml (line ~8)\n- ./omdb/pom.xml (line ~7)\n- ./docs/pom.xml (line ~11)\n```\n\n**IMPORTANT**: All modules MUST have identical version numbers!\n\n### Step 3: Update README.md\nLocated at: `./README.md`\n\nUpdate line 6:\n```markdown\nCurrent Release:  X.Y.Z\n```\n\n### Step 4: Update RELEASE_NOTES.md  \nLocated at: `./RELEASE_NOTES.md`\n\nAdd new version section at the top (after line 48):\n```markdown\n## Version X.Y.Z\nRelease date: [Current Date]\n\n### New Features\n* [Feature descriptions]\n\n### Bug Fixes  \n* [Bug fix descriptions]\n\n### Improvements\n* [Improvement descriptions]\n\n### Breaking Changes (if major version)\n* [Breaking change descriptions]\n\n### Upgrade Steps\n* [Any required upgrade steps]\n\n---\n\n```\n\n### Step 5: Update CLAUDE.md\nLocated at: `./.claude/CLAUDE.md`\n\nUpdate lines:\n- Line 6: `- **Current Version**: X.Y.Z-SNAPSHOT (latest stable: X.Y.Z)`\n- Line 71: `## Recent Major Changes (vX.Y.Z)` (update section header)\n\n### Step 6: Verify All Locations Updated\n\nSearch and verify these files/patterns are updated:\n- All pom.xml files contain new version\n- README.md shows new current release\n- RELEASE_NOTES.md has new version section\n- .claude/CLAUDE.md reflects new version\n- Any hardcoded version references in documentation\n\n## Files That Must Be Updated\n\n### Primary Files (ALWAYS update)\n1. **./pom.xml** - Root project version\n2. **./metadata/pom.xml** - Metadata module version\n3. **./maven-plugin/pom.xml** - Maven plugin module version  \n4. **./core/pom.xml** - Core module version\n5. **./om/pom.xml** - Object Manager module version\n6. **./README.md** - Current Release line\n7. **./RELEASE_NOTES.md** - Add new version section\n8. **./.claude/CLAUDE.md** - Current version and recent changes header\n\n### Secondary Files (Update if uncommented in build)\n9. **./demo/pom.xml** - Demo module version\n10. **./web/pom.xml** - Web module version\n11. **./omdb/pom.xml** - Database OM module version\n12. **./docs/pom.xml** - Documentation module version\n\n### Documentation Files (Check for version references)\n13. Any .md files in docs/ directory\n14. Any version references in source code comments\n15. Any configuration files with version strings\n\n## Version Update Workflow\n\nWhen user requests version increment:\n\n```bash\n# 1. Update all POM files with new version\n# 2. Update README.md current release\n# 3. Update RELEASE_NOTES.md with new section\n# 4. Update .claude/CLAUDE.md version references\n# 5. Verify all changes with grep search\n# 6. Build and test the project\nmvn clean compile\n# 7. If user requests, commit the changes\n```\n\n## Common Version Scenarios\n\n### Scenario 1: Release Current SNAPSHOT\n```\nFrom: 4.5.0-SNAPSHOT\nTo: 4.5.0\nNext Dev: 4.6.0-SNAPSHOT\n```\n\n### Scenario 2: Minor Version Increment\n```  \nFrom: 4.5.0\nTo: 4.6.0-SNAPSHOT\n```\n\n### Scenario 3: Major Version Increment\n```\nFrom: 4.5.0  \nTo: 5.0.0-SNAPSHOT\n```\n\n### Scenario 4: Patch Version Increment\n```\nFrom: 4.5.0\nTo: 4.5.1-SNAPSHOT\n```\n\n## Validation Commands\n\nAfter version updates, run these commands to verify:\n\n```bash\n# Check all POM versions match\ngrep -r \"<version>.*</version>\" */pom.xml | grep -v \"plugin\\|dependency\"\n\n# Verify README version\ngrep \"Current Release:\" README.md\n\n# Check RELEASE_NOTES has new version\nhead -20 RELEASE_NOTES.md | grep \"Version\"\n\n# Verify CLAUDE.md version\ngrep \"Current Version\" .claude/CLAUDE.md\n```\n\n## Error Prevention\n\n### Critical Checks\n1. **Version Consistency**: All pom.xml files MUST have same version\n2. **SNAPSHOT Handling**: Development versions should end with -SNAPSHOT\n3. **Date Updates**: RELEASE_NOTES.md should have current date\n4. **Section Headers**: Update major changes section in .claude/CLAUDE.md\n5. **Build Verification**: Project must compile after version changes\n\n### Common Mistakes to Avoid\n1. Forgetting to update child module versions\n2. Missing README.md current release update\n3. Not adding new section to RELEASE_NOTES.md\n4. Inconsistent version numbers across modules\n5. Forgetting to update .claude/CLAUDE.md version references\n\n## Implementation Notes for Claude AI\n\n- **Always** perform ALL steps in sequence when version increment is requested\n- **Verify** all files are updated by running grep searches\n- **Test** the build after making changes: `mvn clean compile`\n- **Ask** user for release notes content if not provided\n- **Confirm** version strategy (major/minor/patch) if ambiguous\n- **Double-check** that all 8 primary files are updated before completing\n\nThis process ensures complete version synchronization across the entire MetaObjects project.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/docs/CLAUDE_VERSION_MANAGEMENT.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "claude",
        "md"
      ],
      "content_hash": "11d2d7b8db97ae58",
      "size_bytes": 5421,
      "created_at": "2026-01-02T20:42:12.431661"
    },
    {
      "doc_id": "local_metaobjects-core__claude_docs_AI_OPTIMIZED_TYPE_SYSTEM_REFACTORING",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/docs/AI_OPTIMIZED_TYPE_SYSTEM_REFACTORING.md",
      "content": "# AI-Optimized Type System Refactoring Plan\n\n## üéØ **Project Overview**\n\n**Objective**: Consolidate fragmented field and attribute types into AI-optimized semantic categories to dramatically improve code generation across Java, C#, TypeScript, and Node.js.\n\n**Priority**: #1 Ease of AI code generation, #2 Cross-language compatibility\n**Timeline**: Before TypeScript/C# versions are implemented\n**Breaking Changes**: Acceptable (major version)\n\n## üîç **Current Problems**\n\n### Field Type Fragmentation\n- **Current**: 10+ specific types (StringField, IntegerField, LongField, DoubleField, FloatField, BooleanField, DateField, ShortField, ByteField, StringArrayField, ObjectArrayField)\n- **Problem**: AI must handle 10+ decision branches, language-specific types that don't exist in all targets\n\n### Attribute Type Duplication\n- **Current**: Parallel fragmentation (StringAttribute, IntAttribute, LongAttribute, DoubleAttribute, StringArrayAttribute)\n- **Problem**: Same fragmentation issues, inconsistent with field types\n\n### Cross-Language Compatibility Issues\n- **Java/C#**: Distinguish int/long/float/double precisely\n- **TypeScript/Node.js**: Only has \"number\" type\n- **Current**: Templates must handle these differences manually\n\n## ‚úÖ **Architecture Decisions**\n\n### Type Consolidation Strategy\n- **Numeric Consolidation**: int, long, float, double ‚Üí `numeric` with `@primitiveType` attribute\n- **Array Strategy**: `stringArray`, `numericArray` subtypes (not `@isArray` modifier)\n- **Naming**: Keep familiar terms (`string` not `text`, `object` not `reference`)\n- **Consistency**: Same type system for both MetaField and MetaAttribute\n\n### Target Type Categories\n1. **`numeric`** - All number types with `@primitiveType` specification\n2. **`string`** - Text data (unchanged)\n3. **`boolean`** - True/false (unchanged)\n4. **`object`** - Object references (unchanged)\n5. **`temporal`** - Date/time values (consolidates date/timestamp)\n6. **`binary`** - Byte arrays (new)\n\n### Array Support\n- **Field Arrays**: `numericArray`, `stringArray`, `objectArray`, `temporalArray`, `binaryArray`\n- **Attribute Arrays**: Same pattern for MetaAttribute classes\n\n## üìã **Phase Breakdown**\n\n---\n\n## **PHASE 1: Numeric Type Foundation** ‚≠ê *START HERE*\n\n**Scope**: Implement core numeric consolidation with array support\n**Duration**: 1-2 chat sessions\n**Files to Create/Modify**: ~12 files\n\n### 1.1 Core Type Implementation\n\n#### Create New Classes:\n\n**`NumericField.java`**\n```java\npublic class NumericField extends PrimitiveField<Object> {\n    public static final String SUBTYPE_NUMERIC = \"numeric\";\n    public static final String ATTR_PRIMITIVE_TYPE = \"primitiveType\";\n\n    // Supported primitiveType values:\n    // \"int32\", \"int64\", \"float32\", \"float64\", \"decimal\"\n\n    public static void registerTypes(MetaDataRegistry registry) {\n        registry.registerType(NumericField.class, def -> def\n            .type(TYPE_FIELD).subType(SUBTYPE_NUMERIC)\n            .description(\"Unified numeric field supporting int32, int64, float32, float64, decimal\")\n            .inheritsFrom(TYPE_FIELD, SUBTYPE_BASE)\n            .optionalAttribute(ATTR_PRIMITIVE_TYPE, \"string\")\n            .optionalAttribute(\"precision\", \"string\") // For decimal: \"10,2\"\n        );\n    }\n}\n```\n\n**`NumericArrayField.java`**\n```java\npublic class NumericArrayField extends ArrayField<Object,List<Object>> {\n    public static final String SUBTYPE_NUMERIC_ARRAY = \"numericArray\";\n    public static final String ATTR_PRIMITIVE_TYPE = \"primitiveType\";\n\n    // Same primitiveType support as NumericField\n}\n```\n\n**`NumericAttribute.java`**\n```java\npublic class NumericAttribute extends MetaAttribute<Object> {\n    public static final String SUBTYPE_NUMERIC = \"numeric\";\n    public static final String ATTR_PRIMITIVE_TYPE = \"primitiveType\";\n\n    // Same primitiveType support as NumericField\n}\n```\n\n**`NumericArrayAttribute.java`**\n```java\npublic class NumericArrayAttribute extends MetaAttribute<List<Object>> {\n    public static final String SUBTYPE_NUMERIC_ARRAY = \"numericArray\";\n    public static final String ATTR_PRIMITIVE_TYPE = \"primitiveType\";\n}\n```\n\n### 1.2 Provider Registration\n\n**Update `FieldTypesMetaDataProvider.java`**\n```java\n@Override\npublic void registerTypes(MetaDataRegistry registry) {\n    // NEW: Consolidated numeric types\n    NumericField.registerTypes(registry);\n    NumericArrayField.registerTypes(registry);\n\n    // EXISTING: Keep current types during transition\n    StringField.registerTypes(registry);\n    BooleanField.registerTypes(registry);\n    // ... others\n}\n```\n\n**Update `AttributeTypesMetaDataProvider.java`**\n```java\n@Override\npublic void registerTypes(MetaDataRegistry registry) {\n    // NEW: Consolidated numeric attributes\n    NumericAttribute.registerTypes(registry);\n    NumericArrayAttribute.registerTypes(registry);\n\n    // EXISTING: Keep current types during transition\n    StringAttribute.registerTypes(registry);\n    BooleanAttribute.registerTypes(registry);\n    // ... others\n}\n```\n\n### 1.3 Database Integration\n\n**Update `SimpleMappingHandlerDB.java`**\n```java\nprotected int getSQLType(MetaField mf) {\n    if (mf instanceof NumericField || mf instanceof NumericArrayField) {\n        String primitiveType = getPrimitiveType(mf);\n        switch (primitiveType) {\n            case \"int32\": return Types.INTEGER;\n            case \"int64\": return Types.BIGINT;\n            case \"float32\": return Types.FLOAT;\n            case \"float64\": return Types.DOUBLE;\n            case \"decimal\": return Types.DECIMAL;\n            default: return Types.INTEGER; // fallback\n        }\n    }\n\n    // ... existing logic for other types\n}\n\nprivate String getPrimitiveType(MetaField mf) {\n    if (mf.hasMetaAttr(NumericField.ATTR_PRIMITIVE_TYPE)) {\n        return mf.getMetaAttr(NumericField.ATTR_PRIMITIVE_TYPE).getValueAsString();\n    }\n    return \"int32\"; // default\n}\n```\n\n### 1.4 Testing\n\n**Create Test Files**:\n- `NumericFieldTest.java` - Basic functionality, primitiveType handling\n- `NumericArrayFieldTest.java` - Array operations, type safety\n- `NumericAttributeTest.java` - Attribute-specific behavior\n- `NumericArrayAttributeTest.java` - Array attribute behavior\n\n**Test Metadata Files**:\n```json\n{\n  \"metadata\": {\n    \"package\": \"test::numeric\",\n    \"children\": [\n      {\n        \"field\": {\n          \"name\": \"count\",\n          \"subType\": \"numeric\",\n          \"@primitiveType\": \"int32\"\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"price\",\n          \"subType\": \"numeric\",\n          \"@primitiveType\": \"decimal\",\n          \"@precision\": \"10,2\"\n        }\n      },\n      {\n        \"field\": {\n          \"name\": \"scores\",\n          \"subType\": \"numericArray\",\n          \"@primitiveType\": \"float32\"\n        }\n      }\n    ]\n  }\n}\n```\n\n### 1.5 Success Criteria - Phase 1\n- ‚úÖ NumericField/NumericAttribute classes implemented with full primitiveType support\n- ‚úÖ Array versions working correctly\n- ‚úÖ Provider-based registration complete\n- ‚úÖ Database mapping functional for all primitive types\n- ‚úÖ Test coverage for core scenarios\n- ‚úÖ Build successful with all modules\n\n---\n\n## **PHASE 2: Code Generation Enhancement**\n\n**Scope**: Update templates and helpers to use numeric types\n**Duration**: 1 chat session\n**Files to Modify**: ~8 files\n\n### 2.1 Helper Registry Updates\n\n**Update `HelperRegistry.java`**\n```java\n// NEW: Numeric type helpers\nregister(\"isNumericField\", this::isNumericField);\nregister(\"isNumericArrayField\", this::isNumericArrayField);\nregister(\"getPrimitiveType\", this::getPrimitiveType);\nregister(\"getLanguageType\", this::getLanguageType);\n\nprivate Object isNumericField(Object input) {\n    return input instanceof NumericField;\n}\n\nprivate Object isNumericArrayField(Object input) {\n    return input instanceof NumericArrayField;\n}\n\nprivate Object getPrimitiveType(Object input) {\n    if (input instanceof NumericField || input instanceof NumericArrayField) {\n        MetaField field = (MetaField) input;\n        if (field.hasMetaAttr(NumericField.ATTR_PRIMITIVE_TYPE)) {\n            return field.getMetaAttr(NumericField.ATTR_PRIMITIVE_TYPE).getValueAsString();\n        }\n    }\n    return \"int32\"; // default\n}\n\nprivate Object getLanguageType(Object input, String language) {\n    if (isNumericField(input) || isNumericArrayField(input)) {\n        String primitiveType = (String) getPrimitiveType(input);\n        boolean isArray = isNumericArrayField(input);\n\n        switch (language) {\n            case \"java\":\n                return mapToJavaType(primitiveType, isArray);\n            case \"typescript\":\n                return isArray ? \"number[]\" : \"number\";\n            case \"csharp\":\n                return mapToCSharpType(primitiveType, isArray);\n        }\n    }\n    // ... handle other field types\n}\n\nprivate String mapToJavaType(String primitiveType, boolean isArray) {\n    String baseType;\n    switch (primitiveType) {\n        case \"int32\": baseType = \"Integer\"; break;\n        case \"int64\": baseType = \"Long\"; break;\n        case \"float32\": baseType = \"Float\"; break;\n        case \"float64\": baseType = \"Double\"; break;\n        case \"decimal\": baseType = \"BigDecimal\"; break;\n        default: baseType = \"Integer\";\n    }\n    return isArray ? baseType + \"[]\" : baseType;\n}\n\nprivate String mapToCSharpType(String primitiveType, boolean isArray) {\n    String baseType;\n    switch (primitiveType) {\n        case \"int32\": baseType = \"int\"; break;\n        case \"int64\": baseType = \"long\"; break;\n        case \"float32\": baseType = \"float\"; break;\n        case \"float64\": baseType = \"double\"; break;\n        case \"decimal\": baseType = \"decimal\"; break;\n        default: baseType = \"int\";\n    }\n    return isArray ? baseType + \"[]\" : baseType;\n}\n```\n\n### 2.2 Template Updates\n\n**Update Mustache Templates**:\n\n**Java Templates** (`*.java.vm`):\n```java\n{{#isNumericField}}\nprivate {{getLanguageType this \"java\"}} {{name}};\n{{/isNumericField}}\n\n{{#isNumericArrayField}}\nprivate {{getLanguageType this \"java\"}} {{name}};\n{{/isNumericArrayField}}\n```\n\n**TypeScript Templates** (`*.ts.vm`):\n```typescript\n{{#isNumericField}}\n{{name}}: {{getLanguageType this \"typescript\"}};\n{{/isNumericField}}\n\n{{#isNumericArrayField}}\n{{name}}: {{getLanguageType this \"typescript\"}};\n{{/isNumericArrayField}}\n```\n\n### 2.3 Success Criteria - Phase 2\n- ‚úÖ Helper methods correctly identify numeric types\n- ‚úÖ Language mapping works for Java, TypeScript, C#\n- ‚úÖ Templates generate correct code for all primitive types\n- ‚úÖ Array handling works in all languages\n- ‚úÖ Generated code compiles successfully\n\n---\n\n## **PHASE 3: Remaining Type Consolidation**\n\n**Scope**: Extend consolidation pattern to other type families\n**Duration**: 2-3 chat sessions\n**Files to Create**: ~15 files\n\n### 3.1 Temporal Type Consolidation\n\n**Create Classes**:\n- `TemporalField.java` - Consolidates DateField, TimestampField\n- `TemporalArrayField.java` - Array support\n- `TemporalAttribute.java` - Attribute version\n- `TemporalArrayAttribute.java` - Array attribute version\n\n**Temporal Types**:\n- `@temporalType`: \"date\", \"time\", \"datetime\", \"timestamp\"\n- `@timezone`: \"utc\", \"local\"\n\n### 3.2 Binary Type Introduction\n\n**Create Classes**:\n- `BinaryField.java` - For byte arrays, files\n- `BinaryArrayField.java` - Array support\n- `BinaryAttribute.java` - Attribute version\n- `BinaryArrayAttribute.java` - Array attribute version\n\n**Binary Types**:\n- `@mimeType`: \"image/jpeg\", \"application/pdf\", \"text/plain\"\n- `@maxSize`: \"1048576\" (1MB)\n\n### 3.3 Object Type Enhancement\n\n**Enhance Existing**:\n- `ObjectField.java` - Keep but enhance with better `@objectRef` support\n- `ObjectArrayField.java` - Keep current functionality\n- Add `ObjectAttribute.java` if needed for consistency\n\n### 3.4 Success Criteria - Phase 3\n- ‚úÖ All 6 core types implemented (numeric, string, boolean, object, temporal, binary)\n- ‚úÖ Array versions for all types\n- ‚úÖ Consistent attribute/field pattern across all types\n- ‚úÖ Database mapping functional for new types\n- ‚úÖ Code generation working for all types\n\n---\n\n## **PHASE 4: Database Layer Complete Integration**\n\n**Scope**: Full database mapping for all new types\n**Duration**: 1 chat session\n**Files to Modify**: ~5 files\n\n### 4.1 Complete SimpleMappingHandlerDB\n\n**Add Support For**:\n- TemporalField ‚Üí appropriate SQL date/time types\n- BinaryField ‚Üí BLOB/VARBINARY types\n- Array types ‚Üí database-specific array handling\n\n### 4.2 Database Driver Updates\n\n**Extend Database Drivers** for new types:\n- DerbyDriver, PostgresDriver, MySQLDriver, etc.\n- Handle array storage strategies (native arrays vs JSON vs separate tables)\n\n### 4.3 Success Criteria - Phase 4\n- ‚úÖ All semantic types map correctly to database types\n- ‚úÖ Array storage working (prefer native array support where available)\n- ‚úÖ Database schema generation handles all new types\n- ‚úÖ ObjectManagerDB integration tests pass\n\n---\n\n## **PHASE 5: Legacy Cleanup & Documentation**\n\n**Scope**: Remove old types, create migration documentation\n**Duration**: 1-2 chat sessions\n**Files to Remove**: ~15 files\n\n### 5.1 Legacy Type Removal\n\n**Remove Old Classes**:\n- IntegerField, LongField, DoubleField, FloatField ‚Üí Replaced by NumericField\n- DateField, TimestampField ‚Üí Replaced by TemporalField\n- IntAttribute, LongAttribute, DoubleAttribute ‚Üí Replaced by NumericAttribute\n- StringArrayField ‚Üí Replaced by StringArrayField (might keep if different from StringField)\n\n### 5.2 Provider Cleanup\n\n**Update Providers** to remove old type registrations:\n- Remove from FieldTypesMetaDataProvider\n- Remove from AttributeTypesMetaDataProvider\n- Clean up any META-INF/services references\n\n### 5.3 Migration Documentation\n\n**Create Documentation**:\n- `TYPE_MIGRATION_GUIDE.md` - How to migrate existing metadata\n- Update main README with new type system\n- Update API documentation with new patterns\n\n### 5.4 Success Criteria - Phase 5\n- ‚úÖ All legacy types removed from codebase\n- ‚úÖ Clean build with no references to old types\n- ‚úÖ Migration documentation complete\n- ‚úÖ All tests passing with new type system only\n\n---\n\n## **PHASE 6: Cross-Language Validation**\n\n**Scope**: Ensure templates work perfectly across all target languages\n**Duration**: 1 chat session\n**Files to Test**: Templates and generated code\n\n### 6.1 Template Validation\n\n**Test Generation For**:\n- Java code generation with all 6 semantic types\n- TypeScript code generation with proper type mapping\n- C# code generation (when available)\n\n### 6.2 Cross-Language Consistency\n\n**Validate**:\n- Same metadata generates appropriate types in each language\n- Array handling consistent across languages\n- Database mapping works regardless of target language\n\n### 6.3 Success Criteria - Phase 6\n- ‚úÖ Generated Java code compiles and runs\n- ‚úÖ Generated TypeScript code type-checks correctly\n- ‚úÖ Same metadata works across all target languages\n- ‚úÖ AI code generation significantly simplified\n\n---\n\n## üîß **Implementation Guidelines**\n\n### File Organization\n```\nmetadata/src/main/java/com/metaobjects/\n‚îú‚îÄ‚îÄ field/\n‚îÇ   ‚îú‚îÄ‚îÄ NumericField.java ‚≠ê NEW\n‚îÇ   ‚îú‚îÄ‚îÄ NumericArrayField.java ‚≠ê NEW\n‚îÇ   ‚îú‚îÄ‚îÄ TemporalField.java ‚≠ê NEW\n‚îÇ   ‚îú‚îÄ‚îÄ BinaryField.java ‚≠ê NEW\n‚îÇ   ‚îî‚îÄ‚îÄ ... (enhanced existing)\n‚îú‚îÄ‚îÄ attr/\n‚îÇ   ‚îú‚îÄ‚îÄ NumericAttribute.java ‚≠ê NEW\n‚îÇ   ‚îú‚îÄ‚îÄ NumericArrayAttribute.java ‚≠ê NEW\n‚îÇ   ‚îî‚îÄ‚îÄ ... (enhanced existing)\n```\n\n### Testing Strategy\n- **Unit Tests**: Each new type class gets comprehensive test coverage\n- **Integration Tests**: Database mapping, code generation\n- **Metadata Tests**: JSON parsing with new type definitions\n- **Cross-Language Tests**: Generated code compilation verification\n\n### Success Metrics\n- **AI Complexity Reduction**: 10+ field types ‚Üí 6 semantic categories\n- **Decision Tree Simplification**: 50% reduction in template complexity\n- **Cross-Language Consistency**: Same metadata works in Java, TypeScript, C#\n- **Database Compatibility**: All existing ObjectManagerDB functionality preserved\n\n---\n\n## üìÖ **Timeline Estimate**\n\n- **Phase 1**: 2-3 hours (1-2 chat sessions)\n- **Phase 2**: 1-2 hours (1 chat session)\n- **Phase 3**: 3-4 hours (2-3 chat sessions)\n- **Phase 4**: 1-2 hours (1 chat session)\n- **Phase 5**: 2-3 hours (1-2 chat sessions)\n- **Phase 6**: 1 hour (1 chat session)\n\n**Total Estimated Time**: 10-15 hours across 7-12 chat sessions\n\n---\n\n## üö® **Critical Dependencies**\n\n1. **Provider System**: Must maintain current provider-based registration\n2. **Database Compatibility**: ObjectManagerDB must continue working\n3. **OSGI Compliance**: All new types must follow OSGI patterns\n4. **Thread Safety**: Maintain read-optimized architecture\n5. **Constraint System**: New types must integrate with existing constraints\n\n---\n\n## üéØ **Next Session Action Items**\n\n**For Phase 1 Start**:\n1. Create `NumericField.java` class\n2. Create `NumericArrayField.java` class\n3. Create `NumericAttribute.java` class\n4. Create `NumericArrayAttribute.java` class\n5. Update provider registration\n6. Create basic test files\n7. Verify build success\n\n**Questions for Next Session**:\n- Should we keep existing numeric types during transition or remove immediately?\n- Any specific primitive type names to adjust (\"int32\" vs \"integer\")?\n- Database array storage preferences (JSON, separate tables, native arrays)?\n\nThis plan provides a clear roadmap for transforming MetaObjects into an AI-optimized, cross-language metadata system while maintaining architectural integrity.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/docs/AI_OPTIMIZED_TYPE_SYSTEM_REFACTORING.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "c6a32d48b45aff10",
      "size_bytes": 17452,
      "created_at": "2026-01-02T20:42:12.431785"
    },
    {
      "doc_id": "local_metaobjects-core__claude_docs_type-system",
      "source": "local",
      "category": "conversational",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/docs/type-system.md",
      "content": "# MetaObjects Type System\n\n**AI-optimized field types with cross-language semantic consistency**\n\n**Status:** ‚úÖ Completed (v6.3.0+)\n\n---\n\n## Overview\n\nMetaObjects uses a **33% simplified** field type system optimized for AI code generation across Java, C#, TypeScript, Python, and other languages.\n\n**Key Principle:** Semantic types that map directly to native language types.\n\n---\n\n## Core Semantic Types (6)\n\n### Universal Language Mapping\n\n| Type | Java | C# | TypeScript | Python | Usage |\n|------|------|-----|------------|--------|-------|\n| **string** | String | string | string | str | Text data |\n| **int** | Integer | int | number | int | Whole numbers, normal range |\n| **long** | Long | long | number | int | Whole numbers, large range |\n| **float** | Float | float | number | float | Decimal, standard precision |\n| **double** | Double | double | number | float | Decimal, high precision |\n| **decimal** | BigDecimal | decimal | Decimal | Decimal | Financial, exact precision |\n\n---\n\n## Special Types (4)\n\n### Boolean\n```json\n{\n  \"field\": {\n    \"name\": \"isActive\",\n    \"subType\": \"boolean\"\n  }\n}\n```\nMaps to: `Boolean/bool/boolean/bool`\n\n### Date\n```json\n{\n  \"field\": {\n    \"name\": \"birthDate\",\n    \"subType\": \"date\"\n  }\n}\n```\nMaps to: `LocalDate/DateTime/Date/date`\n\n### Timestamp\n```json\n{\n  \"field\": {\n    \"name\": \"createdAt\",\n    \"subType\": \"timestamp\"\n  }\n}\n```\nMaps to: `LocalDateTime/DateTime/Date/datetime`\n\n### Binary\n```json\n{\n  \"field\": {\n    \"name\": \"data\",\n    \"subType\": \"binary\"\n  }\n}\n```\nMaps to: `byte[]/byte[]/Uint8Array/bytes`\n\n---\n\n## Object Types (3)\n\n### Object Reference\n```json\n{\n  \"field\": {\n    \"name\": \"parent\",\n    \"subType\": \"object\",\n    \"refObject\": \"Category\"\n  }\n}\n```\n\n### Class Reference\n```json\n{\n  \"field\": {\n    \"name\": \"entityClass\",\n    \"subType\": \"class\"\n  }\n}\n```\n\n### Legacy Array Types\n- `stringArray` - Deprecated (use `@isArray` instead)\n- `objectArray` - Deprecated (use `@isArray` instead)\n\n---\n\n## Universal Array Support\n\n**Any field type can be an array** using `@isArray` modifier:\n\n```json\n{\n  \"field\": {\n    \"name\": \"scores\",\n    \"subType\": \"int\",\n    \"@isArray\": true\n  }\n}\n```\n\n**Eliminates need for separate array types:**\n- ~~IntArrayField~~ ‚Üí `IntegerField` with `@isArray: true`\n- ~~StringArrayField~~ ‚Üí `StringField` with `@isArray: true`\n- ~~ObjectArrayField~~ ‚Üí `ObjectField` with `@isArray: true`\n\n---\n\n## DecimalField - High-Precision Numbers\n\n**Use for:** Financial calculations, exact decimal representation\n\n```json\n{\n  \"field\": {\n    \"name\": \"price\",\n    \"subType\": \"decimal\",\n    \"@precision\": 19,\n    \"@scale\": 2\n  }\n}\n```\n\n**Attributes:**\n- `@precision` - Total digits (default: 19)\n- `@scale` - Decimal places (default: 2)\n\n**Language Mappings:**\n- Java: `BigDecimal`\n- C#: `decimal`\n- TypeScript: `Decimal` (from decimal.js)\n- Python: `Decimal`\n\n**Database:** `DECIMAL(19,2)` or equivalent\n\n---\n\n## What Was Removed (v6.3.0)\n\n### Eliminated Types\n\n**ByteField** - Rarely used, complexity without benefit\n- Use: `IntegerField` instead\n- Range validation sufficient for byte ranges\n\n**ShortField** - Rarely used, adds decision complexity\n- Use: `IntegerField` instead\n- Range validation sufficient for short ranges\n\n**Separate Array Types** - Type explosion problem\n- Old: `IntArrayField`, `StringArrayField`, etc.\n- New: Any field + `@isArray: true`\n\n### Why These Were Removed\n\n1. **Reduced AI Complexity:** 33% fewer type decisions\n2. **Semantic Clarity:** Types match business meaning, not technical details\n3. **Cross-Language:** Direct mapping to native types\n4. **Maintainability:** Fewer types = simpler codebase\n\n---\n\n## Field Type Selection Guide\n\n### Choose `string` when:\n- Text data of any length\n- Names, descriptions, URLs, JSON\n\n### Choose `int` when:\n- Whole numbers, typical business ranges\n- IDs, counts, quantities (< 2 billion)\n\n### Choose `long` when:\n- Large whole numbers\n- IDs, counts beyond int range\n- Timestamps (milliseconds since epoch)\n\n### Choose `float` when:\n- Decimal numbers, standard precision okay\n- Measurements, calculations\n- NOT for money (use decimal)\n\n### Choose `double` when:\n- Decimal numbers, high precision needed\n- Scientific calculations\n- NOT for money (use decimal)\n\n### Choose `decimal` when:\n- **Financial calculations** (ALWAYS!)\n- Money, prices, rates, percentages\n- Exact decimal representation required\n\n### Choose `boolean` when:\n- True/false, yes/no, on/off\n- Flags, switches, status\n\n### Choose `date` when:\n- Calendar dates without time\n- Birth dates, deadlines\n\n### Choose `timestamp` when:\n- Date + time\n- Creation/modification timestamps\n- Event times\n\n### Choose `object` when:\n- Reference to another entity\n- Foreign keys, relationships\n\n---\n\n## Range Validation\n\n### FloatField\n```json\n{\n  \"field\": {\n    \"name\": \"temperature\",\n    \"subType\": \"float\",\n    \"@minValue\": -273.15,\n    \"@maxValue\": 1000000.0\n  }\n}\n```\n\n### DoubleField\n```json\n{\n  \"field\": {\n    \"name\": \"scientificValue\",\n    \"subType\": \"double\",\n    \"@minValue\": 0.0,\n    \"@maxValue\": 1.7976931348623157E308\n  }\n}\n```\n\n### IntegerField / LongField\n```json\n{\n  \"field\": {\n    \"name\": \"quantity\",\n    \"subType\": \"int\",\n    \"@minValue\": 0,\n    \"@maxValue\": 2147483647\n  }\n}\n```\n\n---\n\n## Best Practices\n\n### DO:\n‚úÖ Use `decimal` for **all money/financial** calculations\n‚úÖ Use semantic types (`int`, not `byte`)\n‚úÖ Use `@isArray: true` for arrays\n‚úÖ Map types to native language equivalents\n‚úÖ Use range validation when needed\n\n### DON'T:\n‚ùå Use `float` or `double` for money\n‚ùå Use byte/short (removed in v6.3.0)\n‚ùå Create separate array field types\n‚ùå Use technical types when semantic types exist\n\n---\n\n## Migration from Old Types\n\n### ByteField ‚Üí IntegerField\n```json\n// OLD\n{\n  \"field\": {\n    \"name\": \"age\",\n    \"subType\": \"byte\"\n  }\n}\n\n// NEW\n{\n  \"field\": {\n    \"name\": \"age\",\n    \"subType\": \"int\",\n    \"@minValue\": 0,\n    \"@maxValue\": 127\n  }\n}\n```\n\n### Array Types ‚Üí @isArray\n```json\n// OLD\n{\n  \"field\": {\n    \"name\": \"tags\",\n    \"subType\": \"stringArray\"\n  }\n}\n\n// NEW\n{\n  \"field\": {\n    \"name\": \"tags\",\n    \"subType\": \"string\",\n    \"@isArray\": true\n  }\n}\n```\n\n---\n\n## Database Mappings\n\n| MetaObjects Type | PostgreSQL | MySQL | SQL Server | Oracle |\n|-----------------|------------|-------|------------|--------|\n| string | VARCHAR | VARCHAR | VARCHAR | VARCHAR2 |\n| int | INTEGER | INT | INT | NUMBER(10) |\n| long | BIGINT | BIGINT | BIGINT | NUMBER(19) |\n| float | REAL | FLOAT | REAL | FLOAT(24) |\n| double | DOUBLE PRECISION | DOUBLE | FLOAT | FLOAT(53) |\n| **decimal** | DECIMAL(19,2) | DECIMAL(19,2) | DECIMAL(19,2) | NUMBER(19,2) |\n| boolean | BOOLEAN | TINYINT(1) | BIT | NUMBER(1) |\n| date | DATE | DATE | DATE | DATE |\n| timestamp | TIMESTAMP | DATETIME | DATETIME2 | TIMESTAMP |\n| binary | BYTEA | BLOB | VARBINARY | BLOB |\n\n---\n\n## AI Generation Benefits\n\n### Before (8 types):\n```\nAI must decide between:\n  byte, short, int, long\n  float, double\n  string, boolean, date\n  + separate array types\n= 16+ type decisions\n```\n\n### After (6 core types):\n```\nAI decides semantic meaning:\n  int, long\n  float, double, decimal\n  string, boolean, date\n  + @isArray modifier\n= 10 type decisions (33% reduction)\n```\n\n**Result:** Simpler, faster, more accurate AI code generation\n\n---\n\n## Code Examples\n\n### Java\n```java\n@MetaField(subType = \"decimal\")\nprivate BigDecimal price;\n\n@MetaField(subType = \"int\")\n@IsArray(true)\nprivate List<Integer> scores;\n```\n\n### C#\n```csharp\n[MetaField(SubType = \"decimal\")]\npublic decimal Price { get; set; }\n\n[MetaField(SubType = \"int\")]\n[IsArray(true)]\npublic List<int> Scores { get; set; }\n```\n\n### TypeScript\n```typescript\n@MetaField({ subType: 'decimal' })\nprice: Decimal;\n\n@MetaField({ subType: 'int', isArray: true })\nscores: number[];\n```\n\n---\n\n## Testing Type System\n\n```bash\ncd ~/Development/metaobjects-core/metadata\nmvn test -Dtest=FieldTypeTest\n```\n\nAll 232 tests passing ‚úÖ\n\n---\n\n**See Also:**\n- [ARCHITECTURE.md](../ARCHITECTURE.md) - Overall design principles\n- [KNOWN-ISSUES.md](../KNOWN-ISSUES.md) - Type migration notes\n- [SETUP.md](../SETUP.md) - Building and testing\n\n---\n\n**Last Updated:** 2025-11-15\n**Version:** 6.3.0+\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/docs/type-system.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "usage"
      ],
      "content_hash": "721e91f5c9ef0ac1",
      "size_bytes": 8123,
      "created_at": "2026-01-02T20:42:12.431865"
    },
    {
      "doc_id": "local_metaobjects-core__claude_docs_testing",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/docs/testing.md",
      "content": "# MetaObjects Testing Guide\n\n**Unit test patterns and best practices**\n\n---\n\n## Overview\n\nMetaObjects uses JUnit 4 for testing with special patterns to handle ServiceLoader and shared registry concerns.\n\n**Key Principle:** Shared registry for consistent state across tests.\n\n---\n\n## Test Base Classes\n\n### SharedRegistryTestBase (Use This 95% of the Time)\n\n**Purpose:** Standard tests that need consistent MetaDataRegistry state\n\n```java\npublic class YourNewTest extends SharedRegistryTestBase {\n\n    @Test\n    public void testSomething() {\n        // Shared registry already initialized\n        MetaDataRegistry registry = getSharedRegistry();\n\n        // Test your code\n        MetaObject obj = registry.getMetaObjectByName(\"User\");\n        assertNotNull(obj);\n    }\n}\n```\n\n**Benefits:**\n- Shared registry across all tests\n- No ServiceLoader conflicts\n- Fast test execution\n- Consistent state\n\n**When to use:**\n- Standard unit tests\n- Constraint tests\n- Type registration tests\n- Most metadata tests\n\n---\n\n### IsolatedRegistryTestBase (Rare, Special Cases Only)\n\n**Purpose:** Tests that need completely isolated registry state\n\n```java\npublic class SpecialIsolatedTest extends IsolatedRegistryTestBase {\n\n    @Override\n    protected void setupRegistry() {\n        // Custom registry setup\n        registry = createFreshRegistry();\n        // Register only specific types needed\n    }\n\n    @Test\n    public void testWithIsolation() {\n        // Completely isolated registry\n        // No other test interference\n    }\n}\n```\n\n**When to use:**\n- Testing provider registration\n- Testing constraint conflicts\n- Testing registry edge cases\n- <5% of tests\n\n---\n\n## Test Patterns\n\n### Testing Metadata Creation\n\n```java\n@Test\npublic void testMetaObjectCreation() {\n    MetaObject obj = new MetaObject(\"TestObject\");\n    assertEquals(\"TestObject\", obj.getName());\n    assertEquals(\"object\", obj.getTypeName());\n}\n```\n\n### Testing Fields\n\n```java\n@Test\npublic void testFieldTypes() {\n    MetaObject obj = new MetaObject(\"User\");\n\n    IntegerField idField = new IntegerField(\"id\");\n    StringField nameField = new StringField(\"name\");\n\n    obj.addChild(idField);\n    obj.addChild(nameField);\n\n    assertEquals(2, obj.getMetaFields().size());\n}\n```\n\n### Testing Constraints\n\n```java\n@Test\npublic void testPlacementConstraints() {\n    MetaObject obj = new MetaObject(\"TestObject\");\n    MetaField field = new IntegerField(\"testField\");\n\n    // Should succeed\n    obj.addChild(field);\n\n    // Should fail - field under field not allowed\n    try {\n        field.addChild(new StringField(\"nested\"));\n        fail(\"Should throw ConstraintViolationException\");\n    } catch (ConstraintViolationException e) {\n        // Expected\n    }\n}\n```\n\n### Testing Providers\n\n```java\n@Test\npublic void testProviderRegistration() {\n    MetaDataRegistry registry = getSharedRegistry();\n\n    // Verify types registered\n    assertNotNull(registry.getTypeDefinition(\"field\", \"int\"));\n    assertNotNull(registry.getTypeDefinition(\"field\", \"string\"));\n}\n```\n\n---\n\n## Database Testing\n\n### In-Memory Derby\n\n```java\n@Test\npublic void testDatabasePersistence() throws Exception {\n    // 1. Setup in-memory database\n    EmbeddedDataSource dataSource = new EmbeddedDataSource();\n    dataSource.setDatabaseName(\"memory:testdb\");\n    dataSource.setCreateDatabase(\"create\");\n\n    // 2. Initialize ObjectManagerDB\n    ObjectManagerDB objectManager = new ObjectManagerDB();\n    objectManager.setDriverClass(\"com.metaobjects.manager.db.driver.DerbyDriver\");\n    objectManager.setDataSource(dataSource);\n\n    // 3. Test persistence\n    ObjectConnection conn = objectManager.getConnection();\n    try {\n        // Create, read, update, delete\n    } finally {\n        conn.close();\n    }\n}\n```\n\n---\n\n## Running Tests\n\n### All Tests\n\n```bash\ncd ~/Development/metaobjects-core\nmvn test\n```\n\n### Specific Module\n\n```bash\ncd metadata\nmvn test\n```\n\n### Specific Test Class\n\n```bash\nmvn test -Dtest=ConstraintSystemTest\n```\n\n### Single Test Method\n\n```bash\nmvn test -Dtest=ConstraintSystemTest#testPlacementConstraints\n```\n\n### With Debug Logging\n\n```bash\nmvn test -X\n```\n\n---\n\n## Test Organization\n\n### Standard Test Structure\n\n```\nsrc/test/java/\n‚îî‚îÄ‚îÄ com/draagon/meta/\n    ‚îú‚îÄ‚îÄ MetaObjectTest.java\n    ‚îú‚îÄ‚îÄ MetaFieldTest.java\n    ‚îú‚îÄ‚îÄ constraint/\n    ‚îÇ   ‚îú‚îÄ‚îÄ ConstraintSystemTest.java\n    ‚îÇ   ‚îî‚îÄ‚îÄ PlacementConstraintTest.java\n    ‚îú‚îÄ‚îÄ loader/\n    ‚îÇ   ‚îú‚îÄ‚îÄ SimpleLoaderTest.java\n    ‚îÇ   ‚îî‚îÄ‚îÄ FileLoaderTest.java\n    ‚îî‚îÄ‚îÄ manager/\n        ‚îî‚îÄ‚îÄ ObjectManagerTest.java\n```\n\n### Test Resources\n\n```\nsrc/test/resources/\n‚îú‚îÄ‚îÄ metadata/\n‚îÇ   ‚îú‚îÄ‚îÄ test-metadata.json\n‚îÇ   ‚îî‚îÄ‚îÄ test-overlay.json\n‚îú‚îÄ‚îÄ logback-test.xml\n‚îî‚îÄ‚îÄ META-INF/\n    ‚îî‚îÄ‚îÄ services/\n        ‚îî‚îÄ‚îÄ com.draagon.meta.loader.types.MetaDataTypeProvider\n```\n\n---\n\n## Best Practices\n\n### DO:\n\n‚úÖ **Extend SharedRegistryTestBase** for most tests\n‚úÖ **Use @Test annotation** from JUnit 4\n‚úÖ **Clean up resources** in @After or try-finally\n‚úÖ **Test one thing** per test method\n‚úÖ **Use descriptive test names** (testFieldPlacementConstraint)\n‚úÖ **Assert expectations** clearly\n\n### DON'T:\n\n‚ùå **Create separate registries** unless absolutely needed\n‚ùå **Modify shared state** without cleanup\n‚ùå **Use Thread.sleep()** in tests\n‚ùå **Test multiple things** in one method\n‚ùå **Leave resources open** (connections, files)\n\n---\n\n## Common Test Issues\n\n### ServiceLoader Conflicts\n\n**Problem:** Tests fail with duplicate constraint errors on GitHub Actions\n\n**Solution:** Use `SharedRegistryTestBase`\n\n### Registry State\n\n**Problem:** Tests pass individually but fail together\n\n**Solution:**\n```java\n@After\npublic void tearDown() {\n    // Clear any state modified by test\n    MetaDataCache.clear();\n}\n```\n\n### Constraint Naming\n\n**Problem:** Constraint tests fail with \"Name required\"\n\n**Solution:** Follow naming convention: `domain:type:operation`\n\n```java\n@Override\npublic String getName() {\n    return \"metadata:field:placement\";\n}\n```\n\n---\n\n## Test Coverage\n\n### Current Status\n\n**Total Tests:** 232 passing ‚úÖ\n\n**Coverage by Module:**\n- metadata: 150+ tests\n- core: 40+ tests\n- codegen: 15+ tests\n- objectmanager: 10+ tests\n- web: 15+ tests\n\n### Running with Coverage\n\n```bash\nmvn clean test jacoco:report\n# Report in: target/site/jacoco/index.html\n```\n\n---\n\n## Mock Objects\n\n### Mocking MetaData\n\n```java\n@Test\npublic void testWithMockMetaData() {\n    MetaObject mockObject = new MetaObject(\"MockObject\");\n    mockObject.addChild(new IntegerField(\"id\"));\n    mockObject.addChild(new StringField(\"name\"));\n\n    // Test code that uses mockObject\n}\n```\n\n### Mocking Database\n\n```java\n@Test\npublic void testWithMockDatabase() throws Exception {\n    // Use in-memory Derby - no mocking needed!\n    EmbeddedDataSource dataSource = new EmbeddedDataSource();\n    dataSource.setDatabaseName(\"memory:testdb\");\n    dataSource.setCreateDatabase(\"create\");\n\n    // Full functional database in memory\n}\n```\n\n---\n\n## Debugging Tests\n\n### Enable Debug Logging\n\n**Edit src/test/resources/logback-test.xml:**\n\n```xml\n<configuration>\n    <!-- Change WARN to DEBUG -->\n    <logger name=\"com.draagon.meta\" level=\"DEBUG\"/>\n\n    <root level=\"DEBUG\">\n        <appender-ref ref=\"STDOUT\" />\n    </root>\n</configuration>\n```\n\n### Run Single Test with Debug\n\n```bash\nmvn test -Dtest=YourTest -X\n```\n\n### IntelliJ IDEA\n\n1. Right-click test method\n2. Select \"Debug 'testMethod()'\"\n3. Set breakpoints as needed\n\n---\n\n## Continuous Integration\n\n### GitHub Actions\n\nTests run automatically on every push:\n\n```yaml\n# .github/workflows/build.yml\n- name: Run tests\n  run: mvn clean test\n```\n\n**Passes on:** Linux, macOS, Windows\n\n---\n\n## See Also\n\n- [SETUP.md](../SETUP.md) - Build and test commands\n- [constraints.md](constraints.md) - Testing constraints\n- [persistence.md](persistence.md) - Database testing\n- [KNOWN-ISSUES.md](../KNOWN-ISSUES.md) - Common test issues\n\n---\n\n**Last Updated:** 2025-11-15\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/docs/testing.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "md",
        "test"
      ],
      "content_hash": "c233596b05bbc349",
      "size_bytes": 7980,
      "created_at": "2026-01-02T20:42:12.431936"
    },
    {
      "doc_id": "local_metaobjects-core__claude_docs_constraints",
      "source": "local",
      "category": "technical",
      "domain": "java_framework",
      "file_path": "/home/doug/Development/metaobjects-core/.claude/docs/constraints.md",
      "content": "# MetaObjects Constraint System\n\n**Provider-based constraint registration for metadata validation**\n\n**Status:** ‚úÖ Fully Integrated into MetaDataRegistry (v6.2.0+)\n\n---\n\n## Overview\n\nThe MetaObjects constraint system validates metadata structure and properties during construction and modification.\n\n**Key Principle:** Provider-based registration with runtime enforcement.\n\n---\n\n## Constraint Types\n\n### PlacementConstraint\n\n**Purpose:** Control where metadata can be placed in the hierarchy\n\n**Example:** \"Field can only be child of Object\"\n\n```java\npublic class FieldPlacementConstraint implements PlacementConstraint {\n    @Override\n    public boolean appliesTo(MetaData parent, MetaData child) {\n        return child instanceof MetaField;\n    }\n\n    @Override\n    public void validate(MetaData parent, MetaData child, ValidationContext context) {\n        if (!(parent instanceof MetaObject)) {\n            throw new ConstraintViolationException(\n                \"Field '\" + child.getName() + \"' can only be placed under MetaObject\");\n        }\n    }\n}\n```\n\n### ValidationConstraint\n\n**Purpose:** Validate metadata properties and attributes\n\n**Example:** \"Name must match pattern\"\n\n```java\npublic class NamePatternConstraint implements ValidationConstraint {\n    private final Pattern pattern = Pattern.compile(\"^[a-zA-Z][a-zA-Z0-9_]*$\");\n\n    @Override\n    public boolean appliesTo(MetaData metadata) {\n        return true; // Applies to all metadata\n    }\n\n    @Override\n    public void validate(MetaData metadata, String propertyName, ValidationContext context) {\n        if (\"name\".equals(propertyName)) {\n            if (!pattern.matcher(metadata.getName()).matches()) {\n                throw new ConstraintViolationException(\n                    \"Name must start with letter and contain only letters, numbers, underscores\");\n            }\n        }\n    }\n}\n```\n\n---\n\n## Constraint Registration\n\n### Provider Pattern\n\n**All constraints registered via MetaDataTypeProvider:**\n\n```java\npublic class CoreTypesMetaDataProvider implements MetaDataTypeProvider {\n\n    @Override\n    public void registerTypes(MetaDataRegistry registry) {\n        // Register types\n        MetaObject.registerTypes(registry);\n        MetaField.registerTypes(registry);\n\n        // Register constraints\n        registerConstraints(registry);\n    }\n\n    private void registerConstraints(MetaDataRegistry registry) {\n        // Placement constraints\n        registry.addPlacementConstraint(new FieldPlacementConstraint());\n        registry.addPlacementConstraint(new AttributePlacementConstraint());\n\n        // Validation constraints\n        registry.addValidationConstraint(new NamePatternConstraint());\n        registry.addValidationConstraint(new RequiredAttributeConstraint());\n    }\n\n    @Override\n    public int getPriority() {\n        return 10; // Core constraints have high priority\n    }\n}\n```\n\n---\n\n## Constraint Naming Convention\n\n**Format:** `{domain}:{type}:{operation}`\n\n**Examples:**\n- `metadata:field:placement` - Field placement constraint\n- `metadata:object:validation` - Object validation constraint\n- `enterprise:security:validation` - Enterprise security validation\n\n**Why:** Clear identification, prevents conflicts, enables filtering\n\n---\n\n## Unified Registry Architecture\n\n### Before (Separate Registries):\n```java\n// OLD - Separate constraint registry\nConstraintRegistry constraintRegistry = ...;\nMetaDataRegistry typeRegistry = ...;\n\n// Two places to look for configuration\n```\n\n### After (Integrated):\n```java\n// NEW - Single unified registry\nMetaDataRegistry registry = ...;\n\n// Types and constraints in one place\nregistry.registerType(MetaField.class, def -> ...);\nregistry.addValidationConstraint(new NamePatternConstraint());\n```\n\n**Benefits:**\n- ‚úÖ Single source of truth\n- ‚úÖ Unified API\n- ‚úÖ Simpler debugging\n- ‚úÖ Better performance\n\n---\n\n## Enforcement\n\n### Automatic Enforcement\n\n**Constraints enforced automatically during:**\n\n1. **addChild()** - When adding child metadata\n   ```java\n   metaObject.addChild(metaField); // Checks placement constraints\n   ```\n\n2. **setAttribute()** - When setting attributes\n   ```java\n   metaData.setAttribute(\"name\", \"value\"); // Validates attribute\n   ```\n\n3. **Construction** - During metadata creation\n   ```java\n   new MetaField(\"fieldName\"); // Validates name pattern\n   ```\n\n### Enforcement Workflow\n\n```java\npublic void enforceConstraintsOnAddChild(MetaData parent, MetaData child) {\n    ValidationContext context = ValidationContext.forAddChild(parent, child);\n\n    // Get all constraints from unified registry\n    List<Constraint> allConstraints = metaDataRegistry.getAllValidationConstraints();\n\n    // 1. Check placement constraints\n    for (Constraint constraint : allConstraints) {\n        if (constraint instanceof PlacementConstraint) {\n            PlacementConstraint pc = (PlacementConstraint) constraint;\n            if (pc.appliesTo(parent, child)) {\n                pc.validate(parent, child, context);\n            }\n        }\n    }\n\n    // 2. Validate child properties\n    for (Constraint constraint : allConstraints) {\n        if (constraint instanceof ValidationConstraint) {\n            ValidationConstraint vc = (ValidationConstraint) constraint;\n            if (vc.appliesTo(child)) {\n                vc.validate(child, child.getName(), context);\n            }\n        }\n    }\n}\n```\n\n---\n\n## Built-In Constraints\n\n### Core Placement Constraints\n\n**FieldPlacementConstraint:**\n- Fields can only be children of Objects\n- Prevents field hierarchies\n\n**AttributePlacementConstraint:**\n- Attributes can be children of any MetaData\n- Flexible attribute system\n\n**ViewPlacementConstraint:**\n- Views can only be children of Objects\n- View organization\n\n### Core Validation Constraints\n\n**NamePatternConstraint:**\n- Names must match: `^[a-zA-Z][a-zA-Z0-9_]*$`\n- Starts with letter\n- Contains only letters, numbers, underscores\n\n**RequiredAttributeConstraint:**\n- Certain metadata types require specific attributes\n- Example: DecimalField requires @precision\n\n**TypeSubTypeConstraint:**\n- Validates type/subType combinations\n- Prevents invalid type hierarchies\n\n---\n\n## Custom Constraints\n\n### Creating Custom Constraint\n\n```java\npublic class EmailValidationConstraint implements ValidationConstraint {\n    private static final Pattern EMAIL_PATTERN =\n        Pattern.compile(\"^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+$\");\n\n    @Override\n    public boolean appliesTo(MetaData metadata) {\n        // Only apply to fields with subType \"email\"\n        return metadata instanceof MetaField &&\n               \"email\".equals(metadata.getSubTypeName());\n    }\n\n    @Override\n    public void validate(MetaData metadata, String propertyName, ValidationContext context) {\n        if (\"defaultValue\".equals(propertyName)) {\n            String value = metadata.getAttributeValue(\"defaultValue\");\n            if (value != null && !EMAIL_PATTERN.matcher(value).matches()) {\n                throw new ConstraintViolationException(\n                    \"Default value must be valid email address\");\n            }\n        }\n    }\n\n    @Override\n    public String getName() {\n        return \"custom:email:validation\";\n    }\n}\n```\n\n### Registering Custom Constraint\n\n```java\npublic class CustomTypesMetaDataProvider implements MetaDataTypeProvider {\n\n    @Override\n    public void registerTypes(MetaDataRegistry registry) {\n        // Register custom types\n        EmailField.registerTypes(registry);\n\n        // Register custom constraints\n        registry.addValidationConstraint(new EmailValidationConstraint());\n    }\n\n    @Override\n    public int getPriority() {\n        return 50; // After core (10), before application (100)\n    }\n}\n```\n\n### ServiceLoader Registration\n\n```\n# META-INF/services/com.draagon.meta.loader.types.MetaDataTypeProvider\ncom.example.custom.CustomTypesMetaDataProvider\n```\n\n---\n\n## Constraint Priority\n\n**Provider priority determines constraint order:**\n\n```java\nPriority 10  - Core constraints (framework)\nPriority 25  - Enterprise constraints\nPriority 50  - Plugin constraints\nPriority 100 - Application constraints\n```\n\n**Lower priority = executed first**\n\n---\n\n## Performance\n\n### Optimizations\n\n**Single Enforcement Path:**\n- Before: 4 separate constraint checks\n- After: 1 unified loop\n- Result: **3x fewer constraint calls**\n\n**Efficient Storage:**\n- Constraints cached in ArrayList\n- O(n) iteration only when needed\n- No duplicate processing\n\n**Lazy Evaluation:**\n- `appliesTo()` filters before validation\n- Only relevant constraints executed\n- Minimal overhead\n\n---\n\n## Testing Constraints\n\n### Unit Test Example\n\n```java\n@Test\npublic void testFieldPlacementConstraint() {\n    MetaObject obj = new MetaObject(\"TestObject\");\n    MetaField field = new IntegerField(\"testField\");\n\n    // Should succeed\n    obj.addChild(field);\n\n    // Should fail - field under field not allowed\n    try {\n        field.addChild(new StringField(\"nested\"));\n        fail(\"Should throw ConstraintViolationException\");\n    } catch (ConstraintViolationException e) {\n        // Expected\n    }\n}\n```\n\n### Running Constraint Tests\n\n```bash\ncd ~/Development/metaobjects-core/metadata\nmvn test -Dtest=ConstraintSystemTest\n```\n\n---\n\n## Debugging Constraints\n\n### Enable Constraint Logging\n\n```java\n// In logback.xml or logback-test.xml\n<logger name=\"com.draagon.meta.constraint\" level=\"DEBUG\"/>\n```\n\n### Validation Context\n\n```java\nValidationContext context = ValidationContext.forAddChild(parent, child);\ncontext.setDebugMode(true); // Enables detailed logging\n\n// Shows which constraints applied\n// Shows validation steps\n// Shows failures with context\n```\n\n---\n\n## Best Practices\n\n### DO:\n\n‚úÖ **Register via Provider** - Use MetaDataTypeProvider\n‚úÖ **Name Consistently** - Follow `domain:type:operation` pattern\n‚úÖ **Filter Efficiently** - `appliesTo()` should be fast\n‚úÖ **Fail Fast** - Throw clear exceptions early\n‚úÖ **Document Constraints** - Explain what and why\n\n### DON'T:\n\n‚ùå **Add Directly to Registry** - Use provider pattern\n‚ùå **Skip Naming Convention** - Maintain consistency\n‚ùå **Validate in appliesTo()** - Use separate validate() method\n‚ùå **Catch and Ignore** - Let exceptions propagate\n‚ùå **Create Rigid Constraints** - Allow extensibility\n\n---\n\n## Common Patterns\n\n### Conditional Validation\n\n```java\n@Override\npublic void validate(MetaData metadata, String propertyName, ValidationContext context) {\n    if (metadata.hasAttribute(\"@required\")) {\n        boolean required = metadata.getBooleanAttribute(\"@required\", false);\n        if (required && metadata.getAttributeValue(propertyName) == null) {\n            throw new ConstraintViolationException(\n                propertyName + \" is required\");\n        }\n    }\n}\n```\n\n### Cross-Field Validation\n\n```java\n@Override\npublic void validate(MetaData metadata, String propertyName, ValidationContext context) {\n    if (metadata instanceof DecimalField) {\n        int precision = metadata.getIntAttribute(\"@precision\", 19);\n        int scale = metadata.getIntAttribute(\"@scale\", 2);\n\n        if (scale > precision) {\n            throw new ConstraintViolationException(\n                \"Scale cannot exceed precision\");\n        }\n    }\n}\n```\n\n### Hierarchical Constraints\n\n```java\n@Override\npublic boolean appliesTo(MetaData parent, MetaData child) {\n    // Only apply if parent is specific type\n    return parent instanceof MetaObject &&\n           \"entity\".equals(parent.getSubTypeName());\n}\n```\n\n---\n\n## Migration from Old System\n\n### JSON Constraints (Deprecated)\n\n**Old Way:**\n```json\n{\n  \"constraint\": {\n    \"name\": \"field:placement\",\n    \"type\": \"placement\",\n    \"target\": {\"type\": \"field\"}\n  }\n}\n```\n\n**New Way:**\n```java\nregistry.addPlacementConstraint(new FieldPlacementConstraint());\n```\n\n**Benefits:**\n- Compile-time safety\n- Better IDE support\n- Easier debugging\n- Performance improvements\n\n---\n\n## See Also\n\n- [ARCHITECTURE.md](../ARCHITECTURE.md) - Provider-based registration\n- [type-system.md](type-system.md) - Field types and validation\n- [testing.md](testing.md) - Testing constraints\n- [KNOWN-ISSUES.md](../KNOWN-ISSUES.md) - Common constraint problems\n\n---\n\n**Last Updated:** 2025-11-15\n**Version:** 6.2.0+\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "metaobjects-core/.claude/docs/constraints.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "ac3ed0404397943d",
      "size_bytes": 12166,
      "created_at": "2026-01-02T20:42:12.432012"
    },
    {
      "doc_id": "local_party-lore_ARC-BEAT-SCENE-ANALYSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/ARC-BEAT-SCENE-ANALYSIS.md",
      "content": "# Arc/Beat/Scene Architecture Analysis & Recommendation\n\n**Date**: November 10, 2025\n**Context**: User experiencing confusion with scene objectives being too prescriptive vs. beat objectives feeling \"just right\"\n\n---\n\n## Current State: Your Game\n\n```\nArc: \"The Blackwood Wyvern\" (bounty hunt)\n‚îú‚îÄ Beat 1: \"Accept contract, investigate attacks\" [NOT_RESOLVED]\n‚îÇ  ‚îú‚îÄ Scene 1: \"Blood on the Baron's Threshold\" [RESOLVED ‚úÖ]\n‚îÇ  ‚îÇ  ‚îî‚îÄ Objective: \"Interview survivors, examine attack site\" ‚úÖ DONE\n‚îÇ  ‚îî‚îÄ Scene 2: \"Blood on the Wind\" [IN_PROGRESS ‚è≥]\n‚îÇ     ‚îî‚îÄ Objective: \"Interview at least two survivors...\" ‚ùå ALREADY DID THIS!\n‚îú‚îÄ Beat 2: \"Track the wyvern through dangerous terrain\"\n‚îú‚îÄ Beat 3: \"Infiltrate the lair\"\n‚îú‚îÄ Beat 4: \"Defeat the Blackwood Wyvern\"\n‚îî‚îÄ Beat 5: \"Collect payment, decide what to sell\"\n```\n\n**Your Observation**: \"I'm already past interviewing survivors. Why is the scene telling me to do it again?\"\n\n---\n\n## The Three Architectures Compared\n\n| Dimension | **ARCS** | **BEATS** | **SCENES** |\n|-----------|----------|-----------|------------|\n| **Scope** | Overall story (8-12 sessions) | Major milestone (2-3 sessions) | Tactical unit (1-2 sessions) |\n| **Example** | \"The Blackwood Wyvern bounty hunt\" | \"Gather intelligence about wyvern\" | \"Interview survivors at tavern\" |\n| **Metadata Richness** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê |\n| **AI Context Use** | ‚ùå NOT passed to AI | ‚ùå NOT passed to AI | ‚ö†Ô∏è Only `objective` passed |\n| **Objective Type** | Broad conflict | Flexible milestone | **Prescriptive task** |\n| **Updates Dynamically?** | No | No | **No (PROBLEM!)** |\n| **NPC Templates** | ‚úÖ Arc-level roles | ‚úÖ Rich templates in beats | ‚ùå None |\n| **Progression Tracking** | Phase-based (SETUP‚ÜíCLIMAX) | Counts scenes (2 per beat) | 0-100% progress |\n| **Completion Detection** | All beats resolved | 2 scenes resolved | 100% progress OR AI marks complete |\n\n---\n\n## Root Cause Analysis\n\n### Why Beat Objectives Feel Better\n\n**Beat**: \"Accept the contract, investigate attack patterns\"\n- **Flexible**: Can accomplish via multiple paths\n- **Broad enough**: Covers interviewing, examining sites, gathering supplies\n- **Feels natural**: Matches player agency\n\n**Scene**: \"Interview at least two survivors from different villages\"\n- **Prescriptive**: Tells you HOW to accomplish goal\n- **Too narrow**: Locks you into specific approach\n- **Gets stale**: You already did this in Scene 1!\n\n### Why Scene Objectives Become Stale\n\n**Scene Generation Flow** (from code analysis):\n\n```\n1. Arc starts ‚Üí AI generates 5 beats with descriptions\n2. Beat 1 starts ‚Üí AI generates Scene 1 with objective\n3. Scene 1 completes ‚Üí AI generates Scene 2 with objective\n4. Scene 2 starts with STATIC objective from creation\n   ‚îî‚îÄ Problem: Doesn't account for what happened in Scene 1!\n```\n\n**Example Timeline**:\n```\nSession 1 (Scene 1): Players interview 3 survivors, examine attack site, get contract\n  ‚îî‚îÄ Scene completes with 100% progress ‚úÖ\n\nSession 2 (Scene 2): New scene generated at Scene 1 completion\n  ‚îî‚îÄ Objective: \"Interview at least two survivors...\"\n  ‚îî‚îÄ BUT PLAYERS ALREADY DID THIS! ‚ùå\n\nAI during gameplay:\n  ‚îî‚îÄ Sees: \"Scene objective: Interview survivors\"\n  ‚îî‚îÄ Doesn't see: \"Beat objective: Investigate attack patterns\"\n  ‚îî‚îÄ Doesn't know: Players already interviewed survivors\n  ‚îî‚îÄ Result: Narrative confusion, repetitive objectives\n```\n\n---\n\n## Pros & Cons Grid\n\n### Option 1: Keep All Three (Status Quo)\n\n**PROS**:\n- ‚úÖ Most granular tracking\n- ‚úÖ Clear separation of concerns (arc=campaign, beat=chapter, scene=session)\n- ‚úÖ Already fully implemented\n\n**CONS**:\n- ‚ùå Scene objectives become stale/prescriptive\n- ‚ùå AI doesn't receive beat/arc context during gameplay\n- ‚ùå Players confused by mismatched objectives\n- ‚ùå Three layers = cognitive overhead\n- ‚ùå Over-fragmented for async SMS gameplay\n\n**VERDICT**: **Don't do this** - this is the current problem state\n\n---\n\n### Option 2: Arc + Beat Only (Remove Scenes)\n\n**PROS**:\n- ‚úÖ Simplifies to 2 layers (easier to understand)\n- ‚úÖ Beats have RICH metadata (descriptions, NPC templates, narrative impact)\n- ‚úÖ Beat objectives are flexible and broad\n- ‚úÖ 1 beat = ~2-3 sessions (good pacing for async SMS)\n- ‚úÖ Beats already well-structured with phases (SETUP‚ÜíCLIMAX‚ÜíRESOLUTION)\n- ‚úÖ NPC lifecycle management built into beats (MAJOR vs MINOR)\n- ‚úÖ Matches user's mental model: \"I like how beats are structured\"\n\n**CONS**:\n- ‚ùå Lose granular session-by-session tracking\n- ‚ùå Harder to track \"did we complete this specific conversation?\"\n- ‚ùå Beat completion = 2 scenes (hardcoded heuristic, less precise)\n- ‚ùå Opening narratives currently tied to scenes\n\n**SOLUTION TO CONS**:\n- Track individual player actions/conversations via `SceneProgression` (rename to `BeatProgression`)\n- Beat progress = 0-100% based on cumulative actions\n- Opening narratives can be beat-level: \"You begin investigating the wyvern attacks...\"\n- Remove hardcoded \"2 scenes\" heuristic, use 100% progress instead\n\n**CODE IMPACT**:\n```java\n// BEFORE (Scene-based)\nScene scene = new Scene();\nscene.setObjective(\"Interview survivors\");\nscene.setBeat(beat);\nsceneProgressionRepository.save(new SceneProgression(session, scene, objective));\n\n// AFTER (Beat-based)\nBeatProgression progression = new BeatProgression(session, beat);\nprogression.setObjective(beat.getBeatDescription()); // Use beat description directly\nprogression.setProgress(0);\nbeatProgressionRepository.save(progression);\n\n// Turn-by-turn AI receives\nString prompt = \"\"\"\n  BEAT: %s\n  NARRATIVE IMPACT: %s\n  ARC CONFLICT: %s\n  CURRENT PROGRESS: %d%%\n  \"\"\".formatted(\n    beat.getBeatDescription(),\n    beat.getNarrativeImpact(),\n    arc.getCentralConflict(),\n    progression.getProgress()\n  );\n```\n\n**VERDICT**: ‚≠ê‚≠ê‚≠ê‚≠ê **STRONG CANDIDATE** - Simpler, richer context, matches user expectations\n\n---\n\n### Option 3: Arc + Scene Only (Remove Beats)\n\n**PROS**:\n- ‚úÖ Simplifies to 2 layers\n- ‚úÖ Scenes are tactical units (match SMS async gameplay)\n- ‚úÖ Existing scene mechanics (opening narrative, setup prompts)\n\n**CONS**:\n- ‚ùå Scenes have WEAK metadata compared to beats\n- ‚ùå No NPC templates in scenes (beats have rich NPC data)\n- ‚ùå No story structure phases (beats have SETUP‚ÜíCLIMAX)\n- ‚ùå Scene objectives are the PROBLEM we're trying to fix\n- ‚ùå Lose beat narrative impact tracking\n- ‚ùå Lose NPC lifecycle management (MAJOR/MINOR pruning)\n\n**VERDICT**: ‚ùå **DO NOT RECOMMEND** - Throws away the well-designed part (beats)\n\n---\n\n### Option 4: Arc + Beat + Scene (Pass Beat Context to AI)\n\n**PROS**:\n- ‚úÖ Keep all three layers\n- ‚úÖ Quick fix (just change prompts)\n- ‚úÖ AI gets broader context for better narratives\n- ‚úÖ No database migration needed\n\n**CONS**:\n- ‚ùå Doesn't fix static scene objectives problem\n- ‚ùå Still 3 layers of complexity\n- ‚ùå Scene objectives still get stale\n- ‚ùå Band-aid on architectural issue\n\n**CODE CHANGE**:\n```java\n// Modify TwoTierNarrativeService.buildTier1Request()\nString sceneObjective = extractSceneObjective(request);\nSimplePlotBeat currentBeat = extractCurrentBeat(request);\nActiveStoryArc currentArc = extractCurrentArc(request);\n\nString tier1Prompt = basePrompt + \"\"\"\n  ARC: %s\n  CENTRAL CONFLICT: %s\n\n  BEAT: %s\n  NARRATIVE IMPACT: %s\n\n  SCENE OBJECTIVE: %s\n\n  Progress this SCENE objective while keeping the BEAT goal in mind.\n  \"\"\".formatted(\n    currentArc.getArcName(),\n    currentArc.getCentralConflict(),\n    currentBeat.getBeatDescription(),\n    currentBeat.getNarrativeImpact(),\n    sceneObjective\n  );\n```\n\n**VERDICT**: ‚≠ê‚≠ê‚≠ê **QUICK WIN** but not long-term solution\n\n---\n\n### Option 5: Make Scene Objectives Dynamic (AI-Updated)\n\n**PROS**:\n- ‚úÖ Scenes adapt to story progress\n- ‚úÖ Keeps granular tracking\n- ‚úÖ Fixes stale objective problem\n\n**CONS**:\n- ‚ùå Most complex to implement\n- ‚ùå Requires AI calls to regenerate objectives\n- ‚ùå May confuse players if objective changes mid-session\n- ‚ùå Still 3-layer complexity\n- ‚ùå Expensive (AI tokens to update objectives frequently)\n\n**VERDICT**: ‚ùå **TOO COMPLEX** for the benefit\n\n---\n\n## Context Richness Analysis\n\n### Current Context Available (But Not Used!)\n\n**Locations** (`NamedLocation`):\n```java\nname: \"Baron's Manor\"\ndescription: \"A fortified estate on the hill overlooking the village\"\nlocationType: BUILDING\ncurrentStatus: \"Recently attacked by wyvern\"\nimportanceScore: 0.85 (AI-calculated)\n```\n\n**NPCs** (from `beat.keyNpcsJson`):\n```json\n{\n  \"name\": \"Baron Aldric\",\n  \"role\": \"AUTHORITY\",\n  \"personality\": \"Gruff, experienced veteran with a scarred face\",\n  \"motivation\": \"Protect his people, maintain order\",\n  \"importance\": \"MAJOR\"\n}\n```\n\n**Arcs**:\n```java\narcName: \"The Blackwood Wyvern\"\ncentralConflict: \"A massive wyvern is terrorizing villages in the Thornhaven region\"\narcType: ACTION (bounty_hunt)\nestimatedSessions: 8-12\ncurrentPhase: SETUP\n```\n\n**Beats**:\n```java\nbeatDescription: \"Baron Aldric summons the Dragon's Hoard to investigate wyvern attacks\"\nnarrativeImpact: \"Players learn the scale of the threat and accept the contract\"\nkeyNpcsJson: [Baron Aldric template, Survivor templates]\npriority: CRITICAL\n```\n\n**Players** (from `GameContext`):\n```java\ncharacterName: \"Axle\"\ncharacterClass: \"Rogue\"\ncharacterVoice: \"Sarcastic, cautious, always looks for angles\"\nplayerStats: { hp: 45/50 }\n```\n\n### ‚ùå CRITICAL FINDING: Context Exists But Isn't Passed to AI!\n\n**What AI SHOULD receive during turn-by-turn narrative**:\n```\nArc Central Conflict: \"Massive wyvern terrorizing Thornhaven region\"\nBeat Description: \"Baron summons party to investigate attacks\"\nBeat Narrative Impact: \"Players learn threat scale and accept contract\"\nCurrent Location: \"Baron's Manor\" (fortified estate, recently attacked)\nKey NPCs: Baron Aldric (gruff veteran, wants to protect people)\nPlayer: Axle (sarcastic rogue, cautious)\nRecent Events: [Memory fragments from previous turns]\nBeat Progress: 45% complete\n```\n\n**What AI ACTUALLY receives** (from code analysis):\n```\nScene Objective: \"Interview at least two survivors from different villages\"\nPlayer: Axle\nRecent Events: [Memory fragments]\n```\n\n**Impact**: AI operates with 10% of available context!\n\n---\n\n## Your Insights Are Spot-On\n\n### \"We need MORE context for AI\"\n\n**You're absolutely right**:\n- Location descriptions exist but aren't emphasized to AI\n- NPC motivations/personalities exist but not highlighted\n- Arc conflicts exist but not included in prompts\n- Beat narrative impacts exist but not used\n\n**Example of what's MISSING**:\n\nCurrent Tier 1 prompt:\n```\nSCENE OBJECTIVE: Interview survivors\nPlayer action: \"Axle heads up the stairs to meet the Baron\"\n```\n\nWhat it SHOULD be:\n```\nARC: The Blackwood Wyvern (massive wyvern terrorizing Thornhaven)\nBEAT: Baron summons party to investigate (reveal threat scale, accept contract)\nLOCATION: Baron's Manor (fortified estate on hill, recently attacked by wyvern)\nNPC: Baron Aldric (gruff veteran, scarred face, wants to protect his people)\n\nPlayer action: \"Axle heads up the stairs to meet the Baron\"\n\nGenerate narrative showing Axle's approach to meeting the Baron,\nkeeping in mind the broader goal of learning about the wyvern threat.\n```\n\n### \"Could use AI to generate and update contexts\"\n\n**Excellent idea**:\n- Locations could have AI-generated `recentEvents` field: \"Recently attacked, claw marks on walls\"\n- NPCs could have AI-updated `currentMood`: \"Anxious about recent wyvern sightings\"\n- Beat progress could have AI-generated `keyDevelopments`: \"Players learned wyvern hunts at night\"\n\n**Implementation**:\n```java\n// After each turn, update location context\npublic void updateLocationContext(NamedLocation location, String whatHappened) {\n    String prompt = \"\"\"\n      Location: %s\n      Current status: %s\n      What just happened: %s\n\n      Generate updated 1-sentence status describing current state.\n      Focus on recent developments that would be visible/known.\n      \"\"\".formatted(location.getName(), location.getCurrentStatus(), whatHappened);\n\n    String newStatus = callClaudeForStatusUpdate(prompt);\n    location.setCurrentStatus(newStatus);\n    locationRepository.save(location);\n}\n```\n\n---\n\n## Final Recommendation\n\n### üèÜ PRIMARY RECOMMENDATION: Option 2 (Arc + Beat Only)\n\n**Remove Scenes entirely. Use Beats as the primary gameplay unit.**\n\n**Why**:\n1. ‚úÖ **Beats already have everything we need**: Rich descriptions, NPC templates, narrative impact, story phases\n2. ‚úÖ **Matches your mental model**: \"I like how beats are structured\"\n3. ‚úÖ **Fixes the root problem**: Beat objectives are flexible (\"investigate\"), scene objectives are prescriptive (\"interview 2 survivors\")\n4. ‚úÖ **Simplifies architecture**: 2 layers instead of 3\n5. ‚úÖ **Better for async SMS**: 1 beat = 2-3 sessions (right pacing)\n6. ‚úÖ **NPC management built-in**: MAJOR/MINOR importance, pruning on arc completion\n\n**How It Would Work**:\n\n```\nArc: \"The Blackwood Wyvern\"\n‚îú‚îÄ Beat 1: \"Gather intelligence\" [0% ‚Üí 100% over 2-3 sessions]\n‚îÇ  ‚îî‚îÄ Turn 1: \"Interview Baron\" ‚Üí +15% progress\n‚îÇ  ‚îî‚îÄ Turn 2: \"Examine attack site\" ‚Üí +20% progress\n‚îÇ  ‚îî‚îÄ Turn 3: \"Talk to survivors\" ‚Üí +25% progress\n‚îÇ  ‚îî‚îÄ Turn 4: \"Review evidence\" ‚Üí +40% progress ‚Üí BEAT COMPLETES ‚úÖ\n‚îú‚îÄ Beat 2: \"Track the wyvern\" [Starts after Beat 1]\n‚îî‚îÄ ...\n```\n\n**Implementation Path**:\n\n**Phase 1: Quick Win (This Week)**\n- Modify `TwoTierNarrativeService` to pass beat/arc context to AI\n- Use `beat.getBeatDescription()` as the objective\n- Still track via `SceneProgression` table (rename later)\n\n**Phase 2: Database Migration (Next Week)**\n- Rename `scenes` ‚Üí `beat_instances` (or deprecate entirely)\n- Rename `scene_progression` ‚Üí `beat_progression`\n- Update foreign keys\n- Migrate existing scene objectives to use beat descriptions\n\n**Phase 3: Context Enrichment (Ongoing)**\n- Add AI-generated status updates for locations\n- Add AI-generated mood/state for NPCs\n- Pass all rich context to narrative AI\n\n---\n\n### ü•à FALLBACK RECOMMENDATION: Option 4 (Quick Context Fix)\n\nIf you want **minimal disruption** but **immediate improvement**:\n\n1. Modify `TwoTierNarrativeService.buildTier1Request()` to inject beat/arc context\n2. Keep all three layers for now\n3. Observe if richer context fixes the narrative quality issues\n\n**This is a safe first step** that doesn't break anything and can be done in ~2 hours.\n\n---\n\n## Implementation Checklist\n\n### If Going with Option 2 (Arc + Beat Only):\n\n**Phase 1: Context Injection (Do This First)**\n- [ ] Add `extractCurrentBeat()` and `extractCurrentArc()` methods\n- [ ] Modify `buildTier1Request()` to include beat description, narrative impact, arc conflict\n- [ ] Modify `buildTier2Request()` to include same context\n- [ ] Test with your current game to see if narratives improve\n\n**Phase 2: Objective Simplification**\n- [ ] Change scene generation to use `beat.getBeatDescription()` as objective\n- [ ] Update `extractSceneObjective()` to fallback to beat description\n- [ ] Remove scene-specific objective generation\n\n**Phase 3: Database Schema (Can Wait)**\n- [ ] Create migration to rename `scene_progression` ‚Üí `beat_progression`\n- [ ] Update repository interfaces\n- [ ] Update service layer\n- [ ] Deprecate scene-level objectives (make nullable)\n\n**Phase 4: Context Enrichment**\n- [ ] Add `updateLocationContext()` service\n- [ ] Add `updateNPCContext()` service\n- [ ] Call after each turn to keep contexts fresh\n- [ ] Pass updated contexts to AI\n\n---\n\n## Questions for You\n\n1. **Immediate action**: Should I start with Option 4 (quick context fix) to see if it helps?\n2. **Long-term direction**: Do you want to move toward Option 2 (Arc+Beat only)?\n3. **Context updates**: Should we implement AI-generated context updates for locations/NPCs?\n4. **Beat pacing**: Is 2-3 sessions per beat the right pacing, or should we adjust?\n\n---\n\n## Conclusion\n\nYour instincts are **100% correct**:\n- ‚úÖ Beats are well-structured (keep them!)\n- ‚úÖ Scenes feel redundant/confusing (consider removing)\n- ‚úÖ Need more context passed to AI (critical issue!)\n- ‚úÖ Dynamic context updates would help (great idea!)\n\nThe architecture is **good but underutilized**. Rich context exists but isn't being passed to the AI during gameplay. **Fix the context flow first**, then consider architectural simplification.\n\n**Recommended Next Step**: Implement Option 4 (pass beat/arc context to AI) as a quick win, then evaluate if Option 2 (remove scenes) is still needed.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/ARC-BEAT-SCENE-ANALYSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "ac651721abb5fc5e",
      "size_bytes": 16496,
      "created_at": "2026-01-02T20:42:12.432795"
    },
    {
      "doc_id": "local_party-lore_TEST-FIXES-P0-CRITICAL",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/TEST-FIXES-P0-CRITICAL.md",
      "content": "# üö® CRITICAL TEST FIXES - Priority 0\n\n**Date**: November 9, 2025\n**Test Suite**: quick (14m 49s)\n**Status**: FAILED (2/5 scenarios passed)\n**Issues**: 39 total (5 CRITICAL, 11 HIGH, 16 MEDIUM, 7 LOW)\n**Average Quality Score**: 4.6/10 (Target: 7.0+/10)\n\n---\n\n## üìä Executive Summary\n\nAutonomous testing revealed **5 CRITICAL production bugs** that are breaking core narrative generation:\n\n1. **GM sends duplicate/stale responses** (~30% of turns)\n2. **GM narrates OTHER players' actions before they act**\n3. **Setting shifts from modern horror ‚Üí medieval fantasy mid-game**\n4. **GM responds BEFORE player action is persisted** (race condition)\n5. **NPC counts don't match registered NPCs** (2 registered ‚Üí 3 appear)\n\nThese issues cause:\n- ‚ùå **Player actions ignored/lost** ‚Üí frustration, loss of agency\n- ‚ùå **Narrative contradictions** ‚Üí immersion breaks\n- ‚ùå **Genre inconsistency** ‚Üí confusing world-building\n- ‚ùå **No mechanical feedback** ‚Üí actions feel meaningless\n\n**All issues are in PRODUCTION code** - this is not test infrastructure bugs.\n\n---\n\n## üî• CRITICAL ISSUE #1: Duplicate GM Responses (P0)\n\n### Problem\n\nGM sends identical responses to different player actions, completely ignoring new actions.\n\n**Evidence from Test Report** (Scenario 3, lines 402-456):\n\n```\nTurn 1, Action 1:\n  Brenna: \"I suggest we split up - I'll take Building C perimeter\"\n  GM Response: \"üé≠ THE STORY BEGINS... Static crackles... [opening narrative]\"\n\nTurn 2, Action 2:\n  Brenna: \"I carefully scan the shadowy area near Building C with radiation detector\"\n  GM Response: IDENTICAL \"üé≠ THE STORY BEGINS... Static crackles...\"\n               ^^^ EXACT SAME RESPONSE - NEW ACTION COMPLETELY IGNORED!\n```\n\n**Frequency**: ~30% of responses are duplicates\n\n### Root Cause\n\nLikely causes (investigate in order):\n\n1. **Response caching returning stale content**\n   - Cache key not including player action ID\n   - Cache not being invalidated after response\n\n2. **Narrative request not including latest action**\n   - Using cached/stale player action object\n   - Not fetching latest action from database before generation\n\n3. **Transaction isolation issue**\n   - Reading uncommitted player action\n   - Action text not visible to narrative service\n\n### Fix Location\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n\n**Current Code** (suspected issue):\n```java\n@Cacheable(value = \"narratives\", key = \"#request.hashCode()\")\npublic NarrativeResponse generateNarrative(NarrativeRequest request) {\n    // Problem: hashCode() may not change if request object is reused\n    // Solution: Use player action ID as cache key\n}\n```\n\n**Recommended Fix**:\n\n```java\n// Change cache key to use player action ID (unique per action)\n@Cacheable(value = \"narratives\", key = \"#request.playerAction?.id ?: 'no-action'\")\npublic NarrativeResponse generateNarrative(NarrativeRequest request) {\n    // Validate request contains a new action\n    PlayerAction action = request.getPlayerAction();\n    if (action != null && action.getStatus() == ActionStatus.PROCESSED) {\n        throw new IllegalStateException(\n            \"Player action \" + action.getId() + \" has already been processed. \" +\n            \"Cannot generate duplicate narrative response.\"\n        );\n    }\n\n    // Verify we're using the LATEST action text from database\n    if (action != null) {\n        PlayerAction freshAction = playerActionRepository.findById(action.getId())\n            .orElseThrow(() -> new IllegalStateException(\"Action not found: \" + action.getId()));\n\n        if (!action.getActionText().equals(freshAction.getActionText())) {\n            logger.warn(\"Player action {} has stale text. Using fresh from DB.\", action.getId());\n            request.setPlayerAction(freshAction);\n        }\n    }\n\n    // Continue with narrative generation...\n    logger.info(\"Generating narrative for action: {} - {}\",\n                action.getId(),\n                action.getActionText().substring(0, Math.min(50, action.getActionText().length())));\n\n    // ... existing generation logic\n}\n```\n\n**Additional Changes**:\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/context/NarrativeRequestBuilder.java`\n\nAdd validation in request building:\n\n```java\npublic NarrativeRequest buildRequest(PlayerAction action, GameContext context) {\n    // Validate action is fresh and unprocessed\n    if (action.getStatus() == ActionStatus.PROCESSED) {\n        throw new IllegalArgumentException(\"Cannot build request for already-processed action\");\n    }\n\n    // Log what we're building a request for\n    logger.info(\"Building narrative request for action {}: '{}'\",\n                action.getId(),\n                action.getActionText().substring(0, Math.min(100, action.getActionText().length())));\n\n    // ... rest of building logic\n}\n```\n\n### Verification Steps\n\n1. ‚úÖ Run `/test quick` - check for duplicate response patterns\n2. ‚úÖ Verify cache keys are unique per action: `grep \"Cache key:\" logs/application.log`\n3. ‚úÖ Check no processed actions are re-used: `grep \"already been processed\" logs/application.log`\n4. ‚úÖ Quality score should improve from 4.2 ‚Üí 6.0+ (removing duplicates)\n\n---\n\n## üî• CRITICAL ISSUE #2: GM Pre-narrates Player Actions (P0)\n\n### Problem\n\nGM narrates what a player character does BEFORE that player declares their action.\n\n**Evidence from Test Report** (Scenario 3, lines 432-439):\n\n```\nTurn 1:\n  Brenna: \"I suggest we split up - I'll take Building C\"\n  GM Response: \"Aldric's EMF scanner flares to life as he adjusts the sensitivity...\"\n               ^^^ BUT ALDRIC HASN'T TAKEN HIS TURN YET!\n\nTurn 1 continues:\n  Aldric: \"I adjust the EMF scanner's sensitivity...\"\n  ^^^ Aldric NOW takes the action GM already narrated!\n```\n\n**Impact**: Removes player agency - makes it seem like GM is playing their character\n\n### Root Cause\n\nNarrative generation prompt includes ALL player characters in the \"what happens\" section, causing Claude to narrate everyone's actions, not just the acting player.\n\n### Fix Location\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/context/NarrativeRequestBuilder.java`\n\n**Current Code** (suspected issue):\n```java\nprivate String buildNarrativePrompt(GameContext context, PlayerAction action) {\n    StringBuilder prompt = new StringBuilder();\n\n    // Problem: Lists ALL players without distinguishing who is ACTING\n    prompt.append(\"Players present:\\n\");\n    for (ActivePlayer player : context.getActivePlayers()) {\n        prompt.append(\"- \").append(player.getCharacterName()).append(\"\\n\");\n    }\n\n    // Problem: Doesn't emphasize that ONLY the acting player should be narrated\n    prompt.append(\"\\nPlayer action: \").append(action.getActionText());\n\n    // ... more prompt building\n}\n```\n\n**Recommended Fix**:\n\n```java\nprivate String buildNarrativePrompt(GameContext context, PlayerAction action) {\n    StringBuilder prompt = new StringBuilder();\n\n    // ========================================\n    // CRITICAL: Identify the ACTING player\n    // ========================================\n    prompt.append(\"**ACTING PLAYER**: \").append(action.getCharacterName()).append(\"\\n\");\n    prompt.append(\"**THEIR ACTION**: \").append(action.getActionText()).append(\"\\n\\n\");\n\n    // ========================================\n    // OTHER PLAYERS (DO NOT NARRATE THEM)\n    // ========================================\n    prompt.append(\"**OTHER PLAYERS PRESENT** (acknowledge but DO NOT narrate their actions):\\n\");\n    for (ActivePlayer player : context.getActivePlayers()) {\n        if (!player.getId().equals(action.getPlayerId())) {\n            prompt.append(\"- \").append(player.getCharacterName());\n\n            // Include their last known position/state but NOT new actions\n            String lastPosition = getLastKnownPosition(player, context);\n            if (lastPosition != null) {\n                prompt.append(\" (last seen: \").append(lastPosition).append(\")\");\n            }\n            prompt.append(\"\\n\");\n        }\n    }\n\n    // ========================================\n    // CRITICAL INSTRUCTION TO CLAUDE\n    // ========================================\n    prompt.append(\"\\n**CRITICAL INSTRUCTION**:\\n\");\n    prompt.append(\"- Only narrate the consequences of \").append(action.getCharacterName()).append(\"'s action.\\n\");\n    prompt.append(\"- DO NOT narrate what other player characters do or say.\\n\");\n    prompt.append(\"- Other players can be mentioned as present or reacting, but they do NOT take actions in this response.\\n\");\n    prompt.append(\"- Wait for each player to declare their own actions - do not play their characters for them.\\n\\n\");\n\n    // ... rest of prompt (NPCs, scene, etc.)\n}\n\nprivate String getLastKnownPosition(ActivePlayer player, GameContext context) {\n    // Extract last known position from recent memory\n    List<PlayerAction> recentActions = context.getRecentActions();\n    for (PlayerAction recentAction : Lists.reverse(recentActions)) {\n        if (recentAction.getPlayerId().equals(player.getId())) {\n            // Parse location from action text if present\n            return extractLocationHint(recentAction.getActionText());\n        }\n    }\n    return null;\n}\n```\n\n### Verification Steps\n\n1. ‚úÖ Run `/test quick` with 2+ players\n2. ‚úÖ Check narrative ONLY mentions the acting player's action\n3. ‚úÖ Verify other players are acknowledged but not narrated\n4. ‚úÖ Search logs for pre-narration: `grep \"GM narrates action before player\" .test-reports/latest-quick.md`\n\n---\n\n## üî• CRITICAL ISSUE #3: Genre/Setting Shift (P0)\n\n### Problem\n\nGame starts in modern horror setting (Paranormal Response Team, EMF detectors, tactical gear) but shifts to medieval fantasy (greatswords, torches, supply chambers) mid-game.\n\n**Evidence from Test Report** (Scenario 2, line 348):\n\n```\nOpening Narrative:\n  \"Paranormal Response Team, Containment Unit Seven\"\n  \"electromagnetic frequency detector\"\n  \"tactical flashlight cuts through warehouse darkness\"\n  \"abandoned research facility\"\n\nTurn 3 (same game!):\n  Player: \"I draw my two-handed greatsword\"\n  GM: \"flickering torchlight\"\n  GM: \"supply shelves... storage chamber... wooden crates\"\n```\n\n**Genre shift**: Modern horror (2020s tech) ‚Üí Medieval fantasy (swords, torches)\n\n### Root Cause\n\n1. Realm setting/genre information is not being passed to narrative generation\n2. OR narrative prompt doesn't emphasize maintaining genre consistency\n3. OR Claude is inferring fantasy genre from presence of \"shadows\" and \"creatures\"\n\n### Fix Location\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/context/GameContextAssembler.java`\n\n**Current Code** (suspected issue):\n```java\npublic GameContext assembleContext(GameSession session, Scene scene) {\n    GameContext context = new GameContext();\n    context.setSession(session);\n    context.setScene(scene);\n    // ... other context\n\n    // Problem: Realm is included but genre/tech level may not be emphasized\n    context.setRealm(session.getRealm());\n\n    return context;\n}\n```\n\n**Recommended Fix**:\n\n```java\npublic GameContext assembleContext(GameSession session, Scene scene) {\n    GameContext context = new GameContext();\n\n    // ========================================\n    // CRITICAL: Front-load realm genre info\n    // ========================================\n    Realm realm = session.getRealm();\n    context.setRealm(realm);\n\n    // Extract critical genre constraints\n    String genre = realm.getTheme(); // e.g., \"HORROR\", \"FANTASY\", \"CYBERPUNK\"\n    String techLevel = determineTechnologyLevel(realm); // \"MODERN\", \"MEDIEVAL\", \"FUTURISTIC\"\n    String setting = realm.getSetting(); // e.g., \"Modern paranormal investigation\"\n\n    // Build genre constraint string\n    String genreConstraints = buildGenreConstraints(genre, techLevel, setting);\n    context.setGenreConstraints(genreConstraints);\n\n    // ... rest of context assembly\n\n    return context;\n}\n\nprivate String determineTechnologyLevel(Realm realm) {\n    String desc = realm.getDescription().toLowerCase();\n\n    // Check for modern tech indicators\n    if (desc.contains(\"emf\") || desc.contains(\"detector\") ||\n        desc.contains(\"tactical\") || desc.contains(\"radio\")) {\n        return \"MODERN (2000s technology - computers, radios, flashlights, vehicles)\";\n    }\n\n    // Check for medieval indicators\n    if (desc.contains(\"sword\") || desc.contains(\"torch\") ||\n        desc.contains(\"castle\") || desc.contains(\"kingdom\")) {\n        return \"MEDIEVAL (swords, bows, torches, horses, castles)\";\n    }\n\n    // Check for futuristic indicators\n    if (desc.contains(\"cybernetic\") || desc.contains(\"laser\") ||\n        desc.contains(\"spacecraft\")) {\n        return \"FUTURISTIC (advanced technology, space travel, AI, cybernetics)\";\n    }\n\n    return \"UNDEFINED (infer from context)\";\n}\n\nprivate String buildGenreConstraints(String genre, String techLevel, String setting) {\n    return String.format(\n        \"**SETTING GENRE**: %s\\n\" +\n        \"**TECHNOLOGY LEVEL**: %s\\n\" +\n        \"**SETTING DESCRIPTION**: %s\\n\\n\" +\n        \"**CRITICAL CONSTRAINT**: Maintain genre and technology consistency throughout this scene.\\n\" +\n        \"- DO NOT introduce technology or equipment from other eras/genres.\\n\" +\n        \"- Characters should use tools and language appropriate to this setting.\\n\" +\n        \"- Environment should reflect this time period and genre.\\n\",\n        genre, techLevel, setting\n    );\n}\n```\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/context/NarrativeRequestBuilder.java`\n\nUpdate to include genre at TOP of prompt:\n\n```java\nprivate String buildNarrativePrompt(GameContext context, PlayerAction action) {\n    StringBuilder prompt = new StringBuilder();\n\n    // ========================================\n    // GENRE CONSTRAINTS (FIRST IN PROMPT)\n    // ========================================\n    prompt.append(\"‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\\n\");\n    prompt.append(\"SETTING AND GENRE CONSTRAINTS\\n\");\n    prompt.append(\"‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\\n\\n\");\n    prompt.append(context.getGenreConstraints()).append(\"\\n\\n\");\n\n    // ... rest of prompt\n}\n```\n\n### Verification Steps\n\n1. ‚úÖ Run `/test quick` for horror realm\n2. ‚úÖ Verify NO medieval elements appear (swords, torches, castles)\n3. ‚úÖ Verify modern tech appears (EMF, radios, flashlights)\n4. ‚úÖ Search for genre shifts: `grep -E \"(sword|torch|castle|medieval)\" .test-reports/latest-quick.md`\n\n---\n\n## üî• CRITICAL ISSUE #4: GM Responds Before Action Persisted (P0)\n\n### Problem\n\nAsync race condition - narrative generation starts before player action is fully persisted to database.\n\n**Evidence from Test Report** (Scenario 4, lines 639-641):\n\n```\nTimestamps:\n21:17:56.639 [main] - Brenna's action logged: \"I lean in and ask rapid-fire questions...\"\n21:17:56.641 [main] - GM responds: \"Gretta responds to Brenna's barrage of questions...\"\n                      ^^^ GM response timestamp is AFTER player action timestamp!\n```\n\n**Impact**: Narrative service may read stale/incomplete player action from database\n\n### Root Cause\n\nTransaction boundaries - player action saved but not yet committed when async narrative generation starts.\n\n### Fix Location\n\n**File**: `party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java`\n\n**Current Code** (suspected issue):\n```java\n@Transactional\npublic void processPlayerAction(UUID sessionId, UUID playerId, String actionText) {\n    // Save player action\n    PlayerAction action = new PlayerAction();\n    action.setActionText(actionText);\n    action.setStatus(ActionStatus.PENDING);\n    PlayerAction savedAction = playerActionRepository.save(action);\n\n    // Problem: Transaction may not be committed yet!\n    // Async narrative generation may not see the saved action\n    CompletableFuture<NarrativeResponse> narrativeFuture =\n        narrativeService.generateNarrativeAsync(buildRequest(savedAction));\n\n    // ... rest of processing\n}\n```\n\n**Recommended Fix**:\n\n```java\n@Transactional\npublic void processPlayerAction(UUID sessionId, UUID playerId, String actionText) {\n    // ========================================\n    // STEP 1: Save player action\n    // ========================================\n    PlayerAction action = new PlayerAction();\n    action.setSessionId(sessionId);\n    action.setPlayerId(playerId);\n    action.setActionText(actionText);\n    action.setStatus(ActionStatus.PENDING);\n    action.setReceivedAt(Instant.now());\n\n    PlayerAction savedAction = playerActionRepository.save(action);\n\n    // ========================================\n    // CRITICAL: Flush and commit BEFORE async\n    // ========================================\n    entityManager.flush(); // Force write to database\n\n    logger.info(\"Player action {} persisted and flushed. Action: {}\",\n                savedAction.getId(),\n                actionText.substring(0, Math.min(100, actionText.length())));\n\n    // ========================================\n    // STEP 2: Trigger async narrative (after commit)\n    // ========================================\n    // Action is now guaranteed visible to all readers\n    CompletableFuture<NarrativeResponse> narrativeFuture =\n        narrativeService.generateNarrativeAsync(buildRequest(savedAction));\n\n    // ... rest of processing\n}\n\n// Alternative: Split into separate transactions\n@Transactional\npublic PlayerAction savePlayerAction(UUID sessionId, UUID playerId, String actionText) {\n    PlayerAction action = new PlayerAction();\n    // ... set fields\n    return playerActionRepository.save(action);\n    // Transaction commits when method returns\n}\n\n@Transactional\npublic void processPlayerActionAsync(UUID actionId) {\n    // This runs AFTER previous transaction committed\n    PlayerAction action = playerActionRepository.findById(actionId)\n        .orElseThrow(() -> new IllegalStateException(\"Action not found: \" + actionId));\n\n    // Now safe to generate narrative - action is committed\n    narrativeService.generateNarrativeAsync(buildRequest(action));\n}\n```\n\n### Verification Steps\n\n1. ‚úÖ Run `/test quick` and check for race conditions\n2. ‚úÖ Verify action persistence logs BEFORE narrative generation logs\n3. ‚úÖ Check timestamps: action logged ‚Üí flush logged ‚Üí narrative started\n4. ‚úÖ No \"Action not found\" errors in logs\n\n---\n\n## üî• CRITICAL ISSUE #5: Enemy Count Mismatch (P0)\n\n### Problem\n\nRegistered NPCs don't match NPCs that appear in narrative.\n\n**Evidence from Test Report** (Scenario 2, lines 206-209, 300-306):\n\n```\nSetup:\n  ‚úì Registered NPC: Goblin Raider (HP: 15/15, Status: ENGAGED)\n  ‚úì Registered NPC: Goblin Shaman (HP: 15/15, Status: ENGAGED)\n  ‚úì Scene type set to COMBAT\n\nNarrative (Turn 2):\n  \"They peel away from the walls like living things, coalescing into\n   three distinct forms. Each shadow-creature stands roughly human-height...\"\n   ^^^ 3 ENEMIES APPEAR, BUT ONLY 2 REGISTERED!\n```\n\n**Impact**:\n- Combat becomes untrackable (can't target NPCs that aren't registered)\n- HP tracking breaks (3rd enemy has no HP)\n- Mechanical feedback impossible\n\n### Root Cause\n\nNarrative generation creates \"atmospheric\" enemies without checking registered NPC roster.\n\n### Fix Location\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/context/NarrativeRequestBuilder.java`\n\n**Current Code** (suspected issue):\n```java\nprivate String buildCombatContext(GameContext context) {\n    StringBuilder combat = new StringBuilder();\n    combat.append(\"Enemies present:\\n\");\n    for (ActiveNPC npc : context.getActiveNPCs()) {\n        if (npc.getRole() == NPCRole.ENEMY) {\n            combat.append(\"- \").append(npc.getName()).append(\"\\n\");\n        }\n    }\n    // Problem: Doesn't emphasize that ONLY these enemies exist\n    return combat.toString();\n}\n```\n\n**Recommended Fix**:\n\n```java\nprivate String buildCombatContext(GameContext context) {\n    // ========================================\n    // Get EXACT list of enemies\n    // ========================================\n    List<ActiveNPC> enemies = context.getActiveNPCs().stream()\n        .filter(npc -> npc.getRole() == NPCRole.ENEMY)\n        .filter(npc -> npc.getStatus() == NPCStatus.ENGAGED || npc.getStatus() == NPCStatus.PRESENT)\n        .collect(Collectors.toList());\n\n    StringBuilder combat = new StringBuilder();\n\n    // ========================================\n    // CRITICAL: Specify EXACT enemy count\n    // ========================================\n    combat.append(\"‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\\n\");\n    combat.append(\"COMBAT ROSTER (EXACT COUNT)\\n\");\n    combat.append(\"‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\\n\\n\");\n\n    combat.append(\"**ENEMIES PRESENT**: \").append(enemies.size()).append(\" total\\n\\n\");\n\n    for (int i = 0; i < enemies.size(); i++) {\n        ActiveNPC enemy = enemies.get(i);\n        combat.append(String.format(\"%d. **%s**\\n\", i + 1, enemy.getName()));\n        combat.append(String.format(\"   - Role: %s\\n\", enemy.getRole()));\n        combat.append(String.format(\"   - HP: %d/%d\\n\", enemy.getCurrentHp(), enemy.getMaxHp()));\n        combat.append(String.format(\"   - Status: %s\\n\", enemy.getStatus()));\n\n        if (enemy.getDescription() != null) {\n            combat.append(String.format(\"   - Description: %s\\n\", enemy.getDescription()));\n        }\n        combat.append(\"\\n\");\n    }\n\n    // ========================================\n    // CRITICAL INSTRUCTION TO CLAUDE\n    // ========================================\n    combat.append(\"**CRITICAL CONSTRAINT**:\\n\");\n    combat.append(\"- There are EXACTLY \").append(enemies.size()).append(\" enemies in this combat.\\n\");\n    combat.append(\"- DO NOT add, invent, or introduce additional enemies.\\n\");\n    combat.append(\"- DO NOT split a single enemy into multiple entities.\\n\");\n    combat.append(\"- DO NOT make vague references like 'more shadows emerge'.\\n\");\n    combat.append(\"- You can describe these \").append(enemies.size()).append(\" enemies in detail, but the COUNT must remain exact.\\n\\n\");\n\n    return combat.toString();\n}\n```\n\n**Additional Fix**: Add validation AFTER narrative generation\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/NarrativeValidator.java`\n\n```java\n@Component\npublic class NarrativeValidator {\n\n    public ValidationResult validateNarrative(NarrativeResponse response, GameContext context) {\n        List<ValidationIssue> issues = new ArrayList<>();\n\n        // ... existing validations\n\n        // ========================================\n        // NEW: Validate NPC count consistency\n        // ========================================\n        if (context.getScene().getType() == SceneType.COMBAT) {\n            issues.addAll(validateNPCCountConsistency(response, context));\n        }\n\n        return new ValidationResult(issues);\n    }\n\n    private List<ValidationIssue> validateNPCCountConsistency(\n            NarrativeResponse response, GameContext context) {\n\n        List<ValidationIssue> issues = new ArrayList<>();\n\n        // Get registered enemy count\n        long registeredEnemyCount = context.getActiveNPCs().stream()\n            .filter(npc -> npc.getRole() == NPCRole.ENEMY)\n            .filter(npc -> npc.getStatus() != NPCStatus.DEFEATED)\n            .count();\n\n        // Parse narrative for enemy references\n        String narrative = response.getNarrative();\n        List<String> enemyReferences = extractEnemyReferences(narrative);\n\n        // Check for count inconsistency\n        if (enemyReferences.size() > registeredEnemyCount) {\n            issues.add(ValidationIssue.critical(\n                \"NPC_COUNT_MISMATCH\",\n                String.format(\n                    \"Narrative mentions %d enemies but only %d are registered. \" +\n                    \"References: %s. This breaks combat tracking.\",\n                    enemyReferences.size(),\n                    registeredEnemyCount,\n                    String.join(\", \", enemyReferences)\n                )\n            ));\n        }\n\n        return issues;\n    }\n\n    private List<String> extractEnemyReferences(String narrative) {\n        List<String> references = new ArrayList<>();\n\n        // Patterns that indicate multiple enemies\n        Pattern countPattern = Pattern.compile(\n            \"(\\\\d+|two|three|four|five|several|multiple)\\\\s+(enemies|creatures|shadows|figures|forms)\",\n            Pattern.CASE_INSENSITIVE\n        );\n\n        Matcher matcher = countPattern.matcher(narrative);\n        while (matcher.find()) {\n            references.add(matcher.group());\n        }\n\n        return references;\n    }\n}\n```\n\n### Verification Steps\n\n1. ‚úÖ Run `/test quick` combat scenarios\n2. ‚úÖ Verify NPC count in narrative matches registered NPCs\n3. ‚úÖ Check validation catches mismatches: `grep \"NPC_COUNT_MISMATCH\" logs/application.log`\n4. ‚úÖ Verify combat mechanics work for ALL enemies\n\n---\n\n## üéØ Implementation Priority\n\n### Week 1: Stop Duplicate Responses\n- **Day 1-2**: Fix Issue #1 (Duplicate responses) + Issue #4 (Race condition)\n- **Day 3**: Fix Issue #2 (Pre-narration)\n- **Expected improvement**: Quality 4.6 ‚Üí 6.5/10\n\n### Week 2: Narrative Consistency\n- **Day 1-2**: Fix Issue #3 (Genre shifts)\n- **Day 3**: Fix Issue #5 (NPC count)\n- **Expected improvement**: Quality 6.5 ‚Üí 7.5/10\n\n### Week 3: Add Mechanics (separate document)\n- Combat system\n- Skill checks\n- HP tracking\n\n---\n\n## üìä Success Metrics\n\nTrack these after each fix:\n\n| Metric | Current | Target | How to Measure |\n|--------|---------|--------|----------------|\n| Duplicate Response Rate | ~30% | 0% | `grep \"duplicate\" .test-reports/*.md` |\n| Pre-narration Rate | ~20% | 0% | `grep \"Pre-narrates\" .test-reports/*.md` |\n| Genre Consistency | ~60% | 100% | Manual review of narratives |\n| NPC Count Accuracy | ~70% | 100% | Count NPCs in narrative vs registered |\n| Average Quality Score | 4.6/10 | 7.0+/10 | Narrative quality analysis |\n| Player Agency Score | Low | High | Players' actions acknowledged uniquely |\n\n---\n\n## üß™ Testing Protocol\n\nAfter implementing each fix:\n\n```bash\n# 1. Run quick test suite\n/test quick\n\n# 2. Check test report\ncat .test-reports/latest-quick.md\n\n# 3. Verify specific fix\ngrep -i \"<issue-keyword>\" .test-reports/latest-quick.md\n\n# 4. Check quality scores\ngrep \"Quality score:\" logs/application.log | tail -10\n\n# 5. Run full suite before deploy\n/test full\n```\n\n---\n\n## üîó Related Documents\n\n- **Test Report**: `.test-reports/latest-quick.md`\n- **Quality Analysis**: Search logs for `NarrativeQualityAnalysisService`\n- **Issue Tracking**: 39 issues logged in test report\n- **API Token Usage**: `~/Downloads/claude_api_tokens_2025_11.csv` (track costs)\n\n---\n\n**Document Version**: 1.0\n**Last Updated**: 2025-11-09\n**Author**: Claude Code (Autonomous Test Analysis)\n**Status**: Ready for Implementation\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/TEST-FIXES-P0-CRITICAL.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "de4555d862d062fc",
      "size_bytes": 27122,
      "created_at": "2026-01-02T20:42:12.432876"
    },
    {
      "doc_id": "local_party-lore_ARC-GENERATION-REALM-DRIFT-FIX",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/ARC-GENERATION-REALM-DRIFT-FIX.md",
      "content": "# Arc Generation Realm Drift Fix\n\n**Date**: 2025-12-31\n**Issue**: Fantasy realm test generated Gothic romance content (Rose Garden of Thornfield)\n**Root Cause**: LLM hallucinating content from wrong realm due to weak prompt constraints\n\n## Problem Summary\n\nDuring a 40-turn Fantasy realm reality test, the arc generation service created:\n- Arc: \"Whispers in Willow\"\n- Location: \"Rose Garden of Thornfield\"\n- Theme: Gothic manor intrigue with social investigation\n\n**Expected**: Mercenary fantasy combat content (Iron Company realm)\n**Got**: Regency romance Gothic content (belongs in Roses & Ruin realm)\n\n## Root Cause Analysis\n\n1. **\"Thornfield\" is from Roses & Ruin realm** - explicitly mentioned in `rosesandruin.json`:\n   ```\n   \"the London Season is in full swing at Thornfield Park,\n   the magnificent estate of the Duke of Ashworth\"\n   ```\n\n2. **Roses & Ruin realm exists as JSON but isn't loaded in production database**\n   - Only 5 realms in DB: FANTASY, HORROR, CYBERPUNK, ELVEN, POLITICAL_THRILLER\n   - `rosesandruin.json` exists but realm not inserted\n\n3. **LLM hallucinated from training data**\n   - Groq 70B likely has Bridgerton/Jane Eyre content in training\n   - \"Thornfield\" appears in classic literature (Jane Eyre)\n   - Prompt didn't explicitly reject Gothic romance for Fantasy realm\n\n4. **Fantasy location guidance was too generic**\n   - Showed woodland examples but didn't explicitly reject manors/estates\n   - No warnings against Regency romance crossover\n\n## Fixes Applied\n\n### 1. Strengthened Fantasy Realm Location Guidance\n\n**Before**:\n```java\nLOCATION NAMING RULES:\n1. Fit the specific tone of this realm (check description)\n2. Be creative - avoid cliched fantasy names\n```\n\n**After**:\n```java\nLOCATION NAMING RULES:\n1. Fit the MERCENARY/COMBAT tone (check realm description!)\n2. Military, frontier, or gritty survival atmosphere\n3. NO Gothic romance, manors, estates, or formal society locations\n4. Think: war camps, frontier posts, battlefields, strongholds\n\nBAD EXAMPLES (NEVER use these patterns):\n- **ROSE GARDENS, MANOR ESTATES, BALLROOMS** (wrong realm!)\n- **THORNFIELD, PEMBERLEY, HIGHBURY** (Regency romance - WRONG!)\n- Names that sound like Gothic romance or high society\n\nüö® CRITICAL: This is a MERCENARY FANTASY realm, NOT Regency romance!\nIf you're thinking of manors, gardens, or formal society ‚Üí STOP and rethink!\n```\n\n### 2. Added Realm Tone Enforcement Section to Arc Prompts\n\nAdded explicit enforcement block in BOTH arc generation prompts:\n\n```java\n========================================================================\nüö® REALM TONE ENFORCEMENT (CRITICAL!)\n========================================================================\n\nYou are generating content for: Iron Company - sellsword mercenary realm\n\nCHECK THE REALM DESCRIPTION ABOVE! Your arc MUST match that tone exactly.\n\nüö´ DO NOT generate content from other realms:\n- If realm = mercenary fantasy ‚Üí NO Regency romance content\n- If realm = cyberpunk ‚Üí NO medieval fantasy content\n- If realm = horror ‚Üí NO lighthearted adventure content\n- If realm = political thriller ‚Üí NO dungeon crawling content\n\n‚ö†Ô∏è Common LLM hallucination patterns to AVOID:\n- Generating \"Thornfield\", \"Pemberley\", or manor estates for non-romance realms\n- Using rose gardens, ballrooms, or formal society for combat realms\n- Mixing genre tropes (cyberpunk ninjas in fantasy, etc.)\n\nüéØ STAY IN YOUR LANE: Match the realm's specific tone and setting!\n========================================================================\n```\n\n### 3. Updated Both Arc Generation Methods\n\n- `buildFirstArcPrompt()` - First arc generation (lines 509-634)\n- `buildNextArcPromptWithVariety()` - Continuation arc generation (lines 955-1126)\n\nBoth now include:\n1. Realm name + description in enforcement section\n2. Explicit genre boundaries\n3. Examples of wrong-realm hallucinations to avoid\n\n## Files Changed\n\n- `party-lore-ai/.../ArcGenerationService.java` - Added realm tone enforcement\n  - Lines 2727-2759: Strengthened `getFantasyLocationGuidance()`\n  - Lines 528-548: Added tone enforcement to first arc prompt\n  - Lines 973-993: Added tone enforcement to continuation arc prompt\n  - Added realm name/description parameters to both sprintf calls\n\n## Testing\n\nTo verify the fix works:\n\n```bash\n# Run Fantasy realm reality test\nset -a && source .env.local && set +a\njava -jar party-lore-app/target/party-lore-app-1.0.0-SNAPSHOT.jar \\\n  --spring.profiles.active=autonomous-test \\\n  --suite=reality \\\n  --realm-id=198a322d-d6d8-4477-86be-0af934048a72 \\\n  --turns=40\n\n# Check transcript for:\n# ‚úÖ GOOD: Frontier posts, mercenary camps, battlefields, combat scenarios\n# ‚ùå BAD: Rose gardens, manors, Thornfield, ballrooms, social intrigue\n```\n\n## Expected Behavior After Fix\n\n**Fantasy Realm (Iron Company)** should now generate:\n- ‚úÖ The Broken Blade Fort (frontier stronghold)\n- ‚úÖ Blackwall Crossing (military checkpoint)\n- ‚úÖ The Shattered Keep (ruined fortress)\n- ‚úÖ Riverwatch Camp (mercenary gathering)\n\n**NOT**:\n- ‚ùå Rose Garden of Thornfield\n- ‚ùå Ashworth Manor\n- ‚ùå The Grand Ballroom\n- ‚ùå Pemberley Estate\n\n## Related Issues\n\n- Roses & Ruin realm needs to be loaded into production database for proper testing\n- Consider adding a realm content validator that checks arc output matches realm type\n- May need similar enforcement for other realms (Horror, Cyberpunk, Political Thriller)\n\n## Impact\n\n- **Low Risk**: Only affects arc generation prompts\n- **No Breaking Changes**: Still generates valid XML with all required fields\n- **Improved Quality**: Arcs will better match realm tone/genre expectations\n- **User Experience**: Players get content that matches the realm they chose\n\n## Next Steps\n\n1. ‚úÖ **Compile and test** - verify Fantasy realm generates combat content\n2. ‚è≥ **Monitor production** - check if hallucinations still occur\n3. ‚è≥ **Load Roses & Ruin realm** - enable social combat mechanics testing\n4. ‚è≥ **Add realm validator** - automated check that arc matches realm genre\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/ARC-GENERATION-REALM-DRIFT-FIX.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "llm",
        "md",
        "test"
      ],
      "content_hash": "6e16771df3e45838",
      "size_bytes": 5995,
      "created_at": "2026-01-02T20:42:12.432936"
    },
    {
      "doc_id": "local_party-lore_TASK-408-REVISION-NOTES",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/TASK-408-REVISION-NOTES.md",
      "content": "# TASK-408 Revision: AI-Driven NPC HP Design\n**Date**: January 15, 2025\n**Reviewer**: AI RPG Developer + Product Manager Analysis\n\n## Problem with Original Design\n\nThe original TASK-408 specified **hard-coded HP values by NPC role**:\n\n```sql\n-- ORIGINAL (REJECTED)\nUPDATE active_npcs\nSET max_hp = CASE\n    WHEN role = 'ENEMY' THEN 15        -- All enemies: 15 HP\n    WHEN role = 'MAJOR_NPC' THEN 30    -- All major NPCs: 30 HP\n    WHEN role = 'MINOR_NPC' THEN 10    -- All minor NPCs: 10 HP\nEND;\n```\n\n### Critical Issues Identified\n\n1. **Anti-Pattern for AI RPGs** ‚ùå\n   - Removes AI creative control over narrative\n   - All \"goblin scouts\" identical (15 HP)\n   - Can't have \"wounded goblin\" (7 HP) or \"goblin champion\" (22 HP)\n\n2. **Role/Mechanical Confusion** ‚ùå\n   - `role` is BEHAVIORAL (ENEMY vs NPC)\n   - HP is MECHANICAL (how tough they are)\n   - A merchant can be an ENEMY (hostile) but shouldn't have 15 HP\n\n3. **No Variance** ‚ùå\n   - All enemies feel identical in combat\n   - Reduces tactical depth\n   - Makes battles predictable\n\n4. **Hard-Coded Game Rules in Schema** ‚ùå\n   - Database constraints enforce game rules\n   - Can't add future mechanics (undead resurrection, overkill)\n   - Inflexible for game evolution\n\n## Revised Design: AI-Driven with Randomized Defaults\n\n### Key Changes\n\n1. **Added `threat_level` Column**\n   - Separates behavioral (`role`) from mechanical (`threat_level`)\n   - Values: `minor`, `moderate`, `major`, `boss`\n   - Maps to mechanical difficulty, not NPC type\n\n2. **Randomized HP Ranges**\n   ```sql\n   -- REVISED (APPROVED)\n   UPDATE active_npcs\n   SET max_hp = CASE\n       WHEN threat_level = 'minor' THEN 6 + FLOOR(RANDOM() * 6)::INTEGER     -- 6-11 HP\n       WHEN threat_level = 'moderate' THEN 12 + FLOOR(RANDOM() * 8)::INTEGER -- 12-19 HP\n       WHEN threat_level = 'major' THEN 25 + FLOOR(RANDOM() * 15)::INTEGER   -- 25-39 HP\n       WHEN threat_level = 'boss' THEN 60 + FLOOR(RANDOM() * 40)::INTEGER    -- 60-99 HP\n   END;\n   ```\n\n3. **Removed Max HP Constraint**\n   - Allows `current_hp > max_hp` for future mechanics\n   - Examples: Berserker rage (+10 temporary HP), magical enhancement\n   - Allows negative HP for overkill/resurrection mechanics\n\n4. **Future: AI-Declared HP (TASK-409)**\n   - AI can optionally declare HP when spawning NPCs\n   - Example: `<npc_spawn name=\"Ancient Dragon\" threat_level=\"boss\" max_hp=\"95\"/>`\n   - Defaults used only if AI doesn't specify\n\n### Benefits of Revised Design\n\n| Aspect | Original Design | Revised Design |\n|--------|-----------------|----------------|\n| **Variance** | ‚ùå All enemies identical | ‚úÖ Range within threat levels |\n| **AI Control** | ‚ùå None (hard-coded) | ‚úÖ Full (with safe defaults) |\n| **Role Confusion** | ‚ùå Behavioral = Mechanical | ‚úÖ Separated concerns |\n| **Future Mechanics** | ‚ùå Schema constraints block | ‚úÖ Flexible for expansion |\n| **Narrative Fit** | ‚ùå \"Tough goblin\" still 15 HP | ‚úÖ \"Tough goblin\" can be 22 HP |\n\n## Migration Comparison\n\n### Original Migration (Lines 46-53)\n```sql\nUPDATE active_npcs\nSET max_hp = CASE\n    WHEN role = 'ENEMY' THEN 15\n    WHEN role = 'MAJOR_NPC' THEN 30\n    WHEN role = 'MINOR_NPC' THEN 10\n    ELSE 20\nEND;\n```\n**Result**: All enemies have exactly 15 HP (predictable, boring)\n\n### Revised Migration (Lines 53-71)\n```sql\nUPDATE active_npcs\nSET threat_level = CASE\n    WHEN role = 'MINOR_NPC' THEN 'minor'\n    WHEN role = 'ENEMY' THEN 'moderate'\n    WHEN role = 'MAJOR_NPC' THEN 'major'\nEND;\n\nUPDATE active_npcs\nSET max_hp = CASE\n    WHEN threat_level = 'minor' THEN 6 + FLOOR(RANDOM() * 6)::INTEGER\n    WHEN threat_level = 'moderate' THEN 12 + FLOOR(RANDOM() * 8)::INTEGER\n    WHEN threat_level = 'major' THEN 25 + FLOOR(RANDOM() * 15)::INTEGER\n    WHEN threat_level = 'boss' THEN 60 + FLOOR(RANDOM() * 40)::INTEGER\nEND;\n```\n**Result**: Enemies have varied HP within realistic ranges (interesting, unpredictable)\n\n## Entity Changes\n\n### Added Fields\n```java\n@Column(name = \"threat_level\", nullable = false)\nprivate String threatLevel;  // NEW\n```\n\n### Added Helper Methods\n```java\n// NEW: HP with percentage display\npublic String getHpStatusWithPercentage() {\n    int percentage = (int) ((currentHp / (double) maxHp) * 100);\n    return String.format(\"%d/%d HP (%d%%)\", currentHp, maxHp, percentage);\n}\n\n// NEW: Damage application with defeat detection\npublic boolean applyDamage(int damage) {\n    currentHp = Math.max(0, currentHp - damage);\n    return isDead();\n}\n\n// NEW: Healing capped at max HP\npublic void heal(int amount) {\n    currentHp = Math.min(maxHp, currentHp + amount);\n}\n```\n\n## Testing Updates\n\n### Variance Verification Query (NEW)\n```sql\n-- Verify HP variance within threat levels\nSELECT\n    threat_level,\n    COUNT(*) as npc_count,\n    MIN(max_hp) as min_hp,\n    MAX(max_hp) as max_hp,\n    AVG(max_hp)::INTEGER as avg_hp\nFROM active_npcs\nGROUP BY threat_level;\n\n-- Expected output:\n-- minor: min=6, max=11, avg=~8\n-- moderate: min=12, max=19, avg=~15\n-- major: min=25, max=39, avg=~32\n-- boss: min=60, max=99, avg=~79\n```\n\n### Additional Unit Tests\n- `activeNpc_hpStatusWithPercentage_formatted()`\n- `activeNpc_applyDamage_reducesHp()`\n- `activeNpc_applyDamage_defeatsNpc()`\n- `activeNpc_heal_increasesHpCappedAtMax()`\n- `activeNpc_threatLevel_persisted()`\n\n## Alignment with Party Lore Design Philosophy\n\n### Core Principle\n**Party Lore is an AI-driven RPG, not a rules-driven RPG.**\n\nThe AI should have creative control over the narrative with mechanical tracking for consistency, NOT hard-coded game rules that constrain the AI.\n\n### How This Revision Supports That\n\n1. **AI Flexibility** ‚úÖ\n   - AI can describe enemies as \"wounded\", \"ancient\", \"especially tough\"\n   - Future TASK-409 allows AI to declare HP: `max_hp=\"22\"` for tough goblin\n   - Defaults exist as safety net, not constraints\n\n2. **Mechanical Consistency** ‚úÖ\n   - HP tracking prevents \"wounded enemy\" from having full HP narrative\n   - Database persists state for multi-turn combat\n   - AI sees real HP values: \"Goblin Scout: 8/14 HP (57%)\"\n\n3. **Narrative-First Design** ‚úÖ\n   - Threat level describes narrative threat, not mechanical formula\n   - \"Boss\" enemies feel epic (60-99 HP range) without hard-coding\n   - Variance makes each encounter unique\n\n## Migration Checksum Impact\n\n**IMPORTANT**: This revision changes the migration SQL significantly.\n\nIf V089 has already been applied in any environment:\n- **DO NOT** modify this migration further\n- Create V094 with corrections if needed after deployment\n- Current revision is safe for first-time application\n\n## Files Modified\n\n1. `.specify/tasks/phase-0/task-408-add-npc-hp-database-schema.md`\n   - Updated migration SQL (randomized HP)\n   - Added `threat_level` column\n   - Removed hard-coded HP constraints\n   - Added design rationale section\n   - Added future AI-declared HP section (TASK-409)\n   - Updated testing requirements\n   - Added variance verification queries\n\n## Recommendation\n\n**Status**: ‚úÖ **APPROVED FOR IMPLEMENTATION**\n\nThis revised design:\n- Preserves AI-driven gameplay\n- Adds mechanical tracking for consistency\n- Creates variance for interesting combat\n- Future-proofs for AI-declared HP\n- Aligns with Party Lore's core design philosophy\n\n**Next Step**: Implement TASK-408 with revised design.\n\n---\n\n**Analysis By**: Expert AI RPG Developer + Product Manager\n**Date**: 2025-01-15\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/TASK-408-REVISION-NOTES.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "55ce85e52a16f137",
      "size_bytes": 7329,
      "created_at": "2026-01-02T20:42:12.433093"
    },
    {
      "doc_id": "local_party-lore_AI_NARRATIVE_QUALITY_ISSUES",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/AI_NARRATIVE_QUALITY_ISSUES.md",
      "content": "# AI Narrative Quality Issues - Action Plan\n\n**Date Created**: 2025-11-09\n**Based On**: Autonomous test suite results (commit a71f40f)\n**Test Suite**: quick (5 scenarios, 13m 58s duration)\n**Overall Quality**: 3.56/10 (Poor)\n\n## Executive Summary\n\nRecent autonomous testing revealed that while **architectural fixes are successful** (Hibernate crash fixed, combat detection working, NPC registration functional), **AI narrative generation has critical quality issues** that break gameplay:\n\n- **Player Agency Violations**: GM predicts/narrates player actions before declaration\n- **Character Identity Problems**: Multiple players treated as single entity\n- **Missing Mechanics**: Combat actions generate no mechanical resolution\n- **Narrative Inconsistency**: Genre/setting shifts mid-scene\n\n**Status**: Infrastructure is solid. AI prompt engineering and context management need significant work.\n\n---\n\n## Test Results Overview\n\n| Scenario | Status | Score | Key Issues |\n|----------|--------|-------|------------|\n| Basic Combat - 2 Players | ‚ùå FAILED | 2.8/10 | Character fusion, player ignored |\n| Group Combat - 3 Players | ‚ùå FAILED | 4.2/10 | Action predicted, identical responses |\n| Solo Exploration | ‚úÖ PASSED | 4.6/10 | Setting transformation |\n| NPC Interaction | ‚ùå FAILED | 3.4/10 | Impossible positions, coordination dismissed |\n| Epic 9 - Structured Mechanics | ‚ùå FAILED | 2.8/10 | Character fusion, action erased |\n\n**Pattern**: Multi-player scenarios perform worse than solo, suggesting coordination/tracking problems.\n\n---\n\n## Critical Issues (Priority 1)\n\n### Issue 1: GM Predicts Player Actions Before Declaration\n\n**Severity**: CRITICAL (4 occurrences)\n**Impact**: Breaks core player agency - the GM narrates what players will do before they actually declare it\n\n**Example from Testing**:\n```\nTurn 2 (Basic Combat):\nGM Response: \"Your voice cuts through the howling wind\" and describes\nBrenna raising her shotgun and calling out a warning.\n\nProblem: This occurs BEFORE Brenna's player actually declares these actions.\n```\n\n**Root Cause**: AI is generating narrative that assumes/predicts player behavior instead of responding to declared actions.\n\n**Files to Investigate**:\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/AdvancedPromptEngineering.java`\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n\n**Potential Solutions**:\n1. **Prompt Engineering**: Strengthen instructions that GM must ONLY respond to declared actions, never predict\n2. **Template Analysis**: Review prompt templates for language that encourages predictive narrative\n3. **Context Ordering**: Ensure player action comes BEFORE GM generation in context window\n4. **Validation Layer**: Add post-processing check that verifies GM response doesn't narrate undeclared actions\n\n**Success Criteria**:\n- GM responses ONLY describe consequences of player-declared actions\n- No narrative describing what player \"will do\" or \"is about to do\"\n- Each player action gets unique, specific response\n\n---\n\n### Issue 2: Character Identity Fusion\n\n**Severity**: CRITICAL (3 occurrences)\n**Impact**: Two separate players treated as single entity, destroying individual player experience\n\n**Example from Testing**:\n```\nEpic 9 Scenario:\n- Both Aldric and Brenna listed as NPCs in opening mechanics XML\n- Aldric performs action, but GM response addresses \"both players\"\n- Individual player actions conflated into single narrative thread\n```\n\n**Root Cause**: AI losing track of individual player identities in multi-player scenarios.\n\n**Files to Investigate**:\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/NarrativeMemoryService.java`\n- Context building for multi-player scenarios\n- How player identities are passed to Claude API\n\n**Potential Solutions**:\n1. **Enhanced Context**: Explicitly list each player's name, role, and last action in prompt\n2. **Player Roster Section**: Add dedicated \"ACTIVE PLAYERS\" section to every prompt\n3. **Action Attribution**: Ensure every action in context clearly identifies which player performed it\n4. **Identity Reinforcement**: Add validation that response addresses correct player by name\n5. **Separate Contexts**: Consider maintaining separate context threads for each player\n\n**Success Criteria**:\n- Each player maintains distinct identity throughout session\n- GM responses clearly address specific player who acted\n- No conflation of multiple players into single entity\n\n---\n\n### Issue 3: Player Actions Completely Ignored\n\n**Severity**: CRITICAL (2 occurrences)\n**Impact**: Player submits action, receives no response or acknowledgment\n\n**Example from Testing**:\n```\nTurn 1 (Epic 9):\nBrenna declares: \"I draw my specialized electromagnetic disruption device\nand begin scanning the facility's structural weak points...\"\n\nGM Response: Addresses only Aldric's action from the same turn.\nBrenna's action is completely erased from narrative.\n```\n\n**Root Cause**: Multi-player batch processing losing individual player actions.\n\n**Files to Investigate**:\n- `party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java` (batch processing)\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java` (narrative generation)\n- How multiple player actions in single turn are handled\n\n**Potential Solutions**:\n1. **Sequential Processing**: Process each player action individually rather than batching\n2. **Action Confirmation**: Add validation that every submitted action gets response\n3. **Batch Summarization**: If batching required, ensure prompt explicitly lists ALL actions to address\n4. **Response Validation**: Post-processing check that response mentions all acting players\n5. **Turn Summary**: Generate summary confirming which actions were processed\n\n**Success Criteria**:\n- Every player action receives explicit narrative response\n- Multi-player turns acknowledge all participating players\n- No actions lost or ignored in batch processing\n\n---\n\n## High-Priority Issues (Priority 2)\n\n### Issue 4: Missing Combat Mechanics\n\n**Severity**: HIGH (8 occurrences)\n**Impact**: Armed standoffs, attacks, and combat actions generate no mechanical resolution\n\n**Example from Testing**:\n```\nBasic Combat Scenario:\n- Both players draw weapons and aim at messenger\n- Explicit \"finger hovering near trigger\" and \"aiming at center mass\"\n- No combat mechanics engaged (no initiative, no rolls, no HP changes)\n- Scene remains in pure narrative mode despite combat-ready situation\n```\n\n**Root Cause**: Tier 1 XML generation not recognizing combat-triggering actions.\n\n**Files to Investigate**:\n- `party-lore-ai/src/main/java/com/partylore/ai/mechanics/Tier1PostProcessor.java`\n- `party-lore-ai/src/main/java/com/partylore/ai/mechanics/CombatMechanicsEngine.java`\n- Combat trigger detection in Tier 1 prompt\n\n**Potential Solutions**:\n1. **Combat Keywords in Tier 1**: Add detection for weapon drawing, aiming, attacking\n2. **Threat Level Assessment**: Add explicit threat level evaluation in Tier 1\n3. **Action Type Classification**: Classify actions as \"combat\", \"social\", \"exploration\" in Tier 1\n4. **Mechanical Hooks**: When weapon/threat detected, automatically generate combat mechanics XML\n5. **Two-Way Communication**: Allow Tier 2 to signal back to Tier 1 \"this needs mechanics\"\n\n**Success Criteria**:\n- Weapon drawing triggers `<combat_initiated>` tag\n- Attack actions generate HP damage mechanics\n- Armed standoffs trigger initiative/contested rolls\n- Combat actions show clear mechanical consequences\n\n---\n\n### Issue 5: Identical Responses for Different Actions\n\n**Severity**: HIGH (4 occurrences)\n**Impact**: Different player actions receive cookie-cutter template responses\n\n**Example from Testing**:\n```\nBasic Combat:\nAldric's action (Turn 1): \"I advance forward aggressively, scanning hallway\"\nBrenna's action (Turn 2): \"I raise shotgun, aiming at hooded figure\"\n\nGM Response (nearly identical for both):\n\"The hooded figure freezes mid-step, gloved hands slowly rising in\na gesture of surrender\"\n```\n\n**Root Cause**: AI falling back on template responses rather than dynamic narrative.\n\n**Files to Investigate**:\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/AdvancedPromptEngineering.java`\n- Response variety in prompt engineering\n- Temperature settings for Claude API calls\n\n**Potential Solutions**:\n1. **Anti-Repetition Prompt**: Add explicit instruction against template responses\n2. **Recent Narrative Context**: Include last 3-5 GM responses in context to avoid repetition\n3. **Action-Specific Details**: Ensure prompt emphasizes unique aspects of each player action\n4. **Temperature Adjustment**: Increase Claude API temperature for more varied responses\n5. **Response Validation**: Detect repeated phrases/patterns and force regeneration\n\n**Success Criteria**:\n- Each player action receives unique, specific response\n- GM responses reference specific details from player action\n- No repeated phrases across consecutive turns\n\n---\n\n### Issue 6: Narrative Setting Inconsistency\n\n**Severity**: HIGH (5 occurrences)\n**Impact**: Scene setting shifts mid-game (psychiatric hospital ‚Üí medieval castle)\n\n**Example from Testing**:\n```\nNPC Interaction Scenario:\nOpening: \"The abandoned Millbrook Psychiatric Hospital looms...\"\nTurn 1 GM Response: \"wind rattling through the broken windows\"\nTurn 2 GM Response: \"The west wing corridor yawns before you, darker\nthan the rest of the castle\"\n\nProblem: Hospital became castle with no explanation.\n```\n\n**Root Cause**: AI losing setting context across turns.\n\n**Files to Investigate**:\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/NarrativeMemoryService.java`\n- How location/setting is maintained in context\n- Scene description persistence\n\n**Potential Solutions**:\n1. **Setting Lock**: Add explicit \"CURRENT SETTING\" section to every prompt\n2. **Location Validation**: Post-process GM responses to detect setting shifts\n3. **Opening Narrative Anchor**: Always include opening scene description in context\n4. **Setting Consistency Instruction**: Strengthen prompt instructions about maintaining setting\n5. **Genre Tags**: Track genre (horror, fantasy, sci-fi) and validate consistency\n\n**Success Criteria**:\n- Scene setting remains consistent throughout session\n- Location descriptions match established environment\n- No unexplained genre or setting shifts\n\n---\n\n## Medium-Priority Issues (Priority 3)\n\n### Issue 7: Repetitive Action-Response Loops\n\n**Severity**: MEDIUM (6 occurrences)\n**Impact**: Gameplay feels stuck without progression\n\n**Example**: Three consecutive lockbreaker actions on blast door with no resolution.\n\n**Potential Solutions**:\n- Add progress tracking to repeated action types\n- Force resolution (success/failure) after 2-3 attempts\n- Suggest alternative approaches when action repeated\n\n---\n\n### Issue 8: Unclear Character Positioning\n\n**Severity**: MEDIUM (4 occurrences)\n**Impact**: Spatial relationships between characters unclear\n\n**Example**: Aldric described providing \"combat cover for Brenna\" but unclear if they're together.\n\n**Potential Solutions**:\n- Add explicit position tracking in game state\n- Include \"PARTY FORMATION\" section in prompts\n- Validate spatial consistency in responses\n\n---\n\n### Issue 9: Player Coordination Ignored\n\n**Severity**: MEDIUM (3 occurrences)\n**Impact**: Tactical formations and team coordination requests dismissed\n\n**Example**: \"Form defensive triangle\" request ignored, no formation established.\n\n**Potential Solutions**:\n- Detect coordination keywords in Tier 1 mechanics\n- Add `<formation_change>` tag to mechanics XML\n- Track party formation in game state\n\n---\n\n## Investigation Plan\n\n### Phase 1: Root Cause Analysis (Week 1)\n\n1. **Prompt Audit**\n   - Review all prompts in `AdvancedPromptEngineering.java`\n   - Identify language that might encourage predictive narrative\n   - Document current context structure\n\n2. **Context Flow Analysis**\n   - Trace how player actions flow through system\n   - Map context building for multi-player scenarios\n   - Identify where player identity information might be lost\n\n3. **Tier 1/Tier 2 Boundary Analysis**\n   - Review what information Tier 1 provides to Tier 2\n   - Identify gaps in mechanical signals\n   - Document current combat trigger logic\n\n### Phase 2: Quick Wins (Week 1-2)\n\n1. **Player Identity Reinforcement**\n   - Add \"ACTIVE PLAYERS\" section to all prompts\n   - Ensure every action clearly attributed to player\n   - Add validation that response addresses correct player\n\n2. **Action Prediction Prevention**\n   - Add explicit \"NEVER predict player actions\" instruction\n   - Review/remove any prompt language suggesting future actions\n   - Add post-processing validation\n\n3. **Setting Consistency Lock**\n   - Add \"CURRENT SETTING\" section persisted across turns\n   - Include opening narrative in all subsequent prompts\n   - Add setting validation\n\n### Phase 3: Mechanical Integration (Week 2-3)\n\n1. **Combat Trigger Enhancement**\n   - Expand Tier 1 combat detection\n   - Add weapon/threat recognition\n   - Generate mechanics XML for combat actions\n\n2. **Response Uniqueness**\n   - Add recent responses to context\n   - Increase temperature for variety\n   - Add anti-repetition validation\n\n3. **Multi-Player Coordination**\n   - Add formation tracking\n   - Detect coordination keywords\n   - Generate coordination mechanics\n\n### Phase 4: Testing & Validation (Week 3-4)\n\n1. **Re-run Autonomous Tests**\n   - Execute same test suite\n   - Compare quality scores\n   - Validate specific issues resolved\n\n2. **Regression Testing**\n   - Ensure fixes don't break existing functionality\n   - Validate solo scenarios still work\n   - Check production metrics\n\n3. **Success Metrics**\n   - Target: Average quality score > 7.0/10\n   - Zero CRITICAL issues\n   - < 3 HIGH issues per scenario\n\n---\n\n## Success Criteria Summary\n\n### Critical Issues Resolution\n- ‚úÖ No GM predictions of player actions\n- ‚úÖ Each player maintains distinct identity\n- ‚úÖ Every player action receives response\n- ‚úÖ Combat actions generate mechanics\n\n### Quality Targets\n- **Minimum**: 7.0/10 average quality score\n- **Target**: 8.5/10 average quality score\n- **Stretch**: All scenarios PASSED (> 7.0/10)\n\n### Issue Counts\n- **CRITICAL**: 0 occurrences\n- **HIGH**: < 2 per scenario\n- **MEDIUM**: < 3 per scenario\n\n---\n\n## Files Requiring Investigation\n\n### High Priority\n1. `party-lore-ai/src/main/java/com/partylore/ai/narrative/AdvancedPromptEngineering.java` - Prompt templates\n2. `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java` - Narrative generation\n3. `party-lore-ai/src/main/java/com/partylore/ai/narrative/NarrativeMemoryService.java` - Context management\n4. `party-lore-ai/src/main/java/com/partylore/ai/mechanics/Tier1PostProcessor.java` - Mechanics XML generation\n\n### Medium Priority\n5. `party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java` - Batch processing\n6. `party-lore-ai/src/main/java/com/partylore/ai/mechanics/CombatMechanicsEngine.java` - Combat mechanics\n7. `party-lore-ai/src/main/java/com/partylore/ai/narrative/PromptTemplates.java` - Template definitions\n\n---\n\n## Test Reports Reference\n\n**Latest Test Report**: `.test-reports/test-report-quick-20251109-124839.md`\n\n**Key Statistics**:\n- Duration: 13m 58s\n- Total Turns: 5\n- Total Issues: 39 instances across 9 categories\n- Pass Rate: 20% (1 of 5 scenarios)\n\n**Test Scenarios**:\n1. Basic Combat - 2 Players vs Enemy\n2. Group Combat - 3 Players Coordination\n3. Solo Exploration - Discovery and Sharing (PASSED)\n4. NPC Interaction - Information Gathering\n5. Epic 9 - Structured Mechanics (HP/Location/Progress)\n\n---\n\n## Next Steps\n\n1. **Create Functional Requirements** (use `/specify`)\n   - FR: Prevent GM from predicting player actions\n   - FR: Maintain distinct player identities in multi-player scenarios\n   - FR: Ensure all player actions receive responses\n   - FR: Generate combat mechanics for combat actions\n\n2. **Create Technical Plans** (use `/plan`)\n   - Plan: Prompt engineering improvements\n   - Plan: Multi-player context management\n   - Plan: Combat mechanics integration\n\n3. **Break Down into Tasks** (use `/tasks`)\n   - Individual tasks for each fix\n   - Validation tasks for each improvement\n   - Re-testing tasks\n\n4. **Implement Systematically** (use `/implement`)\n   - Address CRITICAL issues first\n   - Test each fix individually\n   - Validate with autonomous tests\n\n---\n\n## Notes\n\n- **Architectural Foundation**: Solid (Hibernate fixed, combat detection working, NPCs registering)\n- **Core Problem**: AI prompt engineering and context management\n- **Pattern**: Solo scenarios work better than multi-player (coordination/tracking issue)\n- **Priority**: Player agency and identity are most critical for playability\n\n**Last Updated**: 2025-11-09\n**Commit**: a71f40f\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/AI_NARRATIVE_QUALITY_ISSUES.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "function",
        "md",
        "test"
      ],
      "content_hash": "e68b6cbe3a28777f",
      "size_bytes": 16784,
      "created_at": "2026-01-02T20:42:12.433152"
    },
    {
      "doc_id": "local_party-lore_REQUIREMENTS-ASSESSMENT",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/REQUIREMENTS-ASSESSMENT.md",
      "content": "# Requirements Assessment: Test Issues vs Existing Requirements\n**Date**: January 15, 2025\n**Purpose**: Determine if existing requirements cover identified test issues or if new spec kit documents are needed\n\n## Summary\n\n**Recommendation**: **NO new requirements needed.** Existing requirements (FR-184, FR-186, FR-194) comprehensively cover all P0 missing mechanics identified in test analysis. We should proceed directly to implementation.\n\n## Test Issues Analysis\n\n### Issues Identified in TEST-ANALYSIS-CORE-20251115.md\n\nFrom the comprehensive test analysis, we identified these **P0 Missing Mechanics**:\n\n1. **Combat System** - Initiative, attack rolls, damage calculation, enemy HP tracking\n2. **Readiness/Held Actions** - \"Ready to fire when X\" triggers\n3. **Status Effects** - Frozen, stunned, poisoned with mechanical effects\n\n### Existing Requirements Coverage\n\n#### FR-184: MVP Structured Game Mechanics\n**Status**: Draft, P0-CRITICAL\n**Coverage**:\n- ‚úÖ Structured AI Output (XML mechanics format)\n- ‚úÖ HP Tracking for players\n- ‚úÖ NPC HP Tracking (mentioned as deferred to FR-186 but concept exists)\n- ‚úÖ Location Context\n- ‚úÖ NPC Status Tracking (hybrid approach with keyword detection fallback)\n- ‚úÖ Combat loop mechanics\n\n**Gaps**: None for MVP level\n\n#### FR-186: Combat System Functional Fixes\n**Status**: Draft, P0-CRITICAL\n**Coverage**:\n- ‚úÖ Combat Detection and Validation\n- ‚úÖ HP Changes Mandatory During Combat\n- ‚úÖ NPC HP Tracking in Database (schema changes included)\n- ‚úÖ Real NPC HP in AI Context\n- ‚úÖ Combat State Machine (NONE, ACTIVE, RESOLVED)\n- ‚úÖ Combat Resolution Before Scene Completion\n- ‚úÖ Combat Round Tracking\n\n**Gaps**: None - this is exactly what we need\n\n#### FR-194: Combat Mechanics Implementation Plan\n**Status**: P1-HIGH implementation plan\n**Coverage**:\n- ‚úÖ MechanicsClassifier service (detects combat actions)\n- ‚úÖ Combat enforcement in prompts\n- ‚úÖ Weapon-specific damage ranges\n- ‚úÖ Tier1PostProcessor validation enhancements\n- ‚úÖ Default mechanics injection as failsafe\n- ‚úÖ Metrics tracking for combat quality\n\n**Gaps**: None - comprehensive technical plan\n\n## Gap Analysis: What's Missing?\n\n### P0 Issues from Tests\n\n| Issue | Covered By | Implementation Status |\n|-------|-----------|----------------------|\n| Combat System (HP, damage, initiative) | FR-184, FR-186, FR-194 | ‚ùå Not implemented |\n| NPC HP Tracking | FR-186 (Fix 3: V089 migration) | ‚ùå Not implemented |\n| Combat State Machine | FR-186 (Fix 5: CombatState enum) | ‚ùå Not implemented |\n| Readiness/Held Actions | ‚ö†Ô∏è **NOT COVERED** | ‚ùå Not specified |\n| Status Effects (frozen, stunned) | ‚ö†Ô∏è **NOT COVERED** | ‚ùå Not specified |\n\n### P1 Issues from Tests\n\n| Issue | Covered By | Implementation Status |\n|-------|-----------|----------------------|\n| Investigation/Skill Check System | ‚ö†Ô∏è **NOT COVERED** | ‚ùå Not specified |\n| Equipment System | FR-184 (deferred to Phase 4) | ‚ùå Not specified |\n| NPC Morale/Behavior System | FR-004, FR-168, FR-169 | ‚ùå Partially specified |\n\n### P2 Issues from Tests\n\n| Issue | Covered By | Implementation Status |\n|-------|-----------|----------------------|\n| Location/Movement System | FR-027, FR-184, FR-187 | ‚ùå Partially specified |\n| Resource Tracking (ammo, charges) | ‚ö†Ô∏è **NOT COVERED** | ‚ùå Not specified |\n\n## Detailed Assessment\n\n### 1. Combat System (P0) - ‚úÖ FULLY COVERED\n\n**Test Issues**:\n- AI skips combat mechanics entirely\n- No HP changes during combat\n- No multi-turn battles\n- Enemies don't fight back\n\n**Covered By**:\n- **FR-184**: Structured AI output with HP mechanics\n- **FR-186 Fix 1**: Combat detection and validation\n- **FR-186 Fix 2**: Mandatory HP changes during combat\n- **FR-186 Fix 3**: NPC HP tracking (V089 migration)\n- **FR-194 TASK-195**: MechanicsClassifier to detect combat\n- **FR-194 TASK-196**: Combat prompt templates with weapon damage\n- **FR-194 TASK-198**: Tier1PostProcessor validation + injection\n\n**Recommendation**: **IMPLEMENT existing requirements**. No new spec needed.\n\n**Implementation Path**:\n1. Start with FR-184 (MVP Structured Game Mechanics)\n2. Then FR-186 (Combat System Functional Fixes)\n3. Then FR-194 (Combat Mechanics Failsafe Elimination)\n\n### 2. Readiness/Held Actions (P0) - ‚ö†Ô∏è NOT COVERED\n\n**Test Issues**:\n- Players declare \"ready to fire when door opens\"\n- AI doesn't trigger conditional actions\n- Readiness state lost between turns\n\n**Coverage Analysis**:\n- FR-002d mentions \"conditional actions\" in title but focuses on combat intentions\n- FR-163 (Mechanics Executor) could handle triggers but doesn't specify readiness\n- No explicit requirements for \"held action\" mechanics\n\n**Recommendation**: **NEW REQUIREMENT NEEDED**\n\nSuggest creating:\n- **FR-201: Readiness and Conditional Action System**\n  - Held action state tracking\n  - Trigger condition evaluation\n  - Turn order implications\n  - State persistence in memory\n\n**Priority**: P0 (appears in test failures consistently)\n\n### 3. Status Effects (P0) - ‚ö†Ô∏è NOT COVERED\n\n**Test Issues**:\n- \"Frozen\" described in narrative but no mechanical effect\n- Players still act normally while \"stunned\"\n- Poison damage not tracked\n- No duration tracking\n\n**Coverage Analysis**:\n- FR-184 mentions status effects as deferred to future\n- FR-186 focuses on HP and combat state, not status effects\n- No explicit requirements for status effect system\n\n**Recommendation**: **NEW REQUIREMENT NEEDED**\n\nSuggest creating:\n- **FR-202: Status Effects System**\n  - Effect types (frozen, stunned, poisoned, etc.)\n  - Duration tracking\n  - Mechanical impact (skip turn, reduced damage, etc.)\n  - Effect removal conditions\n  - Stacking rules\n\n**Priority**: P0 (core combat mechanic)\n\n### 4. Investigation/Skill Check System (P1) - ‚ö†Ô∏è NOT COVERED\n\n**Test Issues**:\n- \"You search the room\" has no success/fail mechanic\n- All investigations succeed automatically\n- No skill differentiation\n\n**Coverage Analysis**:\n- FR-184 doesn't include skill checks (deferred)\n- FR-186 focuses on combat only\n- No character stats system to base checks on\n\n**Recommendation**: **NEW REQUIREMENT NEEDED** (but P1, not P0)\n\nSuggest creating:\n- **FR-203: Investigation and Skill Check System**\n  - Skill check mechanics\n  - Success/failure determination\n  - Character stat integration (when stats exist)\n  - Difficulty scaling\n\n**Priority**: P1 (important but not blocking MVP)\n\n### 5. Equipment System (P1) - ‚úÖ PARTIALLY COVERED\n\n**Test Issues**:\n- \"I use my medkit\" sometimes heals, sometimes doesn't\n- Inconsistent item rulings\n\n**Coverage Analysis**:\n- FR-184 explicitly defers to \"Phase 4 (FR-188 - Items & Equipment)\"\n- FR-188 mentioned in FR-184 but doesn't exist as standalone requirement\n\n**Recommendation**: **DEFER to existing plan** (Phase 4)\n\nEquipment system is recognized as future work. For now, AI handles items narratively.\n\n**Priority**: P1 (can be handled narratively for MVP)\n\n### 6. NPC Morale/Behavior System (P1) - ‚úÖ PARTIALLY COVERED\n\n**Test Issues**:\n- NPCs never flee\n- No surrender mechanics\n- NPCs fight to death\n\n**Coverage Analysis**:\n- FR-004: Deep Narrative Memory System (includes NPC personality)\n- FR-168: Narrative Arc-Driven NPC Guidance\n- FR-169: AI-Driven Narrative Arc Generation\n- None explicitly specify morale/fleeing mechanics\n\n**Recommendation**: **ENHANCEMENT to FR-186 or new FR-204**\n\nCould add to FR-186 as:\n- **Fix 8: NPC Morale System** (P1)\n  - Morale threshold (HP%, turn count, player advantage)\n  - Flee behavior triggers\n  - Surrender conditions\n\n**Priority**: P1 (improves realism but not blocking)\n\n### 7. Location/Movement System (P2) - ‚úÖ PARTIALLY COVERED\n\n**Test Issues**:\n- Players teleport instantly between locations\n- No distance mechanics\n- Adjacency ignored\n\n**Coverage Analysis**:\n- FR-027: Zone-Based Combat Positioning System\n- FR-184: Location context (string-based for MVP)\n- FR-187: Full Location System (mentioned in FR-184 as Phase 4)\n\n**Recommendation**: **IMPLEMENT existing FR-027 + defer FR-187 to Phase 4**\n\nFR-027 covers zone-based positioning for combat. Full location graph deferred.\n\n**Priority**: P2 (enhancement)\n\n### 8. Resource Tracking (P2) - ‚ö†Ô∏è NOT COVERED\n\n**Test Issues**:\n- Unlimited ammo\n- No consumable tracking\n- Equipment charges infinite\n\n**Coverage Analysis**:\n- FR-184 defers to Phase 4 equipment system\n- No explicit resource tracking requirements\n\n**Recommendation**: **DEFER** (part of future equipment system)\n\nResource tracking can be added when FR-188 (Items & Equipment) is implemented.\n\n**Priority**: P2 (nice-to-have)\n\n## Recommendations Summary\n\n### ‚úÖ IMPLEMENT EXISTING REQUIREMENTS (Start Immediately)\n\nThese requirements fully cover P0 test failures and should be implemented in order:\n\n1. **FR-184: MVP Structured Game Mechanics** (1-2 days)\n   - Structured AI output\n   - HP tracking\n   - Location context\n   - NPC status tracking\n\n2. **FR-186: Combat System Functional Fixes** (3-4 days)\n   - Combat detection\n   - NPC HP in database\n   - Combat state machine\n   - Combat round tracking\n\n3. **FR-194: Combat Mechanics Implementation Plan** (5-7 days)\n   - MechanicsClassifier\n   - Combat enforcement prompts\n   - Weapon damage variety\n   - Tier1PostProcessor enhancements\n\n**Total Implementation Time**: ~10-14 days\n**Impact**: Fixes 80%+ of identified test failures\n\n### ‚ö†Ô∏è CREATE NEW REQUIREMENTS (Needed for Complete P0 Coverage)\n\nThese gaps require new spec kit documents:\n\n1. **FR-201: Readiness and Conditional Action System** (P0)\n   - Held actions\n   - Trigger conditions\n   - State persistence\n\n2. **FR-202: Status Effects System** (P0)\n   - Effect types and durations\n   - Mechanical impacts\n   - Effect stacking\n\n**Estimated Spec Time**: 2-3 hours each\n**Estimated Implementation Time**: 3-5 days each\n\n### üîÑ ENHANCE EXISTING REQUIREMENTS (Optional)\n\n1. **FR-186 Enhancement**: Add NPC Morale System (P1)\n2. **FR-027 Implementation**: Zone-Based Combat Positioning (P2)\n\n### ‚è∏Ô∏è DEFER TO FUTURE PHASES\n\nThese are recognized as future work and don't need immediate attention:\n\n1. **FR-188: Items & Equipment System** (Phase 4)\n2. **FR-187: Full Location System** (Phase 4)\n3. **Resource Tracking** (part of equipment system)\n\n## Implementation Priority\n\n### IMMEDIATE (This Sprint)\n```\n1. Implement FR-184 (MVP Structured Game Mechanics)\n2. Implement FR-186 P0 fixes (Combat System Functional Fixes)\n3. Create FR-201 (Readiness/Conditional Actions)\n4. Create FR-202 (Status Effects)\n```\n\n### NEXT SPRINT\n```\n5. Implement FR-194 (Combat Mechanics Failsafe Elimination)\n6. Implement FR-201 (Readiness system)\n7. Implement FR-202 (Status effects)\n8. FR-186 P1 fixes (Combat state, scene completion)\n```\n\n### PHASE 1\n```\n9. FR-186 Enhancement (NPC Morale)\n10. FR-027 (Zone-Based Positioning)\n11. FR-203 (Investigation/Skill Checks)\n```\n\n## Test Coverage Analysis\n\n### Issues Fixed by Existing Requirements\n\n| Test Issue Category | Fix Rate | Covered By |\n|---------------------|----------|-----------|\n| Player Agency Violations | 95% | Prompt fixes (completed) |\n| Multi-Player Coordination | 90% | Prompt fixes (completed) |\n| Missing Combat Mechanics | 75% | FR-184 + FR-186 + FR-194 |\n| Location Tracking | 60% | FR-184 (MVP) + FR-027 (full) |\n| NPC Behavior | 50% | FR-168 + FR-169 + FR-186 |\n| Duplicate Responses | 100% | Cache fixes (completed) |\n\n### Issues Requiring New Requirements\n\n| Test Issue Category | Coverage Gap | New Requirement |\n|---------------------|--------------|-----------------|\n| Conditional Actions | 100% | FR-201 needed |\n| Status Effects | 100% | FR-202 needed |\n| Skill Checks | 100% | FR-203 needed |\n| Resource Tracking | 100% | Deferred to FR-188 |\n\n## Conclusion\n\n**We do NOT need to start with spec creation.** We should:\n\n1. ‚úÖ **Start implementing FR-184, FR-186, FR-194** (existing requirements cover 75% of issues)\n2. ‚ö†Ô∏è **Create FR-201 and FR-202** while implementing (fill P0 gaps for conditional actions and status effects)\n3. üß™ **Run tests after each implementation** to validate improvements\n4. üìä **Re-assess** after FR-184/186/194 are deployed to see if FR-201/202 are still critical\n\n**Estimated Timeline**:\n- Week 1: Implement FR-184 + start FR-186\n- Week 2: Complete FR-186 + create FR-201/FR-202 specs\n- Week 3: Implement FR-194 + start FR-201/202\n- Week 4: Complete FR-201/202 + comprehensive testing\n\n**Next Immediate Action**: Begin implementation of FR-184 (MVP Structured Game Mechanics).\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/REQUIREMENTS-ASSESSMENT.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "0f238def8ee47d03",
      "size_bytes": 12397,
      "created_at": "2026-01-02T20:42:12.433330"
    },
    {
      "doc_id": "local_party-lore_MUCA-VOTING-AI-COMPATIBILITY-ANALYSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/MUCA-VOTING-AI-COMPATIBILITY-ANALYSIS.md",
      "content": "# MUCA Voting + AI Player Compatibility Analysis\n\n## Critical Architectural Mismatch Identified\n\n### The Problem\n\n**MUCA voting expects structured commands**, but we've built a **natural language RPG**. This creates a fundamental tension:\n\n- **Vote prompts say:** \"To vote, reply: VOTE 1, VOTE 2, or VOTE 3\"\n- **AI players respond:** \"I confidently raise my hand and vote 'VOTE 3', grinning broadly and giving an energetic thumbs-up...\"\n- **Real human players likely respond:** \"I think we should go with option 3\" or \"Let's do #2\"\n\nWe've injected a **non-AI-friendly structured mechanic** into an otherwise natural language game.\n\n---\n\n## Evidence from Integration Test\n\n### What Vote Prompts Look Like (MucaVotingService.java:179-188)\n\n```\nüó≥Ô∏è VOTE REQUIRED üó≥Ô∏è\n\nüë• GROUP DECISION\n\nThe party faces a decision about which direction to take. How should the party proceed?\n\n1) [Player action description]\n2) [Alternative approach]\n3) [Compromise solution]\n\nTo vote, reply:\nVOTE 1, VOTE 2, or VOTE 3\n\nüìä All 3 players must vote to proceed.\n```\n\n### How AI Players Actually Responded\n\nFrom `/tmp/muca-test.log`:\n\n1. ‚ùå `\"I confidently raise my hand and vote \\\"VOTE 3\\\", grinning broadly and giving an energetic thumbs-up to reinforce the team's collective approach.\"`\n2. ‚ùå `\"I leap onto a nearby chair, pump my fist in the air, and shout \\\"VOTE 3!\\\" with maximum enthusiasm, then start rhythmically chanting \\\"Three! Three! Three!\\\" to rally everyone's support.\"`\n3. ‚ùå `\"I stride confidently to the center of the room, dramatically spinning a throwing knife between my fingers, and declare \\\"VOTE 3!\\\" with a charismatic wink...\"`\n\n**None of these were recognized as votes by VoteCommandHandler!**\n\n### Why They Weren't Recognized\n\n**MessageRouter.java:122** only catches messages that **start** with \"VOTE\":\n\n```java\nif (messageBody != null && messageBody.trim().toUpperCase().startsWith(\"VOTE\")) {\n    // Convert \"VOTE 1\" to \"!vote 1\" format for CommandService\n    String voteCommand = \"!\" + messageBody.trim().toLowerCase();\n    InGameCommandResult result = inGameCommandRegistry.executeCommand(activePlayerOpt.get(), voteCommand);\n    return result.isSuccess() ? result.getMessage() : result.getErrorMessage();\n}\n```\n\n‚úÖ **Catches:** \"VOTE 3\", \"vote 3\", \"VOTE 1\"\n‚ùå **Misses:** \"I vote for option 3\", \"I confidently raise my hand and vote \\\"VOTE 3\\\"...\"\n\n**VoteCommandHandler.java:73-78** expects exact numeric argument:\n\n```java\nString optionNumber = arguments.trim();\n\n// Validate option number\nif (!optionNumber.matches(\"[1-3]\")) {\n    return CommandResult.error(\"Invalid option. Please vote 1, 2, or 3.\");\n}\n```\n\n‚úÖ **Accepts:** `!vote 1` ‚Üí arguments = \"1\"\n‚ùå **Rejects:** `!vote I think option 1 is best` ‚Üí arguments = \"I think option 1 is best\"\n\n### What Actually Happened to Those Votes?\n\n**They went to the AI GameMaster as regular player actions!**\n\nMessageRouter routing decision tree (lines 83-283):\n1. ‚ùå Not a `!` command\n2. ‚ùå Doesn't START with \"VOTE\"\n3. ‚ùå Not an uppercase system command\n4. ‚ùå Not in conversation flow\n5. ‚ùå Doesn't start with `@`\n6. ‚úÖ **Player has active game ‚Üí Broadcast to game as player action (line 262)**\n7. ‚úÖ **Publish PlayerActionEvent for AI processing (line 281)**\n\n**Result:** AI players' vote messages became roleplay text fed to the AI GameMaster!\n\n---\n\n## Additional Issues Discovered\n\n### 1. AI Players Don't Know They're Voting\n\nI checked DecisionMakingEngine - AI players receive the narrative context but **may not see the vote prompt as special**. They're just generating actions based on recent narrative.\n\n### 2. Test Scenario Analysis May Not See Votes\n\nThe `/test` command autonomous analysis likely doesn't recognize vote prompts as distinct mechanics events - it just sees them as narrative text.\n\n### 3. Humans Will Do This Too\n\nReal players are unlikely to type exactly \"VOTE 3\". They're more likely to:\n- \"Let's go with option 3\"\n- \"I vote for #2\"\n- \"Option 1 sounds good\"\n- \"3\"\n- \"I think we should attack\" (not even mentioning a number!)\n\n### 4. Player Intent + Roleplay Hybrid\n\nThe AI players did something **very natural** - they:\n1. ‚úÖ Understood they needed to vote\n2. ‚úÖ Embedded \"VOTE 3\" in their response\n3. ‚úÖ Added roleplay flavor and character expression\n4. ‚ùå But broke the rigid command parser\n\n**This is what human players might do too!**\n\n---\n\n## Possible Solutions\n\n### Option A: Fuzzy Vote Extraction (Natural Language Parsing)\n\n**Approach:** Make MessageRouter detect vote intent anywhere in the message.\n\n**Implementation:**\n```java\n// MessageRouter.java - add before general player action handling\nprivate Optional<String> extractVoteIntent(String messageBody) {\n    // Check if vote prompt is active (could add to player session state)\n\n    // Regex patterns for vote detection\n    Pattern[] votePatterns = {\n        Pattern.compile(\"\\\\bVOTE\\\\s*([1-3])\\\\b\", Pattern.CASE_INSENSITIVE),\n        Pattern.compile(\"\\\\boption\\\\s*([1-3])\\\\b\", Pattern.CASE_INSENSITIVE),\n        Pattern.compile(\"\\\\b([1-3])\\\\b\"), // Just the number if no other match\n        Pattern.compile(\"#([1-3])\"),\n        Pattern.compile(\"\\\\bchoose\\\\s*([1-3])\\\\b\", Pattern.CASE_INSENSITIVE),\n    };\n\n    for (Pattern pattern : votePatterns) {\n        Matcher matcher = pattern.matcher(messageBody);\n        if (matcher.find()) {\n            return Optional.of(matcher.group(1)); // Return \"1\", \"2\", or \"3\"\n        }\n    }\n\n    return Optional.empty();\n}\n\n// Then in route():\nif (hasActiveVote(phoneNumber)) {\n    Optional<String> voteNumber = extractVoteIntent(messageBody);\n    if (voteNumber.isPresent()) {\n        // Process as vote\n        String voteCommand = \"!vote \" + voteNumber.get();\n        InGameCommandResult result = inGameCommandRegistry.executeCommand(activePlayerOpt.get(), voteCommand);\n        return result.isSuccess() ? result.getMessage() : result.getErrorMessage();\n    }\n}\n```\n\n**Pros:**\n- ‚úÖ Works with natural language\n- ‚úÖ Matches how humans actually communicate\n- ‚úÖ AI players can add roleplay flavor\n- ‚úÖ Minimal changes to existing code\n\n**Cons:**\n- ‚ùå Ambiguous messages: \"I like option 1 but vote for 2\" ‚Üí Which one?\n- ‚ùå False positives: \"We need 3 torches\" ‚Üí Detected as vote?\n- ‚ùå Only works for numeric votes (what if we add A/B/C options later?)\n\n**Risk Level:** Medium - Regex can be fragile\n\n---\n\n### Option B: AI-Powered Vote Extraction\n\n**Approach:** Use Claude/LLM to extract vote intent from natural language.\n\n**Implementation:**\n```java\n// VoteIntentExtractor.java (new service)\npublic class VoteIntentExtractor {\n\n    @Autowired\n    private ClaudeClient claudeClient;\n\n    public VoteIntentResult extractVoteIntent(String playerMessage, GroupNarrativeDecision activeVote) {\n        String prompt = String.format(\"\"\"\n            TASK: Extract the player's vote from their message.\n\n            ACTIVE VOTE:\n            %s\n\n            Options:\n            1) %s\n            2) %s\n            3) %s\n\n            PLAYER MESSAGE:\n            \"%s\"\n\n            RESPONSE FORMAT (JSON):\n            {\n                \"voteDetected\": true/false,\n                \"optionNumber\": \"1\" or \"2\" or \"3\" or null,\n                \"confidence\": 0.0-1.0,\n                \"reasoning\": \"brief explanation\"\n            }\n\n            If the player is clearly voting for an option, return the number.\n            If uncertain or no vote detected, return voteDetected: false.\n            \"\"\",\n            activeVote.getDecisionPrompt(),\n            activeVote.getAvailableOptions().get(0).getDescription(),\n            activeVote.getAvailableOptions().get(1).getDescription(),\n            activeVote.getAvailableOptions().get(2).getDescription(),\n            playerMessage\n        );\n\n        // Call Claude API with fast model (Haiku)\n        String response = claudeClient.generateCompletion(prompt, \"claude-3-5-haiku-20241022\", 100);\n\n        // Parse JSON response\n        return parseVoteIntentResponse(response);\n    }\n}\n```\n\n**Pros:**\n- ‚úÖ Handles complex natural language\n- ‚úÖ Can detect intent even without numbers: \"Let's attack!\" ‚Üí Option 1 if option 1 is \"Attack\"\n- ‚úÖ Provides confidence scores\n- ‚úÖ Can handle ambiguity gracefully\n- ‚úÖ Extensible to non-numeric options\n\n**Cons:**\n- ‚ùå Adds AI API cost per vote message\n- ‚ùå Adds latency (~500ms-1s per vote)\n- ‚ùå Requires Claude API access\n- ‚ùå More complex implementation\n\n**Risk Level:** Low - AI is good at this, worst case falls back to \"no vote detected\"\n\n---\n\n### Option C: Hybrid Approach (Recommended)\n\n**Approach:** Regex first, AI fallback for ambiguous cases.\n\n**Flow:**\n```\nPlayer message received\n    ‚Üì\n1. Exact match? (\"VOTE 3\") ‚Üí Process immediately ‚úÖ\n    ‚Üì\n2. Regex pattern match? (\"option 3\", \"#2\") ‚Üí Process with medium confidence ‚úÖ\n    ‚Üì\n3. No clear pattern? ‚Üí AI extraction ‚Üí High confidence? ‚úÖ : Ask player to clarify ‚ùå\n```\n\n**Pros:**\n- ‚úÖ Fast path for clear votes (no AI call)\n- ‚úÖ Handles natural language via AI\n- ‚úÖ Graceful degradation\n- ‚úÖ Cost-effective (AI only when needed)\n\n**Cons:**\n- ‚ùå More complex implementation\n- ‚ùå Still requires AI service for ambiguous cases\n\n**Risk Level:** Low - Best of both worlds\n\n---\n\n### Option D: Pass Full Message to AI Narrative Anyway\n\n**Approach:** Record vote AND pass message to AI GameMaster for narrative continuity.\n\n**Flow:**\n```\nPlayer: \"I confidently vote for option 3 while encouraging the team!\"\n    ‚Üì\n1. Extract vote: \"3\" ‚Üí Record in VoteCommandHandler ‚úÖ\n    ‚Üì\n2. ALSO pass full message to AI GameMaster for narrative ‚úÖ\n    ‚Üì\n3. AI generates narrative incorporating the player's roleplay:\n   \"Cedric's enthusiasm is infectious as he rallies the team around option 3...\"\n```\n\n**Implementation:**\n```java\n// MessageRouter.java\nif (hasActiveVote(phoneNumber)) {\n    Optional<String> voteNumber = extractVoteIntent(messageBody);\n    if (voteNumber.isPresent()) {\n        // 1. Process vote\n        String voteCommand = \"!vote \" + voteNumber.get();\n        inGameCommandRegistry.executeCommand(activePlayerOpt.get(), voteCommand);\n\n        // 2. ALSO send full message to AI for narrative\n        PlayerActionEvent event = new PlayerActionEvent(\n            this,\n            game.getId(),\n            activePlayer.getId(),\n            messageBody, // Full message, not just \"3\"\n            ActionSource.SMS_WEBHOOK,\n            phoneNumber\n        );\n        eventPublisher.publishEvent(event);\n\n        return \"Vote recorded! The GM is incorporating your action into the narrative...\";\n    }\n}\n```\n\n**Pros:**\n- ‚úÖ Captures player roleplay\n- ‚úÖ Richer narrative\n- ‚úÖ Encourages creative voting messages\n- ‚úÖ AI can reference how players voted in narrative\n\n**Cons:**\n- ‚ùå AI might get confused by vote mechanics\n- ‚ùå Need to tell AI to ignore vote mechanics in prompt\n- ‚ùå Double-processing same message\n\n**Risk Level:** Medium - Requires careful prompt engineering\n\n---\n\n## Recommendation\n\n**Implement Option C (Hybrid) + Option D (Dual Processing)**\n\n### Phase 1: Quick Win - Regex Vote Extraction\n\n1. Add `extractVoteIntent()` to MessageRouter with simple regex patterns\n2. Test with real players and AI players\n3. Log all vote extractions to analyze patterns\n\n**Effort:** 2-3 hours\n**Risk:** Low\n**Impact:** High - Makes voting work for 80% of cases\n\n### Phase 2: AI-Powered Extraction\n\n1. Implement VoteIntentExtractor service with Claude API\n2. Use as fallback when regex uncertain\n3. Log confidence scores and accuracy\n\n**Effort:** 4-6 hours\n**Risk:** Low\n**Impact:** High - Handles remaining 20% of complex cases\n\n### Phase 3: Dual Processing for Narrative Richness\n\n1. Pass vote messages to AI GameMaster even after recording vote\n2. Add prompt instructions to handle vote-embedded actions\n3. Test narrative quality improvements\n\n**Effort:** 3-4 hours\n**Risk:** Medium\n**Impact:** Medium - Better narrative but requires prompt tuning\n\n---\n\n## Test Cases to Validate\n\n### Exact Match (Should Work Now)\n- ‚úÖ \"VOTE 1\"\n- ‚úÖ \"vote 2\"\n- ‚úÖ \"VOTE 3\"\n\n### Natural Language (Currently Broken)\n- ‚ùå \"I vote for option 3\"\n- ‚ùå \"Let's go with #2\"\n- ‚ùå \"Option 1 sounds good\"\n- ‚ùå \"3\"\n\n### Roleplay + Vote (AI Player Behavior)\n- ‚ùå \"I confidently raise my hand and vote 'VOTE 3'\"\n- ‚ùå \"I leap onto a chair and shout VOTE 3!\"\n\n### Ambiguous Cases (Needs AI)\n- ‚ö†Ô∏è \"I like option 1 but let's do 2\" ‚Üí Should extract \"2\"\n- ‚ö†Ô∏è \"Let's attack!\" ‚Üí Should map to option if \"Attack\" is in description\n- ‚ö†Ô∏è \"I agree with Cedric\" ‚Üí Should inherit Cedric's vote? Or ask for clarification?\n\n### False Positives to Avoid\n- ‚õî \"We need 3 torches\" ‚Üí Should NOT be detected as vote\n- ‚õî \"There are 2 guards\" ‚Üí Should NOT be detected as vote\n\n---\n\n## Impact on AI Analysis/Review\n\n### Current Issue\n\nThe `/test` command and autonomous testing likely don't recognize vote prompts as special mechanics events. They see:\n\n```\nSMS: \"üó≥Ô∏è VOTE REQUIRED... To vote, reply: VOTE 1, VOTE 2, or VOTE 3\"\n```\n\nAs just another narrative message, not as a mechanics prompt requiring structured response.\n\n### Solution\n\n**Mark vote prompts in game state:**\n\n```java\n// GameContext.additionalData\nadditionalData.put(\"activeVotePrompt\", true);\nadditionalData.put(\"voteOptions\", List.of(\"Attack\", \"Defend\", \"Flee\"));\n```\n\n**Update AI test agents to recognize voting state:**\n\n```java\n// DecisionMakingEngine.java\nif (gameContext.getAdditionalData().get(\"activeVotePrompt\") == Boolean.TRUE) {\n    // Generate structured vote response\n    return \"VOTE \" + chooseOption(gameContext);\n}\n```\n\n**Update analysis to track vote mechanics:**\n\n```java\n// TestScenarioAnalyzer.java\nif (smsMessage.contains(\"VOTE REQUIRED\")) {\n    scenarioMetrics.recordMechanicsEvent(\"MUCA_VOTE_INITIATED\");\n    scenarioMetrics.recordExpectedOutcome(\"vote_prompt_sent\", true);\n}\n```\n\n---\n\n## Conclusion\n\nThis is a **critical architectural issue** but **solvable**. The core problem is that we built a natural language RPG and then introduced a rigid structured mechanic without adapting the message processing pipeline.\n\n**The fix is to meet players where they are** - let them vote naturally, extract intent intelligently, and preserve the roleplay flavor that makes the game engaging.\n\n**Immediate Action Items:**\n1. ‚úÖ Document this analysis (this file)\n2. ‚¨ú Implement regex vote extraction (Phase 1)\n3. ‚¨ú Test with real players\n4. ‚¨ú Add AI fallback extraction (Phase 2)\n5. ‚¨ú Update AI test agents to handle votes properly\n6. ‚¨ú Update analysis to recognize vote mechanics\n\n**Timeline:** 2-3 days for full implementation and testing\n\n---\n\n**Generated:** 2025-11-02\n**Author:** Claude (via user investigation)\n**Status:** Analysis Complete - Awaiting Implementation Decision\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/MUCA-VOTING-AI-COMPATIBILITY-ANALYSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "e39eff3810d5f0bf",
      "size_bytes": 14678,
      "created_at": "2026-01-02T20:42:12.433388"
    },
    {
      "doc_id": "local_party-lore_GAME-STUCK-DIAGNOSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/GAME-STUCK-DIAGNOSIS.md",
      "content": "# Game Stuck Diagnosis - Baron Won't Talk\n\n**Date**: November 10, 2025\n**Issue**: Player can't interact with Baron Aldric. Game loops with vague descriptive narrative.\n\n---\n\n## Problem Statement\n\nUser reports:\n- The Baron won't talk\n- Game won't progress\n- Feels like \"so many restrictions on how the AI should behave that it does nothing but loop\"\n\nPlayer actions show:\n```\n1. \"Ask the guard which way we go to find the Baron\" ‚Üí Guard gives directions\n2. \"Head towards Baron's study and knock on the door\" ‚Üí No answer, sense movement within\n3. \"Bang harder\" ‚Üí \"subtle crack, a slight shift\"\n4. \"Just open the door\" ‚Üí Door opens, see study interior\n5. [Now stuck in study with vague descriptions, no Baron interaction]\n```\n\n---\n\n## Root Cause Analysis\n\n### Primary Issue: **NPCs Not Spawned**\n\n**Database Evidence**:\n```sql\nSELECT name, role, importance, status\nFROM active_npcs\nWHERE session_id = '193eebf4-d0c2-4dc4-82d7-6f9baddf4f04';\n\n-- Result: 0 rows\n```\n\n**Beat Definition HAS Baron Aldric**:\n```json\n{\n  \"npcs\": [\n    {\n      \"name\": \"Baron Aldric Thornhaven\",\n      \"role\": \"Quest Giver\",\n      \"importance\": \"MAJOR\",\n      \"motivation\": \"Protect his territory and people from the wyvern threat\",\n      \"personality\": \"Pragmatic, war-weary\",\n      \"firstAppearanceBeat\": 1\n    }\n  ]\n}\n```\n\n**Conclusion**: Baron Aldric exists in `plot_beats.key_npcs_json` but was **NEVER instantiated** into the `active_npcs` table. The AI has no NPC to interact with.\n\n---\n\n## Technical Deep Dive\n\n### 1. How NPCs Are Supposed to Work\n\n**GameContextAssembler.java:801-826**:\n```java\nif (npcRegistryService != null) {\n    List<ActiveNPC> activeNPCs = npcRegistryService.getActiveNPCs(session);\n\n    for (ActiveNPC npc : activeNPCs) {\n        builder.addNPC(npc.getName());\n\n        if (npc.getRole() == NPCRole.QUEST_GIVER) {\n            builder.addEvent(\"Quest-giving NPC present: \" + npc.getName());\n        }\n    }\n}\n```\n\n**Expected Flow**:\n1. Beat starts ‚Üí NPCs from `key_npcs_json` spawned into `active_npcs` table\n2. GameContextAssembler fetches active NPCs from database\n3. NPCs added to GameContext.entityStates\n4. AI prompts include NPC roster\n5. AI can generate dialogue and interactions\n\n**Actual Flow**:\n1. Beat starts ‚Üí **NPCs never spawned**\n2. GameContextAssembler fetches empty list\n3. GameContext has NO NPCs\n4. AI has no NPCs to work with\n5. AI generates vague environmental descriptions instead\n\n---\n\n### 2. AI Prompt Restrictions Analysis\n\n**Do AI prompts restrict NPC interaction?**\n\n**Searched for restrictions**: `DO NOT introduce|NEVER introduce|avoid introducing`\n\n**Found**: Only ONE restriction related to realm consistency:\n```java\n\"DO NOT introduce elements from other realms, genres, or time periods.\"\n```\n\n**Verdict**: **NO restrictions preventing NPC dialogue or interaction.**\n\nThe AI prompts:\n- ‚úÖ Allow NPCs in entityStates\n- ‚úÖ Allow NPC dialogue\n- ‚úÖ Allow quest-giver interactions\n- ‚úÖ Have combat mechanics for hostile NPCs\n- ‚úÖ Support conversational NPCs\n\n**The restriction theory is FALSE.** The AI would happily generate Baron Aldric dialogue if he existed in the context.\n\n---\n\n### 3. Why AI Generates Vague Descriptions\n\n**Without NPCs in Context**:\n```\nPlayer: \"Just open the door\"\nAI sees:\n  - Location: Baron's Study\n  - Scene objective: \"Meet with Baron Aldric...\"\n  - NPCs: [] (EMPTY)\n\nAI generates:\n  \"The heavy wooden door yields with a low, grinding creak.\n   Cool, stale air rushes past you...\"\n```\n\n**What AI SHOULD see**:\n```\nPlayer: \"Just open the door\"\nAI sees:\n  - Location: Baron's Study\n  - Scene objective: \"Meet with Baron Aldric...\"\n  - NPCs: [Baron Aldric Thornhaven (QUEST_GIVER, PRESENT)]\n\nAI generates:\n  \"The door swings open. Baron Aldric sits behind a massive oak desk,\n   studying a map of the Blackwood frontier. He looks up as you enter.\n   'About time,' he says gruffly. 'The wyvern won't kill itself.'\"\n```\n\n**The AI is working correctly.** It's generating descriptions based on available context. With zero NPCs, it has nothing to interact with.\n\n---\n\n## Why This Feels Like \"Too Many Restrictions\"\n\n**User's Perception**: \"Too many restrictions causing loops\"\n\n**Actual Problem**: **Missing data (NPCs) causing context vacuum**\n\n**Why It Feels That Way**:\n1. Player knows Baron should be there (scene objective says \"Meet with Baron\")\n2. Player opens door expecting Baron\n3. AI describes empty room because Baron doesn't exist in database\n4. Player tries again: \"Look for Baron\", \"Call out to Baron\"\n5. AI continues vague descriptions (no Baron to describe)\n6. **Loop**: Player frustrated, thinks AI is \"refusing\" to show Baron\n\n**Reality**: AI isn't refusing anything. Baron literally doesn't exist in game state.\n\n---\n\n## Missing NPC Spawning Logic\n\n**Critical Gap**: No code spawns NPCs from `key_npcs_json` when beat starts.\n\n**Expected Implementation**:\n```java\n@Service\npublic class BeatTransitionService {\n\n    @Autowired\n    private NPCRegistryService npcRegistryService;\n\n    @Autowired\n    private PlotBeatRepository plotBeatRepository;\n\n    @Transactional\n    public void startBeat(SimplePlotBeat beat, GameSession session) {\n        // Parse NPCs from beat.keyNpcsJson\n        BeatNPCs beatNPCs = parseKeyNpcsJson(beat.getKeyNpcsJson());\n\n        // Spawn each NPC into active_npcs table\n        for (NPCTemplate npcTemplate : beatNPCs.getNpcs()) {\n            if (npcTemplate.getFirstAppearanceBeat() == beat.getPhaseOrder()) {\n                ActiveNPC npc = new ActiveNPC();\n                npc.setSessionId(session.getId());\n                npc.setName(npcTemplate.getName());\n                npc.setRole(NPCRole.valueOf(npcTemplate.getRole()));\n                npc.setImportance(npcTemplate.getImportance());\n                npc.setStatus(NPCStatus.PRESENT);\n                npc.setCurrentHp(10);  // Default HP\n                npc.setMaxHp(10);\n\n                npcRegistryService.registerNPC(session, npc);\n\n                log.info(\"Spawned NPC: {} for beat {}\", npc.getName(), beat.getBeatId());\n            }\n        }\n    }\n}\n```\n\n**This logic DOES NOT EXIST in the codebase.**\n\n---\n\n## Impact of Arc/Beat Context Fix\n\n**Recent Fix**: Added beat/arc context to AI prompts (just deployed)\n\n**What It Fixed**:\n- ‚úÖ AI now sees beat description: \"Baron Aldric summons the Dragon's Hoard...\"\n- ‚úÖ AI now sees arc goal: \"Track down and eliminate the wyvern\"\n- ‚úÖ AI has better story context\n\n**What It DIDN'T Fix**:\n- ‚ùå Baron still doesn't exist in active_npcs table\n- ‚ùå AI still has no NPC to interact with\n- ‚ùå Player still stuck\n\n**Verdict**: Context fix helps with narrative coherence but doesn't solve the NPC spawning bug.\n\n---\n\n## Evidence Summary\n\n### Database State\n- **active_npcs**: 0 rows (should have Baron Aldric)\n- **plot_beats.key_npcs_json**: Contains Baron Aldric template\n- **scenes.status**: Current scene is RESOLVED (but still set as current_scene_id)\n- **player_actions**: 9 actions showing player trying to find/interact with Baron\n\n### Code State\n- **GameContextAssembler**: ‚úÖ Has code to load NPCs from active_npcs\n- **NPCRegistryService**: ‚úÖ Exists and works\n- **BeatTransitionService**: ‚ùå Missing NPC spawning logic\n- **SceneCreationService**: ‚ùå Missing NPC spawning logic\n\n### AI Prompt State\n- **NPC interaction restrictions**: ‚ùå NONE found\n- **Combat mechanics**: ‚úÖ Full support for NPC combat\n- **Dialogue support**: ‚úÖ AI can generate NPC dialogue\n- **Quest-giver support**: ‚úÖ Explicit handling for QUEST_GIVER role\n\n---\n\n## Recommended Fixes\n\n### Priority 0: Spawn Missing NPCs (Immediate Workaround)\n\n**Manual Database Fix**:\n```sql\n-- Manually spawn Baron Aldric for current game\nINSERT INTO active_npcs (\n    id, session_id, name, role, importance, status,\n    current_hp, max_hp, first_mentioned, last_mentioned\n) VALUES (\n    gen_random_uuid(),\n    '193eebf4-d0c2-4dc4-82d7-6f9baddf4f04',  -- Current session\n    'Baron Aldric Thornhaven',\n    'QUEST_GIVER',\n    'MAJOR',\n    'PRESENT',\n    15, 15,\n    NOW(), NOW()\n);\n```\n\n**Result**: Baron immediately appears in next turn's context. Game unstuck.\n\n### Priority 1: Implement NPC Spawning (Permanent Fix)\n\n**Create BeatNPCSpawner.java**:\n```java\n@Service\npublic class BeatNPCSpawner {\n\n    @Autowired\n    private ActiveNPCRepository activeNPCRepository;\n\n    /**\n     * Spawn NPCs from beat's keyNpcsJson when beat starts.\n     */\n    @Transactional\n    public void spawnBeatNPCs(SimplePlotBeat beat, GameSession session) {\n        if (beat.getKeyNpcsJson() == null || beat.getKeyNpcsJson().isBlank()) {\n            log.debug(\"No NPCs defined for beat {}\", beat.getBeatId());\n            return;\n        }\n\n        try {\n            BeatNPCs beatNPCs = objectMapper.readValue(\n                beat.getKeyNpcsJson(),\n                BeatNPCs.class\n            );\n\n            for (NPCTemplate template : beatNPCs.getNpcs()) {\n                // Check if this NPC should appear in this beat\n                if (template.getFirstAppearanceBeat() <= beat.getPhaseOrder()) {\n\n                    // Check if NPC already spawned\n                    Optional<ActiveNPC> existing = activeNPCRepository\n                        .findBySessionIdAndName(session.getId(), template.getName());\n\n                    if (existing.isPresent()) {\n                        log.debug(\"NPC {} already spawned, skipping\", template.getName());\n                        continue;\n                    }\n\n                    // Spawn new NPC\n                    ActiveNPC npc = new ActiveNPC();\n                    npc.setSessionId(session.getId());\n                    npc.setName(template.getName());\n                    npc.setRole(NPCRole.valueOf(template.getRole().toUpperCase().replace(\" \", \"_\")));\n                    npc.setImportance(template.getImportance());\n                    npc.setStatus(NPCStatus.PRESENT);\n                    npc.setCurrentHp(determineHPByRole(template.getRole()));\n                    npc.setMaxHp(determineHPByRole(template.getRole()));\n                    npc.setDescription(template.getPersonality() + \" - \" + template.getMotivation());\n\n                    activeNPCRepository.save(npc);\n\n                    log.info(\"Spawned NPC: {} ({}:{}) for beat {}\",\n                        npc.getName(), npc.getRole(), npc.getImportance(), beat.getBeatDescription());\n                }\n            }\n        } catch (Exception e) {\n            log.error(\"Failed to spawn NPCs from beat {}: {}\",\n                beat.getBeatId(), e.getMessage(), e);\n        }\n    }\n\n    private int determineHPByRole(String role) {\n        return switch (role.toUpperCase()) {\n            case \"QUEST_GIVER\", \"MERCHANT\" -> 15;\n            case \"ENEMY\" -> 10;\n            case \"ALLY\" -> 12;\n            default -> 10;\n        };\n    }\n}\n```\n\n**Call from BeatTransitionOrchestrator**:\n```java\n@Transactional\npublic void startNewBeat(SimplePlotBeat beat, GameSession session) {\n    // Existing beat initialization code...\n\n    // NEW: Spawn NPCs for this beat\n    beatNPCSpawner.spawnBeatNPCs(beat, session);\n\n    // Continue with opening narrative generation...\n}\n```\n\n### Priority 2: Scene Status Bug\n\n**Issue**: Current scene shows `RESOLVED` but is still set as `current_scene_id`.\n\n**Fix in SceneTransitionOrchestrator**:\n```java\nif (scene.getStatus() == SceneStatus.RESOLVED) {\n    log.info(\"Scene {} already RESOLVED - moving to next scene\", scene.getId());\n\n    // Clear current_scene_id\n    session.setCurrentScene(null);\n    sessionRepository.save(session);\n\n    // Transition to next scene\n    transitionToNextScene(session, scene);\n    return;\n}\n```\n\n---\n\n## Why Option 2 (Arc + Beat) Will Help\n\n**Current Problem**: 3 layers (Arc ‚Üí Beat ‚Üí Scene) with each needing NPC spawning.\n\n**Option 2 Benefit**: 2 layers (Arc ‚Üí Beat) simplifies:\n- ‚úÖ NPCs spawn once per beat (not per scene)\n- ‚úÖ Fewer transition points = fewer bugs\n- ‚úÖ Beat objectives better than scene objectives\n- ‚úÖ NPC lifecycle already designed at beat level\n\n**BUT**: Option 2 doesn't fix the underlying bug. **We still need NPC spawning logic**, just at beat level instead of scene level.\n\n---\n\n## Conclusion\n\n### What User Felt\n\"Too many AI restrictions causing loops\"\n\n### What Actually Happened\n1. NPCs defined in beat metadata but never spawned into database\n2. AI has no NPCs to work with\n3. AI generates vague environmental descriptions (working correctly with empty data)\n4. Player stuck because Baron doesn't exist\n\n### Fix Priority\n1. **NOW**: Manually spawn Baron Aldric in database ‚Üí game unstuck immediately\n2. **TODAY**: Implement BeatNPCSpawner.java ‚Üí fix permanently\n3. **THIS WEEK**: Option 2 refactor ‚Üí simplify architecture\n\n### Key Insight\n**The AI isn't too restricted. The game state is incomplete.**\n\nThe arc/beat context fix will improve narrative quality, but won't fix the NPC spawning bug. Both fixes are needed:\n- Context fix ‚Üí richer narratives\n- NPC spawning ‚Üí functional interactions\n\nüéØ **Root cause**: Missing NPC spawning logic, not AI prompt restrictions.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/GAME-STUCK-DIAGNOSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "5a49b417b178a54c",
      "size_bytes": 12994,
      "created_at": "2026-01-02T20:42:12.433469"
    },
    {
      "doc_id": "local_party-lore_OPTION-2-IMPLEMENTATION-PLAN",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/OPTION-2-IMPLEMENTATION-PLAN.md",
      "content": "# Option 2 Implementation Plan - Detailed Execution Strategy\n\n**Date**: November 10, 2025\n**Status**: Ready to Execute\n**Complexity**: HIGH - Major architectural change\n**Estimated Time**: 2-3 days for full implementation + testing\n\n---\n\n## Current Progress\n\n‚úÖ **COMPLETED:**\n1. Baron Aldric spawning bug fixed (NPCs now spawn from beat metadata)\n2. BeatProgression entity created\n3. BeatProgressionRepository created\n4. Flyway migration V091 created (adds beat_progression table)\n5. Requirements document created (OPTION-2-REQUIREMENTS.md)\n6. Comprehensive diagnosis created (GAME-STUCK-DIAGNOSIS.md)\n\n‚ö†Ô∏è **NOT STARTED:**\n- BeatProgressionService refactor\n- TwoTierNarrativeService updates\n- Scene removal\n- Beat transition logic\n- Opening narrative generation at beat level\n- Integration testing\n\n---\n\n## Implementation Strategy\n\n### Phase 1: Foundation (Infrastructure) - **CURRENT PHASE**\n\n**Goal**: Set up beat-level progression infrastructure without breaking existing scene-based system.\n\n**Tasks:**\n- [x] Create BeatProgression entity\n- [x] Create BeatProgressionRepository\n- [x] Create Flyway migration V091\n- [ ] Deploy migration to create beat_progression table\n- [ ] Test migration locally\n\n**Risk**: LOW - Additive changes only, no breaking changes\n\n---\n\n### Phase 2: Dual-Mode Operation (Transition)\n\n**Goal**: Run beat progression ALONGSIDE scene progression to validate behavior.\n\n**Tasks:**\n1. **Update BeatProgressionService**:\n   - Add methods: `startBeat()`, `recordProgress()`, `completeBeat()`\n   - Keep existing scene-based methods for now\n   - Log progress to both systems\n\n2. **Update TwoTierNarrativeService**:\n   - Extract beat objective in ADDITION to scene objective\n   - Pass both to AI (with beat taking priority)\n   - Record progress deltas to BOTH systems\n\n3. **Update Tier 1 Prompt**:\n   - Add beat context section\n   - Request progress toward beat objective\n   - Keep scene completion logic for backward compatibility\n\n**Risk**: MEDIUM - Requires careful transaction management\n\n**Validation**:\n- Both systems track progress\n- Compare scene vs beat progress numbers\n- Verify beat completes in 2-3 sessions\n\n---\n\n### Phase 3: Beat-First Mode (Migration)\n\n**Goal**: Switch to beat progression as primary, deprecate scenes.\n\n**Tasks:**\n1. **Update StoryDrivenSceneGenerator**:\n   - Generate beats directly (skip scene generation)\n   - Call BeatNPCSpawner when beat starts\n   - Generate opening narrative at beat level\n\n2. **Update GameServiceImpl**:\n   - Reference current_beat_id instead of current_scene_id\n   - Track beat progression instead of scene progression\n\n3. **Update SceneTransitionOrchestrator** ‚Üí **BeatTransitionOrchestrator**:\n   - Rename class\n   - Handle beat‚Üíbeat transitions\n   - Remove scene resolution logic\n\n4. **Update memory storage**:\n   - Store memories tagged with beat_id instead of scene_id\n   - Update MemoryService queries\n\n**Risk**: HIGH - Breaking changes to core game loop\n\n**Rollback Plan**: Keep scene tables, add feature flag to switch modes\n\n---\n\n### Phase 4: Scene Removal (Cleanup)\n\n**Goal**: Remove deprecated scene infrastructure.\n\n**Tasks:**\n1. **Database cleanup**:\n   - Create migration to drop scene_progression table\n   - Create migration to drop scenes table\n   - Update foreign key constraints\n\n2. **Code cleanup**:\n   - Remove Scene entity\n   - Remove SceneProgression entity\n   - Remove SceneRepository\n   - Remove SceneProgressionRepository\n   - Remove SceneProgressionService\n\n3. **Update references**:\n   - GameSession.currentScene ‚Üí remove field\n   - Memory fragments scene_id ‚Üí nullable or remove\n   - Player actions scene_id ‚Üí nullable or remove\n\n**Risk**: MEDIUM - Database migration must be carefully tested\n\n---\n\n## Critical Decision Point\n\n**STOP HERE FOR USER DECISION:**\n\nYou have 3 options:\n\n### Option A: FULL IMPLEMENTATION (2-3 days)\nExecute all 4 phases completely. This is a major refactor requiring:\n- Extensive testing\n- Database migration on production\n- Potential downtime\n- Risk of breaking existing games\n\n**Pros**: Clean architecture, no technical debt\n**Cons**: Time-consuming, risky, disruptive\n\n---\n\n### Option B: INFRASTRUCTURE ONLY (1 hour)\nComplete Phase 1 only:\n- Deploy V091 migration (adds beat_progression table)\n- Test locally\n- Leave implementation for later\n\n**Pros**: Quick, safe, non-breaking\n**Cons**: Beat progression not functional yet\n\n---\n\n### Option C: HYBRID APPROACH (4-6 hours)\nComplete Phases 1-2:\n- Deploy beat_progression table\n- Implement dual-mode tracking\n- Validate beat progression works\n- Keep scenes functional as fallback\n\n**Pros**: Validates design, keeps safety net\n**Cons**: Technical debt (two systems running)\n\n---\n\n## Recommended Approach\n\n**I RECOMMEND OPTION B (Infrastructure Only)** because:\n\n1. **Your game works now** - Baron spawning fix solved immediate problem\n2. **Test results show OTHER issues** - Player agency violation, combat mechanics need fixing\n3. **Major refactor risky** - 3+ days of work, potential production issues\n4. **Foundation useful** - beat_progression table can be used incrementally\n\n**Next Steps After Option B:**\n1. Fix P0 player agency issue (GM narrating actions before they happen)\n2. Fix P1 combat mechanics generation (failsafe always triggering)\n3. Monitor game quality with existing system\n4. Revisit Option 2 when time permits full implementation\n\n---\n\n## If You Choose Full Implementation\n\n**Pre-flight Checklist:**\n- [ ] Back up production database\n- [ ] Set maintenance window (2-3 hours)\n- [ ] Notify users (if any active games)\n- [ ] Prepare rollback plan\n- [ ] Test migrations on copy of production data\n- [ ] Review all 30+ files that need changes\n\n**Files That Need Changes (30+):**\n- Domain: BeatProgression, SimplePlotBeat, GameSession\n- Repositories: 3 new, 4 updated\n- Services: 8 updated (GameServiceImpl, BeatProgressionService, etc.)\n- AI: TwoTierNarrativeService, MechanicsParser\n- App: 5 orchestrators updated\n- Tests: 15+ test files updated\n- Migrations: 2 new migrations\n\n---\n\n## Test Failures to Fix FIRST (from /test quick)\n\nBefore doing Option 2, consider fixing these production issues:\n\n**P0 - Player Agency Violation**\n```\n\"GM narrates Brenna's charge BEFORE the player declares that action\"\n```\n**Fix**: GameServiceImpl transaction boundaries + MemoryService context handling\n\n**P1 - Combat Mechanics Not Generated**\n```\n\"COMBAT SKIPPED: Combat detected but NO HP/NPC mechanics!\"\n```\n**Fix**: TwoTierNarrativeService Tier 1 prompt tuning\n\n**P2 - Duplicate Narrative**\n```\n\"The exact same narrative text appears twice\"\n```\n**Fix**: DeliveryOrchestrator idempotency check\n\n---\n\n## Summary\n\n**Current State:**\n- ‚úÖ NPCs spawn correctly (Baron fix works!)\n- ‚úÖ Beat progression infrastructure created\n- ‚ö†Ô∏è Scene-based system still in use\n- ‚ö†Ô∏è Quality issues detected (unrelated to NPC spawning)\n\n**Decision Needed:**\n- **Option A**: Full Option 2 implementation (2-3 days, risky)\n- **Option B**: Infrastructure only (1 hour, safe) ‚Üê **RECOMMENDED**\n- **Option C**: Hybrid dual-mode (4-6 hours, moderate risk)\n\n**My Recommendation**: Do Option B now, fix test failures, revisit Option 2 later.\n\n---\n\n**What do you want to do?**\n1. Deploy V091 migration only (Option B - safe, quick)\n2. Proceed with full Option 2 implementation (Option A - long, risky)\n3. Implement hybrid dual-mode (Option C - moderate)\n4. Fix test failures first, Option 2 later\n\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/OPTION-2-IMPLEMENTATION-PLAN.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "a28e50d3f88d366c",
      "size_bytes": 7390,
      "created_at": "2026-01-02T20:42:12.433520"
    },
    {
      "doc_id": "local_party-lore_NARRATIVE-ISSUES-ANALYSIS-20251207",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/NARRATIVE-ISSUES-ANALYSIS-20251207.md",
      "content": "# Narrative Quality Issues Analysis - December 7, 2025\n\n**Test Run**: `/test quick` at 2025-12-07 14:32:59\n**Test Report**: `.test-reports/test-report-quick-20251207-143259.md`\n**Status**: ‚úì SUCCESS (5/5 scenarios passed)\n**Issues Detected**: 5 total (3 HIGH, 2 MEDIUM, 5 LOW)\n\n## Executive Summary\n\nThe recent test run identified **critical narrative contradictions** in simultaneous action resolution. The LLM is generating physically impossible sequences where characters are simultaneously in conflicting states (wounded AND dodging, stationary AND moving).\n\n### Root Cause\n\nThe Tier 2 narrative prompt instructs the LLM to show \"SIMULTANEOUS ACTIONS: All N players acted AT THE SAME TIME\" and to show \"their actions COLLIDING, SYNCING, or COMBINING\". However, when actions are contradictory (Player A attacks Player B, Player B dodges), the LLM attempts to honor BOTH outcomes simultaneously, creating impossible physics.\n\n## Critical Issues (Require Immediate Fix)\n\n### Issue #1: Simultaneous Wounding and Dodging (HIGH)\n\n**Scenario**: Basic Combat - 2 Players vs Enemy\n**Transcript**: `transcript-basic-combat-2-players-vs-enemy-20251207-143157.md`\n**Location**: Turn 3 narrative response\n\n**Actions Declared**:\n- Kaelin Darkhaven: \"I attack Vorcyr with my sword.\"\n- Vorcyr Thrain: \"I dash to the side.\"\n\n**Generated Narrative** (physically impossible):\n```\nKaelin Darkhaven's sword slices through the air, aiming for Vorcyr Thrain's exposed flank.\nThe blade bites deep, its edge slicing through Vorcyr's armor and into his flesh. Vorcyr's\neyes widen in shock as he staggers backward, his massive frame crashing into a snowbank.\n\nSimultaneously, Vorcyr Thrain darts to the side, his movement a blur of speed and agility.\nHe slides past Krell's outstretched battle-axe, using the momentum to carry himself clear\nof the deadly blow. As he moves, his left arm comes up, intercepting Kaelin's sword in a\ndesperate bid to block the attack.\n```\n\n**The Contradiction**:\n1. First paragraph: Vorcyr is HIT, wounded, staggering backward into snowbank\n2. Second paragraph: Vorcyr DODGES successfully with \"blur of speed and agility\"\n3. Same paragraph: Vorcyr's arm intercepts/blocks Kaelin's sword\n\n**Physics Violation**: Character cannot simultaneously be:\n- Wounded and staggering backward (failed defense)\n- Successfully dodging with agility (successful defense)\n- Blocking the attack with their arm (different defense)\n\n**Quality Analysis Detected**:\n```\n- [MAJOR] CONTRADICTION: Vorcyr is simultaneously wounded and dodging in the same moment,\n  which is physically impossible\n- [MINOR] ILLOGICAL_NPC_BEHAVIOR: Vorcyr's ability to dodge Kaelin's attack and then dash\n  to the side feels unexplained and unrealistic.\n```\n\n---\n\n### Issue #2: Narrative Contradiction in Solo Exploration (MEDIUM)\n\n**Scenario**: Solo Exploration - Discovery and Sharing\n**Transcript**: `transcript-solo-exploration-discovery-and-sharing-20251207-143220.md`\n\n**Quality Analysis Detected**:\n```\n- [MEDIUM] CONTRADICTION: Narrative Contradiction Detected\n```\n\n**Note**: Specific contradiction not detailed in summary, requires deeper transcript analysis.\n\n---\n\n### Issue #3: Multiple Contradictions in Epic 9 (HIGH + MEDIUM)\n\n**Scenario**: Epic 9 - Structured Mechanics (HP/Location/Progress)\n**Transcript**: `transcript-epic-9-structured-mechanics-hp-location-progress--20251207-143239.md`\n\n**Quality Analysis Detected**:\n```\n- [HIGH] CONTRADICTION: Narrative Contradiction Detected\n- [MEDIUM] CONTRADICTION: Narrative Contradiction Detected\n```\n\n**Note**: Specific contradictions not detailed in summary, requires deeper transcript analysis.\n\n---\n\n## Medium Issues\n\n### Issue #4: Player Simultaneous Actions\n\n**Scenario**: NPC Interaction - Information Gathering\n**Issue**: Vorcyr's simultaneous actions\n\n**Description**:\n```\nVorcyr Thrain orders a whiskey from the barkeep while simultaneously turning to the\nbarkeep to order another whiskey.\n```\n\n**Analysis**: This is less severe - it's a temporal issue but not physically impossible. However, it indicates the narrative generator doesn't properly track what has already happened vs what is happening now.\n\n---\n\n## Minor Issues (Low Priority)\n\n### Issue #5: Pacing Falters in Final Turn\n\n**Scenario**: Group Combat - 3 Players Coordination\n**Severity**: LOW\n\n**Description**:\n```\nThe GM's response in the final turn feels a bit rushed and doesn't match the tension\nand uncertainty of the earlier turns.\n```\n\n**Analysis**: Quality issue, not a logical contradiction.\n\n---\n\n### Issue #6: Player Action Ignored\n\n**Scenario**: Epic 9 - Structured Mechanics\n**Severity**: LOW\n\n**Description**:\n```\nThe GM's response to Vorcyr Thrain's action feels disconnected from the rest of the\nscene and doesn't provide much detail or engagement.\n```\n\n**Analysis**: Engagement issue, not a logical contradiction.\n\n---\n\n### Issue #7: Slow Pacing\n\n**Scenario**: Solo Exploration\n**Severity**: LOW\n\n**Analysis**: Pacing issue, not a logical contradiction.\n\n---\n\n### Issue #8: Rushed Combat Sequence\n\n**Scenario**: Basic Combat\n**Severity**: LOW\n\n**Description**:\n```\nThe combat sequence between Kaelin, Vorcyr, and Krell feels rushed and disjointed,\nwith multiple actions happening in quick succession.\n```\n\n**Analysis**: Pacing/quality issue, not a logical contradiction.\n\n---\n\n## Root Cause Analysis\n\n### Tier 2 Prompt Instructions (TwoTierNarrativeService.java)\n\nThe prompt currently instructs:\n\n```\n‚ö° SIMULTANEOUS ACTIONS: All N players acted AT THE SAME TIME.\n  - Do NOT imply one player led and others followed\n  - Show their actions COLLIDING, SYNCING, or COMBINING\n  - Each player's contribution must be distinctly visible\n```\n\n**The Problem**: When actions are OPPOSED (attack vs dodge), the LLM tries to honor BOTH:\n- Player A's attack \"succeeds\" (sword bites deep, wounds opponent)\n- Player B's dodge \"succeeds\" (darts aside with speed and agility)\n\nThis creates impossible physics where both outcomes occur simultaneously.\n\n### What Should Happen Instead\n\nWhen actions are OPPOSED:\n1. **ONE action should succeed**, the other should fail OR be partially successful\n2. **Mechanics tier** should determine which action wins (dice roll, stats, etc.)\n3. **Narrative tier** should describe the outcome based on mechanics\n\n**Example Fix**:\n```\nKaelin Darkhaven's sword slices through the air toward Vorcyr Thrain's exposed flank.\nVorcyr attempts to dash to the side, but his movement comes a fraction too late. The\nblade catches his armor, scoring a deep gash. Vorcyr staggers, his dodge incomplete,\nblood seeping from the wound.\n```\n\nOR (if dodge wins):\n```\nKaelin Darkhaven's sword slices through the air toward Vorcyr Thrain's exposed flank.\nVorcyr darts to the side in a blur of speed, his Shadow training saving him. Kaelin's\nblade whistles through empty air where Vorcyr stood a heartbeat before.\n```\n\n**NOT BOTH outcomes occurring simultaneously.**\n\n---\n\n## Proposed Fixes\n\n### Fix #1: Enhance Mechanics Tier to Resolve Opposed Actions\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n\n**Current State**: Mechanics tier outputs `<damage>`, `<hp_changes>`, `<location_change>` but doesn't explicitly output \"who succeeded vs who failed\" for opposed actions.\n\n**Proposed Enhancement**: Add `<opposed_action_resolution>` to mechanics output:\n\n```xml\n<opposed_action_resolution>\n  <action player=\"Kaelin Darkhaven\" intent=\"attack Vorcyr\">SUCCESS</action>\n  <action player=\"Vorcyr Thrain\" intent=\"dodge\">PARTIAL_FAILURE</action>\n  <outcome>Kaelin's attack hits despite Vorcyr's attempted dodge</outcome>\n</opposed_action_resolution>\n```\n\nThen narrative tier MUST respect this resolution and NOT generate contradictory outcomes.\n\n---\n\n### Fix #2: Update Tier 2 Prompt Instructions\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n\n**Current Problematic Instruction**:\n```\n‚ö° SIMULTANEOUS ACTIONS: All N players acted AT THE SAME TIME.\n  - Do NOT imply one player led and others followed\n  - Show their actions COLLIDING, SYNCING, or COMBINING\n  - Each player's contribution must be distinctly visible\n```\n\n**Proposed Fix**:\n```\n‚ö° SIMULTANEOUS ACTIONS: All N players acted AT THE SAME TIME.\n  - Show their actions COLLIDING, SYNCING, or COMBINING\n  - CRITICAL: When actions are OPPOSED (attack vs dodge, block vs strike):\n    * RESPECT the mechanics outcome - ONE action wins, the other fails or partially fails\n    * Do NOT describe both actions succeeding (e.g., \"sword bites deep\" + \"dodges successfully\")\n    * IMPOSSIBLE: Character cannot be wounded AND successfully dodging at the same time\n    * IMPOSSIBLE: Attack cannot hit AND miss simultaneously\n  - For COMPLEMENTARY actions (two players attacking same enemy):\n    * Show both actions contributing to the outcome\n  - Each player's ATTEMPT must be visible, but outcomes follow physics and mechanics\n```\n\n---\n\n### Fix #3: Add Contradiction Detection to Mechanics Tier\n\n**New Validation Logic** in mechanics prompt:\n\n```\nüö® OPPOSED ACTION DETECTION:\nBefore outputting mechanics, check if actions are OPPOSED:\n- Attack vs Dodge = OPPOSED (one wins, one loses)\n- Attack vs Block = OPPOSED (one wins, one loses)\n- Two players attacking each other = OPPOSED (both can partially succeed but not fully)\n- Move to location A vs Move to location B = OPPOSED (if mutually exclusive)\n\nIf actions are OPPOSED, output WHICH action wins based on:\n- Character stats (HP, abilities, class strengths)\n- Tactical advantage (position, surprise, etc.)\n- Randomness (simulate dice roll in your reasoning)\n\nThen output <opposed_action_resolution> to guide narrative tier.\n```\n\n---\n\n### Fix #4: Post-Generation Validation\n\n**New Service**: `NarrativeContradictionValidator.java`\n\nAfter narrative is generated, run validation:\n1. Parse for contradictory statements about same character in same turn\n2. Detect impossible physics (wounded + dodging, stationary + moving)\n3. If contradiction detected, REJECT narrative and regenerate with stronger constraints\n\n**Example Detection Patterns**:\n- \"blade bites deep\" + \"darts to the side\" = CONTRADICTION (can't be hit AND dodge)\n- \"staggers backward\" + \"moves with speed and agility\" = CONTRADICTION (contradictory states)\n- Character at location A + Character at location B (same timestamp) = CONTRADICTION\n\n---\n\n## Implementation Priority\n\n1. **P0 - CRITICAL**: Fix #2 (Update Tier 2 prompt) - Quick fix, immediate impact\n2. **P1 - HIGH**: Fix #1 (Mechanics tier opposed action resolution) - More complex but solves root cause\n3. **P2 - MEDIUM**: Fix #3 (Mechanics tier contradiction detection) - Preventative\n4. **P3 - LOW**: Fix #4 (Post-generation validation) - Safety net, but adds latency\n\n---\n\n## Testing Strategy\n\nAfter implementing fixes:\n\n1. **Run `/test quick`** - Verify 5 basic scenarios pass without contradictions\n2. **Run `/test core`** - Deeper testing with more complex scenarios\n3. **Specifically test OPPOSED actions**:\n   - Player A attacks Player B\n   - Player B dodges\n   - Verify narrative shows ONE outcome (hit OR dodge), not both\n\n---\n\n## Additional Observations\n\n### No NPC Invention Issues\n\n‚úÖ **GOOD NEWS**: The realm JSON refactoring (removing hardcoded aiContextPrompt, narrativeExamples, startingScenario) has successfully eliminated NPC invention issues.\n\n- All 5 test scenarios passed\n- No phantom NPCs detected\n- Political Thriller fixes (Intelligence Chief, Military Liaison class descriptions) working as intended\n- NPCs generated via `ArcGenerationService` or scenario setup are properly registered and tracked\n\n### Test Coverage Note\n\nThe `/test quick` run only tested **Iron Company (fantasy)** realm. The Political Thriller realm fixes have NOT been tested yet. Consider running focused tests on Political Thriller to verify:\n- No \"Intelligence Chief Rachel Lee\" or similar phantom NPCs\n- Class descriptions no longer teach LLM to invent briefing NPCs\n- \"Players ARE the authority\" rule is respected\n\n---\n\n## Conclusion\n\n**Immediate Action Required**: The simultaneous action contradiction issue (Issue #1) is a **critical bug** that breaks player immersion and violates basic physics. This should be fixed before deploying to production.\n\n**Recommended Approach**: Start with **Fix #2** (prompt update) as it's quick and will likely resolve 80% of cases. Then implement **Fix #1** (mechanics tier enhancement) for robust long-term solution.\n\n**Success Criteria**:\n- `/test quick` runs with 0 HIGH severity contradictions\n- Opposed actions (attack vs dodge) generate logically consistent narratives\n- Only ONE outcome occurs when actions are opposed, not both simultaneously\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/NARRATIVE-ISSUES-ANALYSIS-20251207.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "llm",
        "md",
        "test"
      ],
      "content_hash": "3ef54003d6df4ea4",
      "size_bytes": 12623,
      "created_at": "2026-01-02T20:42:12.433569"
    },
    {
      "doc_id": "local_party-lore_OLLAMA-PRODUCTION-DEPLOYMENT",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/OLLAMA-PRODUCTION-DEPLOYMENT.md",
      "content": "# Ollama Production Deployment Guide\n\n## Overview\n\nRailway production can access home Ollama server at `http://home.mealing.com:11434`, enabling **80-95% cost savings** while maintaining Claude fallback for reliability.\n\n**Cost Impact:**\n- Current: ~$100/month (Claude only)\n- Target: ~$5-20/month (Ollama + Claude fallback)\n- Annual savings: ~$960-1,140\n\n## Architecture\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ   Railway       ‚îÇ\n‚îÇ  Production     ‚îÇ\n‚îÇ   (Cloud)       ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n         ‚îÇ HTTP\n         v\n    Internet\n         ‚îÇ\n         v\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  home.mealing   ‚îÇ\n‚îÇ   .com:11434    ‚îÇ\n‚îÇ  Port Forward   ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n         ‚îÇ\n         v\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Home Network   ‚îÇ\n‚îÇ  Ollama Server  ‚îÇ\n‚îÇ  RTX 4070 GPU   ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n## Pre-Deployment Checklist\n\n**Verify Network Access:**\n- [ ] Test Ollama from internet: `curl http://home.mealing.com:11434/api/tags`\n- [ ] Port forwarding configured: Router forwards 11434 ‚Üí Ollama server\n- [ ] DNS resolves: `nslookup home.mealing.com`\n- [ ] Firewall allows inbound 11434\n- [ ] Models installed: `ollama list | grep -E \"llama3.2|deepseek-coder-v2\"`\n\n**Verify Ollama Running:**\n- [ ] Service status: `systemctl status ollama` or `ps aux | grep ollama`\n- [ ] GPU accessible: `nvidia-smi`\n- [ ] Sufficient VRAM (12GB on RTX 4070)\n\n## Railway Configuration\n\n**Railway Dashboard ‚Üí Project ‚Üí Variables:**\n\n```bash\n# Ollama Configuration\nOLLAMA_ENABLED=true\nOLLAMA_BASE_URL=http://home.mealing.com:11434\nOLLAMA_MODEL=deepseek-coder-v2:latest\nOLLAMA_MAX_CONCURRENT=1\n\n# Claude Configuration (existing - keep as fallback)\nCLAUDE_API_KEY=sk-ant-...  # Your production key\n\n# Spring Profile\nSPRING_PROFILE=prod\n```\n\n## Deployment Process\n\n### 1. Enable Ollama in Railway\n\n1. Go to Railway Dashboard ‚Üí Your Project\n2. Click \"Variables\" tab\n3. Add the 4 Ollama variables above\n4. Click \"Deploy\" (or push to trigger automatic deploy)\n\n### 2. Test Connection\n\n**Option A: Via Railway Logs**\n```bash\nrailway logs --follow | grep -E \"Ollama|PROVIDER\"\n```\n\nLook for:\n- \"‚úì Ollama request successful\"\n- \"LLM PROVIDER STATISTICS\"\n\n**Option B: Via Provider Stats Endpoint**\n```bash\ncurl https://party-lore-production.up.railway.app/api/admin/provider-stats | jq\n```\n\nExpected response shows Ollama requests > 0.\n\n### 3. Monitor Initial Rollout\n\n**First 24-48 Hours:**\n- Watch provider statistics every hour\n- Check for high fallback rates (>20% = warning)\n- Monitor circuit breaker status\n\n**Health Indicators:**\n- Ollama usage: 80-95% ‚úÖ\n- Fallback rate: <10% ‚úÖ\n- Circuit breaker: closed ‚úÖ\n- Response times: <5 seconds ‚úÖ\n\n## Monitoring\n\n### Real-Time Stats\n\n```bash\n# Poll every 5 minutes\nwatch -n 300 'curl -s https://party-lore-production.up.railway.app/api/admin/provider-stats | jq'\n```\n\n### Scheduled Logs\n\nProvider statistics log automatically every 5 minutes:\n```bash\nrailway logs | grep \"LLM PROVIDER STATISTICS\" -A 10\n```\n\n### Alert Thresholds\n\n- **Fallback rate >20%**: Warning (check home network stability)\n- **Fallback rate >50%**: Critical (consider disabling Ollama temporarily)\n- **Circuit breaker open**: Critical (3+ consecutive failures)\n\n## Disaster Recovery\n\n### Scenario 1: Planned Maintenance\n\n**Before maintenance:**\n```bash\nrailway variables set OLLAMA_ENABLED=false\n```\n\n**After maintenance:**\n```bash\nrailway variables set OLLAMA_ENABLED=true\n```\n\n### Scenario 2: Home Network Down\n\n**Automatic:** Circuit breaker kicks in after 3 failures, system uses Claude.\n\n**Manual (if prolonged):**\n```bash\nrailway variables set OLLAMA_ENABLED=false\n```\n\n### Scenario 3: Performance Issues\n\n**Reduce concurrency:**\n```bash\nrailway variables set OLLAMA_MAX_CONCURRENT=1\n```\n\n**Or disable temporarily:**\n```bash\nrailway variables set OLLAMA_ENABLED=false\n```\n\n## Cost Monitoring\n\n**Monthly Cost Tracking:**\n\nMonitor via provider stats endpoint:\n```json\n{\n  \"ollama_requests\": 18000,\n  \"claude_requests\": 2000,\n  \"estimated_savings_usd\": 180.00\n}\n```\n\n**Expected Monthly Breakdown:**\n- Ollama requests: ~18,000-19,000 (free)\n- Claude requests: ~1,000-2,000 ($10-20)\n- **Total cost: $10-20/month** (vs $100/month Claude-only)\n\n## Network Requirements\n\n**Home Network:**\n- Static IP or DDNS: `home.mealing.com`\n- Port forwarding: External 11434 ‚Üí Ollama server 11434\n- Firewall: Allow inbound TCP 11434\n- Bandwidth: Minimal (~100KB per request)\n\n**Ollama Server:**\n- Always running (systemd service recommended)\n- Models pre-loaded (llama3.2, deepseek-coder-v2)\n- GPU available (RTX 4070)\n\n## Rollback Procedure\n\nIf Ollama causes issues, instant rollback:\n\n```bash\n# Disable Ollama\nrailway variables set OLLAMA_ENABLED=false\n\n# System immediately uses Claude 100%\n```\n\nNo downtime, no code changes needed.\n\n## Success Metrics\n\n**Target Performance:**\n- Ollama usage: 80-95%\n- Fallback rate: <10%\n- Cost savings: $80-95/month\n- Response time: <5 seconds\n- Error rate: <1%\n\n**After 1 Week:**\nReview stats and adjust thresholds if needed.\n\n**After 1 Month:**\nIf stable, document as production-ready and update runbooks.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/OLLAMA-PRODUCTION-DEPLOYMENT.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "http",
        "md"
      ],
      "content_hash": "63bf408f870d3871",
      "size_bytes": 5282,
      "created_at": "2026-01-02T20:42:12.433799"
    },
    {
      "doc_id": "local_party-lore_CORE-TEST-ANALYSIS-20251207",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/CORE-TEST-ANALYSIS-20251207.md",
      "content": "# Core Test Analysis - December 7, 2025\n\n**Test Run**: `/test core` at 2025-12-07 15:07-15:14\n**Duration**: 7m 49s\n**Status**: ‚úó FAILED\n**Test Report**: `.test-reports/test-report-core-20251207-151456.md`\n\n## Executive Summary\n\nThe core test suite **FAILED** due to **scene/location continuity bugs**, NOT due to simultaneous action contradictions. The opposed action fix we implemented is working correctly.\n\n### Key Findings\n\n‚úÖ **Simultaneous Action Fix WORKING**:\n- NO \"wounded AND dodging\" contradictions detected\n- NO opposed action physics violations detected\n- Our prompt fix successfully eliminated this class of bugs\n\n‚ùå **New Issue Discovered: Scene Transition Bugs**:\n- **1 CRITICAL**: Character teleportation (woodsman's hut ‚Üí urban alley)\n- **4 MAJOR**: Scene continuity failures (woodsman's hut ‚Üí Grand Plaza)\n- **4 MEDIUM**: Spatial/character inconsistencies\n- **3 LOW**: Minor pacing and context issues\n\n## Test Results Breakdown\n\n### Overall Status\n- **Total Issues**: 12 GM issues detected\n- **Severity Distribution**:\n  - CRITICAL: 1\n  - MAJOR: 4\n  - MODERATE: 4\n  - MINOR: 3\n- **Primary Failure Cause**: Scene transition continuity (arc system issue)\n\n### Issue Categories\n\n#### 1. Scene/Location Continuity (CRITICAL/MAJOR - 5 issues)\n\n**CRITICAL Issue**:\n```\nCharacters suddenly transported from woodsman's hut to an urban alley without narrative transition\n```\n\n**MAJOR Issues (4 similar)**:\n```\n- Previous narrative was set in a woodsman's hut, but this new narrative suddenly shifts\n  to a crystal-floored assembly with no transition or explanation\n\n- Previous context shows characters in a 'Woodsman's Hut', but new narrative describes\n  an assembly/gathering with guards and a different setting\n\n- Previous context was set in a 'Woodsman's Hut', but new narrative suddenly shifts to\n  a Grand Plaza with an assembly and guards, without any transitional context or explanation\n\n- Characters suddenly transported from the woodsman's hut to a completely different\n  location (Grand Plaza/El'goroth) without narrative transition\n```\n\n**Pattern Analysis**:\n- All issues occur during arc-driven scene transitions\n- Arc system generated \"Woodsman's Hut\" as first scene\n- Next scene should have been in related location OR with transition narrative\n- Instead: Hard cut to completely different location (Grand Plaza, urban alley)\n- LLM generated new scene context without carrying forward location info\n\n#### 2. Character/Spatial Consistency (MODERATE - 4 issues)\n\n```\n- Sylvanar is introduced in this narrative but was not previously mentioned in the\n  established context or recent events\n\n- Aethoniel is simultaneously described as holding Sylvanar's arm and turning towards\n  Faerwynn, which is spatially inconsistent with the previous context of being in a\n  woodsman's hut\n\n- Eldar Moonwhisper appears suddenly in the narrative without prior context or introduction,\n  contradicting the established scene of only Aethoniel, Faerwynn, and Eryndor in the\n  woodsman's hut\n\n- Characters are simultaneously described as being in different positions within the\n  woodsman's hut, creating spatial inconsistency\n```\n\n**Pattern Analysis**:\n- NPCs appearing without introduction (Sylvanar, Eldar Moonwhisper)\n- Spatial inconsistencies (character positions)\n- Context loss between scene transitions\n\n#### 3. Minor Issues (3 issues)\n\n```\n- [MINOR] CONTRADICTION: The GM describes Aethoniel Elyri's action of drawing her blades\n  before the player declares it.\n\n- [MINOR] PACING_ISSUE: The scene where the hooded figure is chased through the streets\n  of El'goroth feels rushed and disjointed.\n\n- [LOW] Lack of clear objectives: The players' goals are not always explicitly stated,\n  making it difficult for them to understand what they are trying to achieve.\n```\n\n**Pattern Analysis**:\n- Pre-narration (describing player actions before declared)\n- Pacing issues in action scenes\n- Unclear objectives\n\n## Root Cause Analysis\n\n### Arc Transition System Issues\n\nThe core failure is in **arc-driven scene transitions**, specifically:\n\n1. **First Scene Generation** (Arc Beat ‚Üí Scene):\n   - Arc system generates first scene from beat\n   - Sets location to \"Woodsman's Hut\"\n   - Spawns NPCs correctly (Eryndor Thorne)\n\n2. **Scene Progression**:\n   - Players complete objectives in Woodsman's Hut\n   - Arc system triggers next scene\n\n3. **Second Scene Generation** (THE BUG):\n   - Arc system generates new scene for next beat\n   - **BUG**: New scene doesn't reference previous location\n   - **BUG**: No transition narrative generated\n   - **BUG**: Hard cut to \"Grand Plaza\" or \"urban alley\"\n   - **BUG**: New NPCs appear without context\n\n### Why This Happens\n\n**Hypothesis**: The arc-driven scene generation doesn't maintain location continuity:\n- Each scene is generated independently from beat descriptions\n- Beat descriptions don't include \"current location\" context\n- Scene generator doesn't look at previous scene's location\n- No \"travel\" or \"transition\" narrative generated between scenes\n\n**Relevant Code**:\n- `ArcGenerationService.java` - Generates arcs with beats\n- `StoryDrivenSceneGenerator.java` - Creates scenes from beats\n- `SceneTransitionOrchestrator.java` - Handles scene transitions\n\n## Comparison: Before vs After Fix\n\n### Quick Test (/test quick - 5 scenarios)\n**BEFORE Fix** (2025-12-07 14:32:59):\n- 3 HIGH simultaneous action contradictions\n- 2 MEDIUM contradictions\n- 5 total issues\n\n**AFTER Fix** (2025-12-07 15:02:33):\n- 1 HIGH contradiction (location, not opposed actions)\n- 3 MEDIUM contradictions\n- 4 total issues\n\n**Improvement**: 67% reduction in HIGH severity contradictions ‚úÖ\n\n### Core Test (/test core - 10+ scenarios)\n**AFTER Fix** (2025-12-07 15:07-15:14):\n- 0 simultaneous action contradictions ‚úÖ\n- 1 CRITICAL location teleportation\n- 4 MAJOR scene continuity failures\n- 12 total issues\n\n**Key Insight**: Our fix works! The remaining issues are **different bug class** (scene transitions)\n\n## What We Fixed\n\n‚úÖ **Simultaneous Action Contradictions**:\n- Attack vs Dodge: Fixed (no longer shows both succeeding)\n- Push vs Resist: Fixed (physics constraints enforced)\n- Any opposed actions: Fixed (explicit failure language required)\n\n**Evidence from Core Test**:\n- Zero instances of \"wounded AND dodging\" pattern\n- Zero instances of contradictory simultaneous action outcomes\n- Prompt constraints successfully enforced\n\n## What Still Needs Fixing\n\n### P0 - CRITICAL: Scene Transition Continuity\n\n**Issue**: Characters teleport between scenes without transition narrative\n\n**Files to Investigate**:\n1. `party-lore-ai/src/main/java/com/partylore/ai/story/ArcGenerationService.java`\n   - How are beats generated?\n   - Do beats include location context?\n\n2. `party-lore-game/src/main/java/com/partylore/game/scene/StoryDrivenSceneGenerator.java`\n   - How are scenes created from beats?\n   - Is previous scene location passed to scene generator?\n\n3. `party-lore-app/src/main/java/com/partylore/app/scene/SceneTransitionOrchestrator.java`\n   - Does transition logic check for location changes?\n   - Should transition narrative be generated?\n\n**Proposed Fix**:\n1. Scene generator should receive `previousSceneLocation` parameter\n2. If new scene location != previous location, generate transition narrative:\n   - \"You leave the woodsman's hut and travel to...\"\n   - OR set new scene location to same as previous until player triggers travel\n3. Arc beats should specify if they require location change\n\n### P1 - HIGH: NPC Context Loss\n\n**Issue**: NPCs appear suddenly without introduction (Sylvanar, Eldar Moonwhisper)\n\n**Possible Causes**:\n- Arc system generates NPCs but doesn't register them in scene properly\n- Narrative references NPCs before they're introduced\n- NPC spawning happens after narrative generation\n\n**Files to Investigate**:\n- `party-lore-game/src/main/java/com/partylore/game/story/BeatNPCSpawner.java`\n- Timing of NPC registration vs narrative generation\n\n### P2 - MEDIUM: Pre-Narration\n\n**Issue**: GM describes player actions before declared\n\n**Example**: \"Aethoniel draws her blades\" before player says they draw blades\n\n**Possible Fix**: Enhance pre-narration detection/prevention prompts\n\n## Recommendations\n\n### Immediate Actions\n\n1. **DO NOT rollback the simultaneous action fix** - It's working correctly!\n\n2. **Investigate scene transition code** - Priority P0 issue needs separate fix\n\n3. **Run focused tests** on arc transitions:\n   ```bash\n   /test arc  # Test arc generation and continuity\n   ```\n\n4. **Document scene transition bug** - Create FR/task for fixing location continuity\n\n### Deployment Decision\n\n**Should we deploy the simultaneous action fix?**\n\n**YES** - The fix is production-ready:\n- ‚úÖ Solves the critical \"wounded AND dodging\" bug\n- ‚úÖ No new bugs introduced by the fix\n- ‚úÖ Prompt-only change (low risk)\n- ‚úÖ Works across all realms\n\n**The scene transition bug exists independently** of our fix:\n- Scene continuity issues are pre-existing (would need to check older test runs)\n- Likely revealed by core test's arc-driven scenarios (quick test doesn't use arcs)\n- Requires separate investigation and fix\n\n### Next Steps\n\n1. **Commit and deploy simultaneous action fix** ‚úÖ Ready\n2. **Create new FR** for scene transition continuity\n3. **Investigate arc generation** system for location tracking\n4. **Add transition narrative** generation between scenes\n5. **Re-run core tests** after scene transition fix\n\n## Files Modified (This Session)\n\n**Simultaneous Action Fix**:\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java` (lines 1748-1767)\n\n**Test Scripts Created**:\n- `scripts/test-simultaneous-action-prompts.sh`\n- `scripts/analyze-simultaneous-action-results.sh`\n\n**Documentation Created**:\n- `NARRATIVE-ISSUES-ANALYSIS-20251207.md`\n- `SIMULTANEOUS-ACTION-FIX-SUMMARY.md`\n- `CORE-TEST-ANALYSIS-20251207.md` (this document)\n\n## Conclusion\n\n**Success**: We successfully fixed the simultaneous action contradiction bug. Zero instances detected in comprehensive core testing.\n\n**Discovery**: Core testing revealed a separate, pre-existing bug in arc-driven scene transitions. This is not related to our fix and requires independent investigation.\n\n**Status**: Simultaneous action fix is **production-ready**. Scene transition bug requires separate PR.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/CORE-TEST-ANALYSIS-20251207.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "94b6619cd166b242",
      "size_bytes": 10290,
      "created_at": "2026-01-02T20:42:12.433837"
    },
    {
      "doc_id": "local_party-lore_SESSION-2025-01-15-PROMPT-FIXES",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/SESSION-2025-01-15-PROMPT-FIXES.md",
      "content": "# Session Summary: Critical Prompt Fixes and Test Analysis\n**Date**: January 15, 2025\n**Session Type**: Bug Fixing and Quality Improvement\n\n## Overview\n\nThis session focused on analyzing comprehensive test failures, identifying root causes in prompt engineering, and implementing targeted fixes to improve AI narrative quality.\n\n## Work Completed\n\n### 1. Git Pull and Migration Conflict Resolution\n\n**Issue**: Production V092 migration conflicted with local V092 migration\n**Resolution**:\n- Renamed local `V092__add_memory_state_tracking.sql` to `V093__add_memory_state_tracking.sql`\n- Updated migration header comment to reflect V093\n- Cleaned up temporary build artifacts (`javac.20251115_060031.args`)\n- Updated `.gitignore` to prevent future artifact pollution\n\n**Commits**:\n- Staged all changes including migration rename\n\n### 2. Comprehensive Test Analysis\n\n**Test Execution**: Core test suite (20 turns per scenario) completed\n**Results**: ALL 5 scenarios FAILED with scores ranging from 1.8/10 to 4.4/10\n**Total Issues**: 102 issues detected across all scenarios\n\n**Analysis Document Created**: `TEST-ANALYSIS-CORE-20251115.md` (633 lines)\n\n**Root Causes Identified**:\n1. **Player Agency Violations** - AI narrates what players DO instead of CONSEQUENCES\n2. **Multi-Player Coordination Failures** - Worst in 3-player scenarios (28 issues)\n3. **Missing Game Mechanics** - No combat system, skill checks, status effects\n4. **Location Tracking Failures** - No spatial state between turns\n5. **NPC Behavior Inconsistencies** - No NPC state tracking\n6. **Duplicate/Identical Responses** - Cache collision issues\n\n### 3. Prompt Engineering Fixes (Round 1)\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/AdvancedPromptEngineering.java`\n\n**Changes**:\n- Strengthened player agency rules with explicit grammar prohibition\n- Added forbidden construction pattern: `[CHARACTER NAME] + ACTION VERB = INSTANT FAIL`\n- Implemented self-check question: \"Am I narrating what the character DOES, or the RESULT?\"\n- Provided concrete examples of right vs wrong patterns\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n\n**Changes**:\n- Changed SIMULTANEOUS mode to SEQUENTIAL WEAVING pattern\n- AI now processes each player action individually, then weaves results together\n- Added mandatory name-checking validation for multi-player scenarios\n- Strengthened Tier 2 player agency rules with same grammar prohibition\n\n**Validation**: Quick test run showed improvements in scenarios 1, 2, and 4\n\n**Commit**: \"Fix TASK-163: Critical AI prompt improvements + memory state tracking + test analysis\"\n\n### 4. Character Identity Confusion Fix (Round 2)\n\n**Issue Found**: Solo action for Aldric was narrated from Brenna's perspective\n**Root Cause**: Contradictory prompt instructions (second person directive with third person examples)\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n\n**Changes**:\n- Enforced SECOND PERSON ONLY for solo actions\n- Removed all third-person examples\n- Made it explicit this is a private SMS to one player\n- Updated validation checklist to verify second person usage\n- Added clear wrong vs right examples\n\n**Validation**: Compiled successfully\n\n**Commit**: \"Fix CRITICAL: Character identity confusion in solo action narratives\"\n\n### 5. Duplicate GM Response Fix (Round 3)\n\n**Issue Found**: Identical narratives returned for different players in same batch turn\n**Root Cause**: Cache collision - requestId could be reused for multiple players\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n\n**Changes**:\n- Enhanced cache-busting with `System.currentTimeMillis()` in metadata\n- Applied to both Tier 1 (mechanics) and Tier 2 (narrative) requests\n- Ensures every request is unique even with same requestId\n- Added player IDs to metadata for additional uniqueness\n\n**Validation**: Compiled successfully\n\n**Commit**: \"Fix HIGH: Enhanced cache-busting to prevent duplicate GM responses\"\n\n## Test Results Comparison\n\n### Before Fixes (Core Test - 20 turns)\n- Scenario 1 (Basic Combat): 3.4/10 (22 issues)\n- Scenario 2 (Group Combat): 4.2/10 (28 issues)\n- Scenario 3 (Solo Exploration): 4.4/10 (15 issues)\n- Scenario 4 (NPC Interaction): 1.8/10 (16 issues)\n- Scenario 5 (Epic 9 Mechanics): 3.2/10 (21 issues)\n\n### After Round 1 Fixes (Quick Test - 3 turns)\n- Scenario 1: 4.4/10 (6 issues) - ‚úÖ UP from 3.4/10\n- Scenario 2: 4.6/10 (5 issues) - ‚úÖ UP from 4.2/10\n- Scenario 3: 2.8/10 (7 issues) - ‚ùå DOWN from 4.4/10\n- Scenario 4: 2.8/10 (8 issues) - ‚úÖ UP from 1.8/10\n- Scenario 5: 2.8/10 (7 issues) - ‚ùå DOWN from 3.2/10\n\n**Note**: Scenarios 3 and 5 showed regressions, but these were quick tests (3 turns vs 20). The character identity and cache fixes (rounds 2-3) should improve these further.\n\n## Remaining Issues (From TEST-ANALYSIS-CORE-20251115.md)\n\n### P0 Missing Mechanics (Require Implementation)\n1. **Combat System** - Initiative, attack rolls, damage calculation, enemy HP tracking\n2. **Readiness/Held Actions** - \"Ready to fire when X\" triggers\n3. **Status Effects** - Frozen, stunned, poisoned with mechanical effects\n\n### P1 Missing Mechanics\n4. **Investigation/Skill Check System** - Explicit success/failure rolls\n5. **Equipment System** - Consistent rulings on what items can do\n6. **NPC Morale/Behavior System** - When NPCs flee, surrender, or switch targets\n\n### P2 Enhancements\n7. **Location/Movement System** - Adjacency rules, distance mechanics\n8. **Resource Tracking** - Ammo, charges, consumables\n\n## Git Status\n\n**Branch**: main\n**Clean**: Yes\n**All Changes Committed and Pushed**: Yes\n\n**Recent Commits**:\n1. `Fix HIGH: Enhanced cache-busting to prevent duplicate GM responses`\n2. `Fix CRITICAL: Character identity confusion in solo action narratives`\n3. `Fix TASK-163: Critical AI prompt improvements + memory state tracking + test analysis`\n\n## Files Created/Modified\n\n### Created\n- `TEST-ANALYSIS-CORE-20251115.md` - Comprehensive test analysis (633 lines)\n\n### Modified\n- `party-lore-domain/src/main/resources/db/migration/V093__add_memory_state_tracking.sql` - Renamed from V092\n- `.gitignore` - Added javac artifact exclusions\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/AdvancedPromptEngineering.java` - Player agency fixes\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java` - Sequential weaving, second person enforcement, cache-busting\n\n### Test Reports\n- `.test-reports/test-report-core-20251115-072324.md` - Baseline core test (221KB)\n- `.test-reports/test-report-quick-20251115-075038.md` - Post-fix quick test (49KB)\n\n## Next Steps\n\nSee `REQUIREMENTS-ASSESSMENT.md` for evaluation of existing requirements vs remaining issues.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/SESSION-2025-01-15-PROMPT-FIXES.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "ee5a706450321680",
      "size_bytes": 6787,
      "created_at": "2026-01-02T20:42:12.433878"
    },
    {
      "doc_id": "local_party-lore_ARC-GENERATION-TIMEOUT-FIX",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/ARC-GENERATION-TIMEOUT-FIX.md",
      "content": "# Arc Generation Timeout Fix\n\n**Date**: 2025-11-09\n**Issue**: Claude API timeout during arc generation causing game to be stuck in broken state\n\n## Problem Summary\n\n### What Happened\n1. Started new game \"The Dragon's Hoard\" (ID: `193eebf4-d0c2-4dc4-82d7-6f9baddf4f04`)\n2. `GameStartedEvent` triggered arc generation\n3. **Claude API timed out after 30 seconds** (see logs.1762738676432.log:289-291)\n4. Arc generation failed with `ArcGenerationException`\n5. Scene creation never happened\n6. Game left in broken state: **ACTIVE status but NO scenes**\n\n### Root Cause\n**Claude API timeout (30s) is too short for complex arc generation prompts**\n\nLocation: `party-lore-app/src/main/resources/application.yml:101`\n```yaml\ntimeout: ${CLAUDE_TIMEOUT:30s}  # TOO SHORT!\n```\n\n### Why No Retries?\nThe `ClaudeClient.java` has retry logic configured (max 3 retries), but it's NOT being triggered because:\n- `ArcGenerationService.generateFirstArc()` catches the exception at line 100-103\n- Throws `ArcGenerationException` immediately\n- Retry logic in `ClaudeClient.sendRequest()` never gets a chance to retry\n\nSee: `party-lore-ai/src/main/java/com/partylore/ai/story/ArcGenerationService.java:92-103`\n\n## Fixes Applied\n\n### Fix 1: Increase Claude API Timeout ‚úÖ APPLIED\n\n**Changed**: `application.yml:101`\n```yaml\n# Before:\ntimeout: ${CLAUDE_TIMEOUT:30s}\n\n# After:\ntimeout: ${CLAUDE_TIMEOUT:90s}  # Increased from 30s for arc generation\n```\n\n**Rationale**: Arc generation prompts are complex and require ~45-60 seconds. 90s provides comfortable buffer.\n\n### Fix 2: Reset Broken Game ‚úÖ APPLIED\n\n**SQL Script**: `fix-broken-game.sql`\n\n**Executed**:\n```bash\ncat fix-broken-game.sql | railway connect Postgres-FuND\n```\n\n**Result**: ‚úÖ Game `193eebf4-d0c2-4dc4-82d7-6f9baddf4f04` reset from ACTIVE ‚Üí RECRUITING\n\n**Next Step**: Send `!begin` SMS to restart the game properly.\n\n### Fix 3: Add Retry Logic to Arc Generation ‚úÖ APPLIED\n\n**Changed**: `ArcGenerationService.java` (both `generateFirstArc` and `generateNextArc` methods)\n\n**Added**:\n- **3 retry attempts** with exponential backoff (2s, 4s, 8s)\n- **Timeout detection** - only retries on timeout errors\n- **Detailed logging** - logs each attempt and success/failure\n- **Graceful failure** - throws exception with attempt count after all retries fail\n\n**Code Changes**:\n```java\n// Retry configuration\nint maxAttempts = 3;\nlong retryDelayMs = 2000; // Start with 2 seconds\n\nfor (int attempt = 1; attempt <= maxAttempts; attempt++) {\n    try {\n        // Arc generation logic...\n        return persistArc(arcData, session);\n    } catch (Exception e) {\n        // Check if timeout - retry with exponential backoff\n        if (attempt < maxAttempts && isTimeout) {\n            Thread.sleep(retryDelayMs);\n            retryDelayMs *= 2; // 2s ‚Üí 4s ‚Üí 8s\n        }\n    }\n}\n```\n\n**Benefits**:\n- ‚úÖ **Automatic recovery** from transient timeout issues\n- ‚úÖ **No manual intervention** needed for temporary Claude API slowness\n- ‚úÖ **Exponential backoff** prevents hammering the API\n- ‚úÖ **Works for both** first arc and next arc generation\n\n## Testing Plan\n\n### Before Deploying\n1. ‚úÖ Increase timeout to 90s\n2. ‚úÖ Reset broken game in production database\n3. ‚òê Deploy to Railway\n4. ‚òê Start new game and verify arc generation succeeds\n5. ‚òê Monitor logs for timeout errors\n\n### Verification Commands\n\n**Check app logs for timeout**:\n```bash\n# Check latest Railway logs\nrailway logs --tail 100\n\n# Look for these patterns:\n# ‚úÖ GOOD: \"Generated first arc for session...\"\n# ‚ùå BAD: \"Claude API request timed out after 30s\"\n```\n\n**Check game state**:\n```bash\necho \"SELECT id, name, status, current_scene_id FROM game_sessions ORDER BY created_at DESC LIMIT 1;\" | railway connect Postgres-FuND\n```\n\n**Check scenes created**:\n```bash\necho \"SELECT id, game_session_id, objective FROM scenes ORDER BY created_at DESC LIMIT 1;\" | railway connect Postgres-FuND\n```\n\n## Future Improvements (Out of Scope)\n\n### Option 1: Implement Retry Logic in ArcGenerationService\nModify `ArcGenerationService.generateFirstArc()` to retry on timeout instead of throwing immediately.\n\n```java\n// Add @Retryable annotation\n@Retryable(\n    value = {ClaudeApiException.class},\n    maxAttempts = 3,\n    backoff = @Backoff(delay = 2000, multiplier = 2)\n)\npublic StoryArc generateFirstArc(GameSession session) {\n    // existing code...\n}\n```\n\n### Option 2: Fallback Arc Templates\nIf Claude API continues to timeout, use pre-defined arc templates as fallback:\n1. Try Claude API (90s timeout)\n2. If fails 3 times, use template arc from `realm_arcs` table\n3. Log warning but don't block game start\n\n### Option 3: Async Arc Generation\nGenerate arc asynchronously in background:\n1. Start game immediately with placeholder scene\n2. Generate arc in background job\n3. Transition to first real scene when arc ready\n4. Notify players: \"Your adventure begins in 1-2 minutes...\"\n\n## Deployment Checklist\n\n- [x] Increase Claude timeout to 90s\n- [x] Create SQL fix script\n- [x] Run SQL fix script to reset broken game\n- [x] Add retry logic to ArcGenerationService\n- [ ] Commit changes: `git commit -m \"Fix arc generation timeout and add retry logic\"`\n- [ ] Push to main: `git push origin main`\n- [ ] Railway auto-deploys\n- [ ] Test with new game creation (send !begin)\n- [ ] Monitor logs for successful arc generation\n- [ ] Verify retry logic works on next timeout\n\n## Related Files\n\n- `party-lore-app/src/main/resources/application.yml` - Timeout configuration ‚úÖ MODIFIED\n- `party-lore-ai/src/main/java/com/partylore/ai/config/ClaudeConfig.java` - Claude client config\n- `party-lore-ai/src/main/java/com/partylore/ai/story/ArcGenerationService.java` - Arc generation logic ‚úÖ MODIFIED\n- `party-lore-ai/src/main/java/com/partylore/ai/client/ClaudeClient.java` - API client with retry\n- `fix-broken-game.sql` - SQL fix script ‚úÖ CREATED\n- `logs.1762738676432.log` - Error logs showing timeout\n\n## References\n\n**Error Log Location**: `/home/doug/Downloads/logs.1762738676432.log:289-291`\n```\n2025-11-10 01:37:23.911 [parallel-1] ERROR com.partylore.ai.client.ClaudeClient - Claude API request timed out after 30s\n2025-11-10 01:37:23.928 [parallel-1] ERROR com.partylore.ai.client.ClaudeClient - Claude API request failed: Request timed out after 30 seconds\n2025-11-10 01:37:23.929 [SimpleAsyncTaskExecutor-3] ERROR com.partylore.ai.story.ArcGenerationService - Failed to generate first arc for session 193eebf4-d0c2-4dc4-82d7-6f9baddf4f04: Request timed out after 30 seconds\n```\n\n**Database State**:\n```sql\n-- Game exists but has NO scenes\nSELECT COUNT(*) FROM scenes WHERE game_session_id = '193eebf4-d0c2-4dc4-82d7-6f9baddf4f04';\n-- Result: 0 rows\n```\n\n---\n\n**Status**: ‚úÖ Fix Applied - Ready for Deployment\n**Next Step**: Run SQL fix script and deploy to Railway\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/ARC-GENERATION-TIMEOUT-FIX.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "api",
        "md"
      ],
      "content_hash": "9808c86e2e999760",
      "size_bytes": 6772,
      "created_at": "2026-01-02T20:42:12.433982"
    },
    {
      "doc_id": "local_party-lore_Party_Lore_Web_App_Requirements",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/Party_Lore_Web_App_Requirements.md",
      "content": "# Party Lore - Web Application Requirements\n## Authentication & Multi-Campaign Management\n\n**Version:** 1.0  \n**Date:** November 9, 2025  \n**Status:** Requirements Ready for Technical Design  \n**Purpose:** Define requirements for web application that extends SMS-based gameplay\n\n---\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Authentication Requirements](#authentication-requirements)\n3. [User Flows](#user-flows)\n4. [Multi-Campaign Management](#multi-campaign-management)\n5. [Session Management](#session-management)\n6. [SMS-to-Web Migration](#sms-to-web-migration)\n7. [Security Requirements](#security-requirements)\n8. [User Interface Requirements](#user-interface-requirements)\n9. [Notification Requirements](#notification-requirements)\n10. [Cost Optimization Goals](#cost-optimization-goals)\n\n---\n\n## Overview\n\n### Purpose\n\nBuild a web application that:\n- Extends SMS gameplay to a richer web interface\n- Uses passwordless authentication via SMS magic links\n- Manages multiple concurrent campaigns per player\n- Reduces SMS costs by moving engaged players to web actions\n- Maintains SMS as notification channel and entry point\n\n### Key Principles\n\n1. **No passwords ever** - Phone number is identity, SMS magic links for authentication\n2. **SMS first, web second** - All players start via SMS, migrate to web after engagement\n3. **Progressive enhancement** - SMS works standalone, web adds features\n4. **Zero friction** - No account creation, no downloads, no barriers\n5. **Mobile responsive** - Web app must work perfectly on mobile browsers\n\n### Target Flow\n\n```\nNew Player ‚Üí SMS Gameplay (Scenes 1-5) ‚Üí Web Migration ‚Üí Multi-Campaign via Web\n```\n\n---\n\n## Authentication Requirements\n\n### AUTH-001: Phone Number as Primary Identity\n\n**Requirement:** Phone number is the sole identifier for all players\n\n**Details:**\n- Phone numbers stored in E.164 format (+12345678900)\n- One player record per phone number\n- All game data keyed to phone number\n- No usernames, no emails, no passwords\n\n**Rationale:** Maintains consistency with SMS-first architecture\n\n---\n\n### AUTH-002: Magic Link Authentication\n\n**Requirement:** Users authenticate to web app via SMS magic links only\n\n**Details:**\n- User enters phone number on web\n- System sends unique, time-limited URL via SMS\n- User clicks link to auto-login\n- No password creation or storage\n\n**User Experience:**\n1. Visit partylore.com\n2. Enter phone number\n3. Receive SMS: \"Your login link: [URL] (expires in 10 min)\"\n4. Click link\n5. Authenticated for 30 days\n\n**Link Format:**\n- URL: `partylore.com/auth/{token}`\n- Token: Cryptographically secure, unique, single-use\n- Expiration: 10 minutes from creation\n- Auto-consumed on first use\n\n---\n\n### AUTH-003: Automatic SMS-to-Web Migration\n\n**Requirement:** Players automatically receive web access invitation after Scene 5\n\n**Details:**\n- Triggered when player completes Scene 5 via SMS\n- System sends magic link with campaign context\n- Link pre-authenticates and opens to active campaign\n- Original SMS gameplay continues to work\n\n**Migration SMS:**\n```\nüéâ You've unlocked the full Party Lore interface!\n\nContinue your adventure with enhanced features:\n[partylore.com/play/{campaign_token}]\n\nYou'll still get SMS notifications, but can now \nplay from any device!\n```\n\n**Requirements:**\n- Send once per player (not per campaign)\n- Include campaign-specific token in URL\n- Track migration status per player\n- Continue SMS gameplay for non-migrated players\n\n---\n\n### AUTH-004: Direct Web Access for Migrated Players\n\n**Requirement:** Players who have unlocked web can login directly without SMS context\n\n**Details:**\n- Migrated players can visit partylore.com anytime\n- Request magic link by entering phone number\n- Receive generic login link (not campaign-specific)\n- Land on dashboard showing all campaigns\n\n---\n\n## User Flows\n\n### FLOW-001: First-Time SMS Player\n\n```\n1. Receives SMS invite to campaign\n2. Replies YES via SMS\n3. Plays Scenes 1-5 entirely via SMS\n4. System automatically sends web unlock after Scene 5\n5. Player can choose to continue SMS or migrate to web\n6. If migrates: clicks link, sees campaign history, continues on web\n7. If ignores: SMS gameplay continues normally\n```\n\n**Requirements:**\n- No web interaction required for first 5 scenes\n- Migration is optional, not forced\n- Both SMS and web remain functional after migration\n\n---\n\n### FLOW-002: Returning Player Web Login\n\n```\n1. Player visits partylore.com\n2. Sees landing page: \"Welcome back! Enter your phone number to continue\"\n3. Enters phone number: +1-555-123-4567\n4. System sends SMS magic link\n5. Clicks link from SMS\n6. Auto-authenticated, lands on dashboard\n7. Sees all active campaigns\n8. Clicks campaign to view and take actions\n```\n\n**Requirements:**\n- Must work on mobile and desktop browsers\n- Magic link works regardless of which device receives SMS\n- Session persists for 30 days\n- No \"remember this device\" checkbox needed (handled by session duration)\n\n---\n\n### FLOW-003: Joining Additional Campaigns (Post-Migration)\n\n```\n1. Migrated player receives campaign invite via SMS\n2. SMS contains web link (not gameplay option): \n   \"Join Dragon Heist! [partylore.com/join/{invite_token}]\"\n3. Clicks link\n4. Already authenticated (existing session) OR prompted for magic link\n5. Lands directly in new campaign\n6. New campaign appears in dashboard automatically\n```\n\n**Requirements:**\n- Once player is web-migrated, ALL new invites must go to web\n- No option to join new campaigns via SMS alone\n- Invite links must work even if session expired (re-auth flow)\n- Player can still play existing SMS-only campaigns via SMS\n\n---\n\n### FLOW-004: Multi-Campaign Management\n\n```\n1. Player with 3 active campaigns logs into web\n2. Lands on dashboard showing all campaigns:\n   - Dragon Heist (Fantasy, Scene 12, waiting on 2 players)\n   - Neon Shadows (Cyberpunk, Scene 8, YOUR TURN)\n   - Horror House (Horror, Scene 3, game paused)\n3. Clicks \"Neon Shadows\" \n4. Sees full narrative history\n5. Submits action via web form\n6. System processes turn\n7. Receives SMS notification: \"Turn processed in Neon Shadows! View: [link]\"\n8. Can switch between campaigns via tabs/dropdown\n```\n\n**Requirements:**\n- Dashboard must show all campaigns player is in\n- Clear indication of which campaigns need player action\n- Easy switching between campaigns\n- Campaign state preserved when switching\n- SMS notifications still sent for important events\n\n---\n\n## Multi-Campaign Management\n\n### CAMP-001: Campaign Dashboard\n\n**Requirement:** Web app must provide unified view of all player's campaigns\n\n**Dashboard Must Display:**\n- Campaign name\n- Realm type (Fantasy, Cyberpunk, Horror)\n- Current scene number\n- Player count\n- Campaign status (Active, Paused, Completed)\n- Action status (Your turn, Waiting on others, All actions received)\n- Last activity timestamp\n- Unread action count\n\n**Visual Priority:**\n- Campaigns needing player action highlighted\n- Sort order: Action needed ‚Üí Recently active ‚Üí Paused ‚Üí Completed\n\n---\n\n### CAMP-002: Campaign Switching\n\n**Requirement:** Players must easily switch between campaigns without losing context\n\n**Details:**\n- Tab interface OR dropdown selector\n- Visual indicator for campaigns with unread content\n- Switching preserves scroll position in previous campaign\n- URL reflects active campaign: `/game/{campaignId}`\n- Browser back button navigates between campaigns\n\n---\n\n### CAMP-003: Campaign Limits\n\n**Requirement:** Enforce maximum concurrent campaigns based on player tier\n\n**Limits:**\n- Free tier: 2 concurrent campaigns\n- Premium tier: 5 concurrent campaigns  \n- Pro tier: 10 concurrent campaigns\n\n**Behavior When Limit Reached:**\n- Cannot join new campaigns\n- Can complete/leave existing campaigns to free slots\n- Web dashboard shows: \"Campaign limit reached (2/2). Complete or leave a campaign to join new ones.\"\n\n---\n\n### CAMP-004: Cross-Campaign Actions\n\n**Requirement:** Player cannot accidentally take actions in wrong campaign\n\n**Details:**\n- Action submission form clearly shows campaign name\n- Action button disabled if not player's turn\n- Confirmation dialog if switching campaigns with unsent action\n- Cannot submit action to inactive/paused campaigns\n\n---\n\n## Session Management\n\n### SESS-001: Session Duration\n\n**Requirement:** Web sessions last 30 days with automatic extension\n\n**Details:**\n- Initial session: 30 days from first login\n- Activity extension: Any action extends session by 30 days from that action\n- Expiration warning: Show banner 3 days before expiration\n- Re-authentication: Expired sessions require new magic link\n\n---\n\n### SESS-002: Session Security\n\n**Requirement:** Sessions must be secure and device-specific\n\n**Details:**\n- Session tokens stored as httpOnly cookies\n- Tokens unique per device/browser\n- Multiple simultaneous sessions allowed (phone + laptop)\n- Logout from one device doesn't affect others\n- Explicit logout option available\n\n---\n\n### SESS-003: Session Data\n\n**Requirement:** Session must track essential user context\n\n**Session Must Include:**\n- Phone number\n- Player ID\n- Active campaigns list\n- Web migration status\n- Last activity timestamp\n- Device information (for support)\n- Session creation timestamp\n\n---\n\n## SMS-to-Web Migration\n\n### MIG-001: Migration Trigger\n\n**Requirement:** Automatically detect when player is ready for web migration\n\n**Trigger Conditions:**\n- Player completes Scene 5 in any campaign\n- Player has not previously been migrated\n- Campaign status is Active\n\n**One-Time Event:**\n- Migration occurs once per player, not per campaign\n- Status tracked in player record: `web_migrated: boolean`\n- Cannot be reversed (once migrated, always can use web)\n\n---\n\n### MIG-002: Migration Communication\n\n**Requirement:** Clearly communicate web option without forcing migration\n\n**SMS Message Requirements:**\n- Enthusiastic tone (achievement unlocked)\n- Clear benefit statement (play from any device)\n- Direct link to current campaign\n- Reassurance that SMS still works\n- No pressure to migrate immediately\n\n**Message Timing:**\n- Sent immediately after Scene 5 resolution\n- Only sent once, even if player in multiple campaigns\n- Resend option available via command: \"WEBLINK\"\n\n---\n\n### MIG-003: Migration Analytics\n\n**Requirement:** Track migration adoption and usage\n\n**Metrics to Track:**\n- Percentage of players migrated\n- Time from migration offer to first web login\n- Percentage who continue SMS vs adopt web\n- Campaign engagement before/after migration\n- SMS cost reduction per migrated player\n\n---\n\n### MIG-004: Forced Web for New Campaigns\n\n**Requirement:** Once migrated, new campaign invites must go to web only\n\n**Logic:**\n- Check player's `web_migrated` status when sending invite\n- If migrated: Send web invite link only\n- If not migrated: Send traditional SMS gameplay invite\n- Existing SMS-only campaigns continue via SMS\n\n**Web Invite Format:**\n```\n[Creator] invited you to [Campaign Name]!\n\nJoin the adventure: [partylore.com/join/{token}]\n\nRealm: [Fantasy/Cyberpunk/Horror]\nPlayers: [Player list]\n```\n\n---\n\n## Security Requirements\n\n### SEC-001: Magic Link Security\n\n**Requirement:** Magic links must be cryptographically secure and single-use\n\n**Details:**\n- Token length: Minimum 32 characters\n- Token generation: Cryptographically secure random\n- Token storage: Hashed in database\n- Single use: Marked as consumed on first use\n- Expiration: 10 minutes from generation\n- Unused links automatically deleted after expiration\n\n---\n\n### SEC-002: Rate Limiting\n\n**Requirement:** Prevent abuse of magic link generation\n\n**Limits:**\n- Magic link requests: 3 per phone number per hour\n- Failed authentication attempts: 5 per phone per hour\n- After limit exceeded: Temporary block (1 hour)\n- Admin notification if suspicious pattern detected\n\n**User Feedback:**\n- \"Too many requests. Try again in [X] minutes.\"\n- No information leak about whether phone exists in system\n\n---\n\n### SEC-003: Phone Number Validation\n\n**Requirement:** Validate and sanitize all phone number inputs\n\n**Validation Rules:**\n- Must be valid E.164 format\n- Must be from supported countries (US/Canada initially)\n- Strip all formatting characters\n- Validate via carrier lookup (future enhancement)\n\n**Error Messages:**\n- \"Invalid phone number format. Please use: +1-555-123-4567\"\n- No indication whether number exists in system\n\n---\n\n### SEC-004: Session Token Security\n\n**Requirement:** Session tokens must be secure and properly managed\n\n**Details:**\n- Stored in httpOnly, secure, sameSite cookies\n- Not accessible via JavaScript\n- Transmitted only over HTTPS\n- Rotated on privilege escalation (future: payments)\n- Invalidated on explicit logout\n- Cannot be shared between devices\n\n---\n\n## User Interface Requirements\n\n### UI-001: Mobile-First Responsive Design\n\n**Requirement:** Web app must work perfectly on mobile browsers\n\n**Breakpoints:**\n- Mobile: 320px - 767px\n- Tablet: 768px - 1023px  \n- Desktop: 1024px+\n\n**Mobile Priorities:**\n- Single column layout\n- Large touch targets (min 44px)\n- Minimal scrolling per screen\n- Bottom navigation for primary actions\n- Campaign switching via dropdown (not tabs)\n\n---\n\n### UI-002: Dashboard Layout\n\n**Requirement:** Dashboard must clearly present all campaigns and their status\n\n**Components:**\n- Header: Player phone number, settings icon\n- Campaign list: Card-based layout\n- Each card shows:\n  - Campaign name (large)\n  - Realm icon and type\n  - Scene number\n  - Player count and avatars\n  - Status badge (Your turn, Waiting, Paused)\n  - Last activity time\n  - Primary action button (View/Play)\n- Footer: Create campaign, help, logout\n\n**States:**\n- Empty state: \"No campaigns yet. Want to create one?\"\n- Loading state: Skeleton cards\n- Error state: \"Can't load campaigns. Retry?\"\n\n---\n\n### UI-003: Campaign View Layout\n\n**Requirement:** Campaign view must prioritize narrative and action submission\n\n**Components:**\n- Header: Campaign name, back to dashboard\n- Campaign tabs/selector (if multiple campaigns)\n- Narrative feed (scrollable, newest at bottom)\n- Action composer (fixed at bottom)\n- Side panel (desktop): Character sheet, inventory\n\n**Narrative Feed:**\n- Chronological order (like chat app)\n- DM narration: Distinguished style\n- Player actions: Show player name\n- System messages: Subtle, gray\n- Scene breaks: Visual divider\n- Auto-scroll to newest on load\n- \"Load older messages\" at top\n\n**Action Composer:**\n- Text input (multiline)\n- Send button (disabled if not player's turn)\n- Character count (optional)\n- Quick actions (common commands)\n\n---\n\n### UI-004: Character Sheet View\n\n**Requirement:** Display and allow editing of character stats\n\n**Must Display:**\n- Character name\n- Class and level\n- Current HP / Max HP\n- Stats (Strength, Dexterity, etc.)\n- Inventory items\n- Equipment\n- Abilities and spells\n- Experience points\n\n**Editing:**\n- Read-only during active gameplay\n- Editable in character creation phase\n- Level-up selections when applicable\n\n---\n\n### UI-005: Settings View\n\n**Requirement:** Allow players to manage preferences and account\n\n**Settings Available:**\n- SMS notifications (on/off)\n- Email notifications (future)\n- Campaign visibility (private/public)\n- Display name (optional, defaults to phone)\n- Time zone\n- Logout button\n- Delete account option\n\n---\n\n## Notification Requirements\n\n### NOT-001: SMS Notifications Post-Migration\n\n**Requirement:** Continue sending critical SMS even after web migration\n\n**SMS Notifications Sent:**\n- Your turn in [Campaign]\n- All players acted, scene resolving\n- Campaign paused by DM\n- Campaign resumed\n- Player joined/left campaign\n- Major story events (DM triggered)\n\n**SMS Notifications NOT Sent:**\n- Individual player actions (unless affects you)\n- DM narration (view on web)\n- Non-critical system messages\n\n**Message Format:**\n```\n[Campaign Name]: [Brief description]\nView: [direct link to campaign]\n```\n\n---\n\n### NOT-002: Web Notifications\n\n**Requirement:** Provide real-time updates within web app\n\n**Notification Types:**\n- Toast/banner for new actions in current campaign\n- Badge count on other campaigns\n- Browser notifications (if permitted)\n\n**Delivery:**\n- WebSocket for real-time updates (preferred)\n- Polling fallback (every 30 seconds)\n- Push API for browser notifications (optional)\n\n---\n\n### NOT-003: Notification Preferences\n\n**Requirement:** Players control notification frequency and channels\n\n**Options:**\n- SMS: All, Only my turn, Off\n- Web: Real-time, Periodic, Off\n- Email: Daily digest, Off (future)\n\n**Defaults:**\n- SMS: Only my turn\n- Web: Real-time\n- Email: Off\n\n---\n\n## Cost Optimization Goals\n\n### COST-001: SMS Reduction Target\n\n**Requirement:** Reduce SMS costs by migrating engaged players to web\n\n**Targets:**\n- Pre-migration: ~800 SMS per player per month\n- Post-migration goal: ~200 SMS per player per month (75% reduction)\n\n**How Achieved:**\n- Player actions submitted via web (not SMS)\n- DM narration viewed on web (not sent via SMS)\n- Only critical notifications via SMS\n\n---\n\n### COST-002: Migration Success Metrics\n\n**Requirement:** Track cost savings from web adoption\n\n**Metrics:**\n- Percentage of actions taken via web vs SMS\n- SMS cost per player per month (migrated vs non-migrated)\n- Total SMS cost reduction month-over-month\n- API cost remains similar (narrative generation unchanged)\n\n**Target:**\n- 80% of actions via web within 30 days of migration\n- 50% of eligible players migrated within 90 days\n\n---\n\n### COST-003: Graceful SMS Fallback\n\n**Requirement:** SMS gameplay remains fully functional for non-migrated players\n\n**Details:**\n- No features blocked behind web migration\n- SMS commands continue to work\n- Campaign progression identical via SMS or web\n- Quality of gameplay unchanged\n\n**Rationale:** \n- Free tier players may never migrate\n- Some demographics prefer SMS\n- Network/device limitations may prevent web use\n- Maintains product promise of \"SMS-first RPG\"\n\n---\n\n## Success Criteria\n\n### Launch Readiness Checklist\n\n**Phase 1: Core Authentication (Week 1-2)**\n- [ ] Magic link generation and validation\n- [ ] SMS delivery of magic links\n- [ ] Session creation and management\n- [ ] Basic login/logout flow\n- [ ] Security: Rate limiting, token expiration\n\n**Phase 2: Dashboard & Campaign View (Week 3-4)**\n- [ ] Campaign list dashboard\n- [ ] Single campaign view\n- [ ] Narrative feed display\n- [ ] Action submission form\n- [ ] Campaign switching\n\n**Phase 3: SMS Migration (Week 5-6)**\n- [ ] Automatic migration trigger at Scene 5\n- [ ] Web invite for migrated players\n- [ ] SMS notification preferences\n- [ ] Cost tracking and analytics\n\n**Phase 4: Polish & Testing (Week 7-8)**\n- [ ] Mobile responsive design\n- [ ] Error handling and edge cases\n- [ ] Performance optimization\n- [ ] Security audit\n- [ ] User acceptance testing\n\n---\n\n## Out of Scope (Future Phases)\n\nThe following features are explicitly NOT required for initial web launch:\n\n- **Social features:** Friend lists, player profiles, achievements\n- **Content creation:** Custom campaigns, DM tools, content editor\n- **Advanced analytics:** Detailed statistics, graphs, reports\n- **Real-time collaboration:** Shared character sheets, co-op editing\n- **Voice/video:** Audio narration, video calls, voice chat\n- **Mobile app:** Native iOS/Android apps (web responsive sufficient)\n- **Email authentication:** SMS magic links only\n- **Social login:** No Google/Facebook/Apple sign-in\n- **Payment processing:** Monetization in separate phase\n- **Multiplayer lobbies:** Campaign discovery, matchmaking\n- **Moderation tools:** Reporting, blocking, admin interface\n\n---\n\n## Technical Constraints\n\n### TECH-001: Technology Stack\n\n**Frontend:**\n- Modern JavaScript framework (React, Vue, or Svelte)\n- Mobile-first CSS framework\n- WebSocket client for real-time updates\n- Progressive Web App (PWA) optional but recommended\n\n**Backend:**\n- Must integrate with existing Java/Spring Boot SMS backend\n- RESTful API design\n- WebSocket server for real-time features\n- Same PostgreSQL database as SMS system\n\n---\n\n### TECH-002: API Design\n\n**Requirements:**\n- RESTful conventions\n- JSON request/response bodies\n- JWT or session token authentication\n- Versioned endpoints (/api/v1/...)\n- Comprehensive error responses\n- Rate limiting headers\n\n---\n\n### TECH-003: Browser Support\n\n**Minimum Support:**\n- Chrome/Edge: Last 2 versions\n- Safari: Last 2 versions\n- Firefox: Last 2 versions\n- Mobile Safari: iOS 14+\n- Chrome Mobile: Last 2 versions\n\n**Graceful Degradation:**\n- WebSocket fallback to polling\n- LocalStorage fallback for cookies\n- No IE11 support required\n\n---\n\n## Appendix: User Stories\n\n### Story 1: The Commuter\n\"As a busy professional, I want to play during my commute so I can enjoy D&D without scheduling.\"\n- Starts via SMS during commute home\n- Gets hooked by Scene 5\n- Uses web app at desk during work breaks\n- Receives SMS notifications on phone\n\n### Story 2: The Veteran Player\n\"As an experienced D&D player, I want richer interface for character management.\"\n- Tolerates SMS for novelty in Scenes 1-5\n- Immediately migrates to web for better UI\n- Uses web for all actions and planning\n- Only gets SMS for turn notifications\n\n### Story 3: The Casual Gamer\n\"As someone who has never played RPGs, I want the simplest possible experience.\"\n- Starts via SMS, finds it approachable\n- Ignores web migration invite\n- Continues playing entirely via SMS\n- Never needs to visit website\n\n### Story 4: The Juggler\n\"As a player in 4 campaigns, I want to manage them all in one place.\"\n- Web dashboard shows all campaigns\n- Quickly checks which need actions\n- Switches between campaigns seamlessly\n- Gets consolidated SMS notifications\n\n---\n\n**Document Status:** Requirements Complete  \n**Next Step:** Technical Design & Implementation Planning  \n**Estimated Implementation:** 8 weeks for Phase 1-3\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/Party_Lore_Web_App_Requirements.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "def",
        "md"
      ],
      "content_hash": "6434657899c08c6c",
      "size_bytes": 21724,
      "created_at": "2026-01-02T20:42:12.434129"
    },
    {
      "doc_id": "local_party-lore_CRITICAL-BUG-batch-timeout-race-condition",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/CRITICAL-BUG-batch-timeout-race-condition.md",
      "content": "# CRITICAL BUG: Batch Timeout Race Condition with Scene Transitions\n\n**Status**: IDENTIFIED - Production Issue\n**Severity**: P0 - Causes player actions to be ignored\n**Date Discovered**: 2025-11-09\n**Session Affected**: 9f7ae7f3-3005-4772-a92f-ed3e0ad2269c\n\n## Summary\n\nPending action batches are silently discarded when a scene transitions, causing player actions to be lost and batch timeouts to never fire. This results in players waiting indefinitely for responses that will never come.\n\n## Timeline of Bug (Production Logs)\n\n```\n21:34:10 - Player 1 (8339b3a8) acts: \"watch axle break in\"\n21:34:10 - Batch created, 120-second timeout scheduled\n21:34:10 - \"Action batched for scene..., waiting for more players\"\n21:35:01 - AI completes narrative with scene_complete=false\n21:35:01 - Fallback detects 100% objective ‚Üí Forces scene completion\n21:35:01 - Scene transition starts, pending batch CLEARED\n21:35:35 - Player 2 (019b1d19) acts: \"Let's go inside and look around...\"\n21:35:35 - NEW batch created (Player 1's action LOST)\n21:35:48 - Narrative generated for Player 2 ONLY\n```\n\n## Root Cause\n\n`ActionBatchCoordinator` stores pending batches in memory (`pendingBatches` ConcurrentHashMap). When a scene transitions:\n\n1. Scene completion event fires\n2. Transition orchestrator processes completion\n3. Pending batches for that scene are not processed or preserved\n4. New actions create a new batch without previous actions\n5. Original batch timeout never fires (batch was removed)\n\n## Impact\n\n**User Experience**:\n- Players submit actions and receive \"Waiting for other players (up to 120 seconds)\"\n- 120-second timeout never fires\n- When another player acts, their action is lost\n- GM generates narrative ignoring first player's action\n- Creates identity fusion: \"you\" narrative when multiple players acted\n\n**Frequency**: Occurs whenever:\n- Multi-player game\n- Scene completes while waiting for players\n- Scene transitions happen (objective completion, MUCA votes, etc.)\n\n## Code References\n\n**ActionBatchCoordinator.java:119**\n```java\nActionBatch batch = pendingBatches.computeIfAbsent(sceneId, id -> {\n    log.info(\"Creating new action batch for scene {}\", sceneId);\n    ActionBatch newBatch = new ActionBatch(sceneId, session.getId(), scene.getType().toString());\n    scheduleProcessing(newBatch, scene, players.size());\n    return newBatch;\n});\n```\n\n**ActionBatchCoordinator.java:212-238**\n```java\nprivate void processTimedOutBatch(UUID sceneId) {\n    ActionBatch batch = pendingBatches.get(sceneId);\n    if (batch == null) {\n        log.debug(\"Batch {} already processed, ignoring timeout\", sceneId);\n        return; // Batch was cleared - timeout is orphaned\n    }\n    // ...\n}\n```\n\n## Proposed Solutions\n\n### Option 1: Process Pending Batches Before Scene Transition (RECOMMENDED)\n```java\n// In SceneTransitionOrchestrator.java\npublic void transitionToNextScene(Scene completedScene) {\n    // NEW: Process any pending batches first\n    UUID sceneId = completedScene.getId();\n    List<PlayerAction> pendingActions = actionBatchCoordinator.getBatchActions(sceneId);\n\n    if (!pendingActions.isEmpty()) {\n        log.warn(\"Scene transition triggered with {} pending actions - processing now\",\n                 pendingActions.size());\n        // Force batch processing\n        actionBatchCoordinator.forceImmediateProcessing(sceneId);\n        // Wait for processing to complete\n        // ...\n    }\n\n    // Proceed with transition\n    // ...\n}\n```\n\n**Pros**:\n- Ensures no actions are lost\n- Players get response before scene changes\n- Clean separation of concerns\n\n**Cons**:\n- Adds complexity to scene transition\n- May delay transitions\n\n### Option 2: Block Actions During Scene Transition\n```java\n// In GameServiceImpl.java\npublic ProcessingResult processPlayerAction(UUID sessionId, UUID playerId, String action) {\n    Scene currentScene = ...;\n\n    // NEW: Check if scene is transitioning\n    if (currentScene.getStatus() == SceneStatus.COMPLETED) {\n        log.warn(\"Rejecting action - scene {} is transitioning\", currentScene.getId());\n        return ProcessingResult.sceneTransitioning();\n    }\n\n    // Continue processing\n    // ...\n}\n```\n\n**Pros**:\n- Simple implementation\n- Prevents race conditions\n\n**Cons**:\n- Poor UX (actions rejected)\n- Players don't know why action was ignored\n\n### Option 3: Persist Pending Batches to Database\n```java\n// Create pending_action_batches table\n// Store batches in DB instead of memory\n// Restore batches on application restart\n```\n\n**Pros**:\n- Survives application restarts\n- Can track batch history\n- No data loss\n\n**Cons**:\n- Significant implementation effort\n- Database overhead for every action\n- Complicates cleanup\n\n## Recommended Fix\n\n**Hybrid Approach**: Combine Option 1 + Option 2\n\n1. **Block new actions during scene transition**\n   - Set scene status to TRANSITIONING\n   - Reject actions with helpful message: \"Scene is updating, please wait...\"\n\n2. **Process pending batches before transition**\n   - Force process any pending batches\n   - Wait for narrative generation to complete\n   - Then proceed with scene transition\n\n3. **Add timeout safety**\n   - If batch processing takes >30s, proceed with transition anyway\n   - Log warning about lost actions\n\n## Testing Plan\n\n1. **Integration Test**: Multi-player scene with objective completion\n2. **Load Test**: Multiple rapid actions during scene transitions\n3. **Manual Test**: Real production scenario with 2+ players\n\n## Related Issues\n\n- FR-191: Character Tracker Agent (deployed) - Will help identify when players are ignored\n- Identity Fusion Bug: This race condition is a ROOT CAUSE of identity fusion\n\n## Next Steps\n\n1. Implement recommended fix\n2. Add integration tests\n3. Deploy to production\n4. Monitor logs for \"pending actions\" warnings\n\n---\n\n**Discovered by**: Claude analyzing production logs\n**Session**: 9f7ae7f3-3005-4772-a92f-ed3e0ad2269c\n**Log File**: logs.1762724206799.log\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/CRITICAL-BUG-batch-timeout-race-condition.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "def",
        "md"
      ],
      "content_hash": "1d38acd5e162bd18",
      "size_bytes": 5911,
      "created_at": "2026-01-02T20:42:12.434185"
    },
    {
      "doc_id": "local_party-lore_CORE-TEST-ANALYSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/CORE-TEST-ANALYSIS.md",
      "content": "# Core Test Issues - Deep Architecture Analysis\n## AI RPG Expert Review of Party Lore Test Results\n\n**Test Date:** 2025-12-07\n**Suite:** Core Gameplay (5/5 scenarios passed)\n**Duration:** 8m 50s\n**Total Issues Detected:** 82 issues (all non-blocking)\n\n---\n\n## Executive Summary\n\nThe core tests reveal **two fundamental prompt/architecture issues** rather than bugs:\n\n1. **Tier 1 LLM under-detects location changes** (16 occurrences)\n2. **Tier 1 LLM applies damage in non-combat scenarios** (5 occurrences)\n\nBoth issues are **caught and corrected by validation layers** (Tier 1.5 ValidationAgent, MechanicsValidator), which means the **self-healing architecture is working as designed**. However, the **frequency of corrections** indicates prompt improvements are needed.\n\n---\n\n## Issue Breakdown\n\n### 1. Location Tracking Issues (16 occurrences)\n\n#### Pattern Detected\n```\nWARN Tier1ValidationAgent - Per-Player Location Errors: X player location corrections\n  - Player moved from 'Location A' to 'Location B'\n  - Narrative clearly describes movement\n  - But Tier 1 marked location_change as None\n```\n\n#### Examples from Logs\n```\nKael 'Khaos' Patel: moved from 'New Shenzhen Corporate Tower' to 'New Shenzhen Corporate Tower Rooftop'\n  (Narrative says \"Kael moves to the rooftop access point\", but Tier 1 marked location_change as None)\n\nZara 'Zero Cool' Wong: moved from 'New Shenzhen Corporate Tower Entrance' to 'New Shenzhen Corporate Tower Rooftop'\n  (Narrative says \"Zara sneaks towards the entrance\", but Tier 1 marked location_change as None)\n\nZara 'Zero Cool' Wong: moved from 'New Shenzhen Corporate Tower Rooftop' to 'New Shenzhen Corporate Tower Rooftop (maintenance equipment)'\n  (Narrative says \"Zara jumps onto the nearby maintenance equipment\", but Tier 1 marked location_change as None)\n```\n\n#### Root Cause Analysis\n\n**This is NOT a location persistence bug - it's a Tier 1 prompt comprehension issue.**\n\nThe Tier 1 LLM (Llama 3.1-8b-instant) is:\n1. **Generating correct narratives** that describe movement\n2. **But failing to mark `location_change` in mechanics XML**\n3. **Under-detecting micro-movements** within the same general area\n\nThis reveals a **cognitive disconnect** in the Tier 1 prompt:\n- The narrative generation clearly understands spatial movement\n- But the mechanics detection doesn't translate narrative ‚Üí location change\n\n#### Why This Happens\n\n**Granularity Mismatch:**\n- Tier 2 narrative describes detailed spatial positioning (\"moves to rooftop\", \"jumps onto equipment\")\n- Tier 1 mechanics interprets these as **positional shifts** rather than **location changes**\n- The LLM may be reasoning: \"They're still on the same rooftop, just in a different spot\"\n\n**Prompt Clarity Issue:**\nThe Tier 1 prompt likely doesn't emphasize:\n- What constitutes a location change vs positional shift\n- That micro-locations matter for game state tracking\n- When to set `location_change` vs leave as `None`\n\n#### Impact Assessment\n\n**Severity:** Medium (caught by validation, but frequent)\n\n**Why It Matters:**\n- Location is fundamental to game state\n- Memory fragmentation relies on location-based context\n- Scene transitions depend on accurate location tracking\n- FR-199 re-architecture specifically targets location precision\n\n**Why It's Not Critical:**\n- Tier 1.5 ValidationAgent **catches 100% of these errors**\n- Corrections are applied automatically\n- Game state remains consistent\n- Players never see the inconsistency\n\n#### Recommended Fix\n\n**Option 1: Prompt Enhancement (Recommended)**\n\nAdd explicit location change detection guidance to Tier 1 prompt:\n\n```\nLOCATION CHANGE DETECTION:\n\nWhen players move to a new area, even within the same general location, mark as location_change.\n\nExamples of location changes:\n- \"moves to the rooftop\" ‚Üí CHANGE from building to rooftop\n- \"enters the tavern\" ‚Üí CHANGE from street to tavern interior\n- \"jumps onto equipment\" ‚Üí CHANGE to equipment sub-location\n- \"sneaks to the entrance\" ‚Üí CHANGE to entrance area\n\nMark location_change even for micro-movements if the narrative describes spatial transition.\n\nIf narrative says player \"moves to\", \"goes to\", \"enters\", \"climbs to\", \"sneaks to\" ‚Üí assume location change unless explicitly staying put.\n```\n\n**Option 2: Validation Layer Tuning**\n\nThe ValidationAgent already works perfectly. Could reduce log noise by:\n- Downgrading WARN to DEBUG for expected corrections\n- Only WARN if ValidationAgent corrections exceed threshold (e.g., >5 per scene)\n\n**Option 3: Tier 1 Model Upgrade**\n\nConsider testing with:\n- Llama 3.3-70b-versatile (more capable reasoning)\n- Claude Haiku for Tier 1 (better spatial reasoning)\n\nTest impact on:\n- Location detection accuracy\n- Cost per turn\n- Latency\n\n---\n\n### 2. Damage Application in Non-Combat (5 occurrences)\n\n#### Pattern Detected\n```\nWARN MechanicsValidator - AI mechanics validation FAILED with 2 violations:\n  - DAMAGE_WITHOUT_THREAT: Player (AI said -5, should be ~0)\n  - Took damage but no active threats present\n```\n\n#### Examples from Logs\n```\nTurn 3: Solo Exploration scenario\n- Zara 'Zero Cool' Wong: AI said -5 HP, should be ~0\n- Kael 'Khaos' Patel: AI said -5 HP, should be ~0\n- Scenario: Exploring corporate tower rooftop\n- No NPCs engaged, no combat active\n```\n\n#### Root Cause Analysis\n\n**This is a Tier 1 prompt issue: damage causation confusion.**\n\nThe Tier 1 LLM is applying damage in **exploration/stealth** scenarios where:\n- No enemies are engaged\n- Players are performing skill checks (lockpicking, sneaking, hacking)\n- Environmental hazards aren't explicitly present\n- Damage makes no narrative sense\n\n#### Why This Happens\n\n**Possible LLM Reasoning:**\n1. **\"Failed action = damage\" heuristic** - LLM may interpret failed stealth/skill checks as warranting damage\n2. **Tension escalation** - Trying to add stakes to quiet exploration scenes\n3. **Combat mode persistence** - May still be in \"combat mindset\" from earlier scenes\n4. **Prompt ambiguity** - Tier 1 prompt may not clearly distinguish:\n   - Combat damage (from attacks)\n   - Environmental damage (from traps, falls)\n   - Skill check failures (no HP loss, just narrative consequence)\n\n#### Impact Assessment\n\n**Severity:** Low-Medium (caught by validation, but confuses game logic)\n\n**Why It Matters:**\n- Breaks fundamental RPG rules (damage requires source)\n- Confuses AI narrative generation\n- Could lead to weird death scenarios\n- Undermines player trust in mechanics\n\n**Why It's Not Critical:**\n- HybridMechanicsEngine **catches 100% of these violations**\n- Damage is corrected to 0 before being applied\n- No mechanical impact on gameplay\n- Validator logs make debugging easy\n\n#### Recommended Fix\n\n**Option 1: Tier 1 Prompt Clarification (Recommended)**\n\nAdd damage source validation to Tier 1 prompt:\n\n```\nDAMAGE APPLICATION RULES:\n\nPlayers can only take HP damage from:\n1. Enemy attacks (requires engaged NPC with hostile intent)\n2. Environmental hazards (traps, falls, fire, poison - must be described in narrative)\n3. Spells/abilities that explicitly deal damage\n\nDO NOT apply damage for:\n- Failed skill checks (lockpicking, stealth, persuasion)\n- Narrative tension or suspense\n- Moving to dangerous locations without triggering hazards\n- Being detected by enemies (detection ‚â† attack)\n\nBefore setting hp_change to negative value, ask:\n\"What specific source is dealing this damage right now?\"\n\nIf no clear source ‚Üí hp_change = 0\n```\n\n**Option 2: Game Mode Context Enhancement**\n\nThe GameModeDetector already identifies COMBAT vs EXPLORATION. Strengthen this signal in Tier 1:\n\n```\nCurrent Mode: EXPLORATION\nIn exploration mode, damage requires explicit environmental hazard.\nPlayers do not take damage from failed checks or being detected.\n```\n\n**Option 3: Post-Validation Feedback Loop**\n\nWhen MechanicsValidator corrects damage, log the reasoning:\n```\nDAMAGE_WITHOUT_THREAT: Zara took -5 HP but no threats present\n‚Üí Correction: Set to 0 HP\n‚Üí Reason: No engaged enemies, no environmental hazards described\n‚Üí Suggestion: Apply damage only when source is clear\n```\n\nThis could be fed back into prompt improvements or fine-tuning data.\n\n---\n\n### 3. Narrative Issues (61 occurrences)\n\n#### CONTRADICTION Issues (55 occurrences - 90% of narrative issues)\n\n**Pattern:**\n```\n[MEDIUM/HIGH] Narrative Contradiction Detected:\nCharacters are simultaneously described as being in 'The Tavern Interior'\nin the established context, but now appear to be on rooftops preparing\nfor an external mission\n```\n\n#### Root Cause Analysis\n\nThis is **directly related to Issue #1 (location tracking)**.\n\n**Causation Chain:**\n1. Tier 1 fails to mark location change\n2. Game state shows player still in \"Tavern Interior\"\n3. Tier 2 narrative describes player on rooftop (correctly following action)\n4. Quality analysis detects **location contradiction** between state and narrative\n5. ValidationAgent corrects the location retroactively\n6. But the contradiction was already recorded as an issue\n\n**This is a SYMPTOM, not a separate issue.**\n\n#### Recommended Fix\n\n**Fix Issue #1 (Tier 1 location detection) ‚Üí 90% of contradictions will disappear.**\n\nThe remaining 10% may be legitimate narrative contradictions that need prompt tuning in Tier 2.\n\n---\n\n#### ILLOGICAL_NPC_BEHAVIOR Issues (3 occurrences)\n\n**Pattern:**\n```\n[LOW] Zhang's inconsistent behavior:\nZhang's behavior is inconsistent, sometimes showing signs of unease\nand other times appearing calm and collected.\n```\n\n#### Root Cause Analysis\n\nThis is a **narrative generation issue** in Tier 2, likely caused by:\n\n1. **Insufficient NPC personality persistence** - NPC traits not strongly enforced across turns\n2. **Memory context gaps** - Earlier NPC behavior not surfaced in current turn context\n3. **Tone shift in narrative** - Tier 2 LLM varying NPC portrayal for variety\n\n#### Recommended Fix\n\n**Option 1: NPC Personality Reinforcement**\n\nStrengthen NPC personality in Tier 2 prompt:\n\n```\nNPC PERSONALITY CONSISTENCY:\n\nFor each NPC, maintain consistent:\n- Emotional baseline (calm, nervous, aggressive, etc.)\n- Speech patterns (formal, casual, terse, verbose)\n- Behavioral tendencies (cautious, reckless, calculating)\n\nIf NPC behavior changes, it must be motivated by:\n- New information received\n- Threat level escalation/de-escalation\n- Relationship shift with players\n- Injury or status effect\n\nDo not vary NPC personality for narrative variety alone.\n```\n\n**Option 2: Memory Enhancement**\n\nEnsure recent NPC actions are included in context:\n- Last 2-3 turns of NPC dialogue/behavior\n- NPC emotional state from previous scene\n- Any personality-defining moments from earlier\n\n---\n\n#### PACING_ISSUE (2 occurrences)\n\n**Pattern:**\n```\n[LOW] Slow pacing: The pacing can be slow at times,\nwith some sections feeling a bit draggy.\n```\n\n#### Root Cause Analysis\n\nThis is **subjective narrative quality feedback** from NarrativeQualityAnalysisService (Claude-powered).\n\nNot a technical issue - this is the AI critic identifying narrative flow problems.\n\n#### Recommended Fix\n\n**This is actually GOOD feedback** - it means the quality monitoring is working.\n\nPotential improvements:\n1. **Scene pacing hints** in Tier 2 prompt based on turn count\n2. **Urgency escalation** after N turns without progress\n3. **Beat progression tracking** - faster pacing as beat nears resolution\n\nBut given only 2 occurrences across 5 scenarios, **this is not a priority**.\n\n---\n\n#### MISSING_CONTEXT (1 occurrence)\n\n**Pattern:**\n```\n[LOW] Unclear objectives: The players are not given clear objectives\nor a clear understanding of what they are trying to accomplish.\n```\n\n#### Root Cause Analysis\n\nLikely a **scene objective clarity issue** in opening narrative generation.\n\n#### Recommended Fix\n\n**Strengthen scene objective in opening narrative:**\n\n```\nOpening Narrative Generation:\n1. State the immediate objective clearly in first paragraph\n2. Describe what success looks like\n3. Hint at obstacles or complications\n4. Set stakes (what happens if they fail?)\n\nExample:\n\"Your mission is clear: infiltrate the corporate tower and retrieve\nthe encrypted data chip before the security protocols reset in 30 minutes.\nIf you're detected, the tower will go into lockdown and extraction\nbecomes impossible.\"\n```\n\n---\n\n## Architectural Insights\n\n### What's Working Well\n\n1. **Self-Healing Architecture** ‚úÖ\n   - ValidationAgent catches location errors 100% of the time\n   - MechanicsValidator catches invalid damage 100% of the time\n   - Corrections are applied automatically\n   - Game state remains consistent despite LLM errors\n\n2. **Layered Validation** ‚úÖ\n   - Tier 1.5 validation (location, HP, status)\n   - Mechanics validation (damage sources, threats)\n   - Narrative quality analysis (contradictions, pacing)\n   - Each layer catches different error types\n\n3. **Observability** ‚úÖ\n   - Detailed logging of every correction\n   - Clear explanation of what was wrong and how it was fixed\n   - Issue tracking with severity levels\n   - Test reports capture all problems\n\n### What Needs Improvement\n\n1. **Tier 1 Spatial Reasoning**\n   - LLM understands movement narratively but fails to mark mechanics\n   - Needs clearer prompt guidance on location change detection\n   - Consider model upgrade or targeted examples\n\n2. **Tier 1 Damage Causation**\n   - LLM applies damage without clear source\n   - Needs explicit validation rules in prompt\n   - Better game mode awareness (COMBAT vs EXPLORATION)\n\n3. **NPC Personality Persistence**\n   - Minor inconsistencies in NPC behavior across turns\n   - Needs stronger personality reinforcement\n   - Better memory surfacing of NPC history\n\n---\n\n## Prompt Engineering Recommendations\n\n### Priority 1: Tier 1 Location Detection (Fixes 82% of issues)\n\n**Test Approach:**\n1. Create script: `scripts/test-location-detection.sh`\n2. Test scenarios with clear movement:\n   - \"I move to the rooftop\" ‚Üí should mark location_change\n   - \"I sneak to the entrance\" ‚Üí should mark location_change\n   - \"I jump onto the equipment\" ‚Üí should mark location_change\n   - \"I stay hidden\" ‚Üí should NOT mark location_change\n3. Iterate on Tier 1 prompt until detection is reliable\n4. Re-run core tests to verify improvement\n\n**Files to Modify:**\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java` (Tier 1 prompt)\n- Look for location_change XML field definition\n- Add explicit detection rules and examples\n\n### Priority 2: Tier 1 Damage Validation (Fixes 6% of issues)\n\n**Test Approach:**\n1. Create script: `scripts/test-damage-rules.sh`\n2. Test scenarios:\n   - Failed stealth check ‚Üí should NOT apply damage\n   - Enemy attack hit ‚Üí SHOULD apply damage\n   - Fall from height (narrative describes fall) ‚Üí SHOULD apply damage\n   - Lockpicking failure ‚Üí should NOT apply damage\n3. Iterate on damage rules in Tier 1 prompt\n4. Verify MechanicsValidator stops triggering\n\n**Files to Modify:**\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java` (Tier 1 prompt)\n- Look for hp_change field rules\n- Add damage source validation\n\n### Priority 3: NPC Consistency (Fixes 4% of issues)\n\n**Test Approach:**\n1. Multi-turn NPC interaction scenario\n2. Check if NPC personality remains consistent\n3. Verify emotional state transitions are motivated\n\n**Files to Modify:**\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java` (Tier 2 prompt)\n- Strengthen NPC personality section\n- Include recent NPC history in context\n\n---\n\n## Testing Strategy\n\n### Using Existing Scripts\n\nThe `scripts/` folder should contain testing infrastructure for prompt iteration:\n\n```bash\n# Test location detection with various movement scenarios\n./scripts/test-location-detection.sh\n\n# Test damage rules in different game modes\n./scripts/test-damage-rules.sh\n\n# Test NPC personality consistency over multiple turns\n./scripts/test-npc-consistency.sh\n```\n\n### Validation Approach\n\n1. **Unit Test Prompts:** Use scripts to test specific scenarios rapidly\n2. **Integration Test:** Run `/test core` to verify improvements\n3. **Regression Check:** Ensure fixes don't break other aspects\n4. **Metric Tracking:** Count reduction in ValidationAgent corrections\n\n---\n\n## Conclusion\n\n### The Good News\n\n**These are NOT bugs - they're prompt tuning opportunities.**\n\nThe architecture is **fundamentally sound**:\n- Problems are detected automatically ‚úÖ\n- Corrections are applied reliably ‚úÖ\n- Game state remains consistent ‚úÖ\n- Tests pass despite LLM imperfections ‚úÖ\n\nThis is **exactly how an AI RPG system should work** - LLMs are imperfect, so you build validation layers to catch and correct errors.\n\n### The Work Ahead\n\n**Two focused prompt improvements will eliminate 88% of issues:**\n\n1. **Tier 1 location detection** ‚Üí Fixes 16 location errors + 55 contradiction errors = 71 issues\n2. **Tier 1 damage validation** ‚Üí Fixes 5 damage errors = 5 issues\n\n**Combined: 76 of 82 issues resolved (93%)**\n\nThe remaining 6 issues (pacing, NPC behavior, objectives) are **minor narrative quality** improvements.\n\n### Recommended Next Steps\n\n1. ‚úÖ **Commit the FR-199 fixes** (already done)\n2. üîß **Create `scripts/test-location-detection.sh`** to iterate on Tier 1 location prompt\n3. üîß **Create `scripts/test-damage-rules.sh`** to iterate on Tier 1 damage prompt\n4. ‚úÖ **Re-run `/test core`** to validate improvements\n5. üìä **Track metrics:** ValidationAgent correction count before/after\n\n---\n\n**Bottom Line:** The architecture is robust. The LLM prompts need refinement. The validation layers are doing their job perfectly. This is a **mature, production-ready system** that just needs prompt tuning.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/CORE-TEST-ANALYSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "llm",
        "md",
        "test"
      ],
      "content_hash": "07eec16e40d647a0",
      "size_bytes": 17575,
      "created_at": "2026-01-02T20:42:12.434241"
    },
    {
      "doc_id": "local_party-lore_CRITICAL-BUGS-AND-SOLUTIONS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/CRITICAL-BUGS-AND-SOLUTIONS.md",
      "content": "# Critical Bugs and Solutions - Party Lore AI System\n\n**Date:** 2025-01-09\n**Status:** Analysis Complete, Quick Wins Implemented, Full Architecture Specified\n**Related Documents:**\n- `AI_NARRATIVE_QUALITY_ISSUES.md` (original bug report)\n- `.specify/requirements/fr-191-multi-agent-ai-architecture.md` (full solution spec)\n\n---\n\n## Executive Summary\n\nAutonomous testing revealed **catastrophic AI quality failures** in multi-player scenarios (2.8/10 quality, 80% failure rate). Root cause analysis shows the current **monolithic single-LLM architecture** cannot handle the complexity of multi-player RPG coordination.\n\n**Quick Wins Implemented Today:**\n1. ‚úÖ Enhanced player roster injection with mandatory validation\n2. ‚úÖ Post-generation validation pipeline (NarrativeValidator.java)\n3. ‚úÖ Action-specific temperature settings (0.3 for mechanics, 0.8 for narrative)\n\n**Full Solution Specified:**\n- FR-191: Multi-Agent AI Architecture with ReAct Framework\n- 12 implementation tasks over 4 weeks\n- Target: 7.0/10 quality (150% improvement)\n\n---\n\n## Critical Bugs (Blocking Gameplay)\n\n### Bug #1: GM Predicts Player Actions Before Declaration\n**Severity:** CRITICAL (Player agency violation)\n**Occurrences:** 4 in test suite\n**Pass Rate Impact:** 80% of scenarios fail\n\n**Symptom:**\n```\nTurn 2:\nGM Response: \"Your voice cuts through the wind, sharp and commanding\"\nProblem: This occurs BEFORE player actually declares speaking\n```\n\n**Root Cause:**\n- Single LLM trying to narrate, validate, and predict simultaneously\n- No validation layer to catch future-tense narration\n- Temperature too low (0.7) causing repetitive predictive patterns\n\n**Solution Implemented (Quick Win #2):**\n- `NarrativeValidator.java` detects agency violation patterns\n- Regex checks for \"you decide to\", \"you will\", \"you step forward\"\n- Validation runs after Tier 2 generation\n- **Future:** Auto-regeneration with stricter prompts (FR-191)\n\n**Solution Planned (FR-191):**\n- Separate Narrative Validator Agent with auto-regeneration\n- Max 2 regeneration attempts with enhanced prompts\n- Target: 0 agency violations (100% catch rate)\n\n---\n\n### Bug #2: Character Identity Fusion (Players Treated as Single Entity)\n**Severity:** CRITICAL (Destroys individual player experience)\n**Occurrences:** 3 in test suite\n**Pass Rate Impact:** 60% of multi-player scenarios fail\n\n**Symptom:**\n```\nEpic 9 Scenario:\n- Both Aldric and Brenna listed as NPCs in mechanics XML\n- Aldric acts, but GM addresses \"both players\"\n- Individual identities conflated into single narrative thread\n```\n\n**Root Cause:**\n- No explicit player roster in prompts\n- LLM infers player count from action text (error-prone)\n- Batch processing loses individual player tracking\n- No validation that all active players mentioned\n\n**Solution Implemented (Quick Win #1):**\n- Enhanced multi-player prompt with explicit roster boxes\n- Mandatory checklist: \"‚òê Aldric ‚òê Brenna\" must ALL be checked\n- Stronger validation requirements (5-point checklist)\n\n**Solution Planned (FR-191 REQ-1):**\n- **CharacterTrackerAgent** maintains player registry\n- Builds `PlayerRoster` with ACTING vs INACTIVE separation\n- Injects roster into Tier 1 and Tier 2 prompts\n- Post-validation checks all acting players mentioned\n- Target: 0 character fusion incidents\n\n---\n\n### Bug #3: Player Actions Completely Ignored\n**Severity:** CRITICAL (Player feels unheard)\n**Occurrences:** 2 in test suite\n**Pass Rate Impact:** 40% of multi-player scenarios fail\n\n**Symptom:**\n```\nTurn 1 (Epic 9):\nBrenna: \"I draw my electromagnetic disruption device and scan...\"\nGM Response: Only addresses Aldric's action. Brenna's action erased.\n```\n\n**Root Cause:**\n- Batch processing compresses multiple actions into single prompt\n- LLM focuses on first/most interesting action, drops others\n- No validation that response mentions all submitted actions\n- Generic \"the party\" language hides individual omissions\n\n**Solution Implemented (Quick Win #1):**\n- Mandatory validation checklist in prompt\n- \"‚ùå BAD: 'The party advances' (doesn't acknowledge individuals!)\"\n- Explicit requirement: \"If you cannot acknowledge all players, narrative is INVALID\"\n\n**Solution Planned (FR-191 REQ-3):**\n- NarrativeValidator.checkAllPlayersAcknowledged()\n- Uses PlayerRoster to verify every acting player mentioned\n- Auto-regeneration if validation fails\n- Target: 0 ignored actions\n\n---\n\n### Bug #4: Missing Combat Mechanics (No HP Changes During Combat)\n**Severity:** HIGH (Combat doesn't work)\n**Occurrences:** 8 in test suite\n**Pass Rate Impact:** All combat scenarios degraded\n\n**Symptom:**\n```\nBasic Combat:\n- Both players draw weapons and aim at messenger\n- Explicit \"finger hovering near trigger\"\n- NO combat mechanics engaged (no initiative, no rolls, no HP changes)\n- Scene remains in pure narrative mode\n```\n\n**Root Cause:**\n- Tier 1 doesn't recognize combat-triggering actions\n- No deterministic \"weapon drawn = combat MUST occur\" rule\n- LLM can choose to skip mechanics for \"narrative flow\"\n- Prompt says HP changes are \"optional\" - AI reads as skippable\n\n**Solution Implemented (Quick Win #3):**\n- Temperature 0.3 for Tier 1 mechanics (more deterministic)\n- Temperature 0.8 for Tier 2 narrative (more variety)\n- Research shows this reduces format drift by 95-98%\n\n**Solution Planned (FR-191 REQ-2):**\n- **MechanicsClassifier** agent classifies actions BEFORE Tier 1\n- Deterministic keyword detection: \"attack\", \"fire\", \"weapon\" ‚Üí COMBAT\n- Combat classification forces `MechanicsRequirement.HP_CHANGES_REQUIRED`\n- Tier 1 post-processor validates HP changes present or injects defaults\n- Target: 100% of combat actions generate mechanics\n\n---\n\n### Bug #5: Identical Responses for Different Actions\n**Severity:** HIGH (Feels robotic)\n**Occurrences:** 4 in test suite\n**Pass Rate Impact:** Quality degradation, not blocking\n\n**Symptom:**\n```\nAldric (Turn 1): \"I advance aggressively, scanning hallway\"\nBrenna (Turn 2): \"I raise shotgun, aiming at figure\"\n\nGM Response (nearly identical for both):\n\"The hooded figure freezes mid-step, gloved hands slowly rising...\"\n```\n\n**Root Cause:**\n- Temperature 0.7 too low for narrative variety\n- No recent response memory to avoid repetition\n- LLM falls back on template patterns\n- Single-shot generation with no anti-repetition context\n\n**Solution Implemented (Quick Win #3):**\n- Temperature 0.8 for Tier 2 narrative (up from 0.7)\n- Research shows 0.7-0.9 range increases response variety\n\n**Solution Planned (FR-191 REQ-4):**\n- Structured Memory includes last 2-3 GM responses\n- Anti-repetition check compares new narrative to recent responses\n- Validation flags repeated phrases\n- Target: <10% response similarity between consecutive turns\n\n---\n\n### Bug #6: Narrative Setting Inconsistency (Hospital Becomes Castle)\n**Severity:** HIGH (Breaks immersion)\n**Occurrences:** 5 in test suite\n**Pass Rate Impact:** Continuity errors every session\n\n**Symptom:**\n```\nNPC Interaction:\nOpening: \"The abandoned Millbrook Psychiatric Hospital looms...\"\nTurn 1: \"wind rattling through the broken windows\"\nTurn 2: \"The west wing corridor yawns before you, darker than the rest of the castle\"\n\nProblem: Hospital transformed into castle with no explanation\n```\n\n**Root Cause:**\n- Flat memory fragments lose setting context\n- No persistent \"world state\" anchor\n- LLM re-interprets location from scratch each turn\n- Realm context not reinforced in prompts\n\n**Solution Implemented (Quick Win #1):**\n- P2 fix in AdvancedPromptEngineering.java (lines 391-400)\n- Explicit \"‚ö†Ô∏è REALM CONSISTENCY RULES\" section\n- \"Do NOT introduce elements from other genres\"\n- \"Maintain consistent tone, technology level, magic system\"\n\n**Solution Planned (FR-191 REQ-4):**\n- **StructuredMemory.WorldState** maintains persistent facts\n- Current location, realm type, persistent flags (e.g., \"door_locked\" ‚Üí true)\n- Every prompt includes: \"CURRENT SETTING: [location]\" and \"REALM: [name] ([type])\"\n- Validation checks narrative doesn't shift genres or locations unexpectedly\n- Target: <2 setting inconsistencies per test suite\n\n---\n\n## Architecture Gaps Discovered\n\n### Gap #1: No Multi-Agent Architecture\n**Current:** Single LLM does everything (narrate, validate, track players, generate mechanics)\n**Industry Standard:** Specialized agents with distinct responsibilities (ReAct framework)\n\n**Research Evidence:**\n- ArXiv papers on AI game masters show 40% improvement with multi-agent systems\n- VirtualGameMaster (GitHub) uses Narrator + Archivist + Mechanics Engine agents\n- ReAct framework enables \"Thought ‚Üí Action ‚Üí Observation\" reasoning loops\n\n**Solution (FR-191):**\n4 specialized agents:\n1. CharacterTrackerAgent - Player identity registry\n2. MechanicsClassifier - Action type detection (deterministic)\n3. Narrative Generator - Creative storytelling (existing Tier 2)\n4. NarrativeValidator - Quality assurance with auto-regeneration\n\n---\n\n### Gap #2: Flat Memory System (No Semantic Organization)\n**Current:** Flat list of string fragments\n**Industry Standard:** Three-layer memory hierarchy\n\n**Research Evidence:**\n- Character-LLM paper shows 60% reduction in continuity errors with structured memory\n- RPGGO implementation uses short-term + episodic + semantic layers\n- LLM context window limitations require intelligent memory compression\n\n**Solution (FR-191 REQ-4):**\n```\nLayer 1: Short-term (last 2-3 turns verbatim)\nLayer 2: Episodic (NPCs, discoveries, threats - session scope)\nLayer 3: Semantic (world facts, character profiles - persistent)\n```\n\n**Database Tables:**\n- `structured_memory_turns` - Full turn history\n- `structured_memory_npcs` - NPC tracking with HP, status, role\n- `structured_memory_discoveries` - Key findings for continuity\n\n---\n\n### Gap #3: No Deterministic Classification Layer\n**Current:** LLM decides if combat happens (unreliable)\n**Industry Standard:** Hybrid system - deterministic rules + creative AI\n\n**Research Evidence:**\n- AI Dungeon Master guides recommend \"code for rules, AI for story\"\n- Function calling/tool use patterns for mechanical operations\n- 95-98% schema adherence with deterministic pre-classification\n\n**Solution (FR-191 REQ-2):**\n```java\nclass MechanicsClassifier {\n    ActionClassification classifyAction(String text) {\n        if (containsAny(text, COMBAT_KEYWORDS)) {\n            return COMBAT_REQUIRED;  // Non-negotiable\n        }\n        // ... other classifications\n    }\n}\n```\n\nKeywords: \"attack\", \"fire\", \"shoot\", \"weapon\" ‚Üí **MUST** generate combat mechanics\n\n---\n\n### Gap #4: No Validation Pipeline with Auto-Regeneration\n**Current:** Warnings logged, bad narrative delivered anyway\n**Industry Standard:** Validate ‚Üí Regenerate with stricter prompt ‚Üí Deliver\n\n**Research Evidence:**\n- Multi-agent systems use validation layers to maintain quality standards\n- Auto-regeneration with failure context improves output by 30%\n- Max 2 attempts prevents infinite loops while catching most issues\n\n**Solution (FR-191 REQ-3):**\n```java\nfor (int attempt = 1; attempt <= 2; attempt++) {\n    narrative = generateTier2(request);\n    validation = validator.validate(narrative);\n\n    if (validation.passed()) return narrative;\n\n    if (attempt < 2) {\n        // Enhance prompt with validation failures\n        request = addValidationWarnings(request, validation.issues());\n    }\n}\n// Deliver even if failed after 2 attempts (better than crashing)\n```\n\n---\n\n### Gap #5: Single Temperature for All Tasks\n**Current:** 0.7 temperature for both mechanics and narrative\n**Industry Standard:** Low temp for structured output, high temp for creativity\n\n**Research Evidence:**\n- Structured output research shows 0.3-0.5 reduces format drift\n- Narrative generation benefits from 0.7-0.9 for variety\n- OpenAI Functions guide recommends task-specific temperatures\n\n**Solution Implemented (Quick Win #3):**\n```java\n// ClaudeConfig.java\npublic double getMechanicsTemperature() { return 0.3; }  // Deterministic\npublic double getNarrativeTemperature() { return 0.8; }  // Creative\n```\n\nApplied in TwoTierNarrativeService:\n- Tier 1 (mechanics): 0.3 temperature\n- Tier 2 (narrative): 0.8 temperature\n\n---\n\n## Implementation Status\n\n### ‚úÖ Quick Wins (Implemented Today)\n\n**Quick Win #1: Enhanced Player Roster Injection**\n- **File:** `party-lore-ai/src/main/java/com/partylore/ai/narrative/AdvancedPromptEngineering.java`\n- **Changes:** Lines 516-549 - Multi-player roster with mandatory validation\n- **Impact:** Stronger prompts, explicit validation requirements\n- **Expected:** 30-40% improvement in player acknowledgment\n\n**Quick Win #2: Post-Generation Validation**\n- **File:** `party-lore-ai/src/main/java/com/partylore/ai/narrative/NarrativeValidator.java` (NEW)\n- **Changes:** Created validation service with 3 critical checks\n- **Impact:** Detects agency violations, missing players, action predictions\n- **Expected:** Catches 80% of critical issues (no regeneration yet)\n\n**Quick Win #3: Specialized Temperatures**\n- **File:** `party-lore-ai/src/main/java/com/partylore/ai/config/ClaudeConfig.java`\n- **Changes:** Lines 109-129 - Added getMechanicsTemperature() and getNarrativeTemperature()\n- **File:** `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n- **Changes:** Lines 427, 482 - Applied specialized temperatures\n- **Impact:** More deterministic mechanics, more varied narratives\n- **Expected:** 20% reduction in identical responses\n\n**Status:** All changes staged with `git add .` - Ready for commit when requested\n\n---\n\n### üìã Full Solution Specified\n\n**FR-191: Multi-Agent AI Architecture with ReAct Framework**\n- **File:** `.specify/requirements/fr-191-multi-agent-ai-architecture.md`\n- **Scope:** 4 specialized agents, 3-layer memory, full validation pipeline\n- **Effort:** 4 weeks, 12 implementation tasks\n- **Priority:** P0-CRITICAL\n\n**Implementation Phases:**\n1. **Week 1:** CharacterTracker + MechanicsClassifier + Integration\n2. **Week 2:** Structured Memory System (3-layer architecture)\n3. **Week 3:** Enhanced Validation + Auto-Regeneration\n4. **Week 4:** Testing, Rollout, Performance Tuning\n\n**Success Metrics:**\n- Quality Score: 2.8/10 ‚Üí 7.0/10 (150% improvement)\n- Multi-player Pass Rate: 20% ‚Üí 80%\n- Agency Violations: 4 ‚Üí 0\n- Character Fusion: 3 ‚Üí 0\n- Ignored Actions: 2 ‚Üí 0\n\n---\n\n## Testing Strategy\n\n### Autonomous Test Suite\n- **Location:** `.test-reports/test-report-quick-20251109-124839.md`\n- **Scenarios:** 5 scenarios (2-player, 3-player, solo, NPC, structured)\n- **Current Baseline:** 2.8/10 average, 20% pass rate\n\n**Re-Test After Quick Wins:**\n```bash\n# Run same test suite\nmvn test -Dtest=AutonomousTestSuite\n\n# Compare quality scores\n# Expected: 4.0-5.0/10 (40-75% improvement from Quick Wins alone)\n```\n\n**Re-Test After Full Implementation:**\n```bash\n# Run full test suite after FR-191 complete\n# Expected: 7.0-8.0/10 (150-185% improvement)\n# Pass rate: 80%+ (4-5 of 5 scenarios)\n```\n\n---\n\n## Risk Assessment\n\n### Low Risk (Quick Wins)\n‚úÖ **Player Roster Injection** - Prompt changes only, no behavior change risk\n‚úÖ **Temperature Settings** - Research-backed, easily reverted\n‚úÖ **Validation Logging** - Informational only, doesn't block delivery\n\n### Medium Risk (FR-191 Phase 1-2)\n‚ö†Ô∏è **CharacterTracker Integration** - New code paths, test thoroughly\n‚ö†Ô∏è **MechanicsClassifier** - Could force unwanted combat, tune keywords\n‚ö†Ô∏è **Structured Memory** - Database schema changes, migration needed\n\n### High Risk (FR-191 Phase 3)\nüö® **Auto-Regeneration** - Could increase latency >10 seconds (SMS timeout)\nüö® **Validation False Positives** - Could waste tokens on unnecessary regenerations\n\n**Mitigation:**\n- Feature flags for each agent (disable independently if issues)\n- Max 2 regeneration attempts (prevents infinite loops)\n- Fail-open validation (deliver even if validation fails)\n- Gradual rollout: CharacterTracker ‚Üí Classifier ‚Üí Memory ‚Üí Validator\n\n---\n\n## Next Steps\n\n### Immediate (Today)\n1. ‚úÖ Review Quick Win changes in this document\n2. [ ] Test Quick Wins with `mvn clean install`\n3. [ ] Commit Quick Wins when satisfied (user will decide when)\n\n### Short-Term (Week 1)\n4. [ ] Start FR-191 Phase 1 implementation\n5. [ ] Create TASK-191-001: CharacterTrackerAgent\n6. [ ] Create TASK-191-002: MechanicsClassifier\n7. [ ] Create TASK-191-003: Integration\n\n### Medium-Term (Weeks 2-4)\n8. [ ] Implement Structured Memory System\n9. [ ] Implement Auto-Regeneration\n10. [ ] Performance testing and optimization\n11. [ ] Production rollout with monitoring\n\n---\n\n## Critical Bugs Summary Table\n\n| Bug | Severity | Occurrences | Root Cause | Quick Win | Full Solution |\n|-----|----------|-------------|------------|-----------|---------------|\n| **#1: Player Agency Violations** | CRITICAL | 4 | Monolithic LLM | ‚úÖ Validation | FR-191 REQ-3 (Validator Agent) |\n| **#2: Character Identity Fusion** | CRITICAL | 3 | No roster | ‚úÖ Enhanced Roster | FR-191 REQ-1 (Tracker Agent) |\n| **#3: Ignored Actions** | CRITICAL | 2 | Batch processing | ‚úÖ Validation Checklist | FR-191 REQ-3 (Validator) |\n| **#4: Missing Combat Mechanics** | HIGH | 8 | No classifier | ‚úÖ Low Temp | FR-191 REQ-2 (Classifier Agent) |\n| **#5: Identical Responses** | HIGH | 4 | Low temp | ‚úÖ High Temp | FR-191 REQ-4 (Memory) |\n| **#6: Setting Inconsistency** | HIGH | 5 | Flat memory | ‚úÖ Realm Rules | FR-191 REQ-4 (WorldState) |\n\n---\n\n## References\n\n**Test Reports:**\n- `.test-reports/test-report-quick-20251109-124839.md` - Original autonomous test results\n- `AI_NARRATIVE_QUALITY_ISSUES.md` - Detailed issue analysis\n\n**Specifications:**\n- `.specify/requirements/fr-191-multi-agent-ai-architecture.md` - Full solution spec\n- `.specify/requirements/fr-184-two-tier-narrative-system.md` - Current architecture\n- `.specify/requirements/fr-185-tier1-post-processing-validations.md` - Existing validations\n\n**Research:**\n- ArXiv: \"Enhancing AI Game Masters with Function Calling\"\n- ArXiv: \"Static Vs. Agentic Game Master AI\"\n- ArXiv: \"Character-LLM: A Trainable Agent for Role-Playing\"\n- Medium: AI Prompt Engineering 101 for TTRPGs\n- GitHub: VirtualGameMaster, RPGGO examples\n\n**Code Changes:**\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/AdvancedPromptEngineering.java`\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/NarrativeValidator.java` (NEW)\n- `party-lore-ai/src/main/java/com/partylore/ai/config/ClaudeConfig.java`\n\n---\n\n## Additional MEDIUM-Priority Bugs (From AI_NARRATIVE_QUALITY_ISSUES.md)\n\nThree additional MEDIUM-severity bugs were discovered that are **NOT in the original CRITICAL-BUGS list**:\n\n### Issue #7: Repetitive Action-Response Loops ‚è∏Ô∏è **DEFERRED**\n**Severity:** MEDIUM (6 occurrences)\n**Status:** Added to FR-191 Phase 5 (TASK-191-013)\n**Why deferred:** Requires StructuredMemory architecture to track action history\n\n### Issue #8: Unclear Character Positioning ‚úÖ **FIXED WITH PROMPTS**\n**Severity:** MEDIUM (4 occurrences)\n**Status:** Prompt enhancement added to AdvancedPromptEngineering.java (lines 550-555)\n**Solution:** Added explicit spatial positioning guidance to multi-player prompts\n- \"Be explicit about where each character is positioned relative to others\"\n- Examples for together vs separated positioning\n- Maintain spatial consistency across turns\n**Database tracking deferred** to FR-191 Phase 5 (TASK-191-014) as optional enhancement\n\n### Issue #9: Player Coordination Ignored ‚úÖ **FIXED WITH PROMPTS**\n**Severity:** MEDIUM (3 occurrences)\n**Status:** Prompt enhancement added to AdvancedPromptEngineering.java (lines 557-564)\n**Solution:** Added coordination action guidance to multi-player prompts\n- Recognize formation requests (\"defensive triangle\", \"flank left/right\")\n- Show tactical advantages of formations\n- Acknowledge support actions (\"provide cover\", \"distract enemy\")\n**Mechanics XML tracking deferred** to FR-191 Phase 5 (TASK-191-015) as optional\n\n---\n\n**Last Updated:** 2025-01-09\n**Status:** Analysis Complete, Quick Wins + MEDIUM Fixes Staged, Full Architecture Specified\n**Next Review:** After testing and commit\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/CRITICAL-BUGS-AND-SOLUTIONS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "agent",
        "md",
        "test"
      ],
      "content_hash": "cabd3da5d3166aa5",
      "size_bytes": 20042,
      "created_at": "2026-01-02T20:42:12.434551"
    },
    {
      "doc_id": "local_party-lore_COMBAT-SYSTEM-FAILURE-ANALYSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/COMBAT-SYSTEM-FAILURE-ANALYSIS.md",
      "content": "# Combat System Failure Analysis\n**Expert RPG Game Designer Review**\n\n## Executive Summary: COMBAT IS COMPLETELY BROKEN\n\nYou are **100% correct**. The combat system is not functioning. After reviewing:\n- ‚úÖ Production logs (NO HP changes recorded)\n- ‚úÖ Codebase (infrastructure exists but not being used)\n- ‚úÖ AI prompts (examples exist but AI ignores them)\n- ‚úÖ Narrative patterns (AI skips combat, describes aftermath)\n\n**Finding:** The AI is **completely bypassing combat mechanics** and just narratively declaring enemies dead.\n\n---\n\n## Evidence from Production Logs\n\n### Log Analysis (logs.1762302044505.log):\n\n**What the narrative says:**\n```\n\"Bigdaddy wrenches his bloodied axe from the ground, the bandit's corpse still pinned beneath it\"\n\"Five dead bandits scattered around the camp\"\n\"Axle methodically checks his bowstring, scanning the forest edge\"\n```\n\n**What the mechanics say:**\n```\nApplying mechanics: progress=25, hp_changes=0, npc_changes=0\n```\n\n### Critical Finding:\n- **ZERO HP changes** in entire log file\n- **ZERO NPC status changes** (no ENGAGED ‚Üí DEFEATED transitions)\n- Bandits are described as \"dead\" but no combat actually occurred\n- No player took damage\n- No enemy took damage\n- Combat is entirely **narrative flavor** with zero mechanical implementation\n\n---\n\n## What SHOULD Have Happened\n\n### Proper Combat Sequence (RPG Standard):\n\n#### Turn 1: Bandit Ambush\n```\nNARRATIVE: \"Three bandits leap from the trees, blades drawn!\"\n\nMECHANICS:\n<hp_changes>\n  <change player_name=\"Bigdaddy\" delta=\"-5\">Bandit blade cuts shoulder</change>\n  <change player_name=\"Axle\" delta=\"-3\">Crossbow bolt grazes arm</change>\n</hp_changes>\n<npc_status_changes>\n  <change npc_name=\"Bandit Leader\" new_status=\"ENGAGED\" />\n  <change npc_name=\"Bandit Archer\" new_status=\"ENGAGED\" />\n  <change npc_name=\"Bandit Scout\" new_status=\"ENGAGED\" />\n</npc_status_changes>\n<progress_delta>10</progress_delta>\n<consequence>Ambushed by bandits</consequence>\n```\n\n#### Turn 2: Player Counterattack\n```\nPLAYER ACTION: \"I swing my axe at the bandit leader\"\n\nNARRATIVE: \"Your axe bites deep into the bandit's shoulder. He staggers but stays upright.\"\n\nMECHANICS:\n<progress_delta>15</progress_delta>\n<consequence>Bandit leader wounded</consequence>\n// NO scene_complete - combat continues!\n```\n\n#### Turn 3: Enemy Retaliation\n```\nNARRATIVE: \"The wounded bandit leader roars, slashing wildly at Bigdaddy!\"\n\nMECHANICS:\n<hp_changes>\n  <change player_name=\"Bigdaddy\" delta=\"-8\">Desperate bandit counterattack</change>\n</hp_changes>\n<progress_delta>5</progress_delta>\n<consequence>Fierce bandit resistance</consequence>\n```\n\n#### Turn 4: Final Blow\n```\nPLAYER ACTION: \"Finish him off with a heavy swing\"\n\nNARRATIVE: \"Your axe cleaves through his defenses. The bandit crumples.\"\n\nMECHANICS:\n<hp_changes>\n  <!-- Enemy \"HP\" represented by progress toward defeating them -->\n</hp_changes>\n<npc_status_changes>\n  <change npc_name=\"Bandit Leader\" new_status=\"DEFEATED\" />\n</npc_status_changes>\n<progress_delta>25</progress_delta>\n<consequence>Bandit leader defeated</consequence>\n<scene_complete>true</scene_complete>\n<completion_reason>All enemies defeated</completion_reason>\n```\n\n### What ACTUALLY Happened:\n\n#### Turn 1: Player says something\n```\nNARRATIVE: \"Five dead bandits scattered around camp\"\nMECHANICS: progress=25, hp_changes=0, npc_changes=0\n```\n\n**The bandits went from non-existent to dead with ZERO combat.**\n\n---\n\n## Root Cause Analysis\n\n### Why Is This Happening?\n\n#### 1. **AI Skips Combat Entirely (P0 - CRITICAL)**\n\n**Problem:** The AI treats combat as narrative background flavor rather than a mechanical system that requires multiple turns.\n\n**Evidence:**\n- Player says \"let's investigate the bandit camp\"\n- AI responds: \"...the bandits are already dead, let's loot them\"\n- NO combat turns occurred\n- NO HP changes\n- NO NPC status transitions (PRESENT ‚Üí ENGAGED ‚Üí DEFEATED)\n\n**Why:** The AI is optimizing for story progression, not tactical combat. It sees combat as \"boring\" and skips to \"interesting\" post-combat looting.\n\n---\n\n#### 2. **No NPC HP Tracking (P0 - CRITICAL)**\n\n**Evidence from Code:**\n```java\n// GameServiceImpl.java:1370-1371\nif (status == NPCStatus.PRESENT || status == NPCStatus.ENGAGED) {\n    String estimatedHp = (role == NPCRole.ENEMY) ? \"~15 HP\" : \"~30 HP\";\n    context.append(String.format(\", %s\", estimatedHp));\n}\n```\n\n**Problem:** NPC HP is \"estimated\" (~15 HP), not actually tracked!\n\n**Impact:**\n- AI has no way to know if an NPC is wounded vs fresh\n- No progression from \"healthy\" ‚Üí \"wounded\" ‚Üí \"defeated\"\n- Can't do \"you hit him twice and he's still standing\"\n- Combat becomes binary: alive or dead\n\n**This is like playing D&D with no monster HP - you just decide when they die.**\n\n---\n\n#### 3. **No Combat State Machine (P0 - CRITICAL)**\n\n**What's Missing:**\n- No \"COMBAT_ACTIVE\" game state\n- No turn-by-turn combat tracking\n- No initiative order\n- No \"you must defeat enemies before progressing\" enforcement\n\n**Current Behavior:**\n```\nPlayer: \"search the camp\"\nAI: \"you search the camp\" (no combat happens)\n```\n\n**Should Be:**\n```\nPlayer: \"search the camp\"\nAI: \"Three bandits block your path!\" (force combat)\nAI: \"You must deal with the bandits first\"\n(Combat initiated, cannot progress until resolved)\n```\n\n---\n\n#### 4. **Scene Progress = Combat Progress (FLAWED DESIGN)**\n\n**Current System:**\n- Scene has \"progress_percentage\" (0-100%)\n- Combat is just... progress toward scene completion?\n- No separate combat HP tracking\n\n**Problem:**\n- Progress represents \"how close to objective\" not \"how close to killing enemy\"\n- AI doesn't understand \"5 bandits at 15 HP each\" vs \"scene at 60% progress\"\n- Can't represent \"bandit wounded but alive\"\n\n**Example of Confusion:**\n```\nTurn 1: Hit bandit (+15 progress) ‚Üí scene at 15%\nTurn 2: Hit again (+15 progress) ‚Üí scene at 30%\nTurn 3: ??? ‚Üí AI says \"scene complete, enemy dead\"\n\nBut what about the OTHER 4 bandits???\n```\n\n---\n\n#### 5. **No Enforcement of hp_changes Block (P0 - CRITICAL)**\n\n**Evidence:** Prompt shows example with `<hp_changes>` but it's OPTIONAL.\n\n**Current Prompt:** (line 172)\n```\n- hp_changes: List all HP modifications\n  * Omit entire <hp_changes> block if no HP changes\n```\n\n**Problem:** AI reads \"optional\" and thinks \"I'll skip this because it's work.\"\n\n**The AI is taking the easy path: skip HP tracking entirely.**\n\n---\n\n## What Works vs What Doesn't\n\n### ‚úÖ What DOES Work:\n\n1. **HP Context Building** - Players' HP is shown to AI\n2. **HP Infrastructure** - Player.currentHp, Player.maxHp exist\n3. **HP Change Parsing** - MechanicsParser can extract HP changes from XML\n4. **HP Change Application** - MechanicsApplicationService can apply HP deltas\n5. **NPC Status Enum** - PRESENT, ENGAGED, DEFEATED exist\n6. **NPC Registry** - ActiveNPC entities tracked in database\n7. **Combat Prompt Examples** - Show proper combat mechanics\n\n### ‚ùå What DOESN'T Work:\n\n1. **AI Actually Generates HP Changes** - Never happens\n2. **AI Tracks Multi-Turn Combat** - Skips to \"enemies dead\"\n3. **NPC HP Tracking** - Only \"estimated\", not real\n4. **Combat Initiation** - No forced combat encounters\n5. **Combat State Machine** - No \"you're in combat now\" mode\n6. **Enemy Actions** - NPCs never attack players\n7. **Damage to Players** - Players take zero damage\n8. **Gradual Enemy Defeat** - No \"wounded but alive\" state\n\n---\n\n## Why Is This Happening? (Deep Analysis)\n\n### The AI's Perspective:\n\n**What the AI \"thinks\":**\n```\nUser says: \"I attack the bandits\"\n\nAI reasoning:\n1. Combat is slow and boring for players\n2. Players want to get to the loot/story\n3. I'll be helpful and skip the tedious combat\n4. \"Five bandits lie dead\" - done! Moving on!\n```\n\n**What the AI SHOULD think:**\n```\nUser says: \"I attack the bandits\"\n\nAI reasoning:\n1. Combat initiated - this is a MECHANICAL SYSTEM\n2. Must track HP for each combatant\n3. Combat continues until:\n   - All enemies DEFEATED\n   - Players FLEE\n   - Scene objective complete\n4. Each turn: narrate action, deal damage, track HP\n5. CANNOT skip to \"everyone's dead\" - must play it out\n```\n\n### Why the AI Takes the Easy Path:\n\n1. **Lack of Strong Constraint**\n   - HP changes are \"optional\" in prompt\n   - No enforcement that combat = must do HP changes\n   - AI optimizes for \"get to interesting part\"\n\n2. **No Feedback Loop**\n   - AI never sees \"WRONG! You skipped combat\"\n   - No punishment for skipping HP mechanics\n   - Post-processing doesn't catch \"zero HP changes in combat scene\"\n\n3. **Scene Completion Incentive**\n   - AI rewarded for progressing scene\n   - Combat = slow progress\n   - Declaring \"bandits dead\" = fast progress\n   - AI chooses fast progress\n\n4. **No Combat State Tracking**\n   - System doesn't know \"you're in combat now\"\n   - No enforcement of \"combat rules apply\"\n   - AI treats combat as optional narrative flavor\n\n---\n\n## Critical Gaps in System Design\n\n### 1. No Combat Encounter System\n\n**Missing:**\n```java\npublic class CombatEncounter {\n    UUID id;\n    List<CombatParticipant> combatants;\n    CombatState state; // INITIATED, ACTIVE, RESOLVED\n    int currentRound;\n\n    boolean canEndCombat() {\n        return allEnemiesDefeated() || allPlayersFled();\n    }\n}\n\npublic class CombatParticipant {\n    String name;\n    boolean isPlayer;\n    int currentHp;\n    int maxHp;\n    CombatantStatus status; // HEALTHY, WOUNDED, CRITICAL, DEFEATED\n}\n```\n\n**Impact:** No way to track \"we're in combat and must resolve it\"\n\n---\n\n### 2. No NPC Health Pool System\n\n**Missing:**\n```java\npublic class ActiveNPC {\n    // Existing fields...\n    Integer currentHp;  // ‚Üê MISSING!\n    Integer maxHp;      // ‚Üê MISSING!\n\n    public boolean isDefeated() {\n        return currentHp != null && currentHp <= 0;\n    }\n\n    public String getHealthStatus() {\n        if (currentHp == null) return \"Unknown\";\n        if (currentHp >= maxHp * 0.75) return \"Healthy\";\n        if (currentHp >= maxHp * 0.40) return \"Wounded\";\n        if (currentHp > 0) return \"Critical\";\n        return \"Defeated\";\n    }\n}\n```\n\n**Impact:** Can't represent \"bandit at 8/15 HP\" - only \"bandit alive\" or \"bandit dead\"\n\n---\n\n### 3. No Combat Validation in Post-Processing\n\n**Missing Check:**\n```java\n// In Tier1PostProcessor\nprivate ParsedMechanics validateCombatMechanics(ParsedMechanics m, GameContext ctx) {\n    // Check: If active combat, MUST have HP changes\n    if (hasActiveCombatants(ctx) && m.getHpChanges().isEmpty()) {\n        log.error(\"‚ö†Ô∏è COMBAT FAILURE: Active enemies but AI skipped HP changes!\");\n\n        // Force HP changes for player action\n        HpChange combatDamage = new HpChange(\n            getPlayerWhoActed(ctx),\n            -5, // Default enemy damage\n            \"Enemy counterattack\"\n        );\n        m.getHpChanges().add(combatDamage);\n    }\n\n    // Check: Combat can't complete with enemies alive\n    if (m.isSceneComplete() && hasActiveCombatants(ctx)) {\n        log.error(\"‚ö†Ô∏è COMBAT FAILURE: AI completed scene with active enemies!\");\n        m.setSceneComplete(false);\n    }\n\n    return m;\n}\n```\n\n---\n\n### 4. No Strong Combat Prompt Constraints\n\n**Current Prompt:** (too permissive)\n```\n- hp_changes: List all HP modifications\n  * Omit entire <hp_changes> block if no HP changes\n```\n\n**Should Be:**\n```\n- hp_changes: REQUIRED IN COMBAT\n  * IF any enemies are ENGAGED, you MUST output HP changes\n  * Combat is a MECHANICAL SYSTEM, not narrative flavor\n  * Each combat round MUST include:\n    - Player takes damage from enemies (unless dodging/defending)\n    - Enemies take damage from player actions\n  * NEVER skip to \"enemies are all dead\" - show the fight\n  * Example: Even if player says \"I kill them all\", narrate it step-by-step with HP\n  * Omit only if NO combat is occurring (social, exploration, travel scenes)\n```\n\n---\n\n## Impact on Game Experience\n\n### What Players Experience:\n\n**Current (Broken) Experience:**\n```\nPlayer: \"I attack the bandits\"\nGM: \"Your axe cleaves through them. They're all dead. What's next?\"\nPlayer: \"...that was anticlimactic\"\n```\n\n**Players feel:**\n- ‚ùå No challenge\n- ‚ùå No risk\n- ‚ùå No tension\n- ‚ùå No tactical decisions\n- ‚ùå \"Why does my HP even matter?\"\n- ‚ùå \"I just tell it I win and I win\"\n\n**Expected (Working) Experience:**\n```\nPlayer: \"I attack the bandit leader\"\nGM: \"Your axe bites deep! He staggers (HP: 7/15).\n     The archer fires - arrow grazes your arm! (HP: 17/20)\"\nPlayer: \"Oh crap, I'm taking damage. I need to be strategic.\"\nPlayer: \"I'll focus on the archer next turn\"\n```\n\n**Players feel:**\n- ‚úÖ Challenge\n- ‚úÖ Risk of failure\n- ‚úÖ Tactical decisions matter\n- ‚úÖ HP management important\n- ‚úÖ Victories are earned\n\n### Severity: **GAME-BREAKING**\n\nThis isn't a minor bug. This is the **core combat system not functioning**.\n\nIn an RPG:\n- Combat is 40-60% of gameplay\n- HP/damage is fundamental mechanic\n- Without working combat, it's just interactive fiction\n- Players have zero mechanical engagement\n\n---\n\n## Recommended Fixes (Priority Order)\n\n### P0 - EMERGENCY FIXES (Do This Week):\n\n#### 1. Add Combat Validation to Post-Processing\n```java\n// Detect combat scenarios and enforce HP changes\nif (hasHostileNPCs(gameContext) && hpChanges.isEmpty()) {\n    log.error(\"‚ö†Ô∏è COMBAT FAILURE: Hostile NPCs but no HP changes!\");\n    // Force default combat damage\n    addDefaultCombatDamage(mechanics, gameContext);\n}\n```\n\n#### 2. Make HP Changes MANDATORY in Combat Prompt\n```\n‚ö†Ô∏è **CRITICAL: COMBAT MECHANICS** ‚ö†Ô∏è\nIf ANY enemies are ENGAGED status, this IS a combat scene.\nCombat scenes REQUIRE:\n- <hp_changes> block with AT LEAST one entry\n- Players take damage from enemies (unless explicitly defending)\n- Enemies take damage from player attacks\n- NEVER skip combat - narrate each exchange\n```\n\n#### 3. Add NPC HP Tracking\n```sql\nALTER TABLE active_npcs ADD COLUMN current_hp INTEGER;\nALTER TABLE active_npcs ADD COLUMN max_hp INTEGER;\n\n-- Default HP by role\nUPDATE active_npcs SET\n    current_hp = CASE role\n        WHEN 'ENEMY' THEN 15\n        WHEN 'BOSS' THEN 50\n        ELSE 30 END,\n    max_hp = current_hp\nWHERE current_hp IS NULL;\n```\n\n#### 4. Show NPC HP in Context\n```java\n// Instead of \"~15 HP\" (estimated), show actual HP\ncontext.append(String.format(\"‚Ä¢ [NPC] %s: %s, HP: %d/%d\",\n    name, status, npc.getCurrentHp(), npc.getMaxHp()));\n```\n\n---\n\n### P1 - CRITICAL FIXES (Do Next Sprint):\n\n#### 5. Add Combat State to GameSession\n```java\npublic enum CombatState {\n    NO_COMBAT,\n    COMBAT_INITIATED,\n    COMBAT_ACTIVE,\n    COMBAT_RESOLVED\n}\n\n// In GameSession\nprivate CombatState combatState = CombatState.NO_COMBAT;\n```\n\n#### 6. Force Combat Resolution\n```java\n// Post-processing check\nif (session.getCombatState() == CombatState.COMBAT_ACTIVE) {\n    if (mechanics.isSceneComplete() && hasLivingEnemies(session)) {\n        log.error(\"‚ö†Ô∏è Can't complete scene - enemies still alive!\");\n        mechanics.setSceneComplete(false);\n    }\n}\n```\n\n#### 7. Add Combat Round Tracking\n```java\n// Track combat progression\npublic class CombatTracker {\n    int roundNumber;\n    Map<String, Integer> participantHp;\n\n    boolean shouldEnemiesAttack() {\n        // Enemies attack every round unless player is defending\n        return true;\n    }\n}\n```\n\n---\n\n### P2 - SYSTEM REDESIGN (Do Later):\n\n#### 8. Full Combat Encounter System\n- Separate combat encounters from scenes\n- Track initiative order\n- Multi-enemy combat (fight 3 bandits separately)\n- Tactical options (defend, flee, special attacks)\n\n#### 9. Enemy AI Behavior\n- Enemies choose targets intelligently\n- Wounded enemies might flee\n- Boss enemies have special abilities\n\n#### 10. Advanced Combat Mechanics\n- Critical hits\n- Armor/defense values\n- Status effects (poisoned, stunned, etc.)\n- Multi-turn abilities\n\n---\n\n## Immediate Action Items\n\n**To fix combat THIS WEEK:**\n\n1. **Add combat validation to Tier1PostProcessor**\n   - Detect hostile NPCs ‚Üí enforce HP changes\n   - Prevent scene completion with active enemies\n\n2. **Strengthen combat prompt constraints**\n   - Make `<hp_changes>` mandatory in combat\n   - Add explicit \"NEVER skip combat\" instruction\n   - Add enemy attack examples\n\n3. **Add NPC HP columns to database**\n   - `current_hp INTEGER`\n   - `max_hp INTEGER`\n   - Populate with defaults\n\n4. **Show real NPC HP in context**\n   - Replace \"~15 HP\" with actual values\n   - Let AI see \"Bandit: 8/15 HP (wounded)\"\n\n5. **Add metrics to monitor combat**\n   - `combat.hp_changes.count`\n   - `combat.skipped.count`\n   - Alert if combat skipped > 5%\n\n---\n\n## Testing Strategy\n\n### Test Scenario 1: Basic Combat\n```\nSetup: Create scene with 1 hostile bandit (15 HP)\nPlayer Action: \"I attack the bandit\"\nExpected:\n  - HP change for player (enemy attacks back)\n  - Progress toward scene completion\n  - Scene NOT complete (bandit still alive)\n```\n\n### Test Scenario 2: Multi-Turn Combat\n```\nSetup: Bandit at 15 HP\nTurn 1: \"I swing my axe\" ‚Üí Bandit at 8 HP\nTurn 2: \"I swing again\" ‚Üí Bandit at 1 HP\nTurn 3: \"Finishing blow\" ‚Üí Bandit DEFEATED, scene complete\n```\n\n### Test Scenario 3: Player Takes Damage\n```\nSetup: Bandit attacks back each turn\nTurn 1: Player HP 20/20 ‚Üí 17/20 (took 3 damage)\nTurn 2: Player HP 17/20 ‚Üí 12/20 (took 5 damage)\nVerify: Player HP actually decreases\n```\n\n---\n\n## Conclusion\n\n**You are 100% correct:** Combat is completely broken.\n\n**Root Cause:** AI treats combat as narrative background, skips mechanical implementation entirely.\n\n**Evidence:**\n- ZERO HP changes in production logs\n- Enemies described as \"dead\" with no combat\n- Players take zero damage\n- No multi-turn combat sequences\n\n**Impact:** Game has no mechanical combat system - just \"I say I win, I win\"\n\n**Fix Priority:** P0 - EMERGENCY\n\n**Estimated Effort:**\n- Emergency fixes (validation + prompt): 1-2 days\n- Critical fixes (NPC HP tracking): 3-4 days\n- Full system redesign: 2-3 weeks\n\nThe good news: **All the infrastructure exists** (HP tracking, mechanics parser, etc.) - it's just not being used. We can fix this quickly by **forcing the AI to use it** via validation and stronger prompts.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/COMBAT-SYSTEM-FAILURE-ANALYSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "example",
        "function",
        "md"
      ],
      "content_hash": "80f2ddce187d1ccf",
      "size_bytes": 17926,
      "created_at": "2026-01-02T20:42:12.434657"
    },
    {
      "doc_id": "local_party-lore_TIER1-POST-PROCESSING-RECOMMENDATIONS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/TIER1-POST-PROCESSING-RECOMMENDATIONS.md",
      "content": "# Tier 1 Post-Processing Validation Recommendations\n\n## Executive Summary\n\nYou're absolutely right - the scene completion bug we missed is a perfect example of why we need comprehensive post-processing validation. The Tier 1 post-processing step (between AI mechanics generation and mechanics application) is the **perfect chokepoint** to enforce game rules and catch AI mistakes.\n\n## Current State\n\n**What We Have:**\n- Tier 1 generates mechanics XML (progress, HP changes, NPC status, scene completion, etc.)\n- ParsedMechanics extracted from XML\n- **ONE failsafe check**: Scene progress 100% override\n\n**What We're Missing:**\n- Systematic validation of ALL mechanics attributes\n- Game rule enforcement (HP bounds, death handling, etc.)\n- Logical consistency checks (resurrected NPCs, impossible progress, etc.)\n- Safety guardrails to prevent broken game states\n\n---\n\n## CRITICAL Validations We Should Add\n\n### 1. **HP Change Validation (P0 - CRITICAL)**\n\n**Problem:** AI can accidentally kill players or create impossible HP states.\n\n**Current Risk:**\n- AI might deal 50 damage to a player with 5 HP\n- No validation of HP changes against current HP\n- Death not properly handled (TODO comment at MechanicsApplicationService.java:156)\n- AI could heal beyond max HP\n\n**Recommended Checks:**\n```java\nfor (HpChange change : proposedMechanics.getHpChanges()) {\n    Player player = findPlayer(change.getPlayerName());\n    int currentHp = player.getCurrentHp();\n    int maxHp = player.getMaxHp();\n    int proposedNewHp = currentHp + change.getDelta();\n\n    // CRITICAL: Prevent accidental player death\n    if (proposedNewHp <= 0 && currentHp > 5) {\n        log.warn(\"‚ö†Ô∏è FAILSAFE: AI dealt {} damage to {} (current HP: {}) - would kill player! Capping damage.\",\n                -change.getDelta(), player.getName(), currentHp);\n        // Cap damage to leave player at 1 HP instead of death\n        change.setDelta(-(currentHp - 1));\n    }\n\n    // CRITICAL: Prevent HP > maxHp\n    if (proposedNewHp > maxHp) {\n        log.warn(\"‚ö†Ô∏è FAILSAFE: AI healed {} to {} HP (max: {}) - capping to max\",\n                player.getName(), proposedNewHp, maxHp);\n        change.setDelta(maxHp - currentHp);\n    }\n\n    // CRITICAL: Handle intentional death\n    if (proposedNewHp <= 0) {\n        log.warn(\"ü™¶ PLAYER DEATH DETECTED: {} HP: {} -> {}\",\n                player.getName(), currentHp, proposedNewHp);\n        // Force scene completion for death?\n        // Trigger resurrection mechanics?\n        // This needs design decision\n    }\n}\n```\n\n**Impact:** Prevents accidental player deaths, broken HP states\n\n**Priority:** P0 - CRITICAL (players dying accidentally would ruin game experience)\n\n---\n\n### 2. **Progress Delta Bounds Checking (P1 - HIGH)**\n\n**Problem:** AI can output impossible progress values.\n\n**Current Risk:**\n- AI might output progress_delta of 200\n- Negative progress could go below 0%\n- Progress > 100% after addition\n\n**Recommended Checks:**\n```java\nint progressDelta = proposedMechanics.getProgressDelta();\nint currentProgress = scene.getProgressPercentage();\nint newProgress = currentProgress + progressDelta;\n\n// Validate delta is reasonable (-100 to +100)\nif (progressDelta > 100 || progressDelta < -100) {\n    log.warn(\"‚ö†Ô∏è FAILSAFE: AI output invalid progress_delta: {} - capping to reasonable range\",\n            progressDelta);\n    progressDelta = Math.max(-100, Math.min(100, progressDelta));\n}\n\n// Prevent progress < 0%\nif (newProgress < 0) {\n    log.warn(\"‚ö†Ô∏è FAILSAFE: Progress would go negative ({}) - setting to 0%\", newProgress);\n    progressDelta = -currentProgress; // Set to exactly 0%\n}\n\n// Cap progress at 100% (already handled by application logic, but validate here too)\nif (newProgress > 100) {\n    log.info(\"Progress capped at 100% (was: {})\", newProgress);\n    progressDelta = 100 - currentProgress;\n}\n```\n\n**Impact:** Prevents broken progress states, ensures 0-100% bounds\n\n**Priority:** P1 - HIGH\n\n---\n\n### 3. **NPC Resurrection Prevention (P0 - CRITICAL)**\n\n**Problem:** AI resurrects defeated NPCs (we added prompt warning, but no code validation).\n\n**Current Risk:**\n- NPC marked DEFEATED in turn 5\n- AI marks same NPC as ENGAGED in turn 10\n- Players see \"dead\" enemies attacking them again (immersion breaking)\n\n**Recommended Checks:**\n```java\n// Load defeated/fled NPCs from database\nSet<String> defeatedNpcs = getDefeatedNpcNames(scene);\nSet<String> fledNpcs = getFledNpcNames(scene);\n\nfor (NpcStatusChange change : proposedMechanics.getNpcStatusChanges()) {\n    String npcName = change.getNpcName();\n    NPCStatus newStatus = change.getNewStatus();\n\n    // CRITICAL: Prevent resurrection of defeated NPCs\n    if (defeatedNpcs.contains(npcName) &&\n        (newStatus == NPCStatus.ENGAGED || newStatus == NPCStatus.PRESENT)) {\n\n        log.error(\"‚ö†Ô∏è FAILSAFE BLOCKED: AI tried to resurrect defeated NPC: {}\", npcName);\n        log.error(\"  Attempted status: {} -> {}\", \"DEFEATED\", newStatus);\n\n        // REMOVE this status change entirely\n        proposedMechanics.getNpcStatusChanges().remove(change);\n\n        // Log for monitoring\n        metrics.incrementCounter(\"ai.npc.resurrection.blocked\");\n    }\n\n    // Same for FLED NPCs returning (less critical but still weird)\n    if (fledNpcs.contains(npcName) && newStatus == NPCStatus.ENGAGED) {\n        log.warn(\"‚ö†Ô∏è NOTICE: Fled NPC {} is becoming ENGAGED - may be intentional return\", npcName);\n        // Don't block, but log for review\n    }\n}\n```\n\n**Impact:** Prevents immersion-breaking NPC resurrections\n\n**Priority:** P0 - CRITICAL (we just saw this bug in production logs!)\n\n---\n\n### 4. **Scene Completion Logic Validation (P0 - CRITICAL)**\n\n**Problem:** Scene completion doesn't match progress state (we just fixed this, but can improve).\n\n**Current Fix:** We check progress >= 100%\n\n**Additional Validations:**\n```java\nboolean sceneComplete = proposedMechanics.isSceneComplete();\nString completionReason = proposedMechanics.getCompletionReason();\nint currentProgress = scene.getProgressPercentage();\n\n// Already have: Override if progress >= 100%\nif (!sceneComplete && currentProgress >= 100) {\n    // ... existing failsafe\n}\n\n// NEW: Validate completion_reason provided when scene_complete=true\nif (sceneComplete && (completionReason == null || completionReason.equals(\"None\"))) {\n    log.warn(\"‚ö†Ô∏è AI set scene_complete=true but no completion_reason - adding default\");\n    completionReason = \"Scene objective achieved\";\n}\n\n// NEW: Validate scene can't complete with low progress\nif (sceneComplete && currentProgress < 70) {\n    log.warn(\"‚ö†Ô∏è QUESTIONABLE: AI completed scene at only {}% progress - review needed\",\n            currentProgress);\n    // Don't block, but flag for review\n    metrics.incrementCounter(\"ai.scene.early_completion\");\n}\n\n// NEW: Auto-complete if progress would exceed 100%\nint newProgress = currentProgress + proposedMechanics.getProgressDelta();\nif (!sceneComplete && newProgress >= 100) {\n    log.info(\"‚úì Auto-completing scene - progress will reach {}%\", newProgress);\n    sceneComplete = true;\n    completionReason = \"Scene objective completed - progress reached 100%\";\n}\n```\n\n**Impact:** Ensures scene completion is logically consistent\n\n**Priority:** P0 - CRITICAL\n\n---\n\n### 5. **Location Change Validation (P2 - MEDIUM)**\n\n**Problem:** AI can teleport players to nonsensical locations.\n\n**Current Risk:**\n- AI outputs location \"The Moon\" when players are in a medieval dungeon\n- Location changes without narrative justification\n- Inconsistent location naming\n\n**Recommended Checks:**\n```java\nString newLocation = proposedMechanics.getLocationChange();\nString currentLocation = scene.getCurrentLocation();\n\nif (newLocation != null && !newLocation.equals(\"None\") && !newLocation.equals(currentLocation)) {\n    log.info(\"Location change detected: {} -> {}\", currentLocation, newLocation);\n\n    // Validate location change makes narrative sense\n    // (Could maintain a graph of valid location transitions)\n\n    // For now, just log for monitoring\n    metrics.incrementCounter(\"game.location.change\");\n\n    // Future: Validate against location graph\n    // if (!isValidLocationTransition(currentLocation, newLocation)) {\n    //     log.warn(\"‚ö†Ô∏è QUESTIONABLE: Unlikely location transition\");\n    // }\n}\n```\n\n**Impact:** Prevents nonsensical teleportation\n\n**Priority:** P2 - MEDIUM (less critical, but improves coherence)\n\n---\n\n### 6. **Progress Delta Reasonableness (P1 - HIGH)**\n\n**Problem:** AI can give too much or too little progress for actions.\n\n**Current Risk:**\n- Player says \"I look around\" ‚Üí AI gives +50 progress\n- Player defeats final boss ‚Üí AI gives +5 progress\n- Progress not matching narrative significance\n\n**Recommended Checks:**\n```java\nint progressDelta = proposedMechanics.getProgressDelta();\nString consequence = proposedMechanics.getConsequence();\n\n// Detect if progress seems mismatched with narrative\nif (progressDelta > 50) {\n    log.warn(\"‚ö†Ô∏è LARGE PROGRESS: +{} - consequence: '{}'\", progressDelta, consequence);\n    // Could cap extreme values\n    // progressDelta = Math.min(50, progressDelta);\n}\n\nif (progressDelta == 0 && !consequence.isEmpty()) {\n    log.debug(\"Zero progress but has consequence: '{}'\", consequence);\n    // This might be fine (e.g., setbacks, flavor actions)\n}\n\n// Validate major consequences have progress\nif (consequence.toLowerCase().contains(\"defeated\") && progressDelta < 10) {\n    log.warn(\"‚ö†Ô∏è QUESTIONABLE: Defeated enemy but only +{} progress\", progressDelta);\n}\n```\n\n**Impact:** Ensures progress matches narrative importance\n\n**Priority:** P1 - HIGH\n\n---\n\n### 7. **Consequence Text Validation (P3 - LOW)**\n\n**Problem:** Consequence text quality/format issues.\n\n**Recommended Checks:**\n```java\nString consequence = proposedMechanics.getConsequence();\n\nif (consequence != null) {\n    // Validate length (shown to players)\n    if (consequence.length() > 100) {\n        log.warn(\"‚ö†Ô∏è Consequence too long ({} chars) - truncating\", consequence.length());\n        consequence = consequence.substring(0, 97) + \"...\";\n    }\n\n    // Validate it's actually descriptive\n    if (consequence.trim().isEmpty() && progressDelta != 0) {\n        log.warn(\"‚ö†Ô∏è Empty consequence despite progress change\");\n        consequence = \"Progress made\";\n    }\n}\n```\n\n**Impact:** Better player-facing text\n\n**Priority:** P3 - LOW\n\n---\n\n## ADDITIONAL Game Logic Validations\n\n### 8. **Party Wipe Detection (P1 - HIGH)**\n\n```java\n// Check if all players would die from HP changes\nint playersAtRisk = 0;\nfor (Player player : session.getPlayers()) {\n    HpChange change = findHpChangeForPlayer(player, proposedMechanics);\n    if (change != null) {\n        int newHp = player.getCurrentHp() + change.getDelta();\n        if (newHp <= 0) playersAtRisk++;\n    }\n}\n\nif (playersAtRisk >= session.getPlayers().size()) {\n    log.error(\"‚ö†Ô∏è PARTY WIPE IMMINENT: All {} players would die!\", playersAtRisk);\n    // Force scene completion? Trigger special death scene?\n    // This needs design decision\n}\n```\n\n---\n\n### 9. **Duplicate NPC Names (P2 - MEDIUM)**\n\n```java\n// Check for duplicate NPC names in status changes\nSet<String> npcNames = new HashSet<>();\nfor (NpcStatusChange change : proposedMechanics.getNpcStatusChanges()) {\n    if (!npcNames.add(change.getNpcName())) {\n        log.warn(\"‚ö†Ô∏è DUPLICATE: NPC '{}' appears multiple times in status changes\",\n                change.getNpcName());\n        // Keep only the last status change for this NPC\n    }\n}\n```\n\n---\n\n### 10. **Player Name Validation (P1 - HIGH)**\n\n```java\n// Validate HP changes reference real players\nSet<String> validPlayerNames = session.getPlayers().stream()\n        .map(Player::getCharacterName)\n        .collect(Collectors.toSet());\n\nfor (HpChange change : proposedMechanics.getHpChanges()) {\n    if (!validPlayerNames.contains(change.getPlayerName())) {\n        log.error(\"‚ö†Ô∏è INVALID PLAYER: HP change for '{}' but player doesn't exist\",\n                change.getPlayerName());\n        // Remove this HP change\n        proposedMechanics.getHpChanges().remove(change);\n    }\n}\n```\n\n---\n\n## Implementation Architecture\n\n### Recommended Structure\n\n```java\npublic class Tier1PostProcessor {\n\n    public ParsedMechanics validate(ParsedMechanics mechanics, GameContext context) {\n        ParsedMechanics validated = mechanics;\n\n        // Run all validations in order\n        validated = validateSceneCompletion(validated, context);\n        validated = validateHpChanges(validated, context);\n        validated = validateProgressDelta(validated, context);\n        validated = validateNpcStatusChanges(validated, context);\n        validated = validateLocationChange(validated, context);\n        validated = validatePlayerNames(validated, context);\n\n        // Return corrected mechanics\n        return validated;\n    }\n\n    private ParsedMechanics validateSceneCompletion(ParsedMechanics m, GameContext ctx) {\n        // ... scene completion logic\n    }\n\n    private ParsedMechanics validateHpChanges(ParsedMechanics m, GameContext ctx) {\n        // ... HP validation logic\n    }\n\n    // ... etc\n}\n```\n\n### Integration Point\n\nIn `TwoTierNarrativeService.java` after line 132:\n\n```java\n// Parse mechanics\nParsedMechanics proposedMechanics = mechanicsParser.parse(mechanicsXml);\n\n// POST-PROCESSING: Validate and correct mechanics\nproposedMechanics = tier1PostProcessor.validate(proposedMechanics, gameContext);\n\n// Continue with validated mechanics...\n```\n\n---\n\n## Priority Recommendations\n\n### Ship Immediately (P0):\n1. **HP Change Validation** - Prevent accidental player deaths\n2. **NPC Resurrection Prevention** - Already saw this bug in production\n3. **Scene Completion at 100%** - Already implemented, but document properly\n\n### Ship Next Sprint (P1):\n4. **Progress Delta Bounds** - Prevent impossible values\n5. **Player Name Validation** - Prevent crashes from invalid references\n6. **Party Wipe Detection** - Handle total party kills gracefully\n\n### Nice to Have (P2-P3):\n7. **Location Change Validation**\n8. **Consequence Text Quality**\n9. **Progress Reasonableness Heuristics**\n\n---\n\n## Monitoring & Metrics\n\nAdd metrics for each failsafe activation:\n- `ai.scene.completion.override` - How often we fix 100% bug\n- `ai.hp.death.prevented` - Accidental deaths blocked\n- `ai.npc.resurrection.blocked` - Resurrected NPCs caught\n- `ai.progress.invalid` - Out-of-bounds progress values\n- `ai.player.invalid_reference` - Invalid player names\n\nThis helps us:\n1. Monitor AI reliability\n2. Identify patterns in AI mistakes\n3. Improve prompts where AI consistently fails\n4. Justify keeping failsafes vs removing them\n\n---\n\n## Testing Strategy\n\n**Unit Tests:**\n- Test each validation with edge cases\n- Verify failsafes activate correctly\n- Ensure valid mechanics pass through unchanged\n\n**Integration Tests:**\n- Test with real AI responses (record/replay)\n- Verify game doesn't break with corrected mechanics\n- Check metrics are emitted correctly\n\n**Production Monitoring:**\n- Alert on failsafe activation rates > 5%\n- Review logs when unusual patterns detected\n- A/B test prompt improvements vs failsafe reliance\n\n---\n\n## Conclusion\n\nThe scene completion bug is a **perfect example** of why post-processing is critical. We have:\n- **9 more validation opportunities** identified\n- **Clear priority levels** (P0 ‚Üí P3)\n- **Specific implementation guidance**\n- **Monitoring strategy** to track effectiveness\n\nThis transforms the post-processing step from \"one ad-hoc check\" into a **systematic validation layer** that enforces game rules and catches AI mistakes before they break gameplay.\n\n**The key insight:** Don't just trust the AI to follow prompts. **Validate and enforce game rules programmatically** at the chokepoint between AI generation and mechanics application.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/TIER1-POST-PROCESSING-RECOMMENDATIONS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "example",
        "md"
      ],
      "content_hash": "902f1b03dccda4a4",
      "size_bytes": 15754,
      "created_at": "2026-01-02T20:42:12.434811"
    },
    {
      "doc_id": "local_party-lore_FIXES-SUMMARY",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/FIXES-SUMMARY.md",
      "content": "# Fixes Summary - Session Continuation\n\n**Date**: 2025-11-09\n**Context**: Continuation session after arc generation timeout crash\n\n## What Was Done\n\n### 1. ‚úÖ Completed All 3 FR-192 Tasks\n\nFrom previous session continuation:\n\n1. **Deleted party-lore-console module** (21 files, ~700 LOC)\n   - Module was obsolete (AI players disabled, no autonomous testing)\n   - Updated root `pom.xml` to remove module references\n   - Reason: Web app provides superior dev experience\n\n2. **Updated FR-192 specification**\n   - Added \"Development Testing Challenges\" section\n   - Documented why console failed vs. web app advantages\n   - Updated implementation phases to prioritize dev testing MVP\n\n3. **Created FR-192 Phase 1 Implementation Plan**\n   - File: `.specify/planning/fr-192-phase1-implementation-plan.md`\n   - 700+ line comprehensive plan for basic read-only dashboard\n   - Week 1: Simple dashboard with REST API\n   - Week 2: AI player spawning capability\n\n### 2. ‚úÖ Fixed Arc Generation Timeout (Critical Bug)\n\n**Problem**: Game crashed during arc generation, left in broken state\n\n**Root Cause**: Claude API timeout (30s) too short for complex arc prompts\n\n**Fixes Applied**:\n\n#### Fix A: Increased Timeout (30s ‚Üí 90s)\n- **File**: `party-lore-app/src/main/resources/application.yml:101`\n- **Change**: `timeout: ${CLAUDE_TIMEOUT:90s}`\n- **Rationale**: Arc generation needs 45-60s, 90s provides buffer\n\n#### Fix B: Reset Broken Game\n- **SQL Script**: `fix-broken-game.sql`\n- **Executed**: Reset game `193eebf4-d0c2-4dc4-82d7-6f9baddf4f04` from ACTIVE ‚Üí RECRUITING\n- **Result**: ‚úÖ Game ready to restart with `!begin` SMS\n\n#### Fix C: Added Retry Logic\n- **File**: `party-lore-ai/src/main/java/com/partylore/ai/story/ArcGenerationService.java`\n- **Modified Methods**: `generateFirstArc()` and `generateNextArc()`\n- **Added**: 3 retry attempts with exponential backoff (2s, 4s, 8s)\n- **Logic**: Only retries on timeout errors, logs each attempt\n- **Benefit**: Automatic recovery from transient Claude API slowness\n\n## Files Modified\n\n### Code Changes\n1. `party-lore-app/src/main/resources/application.yml` - Timeout 90s\n2. `party-lore-ai/src/main/java/com/partylore/ai/story/ArcGenerationService.java` - Retry logic\n3. `pom.xml` - Removed console module\n\n### Specification Changes\n4. `.specify/requirements/fr-192-session-aware-web-application.md` - Dev testing section\n5. `.specify/planning/fr-192-phase1-implementation-plan.md` - Implementation plan (NEW)\n\n### Documentation\n6. `ARC-GENERATION-TIMEOUT-FIX.md` - Complete timeout fix documentation (NEW)\n7. `fix-broken-game.sql` - SQL repair script (NEW)\n\n### Deletions\n8. Entire `party-lore-console/` directory (21 files)\n9. `cleanup-corrupted-session.sql` (old cleanup script)\n10. `cleanup-roxy-session.sql` (old cleanup script)\n\n## Current Status\n\n### ‚úÖ Completed\n- [x] SQL fix executed - broken game reset to RECRUITING\n- [x] Timeout increased to 90s\n- [x] Retry logic added to arc generation\n- [x] All changes staged in git\n\n### üîÑ Ready for Deployment\n- [ ] Commit and push changes\n- [ ] Railway auto-deploys\n- [ ] Send `!begin` SMS to restart fixed game\n- [ ] Monitor logs for successful arc generation\n\n## How Retry Logic Works\n\n### Scenario 1: First Attempt Succeeds\n```\nAttempt 1/3: Claude API responds in 45s ‚Üí ‚úÖ Success\nArc created, game continues normally\n```\n\n### Scenario 2: Timeout with Retry\n```\nAttempt 1/3: Timeout after 90s ‚Üí ‚è≥ Retry in 2s\nAttempt 2/3: Timeout after 90s ‚Üí ‚è≥ Retry in 4s\nAttempt 3/3: Success in 60s ‚Üí ‚úÖ Arc created\nGame continues after brief delay\n```\n\n### Scenario 3: Persistent Timeout\n```\nAttempt 1/3: Timeout after 90s ‚Üí ‚è≥ Retry in 2s\nAttempt 2/3: Timeout after 90s ‚Üí ‚è≥ Retry in 4s\nAttempt 3/3: Timeout after 90s ‚Üí ‚ùå Throw ArcGenerationException\nGame fails to start (logged for investigation)\n```\n\n**Key Improvement**: Option 2 now succeeds instead of immediately failing like before!\n\n## Testing Instructions\n\n### 1. Restart Fixed Game\n```bash\n# Game is now RECRUITING - send SMS to restart\n# From your phone: !begin\n```\n\n### 2. Monitor Logs for Arc Generation\n```bash\nrailway logs --tail 100\n```\n\n**Look for these patterns**:\n```\n‚úÖ GOOD:\n\"Arc generation attempt 1/3 for session...\"\n\"Successfully generated arc for session ... on attempt 1\"\n\n‚ö†Ô∏è RETRY:\n\"Arc generation timeout on attempt 1/3, retrying in 2000ms\"\n\"Successfully generated arc for session ... on attempt 2\"\n\n‚ùå BAD (investigate):\n\"Arc generation failed after 3 attempts\"\n```\n\n### 3. Verify Game State\n```bash\necho \"SELECT id, name, status, current_scene_id FROM game_sessions WHERE id = '193eebf4-d0c2-4dc4-82d7-6f9baddf4f04';\" | railway connect Postgres-FuND\n```\n\nExpected after `!begin`:\n- Status: ACTIVE\n- current_scene_id: [UUID present]\n\n### 4. Check Scenes Created\n```bash\necho \"SELECT id, objective FROM scenes WHERE game_session_id = '193eebf4-d0c2-4dc4-82d7-6f9baddf4f04' ORDER BY created_at;\" | railway connect Postgres-FuND\n```\n\nExpected: At least 1 scene with objective\n\n## Commit Message\n\nWhen ready to commit:\n\n```bash\ngit commit -m \"Fix arc generation timeout and add retry logic\n\n- Increase Claude API timeout from 30s to 90s\n- Add 3-attempt retry with exponential backoff (2s, 4s, 8s)\n- Reset broken game 193eebf4-d0c2-4dc4-82d7-6f9baddf4f04\n- Delete obsolete party-lore-console module\n- Update FR-192 with dev testing section\n- Create FR-192 Phase 1 implementation plan\n\nFixes: Arc generation timeout causing games to be stuck\n       in ACTIVE status with no scenes\n\nRelated: FR-192 (Session-Aware Web Application)\"\n```\n\n## Impact\n\n### Before Fixes\n- ‚ùå 30s timeout too short ‚Üí games crash on slow Claude API\n- ‚ùå No retry logic ‚Üí permanent failure on first timeout\n- ‚ùå Manual SQL fix required for every timeout\n- ‚ùå 0% recovery rate from transient issues\n\n### After Fixes\n- ‚úÖ 90s timeout accommodates complex arc generation\n- ‚úÖ 3 retry attempts with smart backoff\n- ‚úÖ Automatic recovery from transient slowness\n- ‚úÖ ~90% recovery rate expected (2 extra chances)\n- ‚úÖ Only persistent issues require investigation\n\n## Next Steps\n\n1. **Immediate**: Commit and deploy these fixes\n2. **Testing**: Restart the fixed game with `!begin`\n3. **Monitoring**: Watch logs for 24 hours to verify retry logic\n4. **Documentation**: Update runbook with timeout troubleshooting\n\n---\n\n**Status**: All fixes applied and tested locally ‚úÖ\n**Ready for**: Production deployment\n**Risk**: Low - retry logic is defensive, timeout increase is conservative\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/FIXES-SUMMARY.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "d02b053b41855898",
      "size_bytes": 6460,
      "created_at": "2026-01-02T20:42:12.434863"
    },
    {
      "doc_id": "local_party-lore_SIMULTANEOUS-ACTION-FIX-SUMMARY",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/SIMULTANEOUS-ACTION-FIX-SUMMARY.md",
      "content": "# Simultaneous Action Contradiction Fix - Summary\n\n**Date**: December 7, 2025\n**Issue**: FR-200 narrative contradictions when players take opposed actions\n**Fix Type**: Prompt engineering (Tier 2 narrative generation)\n\n## Problem Statement\n\nWhen two players took opposed actions (e.g., Player A attacks Player B, Player B dodges), the narrative generation would create physically impossible scenarios where BOTH actions succeeded simultaneously:\n\n**Example of the bug**:\n```\n\"The blade bites deep, slicing through Vorcyr's armor and into his flesh. Vorcyr's\neyes widen in shock as he staggers backward into a snowbank.\n\nSimultaneously, Vorcyr Thrain darts to the side, his movement a blur of speed and\nagility. He slides past the attack, carrying himself clear of the deadly blow.\"\n```\n\n**The Contradiction**: Vorcyr is simultaneously:\n- Wounded and staggering backward (attack succeeded)\n- Successfully dodging with \"blur of speed\" (dodge succeeded)\n\nThis violated basic physics and broke player immersion.\n\n## Root Cause Analysis\n\nThe Tier 2 (narrative) prompt instructed:\n```\n‚ö° SIMULTANEOUS ACTIONS: All N players acted AT THE SAME TIME.\n  - Show their actions COLLIDING, SYNCING, or COMBINING\n  - Each player's contribution must be distinctly visible\n```\n\nThe LLM interpreted \"each player's contribution must be distinctly visible\" as \"show both actions succeeding,\" creating contradictions when actions were opposed.\n\n## Solution Approach\n\n### Testing Methodology\n\nCreated `scripts/test-simultaneous-action-prompts.sh` to test 4 different prompt variations against the attack/dodge scenario with explicit mechanics outcomes (attack HITS, dodge FAILS).\n\n**Test Results**:\n- **Baseline** (current production): ‚úÖ PASS (actually worked correctly with mechanics!)\n- **Variation 1** (Explicit Opposed Rules): ‚úÖ PASS - Best clarity\n- **Variation 2** (Step-by-Step Structure): ‚úÖ PASS - Good narrative flow\n- **Variation 3** (Outcome-First): ‚úÖ PASS - Clear failure language\n- **Variation 4** (Physics Warnings): ‚úÖ PASS - Most explicit\n\n**Key Insight**: When provided with clear mechanics outcomes, ALL variations handled opposed actions correctly! The problem wasn't the fundamental approach, but lack of explicit constraints.\n\n### Implementation\n\nSelected **Variation 1 approach** (made generic for all action types) and implemented in:\n- **File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n- **Method**: `buildTier2PromptPrefix()`\n- **Lines**: 1748-1767 (new section)\n\n**Added prompt section**:\n```\nüö® CRITICAL: PHYSICS AND LOGIC CONSTRAINTS\nWhen player actions are OPPOSED (attack vs dodge, push vs resist, etc.):\n  ‚ùå FORBIDDEN: Describe both actions succeeding simultaneously\n  ‚ùå FORBIDDEN: Character wounded AND successfully dodging at the same time\n  ‚ùå FORBIDDEN: Blade 'bites deep' AND character 'darts aside with agility'\n  ‚ùå FORBIDDEN: Character pushed backward AND standing firm\n  ‚úÖ REQUIRED: Respect the mechanics outcome below - if damage dealt, defense FAILED\n  ‚úÖ REQUIRED: Show the failed action's ATTEMPT, not its success\n  ‚úÖ REQUIRED: Use failure language: 'too slow', 'not enough', 'failed to', 'too late'\n\nExample (CORRECT handling of opposed actions):\n  'Vorcyr attempted to dash aside, but he was a fraction too slow. Kaelin's\n   blade caught him, biting into his flank. Vorcyr stumbled, wounded.'\n  ‚Üí Shows dodge ATTEMPT + attack SUCCESS + wound OUTCOME\n\nExample (WRONG - contradictory):\n  'Kaelin's blade bites deep into Vorcyr's armor, wounding him. Simultaneously,\n   Vorcyr darts aside with a blur of speed, dodging the attack.'\n  ‚Üí Cannot be wounded AND successfully dodging!\n```\n\n## Test Results\n\n### Before Fix (Test run 2025-12-07 14:32:59)\n- **3 HIGH** severity contradictions\n- **2 MEDIUM** severity contradictions\n- **5 LOW** issues\n- **Total**: 5 issues detected\n- **Key problem**: \"Vorcyr is simultaneously wounded and dodging\"\n\n### After Fix (Test run 2025-12-07 15:02:33)\n- **1 HIGH** severity contradiction (67% reduction!)\n- **3 MEDIUM** severity contradictions\n- **Several LOW** issues\n- **Total**: 4 issues detected\n- **Remaining HIGH**: Location contradiction (character in two places), NOT opposed action contradiction\n\n## Impact\n\n### Immediate Benefits\n1. **67% reduction in HIGH severity contradictions** (3 ‚Üí 1)\n2. **Eliminated the \"wounded AND dodging\" class of bugs**\n3. **No performance impact** (prompt-only change)\n4. **No realm-specific content** (works across all realms)\n\n### What This Fixes\n‚úÖ Attack vs Dodge contradictions\n‚úÖ Push vs Resist contradictions\n‚úÖ Any opposed action contradictions\n‚úÖ Physics violations in multi-player scenarios\n\n### What This Doesn't Fix\n‚ùå Location contradictions (character teleportation)\n‚ùå NPC resurrection bugs\n‚ùå Pacing issues\n‚ùå Player behavior quirks\n\nThese require separate fixes (some already planned).\n\n## Examples of Correct Output After Fix\n\n**Scenario**: Kaelin attacks Vorcyr, Vorcyr dodges, mechanics say attack HITS.\n\n**Generated narrative** (from test):\n```\nVorcyr Thrain darted to the side with a swift motion, his eyes fixed on Kaelin as\nhe attempted to avoid the impending strike. He had been caught off guard by Kaelin's\nsudden attack, and his reflexes were put to the test as he leapt out of the way. His\narmor creaked and his legs tensed as he strained to change direction in mid-air, but\nit was too late to avoid the blade.\n\nKaelin's sword flashed in the dim light, its edge biting deep into Vorcyr's flank as\nhe failed to dodge the attack in time. The force of the blow sent Vorcyr stumbling\noff balance, his vision blurring for a moment as the pain washed over him.\n```\n\n**Analysis**:\n‚úÖ Shows Vorcyr's dodge ATTEMPT (\"darted...attempted to avoid\")\n‚úÖ Shows dodge FAILURE (\"but it was too late\")\n‚úÖ Shows attack SUCCESS (\"failed to dodge...biting deep\")\n‚úÖ Shows wound OUTCOME (\"stumbling off balance...pain\")\n‚úÖ NO contradiction - only ONE outcome (attack wins)\n\n## Files Modified\n\n1. **party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java**\n   - Added opposed actions constraint section (lines 1748-1767)\n   - Updated buildTier2PromptPrefix() method\n\n## Files Created\n\n1. **scripts/test-simultaneous-action-prompts.sh**\n   - Test script for prompt variations\n   - Uses Groq API to test attack/dodge scenario\n   - Compares 4 different prompt approaches\n\n2. **scripts/analyze-simultaneous-action-results.sh**\n   - Manual analysis script\n   - Compares good vs bad examples\n   - Documents why each variation worked\n\n3. **NARRATIVE-ISSUES-ANALYSIS-20251207.md**\n   - Comprehensive analysis of test transcript issues\n   - Root cause analysis\n   - Proposed fixes (this fix implements Fix #2)\n\n4. **SIMULTANEOUS-ACTION-FIX-SUMMARY.md** (this document)\n\n## Next Steps\n\n### Recommended Follow-up Fixes\n\n1. **Location Contradiction Fix** (P1)\n   - Remaining HIGH issue is location-based\n   - Character \"melting into shadows\" while \"near the stage\"\n   - Requires spatial consistency validation\n\n2. **Medium Contradictions** (P2)\n   - 3 MEDIUM contradictions still present\n   - Need deeper transcript analysis to identify patterns\n   - May require similar prompt constraints\n\n3. **Political Thriller Testing** (P2)\n   - Our realm JSON refactoring hasn't been tested on Political Thriller yet\n   - Should verify no NPC invention with Intelligence Chief/Military Liaison fixes\n   - Run focused test: `/test quick` with Political Thriller realm\n\n### Deployment Readiness\n\n**Ready for Production**: ‚úÖ YES\n\n**Reasoning**:\n- 67% reduction in critical bugs\n- No performance impact\n- Tested successfully across 5 scenarios\n- Generic approach (not realm-specific)\n- No code logic changes (prompt-only)\n\n**Recommendation**: Deploy this fix, then address remaining location contradictions in follow-up PR.\n\n## References\n\n- **Original Bug Report**: `NARRATIVE-ISSUES-ANALYSIS-20251207.md`\n- **Test Transcripts**: `.test-reports/transcripts/transcript-basic-combat-*`\n- **Test Reports**: `.test-reports/test-report-quick-20251207-*.md`\n- **Prompt Experiments**: `.test-reports/prompt-experiments/simultaneous-action-test-*.txt`\n\n## Lessons Learned\n\n1. **Mechanics-first works**: When Tier 1 provides clear mechanics outcomes, Tier 2 respects them\n2. **Explicit constraints matter**: LLMs need explicit \"FORBIDDEN\" rules for edge cases\n3. **Examples help**: Showing good/bad examples in prompts improves output quality\n4. **Testing validates assumptions**: Initial assumption that baseline was broken was wrong - it worked with proper mechanics!\n\n## Credits\n\n- **Issue Discovery**: Autonomous testing framework (TASK-163)\n- **Root Cause**: Transcript analysis of Turn 3, Basic Combat scenario\n- **Solution**: Iterative prompt engineering with Groq API\n- **Testing**: Full `/test quick` suite validation\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/SIMULTANEOUS-ACTION-FIX-SUMMARY.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "example",
        "md"
      ],
      "content_hash": "5b14eea4d3cb8f53",
      "size_bytes": 8812,
      "created_at": "2026-01-02T20:42:12.434907"
    },
    {
      "doc_id": "local_party-lore_LOCATION-ARCHITECTURE-CRISIS-ANALYSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/LOCATION-ARCHITECTURE-CRISIS-ANALYSIS.md",
      "content": "# LOCATION ARCHITECTURE CRISIS - Root Cause Analysis\n\n**Date**: December 7, 2025\n**Severity**: CRITICAL - P0 Architectural Flaw\n**Affects**: Scene transitions, Arc generation, World state system\n\n---\n\n## Executive Summary\n\n**WE HAVE A MASSIVE ARCHITECTURAL GAP**: The entire world location system (FR-199, FR-046) exists in the database schema with full entity relationships, BUT scenes and beats have NO foreign keys to WorldLocation entities. This means:\n\n1. Scenes don't know what location they're in\n2. Beats don't know what location they represent\n3. Arc transitions can't compare locations because locations aren't tracked\n4. The \"arc transition teleportation fix\" was solving a symptom of this deeper problem\n\n---\n\n## The Architecture We HAVE\n\n### Database Schema (EXISTS)\n```sql\n-- V104: game_characters table with location FKs\nCREATE TABLE game_characters (\n    id UUID PRIMARY KEY,\n    current_location_id UUID REFERENCES world_locations(id),\n    current_position_id UUID REFERENCES world_positions(id),\n    ...\n);\n\n-- V105: Full spatial hierarchy\nCREATE TABLE world_regions (...);\nCREATE TABLE world_areas (...);\nCREATE TABLE world_locations (...);  -- ‚úÖ EXISTS\nCREATE TABLE world_positions (...);\n\n-- V113: Game sessions have location\nALTER TABLE game_sessions\nADD COLUMN current_location_id UUID REFERENCES world_locations(id);\n\n-- V114: Arcs have starting location (STRING)\nALTER TABLE active_story_arcs\nADD COLUMN starting_location VARCHAR(255);\n\n-- V118: Arcs have starting/ending location (UUID FKs)\nALTER TABLE active_story_arcs\nADD COLUMN starting_location_id UUID REFERENCES world_locations(id),\nADD COLUMN ending_location_id UUID REFERENCES world_locations(id);\n```\n\n### What's MISSING\n```sql\n-- ‚ùå SCENES HAVE NO LOCATION!\n-- Should have been:\nALTER TABLE scenes\nADD COLUMN location_id UUID REFERENCES world_locations(id);\n\n-- ‚ùå BEATS HAVE NO LOCATION!\n-- Should have been:\nALTER TABLE plot_beats\nADD COLUMN location_id UUID REFERENCES world_locations(id);\n```\n\n---\n\n## The Architecture We NEED\n\n### FR-199 Specification Shows (Lines 105-112)\n```java\n@Entity\npublic class GameCharacter {\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"current_location_id\")\n    private WorldLocation currentLocation;  // ‚úÖ EXISTS IN CODE\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"current_position_id\")\n    private WorldPosition currentPosition;  // ‚úÖ EXISTS IN CODE\n}\n```\n\n### What Scene SHOULD Have\n```java\n@Entity\n@Table(name = \"scenes\")\npublic class Scene {\n    // ‚ùå THIS DOESN'T EXIST!\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"location_id\")\n    private WorldLocation location;\n\n    // Could also have:\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"position_id\")\n    private WorldPosition position;  // More specific location within location\n}\n```\n\n### What SimplePlotBeat SHOULD Have\n```java\n@Entity\n@Table(name = \"plot_beats\")\npublic class SimplePlotBeat {\n    // ‚ùå THIS DOESN'T EXIST!\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"location_id\")\n    private WorldLocation location;\n}\n```\n\n---\n\n## Why This Matters\n\n### Current Broken Flow\n1. **Arc Generation** (ArcGenerationService):\n   - Generates arc with `startingLocation` (STRING)\n   - Has `WorldLocationRepository` injected but NEVER USES IT\n   - Arc has FK to WorldLocation but it's always NULL\n\n2. **Scene Generation** (StoryDrivenSceneGenerator):\n   - Generates scene from beat\n   - Scene has NO location FK\n   - LLM generates scene title like \"Receiving the Job from Victor 'The Bull' Chen\"\n   - Title becomes de-facto \"location\" but it's NOT a real location\n\n3. **Opening Narrative** (OpeningNarrativeGenerator):\n   - Generates narrative with embedded metadata\n   - Extracts `initial_location` from narrative\n   - Calls `applyLocationToSessionPlayers()` which sets **Player.currentLocation** (STRING)\n   - But Scene still has NO location reference!\n\n4. **Scene Transition** (SceneTransitionOrchestrator):\n   - Compares `scene.getTitle()` to detect \"location changes\"\n   - But titles are narrative descriptions, not locations!\n   - \"Test Scenario: Basic Combat\" vs \"Receiving the Job\" looks like different locations\n   - But both could be in the SAME physical location\n\n### What SHOULD Happen\n1. Arc generation creates/references WorldLocation entities\n2. Beat generation links beats to specific WorldLocation entities\n3. Scene generation inherits location from beat\n4. Scene transition compares `scene.getLocation().getId()` vs `nextScene.getLocation().getId()`\n5. If location UUIDs differ ‚Üí generate transition narrative\n6. If location UUIDs same ‚Üí no travel needed\n\n---\n\n## Evidence of the Gap\n\n### From V118 Migration Comments\n```sql\nCOMMENT ON COLUMN active_story_arcs.starting_location_id IS\n    'FR-200: UUID reference to starting WorldLocation entity. Populated during arc creation.';\n```\n**But**: ArcGenerationService never populates this! The code exists but isn't used.\n\n### From ArcGenerationService.java\n```java\nprivate final WorldLocationRepository worldLocationRepository;  // FR-200: For location UUID resolution\n\n// But this field is NEVER USED in the entire class!\n// No calls to worldLocationRepository.findByName()\n// No calls to arc.setStartingLocationId()\n```\n\n### From FR-199 Line 75\n> FR-200: ID-Grounded Entity Reference System\n\nThe specification ASSUMES scenes and beats have location references, but they don't exist!\n\n---\n\n## Why This Happened\n\n### Timeline of Mistakes\n\n1. **V104-V110** (Dec 5): Created full world state system (GameCharacter, WorldLocation, etc.)\n2. **V113** (Dec 6): Added `current_location_id` to game_sessions\n3. **V114** (Dec 6): Added `starting_location` STRING to arcs (should have been UUID FK from start!)\n4. **V118** (Dec 7): Added `starting_location_id` UUID FK to arcs (fixing V114 mistake)\n5. **BUT NEVER ADDED**: `location_id` to scenes or beats!\n\n### Why It Was Missed\n- Scenes existed before world state system (legacy)\n- Beats were added for infinite story (TASK-203) before location system was complete\n- Arc generation (TASK-388) was implemented without connecting to WorldLocation entities\n- Nobody did end-to-end integration testing of arc‚Üíbeat‚Üíscene‚Üílocation flow\n\n---\n\n## Impact Assessment\n\n### Systems Affected\n1. **Arc Transitions**: Can't detect real location changes (comparing titles instead of UUIDs)\n2. **World State Continuity**: Scenes don't contribute to world geography knowledge\n3. **Location Prompts**: Can't inject \"you are at [location name]\" accurately\n4. **Travel System**: Can't determine if travel is needed between scenes\n5. **Spatial Reasoning**: LLM can't reason about \"where am I?\" because scenes don't know\n6. **FR-200 ID System**: Scenes can't reference locations with LOC-001 style IDs\n\n### What Works (Surprisingly)\n- Player locations are tracked (via Player.currentLocation STRING)\n- Opening narratives extract location metadata\n- GameCharacter.currentLocationId exists and works\n- Arc.startingLocationId exists (just never populated)\n\n---\n\n## Root Cause\n\n**The world location system was built as infrastructure but never integrated with the narrative generation system.**\n\nIt's like building a GPS satellite network but never installing GPS receivers in cars. The infrastructure exists, but the consumer systems (arcs, beats, scenes) don't use it.\n\n---\n\n## The Right Solution\n\n### Phase 1: Add Missing FKs (P0 - Do First)\n\n**Migration V120: Add location FKs to scenes and beats**\n```sql\n-- Add location to scenes\nALTER TABLE scenes\nADD COLUMN location_id UUID REFERENCES world_locations(id);\n\nCREATE INDEX idx_scenes_location ON scenes(location_id);\n\nCOMMENT ON COLUMN scenes.location_id IS\n    'FR-199: UUID reference to WorldLocation where this scene takes place';\n\n-- Add location to plot beats\nALTER TABLE plot_beats\nADD COLUMN location_id UUID REFERENCES world_locations(id);\n\nCREATE INDEX idx_beats_location ON plot_beats(location_id);\n\nCOMMENT ON COLUMN plot_beats.location_id IS\n    'FR-199: UUID reference to WorldLocation where this beat occurs';\n```\n\n### Phase 2: Update Domain Models\n```java\n// Scene.java\n@ManyToOne(fetch = FetchType.LAZY)\n@JoinColumn(name = \"location_id\")\nprivate WorldLocation location;\n\n// SimplePlotBeat.java\n@ManyToOne(fetch = FetchType.LAZY)\n@JoinColumn(name = \"location_id\")\nprivate WorldLocation location;\n```\n\n### Phase 3: Fix Arc Generation\n- Make ArcGenerationService actually USE WorldLocationRepository\n- Create or lookup WorldLocation entities when generating arcs\n- Populate arc.startingLocationId and arc.endingLocationId\n- Link beats to locations\n\n### Phase 4: Fix Scene Generation\n- StoryDrivenSceneGenerator inherits location from beat\n- Scene.location = beat.location (copy the FK)\n- Opening narrative no longer needs to extract location (it's already known!)\n\n### Phase 5: Fix Scene Transitions (DELETE my transition narrative code)\n```java\n// OLD (my buggy code):\nString previousLocation = extractLocation(scene);  // Uses title!\nString newLocation = extractLocation(nextScene);   // Uses title!\n\n// NEW (correct):\nUUID prevLocationId = scene.getLocation() != null ? scene.getLocation().getId() : null;\nUUID newLocationId = nextScene.getLocation() != null ? nextScene.getLocation().getId() : null;\n\nif (prevLocationId != null && newLocationId != null && !prevLocationId.equals(newLocationId)) {\n    // Actually different locations - generate transition\n}\n```\n\n---\n\n## Immediate Actions Required\n\n### Action 1: Delete My Buggy Fix\n- Remove transition narrative generation code from SceneTransitionOrchestrator\n- Remove `extractLocation()`, `generateTransitionNarrative()` methods\n- Remove MemoryService and MultiProviderLLMService dependencies I added\n- Unstage these changes\n\n### Action 2: Create FR or TASK for Proper Fix\n- Document this analysis as an FR\n- Create migration V120 for location FKs\n- Create tasks for updating services\n\n### Action 3: Backfill Existing Data\n- Need strategy for existing scenes/beats without locations\n- Could use scene.title to fuzzy-match to WorldLocation.name\n- Or just set them all to session.currentLocation\n\n---\n\n## Questions for User\n\n1. **Why were scenes and beats created without location FKs?** Was this intentional or oversight?\n\n2. **Should scenes inherit location from beats, or be independently located?**\n   - Option A: Scene.location = beat.location (simpler)\n   - Option B: Scenes can override beat location (more flexible, e.g., chase sequence)\n\n3. **How should we handle existing data?**\n   - 100+ scenes in database with no location\n   - Do we backfill or just fix going forward?\n\n4. **Should we delete Player.currentLocation STRING?**\n   - Now that we have proper location FKs, the string is redundant\n   - Or keep it for backward compatibility?\n\n5. **Do we need Scene.position (WorldPosition) or just Scene.location (WorldLocation)?**\n   - WorldPosition is more granular (\"behind the bar\" vs \"in the tavern\")\n   - Might be overkill for scenes\n\n---\n\n## Recommendation\n\n**Immediately**:\n1. Revert my arc transition narrative code (it's solving the wrong problem)\n2. Create V120 migration adding location_id to scenes and beats\n3. Update Scene and SimplePlotBeat entities\n4. Fix ArcGenerationService to populate locations\n5. Fix StoryDrivenSceneGenerator to copy beat.location to scene.location\n6. Update SceneTransitionOrchestrator to compare location UUIDs\n\n**Then we can properly detect location changes and generate transition narratives only when needed.**\n\n---\n\n## Conclusion\n\nThe \"arc transition teleportation bug\" was a SYMPTOM of a much deeper architectural issue: **the world location system exists but isn't connected to the narrative generation system**.\n\nMy fix was putting a band-aid on a broken leg. We need to actually set the bone first (add the missing FKs), then the transition detection will work naturally.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/LOCATION-ARCHITECTURE-CRISIS-ANALYSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "md"
      ],
      "content_hash": "652e6839be2a3843",
      "size_bytes": 11816,
      "created_at": "2026-01-02T20:42:12.435078"
    },
    {
      "doc_id": "local_party-lore_PROMPT_OPTIMIZATION",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/PROMPT_OPTIMIZATION.md",
      "content": "# Party-Lore Prompt Optimization Guide\n\n**Date:** 2025-12-02\n**Context:** Ollama 8B model performance testing with various prompt sizes\n**Goal:** Reduce prompt size while maintaining narrative quality\n\n---\n\n## Executive Summary\n\nTesting revealed that **prompt size directly impacts both prompt evaluation time and generation speed**. A 287-character prompt runs 2x faster than a 6915-character prompt while producing equally high-quality narrative output.\n\n| Metric | Small Prompt (287c) | Large Prompt (6915c) | Impact |\n|--------|---------------------|----------------------|--------|\n| Prompt Eval | 0.17s | 1.4s | **8x slower** |\n| Generation TPS | 28 | 23 | **18% slower** |\n| Total Time | ~9s | ~18s | **2x slower** |\n| Output Quality | Excellent | Excellent | **Equal** |\n\n---\n\n## Current Prompt Issues\n\n### 1. Decorative Separators (~740 chars wasted)\n```\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n```\nThese 67-character lines appear 11+ times. They provide zero value to the model.\n\n**Fix:** Remove entirely or replace with simple `---` or `[SECTION]` headers.\n\n### 2. Character Backgrounds (~1200 chars wasted)\n```\nADVENTURER ALPHA BACKGROUND:\nA former soldier who served in the Kings army for 10 years. Left service\nafter witnessing corruption among the officers...\n```\nThis backstory is never referenced in combat narrative output.\n\n**Fix:** Only include if the prompt specifically asks for personality-influenced narration. For combat, just include name + class + key stats.\n\n### 3. World Lore Section (~400 chars wasted)\n```\nThe dungeon was once a temple to the Old Gods, built over a thousand\nyears ago by a civilization that has since vanished...\n```\nBackground worldbuilding that doesn't appear in combat narration.\n\n**Fix:** Remove for combat prompts. Only include for exploration/discovery scenes where lore matters.\n\n### 4. Tactical Notes (~500 chars wasted)\n```\nTHREATS:\n- Guard Captain is wounded but still dangerous (12 HP remaining)\n- The locked door may have reinforcements behind it...\n```\nThis duplicates information already in the mechanics section.\n\n**Fix:** Remove entirely. The mechanics section already contains this data.\n\n### 5. Prior Events List (~450 chars wasted)\n```\n1. Defeated a group of skeleton warriors in the entrance hall\n2. Solved a puzzle involving rotating stone pillars...\n```\nHistorical events not referenced in current combat output.\n\n**Fix:** Only include 1-2 most relevant prior events if they directly impact the current scene.\n\n### 6. Emoji Markers (~200 chars)\n```\n‚úÖ FOR SUCCESS OUTCOMES:\n‚ö†Ô∏è FOR PARTIAL SUCCESS:\n‚ùå FOR FAILURES:\n```\nThese may confuse some models and add unnecessary complexity.\n\n**Fix:** Use plain text markers or remove entirely since the model infers from context.\n\n---\n\n## Recommended Prompt Structure\n\n### Before (6915 chars):\n```\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nGAME STATE\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nSCENE: The Ancient Dungeon - A dark and foreboding underground complex...\n\nPLAYERS:\n- Adventurer Alpha (HP: 20/20, Class: Fighter, Level: 5)\n  Equipment: Longsword +1, Chain Mail, Shield\n  Abilities: Second Wind, Action Surge, Extra Attack\n\n[... 150+ more lines ...]\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nNARRATIVE REQUIREMENTS\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n‚úÖ FOR SUCCESS OUTCOMES:\n- Describe the action cinematically\n[...]\n```\n\n### After (770-900 chars):\n```\nYou are a Game Master. Write 200-300 words of combat narrative with cinematic action and sensory details.\n\n[SCENE]\nAncient dungeon: dim torches, stone walls with runes, pit trap center.\n\n[COMBATANTS]\nParty: Alpha (Fighter, longsword), Beta (Wizard, fireball)\nEnemies: Guard Captain (scarred veteran, heavy armor), 3 Goblin Scouts\n\n[COMBAT RESULTS]\nAlpha vs Guard Captain:\n- 3 sword hits, 1 miss\n- 33 total damage\n- Captain badly wounded (12 HP left), bleeding, staggering\n\nBeta vs Goblins:\n- Fireball engulfs all 3 goblins\n- 28 fire damage each\n- All goblins killed instantly\n\n[NARRATE]\nDescribe both actions in sequence. Show the visceral impact. Include sounds, smells, and movement. End with the wounded Captain's desperate response, creating tension for the next round.\n```\n\n---\n\n## Implementation Recommendations\n\n### 1. Create a PromptBuilder utility class\n\n```java\npublic class CompactPromptBuilder {\n\n    public String buildCombatPrompt(Scene scene, List<CombatResult> results) {\n        StringBuilder sb = new StringBuilder();\n\n        // Role + requirements (fixed, ~100 chars)\n        sb.append(\"You are a Game Master. Write 200-300 words of combat narrative \");\n        sb.append(\"with cinematic action and sensory details.\\n\\n\");\n\n        // Scene (dynamic, ~50-100 chars)\n        sb.append(\"[SCENE]\\n\");\n        sb.append(scene.getCompactDescription()).append(\"\\n\\n\");\n\n        // Combatants (dynamic, ~100-200 chars)\n        sb.append(\"[COMBATANTS]\\n\");\n        sb.append(formatCombatantsCompact(scene)).append(\"\\n\\n\");\n\n        // Results (dynamic, ~200-400 chars)\n        sb.append(\"[COMBAT RESULTS]\\n\");\n        sb.append(formatResultsCompact(results)).append(\"\\n\\n\");\n\n        // Narration instruction (fixed, ~100 chars)\n        sb.append(\"[NARRATE]\\n\");\n        sb.append(getNarrationInstruction(results));\n\n        return sb.toString();\n    }\n\n    private String formatCombatantsCompact(Scene scene) {\n        // Format: \"Alpha (Fighter, longsword), Beta (Wizard)\"\n        // NOT: Full stat blocks with equipment lists\n    }\n}\n```\n\n### 2. Remove these sections entirely for combat prompts:\n- Character backgrounds\n- World lore\n- Prior events (unless directly relevant)\n- Tactical notes\n- Decorative separators\n\n### 3. Conditionally include based on prompt type:\n\n| Section | Combat | Exploration | Social | Puzzle |\n|---------|--------|-------------|--------|--------|\n| Scene | Brief | Detailed | Brief | Detailed |\n| Characters | Stats only | + Personality | + Full background | Stats only |\n| World Lore | Never | Sometimes | Sometimes | If relevant |\n| Prior Events | Never | Last 1-2 | Last 1-2 | If relevant |\n\n### 4. Cap prompt size\n\n```java\nprivate static final int MAX_PROMPT_CHARS = 1500;\nprivate static final int WARN_PROMPT_CHARS = 1000;\n\npublic String buildPrompt(...) {\n    String prompt = buildFullPrompt(...);\n\n    if (prompt.length() > MAX_PROMPT_CHARS) {\n        prompt = compressPrompt(prompt);\n    }\n\n    if (prompt.length() > WARN_PROMPT_CHARS) {\n        log.warn(\"Prompt size {} chars exceeds recommended {} chars\",\n                 prompt.length(), WARN_PROMPT_CHARS);\n    }\n\n    return prompt;\n}\n```\n\n---\n\n## Performance Expectations After Optimization\n\n| Metric | Before | After | Improvement |\n|--------|--------|-------|-------------|\n| Prompt Size | 6000-15000 chars | 800-1500 chars | 75-90% reduction |\n| Prompt Eval | 1.0-2.5s | 0.15-0.3s | 80-90% faster |\n| Generation TPS | 23-25 | 27-29 | 10-15% faster |\n| Total Request Time | 15-25s | 10-15s | 30-40% faster |\n| Output Quality | Good | Good | No change |\n\n---\n\n## Testing Methodology\n\nRun these test prompts against Ollama to verify improvements:\n\n```bash\n# Create test prompt file\ncat << 'EOF' > /tmp/test_prompt.json\n{\n  \"model\": \"hf.co/mlabonne/Hermes-3-Llama-3.1-8B-lorablated-GGUF:Q4_K_M\",\n  \"prompt\": \"[YOUR OPTIMIZED PROMPT HERE]\",\n  \"stream\": false,\n  \"options\": {\"num_predict\": 400, \"temperature\": 0.8}\n}\nEOF\n\n# Run test\ncurl -s http://localhost:11434/api/generate -d @/tmp/test_prompt.json | \\\n  jq '{tokens: .eval_count, prompt_sec: (.prompt_eval_duration/1e9), gen_sec: (.eval_duration/1e9), tps: (.eval_count / (.eval_duration/1e9) | floor)}'\n```\n\n**Target metrics:**\n- Prompt eval: < 0.3s\n- TPS: > 25\n- Output quality: Vivid, cinematic, includes sensory details\n\n---\n\n## Summary\n\nThe key insight is that **the model doesn't need verbose prompts to produce quality output**. A well-structured 800-character prompt produces narratives indistinguishable from a 7000-character prompt, but runs 2x faster.\n\nFocus prompt content on:\n1. Clear role statement\n2. Essential scene context\n3. Specific action results\n4. Explicit output requirements\n\nRemove:\n1. Decorative formatting\n2. Background information not used in output\n3. Redundant sections\n4. Verbose explanations\n\nThe model is smart enough to infer context from minimal information. Trust it.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/PROMPT_OPTIMIZATION.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "605b8c05edaac238",
      "size_bytes": 9056,
      "created_at": "2026-01-02T20:42:12.435127"
    },
    {
      "doc_id": "local_party-lore_CORE-TEST-ANALYSIS-COMPARISON",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/CORE-TEST-ANALYSIS-COMPARISON.md",
      "content": "# Core Test Analysis - Before vs After Comparison\n## AI RPG Expert Deep Analysis\n\n**Analysis Date:** 2025-12-08\n**Question:** Did we fix fundamental issues or just use overly optimized prompts to mask symptoms?\n\n---\n\n## Executive Summary\n\n**CRITICAL FINDING: We did NOT fix the fundamental issues. We masked them with validation layers.**\n\nThe test report shows a **94% reduction in reported issues** (82 ‚Üí 5), but the **application logs reveal the LLM is still making the same errors at the same frequency**:\n\n- **Location errors**: 47 ValidationAgent corrections (still happening!)\n- **Damage errors**: 22 MechanicsValidator corrections (still happening!)\n\n**What changed:**\n- ‚ùå LLM behavior: **NO IMPROVEMENT** (still making same mistakes)\n- ‚úÖ Issue reporting: **IMPROVED** (validation catches and hides errors from report)\n\n**Translation:** We improved the **error concealment system**, not the **error prevention system**.\n\n---\n\n## The Numbers Don't Lie\n\n### Test Report Metrics (User-Facing)\n\n| Metric | Before | After | Change |\n|--------|--------|-------|--------|\n| **Scenarios Passed** | 5/5 | 5/5 | ‚úÖ No change |\n| **Total Issues Reported** | 82 | 5 | ‚úÖ -94% |\n| **Duration** | 8m 50s | 15m 17s | ‚ùå +72% slower |\n| **Location Issues** | 71 | 1 | ‚úÖ -99% |\n| **Damage Issues** | 5 | 0 | ‚úÖ -100% |\n| **Narrative Issues** | 6 | 4 | ‚ö†Ô∏è -33% |\n\n**Looks great, right? Now look at the logs:**\n\n### Application Log Metrics (Reality)\n\n| Metric | Before | After | Change |\n|--------|--------|-------|--------|\n| **Location Corrections** | ~16 | 47 | ‚ùå +194% (WORSE!) |\n| **Damage Corrections** | ~5 | 22 | ‚ùå +340% (MUCH WORSE!) |\n| **LLM Comprehension** | Poor | Poor | ‚ùå No improvement |\n| **Validation Workload** | High | Very High | ‚ùå Increased |\n\n**The truth:** The LLM is making **MORE errors than before**, not fewer. The validation system is just working overtime to hide them.\n\n---\n\n## What Actually Happened\n\n### Before (Baseline)\n1. Tier 1 LLM makes location/damage errors\n2. ValidationAgent catches and corrects them\n3. Test report captures the **detected issues** (82 issues)\n4. Validation logs show ~16 location corrections, ~5 damage corrections\n\n### After (Prompt \"Enhancement\")\n1. Tier 1 LLM **STILL makes location/damage errors** (actually more!)\n2. ValidationAgent catches and corrects them (47 location, 22 damage)\n3. Test report captures **different issues** (5 issues - mostly narrative quality)\n4. **Validation layers successfully concealed the LLM failures**\n\n---\n\n## Why This Happened\n\n### The Prompt Changes We Made\n\n**Location Detection Enhancement** (ModeSpecificPrompts.java:94-103):\n```java\n6. LOCATION TRACKING (CRITICAL):\n   - Mark <location_change> when player MOVES to different area or position\n   - Movement keywords: \"move to\", \"go to\", \"enter\", \"climb to\", \"sneak to\", \"jump onto\"...\n   - Examples: \"moves to rooftop\" ‚Üí <location_change>Rooftop</location_change>\n   - MICRO-LOCATIONS count: If narrative describes spatial transition...\n```\n\n**Damage Rules Enhancement** (ModeSpecificPrompts.java:42-58):\n```java\n- NO DAMAGE IN EXPLORATION (CRITICAL):\n  * Failed skill checks = NO HP damage (lockpicking, hacking, stealth)\n  * Being detected by cameras/sensors = NO HP damage\n  * Only apply damage if environmental hazard explicitly triggers...\n```\n\n**What we thought would happen:**\n- LLM reads enhanced rules\n- LLM understands location/damage logic better\n- LLM generates correct mechanics XML\n- Validation corrections drop to near zero\n\n**What actually happened:**\n- LLM reads enhanced rules\n- LLM **STILL generates incorrect mechanics XML**\n- ValidationAgent corrects even MORE errors (because prompt made output more verbose/complex)\n- Test reports look clean because validation is working\n\n---\n\n## The Real Problem: Cognitive Mismatch\n\n### Tier 1 LLM Architecture Issue\n\n**The fundamental problem we haven't addressed:**\n\nTier 1 uses **Llama 3.1-8b-instant** (Groq) for mechanics determination. This is a **small, fast model** optimized for speed, not deep reasoning.\n\n**What Tier 1 LLM does well:**\n- ‚úÖ Generate narrative descriptions (Tier 2 expansion)\n- ‚úÖ Follow XML format structure\n- ‚úÖ Respond quickly (low latency)\n\n**What Tier 1 LLM struggles with:**\n- ‚ùå Spatial reasoning (tracking location changes from narrative)\n- ‚ùå Causal reasoning (damage requires threat source)\n- ‚ùå Instruction following under complexity (long prompts with nested rules)\n\n**Evidence from logs:**\n\n```\nWARN Tier1ValidationAgent - Per-Player Location Errors: 2 player location corrections\n  - Player moved from 'X' to 'Y'\n  - Narrative clearly describes movement\n  - But Tier 1 marked location_change as None\n```\n\nThe LLM **writes the narrative describing movement** but **doesn't mark the mechanics field**. This is a **cognitive disconnect** between narrative generation and mechanics detection.\n\n---\n\n## The Validation Trap\n\n### We Built a Self-Healing System That Conceals Poor LLM Performance\n\n**Our architecture:**\n\n```\nTier 1 LLM (Llama 3.1-8b)\n    ‚Üì\nGenerates mechanics XML\n    ‚Üì\nTier1ValidationAgent (rule-based validation)\n    ‚Üì\nMechanicsValidator (threat validation)\n    ‚Üì\nCorrected mechanics\n    ‚Üì\nNarrativeQualityAnalysisService (Claude-powered critique)\n    ‚Üì\nTest report (issues from quality analysis, not mechanics)\n```\n\n**This architecture is BRILLIANT for production reliability** (errors are caught and corrected automatically), but **TERRIBLE for understanding LLM performance** (errors are hidden by validation).\n\n**The trap:**\n1. LLM makes errors\n2. Validation fixes them\n3. Test reports look clean\n4. We think the LLM improved\n5. **But it didn't** - validation just got better at hiding failures\n\n---\n\n## Comparing Test Results: What Changed?\n\n### Before: 82 Issues (Mostly Mechanics)\n\n**Issue Breakdown:**\n- **CONTRADICTION (55)**: Location contradictions between state and narrative\n  - Root cause: Tier 1 didn't mark location changes, ValidationAgent corrected retroactively\n  - Narrative quality analyzer saw the **original contradiction before correction**\n- **Location Detection (16)**: Explicit ValidationAgent corrections\n  - Root cause: Tier 1 LLM failed to mark location_change in mechanics XML\n- **Damage Without Threat (5)**: MechanicsValidator corrections\n  - Root cause: Tier 1 LLM applied damage without valid threat source\n- **NPC Behavior (3)**: Narrative quality issues\n- **Pacing (2)**: Narrative quality issues\n- **Missing Context (1)**: Narrative quality issue\n\n**Translation:** 71 of 82 issues (87%) were **mechanics errors caught by validation**.\n\n### After: 5 Issues (Mostly Narrative)\n\n**Issue Breakdown:**\n- **MISSING_CONTEXT (1)**: Lack of clear objectives (narrative quality)\n- **PACING_ISSUE (1)**: Rushed gameplay section (narrative quality)\n- **MECHANICAL_ERROR (1)**: Unclear GM mechanics (narrative quality)\n- **CONTRADICTION (1)**: Minor description inconsistency (narrative quality)\n- **PLAYER_IGNORED (1)**: Player action not addressed (narrative quality)\n\n**Translation:** 5 of 5 issues (100%) are **narrative quality issues** from Claude-powered analysis.\n\n**Where did the mechanics errors go?** They're still happening (47 location, 22 damage corrections in logs), but they're **not making it into the test report** because validation is fixing them before quality analysis sees them.\n\n---\n\n## The Real Questions\n\n### 1. Did We Fix LLM Comprehension?\n\n**NO.** The LLM is still making the same errors (actually more frequently).\n\n**Evidence:**\n- Before: ~16 location corrections per test run\n- After: 47 location corrections per test run\n- **Conclusion:** LLM comprehension got WORSE, not better\n\n**Why did it get worse?**\n- Enhanced prompts made the mechanics prompt longer and more complex\n- Llama 3.1-8b-instant struggles with long, nested instruction following\n- More rules = more opportunities for mistakes\n- Small model + complex prompt = cognitive overload\n\n### 2. Did We Fix Validation Architecture?\n\n**YES, BUT...** The validation architecture is working perfectly. It's catching and correcting errors reliably.\n\n**The problem:** Validation is a **band-aid**, not a cure. We're relying on validation to fix LLM errors instead of preventing them.\n\n**Architectural question:**\n- Is this acceptable? (Self-healing system with validation layers)\n- Or should we fix the root cause? (Better LLM comprehension)\n\n### 3. Are We Using Overly Optimized Prompts?\n\n**YES.** The enhanced prompts are:\n- Longer (more tokens)\n- More complex (nested rules, examples)\n- More specific (explicit keywords, format constraints)\n- More prescriptive (CRITICAL, MUST, REQUIRED)\n\n**The problem:** We're trying to **force compliance through verbosity**, not **teach understanding through clarity**.\n\n**Example from ModeSpecificPrompts.java:**\n```java\n- Movement keywords: \"move to\", \"go to\", \"enter\", \"climb to\", \"sneak to\", \"jump onto\", \"step into\", \"walk into\"\n- Examples: \"moves to rooftop\" ‚Üí <location_change>Rooftop</location_change>\n- Examples: \"enters the alley\" ‚Üí <location_change>The Alley</location_change>\n- Examples: \"jumps onto equipment\" ‚Üí <location_change>Rooftop (equipment)</location_change>\n- Examples: \"sneaks to entrance\" ‚Üí <location_change>Entrance</location_change>\n- MICRO-LOCATIONS count: If narrative describes spatial transition, even within same area\n- NO movement keywords: \"scan\", \"observe\", \"look around\", \"hack\", \"pick lock\" ‚Üí <location_change>None</location_change>\n- Format: EITHER \"None\" OR \"Location Name\" (not \"None|Location\")\n```\n\nThis is **extremely prescriptive**. We're essentially writing a rule engine in natural language and hoping the LLM will interpret it correctly.\n\n**Better approach:** Simpler prompt with **few-shot examples** and **better model selection**.\n\n---\n\n## The Fundamental Issue: Model Selection\n\n### Current Tier 1 Model: Llama 3.1-8b-instant (Groq)\n\n**Pros:**\n- ‚úÖ Very fast (low latency)\n- ‚úÖ Very cheap (cost-effective)\n- ‚úÖ Available on Groq (high throughput)\n\n**Cons:**\n- ‚ùå Small model (8B parameters)\n- ‚ùå Poor spatial reasoning\n- ‚ùå Poor causal reasoning\n- ‚ùå Struggles with complex instructions\n- ‚ùå Inconsistent rule following\n\n**What we're asking it to do:**\n1. Parse complex multi-player game state\n2. Understand spatial relationships (location tracking)\n3. Reason about causation (damage sources)\n4. Generate structured XML output\n5. Follow 200+ lines of prompt instructions\n6. Do all this in <1 second per turn\n\n**This is beyond the capability of an 8B model.**\n\n### Alternative Models for Tier 1\n\n| Model | Size | Strengths | Weaknesses | Cost vs Current |\n|-------|------|-----------|------------|-----------------|\n| **Llama 3.3-70b-versatile** | 70B | Much better reasoning, instruction following | Slower, more expensive | ~8x cost |\n| **Claude Haiku** | Unknown | Excellent spatial reasoning, reliable | API dependency, potential latency | ~4x cost |\n| **GPT-4o-mini** | Unknown | Strong reasoning, fast | API dependency, cost | ~6x cost |\n| **Llama 3.1-8b (self-hosted)** | 8B | Control, no API limits | Same poor performance | Infrastructure cost |\n\n**Key insight:** We're using a **speed/cost model** for a **reasoning task**. This is a fundamental mismatch.\n\n---\n\n## AI RPG Expert Assessment\n\n### What We Actually Did\n\n**We built a production-grade error concealment system.**\n\nThe self-healing validation architecture is **EXCELLENT** for:\n- ‚úÖ Production reliability (errors don't reach players)\n- ‚úÖ Graceful degradation (bad LLM output is corrected)\n- ‚úÖ Observability (every correction is logged)\n- ‚úÖ Testing (scenarios pass despite LLM errors)\n\n**But it's TERRIBLE for:**\n- ‚ùå Understanding LLM performance\n- ‚ùå Prompt engineering feedback loops\n- ‚ùå Cost optimization (correction overhead)\n- ‚ùå Latency (validation adds processing time)\n\n### The Cognitive Dissonance\n\n**We have two systems fighting each other:**\n\n1. **Tier 1 LLM**: Trying to generate correct mechanics XML\n2. **Validation Layers**: Assuming Tier 1 will fail and correcting it\n\n**This is like:**\n- Hiring a junior developer who makes mistakes\n- Having a senior developer review and fix all their code\n- Reporting \"zero bugs\" because the senior developer caught everything\n- But the junior developer never improves\n\n**The system works, but it's inefficient.**\n\n### The Real Problem\n\n**Tier 1 is using the wrong tool for the job.**\n\nLlama 3.1-8b-instant is a **chat model** optimized for conversational tasks, not a **reasoning model** optimized for structured decision-making.\n\n**What we need for Tier 1:**\n- Model with strong spatial reasoning (location tracking)\n- Model with strong causal reasoning (damage sources)\n- Model with reliable instruction following (complex prompts)\n- Model that can generate structured output (XML)\n- **Acceptable latency and cost**\n\n**Llama 3.1-8b-instant has NONE of these except cost.**\n\n---\n\n## Recommendations\n\n### Option 1: Accept the Current Architecture (Band-Aid Approach)\n\n**Keep using Llama 3.1-8b-instant + heavy validation.**\n\n**Pros:**\n- ‚úÖ Already implemented and working\n- ‚úÖ Fast and cheap\n- ‚úÖ Production-ready (validation catches all errors)\n\n**Cons:**\n- ‚ùå High validation overhead (47 location + 22 damage corrections per run)\n- ‚ùå Increased latency (validation processing + correction)\n- ‚ùå No LLM improvement feedback loop\n- ‚ùå Technical debt (relying on band-aids)\n\n**When to choose this:**\n- You prioritize cost over quality\n- You accept validation as part of the system design\n- You're okay with 15m test runs vs 8m (72% slower)\n\n### Option 2: Upgrade Tier 1 Model (Root Cause Fix)\n\n**Replace Llama 3.1-8b-instant with a more capable model.**\n\n**Recommended: Llama 3.3-70b-versatile (Groq)**\n\n**Expected improvements:**\n- ‚úÖ Fewer location errors (better spatial reasoning)\n- ‚úÖ Fewer damage errors (better causal reasoning)\n- ‚úÖ Better instruction following (handles complex prompts)\n- ‚úÖ Validation corrections drop to near-zero\n\n**Expected costs:**\n- ‚ùå ~8x cost increase per turn\n- ‚ùå Slightly higher latency (~200ms vs ~100ms)\n\n**How to test:**\n1. Update `application.properties` to use `llama-3.3-70b-versatile`\n2. Re-run `/test core` without prompt changes\n3. Check logs for ValidationAgent correction frequency\n4. If corrections drop from 47 ‚Üí <5, it's working\n\n**Decision criteria:**\n- If corrections drop by >90%, **the model is the problem**\n- If corrections stay high, **the prompts are the problem**\n\n### Option 3: Simplify Tier 1 Prompts (Reduce Complexity)\n\n**Hypothesis:** We're overloading Llama 3.1-8b with too much instruction.\n\n**Approach:**\n1. Strip Tier 1 prompts down to bare minimum:\n   - Remove examples\n   - Remove \"CRITICAL\" emphasis\n   - Remove nested rules\n   - Keep only essential instructions\n2. Use **few-shot examples** instead of rule lists\n3. Let validation do more of the work\n\n**Example simplified prompt:**\n```java\nLOCATION TRACKING:\n- If player moves to new area: <location_change>Area Name</location_change>\n- If player stays in same area: <location_change>None</location_change>\n\nExamples:\nTurn: \"I enter the tavern\"\n<location_change>The Tavern</location_change>\n\nTurn: \"I look around\"\n<location_change>None</location_change>\n```\n\n**Test this with:**\n```bash\n./scripts/test-tier1-location-detection-groq.sh all\n./scripts/test-tier1-damage-rules-groq.sh all\n```\n\n**If corrections drop, verbose prompts are counterproductive.**\n\n### Option 4: Hybrid Approach (Validation + Better Model)\n\n**Best of both worlds:**\n1. Upgrade to Llama 3.3-70b-versatile (better reasoning)\n2. Keep validation layers (safety net)\n3. Simplify prompts (reduce cognitive load)\n4. Monitor correction frequency (measure improvement)\n\n**Expected outcome:**\n- ValidationAgent corrections drop from 47 ‚Üí <5\n- MechanicsValidator corrections drop from 22 ‚Üí <2\n- Test duration stays ~15m (model is slightly slower)\n- Cost increases ~8x (but validation overhead decreases)\n\n**This is the production-ready solution.**\n\n---\n\n## The Bottom Line\n\n### Did We Fix Fundamental Issues?\n\n**NO.** We masked symptoms with validation layers.\n\n**Evidence:**\n- LLM error frequency increased (47 location, 22 damage corrections)\n- Test reports look clean because validation is working\n- No actual improvement in LLM comprehension\n\n### Did We Use Overly Optimized Prompts?\n\n**YES.** The enhanced prompts are verbose, complex, and prescriptive.\n\n**Evidence:**\n- 200+ lines of nested instructions\n- Explicit keyword lists and format constraints\n- \"CRITICAL\", \"MUST\", \"REQUIRED\" emphasis\n- Counter-intuitively made errors WORSE (cognitive overload)\n\n### What Should We Do?\n\n**Recommended path forward:**\n\n1. **Immediate:** Test with Llama 3.3-70b-versatile to isolate model vs prompt issue\n   ```bash\n   # Update application.properties\n   ai.llm.groq.model.default=llama-3.3-70b-versatile\n\n   # Re-run tests\n   /test core\n\n   # Check correction frequency\n   grep \"Per-Player Location Errors\\|DAMAGE_WITHOUT_THREAT\" logs/application.log | wc -l\n   ```\n\n2. **If corrections drop (model issue):** Upgrade production to 70b model\n   - Accept 8x cost increase for quality\n   - Validation becomes safety net, not primary error handler\n\n3. **If corrections stay high (prompt issue):** Simplify prompts\n   - Remove verbose rule lists\n   - Use few-shot examples instead\n   - Test with scripts iteratively\n\n4. **Long-term:** Build prompt optimization feedback loop\n   - Track ValidationAgent correction frequency per prompt version\n   - Use corrections as signal for prompt quality\n   - Iterate toward zero corrections\n\n---\n\n## Conclusion\n\n**We built an impressive self-healing system that conceals poor LLM performance.**\n\nThe architecture is **production-ready** (errors are caught and corrected), but **architecturally inefficient** (heavy reliance on validation band-aids).\n\n**The real fix requires:**\n1. Better model selection (Llama 3.3-70b or Claude Haiku)\n2. Simpler prompts (reduce cognitive load)\n3. Validation as safety net, not primary error handler\n\n**Current state:** We're using a Ferrari (validation architecture) to make up for a bicycle (8B model reasoning).\n\n**Desired state:** Use a sports car (better model) with airbags (validation).\n\n---\n\n**Next Step:** Run the model upgrade test to determine if this is a model capability issue or a prompt engineering issue.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/CORE-TEST-ANALYSIS-COMPARISON.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "llm",
        "md",
        "test"
      ],
      "content_hash": "c8d4782291a4af83",
      "size_bytes": 18241,
      "created_at": "2026-01-02T20:42:12.435177"
    },
    {
      "doc_id": "local_party-lore_LOCATION-REFACTORING-REQUIREMENTS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/LOCATION-REFACTORING-REQUIREMENTS.md",
      "content": "# Location System Refactoring Requirements\n\n**Created:** 2025-12-31\n**Status:** PRE-BETA - No production users, breaking changes acceptable\n**Goal:** Unified location architecture for SMS async RPG gameplay\n\n---\n\n## Problem Statement\n\nParty Lore currently has:\n1. **Dual location tracking** - `Player.currentLocation` (String) AND `GameCharacter.currentLocationId` (UUID)\n2. **Location name reuse bug** - Multiple beats using same location name (\"Situation Room\")\n3. **Over-engineered spatial hierarchy** - 4 tiers (Region/Area/Location/Position) mostly unused\n4. **Unclear zone system** - Free-form `microPosition` works but lacks structure\n\n**Impact:** Location confusion in narratives, inconsistent data, unused infrastructure\n\n---\n\n## Research Summary\n\n**AI RPG Best Practices:**\n- [AI Dungeon](https://aidungeon.com/): Narrative-driven location changes, no grid system\n- [Fate RPG Zones](https://slyflourish.com/fate_style_zones_in_5e.html): 2-4 abstract zones per scene, narrative importance\n- [Text-based Combat](https://slyflourish.com/text-based_battle_maps.html): Range bands, not coordinates\n- [SMS RPG Design](https://forum.phd20.com/t/asynchronous-text-based-campaigns/101): Theater of Mind, simplicity for async play\n\n**Key Insight:** For SMS slow-play, **Scene-level locations + Within-scene positioning** is the sweet spot.\n\n---\n\n## Current State Analysis\n\n### What We Have (Working)\n\n‚úÖ **Location (Scene-level):**\n- `Player.currentLocation` String - \"Situation Room\", \"Hotel Bar\"\n- `GameCharacter.currentLocationId` UUID FK to `WorldLocation`\n- Scene transitions control location changes\n- Kept in sync by `SceneTransitionOrchestrator`\n\n‚úÖ **MicroPosition (Within-scene):**\n- `Player.microPosition` String (255 chars)\n- Free-form text: \"next to Intelligence Chief\", \"5 feet from Mia\"\n- Displayed in prompts: `[PLAYER POSITIONS - WHERE EACH PLAYER IS WITHIN THE SCENE]`\n- Cleared on scene transitions (FR-215)\n- Updated from Tier 1 mechanics\n\n‚úÖ **WorldLocation Entity:**\n- UUID, session_id, area_id, name, description, type, lighting, danger_level\n- Used by Scene, SimplePlotBeat as FK\n\n### What's Broken\n\n‚ùå **Dual Location Tracking:**\n- 17 usages of `player.getCurrentLocation()` (String)\n- 8 usages of `character.getCurrentLocationId()` (UUID)\n- Sync logic in SceneTransitionOrchestrator (complex, error-prone)\n\n‚ùå **Location Name Reuse:**\n- Arc generation allows duplicate location names across beats\n- Political thriller test: ALL beats used \"Situation Room\"\n- Causes narrative confusion (GM describes hotel scenes in \"Situation Room\")\n\n‚ùå **Unused Infrastructure:**\n- `WorldRegion`, `WorldArea` - Mostly empty tables\n- `WorldPosition` - Not used in gameplay (only test initialization)\n- `LocationConnection`, `PositionAdjacency` - Graph system unused\n- `Player.currentPositionId` - Never used\n\n### Code Impact Analysis\n\n**Phase 1 Changes:**\n- **17 locations** calling `player.getCurrentLocation()`\n- **10 locations** calling `player.setCurrentLocation()`\n- **8 locations** using `currentLocationId`\n- **1 migration** to drop `players.current_location` column\n- **2 prompt sections** need minor updates (show WorldLocation.name)\n- **1 validation** add to arc generation (unique location names)\n\n**Phase 2 Changes:**\n- **1 entity** add SceneZone\n- **1 migration** add scene_zones table + players.current_zone_id FK\n- **1 generation** add zone creation in scene setup\n- **5-8 prompt sections** add zone context and features\n- **1 validation** ensure zones generated per scene\n- **3 mechanics** zone movement, zone-based rules, zone features\n\n---\n\n## PHASE 1: Unified Location System (REQUIRED)\n\n### Objectives\n\n1. **Single source of truth** - WorldLocation entity only\n2. **Fix location reuse bug** - Enforce unique names per beat\n3. **Remove unused complexity** - Clean up dormant entities\n4. **Minimal prompt changes** - Keep current behavior\n\n### Changes Required\n\n#### 1. Database Schema\n\n**Remove:**\n```sql\n-- Drop unused spatial tables\nDROP TABLE IF EXISTS position_adjacency;\nDROP TABLE IF EXISTS location_connections;\nDROP TABLE IF EXISTS world_positions;\nDROP TABLE IF EXISTS world_areas;\nDROP TABLE IF EXISTS world_regions;\n\n-- Drop dual tracking\nALTER TABLE players DROP COLUMN current_location;\nALTER TABLE game_characters DROP COLUMN current_position_id;\n```\n\n**Keep:**\n```sql\nworld_locations (\n  id UUID PRIMARY KEY,\n  session_id UUID NOT NULL,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  location_type VARCHAR(50),\n  is_interior BOOLEAN,\n  lighting VARCHAR(20),\n  danger_level INTEGER,\n  entity_status VARCHAR(20),\n  discovered_at TIMESTAMP,\n  last_visited_at TIMESTAMP,\n  created_at TIMESTAMP\n)\n\n-- Existing FKs remain:\ngame_characters.current_location_id ‚Üí world_locations.id\nscenes.location_id ‚Üí world_locations.id\nsimple_plot_beats.location_id ‚Üí world_locations.id\n```\n\n**Constraint:**\n```sql\n-- Enforce unique location names per session (prevents \"Situation Room\" reuse)\nALTER TABLE world_locations\n  ADD CONSTRAINT unique_location_per_session\n  UNIQUE (session_id, name);\n```\n\n#### 2. Domain Model Changes\n\n**Remove Entities:**\n- `WorldRegion.java`\n- `WorldArea.java`\n- `WorldPosition.java`\n- `LocationConnection.java`\n- `PositionAdjacency.java`\n\n**Update Player.java:**\n```java\n// REMOVE:\n@Column(name = \"current_location\")\nprivate String currentLocation;\n\npublic String getCurrentLocation() { return currentLocation; }\npublic void setCurrentLocation(String location) { this.currentLocation = location; }\n\n// KEEP:\n@Column(name = \"micro_position\", length = 255)\nprivate String microPosition; // ‚úÖ Still used!\n\n// ADD HELPER:\n/**\n * Get current location from associated GameCharacter.\n * Returns WorldLocation entity, not string.\n */\npublic WorldLocation getCurrentWorldLocation() {\n    if (character == null || character.getCurrentLocationId() == null) {\n        return null;\n    }\n    // Requires worldLocationRepository lookup\n    return worldLocationRepository.findById(\n        character.getCurrentLocationId()\n    ).orElse(null);\n}\n\npublic String getCurrentLocationName() {\n    WorldLocation loc = getCurrentWorldLocation();\n    return loc != null ? loc.getName() : \"Unknown\";\n}\n```\n\n**Update GameCharacter.java:**\n```java\n// REMOVE:\n@Column(name = \"current_position_id\")\nprivate UUID currentPositionId;\n\n// KEEP:\n@Column(name = \"current_location_id\")\nprivate UUID currentLocationId;\n```\n\n#### 3. Service Layer Changes\n\n**Update 17 locations using string:**\n\nBefore:\n```java\nString location = player.getCurrentLocation();\n```\n\nAfter:\n```java\nWorldLocation location = getPlayerWorldLocation(player);\nString locationName = location != null ? location.getName() : \"Unknown\";\n```\n\n**Helper method (add to PlayerService or utility):**\n```java\nprivate WorldLocation getPlayerWorldLocation(Player player) {\n    if (player.getCharacter() == null) return null;\n    UUID locationId = player.getCharacter().getCurrentLocationId();\n    if (locationId == null) return null;\n    return worldLocationRepository.findById(locationId).orElse(null);\n}\n```\n\n**Update SceneTransitionOrchestrator:**\n\nBefore:\n```java\nplayer.setCurrentLocation(locationName);  // STRING\nplayer.getCharacter().setCurrentLocationId(locationId);  // UUID\n```\n\nAfter:\n```java\n// Single update - WorldLocation is source of truth\nplayer.getCharacter().setCurrentLocationId(locationId);\nplayer.setMicroPosition(null);  // Clear on scene transition (FR-215)\n```\n\n#### 4. Arc Generation - Unique Location Validation\n\n**Update ArcGenerationService.java:**\n\nAdd validation after parsing arc XML:\n```java\nprivate void validateUniqueLocationNames(ArcGenerationResponse response) {\n    Set<String> locationNames = new HashSet<>();\n\n    for (PlotBeatDto beat : response.getPlotBeats()) {\n        String locationName = beat.getLocationName();\n        if (locationName == null || locationName.isBlank()) {\n            throw new ArcGenerationException(\n                \"Beat \" + beat.getPhaseOrder() + \" missing location_name\"\n            );\n        }\n\n        if (!locationNames.add(locationName)) {\n            throw new ArcGenerationException(\n                \"Duplicate location name '\" + locationName +\n                \"' found in beats. Each beat must have a unique location.\"\n            );\n        }\n    }\n\n    log.info(\"Validated {} unique locations across {} beats\",\n        locationNames.size(), response.getPlotBeats().size());\n}\n```\n\n**Update Arc Generation Prompts:**\n\nAdd to beat XML template:\n```xml\n<beat phase_order=\"1\" structure_phase=\"Setup\">\n  <location_name>Situation Room</location_name>  <!-- NEW: Required! -->\n  <description>What happens</description>\n  <objective>Clear action</objective>\n</beat>\n<beat phase_order=\"2\" structure_phase=\"Investigation\">\n  <location_name>Hotel Bar</location_name>  <!-- DIFFERENT location! -->\n  <description>What happens</description>\n  <objective>Clear action</objective>\n</beat>\n```\n\nAdd validation rule to prompt:\n```\nüö® LOCATION NAMING RULES (CRITICAL):\n- Each beat MUST have a different location_name\n- Do NOT reuse the same location across multiple beats\n- Examples of GOOD arc locations:\n  Beat 1: \"Situation Room\"\n  Beat 2: \"Hotel Bar\"\n  Beat 3: \"Press Briefing Room\"\n- Examples of BAD arc locations:\n  Beat 1: \"Situation Room\"\n  Beat 2: \"Situation Room\"  ‚ùå WRONG - duplicate!\n```\n\n#### 5. Prompt Changes (Minimal)\n\n**TwoTierNarrativeService.java - buildSpatialContextSection():**\n\nBefore:\n```java\nString location = player.getCurrentLocation();\n```\n\nAfter:\n```java\nWorldLocation locationEntity = getPlayerWorldLocation(player);\nString location = locationEntity != null ? locationEntity.getName() : \"Unknown\";\n```\n\n**Output stays identical:**\n```\n[SPATIAL - LOCATION ENFORCEMENT]\nCurrent Location: Situation Room\n\n[PLAYER POSITIONS - WHERE EACH PLAYER IS WITHIN THE SCENE]\n- Director Rachel Morse: next to the Intelligence Chief\n- Senator Ethan Thompson: 5 feet from Mia\n```\n\n**No other prompt changes needed!** The prompts already use location name strings, we're just changing where the string comes from.\n\n#### 6. Repository Cleanup\n\n**Remove:**\n- `WorldRegionRepository.java`\n- `WorldAreaRepository.java`\n- `WorldPositionRepository.java`\n- `LocationConnectionRepository.java`\n- `PositionAdjacencyRepository.java`\n\n**Keep:**\n- `WorldLocationRepository.java`\n\n**Add query:**\n```java\npublic interface WorldLocationRepository extends JpaRepository<WorldLocation, UUID> {\n    List<WorldLocation> findBySessionId(UUID sessionId);\n    Optional<WorldLocation> findBySessionIdAndName(UUID sessionId, String name);\n}\n```\n\n### Effort Estimate - Phase 1\n\n| Task | Files | Hours |\n|------|-------|-------|\n| Database migration (drop tables/columns) | 1 | 0.5 |\n| Remove unused entities | 5 | 0.5 |\n| Update Player/GameCharacter models | 2 | 1.0 |\n| Update service layer (17 locations) | 8 | 2.0 |\n| Arc generation validation | 1 | 1.0 |\n| Arc generation prompts | 1 | 0.5 |\n| Prompt updates (2 sections) | 1 | 0.5 |\n| Remove unused repositories | 5 | 0.5 |\n| Testing (build + core test) | - | 1.5 |\n| **Total** | **24** | **8.0** |\n\n### Risks - Phase 1\n\n| Risk | Mitigation |\n|------|------------|\n| Tests break | Fix as we go - acceptable pre-beta |\n| Null location references | Add null-safety checks, default to \"Unknown\" |\n| Performance (joins) | WorldLocation usually already loaded with Scene/Beat |\n| Migration fails | Test locally first, backup production DB |\n\n### Success Criteria - Phase 1\n\n‚úÖ All tests pass (mvn clean install)\n‚úÖ Core test runs successfully with unique locations per beat\n‚úÖ No more dual location tracking\n‚úÖ Transcript shows distinct location names per scene\n‚úÖ No `player.getCurrentLocation()` string calls remain\n\n---\n\n## PHASE 2: Structured Zone System (OPTIONAL ENHANCEMENT)\n\n### Objectives\n\n1. **Add zone structure** - Defined areas within scenes\n2. **Zone features** - Cover, lighting, exits for tactical gameplay\n3. **Enhanced prompts** - Show zones with tactical information\n4. **Backward compatible** - Zones optional, microPosition still works\n\n### Why Phase 2?\n\n**Pros:**\n- ‚úÖ Richer tactical gameplay (cover, elevation, exits)\n- ‚úÖ Clearer movement mechanics\n- ‚úÖ Validation (can't be in two zones at once)\n- ‚úÖ Zone-based abilities/rules possible\n- ‚úÖ Better pathfinding for AI/movement\n\n**Cons:**\n- ‚ùå More complex prompts (zone context, features)\n- ‚ùå More LLM tokens per turn (zone descriptions)\n- ‚ùå Zone generation logic needed\n- ‚ùå Additional data model\n- ‚ùå Mechanics changes for zone transitions\n\n**Could be added post-beta?** **YES!** ‚úÖ\n- Backward compatible (nullable currentZoneId)\n- Zones only generated for new scenes\n- Old scenes work without zones\n- Can ship with zones disabled, enable later\n\n### Changes Required\n\n#### 1. Database Schema\n\n**Add SceneZone entity:**\n```sql\nCREATE TABLE scene_zones (\n  id UUID PRIMARY KEY,\n  scene_id UUID NOT NULL REFERENCES scenes(id),\n  name VARCHAR(100) NOT NULL,\n  description TEXT,\n  position_order INTEGER,\n  tactical_features JSONB,\n  created_at TIMESTAMP DEFAULT NOW(),\n\n  CONSTRAINT unique_zone_per_scene UNIQUE (scene_id, name)\n);\n\nCREATE INDEX idx_scene_zones_scene ON scene_zones(scene_id);\n```\n\n**Add player zone FK:**\n```sql\nALTER TABLE players\n  ADD COLUMN current_zone_id UUID REFERENCES scene_zones(id);\n\n-- Nullable - zones optional\n```\n\n**Tactical features JSON structure:**\n```json\n{\n  \"cover\": true,\n  \"cover_type\": \"partial\",\n  \"elevation\": \"ground\",\n  \"lighting\": \"bright\",\n  \"concealment\": false,\n  \"exits\": [\"kitchen\", \"street\"],\n  \"items\": [\"bottles\", \"chairs\"],\n  \"danger\": 1\n}\n```\n\n#### 2. Domain Model\n\n**Add SceneZone.java:**\n```java\n@Entity\n@Table(name = \"scene_zones\")\npublic class SceneZone {\n    @Id\n    private UUID id;\n\n    @NotNull\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"scene_id\")\n    private Scene scene;\n\n    @NotBlank\n    @Column(length = 100)\n    private String name;\n\n    @Column(columnDefinition = \"TEXT\")\n    private String description;\n\n    @Column(name = \"position_order\")\n    private Integer positionOrder;\n\n    @Type(JsonBinaryType.class)\n    @Column(name = \"tactical_features\", columnDefinition = \"jsonb\")\n    private Map<String, Object> tacticalFeatures;\n\n    @CreationTimestamp\n    private OffsetDateTime createdAt;\n\n    // Getters/setters\n}\n```\n\n**Update Player.java:**\n```java\n@ManyToOne(fetch = FetchType.LAZY)\n@JoinColumn(name = \"current_zone_id\")\nprivate SceneZone currentZone;  // Nullable - zones optional\n```\n\n**Update Scene.java:**\n```java\n@OneToMany(mappedBy = \"scene\", fetch = FetchType.LAZY)\nprivate List<SceneZone> zones = new ArrayList<>();\n```\n\n#### 3. Zone Generation\n\n**Add ZoneGenerationService.java:**\n```java\n@Service\npublic class ZoneGenerationService {\n\n    /**\n     * Generate 2-4 zones for a scene based on location type.\n     * Uses LLM to create narratively interesting zones.\n     */\n    public List<SceneZone> generateZonesForScene(\n        Scene scene,\n        WorldLocation location\n    ) {\n        // Build prompt for zone generation\n        String prompt = buildZonePrompt(scene, location);\n\n        // Call LLM (Groq/Claude)\n        ClaudeResponse response = llmClient.chat(prompt, 500);\n\n        // Parse zones from XML\n        List<SceneZone> zones = parseZonesFromXml(response.getContent(), scene);\n\n        // Validate 2-4 zones\n        if (zones.size() < 2 || zones.size() > 4) {\n            log.warn(\"Generated {} zones, expected 2-4\", zones.size());\n        }\n\n        // Save zones\n        return sceneZoneRepository.saveAll(zones);\n    }\n\n    private String buildZonePrompt(Scene scene, WorldLocation location) {\n        return String.format(\"\"\"\n            Generate 2-4 tactical zones for this scene.\n\n            LOCATION: %s (%s)\n            TYPE: %s\n            SCENE: %s\n\n            Create zones that are:\n            - Narratively interesting (unique features)\n            - Tactically distinct (different cover/elevation/lighting)\n            - Physically logical (make sense in this location type)\n\n            Output XML:\n            <zones>\n              <zone order=\"1\">\n                <name>Bar Counter</name>\n                <description>Oak bar with bottles and glassware</description>\n                <cover>true</cover>\n                <cover_type>partial</cover_type>\n                <elevation>ground</elevation>\n                <lighting>bright</lighting>\n                <items>bottles, mugs, bar stools</items>\n                <exits>storage room</exits>\n              </zone>\n              <zone order=\"2\">\n                <name>Tables Area</name>\n                <description>Open dining area with wooden tables</description>\n                <cover>false</cover>\n                <elevation>ground</elevation>\n                <lighting>bright</lighting>\n                <items>chairs, tables</items>\n              </zone>\n            </zones>\n            \"\"\",\n            location.getName(),\n            location.getDescription(),\n            location.getLocationType(),\n            scene.getDescription()\n        );\n    }\n}\n```\n\n#### 4. Scene Setup Integration\n\n**Update StoryDrivenSceneGenerator.java:**\n```java\nprivate Scene generateSceneFromBeat(...) {\n    // ... existing scene creation ...\n\n    // FR-XXX: Generate zones for scene\n    if (beat.getLocation() != null && shouldGenerateZones(beat)) {\n        List<SceneZone> zones = zoneGenerationService\n            .generateZonesForScene(scene, beat.getLocation());\n        scene.setZones(zones);\n        log.info(\"Generated {} zones for scene {}\", zones.size(), scene.getId());\n    }\n\n    return scene;\n}\n\nprivate boolean shouldGenerateZones(SimplePlotBeat beat) {\n    // Generate zones for combat/tactical scenes, skip for social/narrative\n    return beat.getBeatType() != null &&\n        (beat.getBeatType().contains(\"combat\") ||\n         beat.getBeatType().contains(\"investigation\"));\n}\n```\n\n#### 5. Prompt Updates (Major Changes)\n\n**TwoTierNarrativeService.java - buildSpatialContextSection():**\n\nAdd zone context BEFORE player positions:\n```java\n// Show zones if scene has them\nif (scene.getZones() != null && !scene.getZones().isEmpty()) {\n    spatial.append(\"\\n[SCENE ZONES - TACTICAL AREAS]\\n\");\n    for (SceneZone zone : scene.getZones()) {\n        spatial.append(\"- \").append(zone.getName());\n        spatial.append(\" (\");\n\n        // Show tactical features\n        Map<String, Object> features = zone.getTacticalFeatures();\n        if (features != null) {\n            if (Boolean.TRUE.equals(features.get(\"cover\"))) {\n                spatial.append(\"cover, \");\n            }\n            if (\"elevated\".equals(features.get(\"elevation\"))) {\n                spatial.append(\"elevated, \");\n            }\n            if (\"dim\".equals(features.get(\"lighting\"))) {\n                spatial.append(\"dim lighting, \");\n            }\n            if (features.containsKey(\"exits\")) {\n                spatial.append(\"exits: \").append(features.get(\"exits\"));\n            }\n        }\n\n        spatial.append(\")\\n\");\n        spatial.append(\"  Description: \").append(zone.getDescription()).append(\"\\n\");\n    }\n    spatial.append(\"\\n\");\n}\n\n// Then show player positions WITH zones\nif (!playerMicroPositions.isEmpty()) {\n    spatial.append(\"[PLAYER POSITIONS - WHERE EACH PLAYER IS]\\n\");\n    for (Map.Entry<String, String> entry : playerMicroPositions.entrySet()) {\n        String playerName = entry.getKey();\n        String microPos = entry.getValue();\n\n        // Get player's zone if set\n        Player player = findPlayer(playerName);\n        SceneZone zone = player.getCurrentZone();\n\n        if (zone != null) {\n            spatial.append(\"- \").append(playerName)\n                .append(\" (\").append(zone.getName()).append(\"): \")\n                .append(microPos).append(\"\\n\");\n        } else {\n            spatial.append(\"- \").append(playerName).append(\": \")\n                .append(microPos).append(\"\\n\");\n        }\n    }\n}\n```\n\n**Example output:**\n```\n[SCENE ZONES - TACTICAL AREAS]\n- Bar Counter (cover, items: bottles/mugs, exits: kitchen)\n  Description: Sturdy oak bar with brass fixtures\n- Tables Area (open, no cover)\n  Description: Wooden tables and chairs scattered across main room\n- Fireplace Alcove (dim lighting, concealment, exits: back door)\n  Description: Stone fireplace with shadowed corners\n\n[PLAYER POSITIONS - WHERE EACH PLAYER IS]\n- Rylan (Bar Counter): ducked behind bar, grabbing bottle\n- Marcus (Tables Area): overturned table for cover\n- Kaelin (Fireplace Alcove): shadows near fireplace, bow ready\n```\n\n**Add zone movement rules:**\n```java\nspatial.append(\"\\n‚ö†Ô∏è ZONE MOVEMENT RULES:\\n\");\nspatial.append(\"- Free movement WITHIN your current zone\\n\");\nspatial.append(\"- Moving to ADJACENT zone costs your movement action\\n\");\nspatial.append(\"- Zones with obstacles (locked doors, cliffs) require skill checks\\n\");\nspatial.append(\"- Describe HOW character moves between zones\\n\");\nspatial.append(\"- Can't interact with things in other zones unless ranged\\n\");\n```\n\n#### 6. Mechanics Updates\n\n**Add zone transition mechanics:**\n```java\n// In MechanicsApplicationService.java\nprivate void applyZoneChanges(\n    List<ZoneChangeUpdate> zoneChanges,\n    GameSession session\n) {\n    for (ZoneChangeUpdate change : zoneChanges) {\n        Player player = findPlayer(change.getPlayerId());\n        SceneZone newZone = findZone(change.getNewZoneId());\n\n        // Validate movement allowed\n        if (!canMoveToZone(player.getCurrentZone(), newZone)) {\n            log.warn(\"Player {} cannot move from {} to {} - blocked\",\n                player.getId(),\n                player.getCurrentZone().getName(),\n                newZone.getName());\n            continue;\n        }\n\n        // Update zone\n        player.setCurrentZone(newZone);\n        player.setMicroPosition(change.getNewMicroPosition());\n\n        log.info(\"Player {} moved to zone {}\",\n            player.getId(), newZone.getName());\n    }\n}\n```\n\n#### 7. Validation\n\n**Add zone validation in Tier 1:**\n```xml\n<zone_changes>\n  <zone_change>\n    <player_id>UUID</player_id>\n    <from_zone>Bar Counter</from_zone>\n    <to_zone>Tables Area</to_zone>\n    <movement_description>Rylan dashes across open floor</movement_description>\n  </zone_change>\n</zone_changes>\n```\n\n### Effort Estimate - Phase 2\n\n| Task | Files | Hours |\n|------|-------|-------|\n| Database migration (add tables) | 1 | 0.5 |\n| SceneZone entity + repository | 2 | 1.0 |\n| ZoneGenerationService | 1 | 2.5 |\n| Scene setup integration | 1 | 1.0 |\n| Prompt updates (5-8 sections) | 1 | 3.0 |\n| Mechanics (zone transitions) | 1 | 2.0 |\n| Validation (zone changes in Tier 1) | 1 | 1.5 |\n| Testing (zones in core test) | - | 2.0 |\n| **Total** | **8** | **13.5** |\n\n### Risks - Phase 2\n\n| Risk | Mitigation |\n|------|------------|\n| LLM generates bad zones | Fallback to simple 2-zone split (front/back) |\n| Zone prompts too verbose | Make zones optional, only for combat scenes |\n| Complex zone rules | Start simple, expand post-beta |\n| Backward compatibility | Nullable zone FK, works without zones |\n\n### Success Criteria - Phase 2\n\n‚úÖ Zones generated for combat/tactical scenes\n‚úÖ Prompts show zone features and player positions\n‚úÖ Players can move between zones via actions\n‚úÖ Old scenes without zones still work\n‚úÖ Core test transcript shows zone positioning\n\n---\n\n## Comparison: Phase 1 vs Phase 2\n\n| Aspect | Phase 1 | Phase 2 |\n|--------|---------|---------|\n| **Effort** | 8 hours | 13.5 hours |\n| **Files Changed** | 24 | 32 |\n| **Database Migrations** | 1 (drop columns/tables) | 2 (drop + add zones) |\n| **Prompt Changes** | Minimal (2 sections) | Major (5-8 sections) |\n| **LLM Token Impact** | None | +100-200 tokens/turn |\n| **Gameplay Impact** | Bug fixes only | New tactical depth |\n| **Backward Compatible** | Breaking (no old games) | Yes (nullable zones) |\n| **Post-Beta Viable** | No - must fix now | Yes - can add later |\n| **Risk** | Low | Medium |\n\n---\n\n## Recommendation\n\n### Do Phase 1 NOW (Pre-Beta)\n\n**Why:**\n- ‚úÖ **Must fix bugs** - Dual tracking and location reuse are broken\n- ‚úÖ **Minimal effort** - 8 hours, clean architecture\n- ‚úÖ **No backward compat needed** - No production users\n- ‚úÖ **Foundation for future** - Clean base to build on\n- ‚úÖ **Low risk** - Mostly cleanup, small prompt changes\n\n**Phase 1 gives us:**\n- Single source of truth for locations\n- Unique locations per beat (fixes narrative confusion)\n- Clean data model (remove unused 4-tier hierarchy)\n- Foundation for zones if we want them later\n\n### Do Phase 2 POST-BETA (Optional)\n\n**Why:**\n- ‚úÖ **Backward compatible** - Can add without breaking existing games\n- ‚úÖ **Understand player needs first** - See if zones needed in beta\n- ‚úÖ **Complex addition** - 13.5 hours, major prompt changes\n- ‚úÖ **Current system works** - microPosition already tactical\n- ‚úÖ **Not urgent** - Nice to have, not must-have\n\n**Phase 2 considerations:**\n- Wait for beta feedback - do players want more tactical depth?\n- Current free-form microPosition already provides positioning\n- Zones add structure but also complexity\n- Can ship \"zones v1\" post-beta if players request it\n\n---\n\n## Implementation Plan (Phase 1 Only)\n\n### Week 1: Core Refactoring\n1. Create database migration (drop unused tables/columns)\n2. Remove unused entity classes\n3. Update Player/GameCharacter models\n4. Add helper methods for location access\n\n### Week 2: Service Layer + Arc Generation\n5. Update 17 service locations using string field\n6. Update SceneTransitionOrchestrator\n7. Add arc generation validation (unique names)\n8. Update arc generation prompts\n\n### Week 3: Testing + Deployment\n9. Run mvn clean install - fix any test failures\n10. Run core test suite - verify unique locations\n11. Check transcripts for location clarity\n12. Deploy to Railway (no users to migrate)\n\n**Timeline:** 3 weeks part-time (8-10 hours total)\n\n---\n\n## Post-Beta Evaluation Criteria for Phase 2\n\nBefore adding Phase 2 zones, answer:\n\n1. **Do players request tactical positioning?** (beta feedback)\n2. **Are combats too simple without zones?** (gameplay analysis)\n3. **Does free-form microPosition cause confusion?** (transcript review)\n4. **Do we have bandwidth for 13.5 hours?** (team capacity)\n5. **Is token cost acceptable?** (+100-200 tokens/turn)\n\nIf YES to 3+ questions ‚Üí Implement Phase 2\nIf NO to most ‚Üí Keep current system\n\n---\n\n## Appendix: Migration SQL\n\n### Phase 1 Migration (V088)\n\n```sql\n-- Drop unused spatial hierarchy\nDROP TABLE IF EXISTS position_adjacency CASCADE;\nDROP TABLE IF EXISTS location_connections CASCADE;\nDROP TABLE IF EXISTS world_positions CASCADE;\nDROP TABLE IF EXISTS world_areas CASCADE;\nDROP TABLE IF EXISTS world_regions CASCADE;\n\n-- Drop dual location tracking\nALTER TABLE players DROP COLUMN IF EXISTS current_location;\nALTER TABLE game_characters DROP COLUMN IF EXISTS current_position_id;\n\n-- Add unique constraint for location names per session\nALTER TABLE world_locations\n  ADD CONSTRAINT unique_location_per_session\n  UNIQUE (session_id, name);\n\n-- Add comments for clarity\nCOMMENT ON COLUMN game_characters.current_location_id IS\n  'UUID FK to world_locations - single source of truth for location';\nCOMMENT ON COLUMN players.micro_position IS\n  'Free-form text describing position within scene (e.g., \"behind bar\", \"5 feet from NPC\")';\n```\n\n### Phase 2 Migration (V089 - Future)\n\n```sql\n-- Add scene zones\nCREATE TABLE scene_zones (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  scene_id UUID NOT NULL REFERENCES scenes(id) ON DELETE CASCADE,\n  name VARCHAR(100) NOT NULL,\n  description TEXT,\n  position_order INTEGER,\n  tactical_features JSONB,\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n  CONSTRAINT unique_zone_per_scene UNIQUE (scene_id, name)\n);\n\nCREATE INDEX idx_scene_zones_scene ON scene_zones(scene_id);\n\n-- Add player zone FK (nullable - zones optional)\nALTER TABLE players\n  ADD COLUMN current_zone_id UUID REFERENCES scene_zones(id) ON DELETE SET NULL;\n\nCREATE INDEX idx_players_zone ON players(current_zone_id);\n\n-- Add comments\nCOMMENT ON TABLE scene_zones IS\n  'Tactical zones within scenes (2-4 per scene) with cover/lighting/exits';\nCOMMENT ON COLUMN players.current_zone_id IS\n  'Optional zone within current scene - nullable for backward compatibility';\n```\n\n---\n\n**End of Requirements Document**\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/LOCATION-REFACTORING-REQUIREMENTS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "async",
        "md"
      ],
      "content_hash": "1a37e0761df7057b",
      "size_bytes": 28161,
      "created_at": "2026-01-02T20:42:12.435301"
    },
    {
      "doc_id": "local_party-lore_REALM-MECHANICS-AUDIT",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/REALM-MECHANICS-AUDIT.md",
      "content": "# Realm Mechanics Support Audit\n\n**Date**: December 2024\n**Status**: GAPS IDENTIFIED - Realm-specific mechanics not properly supported in prompts\n**Impact**: HIGH - Roses & Ruin social combat not being used, generic combat assumed\n\n---\n\n## Executive Summary\n\n**The Problem**: Party Lore has excellent realm-specific mechanics (social combat for Roses & Ruin, status damage, courtship progression), but **prompts don't tell the LLM to use them**.\n\n**What's Working**:\n- ‚úÖ Universal database schema (BAMS stats, polymorphic HP/Mana)\n- ‚úÖ Realm JSON configurations are comprehensive\n- ‚úÖ Database correctly stores realm-specific data\n\n**What's Broken**:\n- ‚ùå Tier 1 (Mechanics) prompts assume physical combat (\"attack\", \"HP damage\")\n- ‚ùå Tier 2 (Narrative) prompts describe swords/guns, not Wit/Charm attacks\n- ‚ùå Quality analysis doesn't validate realm-appropriate mechanics were used\n- ‚ùå Tests don't verify Status damage vs HP damage for social realms\n- ‚ùå OpeningNarrativeGenerator doesn't mention realm mechanics systems\n\n**Result**: Reality test in Roses & Ruin generated generic \"approaching and greeting\" instead of social intrigue with Wit attacks and Status damage.\n\n---\n\n## 1. Database Layer (‚úÖ WORKING)\n\n### Universal Schema Design\n\n**Status**: ‚úÖ **EXCELLENT** - Polymorphic design handles all realm types\n\nThe database correctly uses universal fields that map to realm-specific concepts:\n\n| Universal Field | Fantasy Realm | Roses & Ruin | Cyberpunk |\n|----------------|---------------|--------------|-----------|\n| **BAMS Stats** |\n| `body` | Strength | **Composure** | Body |\n| `agility` | Dexterity | **Grace** | Reflexes |\n| `mind` | Intelligence | **Wit** | Logic |\n| `spirit` | Wisdom | **Charm** | Cool |\n| **Resources** |\n| `currentHp` / `maxHp` | Hit Points | **Status (0-100)** | Neural Stress |\n| `currentMana` / `maxMana` | Spell Points | **Influence** | RAM |\n| **Combat Mechanics** |\n| Offense Type | Sword Attack | **Wit/Charm/Scandal Attack** | Cyberdeck Hack |\n| Defense Type | Armor Class | **Grace/Alliance Defense** | ICE Protection |\n| Damage Target | HP | **Status** | Neural Stress |\n\n**Key Files**:\n- `party-lore-domain/src/main/java/com/partylore/domain/model/GameCharacter.java:91-153` - BAMS stats, polymorphic HP/Mana\n- `party-lore-domain/src/main/resources/realms/rosesandruin.json:287-498` - Full social combat config\n\n**Evidence from Realm JSON** (rosesandruin.json):\n```json\n\"offenseTypes\": [\n  {\"name\": \"Wit Attack\", \"damageRange\": \"5-12\", \"cost\": 2},\n  {\"name\": \"Charm Offensive\", \"damageRange\": \"3-10\", \"cost\": 1},\n  {\"name\": \"Scandal Exposure\", \"damageRange\": \"8-15\", \"cost\": 3}\n],\n\"defenseTypes\": [\n  {\"name\": \"Grace Under Pressure\", \"mitigation\": \"50%\"},\n  {\"name\": \"Wit Parry\", \"mitigation\": \"40%\"}\n]\n```\n\n**Conclusion**: Database layer is perfect. The problem is NOT here.\n\n---\n\n## 2. Prompt Layer (‚ùå BROKEN)\n\n### Gap 1: Tier 1 Mechanics Prompts Assume Physical Combat\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/ModeSpecificPrompts.java`\n\n**Problem**: Combat rules describe HP damage, physical attacks, swords/guns - **no mention of social combat**.\n\n**Evidence** (ModeSpecificPrompts.java:26-99):\n```java\nTIER1_COMBAT_RULES = \"\"\"\n    COMBAT RULES:\n    - DEFENSE SUCCESS = player avoided attack, delta=\"0\"\n    - DEFENSE FAILURE = player was hit, delta=\"-5\" to \"-10\"\n    - ACTION SUCCESS = player attack hits NPC\n    - Track NPC HP: <npc_hp_change npc_id=\"NPC-001\" delta=\"-N\">reason</npc_hp_change>\n    - NPC at 0 HP = DEFEATED\n\"\"\"\n```\n\n**What's Missing**:\n- ‚ùå No mention of \"Status damage\" for social realms\n- ‚ùå No mention of \"Wit/Charm/Scandal attacks\" vs physical attacks\n- ‚ùå No realm-conditional logic (if social_combat realm, use Status; else use HP)\n- ‚ùå No guidance on courtship progression, reputation tracking, scandal mechanics\n\n**Impact**: LLM defaults to generic \"attack\" and \"HP damage\" because that's what the prompt says.\n\n---\n\n### Gap 2: Tier 2 Narrative Prompts Describe Physical Combat\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/ModeSpecificPrompts.java`\n\n**Problem**: Narrative examples show bullets, blades, physical violence - **no social combat examples**.\n\n**Evidence** (ModeSpecificPrompts.java:269-316):\n```java\nTIER2_COMBAT_RULES = \"\"\"\n    COMBAT NARRATIVE RULES:\n    1. Describe CONSEQUENCES, not actions\n       WRONG: \"Nova fires her gun\"\n       RIGHT: \"Bullets slam into the target\"\n    3. Show damage/impact viscerally\n       - Hits: describe impact with DAMAGE NUMBER and HP\n\"\"\"\n```\n\n**What's Missing**:\n- ‚ùå No examples of social combat narration (\"Lady Ashford's cutting remark slices through Lord Pemberton's composure\")\n- ‚ùå No guidance on Status damage display (\"Lady Ashford recoils, her reputation damaged! -8 Status (Status: 67/100)\")\n- ‚ùå No examples of Wit attacks, Charm offensives, Scandal exposure\n- ‚ùå No courtship scene examples\n\n**Impact**: LLM narrates physical combat because all examples are physical.\n\n---\n\n### Gap 3: OpeningNarrativeGenerator Missing Mechanics Context\n\n**File**: `party-lore-game/src/main/java/com/partylore/game/scene/OpeningNarrativeGenerator.java`\n\n**Problem**: Opening prompts don't tell LLM what mechanics systems are active.\n\n**Evidence** (OpeningNarrativeGenerator.java:806-1068):\n- ‚úÖ Includes realm description, tone, narrative style\n- ‚úÖ Includes genre constraints (FR-215 Tier 0.5)\n- ‚úÖ Includes NPC proactivity guidance\n- ‚ùå **MISSING**: Mechanics system summary (social_combat: true, combat uses Status not HP)\n\n**What Should Be Added**:\n```java\n// [REALM MECHANICS] - CRITICAL\nif (realm.getMechanicsConfig().containsKey(\"social_combat\") &&\n    realm.getMechanicsConfig().get(\"social_combat\").equals(true)) {\n    prompt.append(\"[REALM MECHANICS - SOCIAL COMBAT SYSTEM]\\n\");\n    prompt.append(\"This realm uses SOCIAL COMBAT, not physical violence:\\n\");\n    prompt.append(\"- Attacks: Wit, Charm, Scandal (not swords/guns)\\n\");\n    prompt.append(\"- Damage target: Status (not Hit Points)\\n\");\n    prompt.append(\"- Victory: Social ruin (Status < 20), not death\\n\");\n    prompt.append(\"- Setting: Ballrooms, drawing rooms, not battlefields\\n\\n\");\n}\n```\n\n**Impact**: Opening narratives don't establish the combat system, so LLM defaults to generic RPG assumptions.\n\n---\n\n### Gap 4: Tier 0.5 Content Generation Missing Mechanics Guidance\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/Tier05ContentGenerator.java`\n\n**Current Coverage**:\n- ‚úÖ Closing line style rotation (SCENE_ELEMENT, BINARY_CHOICE, etc.)\n- ‚úÖ Genre constraints (time period, anachronism prevention)\n- ‚úÖ Pacing guidance (inject complications after 3+ turns)\n- ‚úÖ NPC proactivity guidance\n\n**What's Missing**:\n- ‚ùå **Mechanics system guidance** - No content category for realm-specific combat/mechanics\n- ‚ùå No fallback that detects social_combat: true and injects appropriate prompts\n\n**Recommendation**: Add new ContentCategory:\n```java\npublic enum ContentCategory {\n    CLOSING_LINE_EXAMPLES,\n    GENRE_CONSTRAINTS,\n    PACING_GUIDANCE,\n    NPC_PROACTIVITY,\n    MECHANICS_SYSTEM_GUIDANCE  // NEW - Describes realm's combat/progression mechanics\n}\n```\n\n---\n\n## 3. Quality Analysis (‚ö†Ô∏è PARTIAL)\n\n### Current Validation\n\n**File**: `party-lore-ai/src/main/java/com/partylore/ai/quality/NarrativeQualityAnalysisService.java`\n\n**What It Validates** (NarrativeQualityAnalysisService.java:0-350):\n```java\nMECHANICS ISSUES (affect gameplay_logic):\n* MECHANICAL_ERROR - HP/damage/skill calculations wrong\n* STATE_MISMATCH - Narrative doesn't match game state\n* RULE_VIOLATION - Game rules violated\n```\n\n**What It Doesn't Validate**:\n- ‚ùå **Realm-appropriate mechanics usage** - No check for \"Did Roses & Ruin use Wit attacks or swords?\"\n- ‚ùå **Status vs HP damage** - No validation that social realms damaged Status, not HP\n- ‚ùå **Courtship progression** - No check that romance mechanics were used\n- ‚ùå **Anachronisms** - Now partially covered by Tier 0.5 genre constraints, but not validated post-generation\n\n**Quality Score Breakdown**:\nThe reality test scored **6.75/10** with issues:\n1. ‚úÖ **Anachronisms** - NOW FIXED (Tier 0.5 genre constraints)\n2. ‚úÖ **Repetitive closing** - NOW FIXED (Tier 0.5 closing line rotation)\n3. ‚ö†Ô∏è **Static scenes** - PARTIALLY FIXED (Tier 0.5 pacing guidance)\n4. ‚ùå **Passive NPCs** - PARTIALLY FIXED (Tier 0.5 NPC proactivity, but still no mechanics guidance)\n5. ‚ùå **MISSING**: Realm mechanics not being used (generic combat instead of social combat)\n\n---\n\n## 4. Test Coverage (‚ö†Ô∏è PARTIAL)\n\n### Realm Mechanics Test Scenarios\n\n**File**: `party-lore-game/src/main/java/com/partylore/game/testing/TestScenarioGenerator.java`\n\n**Current Test Scenarios** (TestScenarioGenerator.java:524-603):\n```java\nprivate List<TestScenarioConfig> generateRealmMechanicsScenarios() {\n    // FR-202 Precedent Establishment - First weapon use\n    // FR-202 Precedent Enforcement - Consistent damage\n    // FR-202 Capability Validation - Class restrictions\n    // FR-202 Status Effect - Application and Tracking\n    // FR-202 Status Effect - Expiration\n}\n```\n\n**What Tests Cover**:\n- ‚úÖ Precedent establishment (first weapon use creates damage range)\n- ‚úÖ Precedent enforcement (subsequent uses follow range)\n- ‚úÖ Class restrictions (Fighter can't cast spells)\n- ‚úÖ Status effects (poison, stun tracking)\n\n**What Tests Don't Cover**:\n- ‚ùå **Social combat validation** - No test verifies Wit/Charm attacks used in Roses & Ruin\n- ‚ùå **Status vs HP damage** - No test checks that social realms damage Status field, not HP\n- ‚ùå **Courtship mechanics** - No test verifies romance progression tracked\n- ‚ùå **Scandal/Reputation** - No test validates scandal exposure mechanics\n- ‚ùå **Realm-appropriate narration** - No test checks narrative matches mechanics (ballroom vs battlefield)\n\n**Test Suite Configuration** (TestScenarioGenerator.java:81-83):\n```java\nif (config.includeRealmMechanics()) {\n    scenarios.addAll(generateRealmMechanicsScenarios());\n}\n```\n\nThe flag exists, but scenarios are generic precedent tests, not realm-specific validation.\n\n---\n\n## 5. Arc Generation (‚úÖ WORKING)\n\n### Arc Templates Are Realm-Aware\n\n**File**: `party-lore-domain/src/main/resources/realms/rosesandruin.json`\n\n**Evidence** (rosesandruin.json:352-395):\n```json\n\"arcTemplates\": [\n  {\n    \"name\": \"Season Opens\",\n    \"type\": \"social_season_start\",\n    \"objective\": \"Establish your reputation at the first ball of the social season\"\n  },\n  {\n    \"name\": \"Rival's Scheme\",\n    \"type\": \"social_intrigue\",\n    \"objective\": \"Uncover and counter a rival's plot to ruin your family's name\"\n  }\n]\n```\n\n**Status**: ‚úÖ **WORKING** - Arc templates are realm-appropriate (social intrigue, not dungeon crawls)\n\n**Test Integration** (TestScenarioGenerator.java:98-120):\n```java\n// Override objectives with realm-appropriate ones from arc templates\nArcTemplate matchingTemplate = config.findMatchingTemplate(scenario.name);\nif (matchingTemplate != null) {\n    scenario.objective = matchingTemplate.getObjective();\n}\n```\n\n**Conclusion**: Arc generation is good. The problem is that **prompts don't tell LLM how to narrate these social arcs**.\n\n---\n\n## 6. Detailed Gap Analysis\n\n### Priority 1: Tier 1 Mechanics Prompts (CRITICAL)\n\n**File**: `ModeSpecificPrompts.java`\n**Impact**: HIGH - Directly determines what mechanics LLM applies\n\n**Current State**:\n```java\nTIER1_COMBAT_RULES = \"\"\"\n    - ACTION SUCCESS = player attack hits NPC\n    - Track NPC HP: <npc_hp_change npc_id=\"NPC-001\" delta=\"-N\">\n    - NPC at 0 HP = DEFEATED\n\"\"\"\n```\n\n**Required Changes**:\n1. Add realm mechanics detection in `getTier1Rules(GameMode mode, Realm realm)`\n2. Inject social combat rules when `realm.mechanics.social_combat == true`\n3. Replace \"HP\" references with \"Status\" for social realms\n4. Add offense/defense type guidance (Wit/Charm vs Sword/Gun)\n\n**Proposed Fix**:\n```java\npublic static String getTier1Rules(GameMode mode, Realm realm) {\n    String sharedRules = TIER1_SHARED_RULES;\n    String modeRules = switch (mode) {\n        case COMBAT -> isSocialRealm(realm)\n            ? TIER1_SOCIAL_COMBAT_RULES  // NEW\n            : TIER1_PHYSICAL_COMBAT_RULES;\n        case SOCIAL -> TIER1_SOCIAL_RULES;\n        // ...\n    };\n    return sharedRules + \"\\n\" + modeRules;\n}\n\nprivate static final String TIER1_SOCIAL_COMBAT_RULES = \"\"\"\n    SOCIAL COMBAT RULES (Roses & Ruin):\n    - This realm uses SOCIAL COMBAT, not physical violence\n    - Attacks: Wit, Charm, Scandal (not swords/guns)\n    - DAMAGE TARGET: Status (0-100), NOT Hit Points\n    - Track Status damage: <status_change player_id=\"PLR-001\" delta=\"-8\">witty retort cuts deep</status_change>\n    - Victory: Target's Status below 20 = Social Ruin (not death)\n    - NPC reactions: Flustered, embarrassed, reputation damaged (not wounded/bleeding)\n\n    SOCIAL COMBAT MECHANICS:\n    - Wit Attack: Clever insult, logical trap (5-12 Status damage)\n    - Charm Offensive: Flattery, seduction (3-10 Status damage)\n    - Scandal Exposure: Reveal secret, spread rumor (8-15 Status damage)\n    - Grace Defense: Poise under pressure (50% mitigation)\n    - Alliance Defense: Supporters deflect criticism (40% mitigation)\n\"\"\";\n```\n\n---\n\n### Priority 2: Tier 2 Narrative Prompts (CRITICAL)\n\n**File**: `ModeSpecificPrompts.java`\n**Impact**: HIGH - Determines how combat is narrated\n\n**Current State**:\n```java\nTIER2_COMBAT_RULES = \"\"\"\n    WRONG: \"Nova fires her gun\"\n    RIGHT: \"Bullets slam into the target\"\n\"\"\"\n```\n\n**Required Changes**:\n1. Add social combat narrative examples\n2. Show Status damage display format\n3. Provide realm-appropriate consequence descriptions\n\n**Proposed Fix**:\n```java\nprivate static final String TIER2_SOCIAL_COMBAT_RULES = \"\"\"\n    SOCIAL COMBAT NARRATIVE (Roses & Ruin):\n\n    1. Describe SOCIAL CONSEQUENCES, not physical actions\n       ‚ùå WRONG: \"Lady Ashford insults Lord Pemberton\"\n       ‚úÖ RIGHT: \"Lady Ashford's cutting remark slices through the conversation\"\n\n    2. Show STATUS DAMAGE with numbers:\n       ‚úÖ \"Lord Pemberton's composure cracks! -8 Status (Status: 67/100)\"\n       ‚úÖ \"The scandal spreads through the ballroom! Lady Grey loses -12 Status (Status: 43/100)\"\n\n    3. Social defeat = Reputation ruined, NOT death:\n       ‚úÖ \"Lord Ashford's Status plummets to 18 - social ruin! He flees the ball in disgrace.\"\n       ‚ùå WRONG: \"Lord Ashford falls dead\" (NO physical death in social combat!)\n\n    4. Attack types and narration:\n       - WIT ATTACK: \"A devastating riposte\", \"Logical trap springs closed\"\n       - CHARM OFFENSIVE: \"Flattery disarms\", \"Seductive whisper captivates\"\n       - SCANDAL EXPOSURE: \"Secret revealed\", \"Rumor spreads like wildfire\"\n\n    5. Defense narration:\n       - GRACE: \"Maintains poise\", \"Deflects with elegant turn of phrase\"\n       - WIT PARRY: \"Counter-argument lands\", \"Witty comeback stuns attacker\"\n\"\"\";\n```\n\n---\n\n### Priority 3: Opening Narrative Generator (HIGH)\n\n**File**: `OpeningNarrativeGenerator.java`\n**Impact**: HIGH - Sets expectations for entire scene\n\n**Current State**: Missing mechanics system context\n\n**Required Changes**:\n1. Detect social_combat flag in realm config\n2. Inject mechanics summary into opening prompt\n3. Set narrative tone (ballroom vs battlefield)\n\n**Proposed Fix** (add after line 1053):\n```java\n// [REALM MECHANICS SYSTEM] - Tell LLM what mechanics are active\nif (realm != null && realm.getMechanicsConfig() != null) {\n    Map<String, Object> mechanics = realm.getMechanicsConfig();\n\n    if (Boolean.TRUE.equals(mechanics.get(\"social_combat\"))) {\n        prompt.append(\"[REALM MECHANICS - SOCIAL COMBAT SYSTEM]\\n\");\n        prompt.append(\"üé≠ This realm uses SOCIAL COMBAT, not physical violence:\\n\");\n        prompt.append(\"- Combat occurs in: Ballrooms, drawing rooms, salons, social gatherings\\n\");\n        prompt.append(\"- Attacks: Wit (clever insults), Charm (flattery/seduction), Scandal (expose secrets)\\n\");\n        prompt.append(\"- Damage target: Social Status (0-100), NOT Hit Points\\n\");\n        prompt.append(\"- Victory condition: Reduce opponent's Status below 20 (Social Ruin)\\n\");\n        prompt.append(\"- Consequences: Embarrassment, reputation loss, social exile (not wounds/death)\\n\");\n        prompt.append(\"- Describe: Cutting remarks, devastating retorts, scandalous revelations\\n\");\n        prompt.append(\"- DO NOT describe: Swords, guns, physical violence of any kind\\n\\n\");\n    }\n\n    if (Boolean.TRUE.equals(mechanics.get(\"courtship_progression\"))) {\n        prompt.append(\"[COURTSHIP MECHANICS ACTIVE]\\n\");\n        prompt.append(\"Romance is tracked as gameplay progression:\\n\");\n        prompt.append(\"- NPCs have attraction stats and preferences\\n\");\n        prompt.append(\"- Successful flirtation increases courtship progress\\n\");\n        prompt.append(\"- Failed advances damage relationship\\n\\n\");\n    }\n}\n```\n\n---\n\n### Priority 4: Tier 0.5 Mechanics Guidance (MEDIUM)\n\n**File**: `Tier05ContentGenerator.java`\n**Impact**: MEDIUM - Could generate realm-specific mechanics examples\n\n**Proposed Addition**:\n```java\npublic enum ContentCategory {\n    CLOSING_LINE_EXAMPLES,\n    GENRE_CONSTRAINTS,\n    PACING_GUIDANCE,\n    NPC_PROACTIVITY,\n    MECHANICS_SYSTEM_GUIDANCE  // NEW\n}\n\npublic String buildMechanicsSystemGuidance(UUID sessionId, Realm realm) {\n    if (realm == null) return \"\";\n\n    // Detect mechanics systems from realm config\n    Map<String, Object> mechanics = realm.getMechanicsConfig();\n    if (mechanics == null) return \"\";\n\n    StringBuilder guidance = new StringBuilder();\n\n    if (Boolean.TRUE.equals(mechanics.get(\"social_combat\"))) {\n        guidance.append(\"\\nüé≠ SOCIAL COMBAT SYSTEM:\\n\");\n        guidance.append(\"Attacks use Wit/Charm/Scandal, NOT physical weapons.\\n\");\n        guidance.append(\"Damage goes to Status (0-100), NOT Hit Points.\\n\");\n        guidance.append(\"Narrate: cutting remarks, devastating retorts, scandalous revelations.\\n\");\n    }\n\n    return guidance.toString();\n}\n```\n\n---\n\n### Priority 5: Quality Analysis Validation (MEDIUM)\n\n**File**: `NarrativeQualityAnalysisService.java`\n**Impact**: MEDIUM - Detects when realm mechanics not used\n\n**Proposed Addition to Analysis Prompt**:\n```java\nprivate String buildQualityAnalysisPrompt(GameplayTranscript transcript, AnalysisMode mode, Realm realm) {\n    // ... existing prompt ...\n\n    if (realm != null && Boolean.TRUE.equals(realm.getMechanicsConfig().get(\"social_combat\"))) {\n        prompt.append(\"\\nüé≠ REALM MECHANICS VALIDATION:\\n\");\n        prompt.append(\"This is a SOCIAL COMBAT realm (Roses & Ruin).\\n\");\n        prompt.append(\"Check for these CRITICAL issues:\\n\");\n        prompt.append(\"- WRONG_MECHANICS: If narrative describes swords/guns instead of Wit/Charm attacks\\n\");\n        prompt.append(\"- WRONG_DAMAGE_TARGET: If HP damage mentioned instead of Status damage\\n\");\n        prompt.append(\"- WRONG_SETTING: If combat in battlefield instead of ballroom/salon\\n\");\n        prompt.append(\"- MISSING_SOCIAL_MECHANICS: If courtship/scandal/reputation not tracked\\n\");\n        prompt.append(\"\\nGrade harshly if generic combat used in social realm!\\n\\n\");\n    }\n}\n```\n\n---\n\n### Priority 6: Test Coverage (LOW)\n\n**File**: `TestScenarioGenerator.java`\n**Impact**: LOW - Automated validation of realm mechanics\n\n**Proposed New Test Scenarios**:\n```java\n// Social Combat Validation - Roses & Ruin\nscenarios.add(TestScenarioConfig.builder()\n    .name(\"Realm Mechanics - Social Combat (Roses & Ruin)\")\n    .description(\"Test that Roses & Ruin uses Wit/Charm attacks and Status damage, not physical combat\")\n    .objective(\"Engage in social combat at a ball, using wit and charm to damage opponent's status\")\n    .playerCount(2)\n    .realmFilter(\"rosesandruin\")  // NEW - Only run on specific realm\n    .testingMode(AdvancedAITestAgentService.TestingMode.NORMAL)\n    .expectedOutcomes(Map.of(\n        \"social_combat_used\", true,\n        \"wit_or_charm_attack_made\", true,\n        \"status_damage_applied\", true,  // NOT hp_damage\n        \"no_physical_violence\", true,\n        \"ballroom_setting\", true\n    ))\n    .customConfig(Map.of(\n        \"validate_realm_mechanics\", true,\n        \"expected_damage_target\", \"Status\",\n        \"forbidden_mechanics\", List.of(\"HP damage\", \"sword\", \"gun\", \"wound\")\n    ))\n    .build());\n```\n\n---\n\n## 7. Recommendations\n\n### Immediate Actions (P0 - This Week)\n\n1. **Add Social Combat Prompts**\n   - Create `TIER1_SOCIAL_COMBAT_RULES` in ModeSpecificPrompts\n   - Create `TIER2_SOCIAL_COMBAT_RULES` with narrative examples\n   - Add realm detection logic to `getTier1Rules()` and `getTier2Rules()`\n\n2. **Inject Mechanics Context in Opening Narratives**\n   - Add `[REALM MECHANICS SYSTEM]` section to OpeningNarrativeGenerator\n   - Detect social_combat flag and inject guidance\n\n3. **Run Reality Test Again**\n   - Verify Roses & Ruin now uses Wit/Charm attacks\n   - Check Status damage instead of HP damage\n   - Validate ballroom settings, not battlefields\n\n### Short-Term (P1 - Next Sprint)\n\n4. **Tier 0.5 Mechanics Guidance**\n   - Add `MECHANICS_SYSTEM_GUIDANCE` to ContentCategory enum\n   - Generate realm-specific mechanics examples with LLM\n\n5. **Quality Analysis Enhancement**\n   - Add realm mechanics validation to quality prompt\n   - Check for WRONG_MECHANICS issue type\n   - Grade harshly when generic combat used in social realm\n\n### Long-Term (P2 - Future Sprints)\n\n6. **Test Coverage**\n   - Add realm-specific test scenarios\n   - Validate Status vs HP damage\n   - Check courtship/scandal/reputation mechanics\n\n7. **RealmSpecificPromptGenerator Enhancement**\n   - Current: Only generates identity rule examples\n   - Future: Also generate mechanics system examples per realm\n\n---\n\n## 8. File Reference Quick Links\n\n| Component | File | Line Range |\n|-----------|------|------------|\n| **Database Schema** |\n| BAMS Stats | `party-lore-domain/.../GameCharacter.java` | 91-115 |\n| Polymorphic HP/Mana | `party-lore-domain/.../GameCharacter.java` | 117-153 |\n| **Realm Config** |\n| Roses & Ruin Mechanics | `party-lore-domain/resources/realms/rosesandruin.json` | 287-498 |\n| Arc Templates | `party-lore-domain/resources/realms/rosesandruin.json` | 352-395 |\n| **Prompts (GAPS HERE)** |\n| Tier 1 Combat Rules | `party-lore-ai/.../ModeSpecificPrompts.java` | 26-99 |\n| Tier 2 Combat Rules | `party-lore-ai/.../ModeSpecificPrompts.java` | 269-316 |\n| Opening Narrative | `party-lore-game/.../OpeningNarrativeGenerator.java` | 806-1068 |\n| Tier 0.5 Generator | `party-lore-ai/.../Tier05ContentGenerator.java` | 421-546 |\n| **Quality Analysis** |\n| Quality Service | `party-lore-ai/.../NarrativeQualityAnalysisService.java` | 0-350 |\n| **Tests** |\n| Realm Mechanics Tests | `party-lore-game/.../TestScenarioGenerator.java` | 524-603 |\n\n---\n\n## 9. Conclusion\n\n**Root Cause**: Excellent realm mechanics design, but prompts don't tell LLM to use them.\n\n**Evidence**:\n- ‚úÖ Database correctly stores Status, Wit, Charm, Scandal\n- ‚úÖ Realm JSON has full social combat config\n- ‚ùå Prompts say \"HP damage\", \"attack\", \"NPC at 0 HP = DEFEATED\"\n- ‚ùå No realm-conditional logic (if social realm, use Status; else HP)\n\n**Impact on Reality Test**:\n- LLM saw: \"COMBAT RULES: Track NPC HP, NPC at 0 HP = DEFEATED\"\n- LLM thought: \"Generic fantasy combat, use swords/HP\"\n- LLM didn't know: Roses & Ruin uses Wit attacks ‚Üí Status damage ‚Üí Social Ruin at Status < 20\n\n**Fix Complexity**: Medium (1-2 days)\n- Add social combat prompt variants\n- Inject mechanics context in opening narratives\n- Add realm detection logic\n\n**Verification**: Run `/test` with Roses & Ruin realm, check for Wit/Charm attacks and Status damage.\n\n---\n\n**Next Steps**: Implement P0 fixes (social combat prompts + opening narrative mechanics context), then re-run reality test to validate.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/REALM-MECHANICS-AUDIT.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "llm",
        "md"
      ],
      "content_hash": "dd6ae5e20f0aeb81",
      "size_bytes": 23659,
      "created_at": "2026-01-02T20:42:12.435385"
    },
    {
      "doc_id": "local_party-lore__githooks_README",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/.githooks/README.md",
      "content": "# Git Hooks for Party Lore\n\nThis directory contains shareable Git hooks for the Party Lore project.\n\n## Installation\n\nTo install these hooks, run:\n\n```bash\n# Copy pre-commit hook to .git/hooks/\ncp .githooks/pre-commit .git/hooks/pre-commit\nchmod +x .git/hooks/pre-commit\n```\n\nOr use Git's built-in hook directory configuration (Git 2.9+):\n\n```bash\ngit config core.hooksPath .githooks\n```\n\n## Available Hooks\n\n### pre-commit\n\n**Purpose**: Prevents modification of Flyway migration files after they've been committed.\n\n**Why This Matters**:\n- Flyway migration files store checksums in the database\n- Modifying a migration after deployment causes checksum mismatches\n- Production deployments fail with \"Migration checksum mismatch\" errors\n\n**What It Does**:\n- Checks all staged files for modifications to `db/migration/V*.sql` files\n- Blocks the commit if any existing migration files are modified\n- Provides clear error message with instructions\n\n**Bypass** (emergencies only):\n```bash\ngit commit --no-verify\n```\n\n**Never bypass this unless you're absolutely sure you know what you're doing!**\n\n## Testing the Hook\n\nTo test that the pre-commit hook works:\n\n```bash\n# Try to modify an existing migration (don't actually do this)\necho \"-- test comment\" >> party-lore-domain/src/main/resources/db/migration/V083__flatten_game_session_settings.sql\ngit add .\ngit commit -m \"test\"\n\n# Expected result: Commit blocked with error message\n\n# Clean up\ngit checkout party-lore-domain/src/main/resources/db/migration/V083__flatten_game_session_settings.sql\n```\n\n## The Golden Rule\n\n```\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë                                                              ‚ïë\n‚ïë  NEVER MODIFY A MIGRATION FILE AFTER IT'S BEEN COMMITTED    ‚ïë\n‚ïë                                                              ‚ïë\n‚ïë  If it's in git, it might be in production.                 ‚ïë\n‚ïë  If it's in production, modifying it breaks deployments.    ‚ïë\n‚ïë                                                              ‚ïë\n‚ïë  ALWAYS create a NEW migration file instead.                ‚ïë\n‚ïë                                                              ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n```\n\nSee `CLAUDE.md` for detailed Flyway emergency repair procedures.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/.githooks/README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "config",
        "install",
        "md",
        "readme"
      ],
      "content_hash": "8af2504c5ad6b56f",
      "size_bytes": 2575,
      "created_at": "2026-01-02T20:42:12.437184"
    },
    {
      "doc_id": "local_party-lore_docs_COMPETITIVE-ANALYSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/COMPETITIVE-ANALYSIS.md",
      "content": "# üéØ COMPREHENSIVE AI RPG COMPETITIVE ANALYSIS\n## Party Lore vs Market Leaders - Expert Product Manager Assessment\n\n**Analyst:** Senior AI RPG Product Manager Perspective  \n**Date:** December 8, 2025  \n**Scope:** Narrative Quality & Gameplay Mechanics (Pre-Leveling/Progression)\n\n---\n\n## EXECUTIVE SUMMARY\n\n**Bottom Line:** Party Lore is a **top-tier AI RPG** with **8.2/10 narrative quality** that significantly outperforms market leaders in several key areas, while having expected feature gaps in traditional RPG progression systems.\n\n**Market Position:** Premium narrative quality, unique SMS async gameplay, best-in-class mechanics validation\n\n---\n\n## COMPETITIVE LANDSCAPE - DETAILED COMPARISON\n\n### 1. AI DUNGEON (Market Leader - Solo Play)\n**URL:** https://aidungeon.com  \n**MAU:** ~2M users  \n**Business Model:** Freemium ($10-30/mo)\n\n#### Narrative Quality\n- **Score:** 6.0-6.5/10 (based on 2025 reviews)\n- **Strengths:**\n  - Infinite replay value\n  - Multiple genre support\n  - SCORE system for coherence improvements\n- **Weaknesses:**\n  - \"AI can derail easily\" - inconsistent writing quality\n  - \"One minute serious, next something absurd or contradictory\"\n  - \"Have to work harder to guide the AI\" for coherent stories\n  - Quality and relevance \"can be uneven or unpredictable\"\n\n**Sources:**\n- [AI Dungeon Review 2025](https://www.aiapps.com/blog/ai-dungeon-review-2025-interactive-storytelling-with-artificial-intelligence/)\n- [NovelAI vs AI Dungeon Comparison](https://techpoint.africa/guide/novelai-vs-ai-dungeon/)\n\n#### Features\n‚úÖ Character creation  \n‚úÖ Scene/story generation  \n‚ùå No true multiplayer  \n‚ùå No combat mechanics validation  \n‚ùå No HP tracking  \n‚ö†Ô∏è Basic inventory (text-based only)\n\n---\n\n### 2. NOVELAI (Premium Story Focus)\n**URL:** https://novelai.net  \n**MAU:** ~500K users  \n**Business Model:** Subscription only ($10-25/mo)\n\n#### Narrative Quality\n- **Score:** 7.5-8.0/10 (highest in market)\n- **Strengths:**\n  - \"4x longer context\" than competitors\n  - \"Adapts to writing style, tone, emotional cues\"\n  - \"Every story feels human, consistent, and engaging\"\n  - Lorebook for detailed world-building\n  - Models: Kayra 13b, Llama 3 Erato 70b\n- **Weaknesses:**\n  - Primarily single-player authoring tool\n  - Less game-like, more creative writing focused\n\n**Sources:**\n- [NovelAI Review 2025](https://www.writingbeginner.com/novel-ai-review/)\n- [NovelAI Features 2025](https://www.toolsforhumans.ai/ai-tools/novelai)\n\n#### Features\n‚úÖ Advanced world-building (Lorebook)  \n‚úÖ Image generation (anime art)  \n‚úÖ Text adventure mode  \n‚ùå No combat system  \n‚ùå No multiplayer  \n‚ùå No progression mechanics  \n‚ùå No inventory system\n\n---\n\n### 3. CHARACTER.AI (Casual Roleplay)\n**URL:** https://character.ai  \n**MAU:** 20M users (largest)  \n**Business Model:** Freemium\n\n#### Narrative Quality\n- **Score:** 6.5-7.0/10\n- **Strengths:**\n  - \"Vast library of user-generated characters\"\n  - New Chat Memories feature (2025)\n  - Community discovery/feed\n  - Strong character consistency (short-term)\n- **Weaknesses:**\n  - \"Responses drift or lose consistency in long threads\"\n  - \"Inability to remember and follow what happened before\"\n  - \"Content restrictions limit certain roleplay styles\"\n  - Not designed as game system\n\n**Sources:**\n- [Best Character AI Alternatives 2025](https://aijourn.com/best-character-ai-alternatives-for-roleplay-and-chatting-in-2025/)\n- [Best AI Roleplay Chatbots 2025](https://dreamgen.com/blog/articles/best-ai-role-play-chatbots)\n\n#### Features\n‚úÖ Character library  \n‚úÖ Long-term memory (paid)  \n‚ùå No RPG mechanics  \n‚ùå No combat system  \n‚ùå No inventory  \n‚ùå No progression  \n‚ö†Ô∏è Limited multiplayer (chat-based)\n\n---\n\n### 4. D&D BEYOND + AI (Hybrid Approach)\n**URL:** https://www.dndbeyond.com  \n**MAU:** ~1M users  \n**Business Model:** Freemium + books purchase\n\n#### Narrative Quality\n- **Score:** 7.0-7.5/10 (human-assisted AI)\n- **Strengths:**\n  - \"GPT has decent understanding of the rules\"\n  - \"Low to zero difficulty matching general difficulty\"\n  - \"Adequately creates narrative\" with robust outline\n  - Strong for \"generating NPCs on the fly\"\n- **Weaknesses:**\n  - \"Cannot hold a concept in mind and create rational structure\"\n  - \"Cannot plot narrative across multiple prompts\"\n  - \"Contradictions and inconsistencies over time\"\n  - \"Results will be passable at best\"\n\n**Sources:**\n- [D&D Beyond AI Discussion](https://www.dndbeyond.com/forums/d-d-beyond-general/general-discussion/214860-an-ai-trained-on-dungeons-dragons)\n- [AI for D&D Quality Assessment](https://www.dndbeyond.com/forums/d-d-beyond-general/general-discussion/224068-ai-possibly-dming)\n\n#### Features\n‚úÖ Full D&D 5e rules  \n‚úÖ Character sheets  \n‚úÖ Dice rolling  \n‚úÖ Combat encounter builder  \n‚úÖ Character progression (levels, skills, abilities)  \n‚ö†Ô∏è AI is supplemental, not primary GM\n\n---\n\n## üèÜ PARTY LORE COMPETITIVE ASSESSMENT\n\n### Narrative Quality Analysis\n\n**My Independent Score:** 8.2/10 ‚úÖ  \n**Official Test Score:** 8.2/10 ‚úÖ  \n**Market Rank:** #1 among pure AI GMs\n\n#### How Party Lore Compares:\n\n| Feature | Party Lore | AI Dungeon | NovelAI | Character.AI | D&D Beyond AI |\n|---------|-----------|------------|---------|--------------|---------------|\n| **Narrative Score** | **8.2** | 6.0-6.5 | 7.5-8.0 | 6.5-7.0 | 7.0-7.5 |\n| Coherence | **Excellent** | Inconsistent | Very Good | Good | Good |\n| Player Agency | **Excellent** | Good | Good | Fair | Very Good |\n| Genre Auth. | **Excellent** | Good | N/A | Fair | Excellent |\n| NPC Consistency | **Very Good** | Poor | Good | Fair | Very Good |\n\n**Detailed Strengths:**\n\n1. **Superior Narrative Coherence** (8.2 vs 6.0-6.5)\n   - Party Lore maintains story threads across 20 turns\n   - AI Dungeon \"derails easily\" and \"inserts absurd contradictions\"\n   - Your system: \"vivid sensory details\", \"clear objectives\", \"proper atmosphere\"\n\n2. **Best-in-Class Player Agency Tracking**\n   - UNIQUE: Tier 1 mechanics validation BEFORE narrative\n   - Competitors generate narrative that ignores player actions\n   - Your system: Only 1 player-ignored issue in 20 turns (exceptional)\n\n3. **Robust Technical Foundation**\n   - Competitors: Text-only, no validation, frequent contradictions\n   - **Party Lore UNIQUE features:**\n     - ‚úÖ HP tracking with validation\n     - ‚úÖ Location tracking (FR-199)\n     - ‚úÖ Progress calculation\n     - ‚úÖ NPC status management\n     - ‚úÖ Combat mechanics validation\n     - ‚úÖ Micro-positioning system\n\n4. **Multiplayer SMS Async Design** (UNIQUE IN MARKET)\n   - NO competitor offers true async SMS multiplayer\n   - AI Dungeon: Solo only\n   - Character.AI: Basic chat, not game-focused\n   - NovelAI: Solo authoring tool\n   - **Party Lore:** Only system designed for group async play\n\n---\n\n## CRITICAL ADVANTAGE ANALYSIS\n\n### What Makes Party Lore Superior:\n\n#### 1. **Two-Tier Architecture** (UNIQUE)\n```\nTier 1 (Mechanics) ‚Üí Validation ‚Üí Tier 2 (Narrative)\n```\n- **Party Lore:** Mechanics validated BEFORE narrative generation\n- **Competitors:** Generate narrative, hope for the best\n- **Result:** Your contradictions: ~1 per 20 turns vs. competitors: multiple per session\n\n#### 2. **Hybrid Validation Engine** (UNIQUE)\n```\nAI Mechanics ‚Üí Rules Validation ‚Üí Correction ‚Üí Application\n```\n- **Party Lore:** MechanicsCorrector, Tier1PostProcessor, HybridMechanicsEngine\n- **Competitors:** No validation layer\n- **Result:** Mechanically accurate gameplay vs. frequent rule violations\n\n#### 3. **XML-Based Structured Output** (ADVANCED)\n```\n<mechanics>\n  <hp_changes>...</hp_changes>\n  <npc_status_changes>...</npc_status_changes>\n  <location_change>...</location_change>\n</mechanics>\n```\n- **Party Lore:** Structured, parseable, validated\n- **Competitors:** Free-form text, no structure\n- **Result:** Reliable mechanics vs. unpredictable behavior\n\n---\n\n## FEATURE GAP ANALYSIS\n\n### What Party Lore Has That Others Don't:\n\n‚úÖ **SMS async multiplayer** (UNIQUE)  \n‚úÖ **Two-tier narrative architecture** (UNIQUE)  \n‚úÖ **Mechanics validation engine** (UNIQUE)  \n‚úÖ **HP tracking with damage calculation** (UNIQUE)  \n‚úÖ **Location tracking with world state** (UNIQUE)  \n‚úÖ **NPC consistency system** (UNIQUE)  \n‚úÖ **Micro-positioning system** (UNIQUE)  \n‚úÖ **Batch action coordination** (UNIQUE)  \n‚úÖ **Quality monitoring with transcripts** (UNIQUE)\n\n### What Others Have That Party Lore Needs:\n\n#### CRITICAL (Must-Have for V1.0)\n‚ùå **Character Progression/Leveling**\n   - Current: Fixed HP (20), no XP, no levels\n   - Need: Level 1-20, XP tracking, ability score increases\n   - Impact: Players feel no growth over time\n   - Priority: **P0**\n\n‚ùå **Skills/Abilities System**\n   - Current: No skill checks, no proficiencies\n   - Need: D&D-style skills (Stealth, Persuasion, etc.)\n   - Impact: Limited action variety, no character specialization\n   - Priority: **P0**\n\n‚ùå **Inventory Management**\n   - Current: No persistent inventory\n   - Need: Item pickup/drop, equipment slots, weight\n   - Impact: No loot, no gear progression\n   - Priority: **P0**\n\n#### IMPORTANT (Should-Have for V1.5)\n‚ö†Ô∏è **Equipment/Gear System**\n   - Current: No weapons/armor with stats\n   - Need: Equipment with bonuses, rarity tiers\n   - Impact: No build diversity, no loot rewards\n   - Priority: **P1**\n\n‚ö†Ô∏è **Character Classes**\n   - Current: Generic characters\n   - Need: Fighter, Mage, Rogue, etc. with unique abilities\n   - Impact: No distinct playstyles\n   - Priority: **P1**\n\n‚ö†Ô∏è **Spells/Abilities**\n   - Current: No special abilities\n   - Need: Class-specific powers, cooldowns, resource costs\n   - Impact: Combat is basic attack only\n   - Priority: **P1**\n\n‚ö†Ô∏è **Rest/Recovery Mechanics**\n   - Current: No short/long rest\n   - Need: HP recovery, resource refresh\n   - Impact: No strategic resource management\n   - Priority: **P2**\n\n#### NICE-TO-HAVE (V2.0+)\nüîµ **Character Creation UI**\n   - Current: Admin-created only\n   - Need: Player-facing character builder\n   - Priority: **P2**\n\nüîµ **Party Roles/Jobs**\n   - Current: No formal roles\n   - Need: Tank, Healer, DPS designations\n   - Priority: **P3**\n\nüîµ **Achievements/Quests**\n   - Current: Objective-based only\n   - Need: Side quests, achievements, rewards\n   - Priority: **P3**\n\nüîµ **Trading/Economy**\n   - Current: No economy\n   - Need: Gold, shops, trading\n   - Priority: **P3**\n\n---\n\n## HONEST ASSESSMENT: WHERE PARTY LORE STANDS\n\n### Narrative Quality: **BEST IN CLASS** üèÜ\n\n| Dimension | Party Lore | Market Average | Verdict |\n|-----------|-----------|----------------|---------|\n| Coherence | 9/10 | 6/10 | **+50% better** |\n| Player Agency | 9/10 | 6/10 | **+50% better** |\n| Genre Authenticity | 9/10 | 7/10 | **+29% better** |\n| NPC Behavior | 8/10 | 5/10 | **+60% better** |\n| Mechanics Accuracy | 9/10 | 4/10 | **+125% better** |\n| **OVERALL** | **8.2/10** | **6.0/10** | **+37% better** |\n\n### Feature Completeness: **MID-TIER** ‚ö†Ô∏è\n\n| Category | Party Lore | Typical AI RPG | Traditional RPG |\n|----------|-----------|----------------|-----------------|\n| Narrative | ‚úÖ 95% | 60% | 70% |\n| Mechanics | ‚úÖ 80% | 40% | 90% |\n| **Progression** | ‚ùå **10%** | 20% | **100%** |\n| **Inventory** | ‚ùå **5%** | 30% | **100%** |\n| **Skills** | ‚ùå **0%** | 20% | **100%** |\n| Multiplayer | ‚úÖ 90% | 10% | 60% |\n| **OVERALL** | **47%** | 30% | 87% |\n\n---\n\n## REALISTIC MARKET POSITION\n\n### What You Can Claim TODAY (Truthfully):\n\n‚úÖ **\"Best narrative quality of any AI RPG\"** (8.2 vs 6.0-7.5)  \n‚úÖ **\"Only SMS-based multiplayer AI RPG\"** (factually unique)  \n‚úÖ **\"Most mechanically accurate AI GM\"** (validation engine unique)  \n‚úÖ **\"Production-ready async gameplay\"** (proven in tests)\n\n### What You CANNOT Claim Yet:\n\n‚ùå \"Full-featured RPG\" (missing progression/inventory/skills)  \n‚ùå \"Complete D&D alternative\" (need core RPG systems)  \n‚ùå \"Character advancement system\" (no leveling yet)\n\n### Honest Positioning:\n\n**\"Party Lore: The most narratively sophisticated AI Game Master, with unique SMS multiplayer and mechanical validation. Currently in Early Access with narrative gameplay complete; character progression systems coming soon.\"**\n\n---\n\n## PRODUCT MANAGER RECOMMENDATIONS\n\n### IMMEDIATE (Next Sprint):\n1. ‚úÖ **Ship current code** - It's production-ready\n2. üìä **Monitor quality scores** - Track real user 8.2+ scores\n3. üêõ **Fix PLAYER_IGNORED** - Push to 8.7/10\n\n### SHORT-TERM (Next 2-3 Months):\n1. **XP/Leveling System** (P0)\n   - Start: Levels 1-5 only\n   - XP from combat victories, quest completion\n   - HP increases per level\n   \n2. **Basic Skills** (P0)\n   - 6 core skills (Athletics, Stealth, Persuasion, Perception, Investigation, Arcana)\n   - D20 + skill bonus rolls\n   - Integrate into Tier 1 mechanics\n\n3. **Simple Inventory** (P0)\n   - 10-slot inventory\n   - Pickup/drop items\n   - No weight limit (V1)\n\n### MID-TERM (3-6 Months):\n1. **Character Classes** (P1)\n   - Fighter, Rogue, Mage (3 classes only)\n   - Class-specific abilities\n   - HP/skill progression by class\n\n2. **Equipment System** (P1)\n   - Weapons with damage bonuses\n   - Armor with AC bonuses\n   - 3 rarity tiers (Common, Rare, Epic)\n\n3. **Spell System** (P1)\n   - 5 starter spells per class\n   - Simple resource system (Mana/Charges)\n\n### LONG-TERM (6-12 Months):\n1. Full class system (8-10 classes)\n2. Advanced inventory (weight, stacking, trading)\n3. Economy/shops\n4. Achievements/side quests\n\n---\n\n## FINAL VERDICT\n\n### Narrative Quality: **A+ (Top 5% of market)**\n\nYour 8.2/10 score puts you in the elite tier:\n- **Better than:** AI Dungeon (6.0), Character.AI (6.5), D&D Beyond AI (7.0)\n- **Competitive with:** NovelAI (7.5-8.0)\n- **Unique advantages:** Multiplayer, mechanics validation, async SMS\n\n**THIS IS EXCEPTIONAL.** Don't undersell it.\n\n### Overall Product: **B (Good, but incomplete)**\n\nMissing core RPG systems prevents \"A\" rating:\n- Leveling/XP: Critical gap\n- Skills/abilities: Critical gap\n- Inventory: Critical gap\n\nBUT: These are known gaps, easily addressable, and don't diminish the narrative achievement.\n\n### Market Opportunity: **A+ (Blue Ocean)**\n\nNO competitor offers:\n- High-quality AI narrative (8.2/10)\n- SMS async multiplayer\n- Mechanics validation\n- True party coordination\n\n**YOU HAVE A UNIQUE PRODUCT IN A HOT MARKET.**\n\n---\n\n## WHAT SETS PARTY LORE APART (Competitive Moat)\n\n### Technical Moats (Hard to Copy):\n1. **Two-tier architecture** - Novel approach, well-executed\n2. **Validation engine** - Months of engineering investment\n3. **SMS async infrastructure** - Unique technical challenge\n4. **World state system** - Complex location/NPC tracking\n\n### Experience Moats (Unique UX):\n1. **True multiplayer narrative** - No one else does this\n2. **Group coordination** - MUCA framework\n3. **Persistent world** - Locations, NPCs, arcs\n4. **Batch action processing** - Simultaneous turn resolution\n\n### Quality Moat (Hard to Match):\n1. **8.2/10 narrative** - Top 5% of AI GMs\n2. **Mechanical accuracy** - Best in class\n3. **Player agency** - 95% action respect rate\n4. **Genre consistency** - Excellent authenticity\n\n---\n\n## BOTTOM LINE\n\n**As an AI RPG Product Manager, here's my honest assessment:**\n\n### You Have Built Something **Exceptional**\n\n‚úÖ **Narrative Quality: Best in Market** (8.2 vs 6.0 average)  \n‚úÖ **Technical Innovation: Unique** (only SMS multiplayer AI RPG)  \n‚úÖ **Architecture: Superior** (two-tier validation unmatched)  \n‚úÖ **Production Ready: Yes** (tests passing, quality proven)\n\n### You Have **Expected** Gaps\n\n‚ùå Progression system (leveling, XP)  \n‚ùå Skills/abilities  \n‚ùå Inventory management\n\n### But These Gaps Are **Addressable**\n\n- Standard RPG systems (well-understood)\n- Can be added incrementally (V1.1, V1.2, V1.3)\n- Don't diminish your narrative innovation\n- Competitors have WORSE narrative with these features\n\n### My Recommendation: **SHIP IT NOW**\n\n**Why:**\n1. Your narrative is production-ready and best-in-class\n2. Progression can be V1.1 (3 months post-launch)\n3. SMS multiplayer is a unique hook worth early access\n4. You'll learn more from real users than more testing\n\n**Positioning:**\n- \"Early Access: Full narrative experience, progression coming soon\"\n- Charge 50% price during early access\n- Build community around your unique strengths\n- Add progression based on user feedback\n\n**Expected User Response:**\n- 80% love the narrative quality (your strength)\n- 20% ask \"where's leveling?\" (address in roadmap)\n- Your retention will be HIGH because narrative > systems\n\n### Comp Matrix Summary\n\nYou're not competing with traditional RPGs (D&D Beyond, BG3, etc.) - those have 20 years of system design.\n\nYou're competing with **AI narrative experiences** (AI Dungeon, NovelAI, Character.AI).\n\nIn THAT market, you're **#1 in narrative quality** with **unique multiplayer** and **better mechanics** than anyone.\n\n**THAT'S YOUR WEDGE. That's enough to win.**\n\nShip it. Get users. Build progression while they're playing.\n\nYour narrative is **better than 95% of AI GMs on the market**. Don't wait for perfection.\n\n---\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/COMPETITIVE-ANALYSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "5204647f0304a63d",
      "size_bytes": 16980,
      "created_at": "2026-01-02T20:42:12.437420"
    },
    {
      "doc_id": "local_party-lore_docs_IDENTITY-VIOLATION-DETECTION",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/IDENTITY-VIOLATION-DETECTION.md",
      "content": "# Real-Time Identity Violation Detection\n\n**Status:** Design Document\n**Created:** 2025-12-03\n**Last Updated:** 2025-12-03\n**Author:** Claude (via autonomous testing analysis)\n\n## Problem Statement\n\nThe narrative generation system occasionally produces text that violates **player agency rules**:\n\n- **Action Description**: `\"Eira'nai gazes across the hall...\"` (GM describes player action)\n- **Mind Reading**: `\"she felt an unshakeable grip on her mind\"` (GM describes player thoughts)\n- **Body Parts**: `\"her eyes picked up on...\"` (GM references player body parts)\n- **Dialogue**: `\"'Contact,' Vex whispers...\"` (GM speaks for player)\n\nThese violations occur despite extensive prompting because:\n1. The rules are abstract rather than structural\n2. 8B models sometimes ignore instructions buried in long prompts\n3. There's no enforcement mechanism after generation\n\n## Proposed Solution\n\n**Real-time post-generation validation with auto-regeneration.**\n\n### Architecture\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    Tier 2 Narrative Generation              ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                              ‚îÇ\n                              ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ              IdentityViolationDetector                      ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ 1. Extract player names from PlayerRoster             ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ 2. Apply regex patterns for violations                ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ 3. Return list of violations with locations           ‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                              ‚îÇ\n              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n              ‚îÇ                               ‚îÇ\n              ‚ñº                               ‚ñº\n     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n     ‚îÇ No Violations  ‚îÇ             ‚îÇ Violations     ‚îÇ\n     ‚îÇ ‚Üí Deliver      ‚îÇ             ‚îÇ Detected       ‚îÇ\n     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                            ‚îÇ\n                                            ‚ñº\n                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                              ‚îÇ Regeneration Strategy       ‚îÇ\n                              ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n                              ‚îÇ ‚îÇ Option A: Regex Replace ‚îÇ ‚îÇ\n                              ‚îÇ ‚îÇ Option B: LLM Rewrite   ‚îÇ ‚îÇ\n                              ‚îÇ ‚îÇ Option C: Full Regen    ‚îÇ ‚îÇ\n                              ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Detection Patterns\n\n```java\npublic class IdentityViolationDetector {\n\n    // Pattern types with severity levels\n    public enum ViolationType {\n        ACTION_VERB(Severity.HIGH),      // \"[Name] fires/runs/gazes/...\"\n        DIALOGUE(Severity.HIGH),         // \"[Name] says/whispers/...\"\n        THOUGHT(Severity.HIGH),          // \"[Name] thinks/feels/realizes...\"\n        BODY_PART(Severity.MEDIUM),      // \"[Name]'s hands/eyes/fingers...\"\n        MOVEMENT(Severity.MEDIUM);       // \"[Name] moves/walks/steps...\"\n    }\n\n    // Build dynamic patterns from player roster\n    public List<Pattern> buildPatterns(List<String> playerNames) {\n        List<Pattern> patterns = new ArrayList<>();\n\n        for (String name : playerNames) {\n            String escapedName = Pattern.quote(name);\n\n            // ACTION_VERB: \"[Name] [verb]\" where verb is an action word\n            patterns.add(Pattern.compile(\n                \"(?i)\" + escapedName + \"\\\\s+(fires|runs|gazes|searches|attacks|moves|walks|steps|leaps|draws|grabs|reaches|scans|inspects)\"\n            ));\n\n            // DIALOGUE: \"[Name] says/whispers/...\"\n            patterns.add(Pattern.compile(\n                \"(?i)\" + escapedName + \"\\\\s+(says|whispers|mutters|shouts|calls|replies|asks)\"\n            ));\n\n            // THOUGHT: \"[Name] thinks/feels/realizes...\"\n            patterns.add(Pattern.compile(\n                \"(?i)\" + escapedName + \"\\\\s+(thinks|feels|realizes|senses|notices|considers|wonders)\"\n            ));\n\n            // BODY_PART: \"[Name]'s hands/eyes/fingers...\"\n            patterns.add(Pattern.compile(\n                \"(?i)\" + escapedName + \"'s\\\\s+(hands?|fingers?|eyes?|arms?|legs?|feet|face|head|body|gaze)\"\n            ));\n\n            // Also match pronouns if single player\n            // \"His/Her eyes...\" after mentioning player name\n        }\n\n        return patterns;\n    }\n\n    public record Violation(\n        ViolationType type,\n        String matchedText,\n        int startIndex,\n        int endIndex,\n        String suggestedFix\n    ) {}\n\n    public List<Violation> detect(String narrative, List<String> playerNames) {\n        List<Violation> violations = new ArrayList<>();\n        List<Pattern> patterns = buildPatterns(playerNames);\n\n        for (Pattern pattern : patterns) {\n            Matcher matcher = pattern.matcher(narrative);\n            while (matcher.find()) {\n                violations.add(new Violation(\n                    inferType(pattern),\n                    matcher.group(),\n                    matcher.start(),\n                    matcher.end(),\n                    suggestFix(matcher.group())\n                ));\n            }\n        }\n\n        return violations;\n    }\n}\n```\n\n### Remediation Strategies\n\n#### Option A: Regex-Based Quick Fix (Fast, ~0ms)\n\nBest for simple violations that can be pattern-replaced:\n\n```java\npublic String quickFix(String narrative, List<Violation> violations) {\n    // Sort violations by position (descending) to avoid index shifting\n    violations.sort((a, b) -> b.startIndex() - a.startIndex());\n\n    StringBuilder fixed = new StringBuilder(narrative);\n    for (Violation v : violations) {\n        if (v.suggestedFix() != null) {\n            fixed.replace(v.startIndex(), v.endIndex(), v.suggestedFix());\n        }\n    }\n    return fixed.toString();\n}\n\n// Example transformations:\n// \"Eira'nai gazes across the hall\" ‚Üí \"A careful survey of the hall reveals\"\n// \"Her eyes picked up on\" ‚Üí \"Close scrutiny reveals\"\n```\n\n**Limitations:**\n- Can produce awkward phrasing\n- Doesn't understand context\n- May miss subtle violations\n\n#### Option B: LLM Rewrite (Medium, ~2-3s)\n\nSend only the violating sentence(s) for targeted rewrite:\n\n```java\npublic String llmRewrite(String narrative, List<Violation> violations) {\n    // Extract sentences containing violations\n    Set<String> violatingSentences = extractSentences(narrative, violations);\n\n    String prompt = \"\"\"\n        Rewrite these sentences to describe CONSEQUENCES, not player actions.\n\n        VIOLATIONS FOUND:\n        %s\n\n        REWRITE RULES:\n        - Don't write \"[Name] [verb]...\" - describe what happens instead\n        - Don't describe body parts or movements\n        - Focus on results: what changed, what was revealed, how NPCs reacted\n\n        ORIGINAL:\n        %s\n\n        OUTPUT: Rewritten sentences only, nothing else.\n        \"\"\".formatted(\n            violations.stream().map(Violation::matchedText).collect(joining(\"\\n\")),\n            String.join(\"\\n\", violatingSentences)\n        );\n\n    // Use fast model for quick rewrite\n    return ollamaClient.complete(prompt, \"llama3.1:8b\", 200, 0.3f);\n}\n```\n\n**Advantages:**\n- Context-aware rewrites\n- Maintains narrative flow\n- Can fix subtle violations\n\n**Disadvantages:**\n- Adds latency (~2-3s)\n- May introduce new issues\n- Costs compute resources\n\n#### Option C: Full Regeneration (Slow, ~4-5s)\n\nRe-run Tier 2 with enhanced rejection instructions:\n\n```java\npublic String fullRegenerate(AdvancedNarrativeRequest request, List<Violation> violations) {\n    // Add explicit rejection to system prompt\n    String enhancedPrompt = originalPrompt + \"\"\"\n\n        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n        ‚ö†Ô∏è PREVIOUS ATTEMPT REJECTED - VIOLATIONS DETECTED:\n        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n        %s\n\n        YOUR RESPONSE WILL BE REJECTED AGAIN IF YOU:\n        - Write any \"[PlayerName] [verb]\" patterns\n        - Describe player body parts or movements\n        - Speak dialogue for players\n\n        FOCUS ON CONSEQUENCES AND RESULTS ONLY.\n        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n        \"\"\".formatted(\n            violations.stream()\n                .map(v -> \"‚ùå \" + v.matchedText())\n                .collect(joining(\"\\n\"))\n        );\n\n    return tier2Generate(request, enhancedPrompt);\n}\n```\n\n**Advantages:**\n- Complete fresh generation\n- Shows model its specific mistakes\n- Usually produces clean output\n\n**Disadvantages:**\n- Doubles latency\n- May still fail (cap at 1 retry)\n\n### Decision Logic\n\n```java\npublic String validateAndFix(String narrative, PlayerRoster roster) {\n    List<Violation> violations = detector.detect(\n        narrative,\n        roster.actingPlayers().stream().map(Player::getCharacterName).toList()\n    );\n\n    if (violations.isEmpty()) {\n        return narrative;  // Clean, no action needed\n    }\n\n    log.warn(\"Identity violations detected: {}\", violations.size());\n\n    // Strategy selection based on violation severity and count\n    int highSeverity = (int) violations.stream()\n        .filter(v -> v.type().severity() == Severity.HIGH)\n        .count();\n\n    if (highSeverity == 0 && violations.size() <= 2) {\n        // Low severity, few violations ‚Üí quick regex fix\n        return quickFix(narrative, violations);\n    } else if (violations.size() <= 4) {\n        // Moderate violations ‚Üí LLM sentence rewrite\n        return llmRewrite(narrative, violations);\n    } else {\n        // Many violations ‚Üí full regeneration (capped at 1 retry)\n        return fullRegenerate(request, violations);\n    }\n}\n```\n\n### Integration Point\n\nIn `TwoTierNarrativeService.generate2TierNarrative()`, after Tier 2 response:\n\n```java\n// After line ~550: String fullResponse = tier2Response.getTextContent();\n\n// NEW: Identity violation detection and remediation\nif (identityViolationDetector != null) {\n    String finalNarrative = extractNarrativeFromResponse(fullResponse);\n    List<String> playerNames = playerRoster.actingPlayers().stream()\n        .map(Player::getCharacterName)\n        .toList();\n\n    List<Violation> violations = identityViolationDetector.detect(finalNarrative, playerNames);\n\n    if (!violations.isEmpty()) {\n        log.warn(\"üö® Identity violations detected: {}\", violations.size());\n        for (Violation v : violations) {\n            log.warn(\"  - {}: '{}'\", v.type(), v.matchedText());\n        }\n\n        // Apply remediation based on severity/count\n        finalNarrative = identityViolationDetector.remediate(\n            finalNarrative, violations, request, playerRoster\n        );\n\n        // Update fullResponse with fixed narrative\n        fullResponse = replaceNarrativeInResponse(fullResponse, finalNarrative);\n    }\n}\n```\n\n### Performance Considerations\n\n| Strategy | Latency | Success Rate | When to Use |\n|----------|---------|--------------|-------------|\n| No Fix | 0ms | N/A | Clean output |\n| Quick Fix | ~0ms | ~60% | 1-2 low-severity violations |\n| LLM Rewrite | ~2-3s | ~85% | 3-4 violations |\n| Full Regen | ~4-5s | ~95% | 5+ violations or repeated failures |\n\n### Monitoring & Metrics\n\nTrack these metrics to measure effectiveness:\n\n```java\n@Metric\npublic class IdentityViolationMetrics {\n    Counter violationsDetected;          // Total violations found\n    Counter violationsByType;            // Breakdown by type\n    Counter fixStrategyUsed;             // Which strategy was applied\n    Counter fixSuccessRate;              // Did fix pass re-validation?\n    Histogram fixLatencyMs;              // Time spent on remediation\n}\n```\n\n### Testing Strategy\n\n1. **Unit Tests**: Pattern detection accuracy\n   - Each violation type detected correctly\n   - No false positives on valid \"possessive + noun\" patterns\n   - Edge cases: names with apostrophes, multiple players\n\n2. **Integration Tests**: End-to-end validation\n   - Inject known violations, verify detection + fix\n   - Measure latency impact\n   - Verify fix doesn't break narrative flow\n\n3. **Regression Tests**: Prevent re-introduction\n   - Archive violating transcripts as test cases\n   - Run against each build\n\n### Implementation Phases\n\n**Phase 1: Detection Only (Low Risk)**\n- Implement `IdentityViolationDetector`\n- Log violations without remediation\n- Gather metrics on frequency/types\n\n**Phase 2: Quick Fix (Medium Risk)**\n- Implement regex-based quick fix\n- Apply to low-severity violations\n- Monitor for awkward phrasing\n\n**Phase 3: LLM Rewrite (Higher Risk)**\n- Implement targeted sentence rewrite\n- Add latency monitoring\n- A/B test against no-fix baseline\n\n**Phase 4: Full Integration**\n- Enable full regeneration path\n- Tune decision thresholds\n- Add retry caps and circuit breakers\n\n## Files to Create/Modify\n\n### New Files\n- `party-lore-ai/src/main/java/com/partylore/ai/validation/IdentityViolationDetector.java`\n- `party-lore-ai/src/test/java/com/partylore/ai/validation/IdentityViolationDetectorTest.java`\n\n### Modified Files\n- `TwoTierNarrativeService.java` - Integration point after Tier 2\n- `NarrativeQualityAnalysisService.java` - Use same patterns for analysis\n\n## Open Questions\n\n1. **Pronoun Resolution**: Should we track pronouns after player names?\n   - `\"Eira'nai entered. Her eyes scanned...\"` - \"Her\" refers to player\n   - More complex detection, higher false positive risk\n\n2. **Genre Sensitivity**: Do violations differ by realm type?\n   - Fantasy: \"gazes\", \"draws sword\"\n   - Cyberpunk: \"fires\", \"hacks\"\n   - May need genre-specific verb lists\n\n3. **Performance Budget**: What's acceptable latency for fixes?\n   - Current Tier 2: ~3-4s\n   - Max acceptable: ~6-7s total?\n\n4. **Quality vs Speed**: Should we always fix, or accept some violations?\n   - Fix all ‚Üí higher quality, higher latency\n   - Fix high-severity only ‚Üí lower latency, some violations slip through\n\n## Related Work\n\n- `ModeSpecificPrompts.java` - TIER2_SHARED_RULES contains identity rules\n- `NarrativeQualityAnalysisService.java` - Post-hoc analysis (not real-time)\n- `RealmSpecificPromptGenerator.java` - Dynamic example generation (prevention)\n\n---\n\n**Next Steps:**\n1. Review this design with the team\n2. Implement Phase 1 (detection only) to gather baseline metrics\n3. Decide on acceptable latency budget for remediation\n4. Proceed with Phase 2-4 based on metrics\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/IDENTITY-VIOLATION-DETECTION.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "37a45eea38471923",
      "size_bytes": 16222,
      "created_at": "2026-01-02T20:42:12.437503"
    },
    {
      "doc_id": "local_party-lore_docs_ONBOARDING_UX_ANALYSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/ONBOARDING_UX_ANALYSIS.md",
      "content": "# Onboarding UX Analysis & Improvements\n\n## Summary of Work Completed\n\n### 1. Message Constants Centralization ‚úÖ\n\n**Created**: `GameplayMessages.java` - Centralized constants for all gameplay command messages\n**Updated**: `CommandHandler.java` - Replaced all hard-coded strings with constants\n**Existing**: `OnboardingPrompts.java` - Already contains onboarding flow messages\n\n**All SMS text messages are now in constants files**, making them easy to find, update, and optimize.\n\n---\n\n## Actual Conversation Flows (from E2E Tests)\n\n### HOST ONBOARDING FLOW (Game Creation)\n\n```\n[1] USER texts: \"START\" or \"NEW\"\n    SYSTEM: üé≤ Welcome to Party Lore!\n\n            You can now create adventures or join your friends!\n\n            ‚ú® TO CREATE A NEW GAME:\n            Text: NEW or NEW GAME\n            (You'll pick your realm next!)\n\n            üë• TO JOIN A FRIEND'S GAME:\n            Ask your friend (the Host) to send you an INVITE!\n\n            ‚ùì NEED HELP?\n            Text: HELP\n\n            Ready to begin your adventure?\n\n[2] USER texts: \"NEW\"\n    SYSTEM: Perfect! You'll be the Host of this game.\n\n            What kind of adventure sounds fun?\n\n            üìñ AVAILABLE REALMS:\n            üó°Ô∏è FANTASY (Epic Sword & Sorcery)\n               A classic fantasy adventure with magic and dragons\n\n            üåÜ CYBERPUNK (Neon Shadows)\n               High-tech dystopian future\n\n            üëª HORROR (The Whispering Dark)\n               Cosmic mystery & dread\n\n            Reply with the realm name (FANTASY, CYBERPUNK, or HORROR)\n\n[3] USER texts: \"FANTASY\"\n    SYSTEM: Great choice!\n\n            What's your name? (Your real name, so players know who's hosting)\n\n[4] USER texts: \"Doug\"\n    SYSTEM: Thanks Doug!\n\n            Now, what's YOUR character's name?\n            (You're playing too! This is your hero in the game)\n\n[5] USER texts: \"Gandor\"\n    SYSTEM: Gandor - great name!\n\n            What kind of character are you in Epic Sword & Sorcery?\n\n            ‚Ä¢ Warrior\n            ‚Ä¢ Mage\n            ‚Ä¢ Rogue\n            ‚Ä¢ Cleric\n\n            Which sounds fun?\n\n[6] USER texts: \"Warrior\"\n    SYSTEM: üó°Ô∏è Your fantasy adventure \"The Dragon's Hoard\" is ready!\n\n            Host: Doug (playing Gandor the Warrior)\n\n            üë• Invite at least 1 friend to join (max 5):\n\n            INVITE +1-555-1234 Alice\n            INVITE +1-555-5678 Bob\n\n            üí° Your friends will get beta access automatically!\n            They'll create their character and join the party group chat.\n\n            üé≤ Once you have 2+ players, type START to begin!\n```\n\n### INVITED PLAYER ONBOARDING FLOW\n\n```\n[1] HOST texts: \"INVITE +15552222222 Alice\"\n    [System grants beta access to player]\n    [System sends invitation via SMS to +15552222222]\n\n[2] PLAYER receives SMS:\n    \"Alice, you've been invited to join 'The Dragon's Hoard'! Reply YES to join.\"\n\n[3] PLAYER texts: \"YES\"\n    SYSTEM: Welcome to The Dragon's Hoard! üé≤\n\n            Let's create your character.\n\n            What's your character's name?\n\n[4] PLAYER texts: \"Raven\"\n    SYSTEM: Raven - great name!\n\n            What kind of character are you?\n\n            ‚Ä¢ Warrior\n            ‚Ä¢ Mage\n            ‚Ä¢ Rogue\n            ‚Ä¢ Cleric\n\n            Which sounds fun?\n\n[5] PLAYER texts: \"Rogue\"\n    SYSTEM: ‚úÖ Raven has joined the adventure!\n\n            You've been added to the party group chat.\n            You can now message your entire party! üé≤\n```\n\n### GAME START FLOW\n\n```\n[1] HOST texts: \"START\"\n    SYSTEM (to HOST): ‚úÖ Game started!\n\n                      The adventure begins!\n\n                      Your party of 2 adventurers is now in an active game.\n                      The opening narrative will arrive shortly...\n\n[2] SYSTEM (to GROUP): üé≤ The adventure begins!\n\n                       The party is ready. Your adventure begins NOW!\n\n[3] SYSTEM (to GROUP): üé≠ THE STORY BEGINS...\n\n                       [AI-generated opening narrative based on realm]\n\n                       What do you do?\n```\n\n---\n\n## Claude AI UX Analysis Prompt\n\n### Context to Provide to Claude AI\n\n```\nI need you to analyze these SMS conversation flows for a text-message-based RPG game called Party Lore.\n\n**TARGET AUDIENCE**: Adults aged 40+, casual gamers, familiar with texting but NOT necessarily with RPGs or complex tech.\n\n**GOAL**: Make the onboarding experience SIMPLE, CLEAR, and FRIENDLY for people who may have never played a tabletop RPG before.\n\n**GAME CONCEPT**:\n- SMS-based AI-powered tabletop RPG\n- One person (HOST) creates a game and invites friends\n- All players text their actions and receive AI-generated narrative responses\n- Available realms: FANTASY, CYBERPUNK, HORROR\n- Each realm has different character classes (Warrior, Mage, Rogue, etc.)\n\n**EVALUATION CRITERIA**:\n1. **Clarity**: Are instructions easy to understand?\n2. **Simplicity**: Is the flow too complicated? Too many steps?\n3. **Reassurance**: Do users feel confident they're doing it right?\n4. **Error Recovery**: What happens if they type the wrong thing?\n5. **Momentum**: Does it feel like progress, or are they stuck in an endless wizard?\n6. **Jargon**: Are there terms that need explanation (DM, realm, character class)?\n7. **Emoji Usage**: Helpful or distracting?\n8. **Message Length**: Too much text? Too little?\n\n**YOUR TASK**:\n1. Read through both the HOST ONBOARDING FLOW and INVITED PLAYER FLOW\n2. Identify confusing or unclear messages\n3. Suggest specific improvements to the message text\n4. Recommend simplifications to the flow\n5. Highlight any potential frustration points for 40+ users\n\n**FORMAT YOUR RESPONSE**:\nFor each issue:\n- **Issue**: [What's confusing]\n- **Why it matters**: [Why this is a problem for 40+ users]\n- **Recommendation**: [Specific text suggestion or flow change]\n- **Example**: [Show the improved version]\n```\n\n---\n\n## Initial UX Issues Identified\n\n### Issue 1: Too Many Steps to Create Game\n**Problem**: 6 steps (START ‚Üí Realm ‚Üí Name ‚Üí Character Name ‚Üí Class ‚Üí Done)\n**Impact**: 40+ users may lose patience or make mistakes\n**Recommendation**: Consider combining steps or reducing required information\n\n### Issue 2: Realm Selection Requires Typing\n**Problem**: User must type \"FANTASY\" correctly (case-insensitive, but still manual)\n**Impact**: Typos cause errors, frustration\n**Recommendation**: Add numbered options: \"Reply 1 for FANTASY, 2 for CYBERPUNK, 3 for HORROR\"\n\n### Issue 3: Character Class Formatting\n**Problem**: Bullet list requires scrolling, not clear you should type the exact word\n**Impact**: User might type \"1\" or \"warrior\" (lowercase) instead of \"Warrior\"\n**Recommendation**: Explicitly say \"Reply with: Warrior, Mage, Rogue, or Cleric\"\n\n### Issue 4: Two Names Confusing\n**Problem**: \"What's your name?\" then \"What's YOUR character's name?\"\n**Impact**: Users may be confused about the difference, especially non-RPG players\n**Recommendation**: Clarify: \"First, your REAL name (Doug)\" then \"Now your CHARACTER's name in the game (Gandor)\"\n\n### Issue 5: \"START\" Overloaded\n**Problem**: \"START\" creates game in welcome, then \"START\" begins gameplay later\n**Status**: FIXED - Now uses \"NEW\" or \"NEW GAME\" to create, \"START\" only for gameplay\n\n### Issue 6: No Confirmation Before Game Creation\n**Problem**: After typing class, game is immediately created\n**Impact**: Can't review choices before committing\n**Recommendation**: Add summary: \"You're creating: [realm] adventure, Host: [name], Character: [char name] the [class]. Reply YES to confirm or EDIT to change.\"\n\n### Issue 7: Invitation Message Not Shown\n**Problem**: We don't see what the invitation SMS says to the invited player\n**Impact**: Can't evaluate if it's clear\n**Action Needed**: Document the actual invitation message text\n\n### Issue 8: Group Chat Concept Not Explained\n**Problem**: \"party group chat\" mentioned but not explained\n**Impact**: Users may not understand how messaging will work\n**Recommendation**: Add: \"All your messages will go to your whole party in one group chat. Everyone sees what everyone says!\"\n\n---\n\n## Specific Message Improvements for 40+ Users\n\n### BEFORE (Realm Selection):\n```\nüìñ AVAILABLE REALMS:\nüó°Ô∏è FANTASY (Epic Sword & Sorcery)\n   A classic fantasy adventure with magic and dragons\n\nReply with the realm name (FANTASY, CYBERPUNK, or HORROR)\n```\n\n### AFTER (Easier):\n```\nPick your adventure type:\n\n1Ô∏è‚É£ FANTASY - Swords, magic, dragons\n2Ô∏è‚É£ CYBERPUNK - Futuristic tech cities\n3Ô∏è‚É£ HORROR - Spooky mysteries\n\nReply with the NUMBER (1, 2, or 3) or name (FANTASY, CYBERPUNK, HORROR)\n```\n\n### BEFORE (Character Class):\n```\nWhat kind of character are you in Epic Sword & Sorcery?\n\n‚Ä¢ Warrior\n‚Ä¢ Mage\n‚Ä¢ Rogue\n‚Ä¢ Cleric\n\nWhich sounds fun?\n```\n\n### AFTER (Clearer):\n```\nChoose your character type:\n\n1. WARRIOR - Strong fighter with sword & shield\n2. MAGE - Magic user who casts spells\n3. ROGUE - Sneaky thief good at tricks\n4. CLERIC - Healer who helps the party\n\nReply with NUMBER (1-4) or NAME (Warrior, Mage, etc.)\n```\n\n### BEFORE (Two Names):\n```\nWhat's your name? (Your real name, so players know who's hosting)\n\n[then later]\n\nNow, what's YOUR character's name?\n(You're playing too! This is your hero in the game)\n```\n\n### AFTER (Less Confusing):\n```\nFirst question: What's YOUR real name?\n(This helps your friends know who's running the game)\n\nExample: Doug, Sarah, Mike\n\n[then later]\n\nSecond question: What's your CHARACTER's name in the game?\n(This is your hero's name in the adventure - make it fun!)\n\nExample: Gandor, Raven, Thor\n```\n\n---\n\n## Recommended Testing with Actual 40-Year-Olds\n\n1. **Find 3-5 people aged 40-50 who are NOT gamers**\n2. **Give them minimal instructions**: \"Text this number to start playing\"\n3. **Watch where they get stuck or confused**\n4. **Ask afterwards**:\n   - \"What was confusing?\"\n   - \"What would you change?\"\n   - \"Did you feel like you knew what to do?\"\n   - \"Would you invite your friends to play?\"\n\n---\n\n## Priority Improvements\n\n### P0 (Critical for 40+ Users):\n1. ‚úÖ **Remove hard-coded realms** - DONE\n2. ‚úÖ **Change START to NEW for game creation** - DONE\n3. ‚úÖ **Add numbered options for realm and class selection** - DONE\n4. ‚úÖ **Clarify real name vs character name** - DONE\n5. ‚úÖ **Add confirmation step before creating game** - DONE\n\n### P1 (High Value):\n6. ‚úÖ **Simplify class descriptions** (shorter, clearer) - DONE (\"Strong fighter with weapons\")\n7. **Explain group chat concept earlier** - TODO\n8. **Add progress indicator** (\"Step 2 of 5\") - TODO\n9. **Add fuzzy matching for typos** - TODO\n\n### P2 (Nice to Have):\n10. ‚úÖ **Hide EDIT from confirmation** (removed from user message) - DONE\n11. **Add HELP command at each step** - TODO\n12. **Allow BACK to fix mistakes** - TODO\n13. **Add player confirmation step** (host gets confirmation but players don't) - TODO (BUT NOT NEEDED - see analysis)\n\n---\n\n## What's Been Implemented (October 2025)\n\n### ‚úÖ Numbered Options for All Selections\n- **Realm selection**: User can type \"1\" instead of \"FANTASY\"\n- **Class selection**: User can type \"2\" instead of \"MAGE\"\n- **Emoji markers**: Uses 1Ô∏è‚É£, 2Ô∏è‚É£, 3Ô∏è‚É£ for visual scanning\n- **Both flows**: Works for both host game creation AND player onboarding\n\n### ‚úÖ Confirmation Step for Host\n- Shows summary after class selection: \"Look good? Reply YES to create, or EDIT to change\"\n- Displays realm, host name, character name, and class\n- Prevents accidental game creation from typos\n- **KNOWN ISSUE**: EDIT not yet implemented, only YES works\n\n### ‚úÖ Simple Class Descriptions\n- Old: \"‚Ä¢ Warrior\"\n- New: \"1Ô∏è‚É£ WARRIOR - Strong fighter with weapons\"\n- Each class has clear, simple description (not jargon)\n\n### ‚úÖ Realm Loading from Database\n- No more hard-coded realms in conversation handler\n- Realms load from JSON configuration files\n- Each realm defines its own available classes\n- E2E tests verify realms load properly\n\n### ‚úÖ All E2E Tests Passing\n- `ComprehensiveOnboardingE2ETest` - 3 tests, all passing\n- Tests verify: host onboarding, player onboarding, numbered selection\n- State machine properly validates all transitions\n\n---\n\n## Updated Conversation Flows (ACTUAL CURRENT STATE)\n\n### HOST FLOW (with numbered options + confirmation)\n\n```\nUSER: START\n\nBOT: Perfect! You'll be the Host of this game.\n\nPick your adventure type:\n\n1Ô∏è‚É£ FANTASY - Classic sword & sorcery adventure\n2Ô∏è‚É£ CYBERPUNK - A cyberpunk noir detective story set in New Shenzhen\n3Ô∏è‚É£ HORROR - Lovecraftian horror investigation\n\nReply with the NUMBER (1, 2, 3) or name\n\nUSER: 1\n\nBOT: Great choice!\n\nFirst: What's YOUR real name?\n(So your friends know who's running the game)\n\nExample: Doug, Sarah, Mike\n\nUSER: Doug\n\nBOT: Thanks Doug!\n\nSecond: What's your CHARACTER's name?\n(This is your hero's name in the adventure)\n\nExample: Gandor, Raven, Thor\n\nUSER: Gandor\n\nBOT: Gandor - great name!\n\nChoose your character type:\n\n1Ô∏è‚É£ WARRIOR - Strong fighter with weapons\n2Ô∏è‚É£ MAGE - Magic user who casts spells\n3Ô∏è‚É£ ROGUE - Sneaky character good at tricks\n4Ô∏è‚É£ CLERIC - Healer who helps the party\n\nReply with NUMBER (1-4) or name\n\nUSER: 1\n\nBOT: Perfect! Here's your game:\n\nüó°Ô∏è Realm: Eldergrove\nüéÆ Host: Doug\n‚öîÔ∏è Character: Gandor the Warrior\n\nReply YES to create your game\n\nUSER: YES\n\nBOT: üó°Ô∏è Your FANTASY adventure \"Eldergrove\" is ready!\n\nHost: Doug (playing Gandor the Warrior)\n\nüë• Invite at least 1 friend to join (max 5):\n\nINVITE +1-555-1234 Alice\nINVITE +1-555-5678 Bob\n\nüí° Your friends will get beta access automatically!\nThey'll create their character and join the party group chat.\n\nüé≤ Once you have 2+ players, type START to begin!\n```\n\n### PLAYER FLOW (with numbered class selection)\n\n```\nBOT: Welcome to Eldergrove! üé≤\n\nLet's create your character.\n\nWhat's your character's name?\n\nUSER: Raven\n\nBOT: Raven - great name!\n\nChoose your character type:\n\n1Ô∏è‚É£ WARRIOR - Strong fighter with weapons\n2Ô∏è‚É£ MAGE - Magic user who casts spells\n3Ô∏è‚É£ ROGUE - Sneaky character good at tricks\n4Ô∏è‚É£ CLERIC - Healer who helps the party\n\nReply with NUMBER (1-4) or name\n\nUSER: 2\n\nBOT: ‚úÖ Raven the Mage has joined the adventure!\n\nYou've been added to the party group chat.\nYou can now message your entire party! üé≤\n```\n\n---\n\n## Remaining UX Issues\n\n### Issue 1: EDIT Command Not Advertised\n**Status**: ‚úÖ RESOLVED\n**Problem**: Confirmation said \"EDIT to change\" but EDIT wasn't fully implemented\n**Solution**: Removed \"EDIT to change\" from confirmation message\n**Current Message**: \"Reply YES to create your game\"\n**Note**: EDIT still works in backend if user types it, but we don't advertise it\n\n### Issue 2: No Player Confirmation\n**Status**: ‚úÖ INTENTIONAL DESIGN (Not a Bug)\n**Analysis**: This asymmetry is actually GOOD UX design:\n- **Host flow** (high stakes): Creates game for everyone, justifies confirmation\n- **Player flow** (low stakes): Only affects their character, faster = better\n- **40+ users**: Fewer steps = less confusion, better conversion\n- **Quick join**: Players are already motivated (invited by friend)\n**Decision**: Keep player flow simple - NO confirmation step needed\n\n### Issue 3: Tutorial Not Triggered\n**Status**: ‚ö†Ô∏è CONTENT MISSING\n**Problem**: `PLAYER_ONBOARDING_TUTORIAL_WELCOME` exists in prompts but never sent\n**Impact**: Players don't learn about commands (HELP, STATUS, etc.)\n**Recommendation**: Send tutorial after player confirms character\n\n### Issue 4: No Fuzzy Matching\n**Status**: ‚ö†Ô∏è ERROR PRONE\n**Problem**: Typing \"rouge\" instead of \"rogue\" causes error\n**Impact**: Frustration for users with typos\n**Recommendation**: Add fuzzy string matching (Levenshtein distance)\n\n---\n\n## Next Steps\n\n1. ‚úÖ **Fix E2E tests** - COMPLETED (all tests passing)\n2. ‚úÖ **Update this document** - COMPLETED\n3. ‚úÖ **Decide on EDIT command** - COMPLETED (removed from message, kept backend support)\n4. ‚úÖ **Player confirmation analysis** - COMPLETED (determined not needed)\n5. **Implement fuzzy matching** - TODO (reduce typo errors)\n6. **Add tutorial for invited players** - TODO (content exists but not sent)\n7. **User testing with 40+ adults** - TODO (get real feedback)\n\n---\n\n**Last Updated**: October 2025\n**Status**: Numbered options + confirmation implemented and tested\n**Test Results**: ‚úÖ All E2E tests passing (ComprehensiveOnboardingE2ETest)\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/ONBOARDING_UX_ANALYSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "bab3cfabb53c5dde",
      "size_bytes": 16254,
      "created_at": "2026-01-02T20:42:12.437620"
    },
    {
      "doc_id": "local_party-lore_docs_MULTI_CHANNEL_IMPLEMENTATION",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/MULTI_CHANNEL_IMPLEMENTATION.md",
      "content": "# Multi-Channel Architecture Implementation - Steps 3-4\n\n**Date**: 2025-10-18\n**Status**: ‚úÖ Complete | All Tests Passing\n\n---\n\n## Executive Summary\n\nSuccessfully implemented multi-channel messaging architecture to support **both SMS and WebSocket (mobile app) delivery simultaneously**. The platform can now:\n\n- ‚úÖ Route messages based on player connection type\n- ‚úÖ Support SMS-only players (current)\n- ‚úÖ Support WebSocket-only players (future mobile app)\n- ‚úÖ Support BOTH channels simultaneously (transition period)\n- ‚úÖ All 17 E2E tests passing\n- ‚úÖ Backward compatible with existing SMS-only functionality\n\n---\n\n## What Was Implemented\n\n### Step 3: Connection Type Tracking ‚úÖ\n\n**Files Created:**\n- `ConnectionType.java` - Enum for connection types (SMS, WEBSOCKET, BOTH)\n- `V057__add_player_connection_tracking.sql` - Database migration\n\n**Files Modified:**\n- `Player.java` - Added connection tracking fields\n\n**Changes:**\n\n#### ConnectionType Enum\n```java\npublic enum ConnectionType {\n    SMS,        // Traditional SMS-only players\n    WEBSOCKET,  // Mobile app via WebSocket\n    BOTH        // Receive via both channels\n}\n```\n\n#### Player Model Additions\n```java\n// Multi-channel connection tracking\n@Column(name = \"connection_type\")\nprivate ConnectionType connectionType = ConnectionType.SMS;\n\n@Column(name = \"device_id\")\nprivate String deviceId;\n\n@Column(name = \"last_seen_app\")\nprivate OffsetDateTime lastSeenApp;\n\n@Column(name = \"prefer_app_notifications\")\nprivate Boolean preferAppNotifications = false;\n\n// Helper methods\npublic boolean isConnectedViaSms() {...}\npublic boolean isConnectedViaWebSocket() {...}\npublic void updateAppConnection(String deviceId) {...}\npublic void disconnectApp() {...}\n```\n\n#### Database Migration\n```sql\nALTER TABLE players\n    ADD COLUMN connection_type VARCHAR(20) NOT NULL DEFAULT 'SMS',\n    ADD COLUMN device_id VARCHAR(255),\n    ADD COLUMN last_seen_app TIMESTAMP WITH TIME ZONE,\n    ADD COLUMN prefer_app_notifications BOOLEAN NOT NULL DEFAULT FALSE;\n\nCREATE INDEX idx_player_connection ON players(connection_type, last_seen_app);\nCREATE INDEX idx_player_device ON players(device_id) WHERE device_id IS NOT NULL;\n```\n\n### Step 4: MessagingService Abstraction ‚úÖ\n\n**Files Created:**\n- `MessagingService.java` (interface) - Multi-channel messaging abstraction\n- `MultiChannelMessagingService.java` - Implementation with routing logic\n\n**Files Modified:**\n- `MessageBroadcaster.java` - Updated to use MessagingService\n\n**Changes:**\n\n#### MessagingService Interface\n```java\npublic interface MessagingService {\n    void sendToPlayer(Player player, String message);\n    void broadcastToGame(GameSession game, String fromCharacter, String message);\n    void sendSystemAnnouncement(GameSession game, String announcement);\n    void sendDirectMessage(Player fromPlayer, Player toPlayer, String message);\n}\n```\n\n#### MultiChannelMessagingService Implementation\nRoutes messages based on `player.getConnectionType()`:\n\n```java\nswitch (player.getConnectionType()) {\n    case SMS:\n        sendViaSms(player, message);\n        break;\n\n    case WEBSOCKET:\n        sendViaWebSocket(player, message);\n        break;\n\n    case BOTH:\n        // Send via both channels\n        if (player.getPreferAppNotifications()) {\n            // Try WebSocket first, SMS as backup\n        } else {\n            // Send to both\n        }\n        break;\n}\n```\n\n#### MessageBroadcaster Updated\n```java\n// Before: Direct SMS delivery\nsmsService.sendSms(player.getPhoneNumber(), message);\n\n// After: Multi-channel routing\nmessagingService.sendToPlayer(player, message);\n```\n\n---\n\n## Architecture\n\n### Message Routing Flow\n\n```\nPlayer sends message\n    ‚Üì\nMessageBroadcaster receives\n    ‚Üì\nMessagingService.sendToPlayer(player, message)\n    ‚Üì\nCheck player.connectionType\n    ‚Üì\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ    SMS      ‚îÇ  WEBSOCKET  ‚îÇ    BOTH     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n      ‚Üì             ‚Üì             ‚Üì\n  SMS only      WebSocket    SMS + WebSocket\n               (future)      (simultaneously)\n```\n\n### Connection Type Behavior\n\n| Type | SMS Delivery | WebSocket Delivery | Use Case |\n|------|--------------|-------------------|----------|\n| **SMS** | ‚úÖ | ‚ùå | Current players, no app |\n| **WEBSOCKET** | ‚ùå | ‚úÖ | Mobile app only (future) |\n| **BOTH** | ‚úÖ | ‚úÖ | Transition, power users |\n\n### Player Lifecycle\n\n```\nNew Player joins\n  ‚Üí connectionType = SMS (default)\n  ‚Üí Plays via SMS\n\nPlayer installs mobile app\n  ‚Üí updateAppConnection(deviceId)\n  ‚Üí connectionType = BOTH\n  ‚Üí Receives messages in app AND SMS\n\nPlayer uninstalls/closes app\n  ‚Üí disconnectApp()\n  ‚Üí connectionType = SMS\n  ‚Üí Back to SMS-only\n```\n\n---\n\n## Files Changed\n\n### Domain Layer (4 files)\n```\nparty-lore-domain/src/main/java/com/partylore/domain/\n  ‚îú‚îÄ‚îÄ model/\n  ‚îÇ   ‚îú‚îÄ‚îÄ ConnectionType.java                       (new enum)\n  ‚îÇ   ‚îî‚îÄ‚îÄ Player.java                                (added 4 fields + helpers)\n  ‚îú‚îÄ‚îÄ service/messaging/\n  ‚îÇ   ‚îî‚îÄ‚îÄ MessagingService.java                      (new interface)\n  ‚îî‚îÄ‚îÄ service/game/\n      ‚îî‚îÄ‚îÄ MessageBroadcaster.java                    (use MessagingService)\n\nparty-lore-domain/src/main/resources/db/migration/\n  ‚îî‚îÄ‚îÄ V057__add_player_connection_tracking.sql       (new migration)\n```\n\n### SMS Layer (1 file)\n```\nparty-lore-sms/src/main/java/com/partylore/sms/service/\n  ‚îî‚îÄ‚îÄ MultiChannelMessagingService.java              (new implementation)\n```\n\n**Total: 6 files created/modified**\n\n---\n\n## Code Examples\n\n### Sending Messages (Before vs After)\n\n**Before (SMS-only):**\n```java\n// MessageBroadcaster - hardcoded to SMS\nfor (Player player : players) {\n    smsService.sendSms(player.getPhoneNumber(), message);\n}\n```\n\n**After (Multi-channel):**\n```java\n// MessageBroadcaster - routes based on connection type\nfor (Player player : players) {\n    messagingService.sendToPlayer(player, message);\n}\n\n// MultiChannelMessagingService - handles routing\npublic void sendToPlayer(Player player, String message) {\n    switch (player.getConnectionType()) {\n        case SMS -> sendViaSms(player, message);\n        case WEBSOCKET -> sendViaWebSocket(player, message);\n        case BOTH -> sendToBoth(player, message);\n    }\n}\n```\n\n### Player Connection Management\n\n**Connecting to mobile app:**\n```java\nPlayer player = playerRepository.findById(playerId);\n\n// Player opens mobile app\nplayer.updateAppConnection(deviceId);\n// connectionType: SMS ‚Üí BOTH\n// deviceId: \"abc-123-xyz\"\n// lastSeenApp: NOW()\n\nplayerRepository.save(player);\n```\n\n**Disconnecting from mobile app:**\n```java\nPlayer player = playerRepository.findById(playerId);\n\n// Player closes mobile app\nplayer.disconnectApp();\n// connectionType: BOTH ‚Üí SMS\n// deviceId: null\n\nplayerRepository.save(player);\n```\n\n---\n\n## WebSocket Integration (Future)\n\nThe architecture is ready for WebSocket support. When the mobile app is implemented:\n\n### 1. Create WebSocketService\n```java\n@Service\npublic class WebSocketService {\n    public void sendToDevice(String deviceId, String message) {\n        // Find WebSocket session by deviceId\n        // Send message via WebSocket\n    }\n}\n```\n\n### 2. Inject into MultiChannelMessagingService\n```java\n@Service\npublic class MultiChannelMessagingService {\n    private final TwilioSmsService smsService;\n    private final WebSocketService webSocketService; // Add this\n\n    // Update sendViaWebSocket() implementation\n    private boolean sendViaWebSocket(Player player, String message) {\n        if (player.hasDeviceId()) {\n            webSocketService.sendToDevice(player.getDeviceId(), message);\n            return true;\n        }\n        return false;\n    }\n}\n```\n\n### 3. Handle WebSocket Connections\n```java\n@Controller\npublic class GameWebSocketController {\n\n    @MessageMapping(\"/connect\")\n    public void handleConnection(String deviceId, Principal principal) {\n        // Find player by phone number (from auth)\n        Player player = playerRepository.findByPhoneNumber(phoneNumber);\n\n        // Update connection\n        player.updateAppConnection(deviceId);\n        playerRepository.save(player);\n    }\n\n    @MessageMapping(\"/disconnect\")\n    public void handleDisconnection(Principal principal) {\n        Player player = playerRepository.findByPhoneNumber(phoneNumber);\n        player.disconnectApp();\n        playerRepository.save(player);\n    }\n}\n```\n\n---\n\n## Test Results\n\n### E2E Tests\n```\nTests run: 17, Failures: 0, Errors: 0, Skipped: 0\nBUILD SUCCESS\n```\n\nAll existing tests pass without modification - **fully backward compatible**.\n\n### Verified Functionality\n- ‚úÖ Game creation\n- ‚úÖ Player onboarding\n- ‚úÖ Message broadcasting\n- ‚úÖ Private messages\n- ‚úÖ System announcements\n- ‚úÖ AI narration delivery\n\n---\n\n## Deployment Plan\n\n### Prerequisites\n- ‚úÖ Code implemented and tested\n- ‚úÖ Database migration ready (V057)\n- ‚úÖ All tests passing\n- ‚úÖ Backward compatible (no breaking changes)\n\n### Deployment Steps\n\n1. **Deploy Code**\n```bash\ngit add -A\ngit commit -m \"feat: Add multi-channel messaging support (Steps 3-4)\"\ngit push origin main\nrailway up\n```\n\n2. **Verify Migration**\n```bash\n# Migration runs automatically via Flyway\nrailway logs --service party-lore-app | grep \"V057\"\n\n# Verify in database\nrailway run psql\nSELECT connection_type, COUNT(*) FROM players GROUP BY connection_type;\n# Should show all players with connection_type = 'SMS'\n```\n\n3. **Monitor**\n```bash\n# Watch for multi-channel logs\nrailway logs --service party-lore-app | grep \"connection_type\"\n\n# Look for:\n# - \"Sent message to PlayerName (SMS)\"\n# - \"WebSocket delivery not yet implemented\" (expected)\n```\n\n### Rollback Plan\n\nIf issues arise:\n```bash\n# Revert code\ngit revert HEAD\nrailway up\n\n# Migration is safe - only adds columns with defaults\n# No data loss, all existing players default to SMS\n```\n\n---\n\n## Benefits\n\n### Immediate (Current State)\n- ‚úÖ **No functional changes** - all players still SMS-only\n- ‚úÖ **Infrastructure ready** - can add WebSocket without refactoring\n- ‚úÖ **Clean architecture** - messaging abstraction decouples delivery\n- ‚úÖ **Easy testing** - mock different connection types\n\n### Future (With Mobile App)\n- üöÄ **Real-time delivery** - instant notifications via WebSocket\n- üöÄ **Better UX** - rich formatting, images, buttons in app\n- üöÄ **Cost savings** - WebSocket cheaper than SMS for active users\n- üöÄ **Gradual migration** - BOTH mode allows smooth transition\n- üöÄ **Offline support** - SMS fallback when app not open\n\n---\n\n## Metrics\n\n### Code Impact\n- **Lines added**: ~350 lines (ConnectionType, MessagingService, migration)\n- **Files created**: 6 new files\n- **Files modified**: 2 files (Player, MessageBroadcaster)\n- **Tests**: 0 broken, 17 passing (100% compatibility)\n\n### Database Impact\n- **New columns**: 4 (connection_type, device_id, last_seen_app, prefer_app_notifications)\n- **New indexes**: 2 (for efficient routing queries)\n- **Migration time**: <1 second (simple ALTER TABLE)\n\n### Performance\n- **Current**: No performance impact (same SMS delivery)\n- **Future**: Faster delivery for WebSocket users\n- **Scalability**: Ready for 10K+ concurrent WebSocket connections\n\n---\n\n## Summary\n\nSteps 3-4 successfully implemented:\n\n**‚úÖ Step 3: Connection Type Tracking**\n- Created ConnectionType enum\n- Added 4 fields to Player model\n- Created V057 migration\n- All tests passing\n\n**‚úÖ Step 4: MessagingService Abstraction**\n- Created MessagingService interface\n- Implemented MultiChannelMessagingService\n- Updated MessageBroadcaster to use abstraction\n- WebSocket routing ready (stubbed for future)\n\n**Architecture is production-ready** for multi-channel support. When mobile app is implemented, only need to:\n1. Create WebSocketService\n2. Implement sendViaWebSocket() method\n3. Add WebSocket connection handlers\n\n**All changes tested and ready for deployment.**\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/MULTI_CHANNEL_IMPLEMENTATION.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "da5ad044d1fae8fb",
      "size_bytes": 12061,
      "created_at": "2026-01-02T20:42:12.437685"
    },
    {
      "doc_id": "local_party-lore_docs_cutting-edge-AI-capabilities",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/cutting-edge-AI-capabilities.md",
      "content": "üéØ Tier 1: Revolutionary Impact (Highest Priority)\n\n1. MUCA Framework for SMS Group Coordination\nWhat It Adds: Sophisticated AI-mediated group dynamics for async multiplayer via SMS.\n\n\nWhy Revolutionary for Party Lore:\n\n3W Decision Framework: AI determines What to say, When to speak, Who to address in group SMS conversations\nAsync Group Facilitation: AI manages complex party decisions across time zones and activity patterns\nDemocratic Consensus Building: AI helps groups reach decisions even when players aren't online simultaneously\nConflict Resolution: AI mediates disputes and finds compromises automatically\n\nImplementation: Add AI Group Facilitator service that manages party SMS conversations, facilitates voting, and resolves conflicts.\n\n\n2. Living World with Real-Time Evolution\nWhat It Adds: World that evolves continuously 24/7 without player input.\n\n\nWhy Revolutionary for Party Lore:\n\nPersistent World Changes: NPCs pursue goals, form relationships, and create events while players are offline\nCollective Impact: All player actions contribute to shared world evolution\nSMS Event Notifications: Players receive updates about world changes relevant to their characters\nTemporal Consequences: Long-term effects manifest weeks/months after player actions\n\nImplementation: Add World Evolution Engine that runs continuously, generating events and sending SMS notifications.\n\n\n3. Cross-Player Narrative Interconnection\nWhat It Adds: Player storylines that influence and interconnect with each other.\n\n\nWhy Revolutionary for Party Lore:\n\nShared NPC Memory: NPCs remember interactions with ALL players and reference them in conversations\nRipple Effects: Actions in one player's story affect other players' narratives\nEmergent Community Stories: Major events emerge from collective player behavior\nSocial Narrative Web: Rich interconnected storytelling across the entire player base\n\nImplementation: Enhance memory system with cross-player narrative tracking and shared NPC consciousness.\n\n\nüî• Tier 2: High Impact (Medium Priority)\n\n4. Emotional Intelligence & Empathy Systems\nWhat It Adds: AI that recognizes player emotional states and responds empathetically.\n\n\nWhy Powerful for Party Lore:\n\nSMS Emotion Detection: Analyze text patterns to detect player mood, stress, excitement\nAdaptive Content Delivery: Adjust story pacing and challenge based on emotional state\nEmpathetic NPC Responses: Characters respond appropriately to player emotional needs\nBurnout Prevention: Detect disengagement patterns and proactively address them\n\nImplementation: Add Emotional Intelligence service that analyzes SMS patterns and adapts content.\n\n\n5. Collective Unconscious Modeling\nWhat It Adds: AI tracks collective player behavior to generate world events.\n\n\nWhy Powerful for Party Lore:\n\nCommunity-Driven Events: Major storylines emerge from aggregate player choices\nBehavioral Pattern Analysis: AI identifies trends across entire player base\nPersonalized World Events: Individual notifications about community-driven changes\nOrganic Content Generation: Stories that reflect what the community actually wants\n\nImplementation: Add Collective Behavior Analysis service that tracks patterns and generates community events.\n\n\nüöÄ Most Innovative Concepts Beyond Traditional AI\n\n6. Temporal Narrative Weaving\nRevolutionary Concept: AI manages complex consequences across extended timeframes (weeks/months).\n\n\nFor Party Lore:\n\nPlayers receive SMS about consequences of actions from months ago\nLong-term character relationships evolve based on accumulated interactions\nSeasonal storylines that span real-world time periods\n\"Butterfly effect\" narratives where small early actions have major later consequences\n\n7. Predictive Engagement AI\nRevolutionary Concept: AI predicts player disengagement and proactively creates compelling hooks.\n\n\nFor Party Lore:\n\nAnalyzes SMS response patterns to predict when players might quit\nGenerates personalized story hooks when disengagement risk is detected\nTailors content timing to individual player activity patterns\nCreates \"perfect timing\" moments for maximum emotional impact\n\nüìã Recommended Implementation Priority\n\nPhase 1: Group Dynamics Revolution\nMUCA Framework Implementation - Transform Party Lore into the most sophisticated SMS multiplayer experience\nCross-Player Narrative System - Create interconnected storytelling web\n\nPhase 2: Living World Implementation\nReal-Time World Evolution Engine - Make the world truly alive and persistent\nEmotional Intelligence System - Add empathy and emotional awareness\n\nPhase 3: Community-Driven Content\nCollective Unconscious Modeling - Generate events from community behavior\nTemporal Narrative Weaving - Long-term consequence management\n\nPhase 4: Predictive Systems\nPredictive Engagement AI - Proactive player retention through perfect timing\n\nüéÆ Why These Concepts Are Game-Changing\n\nFor SMS-Based RPGs: These concepts would make Party Lore the first truly AI-native multiplayer RPG, where:\n\nAI facilitates complex group interactions through SMS\nThe world evolves continuously with or without player input\nPlayer stories interconnect in meaningful ways\nAI understands and responds to player emotions\nCommunity behavior drives major storylines\nLong-term consequences create lasting narrative impact\n\nFor the Gaming Industry: This would pioneer entirely new categories of gaming experiences that couldn't exist without advanced AI - positioning Party Lore as the flagship example of \"AI-first game design.\"\n\n\nThe most critical addition would be the MUCA Framework for group coordination - this alone would revolutionize SMS multiplayer gaming and create competitive advantage no traditional game studio could easily replicate.",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/cutting-edge-AI-capabilities.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "async",
        "md"
      ],
      "content_hash": "8211d8c1a2a63e48",
      "size_bytes": 5710,
      "created_at": "2026-01-02T20:42:12.437798"
    },
    {
      "doc_id": "local_party-lore_docs_REALM_DATA_ASSESSMENT",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/REALM_DATA_ASSESSMENT.md",
      "content": "# Realm Data Quality Assessment\n**Date**: October 2025\n**Purpose**: Review realm JSON files for gameplay clarity, class naming, and AI prompt quality\n\n---\n\n## Executive Summary\n\n**Major Issues Found:**\n1. ‚ùå **FANTASY realm uses gender-split class names** (Lord/Lady, High Priest/Priestess)\n2. ‚ö†Ô∏è **Inconsistent class capability descriptions** - unclear how classes differ in gameplay\n3. ‚ö†Ô∏è **Horror realm is severely underdeveloped** compared to others\n4. ‚úÖ **Cyberpunk and Political Thriller have clean class names**\n\n**Impact on 40+ Users:**\n- Confusing gender splits in class selection (\"Do I type Lord or Lady?\")\n- Unclear what each class actually DOES in gameplay\n- No mechanical differentiation between classes\n- AI prompts are excellent, but class selection UX needs work\n\n---\n\n## Detailed Analysis by Realm\n\n### 1. FANTASY Realm (\"Ashen Crowns\")\n\n**Overall Quality**: ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) - Excellent AI prompts, poor class naming\n\n**Class Names (PROBLEMS):**\n```json\n\"availableClasses\": [\n  \"Lord/Lady\",              ‚ùå CONFUSING - Gender split, slash separator\n  \"Spymaster\",              ‚úÖ OK\n  \"Knight Commander\",       ‚úÖ OK\n  \"Court Scholar\",          ‚úÖ OK\n  \"Bastard Heir\",           ‚úÖ OK\n  \"Master of Coin\",         ‚úÖ OK\n  \"High Priest/Priestess\",  ‚ùå CONFUSING - Gender split, slash separator\n  \"Assassin\"                ‚úÖ OK\n]\n```\n\n**Issues:**\n1. **Gender Splits**: Users must choose Lord OR Lady, but prompt shows both\n   - 40+ users will be confused: \"Do I type 'Lord/Lady' or just 'Lord'?\"\n   - SMS UX shows: \"1Ô∏è‚É£ LORD/LADY - ???\"\n   - Better: Just \"Noble\" or \"Aristocrat\"\n\n2. **No Class Capability Descriptions**:\n   - What does a \"Spymaster\" DO vs. \"Assassin\"?\n   - How is \"Court Scholar\" different in gameplay from \"High Priest/Priestess\"?\n   - Classes exist but no mechanical differentiation explained\n\n**Recommendations:**\n```json\n\"availableClasses\": [\n  \"Noble\",              // Instead of Lord/Lady\n  \"Spymaster\",\n  \"Knight Commander\",\n  \"Court Scholar\",\n  \"Bastard Heir\",\n  \"Master of Coin\",\n  \"High Priest\",        // Instead of High Priest/Priestess\n  \"Assassin\"\n]\n```\n\n**Add Class Descriptions** (example):\n```json\n\"classDescriptions\": {\n  \"Noble\": {\n    \"summary\": \"Political power through bloodline and vassals\",\n    \"strengths\": [\"Diplomacy\", \"House Resources\", \"Legitimacy\"],\n    \"playstyle\": \"Command vassals, forge alliances, manage territories\"\n  },\n  \"Spymaster\": {\n    \"summary\": \"Information and espionage specialist\",\n    \"strengths\": [\"Intrigue\", \"Secrets\", \"Assassination Prevention\"],\n    \"playstyle\": \"Uncover plots, blackmail enemies, protect allies\"\n  }\n}\n```\n\n**AI Prompt Quality**: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5) - EXCELLENT\n- Vivid, specific, actionable\n- Clear tone and style\n- Great narrative examples\n- \"No plot armor\" mechanic is brilliant\n- Winter Clock adds urgency\n\n---\n\n### 2. CYBERPUNK Realm (\"Chrome Veil\")\n\n**Overall Quality**: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5) - Excellent across the board\n\n**Class Names (CLEAN):**\n```json\n\"availableClasses\": [\n  \"Private Investigator\",   ‚úÖ Clear, no gender split\n  \"Netrunner\",              ‚úÖ Clear\n  \"Street Samurai\",         ‚úÖ Clear\n  \"Fixer\",                  ‚úÖ Clear\n  \"Corporate Spy\",          ‚úÖ Clear\n  \"Journalist\",             ‚úÖ Clear\n  \"Techie\",                 ‚úÖ Clear\n  \"Rogue Cop\"               ‚úÖ Clear\n]\n```\n\n**Strengths:**\n- ‚úÖ No gender splits\n- ‚úÖ All class names are clear archetypes\n- ‚úÖ Easy to understand what each does\n- ‚úÖ Cyberware system provides mechanical differentiation\n\n**Still Missing:**\n- Explicit class capability descriptions\n- \"What can a Fixer do that a Corporate Spy can't?\"\n- \"How does Journalist differ mechanically from Private Investigator?\"\n\n**AI Prompt Quality**: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5) - EXCELLENT\n- Perfect noir tone\n- Specific cyberpunk details\n- Humanity vs. power tension is great\n- Matrix mechanics clear\n- Example scenarios are vivid\n\n---\n\n### 3. HORROR Realm (\"Horror\")\n\n**Overall Quality**: ‚≠ê‚≠ê (2/5) - SEVERELY UNDERDEVELOPED\n\n**Class Names (CLEAN but BLAND):**\n```json\n\"availableClasses\": [\n  \"Investigator\",   ‚úÖ Clear but generic\n  \"Occultist\",      ‚úÖ Clear\n  \"Survivor\",       ‚úÖ Clear but vague\n  \"Hunter\",         ‚úÖ Clear but vague\n  \"Medium\",         ‚úÖ Clear\n  \"Scholar\",        ‚úÖ Clear but vague\n  \"Veteran\",        ‚úÖ Clear but vague\n  \"Psychic\"         ‚úÖ Clear\n]\n```\n\n**Critical Problems:**\n1. **No factions** (other realms have detailed faction systems)\n2. **No starting scenario** (other realms have elaborate hooks)\n3. **No unique features** (other realms list 8-10 special mechanics)\n4. **Minimal narrative examples** (3 vs. 70+ lines in other realms)\n5. **No session structure** defined\n6. **No target demographic** defined\n7. **Generic name**: \"Horror\" isn't evocative like \"Chrome Veil\" or \"Shadow Cabinet\"\n\n**Classes are unclear:**\n- What's the difference between \"Investigator\" and \"Scholar\"?\n- \"Survivor\" and \"Veteran\" overlap\n- No mechanical differentiation explained\n\n**AI Prompt Quality**: ‚≠ê‚≠ê (2/5) - TOO GENERIC\n- Prompt is only 2 sentences\n- No specific setting, time period, or flavor\n- \"Supernatural horror\" is too broad\n- No mechanics integration\n- Needs Lovecraftian vs. slasher vs. gothic distinction\n\n**Recommendations:**\n```\nRename to: \"The Whispering Dark\" or \"Arkham Shadows\"\nAdd: Specific setting (1920s Lovecraft? Modern Silent Hill? Victorian Gothic?)\nAdd: Sanity mechanics explanation\nAdd: Factions (Cultists, Investigators, The Corrupted, etc.)\nAdd: Starting scenario hook\nAdd: Unique features (Sanity Death Spiral, Cosmic Horror reveals, etc.)\n```\n\n---\n\n### 4. POLITICAL THRILLER Realm (\"Shadow Cabinet\")\n\n**Overall Quality**: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5) - Excellent\n\n**Class Names (CLEAN and SPECIFIC):**\n```json\n\"availableClasses\": [\n  \"Senior Adviser\",           ‚úÖ Clear, specific\n  \"Communications Director\",  ‚úÖ Clear role\n  \"Intelligence Liaison\",     ‚úÖ Clear function\n  \"Congressional Operative\",  ‚úÖ Clear sphere\n  \"Investigative Journalist\", ‚úÖ Clear archetype\n  \"Political Consultant\",     ‚úÖ Clear role\n  \"Chief of Staff\",           ‚úÖ Clear position\n  \"Whistleblower\"             ‚úÖ Clear moral stance\n]\n```\n\n**Strengths:**\n- ‚úÖ All classes clearly differentiated by role\n- ‚úÖ No gender issues\n- ‚úÖ Each class implies different gameplay approach\n- ‚úÖ Excellent faction system\n\n**Still Missing:**\n- Explicit class capability descriptions\n- \"How does Chief of Staff mechanically differ from Senior Adviser?\"\n\n**AI Prompt Quality**: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5) - EXCELLENT\n- Sharp contemporary voice\n- Clear moral complexity\n- 48-hour news cycle mechanic is brilliant\n- Loyalty vs. Truth tension is compelling\n- Specific to setting without being partisan\n\n---\n\n## Cross-Realm Issues\n\n### 1. No Class Capabilities Defined\n\n**Problem**: None of the realms explain what classes CAN DO mechanically.\n\n**Impact on Gameplay:**\n- Players choose \"Spymaster\" but don't know if they can assassinate\n- Players choose \"Netrunner\" but don't know their hacking limits\n- AI has to invent class abilities on the fly\n- Inconsistent gameplay experience\n\n**Solution**: Add `classCapabilities` section to each realm:\n\n```json\n\"classCapabilities\": {\n  \"Spymaster\": {\n    \"canDo\": [\n      \"Uncover plots and secrets\",\n      \"Plant spies in other houses\",\n      \"Prevent assassinations\",\n      \"Blackmail enemies with information\"\n    ],\n    \"cannotDo\": [\n      \"Lead armies directly\",\n      \"Perform marriages or religious rites\",\n      \"Manage treasury or trade\"\n    ],\n    \"uniqueAbility\": \"Once per session: Reveal a hidden NPC secret\"\n  }\n}\n```\n\n### 2. Gender-Split Class Names (FANTASY only)\n\n**Problem**: Lord/Lady and High Priest/Priestess require users to interpret\n\n**Confusion for 40+ Users:**\n```\nUser sees: \"1Ô∏è‚É£ LORD/LADY - Strong ruler with noble bloodline\"\nUser thinks: \"Do I type 'Lord' or 'Lady'? Do I type the whole thing?\"\nUser types: \"Lord/Lady\" ‚ùå\nOr: \"Lord or Lady\" ‚ùå\nOr: \"1\" ‚úÖ (but they're confused)\n```\n\n**Solution**: Use gender-neutral class names\n```\nLord/Lady ‚Üí Noble or Aristocrat\nHigh Priest/Priestess ‚Üí High Priest or Hierophant\n```\n\n### 3. Inconsistent Detail Level\n\n**Quality Comparison:**\n\n| Realm | Lines | Factions | Scenarios | Unique Features | AI Prompt |\n|-------|-------|----------|-----------|-----------------|-----------|\n| **Fantasy** | 161 | 6 | 1 detailed | 10 | Excellent |\n| **Cyberpunk** | 144 | 5 | 1 detailed | 9 | Excellent |\n| **Political** | 110 | 5 | 1 detailed | 8 | Excellent |\n| **Horror** | 35 | 0 | 0 | 0 | Generic |\n\n**Horror needs 3-4x more detail to match other realms.**\n\n---\n\n## Recommended Priority Fixes\n\n### P0 (Critical for UX):\n1. **Remove gender splits from FANTASY realm**\n   - Lord/Lady ‚Üí Noble\n   - High Priest/Priestess ‚Üí High Priest\n\n2. **Add class capability descriptions to ALL realms**\n   - What can each class DO?\n   - What makes them mechanically different?\n   - What's their unique ability?\n\n### P1 (High Value):\n3. **Expand HORROR realm to match others**\n   - Add specific setting (Lovecraftian 1920s? Modern?)\n   - Add factions (Cult, Investigators, etc.)\n   - Add starting scenario\n   - Add unique features (Sanity mechanics, Cosmic Horror, etc.)\n   - Improve AI prompt with specific tone\n\n4. **Add class selection hints to OnboardingPrompts**\n   - Show what each class is GOOD AT\n   - Example: \"1Ô∏è‚É£ NOBLE - Politics and alliances (Diplomacy +3)\"\n\n### P2 (Polish):\n5. **Standardize class descriptions format**\n   - Every class gets: Summary, Strengths, Playstyle\n   - Helps 40+ users make informed choices\n\n6. **Add \"Recommended for beginners\" flag**\n   - Fantasy: \"Knight Commander\" (straightforward combat/honor)\n   - Cyberpunk: \"Private Investigator\" (classic detective)\n   - Political: \"Senior Adviser\" (balanced political role)\n\n---\n\n## Example: Improved FANTASY Class List\n\n### Before (Current):\n```json\n\"availableClasses\": [\n  \"Lord/Lady\",\n  \"Spymaster\",\n  \"Knight Commander\",\n  \"Court Scholar\",\n  \"Bastard Heir\",\n  \"Master of Coin\",\n  \"High Priest/Priestess\",\n  \"Assassin\"\n]\n```\n\n### After (Proposed):\n```json\n\"availableClasses\": [\n  {\n    \"name\": \"Noble\",\n    \"formerName\": \"Lord/Lady\",\n    \"summary\": \"Powerful aristocrat with vassals and political influence\",\n    \"strengths\": [\"Diplomacy\", \"House Resources\", \"Legitimacy\"],\n    \"weaknesses\": [\"Personal combat\", \"Hands-on tasks\"],\n    \"playstyle\": \"Command others, forge alliances, manage territories\",\n    \"recommendedForBeginners\": false\n  },\n  {\n    \"name\": \"Knight Commander\",\n    \"summary\": \"Military leader who commands armies and fights honorably\",\n    \"strengths\": [\"Martial\", \"Prowess\", \"Loyalty inspiration\"],\n    \"weaknesses\": [\"Intrigue\", \"Subtle politics\"],\n    \"playstyle\": \"Lead battles, protect allies, inspire troops\",\n    \"recommendedForBeginners\": true\n  },\n  {\n    \"name\": \"Spymaster\",\n    \"summary\": \"Master of secrets, espionage, and information warfare\",\n    \"strengths\": [\"Intrigue\", \"Secrets\", \"Counter-assassination\"],\n    \"weaknesses\": [\"Open combat\", \"Public reputation\"],\n    \"playstyle\": \"Uncover plots, blackmail enemies, prevent betrayals\",\n    \"recommendedForBeginners\": false\n  }\n  // ... etc for all classes\n]\n```\n\n---\n\n## AI Prompt Quality: Overall Assessment\n\n**What's Working:**\n- ‚úÖ FANTASY, CYBERPUNK, POLITICAL have excellent, detailed AI prompts\n- ‚úÖ Specific tone, style, and mechanics guidance\n- ‚úÖ Great narrative examples\n- ‚úÖ Clear setting and atmosphere\n\n**What Needs Work:**\n- ‚ùå HORROR prompt is too generic (2 sentences vs. 500+ words for others)\n- ‚ö†Ô∏è Class capabilities not integrated into AI prompts\n- ‚ö†Ô∏è No guidance on how to handle class-specific actions\n\n**Recommendation:**\nAdd section to each AI prompt explaining class-specific capabilities:\n\n```\n\"When a SPYMASTER acts, they can: uncover secrets, plant spies, blackmail enemies, prevent assassinations. They CANNOT: lead armies, manage economy, perform religious rites.\n\nWhen a KNIGHT COMMANDER acts, they can: lead troops, challenge foes to duels, inspire loyalty, defend allies. They CANNOT: conduct espionage, manipulate politics subtly, manage coin.\"\n```\n\n---\n\n## SMS UX Impact\n\n**Current User Experience (FANTASY):**\n```\nChoose your character type:\n\n1Ô∏è‚É£ LORD/LADY - ???\n2Ô∏è‚É£ SPYMASTER - ???\n3Ô∏è‚É£ KNIGHT COMMANDER - ???\n\nReply with NUMBER (1-8) or name\n```\n\n**Improved User Experience:**\n```\nChoose your character type:\n\n1Ô∏è‚É£ NOBLE - Politics & alliances\n2Ô∏è‚É£ SPYMASTER - Secrets & espionage\n3Ô∏è‚É£ KNIGHT COMMANDER - Military leadership\n‚≠ê (Recommended for beginners)\n\nReply with NUMBER (1-8) or name\n```\n\n---\n\n## Summary: Action Items\n\n**Must Fix (Breaks UX for 40+ users):**\n1. Remove \"Lord/Lady\" ‚Üí Use \"Noble\"\n2. Remove \"High Priest/Priestess\" ‚Üí Use \"High Priest\"\n\n**Should Fix (Improves gameplay):**\n3. Add class capability descriptions to all realms\n4. Expand Horror realm to match quality of others\n5. Add class hints to selection prompts\n\n**Nice to Have (Polish):**\n6. Standardize class description format\n7. Add beginner-friendly recommendations\n8. Integrate class capabilities into AI prompts\n\n---\n\n**Assessment Author**: Claude (AI Code Assistant)\n**Review Date**: October 2025\n**Files Analyzed**: 4 realm JSON files (fantasy, cyberpunk, horror, political_thriller)\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/REALM_DATA_ASSESSMENT.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "md"
      ],
      "content_hash": "6c3d6a1a0a9c8a13",
      "size_bytes": 13219,
      "created_at": "2026-01-02T20:42:12.437888"
    },
    {
      "doc_id": "local_party-lore_docs_troubleshooting",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/troubleshooting.md",
      "content": "# Party Lore Development Troubleshooting\n\nQuick solutions for common development environment issues.\n\n## Quick Diagnosis\n\n**Something not working?** Start here:\n\n```bash\n# Check overall status\n./scripts/health-check.sh\n\n# Check service logs\ndocker-compose logs\n\n# Check container status\ndocker-compose ps\n```\n\n---\n\n## Docker Issues\n\n### \"Docker is not running\"\n**Symptoms:** `docker info` fails, scripts report Docker not available\n**Solutions:**\n1. **Start Docker Desktop application**\n   - Look for Docker icon in system tray/menu bar\n   - Wait for \"Docker is running\" indicator (whale icon)\n2. **Verify Docker installation**\n   - Windows/Mac: [Download Docker Desktop](https://www.docker.com/products/docker-desktop)\n   - Linux: Install Docker Engine + Docker Compose\n3. **Check Docker service status**\n   ```bash\n   # Linux\n   sudo systemctl status docker\n   sudo systemctl start docker\n   ```\n\n### \"Port already in use\" (5432 or 6379)\n**Symptoms:** Container fails to start, port conflict errors\n**Solutions:**\n1. **Find what's using the port:**\n   ```bash\n   # Unix/macOS\n   lsof -i :5432\n   lsof -i :6379\n\n   # Windows\n   netstat -ano | findstr :5432\n   netstat -ano | findstr :6379\n   ```\n2. **Stop conflicting service or change port in compose.yml**\n3. **Use different ports in compose.yml if needed**\n\n### \"Cannot connect to Docker daemon\"\n**Symptoms:** Docker commands fail with permission errors\n**Solutions:**\n- **Windows:** Ensure Docker Desktop is running\n- **Linux:** Add user to docker group: `sudo usermod -aG docker $USER` (requires logout/login)\n- **Mac:** Restart Docker Desktop application\n\n### Slow Container Startup\n**Symptoms:** Containers take > 60 seconds to start\n**Solutions:**\n1. **Check Docker resource allocation** (CPU/RAM in Docker Desktop settings)\n2. **Prune unused images:** `docker system prune -f`\n3. **Restart Docker Desktop**\n\n---\n\n## Database Connection Issues\n\n### \"Connection refused\" to PostgreSQL\n**Symptoms:** Application can't connect, health check fails\n**Diagnosis:**\n```bash\n# Check container is running\ndocker ps | grep postgres\n\n# Check health\n./scripts/health-check.sh\n\n# Check port forwarding\ndocker port partylore-postgres-dev\n```\n\n**Solutions:**\n```bash\n# Check PostgreSQL logs\ndocker-compose logs postgres\n\n# Restart PostgreSQL\ndocker-compose restart postgres\n\n# Nuclear option: reset environment\n./scripts/dev-reset.sh\n```\n\n### \"Password authentication failed\"\n**Symptoms:** PostgreSQL rejects connection\n**Solutions:**\n1. **Verify credentials match between:**\n   - `application-dev.yml`\n   - `compose.yml`\n   - `.env` file (if using custom values)\n2. **Reset environment:**\n   ```bash\n   ./scripts/dev-reset.sh\n   ```\n\n### \"Database does not exist\"\n**Symptoms:** Application fails to connect to database\n**Solutions:**\n1. **Database auto-created by compose.yml** - check container logs:\n   ```bash\n   docker-compose logs postgres\n   ```\n2. **Reset with fresh database:**\n   ```bash\n   ./scripts/dev-reset.sh\n   ```\n\n---\n\n## Spring Boot Issues\n\n### \"Port 8080 already in use\"\n**Symptoms:** Application fails to start web server\n**Solutions:**\n1. **Find process using port:**\n   ```bash\n   # Unix/macOS\n   lsof -i :8080\n   kill -9 <PID>\n\n   # Windows\n   netstat -ano | findstr :8080\n   taskkill /PID <PID> /F\n   ```\n2. **Change port in application.properties:**\n   ```properties\n   server.port=8081\n   ```\n\n### \"No qualifying bean of type\" Errors\n**Symptoms:** Spring context fails to start, dependency injection errors\n**Solutions:**\n1. **Check if you're in the correct directory:**\n   ```bash\n   # Should be in party-lore-app for Spring Boot\n   cd party-lore-app\n   mvn spring-boot:run\n   ```\n2. **Verify @ComponentScan includes all packages**\n3. **Check @Configuration classes are properly annotated**\n4. **Review constructor injection for missing dependencies**\n\n### Hot Reload Not Working\n**Symptoms:** Code changes don't trigger restart\n**Solutions:**\n- **IntelliJ IDEA:**\n  - Enable \"Build project automatically\" in settings\n  - Ensure Spring Boot DevTools is in classpath\n- **VS Code:**\n  - Install \"Spring Boot Extension Pack\"\n  - Verify `spring.devtools.restart.enabled=true`\n- **Manual restart:** Stop application (Ctrl+C) and restart\n\n### \"Failed to execute goal\" Maven Errors\n**Symptoms:** Maven build or run fails\n**Solutions:**\n1. **Clean and rebuild:**\n   ```bash\n   mvn clean compile\n   ```\n2. **Skip tests if needed:**\n   ```bash\n   mvn spring-boot:run -DskipTests\n   ```\n3. **Check Java version:**\n   ```bash\n   java -version  # Should be 17+\n   mvn --version  # Should be 3.9+\n   ```\n\n---\n\n## Profile-Specific Issues\n\n### Console Mode Won't Start\n**Symptoms:** Console mode fails to load interactive CLI\n**Solutions:**\n1. **Verify profile activation:**\n   ```bash\n   mvn spring-boot:run -Dspring.profiles.active=dev-console\n   ```\n2. **Check console configuration** in `application-dev-console.properties`\n3. **Try without database dependencies** (console mode disables them)\n\n### Web Mode Database Errors\n**Symptoms:** Web mode fails with database connection errors\n**Solutions:**\n1. **Ensure environment is running:**\n   ```bash\n   ./scripts/health-check.sh\n   ```\n2. **Check Flyway migrations** are successful\n3. **Reset database:**\n   ```bash\n   ./scripts/dev-reset.sh\n   ```\n\n### Test Profile Issues\n**Symptoms:** Tests fail with H2 database errors\n**Solutions:**\n1. **H2 mode compatibility** - check `application-test.yml`:\n   ```yaml\n   spring:\n     datasource:\n       url: jdbc:h2:mem:testdb;MODE=PostgreSQL\n   ```\n2. **Run tests with specific profile:**\n   ```bash\n   mvn test -Dspring.profiles.active=test\n   ```\n\n---\n\n## Environment Variable Issues\n\n### \"Required property missing\" Errors\n**Symptoms:** Application won't start, missing configuration\n**Solutions:**\n1. **Copy environment template:**\n   ```bash\n   cp .env.example .env\n   ```\n2. **Enable mocking for development:**\n   ```bash\n   # In .env file\n   SMS_MOCK_ENABLED=true\n   CLAUDE_MOCK_ENABLED=true\n   ```\n3. **Check Spring profile loading environment variables**\n\n### External Service Connection Failures\n**Symptoms:** Twilio or Claude API errors\n**Solutions:**\n1. **Use mocked services for development:**\n   ```bash\n   # Web mode with mocks\n   SMS_MOCK_ENABLED=true mvn spring-boot:run -Dspring.profiles.active=dev-web\n   ```\n2. **Verify API keys in .env** (if using real services)\n3. **Check network connectivity** and firewall settings\n\n---\n\n## Script Issues\n\n### Permission Denied on Unix Scripts\n**Symptoms:** `./scripts/dev-start.sh` fails with permission error\n**Solutions:**\n```bash\nchmod +x scripts/*.sh\n```\n\n### Windows Script Execution Policy\n**Symptoms:** Windows blocks script execution\n**Solutions:**\n1. **Use .bat files instead of PowerShell**\n2. **Or enable PowerShell execution:**\n   ```powershell\n   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser\n   ```\n\n---\n\n## Performance Issues\n\n### Slow Application Startup\n**Symptoms:** Spring Boot takes > 30 seconds to start\n**Solutions:**\n1. **Increase Docker resources** (4GB+ RAM recommended)\n2. **Use specific profiles** to reduce components loaded\n3. **Check antivirus** isn't scanning project files\n4. **Skip tests:** `mvn spring-boot:run -DskipTests`\n\n### Slow Hot Reload\n**Symptoms:** Code changes take > 5 seconds to reload\n**Solutions:**\n1. **Reduce DevTools restart scope:**\n   ```properties\n   spring.devtools.restart.additional-paths=src/main/java\n   ```\n2. **Exclude large directories** from IDE auto-compilation\n3. **Use incremental compilation** in IDE settings\n\n---\n\n## Getting Help\n\n### Diagnostic Information to Collect\nWhen asking for help, include:\n\n```bash\n# Environment info\njava -version\nmvn --version\ndocker --version\ndocker-compose --version\n\n# Service status\n./scripts/health-check.sh\ndocker-compose ps\ndocker-compose logs\n\n# Application logs\n# (from Spring Boot console output)\n```\n\n### Support Channels\n1. **Check this troubleshooting guide**\n2. **Review [development-setup.md](development-setup.md)** for setup details\n3. **Search GitHub issues** on the repository\n4. **Create new issue** with diagnostic information\n5. **Ask in team chat** with error details\n\n---\n\n## Prevention Tips\n\n### Regular Maintenance\n```bash\n# Weekly cleanup\ndocker system prune -f\n\n# Reset environment when switching branches\n./scripts/dev-reset.sh\n\n# Keep Docker Desktop updated\n```\n\n### Best Practices\n- ‚úÖ **Always use scripts** instead of manual Docker commands\n- ‚úÖ **Check health** before reporting issues: `./scripts/health-check.sh`\n- ‚úÖ **Reset when in doubt:** `./scripts/dev-reset.sh`\n- ‚úÖ **Use appropriate profiles** for your development task\n- ‚úÖ **Keep .env file** up to date with .env.example",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/troubleshooting.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "f9969eefeb82320b",
      "size_bytes": 8654,
      "created_at": "2026-01-02T20:42:12.437929"
    },
    {
      "doc_id": "local_party-lore_docs_development-setup",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/development-setup.md",
      "content": "# Party Lore Development Environment Setup\n\nComplete guide for setting up the Party Lore development environment with Docker, PostgreSQL, Redis, and Spring Boot.\n\n> **‚ö° Quick Start:** Use the automated scripts for one-command setup - see [Quick Setup Scripts](#quick-setup-scripts) below!\n>\n> **Need help?** See [DEVELOPMENT.md](../DEVELOPMENT.md) in the root directory for additional context.\n\n## Table of Contents\n\n- [Quick Setup Scripts](#quick-setup-scripts) ‚ö° **START HERE**\n- [Prerequisites](#prerequisites)\n- [Manual Setup](#manual-setup)\n- [How It Works: Spring Boot Docker Compose](#how-it-works-spring-boot-docker-compose)\n- [Development Profiles](#development-profiles)\n- [Common Workflows](#common-workflows)\n- [IDE Configuration](#ide-configuration)\n- [Docker Details](#docker-details)\n- [Troubleshooting](#troubleshooting)\n\n## Prerequisites\n\n### Required Software\n\n**Docker Desktop 4.20+** - Container runtime for PostgreSQL and Redis\n- **Windows/Mac**: [Download Docker Desktop](https://www.docker.com/products/docker-desktop)\n- **Linux**: Install Docker Engine + Docker Compose via package manager\n- ‚ö†Ô∏è **Windows**: If you have PostgreSQL installed locally, stop the service: `net stop postgresql-x64-17`\n\n**Java 17+** - Spring Boot runtime\n- Recommended: Install via [SDKMAN](https://sdkman.io/)\n- Alternative: Download from [Adoptium](https://adoptium.net/)\n\n**Maven 3.9+** - Build tool and dependency management\n- Usually included with Java distributions\n- Or install via package manager\n\n### Verify Installation\n\n```bash\ndocker --version          # Should be 4.20 or higher\njava -version            # Should be 17 or higher\nmvn --version            # Should be 3.9 or higher\n```\n\n## Quick Setup Scripts\n\nüéØ **Target: New developer running in < 10 minutes**\n\n### Prerequisites Check\nEnsure you have:\n- **Docker Desktop 4.20+** (running)\n- **Java 17+**\n- **Maven 3.9+**\n\n### 1. Clone and Setup\n```bash\ngit clone <repository-url>\ncd party-lore\ncp .env.example .env  # Configure credentials (or use mocks)\n```\n\n### 2. One-Command Environment Start\n\n**Unix/macOS/Linux:**\n```bash\n./scripts/dev-start.sh\n```\n\n**Windows:**\n```batch\nscripts\\dev-start.bat\n```\n\nThe script will:\n- ‚úÖ Verify Docker is running\n- ‚úÖ Start PostgreSQL and Redis containers\n- ‚úÖ Wait for services to be healthy\n- ‚úÖ Run health checks\n- ‚úÖ Display next steps\n\n### 3. Run Application\n\n**Web Mode (API + webhooks):**\n```bash\nmvn spring-boot:run -Dspring.profiles.active=dev-web\n```\n\n**Console Mode (CLI testing):**\n```bash\nmvn spring-boot:run -Dspring.profiles.active=dev-console\n```\n\n### Additional Scripts\n\n| Script | Purpose |\n|--------|---------|\n| `./scripts/health-check.sh` | Verify all services are healthy |\n| `./scripts/dev-stop.sh` | Stop environment (preserve data) |\n| `./scripts/dev-reset.sh` | Reset to clean state (deletes data) |\n| `./scripts/create-migration.sh` | Create new database migration |\n| `./scripts/validate-migrations.sh` | Validate migration files |\n| `./scripts/test-migration.sh` | Test migration on clean database |\n| `./scripts/reset-database.sh` | Reset database (clean slate) |\n\n> üìö See [Database Migrations Guide](./database-migrations.md) for migration workflow and best practices\n\n---\n\n## Manual Setup (< 5 minutes)\n\n### 1. Clone Repository\n\n```bash\ngit clone <repository-url>\ncd party-lore\n```\n\n### 2. Run Application\n\n**That's it!** Just run:\n\n```bash\ncd party-lore-app\nmvn spring-boot:run\n```\n\nSpring Boot will automatically:\n- ‚úÖ Detect `compose.yml` in the project root\n- ‚úÖ Start PostgreSQL and Redis containers\n- ‚úÖ Wait for health checks\n- ‚úÖ Configure database and Redis connections\n- ‚úÖ Run Flyway migrations\n- ‚úÖ Start your application\n\nNo manual Docker commands needed!\n\n### What Just Happened?\n\nSpring Boot 3.1+ includes Docker Compose integration that:\n1. Reads `compose.yml` and starts all defined services\n2. Waits for containers to be healthy\n3. Auto-creates `ConnectionDetails` beans (no JDBC URLs required!)\n4. Connects your app to the services\n5. Stops containers when you stop the app\n\n## How It Works: Spring Boot Docker Compose\n\n### The Magic Module\n\nThe `spring-boot-docker-compose` dependency automatically manages containers:\n\n```xml\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-docker-compose</artifactId>\n    <scope>runtime</scope>\n    <optional>true</optional>\n</dependency>\n```\n\n### Auto-Configuration\n\n**Old Way** (manual configuration):\n```yaml\n# application-dev.yml\nspring:\n  datasource:\n    url: jdbc:postgresql://localhost:5432/party_lore_dev\n    username: party_lore\n    password: dev_password\n```\n\n**New Way** (automatic from compose.yml):\n```yaml\n# compose.yml - single source of truth\nservices:\n  postgres:\n    image: postgres:15-alpine\n    environment:\n      POSTGRES_DB: party_lore_dev\n      POSTGRES_USER: party_lore\n      POSTGRES_PASSWORD: dev_password\n```\n\nSpring Boot reads this and creates the datasource automatically - no duplication!\n\n### Configuration Files\n\n```\ncompose.yml                    <- Service definitions (PostgreSQL, Redis)\napplication.yml                <- Base config (Flyway, JPA, logging)\napplication-dev.yml            <- Dev overrides (verbose logging, DevTools)\napplication-prod.yml           <- Production config (explicit datasource)\n```\n\n**Key Benefit**: Database credentials defined once in `compose.yml`, not scattered across multiple files.\n\n## Development Profiles\n\n### Default Profile (`dev`)\n\n**Use Case**: Normal local development\n\n**Features**:\n- Auto-managed Docker containers\n- Hot reload with DevTools\n- Verbose logging (DEBUG level)\n- Database migrations enabled\n- Mock SMS services\n\n**Start**:\n```bash\nmvn spring-boot:run\n```\n\n### Console Mode (`dev-console`)\n\n**Use Case**: Test game logic without web server\n\n**Features**:\n- Interactive CLI for testing\n- No web server/API endpoints\n- Simplified console logging\n- All game mechanics available\n\n**Start**:\n```bash\nmvn spring-boot:run -Dspring.profiles.active=dev-console\n```\n\n**When to use**:\n- Core logic development\n- AI response debugging\n- Game mechanics testing\n\n### Web Mode (`dev-web`)\n\n**Use Case**: Full API and webhook testing\n\n**Features**:\n- Web server on port 8080\n- Full Twilio SMS integration\n- Webhook endpoints for SMS callbacks\n- API endpoints for testing\n- Swagger UI available\n\n**Start**:\n```bash\nmvn spring-boot:run -Dspring.profiles.active=dev-web\n```\n\n**When to use**:\n- SMS integration development\n- API endpoint testing\n- End-to-end testing with webhooks\n\n### Test Mode (`test`)\n\n**Use Case**: Automated testing\n\n**Features**:\n- H2 in-memory database\n- All external services mocked\n- Fast test execution\n- Isolated from dev database\n- No Docker required\n\n**Run**:\n```bash\nmvn test\n```\n\n**When to use**:\n- Running unit tests\n- Running integration tests\n- Automated CI/CD pipelines\n\n## Common Workflows\n\n### Check Container Status\n\n```bash\ndocker ps\n```\n\nLook for \"(healthy)\" status next to containers:\n- `partylore-postgres-dev`\n- `partylore-redis-dev`\n\n### View Container Logs\n\n```bash\n# PostgreSQL logs\ndocker logs partylore-postgres-dev\n\n# Redis logs\ndocker logs partylore-redis-dev\n\n# Follow logs in real-time\ndocker compose logs -f\n```\n\n### Connect to PostgreSQL\n\n**Using Docker** (easiest):\n```bash\ndocker exec -it partylore-postgres-dev psql -U party_lore -d party_lore_dev\n```\n\n**Using psql** (if installed locally):\n```bash\npsql -h localhost -U party_lore -d party_lore_dev\n# Password: dev_password\n```\n\n**Useful queries**:\n```sql\n-- List all tables\n\\dt\n\n-- View migrations\nSELECT * FROM flyway_schema_history;\n\n-- Check current database\nSELECT current_database();\n```\n\n### Connect to Redis\n\n**Using Docker**:\n```bash\ndocker exec -it partylore-redis-dev redis-cli\n```\n\n**Commands**:\n```redis\nPING              # Test connection\nKEYS *            # List all keys\nGET some_key      # Get value\n```\n\n### Database Migrations\n\n**Migration scripts** are available for creating, validating, and testing database schema changes. See [Database Migrations Guide](./database-migrations.md) for complete documentation.\n\n**Quick Reference:**\n\n| Script | Purpose |\n|--------|---------|\n| `./scripts/create-migration.sh \"description\"` | Create new migration file |\n| `./scripts/validate-migrations.sh` | Check for conflicts and issues |\n| `./scripts/test-migration.sh` | Test migration on clean database |\n| `./scripts/reset-database.sh` | Reset database to clean state |\n\n**Example: Creating a New Migration**\n\n```bash\n# 1. Create migration file\n./scripts/create-migration.sh \"Add user notification preferences\"\n\n# Output:\n# ‚úÖ Created migration file: party-lore-domain/src/main/resources/db/migration/V006__add_user_notification_preferences.sql\n\n# 2. Edit the file to add your SQL\n# (File opens with template and checklist)\n\n# 3. Validate migration\n./scripts/validate-migrations.sh\n\n# 4. Test on clean database\n./scripts/test-migration.sh\n\n# 5. Commit when ready\ngit add party-lore-domain/src/main/resources/db/migration/V006__add_user_notification_preferences.sql\ngit commit -m \"Add migration V006: user notification preferences\"\n```\n\n**View Migration History:**\n```sql\n-- Connect to database\ndocker exec -it party-lore-postgres-1 psql -U party_lore -d party_lore_dev\n\n-- View migration history\nSELECT version, description, installed_on, success\nFROM flyway_schema_history\nORDER BY installed_rank DESC;\n```\n\nSee [Database Migrations Guide](./database-migrations.md) for:\n- Naming conventions and standards\n- Safe migration patterns\n- Troubleshooting guide\n- Rollback procedures\n\n### Manual Container Management\n\nWhile Spring Boot manages containers automatically, you can still control them manually:\n\n```bash\n# Start containers (if needed)\ndocker compose up -d\n\n# Stop containers (Spring Boot does this on shutdown)\ndocker compose down\n\n# View running containers\ndocker ps\n\n# Restart containers\ndocker compose restart\n```\n\n### Reset Environment (Clean Slate)\n\n**‚ö†Ô∏è Warning**: This deletes all database data!\n\n```bash\n# Stop and remove everything\ndocker compose down -v\n\n# Next run will create fresh databases\nmvn spring-boot:run\n```\n\n### Hot Reload with DevTools\n\nCode changes trigger automatic restart (very fast!):\n\n1. Modify Java code\n2. Save file\n3. Wait ~2-3 seconds\n4. Application restarts with changes\n\n**No need to stop/restart manually!**\n\n## IDE Configuration\n\n### IntelliJ IDEA\n\n1. **Import Project**\n   - Open IntelliJ ‚Üí File ‚Üí Open ‚Üí Select `party-lore` directory\n   - Import as Maven project\n   - Wait for dependencies to download\n\n2. **Enable Auto-Build** (for hot reload)\n   - Settings ‚Üí Build, Execution, Deployment ‚Üí Compiler\n   - Check \"Build project automatically\"\n   - Settings ‚Üí Advanced Settings ‚Üí Check \"Allow auto-make to start even if developed application is running\"\n\n3. **Configure Run Configuration**\n   - Run ‚Üí Edit Configurations ‚Üí Add New ‚Üí Spring Boot\n   - Main class: `com.partylore.app.PartyLoreApplication`\n   - Module: `party-lore-app`\n   - Active profiles: `dev` (or `dev-web`, `dev-console`)\n   - Save configuration\n\n4. **Debug Mode**\n   - Click Debug icon\n   - Set breakpoints by clicking line numbers\n   - Full variable inspection available\n   - Docker containers still auto-managed!\n\n### Visual Studio Code\n\n1. **Install Extensions**\n   - Spring Boot Extension Pack\n   - Java Extension Pack\n   - Docker Extension\n\n2. **Configure Launch**\n\nCreate `.vscode/launch.json`:\n\n```json\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"type\": \"java\",\n      \"name\": \"Spring Boot (Dev)\",\n      \"request\": \"launch\",\n      \"mainClass\": \"com.partylore.app.PartyLoreApplication\",\n      \"projectName\": \"party-lore-app\",\n      \"args\": \"--spring.profiles.active=dev\"\n    },\n    {\n      \"type\": \"java\",\n      \"name\": \"Spring Boot (Web)\",\n      \"request\": \"launch\",\n      \"mainClass\": \"com.partylore.app.PartyLoreApplication\",\n      \"projectName\": \"party-lore-app\",\n      \"args\": \"--spring.profiles.active=dev-web\"\n    },\n    {\n      \"type\": \"java\",\n      \"name\": \"Spring Boot (Console)\",\n      \"request\": \"launch\",\n      \"mainClass\": \"com.partylore.app.PartyLoreApplication\",\n      \"projectName\": \"party-lore-app\",\n      \"args\": \"--spring.profiles.active=dev-console\"\n    }\n  ]\n}\n```\n\n3. **Run/Debug**\n   - Press F5 to start debugging\n   - Use \"Run and Debug\" sidebar\n   - Breakpoints work in all Java files\n   - Docker containers auto-start\n\n## Docker Details\n\n### Container Information\n\n**PostgreSQL Container**:\n- Image: `postgres:15-alpine` (~80MB)\n- Container name: `postgres` (managed by Spring Boot)\n- Port: 5432\n- Database: `party_lore_dev`\n- User: `party_lore`\n- Password: `dev_password`\n- Volume: `postgres_dev_data`\n- Health check: `pg_isready` every 10s\n\n**Redis Container**:\n- Image: `redis:7-alpine` (~30MB)\n- Container name: `redis` (managed by Spring Boot)\n- Port: 6379\n- Persistence: AOF (append-only file)\n- Volume: `redis_dev_data`\n- Health check: `redis-cli ping` every 10s\n\n### Service Labels\n\nServices use Spring Boot service connection labels for auto-detection:\n\n```yaml\nservices:\n  postgres:\n    labels:\n      org.springframework.boot.service-connection: postgres\n  redis:\n    labels:\n      org.springframework.boot.service-connection: redis\n```\n\nThese labels tell Spring Boot how to configure `ConnectionDetails` beans automatically.\n\n### Volume Management\n\n**List volumes**:\n```bash\ndocker volume ls | grep party\n```\n\n**Inspect volume**:\n```bash\ndocker volume inspect postgres_dev_data\n```\n\n**Backup database**:\n```bash\ndocker exec postgres pg_dump -U party_lore party_lore_dev > backup.sql\n```\n\n**Restore database**:\n```bash\ndocker exec -i postgres psql -U party_lore -d party_lore_dev < backup.sql\n```\n\n## System Requirements\n\n- **Disk Space**: 2GB free (for images and volumes)\n- **RAM**: 4GB minimum, 8GB recommended\n- **Ports**: 5432, 6379, 8080 must be available\n- **OS**: Windows 10/11, macOS 10.15+, Linux (any recent distro)\n\n## Troubleshooting\n\n### Port 5432 Already in Use\n\n**Problem**: Spring Boot can't start because port 5432 is in use.\n\n**Cause**: Local PostgreSQL service is running.\n\n**Solution** (Windows, run as Administrator):\n```cmd\nnet stop postgresql-x64-17\n\n# Or disable auto-start\nsc config postgresql-x64-17 start= demand\n```\n\n**Solution** (macOS/Linux):\n```bash\n# Find the PostgreSQL service\nsudo systemctl stop postgresql\n\n# Or disable auto-start\nsudo systemctl disable postgresql\n```\n\n**Verify**:\n```bash\n# Windows\nnetstat -ano | findstr :5432\n\n# Mac/Linux\nlsof -i :5432\n```\n\nShould show no output (port free).\n\n### Docker Containers Don't Start\n\n**Problem**: Application fails with \"Cannot connect to Docker daemon\"\n\n**Cause**: Docker Desktop isn't running.\n\n**Solution**:\n1. Start Docker Desktop\n2. Wait for it to fully initialize (whale icon in system tray)\n3. Run `docker info` to verify\n4. Try starting the app again\n\n### Connection Refused to PostgreSQL\n\n**Problem**: Application can't connect to database\n\n**Checks**:\n```bash\n# 1. Are containers running?\ndocker ps\n\n# 2. Is PostgreSQL healthy?\ndocker inspect postgres | grep -i health\n\n# 3. Can you connect manually?\ndocker exec -it postgres psql -U party_lore -d party_lore_dev\n```\n\n**Solution**: Wait for health checks to pass (usually ~10 seconds after container starts).\n\n### Flyway Migration Failures\n\n**Problem**: Database schema migration fails\n\n**Common causes**:\n1. Dirty database from previous failed migration\n2. Schema conflicts from manual changes\n\n**Solution**:\n```bash\n# Option 1: Clean reset (loses data!)\ndocker compose down -v\nmvn spring-boot:run\n\n# Option 2: Manual repair\ndocker exec -it postgres psql -U party_lore -d party_lore_dev\n-- In psql:\nDELETE FROM flyway_schema_history WHERE success = false;\n```\n\n### Application Starts But Containers Don't Stop\n\n**Problem**: After stopping app, containers keep running\n\n**Cause**: Normal behavior! Spring Boot leaves containers running by default.\n\n**Configure** (in `application-dev.yml`):\n```yaml\nspring:\n  docker:\n    compose:\n      lifecycle-management: start_and_stop  # Stop containers on shutdown\n```\n\n**Or manually stop**:\n```bash\ndocker compose down\n```\n\n### Enable Debug Logging\n\nAdd to `application-dev.yml`:\n```yaml\nlogging:\n  level:\n    org.springframework.boot.docker.compose: DEBUG\n```\n\nThis shows detailed logs of Docker Compose integration.\n\n## Performance Tips\n\n### Faster Startup\n\n**Skip Tests**:\n```bash\nmvn spring-boot:run -DskipTests\n```\n\n**Keep Containers Running**:\nSet lifecycle to `start_only`:\n```yaml\nspring:\n  docker:\n    compose:\n      lifecycle-management: start_only\n```\n\n### Reduce Docker Image Pull Time\n\nImages are cached after first pull. To pre-pull:\n```bash\ndocker compose pull\n```\n\n## Next Steps\n\n- Review [Spring Boot Docker Compose Configuration](https://docs.spring.io/spring-boot/reference/features/dev-services.html)\n- Explore [TASK-167: Development Profiles](.specify/tasks/phase-0/task-167-development-profiles-and-environment-management.md)\n- Set up workflow scripts with [TASK-168](.specify/tasks/phase-0/task-168-development-workflow-tooling-and-documentation.md)\n- Read [Twilio Setup Guide](./TWILIO_SETUP.md) for SMS integration\n- Check [README.md](../README.md) for project overview\n\n## Support\n\n- Check logs: `docker compose logs -f`\n- Review health: `docker ps`\n- Search issues on GitHub repository\n- Ask in team communication channel\n\n---\n\n**Environment Setup Time**: < 5 minutes\n**Developer Onboarding Time**: < 10 minutes\n**Hot Reload Time**: < 3 seconds\n**Container Startup**: < 15 seconds\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/development-setup.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "ffb5e3357ba2d119",
      "size_bytes": 17439,
      "created_at": "2026-01-02T20:42:12.438040"
    },
    {
      "doc_id": "local_party-lore_docs_FEATURE-ROADMAP",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/FEATURE-ROADMAP.md",
      "content": "# üìã PARTY LORE FEATURE ROADMAP\n## Prioritized Enhancement Plan Based on Competitive Analysis\n\n---\n\n## üéØ PRIORITY FRAMEWORK\n\n**P0 (Critical):** Block production launch or cause user churn  \n**P1 (Important):** Significantly improve experience, competitive parity  \n**P2 (Nice-to-Have):** Polish and depth  \n**P3 (Future):** Long-term vision\n\n**Effort Scale:** S (1-2 weeks) | M (3-4 weeks) | L (2-3 months) | XL (3+ months)\n\n---\n\n## üìä FEATURE GAP SUMMARY\n\n### Current State:\n- ‚úÖ **Narrative:** 8.2/10 (BEST IN CLASS)\n- ‚úÖ **Mechanics Validation:** 9/10 (UNIQUE)\n- ‚úÖ **Multiplayer:** 9/10 (UNIQUE)\n- ‚ùå **Progression:** 1/10 (CRITICAL GAP)\n- ‚ùå **Skills:** 0/10 (CRITICAL GAP)\n- ‚ùå **Inventory:** 0.5/10 (CRITICAL GAP)\n\n---\n\n## üöÄ PHASE 1: MINIMUM VIABLE RPG (V1.0)\n**Timeline:** 2-3 months  \n**Goal:** Address P0 gaps to enable full launch\n\n### 1. XP & Leveling System (P0)\n**Priority:** üî¥ **CRITICAL**  \n**Effort:** M (3-4 weeks)  \n**Impact:** **MASSIVE** - Players need to feel progression\n\n**Scope:**\n- Levels 1-10 (not full 1-20 yet)\n- XP awards:\n  - Combat victory: 50-200 XP (based on difficulty)\n  - Quest completion: 100-500 XP\n  - NPC interactions: 10-50 XP\n- Level-up benefits:\n  - +5 HP per level\n  - +1 to one stat every 2 levels\n  - Display: \"üéâ LEVEL UP! You are now Level 2!\"\n\n**Database:**\n```sql\nALTER TABLE players ADD COLUMN experience_points INT DEFAULT 0;\nALTER TABLE players ADD COLUMN level INT DEFAULT 1;\n```\n\n**Integration:**\n- Award XP in Tier 1 mechanics (new field: `<xp_awards>`)\n- Level-up check after each turn\n- SMS notification on level-up\n\n---\n\n### 2. Core Skills System (P0)\n**Priority:** üî¥ **CRITICAL**  \n**Effort:** M (4 weeks)  \n**Impact:** **HIGH** - Enables diverse actions beyond combat\n\n**Scope (6 Core Skills):**\n1. **Athletics** - Climbing, swimming, physical feats\n2. **Stealth** - Sneaking, hiding, ambush\n3. **Persuasion** - Diplomacy, negotiation, charm\n4. **Intimidation** - Threats, fear, coercion\n5. **Perception** - Spotting hidden things,ÂØüËßâ\n6. **Investigation** - Searching, analyzing, deduction\n\n**Mechanics:**\n- D20 roll + skill bonus (0-5)\n- Tier 1 determines: \"Roll 15 vs DC 12 (Stealth) = SUCCESS\"\n- Tier 2 narrative reflects success/failure\n- Skills improve with use (every 10 uses = +1 bonus, max +5)\n\n**Database:**\n```sql\nCREATE TABLE player_skills (\n  player_id UUID REFERENCES players(id),\n  skill_name VARCHAR(50),\n  bonus INT DEFAULT 0,\n  uses INT DEFAULT 0,\n  PRIMARY KEY (player_id, skill_name)\n);\n```\n\n---\n\n### 3. Basic Inventory System (P0)\n**Priority:** üî¥ **CRITICAL**  \n**Effort:** M (3-4 weeks)  \n**Impact:** **HIGH** - Enables loot and gear progression\n\n**Scope (MVP):**\n- 10-slot inventory per player\n- Actions:\n  - \"I pick up the sword\"\n  - \"I drop the torch\"\n  - \"I use the health potion\"\n- Item types:\n  - Weapons (damage bonus)\n  - Potions (instant heal)\n  - Quest items (story-related)\n- NO weight limits (V1 simplification)\n- NO trading (V1 simplification)\n\n**Database:**\n```sql\nCREATE TABLE items (\n  id UUID PRIMARY KEY,\n  name VARCHAR(100),\n  type VARCHAR(50), -- WEAPON, CONSUMABLE, QUEST_ITEM\n  description TEXT,\n  properties JSONB -- {damage: 5, healing: 10, etc}\n);\n\nCREATE TABLE player_inventory (\n  player_id UUID REFERENCES players(id),\n  item_id UUID REFERENCES items(id),\n  quantity INT DEFAULT 1,\n  slot_number INT, -- 1-10\n  equipped BOOLEAN DEFAULT FALSE\n);\n```\n\n**Tier 1 Integration:**\n```xml\n<item_actions>\n  <pickup item_name=\"Rusty Sword\" />\n  <use item_name=\"Health Potion\" effect=\"+15 HP\" />\n</item_actions>\n```\n\n---\n\n## üéÆ PHASE 2: RPGDEEPENING (V1.5)\n**Timeline:** 3-6 months post-launch  \n**Goal:** Competitive parity with traditional RPGs\n\n### 4. Character Classes (P1)\n**Priority:** üü° **IMPORTANT**  \n**Effort:** L (2 months)  \n**Impact:** **HIGH** - Distinct playstyles\n\n**Scope (3 Classes for V1.5):**\n\n1. **FIGHTER** (Tank/Damage)\n   - Starting HP: 30 (vs 20 base)\n   - Abilities:\n     - Power Attack (2x damage, -2 AC)\n     - Second Wind (heal 25% HP, 1/day)\n   - Skill bonuses: Athletics +2, Intimidation +1\n\n2. **ROGUE** (Stealth/Skills)\n   - Starting HP: 20\n   - Abilities:\n     - Sneak Attack (+50% damage from stealth)\n     - Cunning Action (bonus stealth action)\n   - Skill bonuses: Stealth +2, Perception +1\n\n3. **MAGE** (Magic/Support)\n   - Starting HP: 15\n   - Abilities:\n     - Fireball (3 targets, 15 damage)\n     - Shield (absorb 20 damage, 1/day)\n   - Skill bonuses: Investigation +2, Persuasion +1\n\n**Database:**\n```sql\nALTER TABLE players ADD COLUMN class VARCHAR(50);\nALTER TABLE players ADD COLUMN class_abilities JSONB;\n```\n\n---\n\n### 5. Equipment System (P1)\n**Priority:** üü° **IMPORTANT**  \n**Effort:** M (4 weeks)  \n**Impact:** **MEDIUM** - Gear progression\n\n**Scope:**\n- Equipment slots:\n  - Weapon (damage bonus)\n  - Armor (AC bonus)\n  - Accessory (special effect)\n- Rarity tiers:\n  - Common (white): +1-2 bonus\n  - Rare (blue): +3-4 bonus\n  - Epic (purple): +5-6 bonus + special effect\n- Loot drops in combat\n- \"What do you do?\" includes equipped gear context\n\n**Example Items:**\n```\n[Common] Rusty Sword: +2 damage\n[Rare] Silver Blade: +4 damage, +2 vs undead\n[Epic] Flaming Greatsword: +6 damage, sets enemies on fire\n```\n\n---\n\n### 6. Spell/Ability System (P1)\n**Priority:** üü° **IMPORTANT**  \n**Effort:** L (6 weeks)  \n**Impact:** **HIGH** - Combat variety\n\n**Scope:**\n- 5 spells per class (V1.5)\n- Resource system: Mana points (MP)\n  - Fighter: 20 MP\n  - Rogue: 30 MP\n  - Mage: 50 MP\n- MP regeneration: +10 per turn\n- Casting: \"I cast Fireball at the goblin\"\n\n**Fighter Abilities (20 MP):**\n- Power Attack (5 MP): 2x damage\n- Whirlwind (10 MP): Hit all nearby enemies\n- Shield Bash (8 MP): Damage + stun\n- Battle Cry (12 MP): +3 damage to all allies\n- Last Stand (15 MP): Survive fatal blow with 1 HP\n\n**Mage Spells (50 MP):**\n- Magic Missile (8 MP): Auto-hit 10 damage\n- Fireball (15 MP): AOE 15 damage\n- Ice Bolt (12 MP): 12 damage + slow\n- Lightning Strike (20 MP): 25 damage single target\n- Teleport (18 MP): Escape or reposition\n\n---\n\n## üåü PHASE 3: POLISH & DEPTH (V2.0)\n**Timeline:** 6-12 months post-launch  \n**Goal:** Premium RPG experience\n\n### 7. Rest & Recovery (P2)\n**Priority:** üü¢ **NICE-TO-HAVE**  \n**Effort:** S (1-2 weeks)\n\n**Scope:**\n- Short rest: 10-minute in-game, restore 50% HP, 10 MP\n- Long rest: 8-hour in-game, full HP/MP restore\n- Camp actions: Cooking, crafting, NPC conversations\n\n---\n\n### 8. Economy & Trading (P2)\n**Priority:** üü¢ **NICE-TO-HAVE**  \n**Effort:** M (4 weeks)\n\n**Scope:**\n- Gold currency\n- Merchants/shops\n- Buy/sell items\n- Pricing based on rarity\n\n---\n\n### 9. Character Creation UI (P2)\n**Priority:** üü¢ **NICE-TO-HAVE**  \n**Effort:** L (2 months)\n\n**Scope:**\n- SMS onboarding flow\n- Choose class, name, backstory\n- Starting gear selection\n- Tutorial scenario\n\n---\n\n### 10. Achievements & Side Quests (P3)\n**Priority:** üîµ **FUTURE**  \n**Effort:** L (2 months)\n\n**Scope:**\n- Achievement tracking (first kill, 100 kills, etc.)\n- Optional side quests\n- Collectibles\n- Leaderboards\n\n---\n\n## üìÖ RECOMMENDED ROLLOUT SCHEDULE\n\n### Month 1-2: Phase 1 Foundation\n- **Week 1-3:** XP & Leveling System\n- **Week 4-7:** Core Skills System\n- **Week 8-10:** Basic Inventory\n\n**Deliverable:** V1.0 - \"Full RPG Core\"\n\n### Month 3-5: Phase 2 Deepening\n- **Week 11-18:** Character Classes (3 classes)\n- **Week 19-22:** Equipment System\n- **Week 23-28:** Spell/Ability System\n\n**Deliverable:** V1.5 - \"Class-Based RPG\"\n\n### Month 6-12: Phase 3 Polish\n- Rest/Recovery\n- Economy\n- Character creation\n- Side content\n\n**Deliverable:** V2.0 - \"Premium AI RPG\"\n\n---\n\n## üí° INCREMENTAL LAUNCH STRATEGY\n\n### Option A: Ship Now, Build Later (RECOMMENDED)\n**Launch:** V0.9 (current state) as \"Early Access\"\n- Positioning: \"Best narrative AI RPG, progression coming Q1 2026\"\n- Price: $9.99/mo (50% of target $19.99)\n- Focus: Build community around narrative strength\n- Timeline: V1.0 in 3 months\n\n**Pros:**\n- Revenue starts immediately\n- Real user feedback guides features\n- Prove narrative quality first\n- SMS multiplayer is unique hook\n\n**Cons:**\n- Some users will want leveling immediately\n- Need clear \"Early Access\" messaging\n- Roadmap must be transparent\n\n---\n\n### Option B: Wait for V1.0\n**Launch:** After XP/Skills/Inventory (3 months)\n- Positioning: \"Complete AI RPG experience\"\n- Price: $19.99/mo (full price)\n- Focus: Feature completeness\n\n**Pros:**\n- \"Complete\" product feel\n- No \"missing features\" complaints\n- Full price justification\n\n**Cons:**\n- 3 months of zero revenue\n- Miss early adopter window\n- No user feedback during development\n- Competitors may ship similar features\n\n---\n\n## üéØ FINAL RECOMMENDATION\n\n**Launch V0.9 NOW as \"Early Access\"**\n\n**Why:**\n1. Your 8.2/10 narrative is production-ready\n2. SMS multiplayer is unique - no competition\n3. 3-month runway to V1.0 is acceptable\n4. Revenue funds development\n5. User feedback > internal speculation\n\n**Roadmap Communication:**\n```\n‚úÖ Available Now (V0.9):\n- Best-in-class AI narrative (8.2/10)\n- True SMS multiplayer\n- Combat mechanics\n- NPC interactions\n- Story arcs\n- Location/world tracking\n\nüöß Coming Soon (V1.0 - Q1 2026):\n- XP & leveling (1-10)\n- Skills system (6 core skills)\n- Inventory & loot\n- Character progression\n\nüîÆ Future (V1.5 - Q2 2026):\n- Character classes (3-5 classes)\n- Equipment system\n- Spells & abilities\n- Advanced combat\n```\n\n**Expected Results:**\n- 70-80% of users satisfied with current quality\n- 20-30% excited about roadmap\n- Retention driven by narrative (your strength)\n- Feature velocity improves with revenue\n\n---\n\n## üìà SUCCESS METRICS\n\n### V0.9 (Early Access)\n- 8.0+ narrative quality score\n- 60%+ 7-day retention\n- 40%+ 30-day retention\n- $10K MRR (1,000 paid users)\n\n### V1.0 (Full RPG Core)\n- 8.5+ narrative quality\n- 70%+ 7-day retention\n- 50%+ 30-day retention\n- $30K MRR (1,500 paid users @ $19.99)\n\n### V1.5 (Class-Based)\n- 8.7+ narrative quality\n- 75%+ 7-day retention\n- 60%+ 30-day retention\n- $100K MRR (5,000 paid users)\n\n---\n\n## üîë KEY INSIGHTS\n\n1. **Your Narrative is Your Moat** - Don't undersell 8.2/10 quality\n2. **Progression is Table Stakes** - But V1.0 is acceptable\n3. **SMS Multiplayer is Unique** - No one else has this\n4. **Ship Early, Iterate Fast** - Users > speculation\n5. **Revenue Funds Development** - Don't bootstrap forever\n\n**You have something special. Launch it.** üöÄ\n\n---\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/FEATURE-ROADMAP.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "84577d2634cecbc7",
      "size_bytes": 10342,
      "created_at": "2026-01-02T20:42:12.438097"
    },
    {
      "doc_id": "local_party-lore_docs_database-migrations",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/database-migrations.md",
      "content": "# Database Migration Standards and Practices\n\n## Overview\n\nThis document defines standards and best practices for database migrations in the Party Lore SMS RPG platform. We use Flyway for version-controlled database schema evolution with PostgreSQL.\n\n## Quick Reference\n\n| Task | Command |\n|------|---------|\n| Create migration | `./scripts/create-migration.sh \"description\"` or `scripts\\create-migration.bat \"description\"` |\n| Validate migrations | `./scripts/validate-migrations.sh` or `scripts\\validate-migrations.bat` |\n| Test migration | `./scripts/test-migration.sh` or `scripts\\test-migration.bat` |\n| Reset database | `./scripts/reset-database.sh` or `scripts\\reset-database.bat` |\n| Check health | `./scripts/health-check.sh` or `scripts\\health-check.bat` |\n\n## Migration Naming Conventions\n\n### File Naming Format\n\n```\nV{VERSION}__{DESCRIPTION}.sql\n```\n\n### Version Numbering Rules\n\n- **Sequential numbering**: V001, V002, V003, etc.\n- **No gaps**: Each migration must increment by 1\n- **Three-digit padding**: Always use V001, never V1\n- **Never reuse**: Once a version is committed, never reuse it\n- **Auto-generated**: Use `create-migration.sh/bat` script for proper numbering\n\n### Description Guidelines\n\n- **Use snake_case**: Lowercase with underscores (auto-normalized by script)\n- **Be descriptive**: Clearly indicate what the migration does\n- **Action-oriented**: Start with action verb (Add, Create, Update, Remove, Fix)\n- **Feature context**: Include the feature or system being modified\n\n**Good Examples:**\n```\nV001__Create_core_tables.sql\nV002__Add_user_authentication.sql\nV003__Create_indexes_for_memory_system.sql\nV004__Update_player_status_constraints.sql\nV005__Remove_deprecated_campaign_fields.sql\n```\n\n**Bad Examples:**\n```\nV1__new_table.sql          ‚ùå Wrong version format, not descriptive\nV002__fix.sql              ‚ùå Too vague\nV003__AddUserAuthTables.sql ‚ùå Wrong case (use snake_case)\nV004__add-user-auth.sql    ‚ùå Hyphens not allowed\n```\n\n## Migration Content Standards\n\n### File Structure Template\n\n```sql\n-- V###__Description.sql\n-- Migration: [Brief description]\n-- Created: [Date]\n-- Author: [Developer name]\n\n-- =======================================================================\n-- [FEATURE NAME] - [Brief description of changes]\n-- =======================================================================\n\n-- Pre-migration checks (optional)\n-- SELECT COUNT(*) FROM existing_table; -- Should be > 0\n\n-- Main migration content\nCREATE TABLE new_table (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    name VARCHAR(255) NOT NULL,\n    description TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Add indexes for performance\nCREATE INDEX idx_new_table_name ON new_table(name);\nCREATE INDEX idx_new_table_created_at ON new_table(created_at);\n\n-- Add constraints for data integrity\nALTER TABLE new_table ADD CONSTRAINT chk_name_not_empty\n    CHECK (length(trim(name)) > 0);\n\n-- Foreign keys\nALTER TABLE new_table ADD CONSTRAINT fk_new_table_user\n    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;\n\n-- Post-migration validation (optional)\n-- SELECT COUNT(*) FROM new_table; -- Should be 0 initially\n\n-- =======================================================================\n-- Rollback Notes:\n-- To rollback this migration manually:\n-- DROP TABLE new_table CASCADE;\n-- DELETE FROM flyway_schema_history WHERE version = '###';\n-- =======================================================================\n```\n\n### Required Elements\n\n1. **Header comment** with migration metadata (auto-generated by script)\n2. **Section headers** for organization and clarity\n3. **Descriptive comments** explaining complex logic\n4. **Rollback notes** documenting manual rollback procedures\n5. **Validation queries** (commented) for verification\n6. **Appropriate indexes** for query performance\n7. **Constraints** for data integrity\n\n## Developer Workflow\n\n### 1. Creating a New Migration\n\n```bash\n# Unix/macOS\n./scripts/create-migration.sh \"Add user notification preferences\"\n\n# Windows\nscripts\\create-migration.bat \"Add user notification preferences\"\n```\n\nThis creates a new migration file with:\n- Correct version number (auto-incremented)\n- Normalized description\n- Standard template with checklist\n- Author metadata\n\n### 2. Editing the Migration\n\n1. Open the generated file in your editor\n2. Replace template comments with your SQL\n3. Add appropriate indexes and constraints\n4. Include rollback notes for complex changes\n5. Add validation queries (commented)\n\n### 3. Validating the Migration\n\n```bash\n# Unix/macOS\n./scripts/validate-migrations.sh\n\n# Windows\nscripts\\validate-migrations.bat\n```\n\nThis checks for:\n- ‚úÖ Version gaps\n- ‚úÖ Duplicate version numbers\n- ‚úÖ Naming convention compliance\n- ‚úÖ Potential SQL issues\n- ‚úÖ Remote conflicts with other developers\n\n### 4. Testing the Migration\n\n```bash\n# Unix/macOS\n./scripts/test-migration.sh\n\n# Windows\nscripts\\test-migration.bat\n```\n\nThis process:\n1. Validates migration files\n2. Resets database to clean state\n3. Runs Spring Boot with migrations\n4. Verifies via health endpoint\n5. Reports success or failure\n\n**Manual Testing Steps:**\n\n```bash\n# Test on clean database\n./scripts/reset-database.sh\nmvn spring-boot:run -Dspring.profiles.active=dev-web\n\n# Verify health\n./scripts/health-check.sh\n\n# Check migration was applied\ndocker exec party-lore-postgres-1 psql -U party_lore -d party_lore_dev -c \\\n  \"SELECT version, description, installed_on FROM flyway_schema_history ORDER BY installed_rank DESC LIMIT 5;\"\n```\n\n### 5. Code Review Process\n\n**Migration Review Checklist:**\n- [ ] Follows V###__description.sql naming convention\n- [ ] Has descriptive header comments and rollback notes\n- [ ] Uses appropriate PostgreSQL data types\n- [ ] Includes necessary indexes for query performance\n- [ ] Has proper constraints (NOT NULL, CHECK, FK)\n- [ ] Handles existing data appropriately\n- [ ] No destructive operations without safeguards\n- [ ] Tested on clean database\n- [ ] Tested with existing data\n- [ ] Performance impact assessed\n- [ ] Rollback procedure documented and tested\n\n### 6. Committing the Migration\n\n```bash\n# Validate one more time\n./scripts/validate-migrations.sh\n\n# Stage the migration\ngit add party-lore-domain/src/main/resources/db/migration/V###__description.sql\n\n# Commit with descriptive message\ngit commit -m \"Add migration V###: description\n\n- Details about what this migration does\n- Any important notes for reviewers\n- Performance considerations if applicable\"\n\n# Push to remote\ngit push origin your-branch\n```\n\n## Safe Migration Patterns\n\n### Adding Columns\n\n```sql\n-- ‚úÖ Good: Nullable column (no impact on existing rows)\nALTER TABLE users ADD COLUMN email VARCHAR(255);\n\n-- ‚úÖ Good: Non-null with default value (safe for existing rows)\nALTER TABLE users ADD COLUMN status VARCHAR(20) DEFAULT 'active' NOT NULL;\n\n-- ‚úÖ Good: Add as nullable, populate, then make NOT NULL\nALTER TABLE users ADD COLUMN email VARCHAR(255);\nUPDATE users SET email = 'user' || id || '@example.com' WHERE email IS NULL;\nALTER TABLE users ALTER COLUMN email SET NOT NULL;\n\n-- ‚ùå Bad: Non-null without default on table with existing data\n-- This will fail if users table has any rows\n-- ALTER TABLE users ADD COLUMN email VARCHAR(255) NOT NULL;\n```\n\n### Removing Columns (Two-Phase Process)\n\n```sql\n-- ‚úÖ Good: Phase 1 - Mark as deprecated, stop using in application\n-- Migration V050__Deprecate_old_user_field.sql\nCOMMENT ON COLUMN users.old_field IS 'DEPRECATED: Remove in next release. Use new_field instead.';\n\n-- Deploy application update that no longer uses old_field\n\n-- ‚úÖ Good: Phase 2 - Actually remove in next release\n-- Migration V065__Remove_deprecated_user_field.sql (weeks later)\nALTER TABLE users DROP COLUMN old_field;\n\n-- ‚ùå Bad: Immediate removal (breaks running application)\n-- ALTER TABLE users DROP COLUMN old_field;\n```\n\n### Renaming Columns (Three-Phase Process)\n\n```sql\n-- ‚úÖ Phase 1: Add new column\nALTER TABLE users ADD COLUMN new_name VARCHAR(255);\n\n-- ‚úÖ Phase 2: Populate new column with existing data\nUPDATE users SET new_name = old_name WHERE old_name IS NOT NULL;\n\n-- Deploy application update to use new_name (with fallback to old_name)\n\n-- ‚úÖ Phase 3 (separate migration, weeks later): Remove old column\n-- ALTER TABLE users DROP COLUMN old_name;\n\n-- ‚ùå Bad: Direct rename (breaks running application)\n-- ALTER TABLE users RENAME COLUMN old_name TO new_name;\n```\n\n### Creating Indexes on Large Tables\n\n```sql\n-- ‚úÖ Good: Use CONCURRENTLY for large tables (non-blocking)\nCREATE INDEX CONCURRENTLY idx_users_email ON users(email);\nCREATE INDEX CONCURRENTLY idx_game_sessions_status ON game_sessions(status, created_at);\n\n-- ‚úÖ Good: Regular index for small tables\nCREATE INDEX idx_settings_key ON settings(key);\n\n-- ‚ùå Bad: Regular index on large table (locks table during creation)\n-- CREATE INDEX idx_users_email ON users(email);\n```\n\n### Large Data Migrations\n\n```sql\n-- ‚úÖ Good: Batched updates for large tables (millions of rows)\nDO $$\nDECLARE\n    batch_size INTEGER := 10000;\n    affected_rows INTEGER;\n    total_updated INTEGER := 0;\nBEGIN\n    LOOP\n        UPDATE large_table\n        SET new_field = 'default_value'\n        WHERE new_field IS NULL\n        AND id IN (\n            SELECT id FROM large_table\n            WHERE new_field IS NULL\n            ORDER BY id\n            LIMIT batch_size\n        );\n\n        GET DIAGNOSTICS affected_rows = ROW_COUNT;\n        total_updated := total_updated + affected_rows;\n\n        RAISE NOTICE 'Updated % rows (total: %)', affected_rows, total_updated;\n\n        EXIT WHEN affected_rows = 0;\n\n        -- Allow other operations to proceed\n        PERFORM pg_sleep(0.1);\n    END LOOP;\n\n    RAISE NOTICE 'Migration complete. Total rows updated: %', total_updated;\nEND $$;\n\n-- ‚ùå Bad: Single UPDATE on millions of rows (locks table for extended time)\n-- UPDATE large_table SET new_field = 'default_value' WHERE new_field IS NULL;\n```\n\n### Adding Constraints Safely\n\n```sql\n-- ‚úÖ Good: Add constraint NOT VALID first (no existing data check)\nALTER TABLE users ADD CONSTRAINT chk_email_format\n    CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$') NOT VALID;\n\n-- ‚úÖ Good: Validate separately (can be monitored)\nALTER TABLE users VALIDATE CONSTRAINT chk_email_format;\n\n-- ‚ùå Bad: Add constraint immediately (locks table while checking all rows)\n-- ALTER TABLE users ADD CONSTRAINT chk_email_format\n--     CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$');\n```\n\n## Environment-Specific Procedures\n\n### Development Environment\n\n**Automatic Migration:**\n- Flyway runs automatically on application startup\n- `spring.flyway.enabled=true` in dev profiles\n- Clean database resets available via scripts\n\n**Workflow:**\n```bash\n# Reset to clean state\n./scripts/reset-database.sh\n\n# Start application (migrations run automatically)\n./scripts/dev-start.sh\n\n# Check health\n./scripts/health-check.sh\n```\n\n### Staging Environment\n\n**Controlled Migration:**\n- Mirrors production configuration\n- Full backup before migration\n- Migration validation required\n- Performance testing on production-like data volumes\n\n**Workflow:**\n```bash\n# 1. Backup database\npg_dump -U party_lore party_lore_staging > backup_$(date +%Y%m%d_%H%M%S).sql\n\n# 2. Validate migrations\n./scripts/validate-migrations.sh\n\n# 3. Deploy application (migrations run on startup)\n# Use deployment pipeline\n\n# 4. Verify health\n./scripts/health-check.sh\n\n# 5. Test application functionality\n```\n\n### Production Environment\n\n**Manual Approval Required:**\n- Database backup verification mandatory\n- Migration validation required\n- Performance monitoring active during migration\n- Rollback procedures tested in staging\n- Maintenance window for large migrations\n\n**Workflow:**\n```bash\n# 1. Verify backup exists and is restorable\n# Test restore in separate environment\n\n# 2. Enable maintenance mode\n# (Application-specific process)\n\n# 3. Deploy application with new migration\n# Migrations run automatically on startup\n\n# 4. Monitor migration progress\n# Watch application logs and database metrics\n\n# 5. Verify migration success\n./scripts/health-check.sh\n# Check flyway_schema_history table\n\n# 6. Disable maintenance mode\n# Resume normal operations\n\n# 7. Monitor for issues\n# Watch error rates, performance metrics\n```\n\n## Troubleshooting Common Issues\n\n### Issue: Migration Version Conflict\n\n**Symptom:**\n```\nGap in migration versions: Expected V8, found V010\n```\n\n**Cause:** Two developers created migrations with the same version number\n\n**Solution:**\n```bash\n# 1. Pull latest changes\ngit pull origin main\n\n# 2. Validate migrations\n./scripts/validate-migrations.sh\n\n# 3. If conflict, renumber your migration\nmv party-lore-domain/src/main/resources/db/migration/V008__my_feature.sql \\\n   party-lore-domain/src/main/resources/db/migration/V011__my_feature.sql\n\n# 4. Update version number in file header comment\n\n# 5. Validate again\n./scripts/validate-migrations.sh\n```\n\n### Issue: Failed Migration\n\n**Symptom:**\n```\nMigration V005__my_migration.sql failed\nSQL State  : 42P01\nError Code : 0\nMessage    : ERROR: relation \"missing_table\" does not exist\n```\n\n**Cause:** Migration SQL has errors or references non-existent objects\n\n**Solution (Development):**\n```sql\n-- 1. Check Flyway history\nSELECT version, description, success, installed_on\nFROM flyway_schema_history\nORDER BY installed_rank DESC\nLIMIT 10;\n\n-- 2. Remove failed migration record (development only!)\nDELETE FROM flyway_schema_history WHERE version = '005' AND success = false;\n\n-- 3. Fix the migration SQL file\n\n-- 4. Test again\n./scripts/test-migration.sh\n```\n\n**Solution (Production):**\n```bash\n# 1. Stop application\n# 2. Restore from backup\n# 3. Fix migration in new deployment\n# 4. Re-deploy with fixed migration\n```\n\n### Issue: Checksum Mismatch\n\n**Symptom:**\n```\nMigration checksum mismatch for migration version V003\n```\n\n**Cause:** Migration file was modified after being applied\n\n**Solution (Development):**\n```bash\n# Option 1: Reset database (loses all data)\n./scripts/reset-database.sh\n\n# Option 2: Use Flyway repair (updates checksum)\nmvn flyway:repair\n\n# Option 3: Update checksum manually\n# (Not recommended - only if you know what you're doing)\n```\n\n**Prevention:**\n- Never modify committed migrations\n- Create a new migration for changes\n\n### Issue: Migration Timeout\n\n**Symptom:** Migration hangs or times out during execution\n\n**Causes:**\n- Large data migration without batching\n- Index creation on large table without CONCURRENTLY\n- Lock contention with running application\n\n**Solutions:**\n```sql\n-- Use batched operations for large data updates\n-- Use CREATE INDEX CONCURRENTLY for large tables\n-- Schedule migrations during maintenance window\n-- Monitor long-running queries:\nSELECT pid, now() - pg_stat_activity.query_start AS duration, query\nFROM pg_stat_activity\nWHERE state = 'active'\nORDER BY duration DESC;\n```\n\n### Issue: Performance Degradation After Migration\n\n**Symptom:** Application slows down after migration deployment\n\n**Diagnostic Steps:**\n```sql\n-- 1. Check for missing indexes\nSELECT schemaname, tablename, attname, n_distinct, correlation\nFROM pg_stats\nWHERE schemaname = 'public'\nAND tablename = 'your_table'\nORDER BY abs(correlation) DESC;\n\n-- 2. Analyze query plans\nEXPLAIN ANALYZE SELECT * FROM your_table WHERE new_column = 'value';\n\n-- 3. Check table statistics are up to date\nANALYZE your_table;\n\n-- 4. Look for lock contention\nSELECT * FROM pg_locks WHERE NOT granted;\n```\n\n**Solutions:**\n- Add missing indexes\n- Run ANALYZE on affected tables\n- Consider VACUUM if many rows updated\n- Review and optimize slow queries\n\n## Rollback Procedures\n\n### When to Rollback\n\n- Migration causes application errors or crashes\n- Significant performance degradation detected\n- Data corruption or integrity issues identified\n- Business logic breaks unexpectedly\n- Migration takes longer than maintenance window\n\n### Rollback Strategy\n\n**Simple Migrations (additive only):**\n```sql\n-- Document rollback in migration file\n-- =======================================================================\n-- Rollback Notes:\n-- DROP TABLE new_table;\n-- DELETE FROM flyway_schema_history WHERE version = '###';\n-- =======================================================================\n```\n\n**Complex Migrations (with data changes):**\n- Full database restore from backup (safest)\n- Manual rollback SQL (if documented)\n- Forward-fix with new migration (if feasible)\n\n### Rollback Process\n\n**Development Environment:**\n```bash\n# Simple: Reset database\n./scripts/reset-database.sh\n\n# Or: Manual rollback\ndocker exec -it party-lore-postgres-1 psql -U party_lore -d party_lore_dev\n# Run rollback SQL from migration comments\n```\n\n**Production Environment:**\n```bash\n# 1. Enable maintenance mode\n\n# 2. Stop application\n\n# 3. Restore from backup (taken before migration)\npg_restore -U party_lore -d party_lore_prod backup_pre_migration.dump\n\n# 4. Clean Flyway history (if needed)\nDELETE FROM flyway_schema_history WHERE version >= 'failed_version';\n\n# 5. Deploy previous application version\n\n# 6. Verify functionality\n\n# 7. Disable maintenance mode\n\n# 8. Monitor for issues\n\n# 9. Post-mortem: Document what went wrong\n```\n\n## Performance Guidelines\n\n### Table Size Classifications\n\n| Size | Rows | Migration Strategy |\n|------|------|-------------------|\n| Small | < 100K | Direct operations OK |\n| Medium | 100K - 1M | Use batching for updates |\n| Large | 1M - 10M | CONCURRENTLY for indexes, batched updates |\n| Very Large | > 10M | Maintenance window, extensive testing |\n\n### Index Creation Best Practices\n\n```sql\n-- Small tables (< 100K rows): Regular index\nCREATE INDEX idx_settings_key ON settings(key);\n\n-- Large tables (> 100K rows): CONCURRENTLY\nCREATE INDEX CONCURRENTLY idx_users_email ON users(email);\n\n-- Composite indexes: Most selective column first\nCREATE INDEX CONCURRENTLY idx_sessions_status_created\nON game_sessions(status, created_at)\nWHERE status = 'active';\n\n-- Partial indexes for common queries\nCREATE INDEX CONCURRENTLY idx_active_players\nON players(last_active_at)\nWHERE status = 'active';\n```\n\n### Data Type Selection\n\n| Data Type | Use Case | Example |\n|-----------|----------|---------|\n| `UUID` | Primary keys, distributed systems | `id UUID PRIMARY KEY DEFAULT uuid_generate_v4()` |\n| `VARCHAR(n)` | Bounded text | `username VARCHAR(50)` |\n| `TEXT` | Unbounded text | `narrative_content TEXT` |\n| `TIMESTAMP WITH TIME ZONE` | All timestamps | `created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()` |\n| `JSONB` | Semi-structured data | `metadata JSONB` |\n| `INTEGER` | Counts, IDs | `player_count INTEGER DEFAULT 0` |\n| `BOOLEAN` | True/false flags | `is_active BOOLEAN DEFAULT true` |\n\n### Query Optimization\n\n```sql\n-- Add indexes for foreign keys\nCREATE INDEX idx_players_game_session_id ON players(game_session_id);\n\n-- Add indexes for WHERE clauses\nCREATE INDEX idx_game_sessions_status ON game_sessions(status);\n\n-- Add indexes for ORDER BY\nCREATE INDEX idx_messages_created_at ON messages(created_at DESC);\n\n-- Composite indexes for complex queries\nCREATE INDEX idx_players_session_status ON players(game_session_id, status);\n```\n\n## Best Practices Summary\n\n### DO ‚úÖ\n\n1. **Use the migration scripts** for creation and validation\n2. **Test on clean AND populated databases** before committing\n3. **Add descriptive comments** explaining complex logic\n4. **Include rollback notes** for manual rollback procedures\n5. **Create indexes** for foreign keys and WHERE clause columns\n6. **Use appropriate constraints** to enforce data integrity\n7. **Batch large operations** to avoid long locks\n8. **Use CONCURRENTLY** for indexes on large tables\n9. **Document breaking changes** clearly in commit messages\n10. **Validate migrations** before pushing to remote\n\n### DON'T ‚ùå\n\n1. **Modify committed migrations** - create a new migration instead\n2. **Skip testing** - always test on clean and populated databases\n3. **Add NOT NULL without defaults** on tables with existing data\n4. **Drop columns immediately** - use two-phase deprecation process\n5. **Rename columns directly** - use three-phase migration process\n6. **Create indexes without CONCURRENTLY** on large tables\n7. **Use transactions manually** - Flyway wraps migrations automatically\n8. **Skip validation** - always run validate-migrations script\n9. **Rush production migrations** - plan and test thoroughly\n10. **Forget rollback procedures** - document how to undo changes\n\n## References\n\n- [Flyway Documentation](https://flywaydb.org/documentation/)\n- [PostgreSQL ALTER TABLE](https://www.postgresql.org/docs/current/sql-altertable.html)\n- [PostgreSQL CREATE INDEX](https://www.postgresql.org/docs/current/sql-createindex.html)\n- [Party Lore Development Setup](./development-setup.md)\n- [Party Lore Troubleshooting Guide](./troubleshooting.md)\n- [Migration Scripts](../scripts/) - create-migration, validate-migrations, test-migration, reset-database\n\n## Questions or Issues?\n\nIf you encounter issues not covered in this guide:\n\n1. Check the [Troubleshooting Guide](./troubleshooting.md)\n2. Review existing migrations for examples\n3. Ask in team chat or create a GitHub issue\n4. Consult Flyway or PostgreSQL documentation\n\n---\n\n**Last Updated:** October 2025\n**Maintained by:** Development Team\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/database-migrations.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "def",
        "md"
      ],
      "content_hash": "adf41f8835420e0f",
      "size_bytes": 21307,
      "created_at": "2026-01-02T20:42:12.438162"
    },
    {
      "doc_id": "local_party-lore_docs_REALM_IMPROVEMENTS_SUMMARY",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/REALM_IMPROVEMENTS_SUMMARY.md",
      "content": "# Realm Data Improvements Summary\n**Date**: October 2025\n**Status**: Realm JSON files completed, onboarding integration pending\n\n---\n\n## ‚úÖ Completed Work\n\n### 1. FANTASY Realm (\"Ashen Crowns\")\n**Changes Made**:\n- ‚úÖ Removed gender-split class names\n  - `Lord/Lady` ‚Üí `Noble`\n  - `High Priest/Priestess` ‚Üí `High Priest`\n- ‚úÖ Added comprehensive `classDescriptions` section (8 classes)\n- ‚úÖ Each class has: summary, strengths, weaknesses, playstyle, capabilities, limitations, recommendedFor, difficultyLevel\n- ‚úÖ Updated `aiContextPrompt` to integrate class capabilities\n- ‚úÖ AI now knows what each class CAN and CANNOT do\n\n**Result**: Clean class names, detailed gameplay guidance for AI\n\n---\n\n### 2. CYBERPUNK Realm (\"Chrome Veil\")\n**Changes Made**:\n- ‚úÖ Classes already clean (no gender issues)\n- ‚úÖ Added comprehensive `classDescriptions` section (8 classes)\n- ‚úÖ Each class differentiated by role and abilities\n- ‚úÖ Updated `aiContextPrompt` to integrate class capabilities\n\n**Result**: AI can tailor scenarios to each class's unique abilities\n\n---\n\n### 3. POLITICAL THRILLER Realm (\"Shadow Cabinet\")\n**Changes Made**:\n- ‚úÖ Classes already specific and clear\n- ‚úÖ Added comprehensive `classDescriptions` section (8 classes)\n- ‚úÖ Political roles clearly differentiated\n- ‚úÖ Updated `aiContextPrompt` to integrate class capabilities\n\n**Result**: AI understands political roles and power dynamics\n\n---\n\n### 4. HORROR Realm (\"The Whispering Dark\")\n**Changes Made**:\n- ‚úÖ Renamed from generic \"Horror\" to evocative \"The Whispering Dark\"\n- ‚úÖ Added specific Lovecraftian setting (modern Arkham, Massachusetts)\n- ‚úÖ Added 6 detailed factions (Starry Wisdom Cult, Miskatonic University, etc.)\n- ‚úÖ Added comprehensive `classDescriptions` section (8 classes)\n- ‚úÖ Added detailed starting scenario (\"The Disappearances\")\n- ‚úÖ Added 10 unique features (Sanity Death Spiral, Cosmic Indifference, etc.)\n- ‚úÖ Added detailed `sanitySystem` with triggers and madness outcomes\n- ‚úÖ Added 3 vivid narrative examples (atmospheric horror)\n- ‚úÖ Expanded AI context prompt from 2 sentences to 500+ words\n- ‚úÖ Added session structure and target demographic\n\n**Result**: Horror realm is now on par with other realms, ready for gameplay\n\n**Before**: 35 lines, no factions, no scenarios, generic\n**After**: 327 lines, 6 factions, detailed scenarios, Lovecraftian cosmic horror\n\n---\n\n## üìä Summary of Changes\n\n### Files Modified\n- `/party-lore-app/src/main/resources/realms/fantasy.json` (347 lines)\n- `/party-lore-app/src/main/resources/realms/cyberpunk.json` (307 lines)\n- `/party-lore-app/src/main/resources/realms/political_thriller.json` (276 lines)\n- `/party-lore-app/src/main/resources/realms/horror.json` (327 lines)\n- `/party-lore-console/src/main/resources/realms/*.json` (copied from app)\n\n### Documentation Created\n- `docs/REALM_DATA_ASSESSMENT.md` - Comprehensive quality assessment\n- `docs/REALM_IMPROVEMENTS_SUMMARY.md` - This file\n\n---\n\n## ‚ö†Ô∏è Remaining Work (Onboarding Integration)\n\n### Task: Update Onboarding Code to Use Class Descriptions\n\n**Current State**:\n- Realm JSON files have comprehensive `classDescriptions`\n- Onboarding code uses hard-coded class descriptions in `OnboardingPrompts.getClassDescription()`\n- AI context prompts already integrate class capabilities ‚úÖ\n\n**Required Changes**:\n\n#### 1. Update Realm Entity\n**File**: `Realm.java`\n**Change**: Add method to access `classDescriptions` from JSON\n```java\npublic Map<String, ClassDescription> getClassDescriptions() {\n    // Parse from JSON data field\n}\n\npublic ClassDescription getClassDescription(String className) {\n    return getClassDescriptions().get(className);\n}\n```\n\n#### 2. Update OnboardingPrompts\n**File**: `OnboardingPrompts.java`\n**Method**: `buildClassSelectionPrompt()`\n\n**Current Signature**:\n```java\npublic static String buildClassSelectionPrompt(\n    String characterName, String realmName, String[] classes)\n```\n\n**New Signature**:\n```java\npublic static String buildClassSelectionPrompt(\n    String characterName, Realm realm)\n```\n\n**Changes**:\n- Remove hard-coded `getClassDescription()` switch statement\n- Use `realm.getClassDescription(className).getSummary()` instead\n- Display: `1Ô∏è‚É£ NOBLE - Powerful aristocrat with vassals and political influence`\n\n#### 3. Update GameCreationFlowHandler\n**File**: `GameCreationFlowHandler.java`\n**Method**: `handleHostCharacterName()` (line 288)\n\n**Change**:\n```java\n// OLD:\nreturn OnboardingPrompts.buildClassSelectionPrompt(characterName, realm.getName(), classes);\n\n// NEW:\nreturn OnboardingPrompts.buildClassSelectionPrompt(characterName, realm);\n```\n\n#### 4. Update PlayerOnboardingFlowHandler\n**File**: `PlayerOnboardingFlowHandler.java`\n**Method**: Similar changes to use Realm object\n\n#### 5. Test Changes\n- Run E2E tests to verify class selection still works\n- Verify class descriptions display correctly for all realms\n- Check that numbered selection (1, 2, 3) still functions\n\n---\n\n## üéØ Benefits of Completed Work\n\n### For AI Gameplay\n- AI now knows exactly what each class can and cannot do\n- Scenarios tailored to class capabilities\n- Consistent gameplay across sessions\n- No more \"inventing\" class abilities on the fly\n\n### For UX (40+ Users)\n- Clean, gender-neutral class names\n- Clear class descriptions (once onboarding integrated)\n- Numbered options already working (1, 2, 3)\n- No confusing slashes or gender splits\n\n### For Game Quality\n- Horror realm is fully fleshed out\n- All realms have consistent detail level\n- Class capabilities guide AI narrative\n- Factions, scenarios, and unique features for every realm\n\n---\n\n## üìù Example: Before & After\n\n### FANTASY Realm Class Selection\n\n**Before (Confusing)**:\n```\nChoose your class:\n1Ô∏è‚É£ LORD/LADY - ???\n8Ô∏è‚É£ HIGH PRIEST/PRIESTESS - ???\n```\n\n**After (Clear)**:\n```\nChoose your character type:\n\n1Ô∏è‚É£ NOBLE - Powerful aristocrat with vassals and political influence\n2Ô∏è‚É£ SPYMASTER - Master of secrets, espionage, and information warfare\n3Ô∏è‚É£ KNIGHT COMMANDER - Elite military leader who commands armies\n...\n8Ô∏è‚É£ ASSASSIN - Elite killer who eliminates targets through stealth\n\nReply with NUMBER (1-8) or name\n```\n\n### HORROR Realm\n\n**Before (Underdeveloped)**:\n```json\n{\n  \"name\": \"Horror\",\n  \"description\": \"A world where supernatural terror lurks...\",\n  \"availableClasses\": [\"Investigator\", \"Occultist\", ...],\n  // NO factions, NO scenarios, NO unique features\n}\n```\n\n**After (Rich & Detailed)**:\n```json\n{\n  \"name\": \"The Whispering Dark\",\n  \"description\": \"A Lovecraftian horror investigation set in modern-day Arkham...\",\n  \"factions\": [6 detailed factions],\n  \"startingScenario\": {...},\n  \"uniqueFeatures\": [10 features],\n  \"sanitySystem\": {...},\n  \"classDescriptions\": {8 detailed classes},\n  \"narrativeExamples\": [3 atmospheric examples]\n}\n```\n\n---\n\n## üöÄ Next Steps\n\n1. **Immediate**: Test current E2E tests to ensure realm JSON changes don't break anything\n2. **Next Session**: Implement onboarding integration (Realm entity + OnboardingPrompts changes)\n3. **Future**: Consider adding difficulty ratings per class (Beginner/Intermediate/Advanced)\n\n---\n\n**Last Updated**: October 2025\n**Completion Status**: Realm JSON files 100% complete, Onboarding integration 0% complete\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/REALM_IMPROVEMENTS_SUMMARY.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "md"
      ],
      "content_hash": "49651b6177f4e1e9",
      "size_bytes": 7237,
      "created_at": "2026-01-02T20:42:12.438287"
    },
    {
      "doc_id": "local_party-lore_docs_README_REALM_WORK",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/README_REALM_WORK.md",
      "content": "# Realm Data Improvements - Status and Next Steps\n\n## ‚úÖ Completed (Ready to Commit)\n\nAll 4 realm JSON files have been completely overhauled with:\n\n### 1. FANTASY - \"Ashen Crowns\"\n- ‚úÖ Fixed gender-split class names (Lord/Lady ‚Üí Noble, etc.)\n- ‚úÖ Added 8 comprehensive class descriptions with capabilities\n- ‚úÖ Updated AI context prompt with class integration\n\n### 2. CYBERPUNK - \"Chrome Veil\"\n- ‚úÖ Added 8 comprehensive class descriptions\n- ‚úÖ Updated AI context prompt\n\n### 3. POLITICAL THRILLER - \"Shadow Cabinet\"\n- ‚úÖ Added 8 comprehensive class descriptions\n- ‚úÖ Updated AI context prompt\n\n### 4. HORROR - \"The Whispering Dark\"\n- ‚úÖ Renamed from generic \"Horror\"\n- ‚úÖ Added Lovecraftian setting (modern Arkham)\n- ‚úÖ Added 6 factions\n- ‚úÖ Added 8 comprehensive class descriptions\n- ‚úÖ Added detailed starting scenario\n- ‚úÖ Added 10 unique features\n- ‚úÖ Added sanity system\n- ‚úÖ Expanded from 35 lines to 327 lines\n\n**Files Modified:**\n- `party-lore-app/src/main/resources/realms/*.json` (all 4 realms)\n- `party-lore-console/src/main/resources/realms/*.json` (copied)\n\n---\n\n## ‚ö†Ô∏è Known Issue: Tests Failing\n\n**Problem**: E2E tests fail because Realm entity can't parse the new JSON structure.\n\n**Root Cause**: The `classDescriptions` field contains nested objects:\n```json\n\"classDescriptions\": {\n  \"Noble\": {\n    \"summary\": \"...\",\n    \"strengths\": [...],\n    \"capabilities\": [...],\n    etc.\n  }\n}\n```\n\nThe Realm entity's existing JSON parsing doesn't handle this nested structure.\n\n**Solution Required**: Update Realm.java to properly deserialize `classDescriptions` field.\n\n---\n\n## üîß Required Follow-Up Work\n\n### Step 1: Update Realm Entity (BLOCKING)\n\n**File**: `Realm.java`\n\n**Add Field**:\n```java\n@Transient\nprivate Map<String, ClassDescription> classDescriptions;\n\npublic static class ClassDescription {\n    private String summary;\n    private List<String> strengths;\n    private List<String> weaknesses;\n    private String playstyle;\n    private List<String> capabilities;\n    private List<String> limitations;\n    private String recommendedFor;\n    private String difficultyLevel;\n    // getters/setters\n}\n```\n\n**Parse from JSON data field** (in `@PostLoad` method or similar):\n```java\n@PostLoad\nprivate void loadFromJson() {\n    // Parse classDescriptions from this.data Map\n    if (this.data != null && this.data.containsKey(\"classDescriptions\")) {\n        // Deserialize classDescriptions\n    }\n}\n```\n\n### Step 2: Update OnboardingPrompts\n\n**Change**: Use realm.getClassDescription(className) instead of hard-coded descriptions.\n\n**File**: `OnboardingPrompts.java`\n- Remove `getClassDescription()` switch statement\n- Update `buildClassSelectionPrompt()` to use Realm object\n\n### Step 3: Test All Changes\n\n- Run E2E tests\n- Verify class descriptions display correctly\n- Check AI prompts work with new class capabilities\n\n---\n\n## üìù Documentation Created\n\n- ‚úÖ `docs/REALM_DATA_ASSESSMENT.md` - Quality assessment before changes\n- ‚úÖ `docs/REALM_IMPROVEMENTS_SUMMARY.md` - Summary of improvements\n- ‚úÖ `docs/README_REALM_WORK.md` - This file\n\n---\n\n## üí° Recommendation\n\n**Option A (Safe)**: Temporarily revert realm JSON changes, commit the assessment documents, then implement Realm entity updates in a follow-up PR.\n\n**Option B (Complete)**: Fix Realm entity parsing now, test, then commit everything together.\n\n**I recommend Option A** to avoid breaking tests. The JSON files are perfect - just need the entity layer to catch up.\n\n---\n\n**Last Updated**: October 2025\n**Status**: JSON files complete, entity parsing needed\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/README_REALM_WORK.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "md",
        "readme"
      ],
      "content_hash": "ca5300f1a364a83f",
      "size_bytes": 3568,
      "created_at": "2026-01-02T20:42:12.438399"
    },
    {
      "doc_id": "local_party-lore_docs_migration-review-checklist",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/migration-review-checklist.md",
      "content": "# Migration Review Checklist\n\nUse this checklist when reviewing database migrations in pull requests.\n\n## Basic Requirements\n\n- [ ] **File naming follows convention**: `V###__description.sql` format\n- [ ] **Version number is sequential**: No gaps or conflicts with existing migrations\n- [ ] **Description is descriptive**: Clearly indicates what the migration does\n- [ ] **File uses snake_case**: Lowercase with underscores (auto-normalized by create-migration script)\n\n## Documentation\n\n- [ ] **Header comment present**: Includes migration description, date, author\n- [ ] **Section headers included**: Organizes migration into logical sections\n- [ ] **Complex logic is commented**: Explains non-obvious SQL operations\n- [ ] **Rollback notes documented**: Explains how to manually undo this migration\n- [ ] **Validation queries included**: Commented SELECT statements to verify migration success\n\n## SQL Quality\n\n- [ ] **Appropriate data types**: Uses PostgreSQL-appropriate types (UUID, TIMESTAMP WITH TIME ZONE, JSONB, etc.)\n- [ ] **NOT NULL handled safely**: Nullable first or includes DEFAULT value for existing rows\n- [ ] **Constraints are appropriate**: CHECK, UNIQUE, FOREIGN KEY where needed\n- [ ] **Indexes for foreign keys**: Every FK column has an index\n- [ ] **Indexes for WHERE clauses**: Common query patterns have supporting indexes\n- [ ] **CONCURRENTLY for large tables**: Indexes use CONCURRENTLY option if table is large (> 100K rows)\n\n## Data Safety\n\n- [ ] **No destructive operations**: Or appropriate safeguards if necessary (backup, confirmation)\n- [ ] **Handles existing data**: Updates or migrates existing rows if column semantics change\n- [ ] **Uses batching for large updates**: Large data migrations use batched approach\n- [ ] **No DROP COLUMN**: Or uses two-phase deprecation process\n- [ ] **No column renames**: Or uses three-phase migration process\n- [ ] **Transaction safety**: Migration is idempotent or wrapped appropriately\n\n## Performance\n\n- [ ] **Performance impact assessed**: Migration won't block operations for extended time\n- [ ] **Large operations are batched**: Data updates on millions of rows use batching\n- [ ] **Indexes created efficiently**: CONCURRENTLY used for large tables\n- [ ] **Constraints added safely**: NOT VALID used for large tables, then validated separately\n- [ ] **No full table scans**: Migration doesn't cause expensive sequential scans\n\n## Testing\n\n- [ ] **Tested on clean database**: Migration works on empty database\n- [ ] **Tested with existing data**: Migration works with populated database\n- [ ] **Validation script passed**: `validate-migrations.sh/bat` runs without errors\n- [ ] **Health check passes**: Application starts successfully after migration\n- [ ] **Rollback tested**: Rollback procedure works (if applicable)\n- [ ] **Performance tested**: Migration completes in reasonable time on test data\n\n## Code Review Notes\n\n### Common Issues to Watch For\n\n**Naming:**\n- ‚ùå `V1__add_table.sql` ‚Üí ‚úÖ `V001__add_user_authentication_table.sql`\n- ‚ùå `V003__fix.sql` ‚Üí ‚úÖ `V003__fix_player_status_constraint.sql`\n- ‚ùå `V005__AddTable.sql` ‚Üí ‚úÖ `V005__add_table.sql`\n\n**NOT NULL Columns:**\n```sql\n-- ‚ùå Bad: Will fail if users table has existing rows\nALTER TABLE users ADD COLUMN email VARCHAR(255) NOT NULL;\n\n-- ‚úÖ Good: Nullable first, populate, then NOT NULL\nALTER TABLE users ADD COLUMN email VARCHAR(255);\nUPDATE users SET email = 'user' || id || '@example.com' WHERE email IS NULL;\nALTER TABLE users ALTER COLUMN email SET NOT NULL;\n\n-- ‚úÖ Good: Default value handles existing rows\nALTER TABLE users ADD COLUMN status VARCHAR(20) DEFAULT 'active' NOT NULL;\n```\n\n**Missing Indexes:**\n```sql\n-- ‚ùå Bad: Foreign key without index\nALTER TABLE players ADD COLUMN game_session_id UUID\n    REFERENCES game_sessions(id);\n\n-- ‚úÖ Good: Foreign key with index\nALTER TABLE players ADD COLUMN game_session_id UUID\n    REFERENCES game_sessions(id);\nCREATE INDEX idx_players_game_session_id ON players(game_session_id);\n```\n\n**Large Table Operations:**\n```sql\n-- ‚ùå Bad: Single UPDATE on large table\nUPDATE large_table SET new_field = 'value' WHERE condition;\n\n-- ‚úÖ Good: Batched updates\nDO $$\nDECLARE\n    batch_size INTEGER := 10000;\n    affected_rows INTEGER;\nBEGIN\n    LOOP\n        UPDATE large_table\n        SET new_field = 'value'\n        WHERE condition\n        AND id IN (\n            SELECT id FROM large_table\n            WHERE condition AND new_field IS NULL\n            ORDER BY id\n            LIMIT batch_size\n        );\n        GET DIAGNOSTICS affected_rows = ROW_COUNT;\n        EXIT WHEN affected_rows = 0;\n        PERFORM pg_sleep(0.1);\n    END LOOP;\nEND $$;\n```\n\n**Index Creation:**\n```sql\n-- ‚ùå Bad: Regular index on large table (blocks operations)\nCREATE INDEX idx_users_email ON users(email);\n\n-- ‚úÖ Good: CONCURRENTLY on large table (non-blocking)\nCREATE INDEX CONCURRENTLY idx_users_email ON users(email);\n```\n\n## Reviewer Questions\n\nAsk the migration author:\n\n1. **What problem does this migration solve?**\n2. **How did you test this migration?**\n3. **What is the rollback procedure if this fails in production?**\n4. **What is the expected performance impact?**\n5. **Does this require a maintenance window?**\n6. **Are there any application code changes that must deploy with this?**\n7. **Have you tested the rollback procedure?**\n\n## Sign-Off\n\nOnce all items are checked and questions answered:\n\n- [ ] **Migration approved for merge**\n- [ ] **Deployment notes added** (if special procedures required)\n- [ ] **Team notified** (if impacts other developers or requires coordination)\n\n---\n\n**Reviewer:** _______________\n**Date:** _______________\n**Notes:**\n\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/migration-review-checklist.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "md"
      ],
      "content_hash": "4fff63bbc0bd61bf",
      "size_bytes": 5658,
      "created_at": "2026-01-02T20:42:12.438437"
    },
    {
      "doc_id": "local_party-lore_docs_LLM-TESTING-GUIDE",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/LLM-TESTING-GUIDE.md",
      "content": "# LLM Integration Testing Guide\n\nThis document describes how to test and debug the LLM components (PlayerIntentDetector, GameModeDetector) without running full game sessions.\n\n## Quick Reference\n\n### Shell Scripts (Direct Ollama Testing)\n\n```bash\n# Test intent detection scenarios\n./scripts/test-intent-detection.sh all              # Run all scenarios\n./scripts/test-intent-detection.sh basic-attack     # Valid attack\n./scripts/test-intent-detection.sh invalid-target   # Player fabricates NPC\n./scripts/test-intent-detection.sh invalid-ability  # Fighter casts spell\n./scripts/test-intent-detection.sh invalid-item     # Uses item not owned\n./scripts/test-intent-detection.sh multi-player     # Multiple players\n./scripts/test-intent-detection.sh vague-reference  # \"the big orc\" resolution\n\n# Test game mode detection\n./scripts/test-game-mode-detection.sh all           # Run all scenarios\n./scripts/test-game-mode-detection.sh combat        # Combat mode detection\n./scripts/test-game-mode-detection.sh exploration   # Exploration mode\n./scripts/test-game-mode-detection.sh social        # Social mode\n./scripts/test-game-mode-detection.sh stealth       # Stealth mode\n./scripts/test-game-mode-detection.sh transition    # Mode transitions\n\n# Use different model\nMODEL=llama3:8b ./scripts/test-intent-detection.sh all\n```\n\n### Unit Tests (No Ollama Required)\n\n```bash\n# Run XML parsing tests with mocked responses\nmvn test -Dtest=PlayerIntentDetectorTest\n\n# Run specific test class\nmvn test -Dtest=PlayerIntentDetectorTest#parseValidAttackIntent\n```\n\n## When to Use This Framework\n\n1. **After changing prompts** - Verify prompts still produce expected XML format\n2. **After changing XML parsing** - Verify parsing handles edge cases\n3. **When debugging validation issues** - See exact LLM input/output\n4. **When adding new validation types** - Create new test scenarios\n5. **After /test finds issues** - Isolate and reproduce the problem\n\n## Debugging Workflow\n\n### Step 1: Identify the Issue\nFrom `/test` output or game transcripts, identify what went wrong:\n- Invalid action not caught?\n- Valid action incorrectly rejected?\n- Wrong intent type detected?\n- Target not resolved correctly?\n\n### Step 2: Create/Modify Test Scenario\nEdit the shell script to match the failing case:\n\n```bash\n# In scripts/test-intent-detection.sh, add or modify a test function:\ntest_my_issue() {\n    log_section \"SCENARIO: My Issue Description\"\n\n    local prompt='Analyze and VALIDATE these RPG player actions.\n\n=== SCENE STATE ===\nNPCs PRESENT IN SCENE: Guard Captain, Merchant\n(Players can ONLY target these NPCs - any other target is INVALID)\nEnvironment: Castle courtyard\nCurrent mode: Exploration\n\n=== PLAYER ACTIONS ===\n- PlayerName (Class)\n  Inventory: Item1, Item2\n  Action: \"The exact action that failed\"\n\n=== VALIDATION RULES ===\n... (keep standard rules)\n\nOutput ONLY the XML, no other text.'\n\n    log_info \"Prompt sent to LLM:\"\n    echo \"$prompt\"\n\n    log_info \"LLM Response:\"\n    local response=$(call_llm \"$prompt\" \"You analyze and validate player actions in an RPG. Output XML.\")\n    echo \"$response\"\n}\n```\n\n### Step 3: Run and Analyze\n```bash\n./scripts/test-intent-detection.sh my-issue\n```\n\nLook at:\n- Is the prompt clear about what NPCs are present?\n- Is the class information included?\n- Is the inventory listed?\n- Did the LLM output valid XML?\n- Did it correctly identify the validation issue?\n\n### Step 4: Fix the Prompt\nCommon fixes:\n- Make NPCs list more prominent\n- Add explicit \"ONLY these NPCs exist\" instruction\n- Include class abilities description\n- Be more explicit about validation rules\n\n### Step 5: Verify Fix in Code\nAfter fixing the prompt in the script, update the corresponding Java code:\n- `PlayerIntentDetector.buildValidatingIntentPrompt()`\n- `GameModeDetector.buildModeDetectionPrompt()`\n\n## Key Files\n\n| File | Purpose |\n|------|---------|\n| `scripts/test-intent-detection.sh` | Quick prompt testing for intent detection |\n| `scripts/test-game-mode-detection.sh` | Quick prompt testing for mode detection |\n| `party-lore-ai/.../testing/IntentScenario.java` | Test scenario model |\n| `party-lore-ai/.../testing/IntentScenarios.java` | Pre-defined scenarios |\n| `party-lore-ai/.../testing/IntentTestRunner.java` | Executes scenarios with real LLM |\n| `party-lore-ai/.../narrative/PlayerIntentDetector.java` | Intent detection with validation |\n| `party-lore-ai/.../narrative/GameModeDetector.java` | Game mode classification |\n| `party-lore-ai/.../narrative/PlayerIntent.java` | Intent model with validation fields |\n\n## Validation Types\n\n| Type | Description | Example |\n|------|-------------|---------|\n| `INVALID_TARGET` | NPC doesn't exist in scene | \"Attack the dragon\" (no dragon) |\n| `INVALID_ABILITY` | Class can't do this | Fighter casting fireball |\n| `INVALID_ITEM` | Item not in inventory | Using lockpicks without owning them |\n| `IMPOSSIBLE_ACTION` | Physically impossible | Flying without wings |\n| `FABRICATED_ELEMENTS` | Introducing non-existent things | \"Use the magic portal\" (no portal) |\n| `NONSENSICAL` | Action doesn't make sense | Random gibberish |\n| `PLAYER_INCAPACITATED` | Player can't act | Dead player attacking |\n\n## XML Response Format\n\n### Intent Detection (with validation)\n```xml\n<intents>\n  <intent>\n    <player>CharacterName</player>\n    <intent_type>ATTACK|DEFEND|SKILL_USE|SOCIAL|MOVEMENT|EXPLORATION|STEALTH|OTHER</intent_type>\n    <target>NPC name or empty</target>\n    <resolved_action>Clean description</resolved_action>\n    <dice_roll>ACTION|DEFENSE|SKILL|NONE</dice_roll>\n    <valid>true|false</valid>\n    <validation_issue>INVALID_TARGET|INVALID_ABILITY|etc (if invalid)</validation_issue>\n    <suggested_alternative>What they could do instead</suggested_alternative>\n    <validation_reason>Why it's invalid</validation_reason>\n  </intent>\n</intents>\n<suggested_mode>COMBAT|EXPLORATION|SOCIAL|STEALTH</suggested_mode>\n```\n\n### Game Mode Detection\n```xml\n<game_mode>\n  <mode>COMBAT|EXPLORATION|SOCIAL|STEALTH</mode>\n  <reason>Brief explanation</reason>\n</game_mode>\n```\n\n## Adding New Test Scenarios\n\n### In Shell Script (Quick Testing)\nAdd a new function in `test-intent-detection.sh`:\n```bash\ntest_new_scenario() {\n    log_section \"SCENARIO: Description\"\n    local prompt='...'\n    # ... rest of test\n}\n```\n\nAdd to main case statement:\n```bash\ncase \"$scenario\" in\n    new-scenario)\n        test_new_scenario\n        ;;\n```\n\n### In Java (Comprehensive Testing)\nAdd to `IntentScenarios.java`:\n```java\nIntentScenario.builder(\"new-scenario-name\")\n    .description(\"What this tests\")\n    .npcsPresent(\"NPC1\", \"NPC2\")\n    .addPlayer(\"PlayerName\", \"Class\", List.of(\"Item1\"))\n    .addAction(\"PlayerName\", \"The action text\")\n    .expectIntent(\"PlayerName\", ExpectedIntent.valid(\n        PlayerIntent.IntentType.ATTACK,\n        \"NPC1\",\n        PlayerIntent.DiceRollType.ACTION))\n    .expectedMode(GameMode.COMBAT)\n    .build()\n```\n\n## Common Issues and Solutions\n\n### LLM Returns Invalid XML\n- Check if response is truncated (increase maxTokens)\n- Add \"Output ONLY the XML\" instruction\n- Reduce prompt complexity\n\n### LLM Doesn't Detect Invalid Actions\n- Make NPCs list more prominent with explicit \"ONLY these exist\"\n- Add concrete examples of invalid vs valid\n- Include class abilities description\n\n### LLM Includes Extra Text\n- Add stricter \"no other text\" instruction\n- Lower temperature for more deterministic output\n\n### Vague References Not Resolved\n- Add \"Match vague references to actual NPC names\" instruction\n- Include recent history for context\n- List NPCs with descriptions\n\n## Integration with /test Command\n\nWhen `/test` finds an issue:\n1. Check the transcript file for the exact prompt/response\n2. Create a minimal test case in the shell script\n3. Iterate on the prompt until it works\n4. Update the Java code with the fixed prompt\n5. Re-run `/test` to verify\n\nThe transcript files are in: `party-lore-ai/transcripts/`\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/LLM-TESTING-GUIDE.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "llm",
        "md",
        "test"
      ],
      "content_hash": "c937e38b6549953f",
      "size_bytes": 7896,
      "created_at": "2026-01-02T20:42:12.438669"
    },
    {
      "doc_id": "local_party-lore_docs_STEP_1_FINDINGS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/STEP_1_FINDINGS.md",
      "content": "# Step 1 Findings: START Command Investigation\n\n## Status: ‚úÖ COMPLETE\n\nAll Step 1 requirements were **already implemented** and tests confirm functionality works correctly.\n\n## Step 1A: \"Type START to begin\" after game creation\n\n**Status**: ‚úÖ Already Implemented\n\n**Location**: `OnboardingPrompts.GAME_CREATION_COMPLETE` (lines 142-157)\n\n```java\npublic static final String GAME_CREATION_COMPLETE = \"\"\"\n    Your \"%s\" adventure is ready!\n\n    Realm: %s\n    Host: %s (playing %s the %s)\n\n    üë• Invite at least 1 friend to join (max 5):\n\n    INVITE +1-555-1234 Alice\n    INVITE +1-555-5678 Bob\n\n    üí° Your friends will get beta access automatically!\n    They'll create their character and join the party group chat.\n\n    üé≤ Once you have 2+ players, type START to begin!\n    \"\"\";\n```\n\nThe host sees this message immediately after creating their game.\n\n## Step 1B: \"Type START to begin\" after each player joins\n\n**Status**: ‚úÖ Already Implemented\n\n**Location**: `PlayerOnboardingFlowHandler.notifyHostIfReadyToStart()` (lines 491-542)\n\n```java\nprivate void notifyHostIfReadyToStart(GameSession gameSession) {\n    // Only notify if game is still RECRUITING\n    if (gameSession.getStatus() != GameSessionStatus.RECRUITING) {\n        return;\n    }\n\n    // Only notify if we have 2+ players\n    if (playerCount < 2) {\n        return;\n    }\n\n    // Send notification to host\n    String hostMessage = String.format(\"\"\"\n        üé≤ Your game is ready to start!\n\n        You have %d player(s) ready to adventure.\n\n        Type START to begin the adventure, or wait for more players to join.\n        \"\"\".trim(),\n        playerCount);\n\n    smsService.sendSms(hostPhone, hostMessage);\n}\n```\n\nThis is called automatically from `PlayerOnboardingFlowHandler.addPlayerToGroupConversation()` at line 469.\n\n## Step 1C: Test START command works properly\n\n**Status**: ‚úÖ VERIFIED\n\nRan E2E test suite:\n```\n[INFO] Tests run: 17, Failures: 0, Errors: 0, Skipped: 0\n[INFO] BUILD SUCCESS\n```\n\n### START Command Flow\n\n1. **User types \"START\"**\n2. **MessageRouter.route()** checks if it's a command (line 73)\n3. **CommandHandler.isCommand(\"START\")** returns true (line 63 regex matches)\n4. **CommandHandler.handleStart()** is invoked (line 90, 264-315)\n5. **Validation checks**:\n   - Player must have active game\n   - Player must be host (DM)\n   - Game must be in RECRUITING status\n   - Must have 2+ players\n6. **Game starts**:\n   - `game.startGame()` transitions status to ACTIVE\n   - GameSession saved to database\n   - System announcement sent to all players\n   - **GameStartedEvent published** (line 303)\n7. **GameStartedEventListener handles event** (@Async):\n   - Creates initial scene\n   - Generates opening narrative\n   - Sends narrative to all players\n\n### Why START Command Already Works\n\nThe routing logic **prioritizes commands over conversation state** (MessageRouter lines 73-76):\n\n```java\n// 1. Check for system commands first\nif (CommandHandler.isCommand(messageBody)) {\n    logger.info(\"Routing to CommandHandler: {}\", messageBody);\n    return commandHandler.handle(phoneNumber, messageBody);\n}\n\n// 2. Check if in conversation flow (onboarding, invitation, etc)\n// ... only checked if NOT a command\n```\n\nSo even if there's an active conversation state, START is routed to CommandHandler first.\n\n## User's Reported Issue\n\n**User said**: \"the game narrative still is not starting, even when i write START\"\n\n### Possible Causes\n\n1. **Not enough players**: START requires 2+ players\n   - Host message clearly states: \"need 2+ players total\"\n   - CommandHandler returns error if playerCount < 2\n\n2. **Not recognized as host**: START only works for game host\n   - Checked via `game.getDmPhoneNumber().equals(phoneNumber)`\n   - Non-hosts get message: \"Only the host can start the game\"\n\n3. **Game already started**: START only works for RECRUITING games\n   - If game is ACTIVE, returns: \"Game has already started\"\n\n4. **Async opening narrative failure**: GameStartedEventListener is @Async\n   - START command succeeds but narrative generation fails silently\n   - Check logs for errors in OpeningNarrativeGenerator\n\n### Recommended Next Steps\n\n1. ‚úÖ **Verify E2E tests cover START command** - DONE (tests pass)\n2. ‚ö†Ô∏è **Add E2E test for START with insufficient players** - TODO\n3. ‚ö†Ô∏è **Add E2E test for non-host trying START** - TODO\n4. ‚ö†Ô∏è **Add logging to GameStartedEventListener** - Already has extensive logging\n5. ‚ö†Ô∏è **Check production logs for GameStartedEvent failures** - Need user access\n\n## Next: Step 2 - Remove Twilio Conversations API\n\n**Scope**: 25 files reference Twilio Conversations\n\n**Strategy**:\n- Stop creating new conversations\n- Use MessageBroadcaster for all messaging\n- Keep existing code functional for backwards compatibility\n- Gradual migration approach\n\nSee `docs/MESSAGING_ARCHITECTURE.md` for detailed plan.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/STEP_1_FINDINGS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "function",
        "md",
        "test"
      ],
      "content_hash": "0fd7aaf6a0a9f503",
      "size_bytes": 4846,
      "created_at": "2026-01-02T20:42:12.438704"
    },
    {
      "doc_id": "local_party-lore_docs_MESSAGING_ARCHITECTURE",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/MESSAGING_ARCHITECTURE.md",
      "content": "# Party Lore Messaging Architecture\n\n## Current State (SMS-Only)\n\n### Existing Decoupling ‚úÖ\n\nThe codebase **already has proper decoupling** between core game logic and SMS:\n\n1. **MessageBroadcaster** (domain layer)\n   - Iterates through all active players in a game\n   - Calls `smsService.sendSms()` for each player\n   - Formats messages with character names\n   - Logs all messages to `GameMessage` repository\n\n2. **SmsService Interface** (domain layer)\n   - Implemented by `TwilioSmsService` in SMS module\n   - Dependency inversion principle applied\n   - Core game logic doesn't depend on Twilio\n\n3. **ChannelRoutingService** (domain layer)\n   - Determines if message should be GROUP_BROADCAST or DM_PRIVATE\n   - Analyzes message content for routing hints\n   - Already has channel abstraction\n\n### Current Message Flow\n\n```\nPlayer sends SMS\n    ‚Üì\nTwilio Webhook ‚Üí SmsWebhookController\n    ‚Üì\nMessageRouter ‚Üí routes to gameplay\n    ‚Üì\nMessageBroadcaster.broadcastToGame()\n    ‚Üì\nFor each active player:\n    smsService.sendSms(player.getPhoneNumber(), formattedMessage)\n    ‚Üì\nTwilioSmsService ‚Üí Twilio API ‚Üí Player's phone\n```\n\n### What Works ‚úÖ\n- Message broadcasting to all players\n- Character name prefixing (`üì£ Raven: I attack!`)\n- Private messages (`üîí (private from Raven): ...`)\n- System announcements\n- AI narration (`üé≤ The dragon roars...`)\n- Message history logging\n- Decoupled domain/SMS layers\n\n### What Doesn't Work ‚ùå\n- **No multi-channel support** - Can't send via WebSocket\n- **No connection type tracking** - Can't tell if player is on mobile app vs SMS\n- **Twilio Conversations API used** - Creates unnecessary complexity (should be removed)\n- **No player preference** - Can't let player choose SMS or app\n\n---\n\n## Future State (SMS + WebSocket)\n\n### Architecture Goals\n\n1. **Multi-Channel Delivery**: Send same message via SMS or WebSocket\n2. **Player Connection Tracking**: Know which channel each player is using\n3. **Channel Preference**: Player can be on both SMS and app simultaneously\n4. **Unified Message Format**: Same message structure regardless of channel\n5. **Remove Twilio Conversations**: Use our own group messaging\n\n### Proposed Architecture\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                     DOMAIN LAYER                             ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  MessageBroadcaster                                          ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Looks up all active players                            ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ For each player:                                        ‚îÇ\n‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ messagingService.sendToPlayer(player, message)     ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Logs to GameMessage repository                         ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  MessagingService Interface                                 ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ sendToPlayer(Player, Message) ‚Üê routes by player prefs ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ sendGroupMessage(GameSession, Message)                 ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ sendPrivateMessage(Player, Player, Message)            ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚Üì\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                INFRASTRUCTURE LAYER                          ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  MultiChannelMessagingService (impl of MessagingService)    ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Checks player.connectionType                           ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Routes to SMS or WebSocket                             ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Can send to BOTH if player has app AND SMS             ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ\n‚îÇ  ‚îÇ SmsChannel     ‚îÇ         ‚îÇ WebSocketChannel ‚îÇ            ‚îÇ\n‚îÇ  ‚îÇ (Twilio)       ‚îÇ         ‚îÇ (Spring WS)      ‚îÇ            ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ\n‚îÇ                                                               ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Data Model Changes\n\n**Add to Player entity:**\n\n```java\npublic enum ConnectionType {\n    SMS,           // Player using SMS only\n    WEBSOCKET,     // Player using mobile app only\n    BOTH           // Player has app installed but can also receive SMS\n}\n\n@Enumerated(EnumType.STRING)\n@Column(name = \"connection_type\", nullable = false)\nprivate ConnectionType connectionType = ConnectionType.SMS;  // Default to SMS\n\n@Column(name = \"device_id\")\nprivate String deviceId;  // For WebSocket sessions\n\n@Column(name = \"last_seen_app\")\nprivate Instant lastSeenApp;  // Track when player last used app\n\n@Column(name = \"prefer_app_notifications\")\nprivate Boolean preferAppNotifications = false;\n```\n\n**Migration strategy:**\n- All existing players default to `ConnectionType.SMS`\n- When player logs into app: set to `WEBSOCKET` or `BOTH`\n- Track `lastSeenApp` to know if app is still active\n\n---\n\n## Implementation Plan\n\n### Phase 1: Remove Twilio Conversations API ‚úÖ (Do This First)\n\n**Why:** Twilio Conversations adds complexity and doesn't give us character name prefixes. We already have MessageBroadcaster doing this correctly!\n\n**Changes:**\n1. Remove `ConversationCreationService` interface\n2. Remove `TwilioConversationsService` implementation\n3. Remove `conversation_sid` from `GameSession`\n4. Remove `conversation_participants` table\n5. Update all code using Conversations to use MessageBroadcaster instead\n\n**Impact:** 180+ file references (large refactor)\n\n**Benefits:**\n- Simpler code\n- Character names work properly\n- No Twilio Conversations billing\n- Easier to add WebSocket later\n\n### Phase 2: Abstract MessagingService Interface\n\n**Create new interface:**\n\n```java\npublic interface MessagingService {\n    /**\n     * Send message to a specific player.\n     * Routes to SMS, WebSocket, or both depending on player connection type.\n     */\n    void sendToPlayer(Player player, String message);\n\n    /**\n     * Send message to all players in a game.\n     */\n    void sendToGame(GameSession game, String senderName, String message);\n\n    /**\n     * Send private message between players.\n     */\n    void sendPrivate(Player from, Player to, String message);\n}\n```\n\n**Implementation:**\n\n```java\n@Service\npublic class MultiChannelMessagingService implements MessagingService {\n\n    private final SmsService smsService;\n    private final WebSocketService webSocketService;\n\n    @Override\n    public void sendToPlayer(Player player, String message) {\n        switch (player.getConnectionType()) {\n            case SMS -> smsService.sendSms(player.getPhoneNumber(), message);\n            case WEBSOCKET -> webSocketService.send(player.getDeviceId(), message);\n            case BOTH -> {\n                // Send to both channels\n                smsService.sendSms(player.getPhoneNumber(), message);\n                webSocketService.send(player.getDeviceId(), message);\n            }\n        }\n    }\n\n    @Override\n    public void sendToGame(GameSession game, String senderName, String message) {\n        String formatted = String.format(\"[%s]: %s\", senderName, message);\n\n        List<Player> players = playerRepository.findByGameSessionAndStatus(\n            game, PlayerStatus.ACTIVE\n        );\n\n        for (Player player : players) {\n            sendToPlayer(player, formatted);\n        }\n    }\n}\n```\n\n### Phase 3: Add Connection Type Tracking\n\n**Database migration:**\n\n```sql\nALTER TABLE players\nADD COLUMN connection_type VARCHAR(20) NOT NULL DEFAULT 'SMS',\nADD COLUMN device_id VARCHAR(255),\nADD COLUMN last_seen_app TIMESTAMP,\nADD COLUMN prefer_app_notifications BOOLEAN DEFAULT FALSE;\n\n-- Add index for WebSocket lookups\nCREATE INDEX idx_players_device_id ON players(device_id) WHERE device_id IS NOT NULL;\n```\n\n**Player entity updates:**\n- Add `connectionType` field\n- Add `deviceId` for WebSocket sessions\n- Add connection tracking fields\n\n### Phase 4: Implement WebSocket Service\n\n**Create WebSocketService:**\n\n```java\npublic interface WebSocketService {\n    void send(String deviceId, String message);\n    void sendToSession(String sessionId, String message);\n    boolean isConnected(String deviceId);\n}\n\n@Service\npublic class SpringWebSocketService implements WebSocketService {\n\n    private final SimpMessagingTemplate messagingTemplate;\n\n    @Override\n    public void send(String deviceId, String message) {\n        // Send to specific device via WebSocket\n        messagingTemplate.convertAndSendToUser(\n            deviceId,\n            \"/queue/messages\",\n            message\n        );\n    }\n}\n```\n\n### Phase 5: Mobile App Authentication\n\n**Track device connections:**\n\n```java\n@Service\npublic class PlayerConnectionService {\n\n    /**\n     * When player logs into mobile app\n     */\n    public void registerDevice(String phoneNumber, String deviceId) {\n        Player player = playerRepository.findByPhoneNumber(phoneNumber)\n            .orElseThrow();\n\n        player.setDeviceId(deviceId);\n        player.setLastSeenApp(Instant.now());\n\n        // If they had SMS, upgrade to BOTH\n        if (player.getConnectionType() == ConnectionType.SMS) {\n            player.setConnectionType(ConnectionType.BOTH);\n        } else {\n            player.setConnectionType(ConnectionType.WEBSOCKET);\n        }\n\n        playerRepository.save(player);\n    }\n\n    /**\n     * When device disconnects\n     */\n    public void handleDisconnect(String deviceId) {\n        Player player = playerRepository.findByDeviceId(deviceId)\n            .orElse(null);\n\n        if (player != null && player.getConnectionType() == ConnectionType.WEBSOCKET) {\n            // If app-only, fall back to SMS\n            player.setConnectionType(ConnectionType.SMS);\n            playerRepository.save(player);\n        }\n    }\n}\n```\n\n---\n\n## Migration Strategy\n\n### Option A: Big Bang (Not Recommended)\n- Remove all Conversations API in one PR\n- High risk of breaking production\n- Hard to test comprehensively\n\n### Option B: Incremental (Recommended)\n\n**Step 1:** Fix immediate bugs (START command, prompts) ‚Üê **DO THIS FIRST**\n- These are blocking users NOW\n- Small, safe changes\n- Get production working\n\n**Step 2:** Add MessagingService abstraction ALONGSIDE Conversations\n- Create MultiChannelMessagingService\n- Make it use SmsService (existing)\n- Update MessageBroadcaster to use it\n- Test thoroughly\n- **Don't remove Conversations yet**\n\n**Step 3:** Add connection type tracking\n- Database migration for Player fields\n- Default all to SMS\n- No behavior change yet\n\n**Step 4:** Remove Conversations API usage gradually\n- Replace one feature at a time\n- Start with announcements (simple)\n- Then player onboarding\n- Then game creation\n- Test each change\n\n**Step 5:** Add WebSocket support\n- Implement WebSocketService\n- Update MultiChannelMessagingService to route to both\n- Mobile app development can start\n\n**Step 6:** Clean up\n- Remove Conversations API completely\n- Delete unused code\n- Update docs\n\n---\n\n## Immediate Action Items\n\n### Critical Bugs (Fix Today)\n\n1. **START command not working**\n   - Issue: Conversation state blocks command routing\n   - Fix: Ensure commands checked before conversation flow\n   - Impact: Host can't start games\n\n2. **Missing \"type START to begin\" prompt**\n   - Issue: After player joins, host doesn't know to type START\n   - Fix: Add announcement to host after each player joins\n   - Impact: UX confusion\n\n3. **Character name prefixes missing**\n   - Issue: Twilio Conversations doesn't support identity for SMS\n   - Fix: Remove Conversations, use MessageBroadcaster\n   - Impact: Players can't tell who said what\n\n### Short-term (This Week)\n\n4. **Create MessagingService abstraction**\n   - Define interface\n   - Implement with SMS only\n   - Replace direct SmsService calls in MessageBroadcaster\n\n5. **Add connection type to Player**\n   - Database migration\n   - Entity updates\n   - Default all to SMS\n\n### Medium-term (This Month)\n\n6. **Remove Twilio Conversations API**\n   - Gradual replacement feature-by-feature\n   - Use MessageBroadcaster for all group messaging\n   - Test each change\n\n7. **Implement WebSocket support**\n   - Spring WebSocket configuration\n   - WebSocketService implementation\n   - Device connection tracking\n\n### Long-term (Next Quarter)\n\n8. **Mobile app development**\n   - WebSocket client\n   - Push notifications\n   - Offline message queue\n\n---\n\n## Key Insights\n\n### What You Already Have ‚úÖ\n- **MessageBroadcaster** - Perfect for group messaging\n- **SmsService interface** - Proper abstraction\n- **ChannelRoutingService** - Smart routing logic\n- **Message history** - Full audit trail\n- **Character name formatting** - Already works correctly\n\n### What Needs Work ‚ùå\n- **Twilio Conversations** - Remove this complexity\n- **Connection type tracking** - Add to Player model\n- **Multi-channel routing** - Build MessagingService\n- **WebSocket implementation** - Add for mobile app\n\n### Architecture Is Sound üéØ\nThe existing MessageBroadcaster design is **exactly what you need**. It:\n- Iterates through players ‚úÖ\n- Sends individually (not group SMS) ‚úÖ\n- Formats with character names ‚úÖ\n- Logs message history ‚úÖ\n- Is decoupled from SMS ‚úÖ\n\n**You don't need to rewrite it - just enhance it!**\n\n---\n\n## Next Steps\n\nI recommend:\n\n1. **Fix START command bug** (30 minutes)\n2. **Add \"type START\" prompt** (15 minutes)\n3. **Remove Twilio Conversations** (2-4 hours)\n4. **Test with real users** (validate fixes)\n5. **Then** proceed with WebSocket architecture\n\nThe Conversations API removal is the critical blocker for character name prefixes working correctly.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/MESSAGING_ARCHITECTURE.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "db59a4789fda0a2a",
      "size_bytes": 14453,
      "created_at": "2026-01-02T20:42:12.438751"
    },
    {
      "doc_id": "local_party-lore_docs_FR-202-PRECEDENT-RESEARCH",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/FR-202-PRECEDENT-RESEARCH.md",
      "content": "# FR-202 Precedent System Research Results\n\n**Date**: 2025-12-23\n**Purpose**: Determine optimal precedent injection strategy for FR-202 Realm-Adaptive Mechanics System\n\n## Executive Summary\n\nTesting confirms that **precedent injection dramatically improves mechanical consistency** (0% ‚Üí 100% compliance in tests) with **minimal performance overhead** (~0.5-1.5s additional latency). The key finding is that **context-aware filtering** can reduce token usage by 85-90% while maintaining compliance.\n\n## Test Results\n\n### Test 1: Precedent Compliance (5 iterations each)\n\n| Condition | Damage Values | In Range (6-10) | Variance |\n|-----------|---------------|-----------------|----------|\n| Without Precedent | 3, 3, 3, 3, 4 | 0% | Low but wrong range |\n| With Precedent | 8, 8, 8, 8, 8 | 100% | Zero variance |\n\n**Key Finding**: Precedents work. When told \"Twin Daggers = 6-10 damage\", the LLM uses exactly that range.\n\n### Test 2: Token Count vs Response Time\n\n| Precedent Count | Tokens | Time (s) | Compliance |\n|-----------------|--------|----------|------------|\n| 0 (baseline) | 377 | 3.3 | PARTIAL |\n| 3 (relevant) | 483 | 3.2 | PARTIAL |\n| 10 (all) | 690 | 3.8 | PARTIAL |\n| 20 (all) | 943 | 3.1 | COMPLIANT |\n| 30 (all) | 1169 | 3.5 | COMPLIANT |\n\n**Key Finding**: Adding 800 tokens of precedents adds ~0-0.5s latency. Not significant.\n\n### Test 3: Context-Aware Filtering\n\n| Scenario | Tokens | Time (s) | Compliance | Token Savings |\n|----------|--------|----------|------------|---------------|\n| Combat + ALL precedents | 617 | 4.2 | COMPLIANT | - |\n| Combat + FILTERED (1 weapon) | 138 | 2.4 | COMPLIANT | 77% |\n| Social + ALL precedents | 622 | 3.1 | COMPLIANT | - |\n| Social + FILTERED (skills) | 172 | 2.8 | COMPLIANT | 72% |\n\n**Key Finding**: Filtering to relevant precedents reduces tokens by 70-90% with equal compliance.\n\n## Industry Best Practices (from Research)\n\nBased on [LLM context management research](https://swimm.io/learn/large-language-models/llm-context-windows-basics-examples-and-prompting-best-practices):\n\n1. **Context Bloat is Bad**: \"Simply filling the context window with as much information as possible is actually a bad practice. This creates context bloat, which can lead to worse performance.\"\n\n2. **Query-Aware Contextualization**: \"Tailoring the context window based on the query's requirements ensures that the context window size and contents are dynamically adjusted to fit the query's need for specificity and detail.\"\n\n3. **RAG Best Practice**: \"When a query arrives, RAG searches your knowledge base, retrieves just the top-matched chunks, and feeds only those to the LLM.\"\n\n4. **Karpathy on Context Engineering**: \"...delicate art and science of filling the context window with just the right information for the next step.\"\n\n## Recommended Architecture\n\n### Option A: Context-Aware Filtering (RECOMMENDED)\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    PrecedentFilterService                        ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Input:                                                          ‚îÇ\n‚îÇ    - Player Intent (weapon, ability, target)                    ‚îÇ\n‚îÇ    - Game Mode (COMBAT, SOCIAL, EXPLORATION, STEALTH)           ‚îÇ\n‚îÇ    - All Session Precedents (from database)                     ‚îÇ\n‚îÇ                                                                  ‚îÇ\n‚îÇ  Output:                                                         ‚îÇ\n‚îÇ    - Filtered precedents (5-10 max)                             ‚îÇ\n‚îÇ                                                                  ‚îÇ\n‚îÇ  Rules:                                                          ‚îÇ\n‚îÇ    1. COMBAT mode: Include precedents for:                      ‚îÇ\n‚îÇ       - Weapons mentioned in player actions                     ‚îÇ\n‚îÇ       - Abilities being used                                    ‚îÇ\n‚îÇ       - Active status effects on participants                   ‚îÇ\n‚îÇ       - Relevant item effects (potions, scrolls)                ‚îÇ\n‚îÇ                                                                  ‚îÇ\n‚îÇ    2. SOCIAL mode: Include precedents for:                      ‚îÇ\n‚îÇ       - Social skills (persuasion, intimidation, deception)     ‚îÇ\n‚îÇ       - NPC disposition precedents                              ‚îÇ\n‚îÇ       - Relevant item effects (charm items, bribes)             ‚îÇ\n‚îÇ                                                                  ‚îÇ\n‚îÇ    3. EXPLORATION mode: Include precedents for:                 ‚îÇ\n‚îÇ       - Exploration skills (perception, investigation)          ‚îÇ\n‚îÇ       - Tool usage precedents                                   ‚îÇ\n‚îÇ       - Item effects (torches, rope, lockpicks)                 ‚îÇ\n‚îÇ                                                                  ‚îÇ\n‚îÇ    4. Cap at 10 precedents maximum per request                  ‚îÇ\n‚îÇ    5. Prioritize most recently used precedents                  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Precedent Category Mapping\n\n```java\npublic enum PrecedentCategory {\n    WEAPON,      // Combat mode - weapons in use\n    ABILITY,     // Combat mode - abilities being activated\n    SPELL,       // Combat mode - spells being cast\n    EFFECT,      // Combat mode - active status effects\n    ITEM,        // Any mode - items being used\n    SKILL,       // Social/Exploration - skill checks\n    DISPOSITION  // Social mode - NPC dispositions\n}\n\npublic class PrecedentFilter {\n    public List<Precedent> filterByMode(GameMode mode, PlayerIntent intent,\n                                         List<Precedent> allPrecedents) {\n        List<Precedent> filtered = new ArrayList<>();\n\n        switch (mode) {\n            case COMBAT:\n                // Add weapon precedent for equipped weapon\n                filtered.addAll(findByKey(\"weapon:\" + intent.getWeaponName()));\n                // Add ability precedent if using ability\n                if (intent.getAbility() != null) {\n                    filtered.addAll(findByKey(\"ability:\" + intent.getAbilityName()));\n                }\n                // Add active effect precedents\n                for (StatusEffect effect : intent.getCharacter().getActiveEffects()) {\n                    filtered.addAll(findByKey(\"effect:\" + effect.getName()));\n                }\n                break;\n\n            case SOCIAL:\n                // Add social skill precedents\n                filtered.addAll(findByCategory(PrecedentCategory.SKILL));\n                filtered.addAll(findByCategory(PrecedentCategory.DISPOSITION));\n                break;\n\n            case EXPLORATION:\n                // Add exploration skill precedents\n                filtered.addAll(findByCategory(PrecedentCategory.SKILL));\n                filtered.addAll(findByCategory(PrecedentCategory.ITEM));\n                break;\n        }\n\n        // Cap at 10, prioritize most recently used\n        return filtered.stream()\n            .sorted(Comparator.comparing(Precedent::getLastUsedTurn).reversed())\n            .limit(10)\n            .collect(Collectors.toList());\n    }\n}\n```\n\n### Prompt Injection Strategy\n\n```\n## Established Mechanics (USE EXACT VALUES)\n\n[Only show precedents relevant to current action]\n\n- **weapon:twin_daggers**: {\"damageRange\": \"6-10\", \"special\": [\"bleeding on crit\"]}\n\nCRITICAL: You MUST use these exact damage ranges. Do not invent new values.\n```\n\n### Performance Budget\n\n| Component | Max Tokens | Time Budget |\n|-----------|------------|-------------|\n| Base prompt | ~500 | - |\n| Realm mechanicsGuidance | ~200 | - |\n| Filtered precedents (10 max) | ~400 | - |\n| Player capability profile | ~200 | - |\n| **Total injection** | **~800** | **< 1s overhead** |\n\n## Risks and Mitigations\n\n### Risk 1: Precedent Miss (relevant precedent not found)\n\n**Mitigation**:\n- Use fuzzy matching on weapon/ability names\n- Normalize names: \"Twin Daggers\" ‚Üí \"twin_daggers\"\n- Fall back to base item type: \"Longsword of Flames\" ‚Üí \"longsword\"\n\n### Risk 2: Precedent Explosion (too many precedents)\n\n**Mitigation**:\n- Hard cap at 50 precedents per session\n- Prune precedents not used in last 20 turns\n- Merge similar precedents (all \"longsword\" variants)\n\n### Risk 3: LLM Ignores Precedents\n\n**Mitigation** (tested and validated):\n- Use strong language: \"MUST use\", \"EXACT values\", \"CRITICAL\"\n- Place precedents close to output format (recency effect)\n- Include precedent values in output format example\n\n### Risk 4: Cross-Session Precedent Confusion\n\n**Mitigation**:\n- Precedents are scoped to `gameSessionId`\n- Different sessions can have different Twin Daggers damage\n- Consider realm-level default precedents for consistency\n\n## Implementation Recommendations\n\n### Phase 1 (FR-202 Scope)\n\n1. **Add `MECHANIC_PRECEDENT` FactType** - Store precedents as game state facts\n2. **Create `PrecedentFilterService`** - Context-aware filtering by game mode\n3. **Modify `TwoTierNarrativeService`** - Inject filtered precedents into Tier 1 prompt\n4. **Create `PrecedentExtractionService`** - Extract precedents from LLM output\n5. **Add capability profiles** - Store canDo/cannotDo in `GameCharacter`\n\n### Phase 2 (Future)\n\n1. **Precedent Analytics** - Track compliance rates, identify problematic patterns\n2. **Realm Default Precedents** - Pre-seed common weapons/abilities per realm\n3. **Admin Override** - DM can manually set/override precedents\n4. **Precedent Versioning** - Track when precedents were established/modified\n\n## Test Scripts Created\n\n- `scripts/test-precedent-injection.sh` - Token count vs timing tests\n- `scripts/test-precedent-compliance.sh` - Compliance rate measurement\n- `scripts/test-context-aware-filtering.sh` - Filtering effectiveness\n\n## Conclusion\n\n**Precedent injection is viable and effective.** The key optimizations are:\n\n1. **Filter by game mode** - 70-90% token reduction\n2. **Filter by scene relevance** - Only items/abilities in current action\n3. **Cap at 10 precedents** - Sufficient for any single action\n4. **Use strong prompt language** - \"MUST use exact values\"\n\nExpected benefits:\n- **100% mechanical consistency** for weapons/abilities with precedents\n- **< 1s latency overhead** for precedent injection\n- **No context window issues** with filtered approach\n\n---\n\n**Sources**:\n- [LLM Context Windows Best Practices](https://swimm.io/learn/large-language-models/llm-context-windows-basics-examples-and-prompting-best-practices)\n- [Context Engineering for AI Agents](https://weaviate.io/blog/context-engineering)\n- [LLM Context Management Guide](https://eval.16x.engineer/blog/llm-context-management-guide)\n- [Top Techniques to Manage Context Length](https://agenta.ai/blog/top-6-techniques-to-manage-context-length-in-llms)\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/FR-202-PRECEDENT-RESEARCH.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test",
        "usage"
      ],
      "content_hash": "b829c6abc78c563f",
      "size_bytes": 11194,
      "created_at": "2026-01-02T20:42:12.438803"
    },
    {
      "doc_id": "local_party-lore_docs_TIER-0_5-DESIGN-ANALYSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/TIER-0.5-DESIGN-ANALYSIS.md",
      "content": "# Tier 0.5 Pre-Processing Layer Design Analysis\n\n## Executive Summary\n\nTier 0.5 is a lightweight LLM pre-processing layer that generates **dynamic, context-aware prompt components** before Tier 1 (mechanics) and Tier 2 (narrative) run. Instead of hardcoding examples, templates, and guidance, we generate them fresh each turn based on the current game state, realm, and narrative context.\n\n## Current Pain Points That Tier 0.5 Could Address\n\n### 1. Closing Line Repetition (LOW_ACTION_DIVERSITY)\n- **Problem**: LLM keeps using same closing patterns (\"What will you do?\")\n- **Current Fix**: Hardcoded banned phrases + style rotation\n- **Tier 0.5 Solution**: Generate 8-12 realm-specific closing line examples per style, rotate through them\n\n### 2. Narrative Vocabulary Staleness\n- **Problem**: Same adjectives, verbs, and descriptions across turns\n- **Current Fix**: None (relies on LLM creativity)\n- **Tier 0.5 Solution**: Generate \"fresh vocabulary packs\" - 10-15 realm-appropriate verbs, adjectives, sensory details to inject into prompts\n\n### 3. NPC Dialogue Sameness\n- **Problem**: NPCs sound alike, use similar speech patterns\n- **Current Fix**: Personality descriptions in prompts\n- **Tier 0.5 Solution**: Generate specific speech mannerisms, catchphrases, vocabulary for each active NPC\n\n### 4. Pacing Guidance\n- **Problem**: Static pacing rules don't adapt to story rhythm\n- **Current Fix**: Generic \"give players wins\" guidance\n- **Tier 0.5 Solution**: Analyze recent turn history, generate specific pacing guidance (\"last 3 turns were tense - this turn should offer a breather\")\n\n### 5. Combat Action Variety\n- **Problem**: Combat descriptions become formulaic\n- **Current Fix**: None\n- **Tier 0.5 Solution**: Generate 6-8 realm-specific action descriptors for current combat context\n\n### 6. Scene Transition Smoothness\n- **Problem**: Transitions can feel abrupt or disconnected\n- **Current Fix**: \"Meanwhile...\" rules\n- **Tier 0.5 Solution**: Generate 3-4 transition phrases specific to the current scene and destination\n\n## Design Options\n\n### Option A: Per-Turn Full Generation\n**Every turn**, generate:\n- Closing line examples (4 styles √ó 3 examples = 12)\n- Fresh vocabulary pack (15 words)\n- Pacing guidance (1 paragraph)\n\n**Pros**: Maximum freshness, most variety\n**Cons**: Adds ~500ms latency per turn, costs ~1000 tokens/turn\n\n### Option B: Session-Start Generation + Turn Supplements\n**At session start**, generate large batches:\n- Closing line examples (4 styles √ó 8 examples = 32)\n- NPC speech patterns (per active NPC)\n- Realm vocabulary pack (50+ words)\n\n**Per turn**, generate lightweight:\n- Pacing guidance based on recent turns\n- \"This turn's focus\" (1-2 sentences)\n\n**Pros**: Lower per-turn cost, still fresh content\n**Cons**: Session-start content can get stale, requires storage\n\n### Option C: Tiered Caching with Rotation\n**At session start**: Generate 4-5 \"content packs\" for each category\n**Per turn**: Randomly select from packs, mark as used\n**When pack exhausted**: Regenerate that specific pack\n\n**Pros**: Best balance of freshness and efficiency\n**Cons**: More complex implementation\n\n### Option D: Lazy Generation with Smart Caching\n**On first use of each category**, generate content\n**Cache in memory** with TTL (e.g., 30 minutes or 20 turns)\n**Rotate through cached content**, regenerate when exhausted\n\n**Pros**: No upfront cost, generates only what's needed\n**Cons**: First turn of each type is slower\n\n## Recommended Approach: Option D (Lazy Generation with Smart Caching)\n\n### Why Option D?\n\n1. **Zero startup cost** - Game starts immediately\n2. **Pay-as-you-go** - Only generates what's actually used\n3. **Self-cleaning** - TTL prevents memory leaks\n4. **Rotation built-in** - Tracks usage to avoid repetition\n5. **Graceful degradation** - Falls back to hardcoded examples if LLM fails\n\n### Implementation Design\n\n```java\npublic class Tier05ContentGenerator {\n\n    // Cache structure: sessionId -> category -> ContentPack\n    private final Map<UUID, Map<ContentCategory, ContentPack>> contentCache;\n\n    public enum ContentCategory {\n        CLOSING_LINE_EXAMPLES,\n        VOCABULARY_PACK,\n        NPC_SPEECH_PATTERNS,\n        TRANSITION_PHRASES,\n        PACING_GUIDANCE\n    }\n\n    public static class ContentPack {\n        List<String> items;\n        Set<Integer> usedIndices;\n        Instant generatedAt;\n        int usageCount;\n    }\n\n    /**\n     * Get content for the specified category.\n     * Generates on first access, rotates through items, regenerates when exhausted.\n     */\n    public String getContent(UUID sessionId, ContentCategory category,\n                            String realmContext, String currentContext) {\n        ContentPack pack = getOrGenerate(sessionId, category, realmContext);\n        return selectUnused(pack);\n    }\n}\n```\n\n### Content Generation Prompts\n\n#### Closing Line Examples\n```\nGenerate 8 closing line examples for [STYLE] style in a [REALM] RPG.\nEach should be 10-20 words, matching the realm's tone.\nOutput only the 8 examples, numbered 1-8.\n```\n\n#### Vocabulary Pack\n```\nGenerate 15 fresh, evocative words for a [REALM] RPG:\n- 5 action verbs (for combat/movement)\n- 5 sensory adjectives (for descriptions)\n- 5 atmospheric nouns (for scene-setting)\nOutput as a simple list.\n```\n\n#### Pacing Guidance\n```\nAnalyze these recent turns:\n[TURN_SUMMARY]\n\nRecommend pacing for the next turn:\n- Tension level: (escalate/maintain/release)\n- Suggested tone: (urgent/thoughtful/dramatic/quiet)\n- One specific guidance: (e.g., \"Give the players a small win here\")\n```\n\n### Fallback Strategy\n\nIf LLM generation fails:\n1. Log the failure\n2. Return hardcoded fallback content (current examples)\n3. Mark category as \"fallback mode\" to retry later\n4. Continue game without disruption\n\n### Performance Budget\n\n- **Target latency**: <200ms for Tier 0.5\n- **Token budget**: ~200-300 tokens per generation\n- **Cache TTL**: 30 turns or 1 hour, whichever comes first\n- **Max cached packs per session**: 5 categories √ó 1 pack = 5 packs\n\n## What NOT to Put in Tier 0.5\n\n1. **Mechanics determination** - That's Tier 1's job\n2. **Narrative generation** - That's Tier 2's job\n3. **Validation** - That's post-processing\n4. **Player action parsing** - Already handled elsewhere\n5. **Complex reasoning** - Keep it lightweight\n\n## Migration Path\n\n### Phase 1: Closing Line Examples Only\n- Implement Tier 0.5 infrastructure\n- Migrate ClosingLineStyleRotator to use it\n- Verify no regression in quality\n\n### Phase 2: Add Vocabulary Packs\n- Generate realm-specific vocabulary\n- Inject into Tier 2 prompts\n- Measure impact on variety\n\n### Phase 3: Add Pacing Guidance\n- Analyze recent turn history\n- Generate contextual pacing advice\n- Integrate with Tier 2 header\n\n### Phase 4: NPC Speech Patterns\n- Generate per-NPC speech characteristics\n- Use in dialogue generation\n- Most complex, highest impact\n\n## Success Metrics\n\n1. **LOW_ACTION_DIVERSITY issues**: Reduce by 50%\n2. **Closing line variety**: No repeated patterns within 10 turns\n3. **Latency impact**: <200ms added per turn\n4. **Token cost**: <500 tokens per turn average\n\n## Recommendation\n\n**Start with Phase 1** (Closing Line Examples only). This is:\n- The immediate pain point you asked about\n- Low risk, high visibility\n- Good test of the architecture\n- Easy to measure success\n\nOnce Phase 1 is stable, Phase 2 and 3 can follow naturally.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/TIER-0.5-DESIGN-ANALYSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "example",
        "llm",
        "md"
      ],
      "content_hash": "f214552176c19fc3",
      "size_bytes": 7358,
      "created_at": "2026-01-02T20:42:12.438845"
    },
    {
      "doc_id": "local_party-lore_docs_archive_ARCHITECTURE-REFACTORING-PLAN",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/ARCHITECTURE-REFACTORING-PLAN.md",
      "content": "# Architecture Refactoring Plan: AI Monitoring & Testing Infrastructure\n\n**Date**: January 2025\n**Context**: TASK-156 (Console Testing) and TASK-163 (Autonomous Testing) implementation review\n**Goal**: Establish proper module boundaries for AI monitoring/testing to enable reuse across console, web app, and future modules\n\n---\n\n## üîç Current State Analysis\n\n### Critical Issues Identified\n\n#### 1. **DUPLICATE CLASSES** - Multiple Versions of Same Service\n\n| Class | AI Module | Game Module | Console Module | Issue |\n|-------|-----------|-------------|----------------|-------|\n| `NarrativeQualityAnalysisService` | ‚úÖ 17KB | ‚úÖ 16KB | ‚ùå | **2 versions**, different model dependencies |\n| `GameplayTranscriptService` | ‚úÖ | ‚úÖ | ‚ùå | **2 versions** |\n| `BasicAIPlayerService` | ‚ùå | ‚úÖ 12KB | ‚úÖ 5KB | **2 versions**, game version is authoritative |\n| `AutonomousTestingService` | ‚ùå | ‚úÖ 29KB | ‚úÖ 24KB | **2 versions**, different APIs |\n\n#### 2. **DUPLICATE MODELS** - Domain vs. Game Module Models\n\n| Model | Domain Module | Game Module | Problem |\n|-------|---------------|-------------|---------|\n| `GameplayTranscript` | ‚úÖ `domain.quality` | ‚úÖ `game.quality.model` | **2 versions** |\n| `IllogicalMoment` | ‚úÖ `domain.quality` | ‚úÖ `game.quality.model` | **2 versions** |\n| `NarrativeAnalysisResult` | ‚úÖ `domain.quality` | ‚ùå (uses game models) | Inconsistent |\n\n**Root Cause**: Game module created its own models instead of using domain module, causing fragmentation.\n\n#### 3. **WRONG MODULE PLACEMENT** - Services in Wrong Layers\n\n| Service | Current Location | Should Be In | Reason |\n|---------|------------------|--------------|--------|\n| `BasicAIPlayerService` | console, game | **game** (single version) | Core game logic, not console-specific |\n| `DecisionMakingEngine` | console | **game** | Core game logic |\n| `PersonalityProfileService` | console | **game** | Core game logic |\n| `AutonomousTestingService` (console version) | console | **Should be removed** | Duplicate, use game version |\n\n#### 4. **ARCHITECTURAL CONFUSION** - Unclear Module Boundaries\n\n**Current Module Dependency Graph** (‚ùå Indicates problems):\n```\nparty-lore-app (Spring Boot app)\n‚îú‚îÄ‚îÄ party-lore-web ‚ùå Can't access game/quality services\n‚îú‚îÄ‚îÄ party-lore-console ‚ùå Has duplicates of game services\n‚îú‚îÄ‚îÄ party-lore-game ‚úÖ Has services but uses wrong models\n‚îú‚îÄ‚îÄ party-lore-ai ‚úÖ Has services using domain models\n‚îú‚îÄ‚îÄ party-lore-domain ‚úÖ Has models but incomplete\n‚îî‚îÄ‚îÄ party-lore-sms, memory, etc.\n```\n\n---\n\n## üéØ Desired Architecture\n\n### Principle: **Layered Architecture with Clear Boundaries**\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  PRESENTATION LAYER (Consumer Modules)                  ‚îÇ\n‚îÇ  - party-lore-app (REST API, Spring Boot)              ‚îÇ\n‚îÇ  - party-lore-web (Web controllers)                    ‚îÇ\n‚îÇ  - party-lore-console (CLI interface)                  ‚îÇ\n‚îÇ  ‚Üí Depend on: game, ai, domain                         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                        ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  BUSINESS LOGIC LAYER (Service Modules)                ‚îÇ\n‚îÇ                                                         ‚îÇ\n‚îÇ  party-lore-game (Game Mechanics & Testing)            ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ service/        - AI players, decision engine     ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ testing/        - Autonomous testing              ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ quality/        - Quality monitoring              ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ muca/           - MUCA integration                ‚îÇ\n‚îÇ  ‚Üí Depends on: ai, domain                              ‚îÇ\n‚îÇ                                                         ‚îÇ\n‚îÇ  party-lore-ai (AI Services)                           ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ narrative/      - Narrative generation            ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ quality/        - Quality analysis (shared)       ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ testing/        - AI testing framework            ‚îÇ\n‚îÇ  ‚Üí Depends on: domain only                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                        ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  DATA LAYER (Domain Module)                            ‚îÇ\n‚îÇ  - party-lore-domain (Entities, Repositories, DTOs)    ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ model/          - JPA entities                    ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ repository/     - Data access                     ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ quality/        - Quality models (DTOs)           ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ testing/        - Testing models                  ‚îÇ\n‚îÇ  ‚Üí Depends on: nothing (pure domain)                   ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n---\n\n## üìã Refactoring Plan\n\n### Phase 1: **Consolidate Models** (HIGH PRIORITY)\n\n**Goal**: Single source of truth for all quality/testing models in domain module\n\n#### 1.1 Verify Domain Models are Complete\n- ‚úÖ `domain.quality.GameplayTranscript` - EXISTS\n- ‚úÖ `domain.quality.IllogicalMoment` - EXISTS\n- ‚úÖ `domain.quality.NarrativeAnalysisResult` - EXISTS\n- ‚ö†Ô∏è `domain.quality.NarrativeQualityMetrics` - EXISTS but may need review\n\n**Action**: Review domain models for completeness\n\n#### 1.2 Remove Duplicate Models from Game Module\n**DELETE** (after migrating all usages):\n- ‚ùå `game.quality.model.GameplayTranscript`\n- ‚ùå `game.quality.model.IllogicalMoment`\n- ‚ùå `game.quality.model.NarrativeAnalysisResult` (if exists)\n- ‚ùå Entire `party-lore-game/src/main/java/com/partylore/game/quality/model/` package\n\n**Migration Strategy**:\n1. Find all imports of `game.quality.model.*`\n2. Replace with `domain.quality.*`\n3. Verify compilation\n4. Delete duplicate models\n\n#### 1.3 Update Game Module Services to Use Domain Models\n**Files to Update**:\n- `game.quality.NarrativeQualityAnalysisService`\n  - Change imports from `game.quality.model.*` ‚Üí `domain.quality.*`\n  - Update return types and parameters\n\n- `game.quality.GameplayTranscriptService`\n  - Change imports from `game.quality.model.*` ‚Üí `domain.quality.*`\n  - Update return types\n\n### Phase 2: **Consolidate Services** (HIGH PRIORITY)\n\n**Goal**: Single authoritative version of each service, properly located\n\n#### 2.1 NarrativeQualityAnalysisService - Keep in AI Module\n**Decision**: AI module version is authoritative (uses domain models correctly)\n\n**Actions**:\n1. **KEEP**: `ai.quality.NarrativeQualityAnalysisService`\n   - Already uses `domain.quality.*` models ‚úÖ\n   - Properly located in AI module ‚úÖ\n\n2. **DELETE**: `game.quality.NarrativeQualityAnalysisService`\n   - Update all game module imports to use `ai.quality.NarrativeQualityAnalysisService`\n   - This is shared across console, web, app modules via ai module\n\n3. **UPDATE** Game module dependencies:\n   - Ensure `game.testing.AutonomousTestingService` imports from `ai.quality`\n   - Update console module to import from `ai.quality`\n\n#### 2.2 GameplayTranscriptService - Keep in AI Module\n**Decision**: AI module version is authoritative\n\n**Actions**:\n1. **KEEP**: `ai.quality.GameplayTranscriptService`\n2. **DELETE**: `game.quality.GameplayTranscriptService`\n3. **UPDATE** all imports to `ai.quality.GameplayTranscriptService`\n\n#### 2.3 BasicAIPlayerService - Keep in Game Module\n**Decision**: Game module version is authoritative (12KB vs 5KB, more complete)\n\n**Actions**:\n1. **KEEP**: `game.service.BasicAIPlayerService`\n   - More complete implementation with full player lifecycle\n   - Properly depends on game entities\n\n2. **DELETE**: `console.ai.BasicAIPlayerService`\n   - Console module should import from game module\n\n3. **MOVE** related services to game module:\n   - `console.ai.DecisionMakingEngine` ‚Üí `game.service.DecisionMakingEngine` (if not already there)\n   - `console.ai.PersonalityProfileService` ‚Üí `game.service.PersonalityProfileService` (if not already there)\n\n#### 2.4 AutonomousTestingService - Keep Game Module Version\n**Decision**: Game module version is authoritative (29KB vs 24KB, database-backed)\n\n**Actions**:\n1. **KEEP**: `game.testing.AutonomousTestingService`\n   - Full database integration\n   - Complete test suite orchestration\n   - Integration with GameService\n\n2. **DELETE**: `console.autonomous.AutonomousTestingService`\n   - Console should import from game module\n\n3. **UPDATE** Console Application:\n   - `PartyLoreConsole.java` imports from `game.testing.AutonomousTestingService`\n   - May need adapter/wrapper if APIs differ significantly\n\n### Phase 3: **Fix Module Dependencies** (MEDIUM PRIORITY)\n\n#### 3.1 Update Console Module Dependencies\n\n**pom.xml changes**:\n```xml\n<dependencies>\n    <!-- Remove duplicates, add proper dependencies -->\n    <dependency>\n        <groupId>com.partylore</groupId>\n        <artifactId>party-lore-game</artifactId>\n        <version>${project.version}</version>\n    </dependency>\n    <dependency>\n        <groupId>com.partylore</groupId>\n        <artifactId>party-lore-ai</artifactId>\n        <version>${project.version}</version>\n    </dependency>\n    <!-- Already has domain -->\n</dependencies>\n```\n\n**Remove console packages**:\n- ‚ùå Delete `console/ai/` package (use game module)\n- ‚ùå Delete `console/autonomous/AutonomousTestingService` (use game module)\n- ‚úÖ Keep `console/channel/` (console-specific)\n- ‚úÖ Keep `console/debug/` (console UI layer for game services)\n- ‚úÖ Keep `console/config/` (console-specific)\n\n#### 3.2 Update App Module for Web Access\n\n**Goal**: Enable web app to use same quality monitoring\n\n**pom.xml - Ensure dependencies**:\n```xml\n<dependency>\n    <groupId>com.partylore</groupId>\n    <artifactId>party-lore-ai</artifactId>\n    <!-- For quality analysis -->\n</dependency>\n<dependency>\n    <groupId>com.partylore</groupId>\n    <artifactId>party-lore-game</artifactId>\n    <!-- For testing infrastructure -->\n</dependency>\n```\n\n**New Service in App Module**:\n```java\n// party-lore-app/src/main/java/com/partylore/app/service/\n@Service\npublic class GameplayQualityService {\n    @Autowired\n    private NarrativeQualityAnalysisService qualityAnalysis; // from ai module\n\n    @Autowired\n    private GameplayTranscriptService transcriptService; // from ai module\n\n    // Web-accessible methods for quality monitoring\n    public NarrativeAnalysisResult analyzeSession(UUID sessionId) { ... }\n    public List<IllogicalMoment> getRecentIssues(UUID sessionId) { ... }\n}\n```\n\n### Phase 4: **Create Unified Testing API** (MEDIUM PRIORITY)\n\n**Goal**: Consistent API for testing across console, web, and future modules\n\n#### 4.1 Create Testing Facade in Game Module\n\n**New class**: `game.testing.TestingOrchestrator`\n```java\n@Service\npublic class TestingOrchestrator {\n    @Autowired\n    private AutonomousTestingService autonomousTestingService;\n\n    @Autowired\n    private AdvancedAITestAgentService aiTestAgentService;\n\n    // Unified API for all consumers\n    public TestRunResult runQuickTest(UUID sessionId, TestConfig config) { ... }\n    public TestRunResult runFullSuite(TestSuiteConfig config) { ... }\n    public List<TestIssue> getSessionIssues(UUID sessionId) { ... }\n}\n```\n\n#### 4.2 Update Console to Use Facade\n\n**Simplify** `PartyLoreConsole.java`:\n```java\n@Autowired\nprivate TestingOrchestrator testingOrchestrator; // instead of direct service\n\npublic void runAutonomousMode() {\n    TestConfig config = buildTestConfig();\n    TestRunResult result = testingOrchestrator.runQuickTest(sessionId, config);\n    displayResults(result);\n}\n```\n\n### Phase 5: **Enable Web App Quality Monitoring** (LOW PRIORITY - Future)\n\n**Goal**: Real-time quality monitoring in web interface\n\n#### 5.1 Create REST Endpoints\n\n**New controller**: `app/web/QualityMonitoringController`\n```java\n@RestController\n@RequestMapping(\"/api/quality\")\npublic class QualityMonitoringController {\n    @Autowired\n    private GameplayQualityService qualityService;\n\n    @GetMapping(\"/sessions/{sessionId}/analysis\")\n    public NarrativeAnalysisResult analyzeSession(@PathVariable UUID sessionId) {\n        return qualityService.analyzeSession(sessionId);\n    }\n\n    @GetMapping(\"/sessions/{sessionId}/issues\")\n    public List<IllogicalMoment> getIssues(@PathVariable UUID sessionId) {\n        return qualityService.getRecentIssues(sessionId);\n    }\n}\n```\n\n#### 5.2 Create WebSocket for Real-Time Monitoring\n\n**New service**: `app/web/RealTimeQualityMonitor`\n```java\n@Component\npublic class RealTimeQualityMonitor {\n    @Autowired\n    private SimpMessagingTemplate messagingTemplate;\n\n    @Autowired\n    private NarrativeQualityAnalysisService qualityAnalysis;\n\n    public void monitorSession(UUID sessionId) {\n        // Periodic analysis, push via WebSocket\n        NarrativeAnalysisResult result = qualityAnalysis.analyze(...);\n        messagingTemplate.convertAndSend(\"/topic/quality/\" + sessionId, result);\n    }\n}\n```\n\n---\n\n## üìä Impact Analysis\n\n### Benefits of Refactoring\n\n1. **Code Reuse**:\n   - ~2,000 lines of duplicate code removed\n   - Single quality monitoring engine used by console, web, app\n\n2. **Maintainability**:\n   - One place to fix bugs (not 2-3 places)\n   - Clear module boundaries\n   - Easier to test\n\n3. **Flexibility**:\n   - Web app can easily add quality monitoring dashboard\n   - Future mobile app can use same services\n   - Testing infrastructure available everywhere\n\n4. **Performance**:\n   - No duplicate service instances\n   - Shared cache/state management\n   - Better memory usage\n\n### Risks & Mitigation\n\n| Risk | Mitigation |\n|------|------------|\n| Breaking console functionality | Incremental migration, test after each phase |\n| API incompatibilities | Create adapter classes if needed |\n| Build complexity | Update pom.xml dependencies carefully |\n| Test coverage gaps | Run full test suite after each phase |\n\n---\n\n## üéØ Execution Strategy\n\n### Recommended Order\n\n1. **Phase 1: Models** (1 day)\n   - Low risk, high impact\n   - Enables all other phases\n   - Verify domain models complete\n\n2. **Phase 2: Services** (2 days)\n   - Medium risk, high impact\n   - Consolidate duplicates\n   - Update imports across modules\n\n3. **Phase 3: Dependencies** (1 day)\n   - Medium risk, medium impact\n   - Clean up console module\n   - Verify compilation\n\n4. **Phase 4: Testing API** (1 day)\n   - Low risk, high value\n   - Create unified interface\n   - Simplify console code\n\n5. **Phase 5: Web Integration** (Future)\n   - Low risk, new feature\n   - Not blocking anything\n   - Can be done anytime\n\n### Testing Checklist per Phase\n\nAfter each phase:\n- [ ] `mvn clean compile` - All modules compile\n- [ ] `mvn test` - All tests pass\n- [ ] Console app runs: `mvn spring-boot:run -pl party-lore-console`\n- [ ] App runs: `mvn spring-boot:run -pl party-lore-app`\n- [ ] Autonomous testing works: `/autonomous` command in console\n- [ ] Quality analysis works: `/analyze` command in console\n\n---\n\n## üìù Final Module Structure (After Refactoring)\n\n```\nparty-lore/\n‚îú‚îÄ‚îÄ party-lore-domain/\n‚îÇ   ‚îî‚îÄ‚îÄ com.partylore.domain/\n‚îÇ       ‚îú‚îÄ‚îÄ model/                 - JPA entities\n‚îÇ       ‚îú‚îÄ‚îÄ repository/            - Data access\n‚îÇ       ‚îú‚îÄ‚îÄ quality/               - Quality DTOs (SINGLE SOURCE OF TRUTH)\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ GameplayTranscript\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ IllogicalMoment\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ NarrativeAnalysisResult\n‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ NarrativeQualityMetrics\n‚îÇ       ‚îî‚îÄ‚îÄ testing/               - Testing DTOs\n‚îÇ           ‚îú‚îÄ‚îÄ AutonomousTestRun\n‚îÇ           ‚îú‚îÄ‚îÄ TestScenario\n‚îÇ           ‚îî‚îÄ‚îÄ TestIssue\n‚îÇ\n‚îú‚îÄ‚îÄ party-lore-ai/\n‚îÇ   ‚îî‚îÄ‚îÄ com.partylore.ai/\n‚îÇ       ‚îú‚îÄ‚îÄ quality/               - Quality analysis (AUTHORITATIVE)\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ NarrativeQualityAnalysisService ‚úÖ Keep (uses domain models)\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ GameplayTranscriptService ‚úÖ Keep\n‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ SessionQualityMonitoringService ‚úÖ Keep\n‚îÇ       ‚îî‚îÄ‚îÄ testing/\n‚îÇ           ‚îî‚îÄ‚îÄ AISystemTestingFramework\n‚îÇ\n‚îú‚îÄ‚îÄ party-lore-game/\n‚îÇ   ‚îî‚îÄ‚îÄ com.partylore.game/\n‚îÇ       ‚îú‚îÄ‚îÄ service/               - Game services (AUTHORITATIVE)\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ BasicAIPlayerService ‚úÖ Keep (single version)\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ DecisionMakingEngine ‚úÖ Keep/Move from console\n‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ PersonalityProfileService ‚úÖ Keep/Move from console\n‚îÇ       ‚îú‚îÄ‚îÄ testing/               - Testing infrastructure (AUTHORITATIVE)\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ AutonomousTestingService ‚úÖ Keep (database-backed)\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ AdvancedAITestAgentService ‚úÖ Keep\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ TestScenarioGenerator ‚úÖ Keep\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ AutoFixService ‚úÖ Keep\n‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ TestingOrchestrator ‚≠ê NEW (unified API)\n‚îÇ       ‚îî‚îÄ‚îÄ quality/               - REMOVE game.quality.model package\n‚îÇ           ‚îî‚îÄ‚îÄ (services use ai.quality instead)\n‚îÇ\n‚îú‚îÄ‚îÄ party-lore-console/\n‚îÇ   ‚îî‚îÄ‚îÄ com.partylore.console/\n‚îÇ       ‚îú‚îÄ‚îÄ PartyLoreConsole       - Main console app\n‚îÇ       ‚îú‚îÄ‚îÄ channel/               - Console-specific UI\n‚îÇ       ‚îú‚îÄ‚îÄ debug/                 - Console debug UI (wraps ai/game services)\n‚îÇ       ‚îú‚îÄ‚îÄ config/                - Console configuration\n‚îÇ       ‚îú‚îÄ‚îÄ ai/                    ‚ùå DELETE (use game module)\n‚îÇ       ‚îî‚îÄ‚îÄ autonomous/            ‚ùå DELETE AutonomousTestingService (use game)\n‚îÇ\n‚îú‚îÄ‚îÄ party-lore-app/\n‚îÇ   ‚îî‚îÄ‚îÄ com.partylore.app/\n‚îÇ       ‚îú‚îÄ‚îÄ service/\n‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ GameplayQualityService ‚≠ê NEW (web facade for ai.quality)\n‚îÇ       ‚îî‚îÄ‚îÄ web/                   ‚≠ê FUTURE\n‚îÇ           ‚îú‚îÄ‚îÄ QualityMonitoringController\n‚îÇ           ‚îî‚îÄ‚îÄ RealTimeQualityMonitor\n‚îÇ\n‚îî‚îÄ‚îÄ party-lore-web/\n    ‚îî‚îÄ‚îÄ (future REST controllers for web UI)\n```\n\n---\n\n## üîÑ Migration Script Template\n\nFor each duplicate class to remove:\n\n```bash\n#!/bin/bash\n# Example: Migrate NarrativeQualityAnalysisService\n\necho \"Step 1: Find all usages of game.quality.NarrativeQualityAnalysisService\"\ngrep -r \"import com.partylore.game.quality.NarrativeQualityAnalysisService\" .\n\necho \"Step 2: Replace with ai.quality.NarrativeQualityAnalysisService\"\nfind . -name \"*.java\" -exec sed -i 's/import com.partylore.game.quality.NarrativeQualityAnalysisService/import com.partylore.ai.quality.NarrativeQualityAnalysisService/g' {} +\n\necho \"Step 3: Find model import issues\"\ngrep -r \"import com.partylore.game.quality.model\" .\n\necho \"Step 4: Replace model imports\"\nfind . -name \"*.java\" -exec sed -i 's/import com.partylore.game.quality.model/import com.partylore.domain.quality/g' {} +\n\necho \"Step 5: Compile and test\"\nmvn clean compile\nmvn test\n\necho \"Step 6: Delete duplicate (only after successful compilation)\"\n# rm party-lore-game/src/main/java/com/partylore/game/quality/NarrativeQualityAnalysisService.java\n```\n\n---\n\n## ‚úÖ Success Criteria\n\nRefactoring is complete when:\n\n1. ‚úÖ **Zero duplicate classes** across modules\n2. ‚úÖ **Domain models** are single source of truth\n3. ‚úÖ **AI module** provides quality analysis (used by all)\n4. ‚úÖ **Game module** provides testing infrastructure (used by all)\n5. ‚úÖ **Console** uses services from ai/game modules\n6. ‚úÖ **All tests pass** (79+ tests)\n7. ‚úÖ **Console app runs** with autonomous testing\n8. ‚úÖ **App module** can access quality monitoring\n9. ‚úÖ **Clear documentation** of which module owns what\n\n---\n\n**Next Step**: Review this plan, get approval, then execute Phase 1 (Models consolidation).\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/ARCHITECTURE-REFACTORING-PLAN.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "md",
        "test"
      ],
      "content_hash": "600bb2d6df2024be",
      "size_bytes": 20186,
      "created_at": "2026-01-02T20:42:12.439071"
    },
    {
      "doc_id": "local_party-lore_docs_archive_QUEUE_INTEGRATION",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/QUEUE_INTEGRATION.md",
      "content": "# Queue Integration - Implementation Complete\n\n## Overview\n\nThe queue infrastructure (TASK-256-265) has been successfully integrated with the existing narrative-focused GameServiceImpl. This provides sequential message processing for gameplay while maintaining the narrative-first approach.\n\n## Architecture\n\n### Message Flow\n\n**Before Queue Integration:**\n```\nSMS Webhook ‚Üí MessageRouter ‚Üí PlayerActionEvent\n  ‚Üí GameplayMessageListener ‚Üí GameServiceImpl (direct call)\n```\n\n**After Queue Integration:**\n```\nSMS Webhook ‚Üí MessageRouter ‚Üí PlayerActionEvent\n  ‚Üí GameplayMessageListener ‚Üí QueueOrchestrator (enqueue)\n  ‚Üí GameSessionWorker (sequential pull from queue)\n  ‚Üí GameServiceLoopProcessor ‚Üí GameServiceImpl\n```\n\n### Key Components\n\n1. **GameServiceLoopProcessor** (`party-lore-game/src/main/java/com/partylore/game/queue/GameServiceLoopProcessor.java`)\n   - Implements `GameLoopProcessor` interface\n   - Bridges queue workers with GameServiceImpl\n   - Extracts player actions from `QueuedMessage` and delegates to GameService\n   - No Intent Parser needed - natural language processed directly\n\n2. **GameplayMessageListener** (`party-lore-app/src/main/java/com/partylore/app/gameplay/GameplayMessageListener.java`)\n   - Changed from direct GameService calls to queue-based enqueuing\n   - Creates `QueuedMessage` from `PlayerActionEvent`\n   - Enqueues to `QueueOrchestrator` for sequential processing\n   - Stores actionSource in metadata for processor extraction\n\n3. **QueueOrchestrator** (`party-lore-domain/src/main/java/com/partylore/domain/service/queue/QueueOrchestrator.java`)\n   - Injects `GameLoopProcessor` into `GameSessionWorker` instances\n   - Falls back to `StubGameLoopProcessor` if processor unavailable (testing)\n   - Creates workers on-demand when messages arrive\n\n## Configuration\n\nQueue integration can be controlled via configuration:\n\n```yaml\nqueue:\n  integration:\n    enabled: true  # Default: true in production, false in integration tests\n```\n\n### Test Configuration\n\nIn `application-integration-test.yml`, queue integration is disabled to allow simpler testing of onboarding flows that don't involve gameplay:\n\n```yaml\nqueue:\n  integration:\n    enabled: false  # Onboarding tests don't need queue processing\n```\n\n## Benefits\n\n1. **Sequential Processing** - Messages processed one at a time per game session\n   - Eliminates race conditions from concurrent player actions\n   - Ensures proper turn order in combat\n\n2. **Scalability** - Clean migration path to distributed deployment\n   - Queue abstraction via `QueueProvider` interface\n   - `InMemoryQueueProvider` for single-server deployment\n   - Ready for `KafkaQueueProvider` implementation\n\n3. **Multi-Game Support** - Players can participate in multiple games simultaneously\n   - Each game session has its own queue and worker\n   - Workers created on-demand, shut down after idle timeout\n\n4. **Narrative-First Gameplay Preserved** - No structured action parsing\n   - Natural language actions processed directly by Claude AI\n   - Intent Parser system (TASK-266-275) was abandoned\n   - GameServiceImpl remains unchanged\n\n## Scope\n\n### What Uses Queue Integration\n\n‚úÖ **In-Game Gameplay Messages** - After game starts (GameSessionStatus.ACTIVE)\n- Player actions in active games\n- AI player actions (future)\n- MUCA voting responses (future)\n\n### What Does NOT Use Queue Integration\n\n‚ùå **Onboarding & Conversation Flows**\n- Player onboarding (WELCOME flow)\n- Game creation (GAME_CREATION flow)\n- Invitation acceptance (INVITATION flow)\n- System commands (GAMES, SWITCH, etc.)\n\nThese flows use `ConversationFlowOrchestrator` directly and bypass the queue system.\n\n## Testing Strategy\n\n### Integration Testing\n\nFor full end-to-end testing of queue integration:\n\n1. Create a game session with `GameSessionStatus.ACTIVE`\n2. Publish `PlayerActionEvent` for in-game action\n3. Verify message is enqueued in `queued_messages` table\n4. Verify `GameSessionWorker` picks up message\n5. Verify `GameServiceLoopProcessor` calls `GameServiceImpl`\n6. Verify narrative response is generated and delivered\n\n### Unit Testing\n\nQueue infrastructure components have comprehensive unit tests:\n- `QueuedMessageTest` - Entity validation\n- `QueueOrchestratorTest` - Worker management\n- `GameSessionWorkerTest` - Message processing loop\n- `PlayerQueueWorkerTest` - Player-specific queues\n\n## Implementation Notes\n\n### Intent Parser Decision\n\nThe Intent Parser system (TASK-266-275) was **intentionally abandoned** because:\n\n1. Party Lore is a **narrative-first game** (like AI Dungeon), not mechanics-first (like D&D)\n2. Intent Parser would **limit player expression** to predefined action types\n3. Natural language processing by Claude AI provides **more creative freedom**\n4. No benefit to structured parsing for narrative-focused gameplay\n\nSee `.specify/tasks/phase-0/index.md` for full architectural decision documentation.\n\n### Future Enhancements\n\nWhen implementing distributed deployment with Kafka:\n\n1. Implement `KafkaQueueProvider`\n2. Update configuration to use Kafka instead of InMemory\n3. No code changes needed in GameServiceLoopProcessor or GameplayMessageListener\n4. Queue abstraction handles the migration transparently\n\n## Files Modified\n\n| File | Change |\n|------|--------|\n| `GameServiceLoopProcessor.java` | NEW - Processor implementation bridging queue ‚Üí GameService |\n| `GameplayMessageListener.java` | MODIFIED - Enqueues to QueueOrchestrator instead of direct call |\n| `QueueOrchestrator.java` | MODIFIED - Injects GameLoopProcessor into workers |\n| `application-integration-test.yml` | MODIFIED - Disable queue for integration tests |\n| `.specify/tasks/phase-0/index.md` | MODIFIED - Document Intent Parser abandonment |\n\n## Build Status\n\n‚úÖ **All modules compile successfully**\n‚úÖ **Queue infrastructure complete (TASK-256-265)**\n‚úÖ **Queue integration complete**\n‚è≥ **Full integration test** - Deferred (complex test setup with Realm entity)\n\n---\n\n**Status**: Complete and ready for production use\n**Date**: January 2025\n**Decision**: Narrative-first approach with queue-based scalability\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/QUEUE_INTEGRATION.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "68d89dbb40e94bbb",
      "size_bytes": 6096,
      "created_at": "2026-01-02T20:42:12.439127"
    },
    {
      "doc_id": "local_party-lore_docs_archive_ACTION-BATCHING-TESTING",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/ACTION-BATCHING-TESTING.md",
      "content": "# Action Batching - Manual Testing Procedures\n\n## Overview\n\nTesting the critical bug fix for action batching timeout processing.\n\n**Bug Fixed**: When action batch timed out (after 120s), callback was never invoked, so batched actions were never processed.\n\n**Fix**: Register callback in GameServiceImpl.java:214-224 that re-triggers processing when timeout occurs.\n\n---\n\n## Test 1: Basic Action Batching with Timeout\n\n### Setup\n- 2+ players in same game session\n- MAJOR scene (120 second timeout)\n\n### Steps\n1. Player 1 sends action: \"look around\"\n2. Verify player receives: \"‚úì Got it! Waiting for other players to respond (up to 120 seconds)...\"\n3. Wait 120 seconds (or use `!nowait` to skip)\n4. **EXPECTED**: Narrative response is generated and sent after 120s\n5. **CHECK LOGS** for:\n   ```\n   \"Action batched for scene X, waiting for more players\"\n   \"Batch timeout callback triggered for scene X\"  ‚Üê NEW LOG\n   \"Processing player action...\"                    ‚Üê Re-triggered\n   \"Processing batch of 1 actions for scene X\"\n   ```\n\n### Success Criteria\n- ‚úÖ Player receives narrative after 120s timeout\n- ‚úÖ Logs show \"Batch timeout callback triggered\"\n- ‚úÖ Logs show processing was re-triggered\n\n### Failure Indicators\n- ‚ùå No response after 120s (batch stuck forever)\n- ‚ùå Log shows \"NO PROCESSING CALLBACK registered\" warning\n- ‚ùå No \"Batch timeout callback triggered\" log\n\n---\n\n## Test 2: !nowait Command\n\n### Setup\n- 2+ players in same game session\n- Any scene type\n\n### Steps\n1. Player 1 sends action: \"examine door\"\n2. Verify immediate ack received\n3. Player 1 sends: `!nowait`\n4. **EXPECTED**: Immediate narrative response (bypasses wait period)\n5. **CHECK LOGS** for:\n   ```\n   \"!nowait command: Force-processing action batch\"\n   \"Batch timeout callback triggered\"\n   \"Processing batch of 1 actions\"\n   ```\n\n### Success Criteria\n- ‚úÖ Narrative generated immediately after !nowait\n- ‚úÖ No 120-second wait\n- ‚úÖ Command is hidden from !help output\n\n### Failure Indicators\n- ‚ùå \"Unknown command: !nowait\"\n- ‚ùå !nowait shows in !help output\n- ‚ùå Still waits full timeout period\n\n---\n\n## Test 3: !cleanup Command (Beta Mode)\n\n### Setup\n- Beta mode enabled: `partylore.beta.enabled=true`\n- Player in any state (even stuck/corrupted)\n\n### Steps\n1. Player sends: `!cleanup`\n2. **EXPECTED**: Response showing records deleted\n3. Player sends: `HELLO`\n4. **EXPECTED**: Fresh onboarding flow starts\n\n### Success Criteria\n- ‚úÖ Cleanup message shows counts of deleted records\n- ‚úÖ Player can re-register from scratch\n- ‚úÖ Command is hidden from !help output\n- ‚úÖ **WARNING** logged every time command is used\n\n### Failure Indicators\n- ‚ùå \"Command not available\" (beta mode not enabled)\n- ‚ùå !cleanup shows in !help output\n- ‚ùå Player still stuck after cleanup\n\n### Beta Mode Disabled Test\n1. Set `partylore.beta.enabled=false` in Railway\n2. Player sends: `!cleanup`\n3. **EXPECTED**: \"Command not available.\"\n\n---\n\n## Test 4: !players Alias\n\n### Setup\n- Player in active game\n\n### Steps\n1. Player sends: `!players`\n2. **EXPECTED**: Same output as `!party` command\n3. Try both: `!party` and `!players`\n4. **EXPECTED**: Identical responses\n\n### Success Criteria\n- ‚úÖ !players works identically to !party\n- ‚úÖ Shows all party members\n\n### Failure Indicators\n- ‚ùå \"Unknown command: !players\"\n- ‚ùå Different output between !party and !players\n\n---\n\n## Test 5: Early Completion (All Players Act)\n\n### Setup\n- 2 players in MAJOR scene\n\n### Steps\n1. Player 1 sends action: \"look around\"\n2. Verify immediate ack\n3. Player 2 sends action: \"examine door\"\n4. **EXPECTED**: Immediate processing (both players acted)\n5. **CHECK LOGS** for:\n   ```\n   \"Processing batch of 2 actions for scene X\"\n   ```\n\n### Success Criteria\n- ‚úÖ Processing happens immediately when both act\n- ‚úÖ No waiting period needed\n- ‚úÖ Both actions included in narrative\n\n---\n\n## Test 6: Database Cleanup Runner (Environment Variable)\n\n### Setup\n- Railway environment variables\n\n### Steps\n1. **DO NOT SET** `CLEANUP_PHONE_NUMBER` env var\n2. Deploy app\n3. **CHECK LOGS** on startup:\n   ```\n   \"CLEANUP_PHONE_NUMBER environment variable not set - skipping cleanup\"\n   ```\n4. Set `CLEANUP_PHONE_NUMBER=+15555555555`\n5. Set `partylore.cleanup.enabled=true`\n6. Deploy app\n7. **CHECK LOGS** for:\n   ```\n   \"Cleaning up test phone number: +15555555555\"\n   \"Deleted X conversation_states\"\n   ```\n\n### Success Criteria\n- ‚úÖ Without env var: No cleanup runs\n- ‚úÖ With env var: Cleanup runs for that number only\n- ‚úÖ No hardcoded phone numbers in code\n\n---\n\n## Production Validation Checklist\n\nAfter deployment to Railway:\n\n- [ ] Check startup logs - no errors\n- [ ] Verify `partylore.beta.enabled=true` is set\n- [ ] Test action batching with real players\n- [ ] Monitor logs for \"Batch timeout callback triggered\"\n- [ ] Test !nowait command\n- [ ] Test !cleanup command\n- [ ] Test !players alias\n- [ ] Verify no hardcoded phone cleanup on startup\n\n---\n\n## Log Patterns to Monitor\n\n### Good Patterns (Success)\n```\nAction batched for scene X, waiting for more players\nBatch timeout callback triggered for scene X\nProcessing player action...\nProcessing batch of N actions\n```\n\n### Bad Patterns (Failure)\n```\nNO PROCESSING CALLBACK registered for batch X\nAction batch timeout reached... [nothing after]\n```\n\n### Expected Warnings\n```\n!cleanup command executed by ... - REMOVING ALL DATA\n```\n\n---\n\n## Rollback Plan\n\nIf action batching fails in production:\n\n1. **Immediate**: Players can use `!nowait` to force processing\n2. **Short-term**: Disable action batching:\n   ```\n   Set actionBatchCoordinator = null in GameServiceImpl\n   ```\n3. **Long-term**: Revert commit and redeploy\n\n---\n\n## Success Metrics\n\n- **100% batch timeout processing** - No stuck batches\n- **<5 second latency** for !nowait command\n- **Zero unintended phone cleanups** on startup\n- **All !players requests** resolve successfully\n\n---\n\n**Testing Status**: Ready for production deployment\n**Risk Level**: Medium (core gameplay mechanics)\n**Recommended**: Deploy during low-traffic window, monitor logs closely for first hour\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/ACTION-BATCHING-TESTING.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "4aca99d9ea03fa13",
      "size_bytes": 6067,
      "created_at": "2026-01-02T20:42:12.439162"
    },
    {
      "doc_id": "local_party-lore_docs_archive_TESTING",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/TESTING.md",
      "content": "# Testing Guide - Party Lore\n\n## Autonomous Testing Infrastructure (TASK-163)\n\nParty Lore includes an AI-powered autonomous testing system that uses intelligent test agents to simulate players and detect issues.\n\n### Prerequisites\n\n1. **Java 17+** - Required for running the application\n2. **Maven 3.8+** - For building and running tests\n3. **Docker** - For PostgreSQL database\n4. **PostgreSQL** - Running via Docker Compose\n\n### Quick Start\n\n#### 1. Start Test Database\n\n```bash\n# Start PostgreSQL\ndocker-compose -f docker-compose.local.yml up -d postgres\n\n# Or use the convenience script\n./scripts/test-db-setup.sh start\n```\n\n#### 2. Run Autonomous Tests\n\n```bash\n# Quick smoke test (4 AI players, 10 turns, ~2 minutes)\nmvn spring-boot:run -Dspring-boot.run.arguments=\"--mode=autonomous-test,--suite=quick\"\n\n# Core mechanics test (6 players, 20 turns, ~5 minutes)\nmvn spring-boot:run -Dspring-boot.run.arguments=\"--mode=autonomous-test,--suite=core\"\n\n# Full test suite (10 players, 50 turns, ~15 minutes)\nmvn spring-boot:run -Dspring-boot.run.arguments=\"--mode=autonomous-test,--suite=full\"\n```\n\n#### 3. View Test Reports\n\nTest reports are generated in `.test-reports/` with detailed results:\n\n```bash\nls -la .test-reports/\ncat .test-reports/test-report-quick-20250109-151234.md\n```\n\n### Test Suites\n\n| Suite | Players | Max Turns | Duration | Purpose |\n|-------|---------|-----------|----------|---------|\n| **quick** | 4 | 10 | ~2 min | Fast smoke test |\n| **core** | 6 | 20 | ~5 min | Core game mechanics |\n| **muca** | 8 | 30 | ~10 min | Multi-user combat & consensus |\n| **narrative** | 4 | 15 | ~8 min | Story quality (uses Claude) |\n| **edge** | 6 | 20 | ~5 min | Edge cases & stress testing |\n| **full** | 10 | 50 | ~15 min | Comprehensive test suite |\n\n### Command-Line Options\n\n```bash\nmvn spring-boot:run -Dspring-boot.run.arguments=\"--mode=autonomous-test,<options>\"\n```\n\n**Required:**\n- `--suite=<name>` - Test suite to run (quick, core, muca, narrative, edge, full)\n\n**Optional:**\n- `--ai-players=<n>` - Number of AI test agents (default: suite default)\n- `--max-turns=<n>` - Maximum turns to simulate (default: suite default)\n- `--max-issues=<n>` - Stop after N issues found (default: suite default)\n- `--debug=<bool>` - Enable debug output (default: false)\n- `--mode=<mode>` - Test mode (default: NORMAL)\n\n**Test Modes:**\n- `NORMAL` - Standard gameplay testing\n- `AGGRESSIVE` - Test conflict resolution\n- `COOPERATIVE` - Test consensus building\n- `EDGE_CASE` - Test unusual/problematic inputs\n- `NEW_PLAYER` - Simulate inexperienced player\n- `EXPERIENCED` - Simulate expert player\n- `ABSENT` - Test autopilot and timeouts\n\n### Examples\n\n```bash\n# Quick test with custom player count\nmvn spring-boot:run -Dspring-boot.run.arguments=\"--mode=autonomous-test,--suite=quick,--ai-players=6\"\n\n# Core test with debug output\nmvn spring-boot:run -Dspring-boot.run.arguments=\"--mode=autonomous-test,--suite=core,--debug=true\"\n\n# Edge case testing with aggressive mode\nmvn spring-boot:run -Dspring-boot.run.arguments=\"--mode=autonomous-test,--suite=edge,--mode=AGGRESSIVE\"\n\n# Custom configuration\nmvn spring-boot:run -Dspring-boot.run.arguments=\"--mode=autonomous-test,--suite=core,--ai-players=8,--max-turns=30,--max-issues=10\"\n```\n\n### Test Scenarios\n\nThe autonomous testing system includes scenarios for:\n\n#### Core Game Mechanics\n- Basic combat (2 players vs enemy)\n- Group combat coordination (3 players)\n- Solo exploration and discovery sharing\n- NPC interaction and information gathering\n\n#### MUCA Framework\n- Consensus building for group decisions\n- Conflict resolution using 3W Framework\n- Complex multi-player coordination\n\n#### Edge Cases\n- Ambiguous command handling\n- Player timeout and autopilot activation\n- Rapid action processing\n\n#### Narrative Quality\n- Memory consistency across scenes\n- Plot coherence and thread tracking\n- NPC behavior consistency\n\n### Database Management\n\n```bash\n# Start database\n./scripts/test-db-setup.sh start\n\n# Stop database\n./scripts/test-db-setup.sh stop\n\n# Stop and clean (removes all data)\n./scripts/test-db-setup.sh clean\n```\n\n### Continuous Integration\n\nFor CI/CD pipelines, use Testcontainers for isolated database testing:\n\n```bash\n# Run with Testcontainers (auto-manages database)\nmvn test -Dspring.profiles.active=test\n```\n\n### Troubleshooting\n\n**Database Connection Issues:**\n```bash\n# Check database status\ndocker ps | grep postgres\n\n# View database logs\ndocker-compose -f docker-compose.local.yml logs postgres\n\n# Restart database\n./scripts/test-db-setup.sh clean\n./scripts/test-db-setup.sh start\n```\n\n**Test Failures:**\n- Check `.test-reports/` for detailed failure information\n- Enable debug mode: `--debug=true`\n- Review application logs in `logs/` directory\n- Ensure database is running and accessible\n\n**Memory Issues:**\n```bash\n# Increase JVM heap size\nexport MAVEN_OPTS=\"-Xmx2g\"\nmvn spring-boot:run -Dspring-boot.run.arguments=\"--mode=autonomous-test,--suite=full\"\n```\n\n### Architecture\n\nThe autonomous testing infrastructure consists of:\n\n- **AutonomousTestRunner** - CLI entry point (`party-lore-app`)\n- **TestingOrchestrator** - Facade for quality monitoring (`party-lore-game`)\n- **AdvancedAITestAgentService** - AI test agents with 7 modes (`party-lore-game`)\n- **TestScenarioGenerator** - Scenario generation (`party-lore-game`)\n- **NarrativeQualityAnalysisService** - Claude-powered quality analysis (`party-lore-ai`)\n- **AutoFixService** - Automated fix proposal generation (`party-lore-game`)\n\n### References\n\n- **TASK-163**: Autonomous Testing Infrastructure specification\n- **TASK-164**: CLI Integration and end-to-end testing\n- **TASK-156**: Narrative Quality Monitoring (shared components)\n\n---\n\n**Last Updated**: January 2025\n**Status**: Implementation 90% complete (CLI ready, integration tests pending)\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/TESTING.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "agent",
        "database",
        "md",
        "test"
      ],
      "content_hash": "1b3b8ee20c5a136f",
      "size_bytes": 5792,
      "created_at": "2026-01-02T20:42:12.439191"
    },
    {
      "doc_id": "local_party-lore_docs_archive_GAME-DESIGN-CRISIS-ANALYSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/GAME-DESIGN-CRISIS-ANALYSIS.md",
      "content": "# Game Design Crisis Analysis - Party Lore\n**Date**: 2025-10-20\n**Severity**: CRITICAL - Core Gameplay Fundamentally Broken\n\n## Executive Summary\n\nParty Lore has **catastrophic design flaws** that make it boring, non-interactive, and fail to deliver on its core promise of multiplayer SMS RPG gameplay. The game suffers from three critical problems:\n\n1. **MUCA is disabled** - Group decision-making never happens\n2. **Single-player perspective** - Narratives ignore the party, address individuals\n3. **Nothing ever happens** - No events, no encounters, no world reactivity\n\n**Bottom Line**: The game is a glorified chatbot that responds to individual players while ignoring the multiplayer RPG experience entirely.\n\n---\n\n## CRITICAL ISSUE #1: MUCA is Completely Disabled\n\n### The Problem\n\nMUCA (Multi-User Conflict Arbitration) - the revolutionary group decision-making system - **IS TURNED OFF**:\n\n```java\n// GameServiceImpl.java:203-210\n// TEMPORARY: MUCA voting not fully implemented - skip for now to prevent game hangs\n// Conflict detection works, but vote prompt sending and collection are incomplete.\n// For now, let the AI narrate conflicts naturally instead of initiating votes.\n// TODO: Complete MUCA implementation (send vote prompts via SMS, collect votes, build consensus, resume game)\n// if (requiresGroupDecision(gameContext, playerAction)) {\n//     facilitateGroupDecision(gameContext, playerAction);\n//     return ProcessingResult.voteInitiated(); // Exit early, will resume after vote\n// }\n```\n\n### Why This Kills the Game\n\n**MUCA was the CORE INNOVATION** - the reason Party Lore is different from every other RPG:\n\n- **From the spec**: \"Players can have conflicting desires and the AI facilitates consensus\"\n- **From the marketing**: \"Revolutionary group decision-making system\"\n- **Reality**: It's completely commented out, replaced with \"let the AI narrate conflicts naturally\"\n\n**What this means**:\n- ‚ùå No player conflict resolution\n- ‚ùå No group voting on major decisions\n- ‚ùå No collaborative decision-making\n- ‚ùå No \"party vs GM\" moments\n- ‚ùå No social gameplay whatsoever\n\n**Research shows**:\n> \"Multi-player votes and in-depth narrative choices set [successful games] apart\" - As Dusk Falls post-mortem\n> \"Making decisions together, influencing the story and shaping the characters' arcs\" - Key to multiplayer narrative engagement\n\n### What Actually Happens\n\nWhen one player says \"I attack the enemy\" and another says \"I try to negotiate\":\n- **Should happen**: MUCA triggers, players vote on approach, AI implements winning strategy\n- **Actually happens**: AI reads both actions separately, generates two individual responses ignoring the conflict\n\n**THIS IS NOT A MULTIPLAYER GAME** - it's multiple single-player games happening simultaneously in the same world.\n\n### Root Cause\n\nThe vote collection and SMS routing infrastructure was never completed:\n- ‚úÖ `ConflictDetector` works (detects AGGRESSIVE vs DIPLOMATIC conflicts)\n- ‚úÖ `VoteFacilitator` works (creates vote prompts)\n- ‚ùå **SMS sending of vote prompts** - not implemented\n- ‚ùå **Vote collection from players** - not implemented\n- ‚ùå **Consensus building** - not implemented\n- ‚ùå **Game resumption after vote** - not implemented\n\n### Fix Complexity: MEDIUM (2-3 days)\n\n**Required work**:\n1. Wire `VoteFacilitator` to `DeliveryOrchestrator` for SMS sending\n2. Create vote response handler in `SmsWebhookController`\n3. Store votes in database (need `PlayerVote` entity)\n4. Implement consensus algorithm in `ConsensusBuilder`\n5. Resume game with winning decision in `GameServiceImpl`\n\n---\n\n## CRITICAL ISSUE #2: Single-Player Narrative Perspective\n\n### The Problem\n\n**The AI always addresses individual players with \"you\" instead of \"the party\".**\n\nLooking at the BASE_SYSTEM_PROMPT:\n\n```java\n// AdvancedPromptEngineering.java:21-43\nYou are an advanced AI Game Master for Party Lore, an SMS-based RPG platform...\n\nCommunication Style:\n- Write immersive narrative content in plain text\n- Conversational and engaging tone\n- Rich but concise descriptions\n- Direct narrative delivery without metadata or structural annotations\n\nNarrative Principles:\n- Player agency is paramount\n- Every action has meaningful consequences\n- Character development drives plot progression\n- Emotional authenticity over dramatic effect\n- Group cooperation while respecting individual preferences\n```\n\n**What's missing**: NO INSTRUCTION ON PARTY vs INDIVIDUAL ADDRESSING.\n\n### Example of the Problem\n\n**Player 1 (Thalia)** texts: \"I light a torch\"\n**Player 2 (Gareth)** texts: \"I draw my sword\"\n\n**Current AI response** (sent to both):\n> \"You light your torch, the warm glow pushing back the darkness. The corridor ahead reveals ancient stone walls...\"\n\n**What it SHOULD say**:\n> \"Thalia lights a torch while Gareth draws his sword. The warm glow reveals the party standing before ancient stone walls. What does the party do?\"\n\n### Why This Destroys Immersion\n\nWhen you're in a party of 4 players:\n- ‚ùå Everyone gets responses saying \"you\" did the thing\n- ‚ùå Other players feel invisible\n- ‚ùå No sense of being in a group\n- ‚ùå Reads like a single-player game\n- ‚ùå Kills multiplayer cohesion\n\n**Research shows**:\n> \"Prosocial multiplayer design requires making players aware of each other's actions and creating interdependencies\" - Polaris Game Design Retreat\n\n### Code Evidence\n\n`GameContextAssembler.java:225-276` builds `partyDescription`:\n\n```java\nprivate String buildPartyDescription(List<Player> players) {\n    if (players == null || players.isEmpty()) {\n        return \"Solo adventurer\";\n    }\n\n    if (players.size() == 1) {\n        Player p = players.get(0);\n        String desc = \"Solo adventurer: \" + p.getCharacterName();\n        // ...\n    }\n\n    // Group players by location\n    StringBuilder desc = new StringBuilder(\"Party of \" + players.size() + \":\");\n    // Lists all player names and locations\n}\n```\n\n**THIS DATA EXISTS** - it's in the context sent to Claude.\n\n**But the prompt doesn't tell Claude to USE IT for party-perspective narration.**\n\n### Fix Complexity: EASY (2 hours)\n\nAdd to BASE_SYSTEM_PROMPT:\n\n```\n## CRITICAL: Party vs Solo Addressing\n\n**If playerCount > 1 (multiplayer session)**:\n- ALWAYS use third-person party perspective: \"the party\", \"Thalia and Gareth\", \"your group\"\n- NEVER use second-person \"you\" when referring to the whole group\n- Mention individual characters by name when they take actions\n- Create party cohesion by describing how actions work together\n- Example: \"Thalia's torch illuminates the path while Gareth stands ready, sword drawn. The party faces a fork in the corridor.\"\n\n**If playerCount == 1 (solo session)**:\n- Use second-person \"you\" perspective\n- Example: \"You light your torch, pushing back the darkness. The corridor ahead splits into two paths.\"\n\n**ALWAYS**:\n- Reference the party composition from partyDescription\n- Make players feel present in the same scene together\n- Describe how different player actions combine or conflict\n```\n\n---\n\n## CRITICAL ISSUE #3: Nothing Ever Happens\n\n### The Problem\n\n**The game is purely reactive** - it only responds to player actions. The world is completely static.\n\n### What's Missing\n\n‚ùå **Random encounters** - No monsters, no NPCs appearing spontaneously\n‚ùå **Environmental events** - No traps triggering, no weather, no ambushes\n‚ùå **Time-based progression** - No \"the orc horde arrives\", no \"the poison takes effect\"\n‚ùå **World reactivity** - No consequences of previous actions coming back\n‚ùå **NPC initiative** - NPCs never act on their own between player actions\n\n### Code Evidence\n\nLooking at `GameServiceImpl.processPlayerAction()`:\n\n```java\n// STEP 1: Store player action\n// STEP 2: Assemble game context\n// STEP 3: Check MUCA (DISABLED)\n// STEP 4: Build narrative request\n// STEP 5: Generate AI narrative\n// STEP 6: Deliver narrative\n```\n\n**THIS IS A PURELY REQUEST-RESPONSE LOOP** - no world state updates, no proactive events.\n\n### Why This Makes the Game Boring\n\nPlayers experience:\n1. Type action: \"I search the room\"\n2. Get response: \"You find nothing of interest\"\n3. Type action: \"I open the door\"\n4. Get response: \"The door opens to reveal an empty hallway\"\n5. Type action: \"I walk down the hallway\"\n6. Get response: \"You walk down the hallway\"\n\n**IT'S LIKE PULLING TEETH.**\n\n**Research shows**:\n> \"Progression systems create a structured journey, ensuring players have long-term goals\" - 2024 Multiplayer Design Best Practices\n> \"Over 90% of the world's top games use Live Ops to increase engagement\" - Mobile Gaming Trends 2025\n\n### What SHOULD Happen\n\n**Example exciting sequence**:\n\nPlayer 1: \"I search the room\"\n**AI**: \"Thalia searches the ancient chamber. Her fingers brush against a hidden switch‚Äî*click*. The floor trembles. Roll for Agility!\"\n\nPlayer 2: \"I grab the doorframe\"\n**AI**: \"Gareth lunges for the doorway as the floor collapses beneath him! His fingers catch the stone edge. Below, darkness and the sound of rushing water. Thalia, what do you do?\"\n\nPlayer 1: \"I reach out to help him\"\n**AI**: \"Thalia extends her hand. Gareth, make a Strength check to hold on long enough for her to reach you!\"\n\n**THIS IS EXCITING** - consequences, urgency, party cooperation, immediate danger.\n\n**Current game would respond**:\n> \"You search the room and find an old switch. You grab the doorframe. You reach out.\"\n\n### Root Cause Analysis\n\n**Missing Systems**:\n1. **Event Generator Service** - Nothing triggers random/scheduled events\n2. **World State Machine** - No tracking of \"the ritual is 70% complete\", \"reinforcements arrive in 3 turns\"\n3. **NPC AI Loop** - NPCs are passive props, never act independently\n4. **Consequence Engine** - Previous actions don't create future complications\n5. **Tension Escalation** - No system to increase stakes over time\n\n**Current architecture assumption**: \"The AI will handle all of this through narrative generation\"\n\n**Reality**: Claude responds to context, but without **explicit world state changes in the database**, the world is static between player actions.\n\n### Fix Complexity: HIGH (1-2 weeks)\n\n**Requires**:\n1. **Event Generation Service**\n   - Define event templates (encounters, traps, discoveries)\n   - Probability-based triggering\n   - Scene-appropriate event selection\n\n2. **World State Tracking**\n   - New tables: `ActiveThreat`, `EnvironmentalHazard`, `NPCIntention`\n   - Update state on every narrative generation\n   - Feed state into next context assembly\n\n3. **Scheduled Event System**\n   - Time-based triggers (\"after 3 player actions, the enemy pursues\")\n   - Countdown mechanisms (\"poison deals damage in 2 turns\")\n   - Multi-turn event chains\n\n4. **Proactive NPC Service**\n   - NPCs have goals and take actions toward them\n   - NPC actions inserted between player actions\n   - NPC vs NPC interactions in background\n\n---\n\n## Additional Issues Found\n\n### 4. Verbosity Problem (Partially Fixed)\n\n**Status**: Quick wins implemented, scene-aware tokens deployed\n**Remaining work**: Monitor actual gameplay to see if it's enough\n\n### 5. SMS Message Ordering (Research Complete)\n\n**Status**: Twilio concatenation verified, sequence numbering recommended\n**Priority**: LOW - not breaking the game, just annoying\n\n### 6. Memory System Usage\n\n**Status**: WORKING but underutilized\n**Issue**: Memory fragments are stored but not prominently featured in prompts\n**Fix**: Elevate memory importance in context building (MEDIUM priority, 1 day)\n\n---\n\n## Research Insights: What Makes Async Multiplayer Work\n\n### From \"Doomsday Paradise\" Post-Mortem\n\n> \"Choices in multiplayer narratives can have local or global impact - choices with global impact affect everybody\"\n\n**Party Lore insight**: We have NO global choices because MUCA is disabled.\n\n### From \"As Dusk Falls\" Analysis\n\n> \"It felt like a new experience that was much more compelling than watching a movie together, thanks to the extra layer of making decisions together\"\n\n**Party Lore insight**: We have NO decision-making together because MUCA is disabled.\n\n### From Asynchronous Game Design Analysis\n\n> \"An asynchronous game can allow a large group of friends to play together as long as each player can find 15 minutes per day\"\n\n**Party Lore insight**: Our architecture supports this, but gameplay doesn't give players reasons to check in.\n\n### From Cooperative Gameplay Design\n\n> \"Detecting selfishness helps prevent potential exploitation, promotes group coordination, and allows for moral signaling\"\n\n**Party Lore insight**: ConflictDetector can detect this, but we never use it because MUCA is disabled.\n\n---\n\n## Recommended Fix Priority\n\n### P0 - CRITICAL (Do First)\n\n1. **Enable MUCA voting** (3 days)\n   - Complete SMS vote delivery\n   - Implement vote collection\n   - Build consensus and game resumption\n   - **Impact**: Transforms game from solo to truly multiplayer\n\n2. **Fix narrative perspective** (2 hours)\n   - Add party vs solo addressing rules to prompts\n   - **Impact**: Makes multiplayer feel like multiplayer\n\n### P1 - HIGH (Do Next Week)\n\n3. **Add proactive events** (1 week)\n   - Event generation service\n   - Random encounters\n   - Environmental reactions\n   - **Impact**: Makes game exciting instead of boring\n\n4. **Elevate memory prominence** (1 day)\n   - Move memory context higher in prompts\n   - Add explicit \"callbacks to previous events\" instruction\n   - **Impact**: Better narrative continuity\n\n### P2 - MEDIUM (Do Later)\n\n5. **World state tracking** (1 week)\n   - Active threats database\n   - Countdown mechanisms\n   - NPC intention system\n   - **Impact**: Long-term consequences and plot threads\n\n6. **SMS message sequence numbering** (2 days)\n   - Add [1/3], [2/3], [3/3] to multi-part messages\n   - **Impact**: Reduces confusion from out-of-order delivery\n\n---\n\n## The Brutal Truth\n\n**Current state**: Party Lore is a fancy chatbot that responds to individual player messages with generic fantasy descriptions.\n\n**What players expect**: A thrilling multiplayer RPG where they adventure together, make group decisions, face challenges, and experience an evolving story.\n\n**The gap**: Massive.\n\n**Why this happened**:\n- MUCA was too complex to finish, got disabled\n- Narrative perspective was never explicitly designed\n- Event system was assumed to emerge from AI without explicit support\n- Testing focused on \"does it respond?\" not \"is it fun?\"\n\n**What to do**:\n1. Un-comment MUCA and finish it (highest ROI fix)\n2. Add party perspective prompt rules (easiest fix)\n3. Build event generation service (most impactful for excitement)\n\n**Time to playable multiplayer game**: ~2 weeks of focused work\n\n**Time to exciting multiplayer game**: ~4 weeks\n\n---\n\n## Appendix: Code References\n\n### MUCA Disabled\n- `party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java:203-210`\n\n### Party Description Building (data exists)\n- `party-lore-game/src/main/java/com/partylore/game/context/GameContextAssembler.java:225-276`\n\n### Conflict Detection (works but unused)\n- `party-lore-game/src/main/java/com/partylore/game/muca/ConflictDetector.java`\n\n### Narrative Generation (missing party rules)\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/AdvancedPromptEngineering.java:21-43`\n\n### Vote Facilitator (built but never called)\n- `party-lore-game/src/main/java/com/partylore/game/muca/VoteFacilitator.java`\n\n### Consensus Builder (built but never called)\n- `party-lore-game/src/main/java/com/partylore/game/muca/ConsensusBuilder.java`\n\n---\n\n**END OF ANALYSIS**\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/GAME-DESIGN-CRISIS-ANALYSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "34cf1982ad8d7f34",
      "size_bytes": 15431,
      "created_at": "2026-01-02T20:42:12.439304"
    },
    {
      "doc_id": "local_party-lore_docs_archive_E2E_TEST_FIXES_SUMMARY",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/E2E_TEST_FIXES_SUMMARY.md",
      "content": "# E2E Test Fixes Summary\n\n## Date: 2025-10-18\n\n## Issues Fixed\n\n### 1. **Beta Access Check for INVITE Command**\n**Problem**: `BetaAccessService.canInvite()` and `hasDMAccess()` required a BetaUser record even when beta mode was disabled in test environment.\n\n**Fix**: Added beta mode check to both methods - when beta access is disabled, these methods now return `true` for all users.\n\n**Files Modified**:\n- `party-lore-domain/src/main/java/com/partylore/domain/service/beta/BetaAccessService.java`\n  - Lines 218-242: Added `if (!betaConfig.isEnabled()) return true;` checks\n\n### 2. **Twilio Initialization in Test Mode**\n**Problem**: TwilioInitializer tried to validate Twilio API credentials even in test mode, causing authentication errors during test startup.\n\n**Fix**: Added `testMode` field and skip all API validation when test mode is enabled.\n\n**Files Modified**:\n- `party-lore-sms/src/main/java/com/partylore/sms/config/TwilioInitializer.java`\n  - Lines 34-35: Added `@Value(\"${twilio.test-mode:false}\") private boolean testMode;`\n  - Lines 58-65: Added test mode check to skip validation\n\n### 3. **LazyInitializationException**\n**Problem**: Test tried to access `game.getPlayers().size()` outside of Hibernate transaction context, causing LazyInitializationException.\n\n**Fix**: Added repository methods to query player data directly without accessing lazy collections.\n\n**Files Modified**:\n- `party-lore-domain/src/main/java/com/partylore/domain/repository/PlayerRepository.java`\n  - Lines 127-137: Added `findByGameSessionId()` and `countByGameSessionId()` methods\n- `party-lore-app/src/test/java/com/partylore/app/e2e/CompleteGameplayFlowE2ETest.java`\n  - Lines 179-183, 268-280: Changed to use repository queries instead of accessing lazy collections\n\n### 4. **START Command Routing Issue** ‚≠ê **CRITICAL BUG**\n**Problem**: When host sent \"START\" to begin the game, it was incorrectly routed to start a NEW game creation conversation instead of starting the existing game. The game status remained \"RECRUITING\" and never transitioned to \"ACTIVE\".\n\n**Root Cause**: The webhook controller regex `^(start|create|new game|...)$` matched \"START\" and triggered game creation flow without checking if the user already had an active game.\n\n**Fix**: Added special handling for \"START\" command:\n- If user has an active game ‚Üí route to CommandHandler to start the existing game\n- If user has NO active game ‚Üí start game creation\n- Removed \"start\" from the general game creation regex\n\n**Files Modified**:\n- `party-lore-sms/src/main/java/com/partylore/sms/controller/SmsWebhookController.java`\n  - Lines 256-287: Split handling of \"START\" vs other game creation commands\n  - Added check for active game before routing to game creation\n\n## Test Results\n\n**Before Fixes**:\n- Test compilation errors (missing repository methods)\n- Twilio initialization failures\n- Beta access blocked INVITE commands\n- LazyInitializationException on player queries\n- START command created new game instead of starting existing one\n- **Game never actually started** - status stuck at RECRUITING\n\n**After Fixes**:\n- ‚úÖ All tests compile\n- ‚úÖ Twilio test mode works correctly\n- ‚úÖ INVITE command works (host can invite players)\n- ‚úÖ Player invitation acceptance works (YES response)\n- ‚úÖ Player onboarding completes successfully\n- ‚úÖ Both players created in database (host + invited player)\n- ‚úÖ No LazyInitializationException\n- ‚úÖ **Tests run: 1, Failures: 0, Errors: 0, Skipped: 0**\n\n## Complete Flow Verified\n\nThe E2E test now successfully tests:\n1. ‚úÖ Host creates game (START ‚Üí realm selection ‚Üí name ‚Üí class ‚Üí confirm)\n2. ‚úÖ Game created with status RECRUITING\n3. ‚úÖ Host invites Player 1 with INVITE command\n4. ‚úÖ Player 1 accepts with YES\n5. ‚úÖ Player 1 completes onboarding (name ‚Üí class)\n6. ‚úÖ Both players exist in database with ACTIVE status\n7. ‚úÖ Host sends START to begin game\n8. ‚ö†Ô∏è  **START routing now correct** - will route to CommandHandler\n\n## Remaining Work\n\nThe test passes, but we haven't verified the complete gameplay flow:\n- Need to verify START command actually transitions game to ACTIVE status\n- Need to verify narrative generation triggers\n- Need to verify player actions work\n- Test message extraction shows \"[No message in response]\" - need to fix TwiML parsing or query database directly\n\n## Production Impact\n\n**Issue #4 (START routing) is a CRITICAL production bug:**\n- In production, when a host types START, they would get asked to create a SECOND game instead of starting their current game\n- Game would be stuck in RECRUITING status forever\n- Players would be very confused\n- **This bug would have been caught by E2E tests IF the tests were properly asserting game state transitions**\n\n## Recommendations\n\n1. **Add assertions to E2E test** - Don't just run through the flow, actually verify:\n   - Game status changes from RECRUITING ‚Üí ACTIVE when START is sent\n   - Narrative is generated\n   - Scene is created\n\n2. **Fix message extraction** - Currently showing \"[No message in response]\" for all SMS, should show actual content\n\n3. **Run this test in CI/CD** - This test would have caught the START routing bug before production\n\n## Files Changed\n\n1. `party-lore-domain/src/main/java/com/partylore/domain/service/beta/BetaAccessService.java`\n2. `party-lore-domain/src/main/java/com/partylore/domain/repository/PlayerRepository.java`\n3. `party-lore-sms/src/main/java/com/partylore/sms/config/TwilioInitializer.java`\n4. `party-lore-sms/src/main/java/com/partylore/sms/controller/SmsWebhookController.java` ‚≠ê\n5. `party-lore-app/src/test/java/com/partylore/app/e2e/CompleteGameplayFlowE2ETest.java`\n\n---\n\n**Test Status**: ‚úÖ **PASSING** - Tests run: 1, Failures: 0, Errors: 0, Skipped: 0\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/E2E_TEST_FIXES_SUMMARY.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "9b9227177e9bb5fe",
      "size_bytes": 5741,
      "created_at": "2026-01-02T20:42:12.439348"
    },
    {
      "doc_id": "local_party-lore_docs_archive_FINAL-REFACTORING-SUMMARY",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/FINAL-REFACTORING-SUMMARY.md",
      "content": "# Architecture Refactoring - Final Summary\n\n**Date**: January 2025\n**Status**: Phase 1-4 Nearly Complete (95%)\n\n---\n\n## ‚úÖ MAJOR ACCOMPLISHMENTS\n\n### Phase 1-2: Model & Service Consolidation (100%)\n- ‚úÖ Enhanced domain GameplayTranscript with missing methods\n- ‚úÖ Updated 10 files to use domain.quality models\n- ‚úÖ Deleted entire `party-lore-game/src/main/java/com/partylore/game/quality/` package (~2,000 lines)\n- ‚úÖ Fixed API compatibility in game.testing services\n\n### Phase 3: Module Dependencies & Cleanup (95%)\n- ‚úÖ Removed 7 duplicate packages from console module (~1,500 lines):\n  - `console.ai` (BasicAIPlayerService, DecisionMakingEngine, PersonalityProfileService)\n  - `console.autonomous` (AutonomousTestingService)\n  - `console.debug` (old location)\n  - `console.channel` (old location)\n- ‚úÖ Updated console imports to use game module services\n- ‚úÖ Added setMonitoringEnabled() and displaySystemMessage() methods\n- ‚ö†Ô∏è Console compilation needs final fixes (type mismatches)\n\n### Phase 4: Unified Testing API (90%)\n- ‚úÖ Created TestingOrchestrator facade in game.testing package\n  - analyzeSession(), analyzeRecentActions(), analyzeTranscript()\n  - buildTranscript(), runAutonomousTest()\n  - hasQualityIssues(), getQualitySummary()\n- ‚úÖ Clean API for console and web modules\n- ‚ö†Ô∏è Console integration pending (blocked by type mismatches)\n\n### Phase 5: AIPlayer & PersonalityProfile Consolidation (90%)\n- ‚úÖ **Consolidated AIPlayer model**:\n  - Merged game.model.AIPlayer (118 lines) into domain.model.AIPlayer\n  - Added PlayerClass enum {WARRIOR, ROGUE, MAGE, CLERIC}\n  - Added level and playerClass fields\n  - Added compatibility methods: getPlayerId(), setPlayerId(), getPersonality(), setPersonality(), getDisplayName()\n\n- ‚úÖ **Consolidated PersonalityProfile model**:\n  - Merged game.model.PersonalityProfile (178 lines) into domain.model.PersonalityProfile\n  - Added 5 new enum values: CAUTIOUS_SUPPORTER, BOLD_LEADER, LONE_EXPLORER, TACTICAL_ANALYZER, RECKLESS_BRAWLER\n  - Added fields: aggression, socialness, exploration (double 0.0-1.0 scale)\n  - Added helper methods: wouldTakeRisk(), prefersSocialActions(), seeksCombat(), prefersExploration()\n  - Updated applyDefaults() with all 10 personality types\n\n- ‚úÖ **Deleted duplicate game.model files**:\n  - party-lore-game/src/main/java/com/partylore/game/model/AIPlayer.java\n  - party-lore-game/src/main/java/com/partylore/game/model/PersonalityProfile.java\n\n- ‚úÖ **Updated all imports** in 5 game module files:\n  - BasicAIPlayerService.java\n  - DecisionMakingEngine.java\n  - AdvancedAITestAgentService.java\n  - AutonomousTestingService.java\n  - AdvancedAITestAgentServiceTest.java\n\n---\n\n## üìä CODE REDUCTION\n\n**Total Duplicate Code Eliminated**: ~4,000 lines\n- Phase 1-2: ~2,000 lines (game.quality package)\n- Phase 3: ~1,500 lines (console duplicates)\n- Phase 5: ~500 lines (AIPlayer and PersonalityProfile duplicates)\n\n**Files Deleted**: 17 duplicate files\n**Files Modified**: 20+ files updated with correct imports\n**New Files Created**: 3 (TestingOrchestrator, 2 documentation files)\n\n---\n\n## ‚ö†Ô∏è REMAINING WORK (5%)\n\n### Type Mismatch Issues\n**Problem**: Domain PersonalityProfile has two scales:\n- `riskTolerance` (int): 1-10 scale\n- `aggression`, `socialness`, `exploration` (double): 0.0-1.0 scale\n\nGame module code sometimes treats riskTolerance as double 0.0-1.0.\n\n**Files Needing Fixes**:\n- `AdvancedAITestAgentService.java` (lines 88, 98, 103)\n- Potentially other files in game module\n- Console module (blocked by game module fixes)\n\n**Solution**: Cast expressions or refactor to use consistent scale\n\n### Console Module\n- Console module depends on game module\n- Will compile once game module type mismatches are fixed\n- All imports already updated correctly\n\n---\n\n## üéØ ARCHITECTURE ACHIEVED\n\n### Single Source of Truth\n- ‚úÖ **Domain Module**: All JPA entities (AIPlayer, PersonalityProfile, GameplayTranscript, IllogicalMoment, etc.)\n- ‚úÖ **AI Module**: Quality analysis services (NarrativeQualityAnalysisService, GameplayTranscriptService)\n- ‚úÖ **Game Module**: Testing infrastructure (AutonomousTestingService, AdvancedAITestAgentService, TestingOrchestrator)\n\n### Clean Module Dependencies\n```\nConsole Module\n  ‚Üì depends on\nGame Module\n  ‚Üì depends on\nAI Module\n  ‚Üì depends on\nDomain Module (foundational, no dependencies)\n```\n\n### Zero Duplication\n- ‚úÖ No duplicate models\n- ‚úÖ No duplicate services\n- ‚úÖ No duplicate testing infrastructure\n- ‚úÖ Clean separation of concerns\n\n---\n\n## üîß FILES CHANGED\n\n### New Files (3)\n- `ARCHITECTURE-REFACTORING-PLAN.md` (19KB design document)\n- `REFACTORING-PROGRESS.md` (progress tracking)\n- `party-lore-game/src/main/java/com/partylore/game/testing/TestingOrchestrator.java` (unified API)\n\n### Modified Files (20+)\n**Domain Module (2)**:\n- `AIPlayer.java` - Added PlayerClass enum, level, compatibility methods\n- `PersonalityProfile.java` - Added 5 enum values, 3 double fields, 4 helper methods\n\n**Game Module (15+)**:\n- 5 files: Import changes to domain.model.AIPlayer and PersonalityProfile\n- BasicAIPlayerService.java, DecisionMakingEngine.java\n- AdvancedAITestAgentService.java, AutonomousTestingService.java\n- AutoFixService.java, PersonalityProfileService.java\n- AdvancedAITestAgentServiceTest.java\n- 8+ other files with import updates\n\n**Console Module (4)**:\n- PartyLoreConsole.java - Updated imports to game services\n- ConsoleChannelSimulator.java - Added overloaded displaySystemMessage()\n- RealTimeMonitorService.java - Added setMonitoringEnabled()\n- InteractiveDebugService.java - API fixes\n\n### Deleted Files (17)\n- **game.quality package** (5 files): NarrativeQualityAnalysisService, GameplayTranscriptService, GameplayTranscript, IllogicalMoment, NarrativeAnalysisResult\n- **game.model package** (2 files): AIPlayer, PersonalityProfile\n- **console duplicates** (7 packages/directories): console.ai, console.autonomous, console.debug (old), console.channel (old)\n\n---\n\n## ‚úÖ WHAT'S READY\n\n- ‚úÖ Domain module compiles\n- ‚úÖ AI module compiles\n- ‚úÖ Architecture is clean and well-documented\n- ‚úÖ All major duplicates eliminated\n- ‚úÖ Single source of truth established\n\n## ‚ö†Ô∏è WHAT'S NEEDED\n\n- Fix ~3-5 remaining type conversion issues in game module\n- Game module will then compile\n- Console module will then compile\n- Run full test suite\n- All should pass (79 tests expected)\n\n---\n\n## üíæ ALL CHANGES STAGED\n\n33 files staged and ready for commit (per user's manual commit workflow).\n\n**Recommendation**: Fix the remaining type mismatches (15-30 minutes of work), then commit all changes together as one cohesive refactoring commit.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/FINAL-REFACTORING-SUMMARY.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "api",
        "md",
        "test"
      ],
      "content_hash": "9eaf37f9f4f3a26f",
      "size_bytes": 6624,
      "created_at": "2026-01-02T20:42:12.439508"
    },
    {
      "doc_id": "local_party-lore_docs_archive_GROUP_MESSAGING_TEST_ISSUES",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/GROUP_MESSAGING_TEST_ISSUES.md",
      "content": "# Critical Issues with Group Messaging in Tests\n\n## The Fundamental Problem\n\n**The SMS webhook testing approach does NOT actually test group messaging at all.**\n\n### How Twilio Conversations Actually Works\n\n1. **Game Creation**:\n   - `TwilioConversationsService.createPartyConversation()` ‚Üí Creates Conversation \"CH123...\"\n   - `GameSession.conversationSid` = \"CH123...\"\n\n2. **Player Join**:\n   - `TwilioConversationsService.addParticipant(conversationSid, phone, name, role)`\n   - Twilio adds participant to conversation\n   - Participant can now see all messages in that conversation\n\n3. **Player Sends GROUP Action**:\n   - Player sends SMS: \"I attack the goblin!\" to Twilio proxy number (+18777040308)\n   - SMS webhook receives: `From: +15551234567, Body: \"I attack the goblin!\"`\n   - Game processes action with `ActionChannel.GROUP`\n   - Game calls: `TwilioConversationsService.sendGroupMessage(conversationSid, \"Thorin\", \"narrative\")`\n   - **Twilio automatically sends this message to ALL participants in the conversation**\n\n4. **Other Players Receive**:\n   - Player 2 receives SMS from +18777040308: \"[Game Master] Thorin swings his axe...\"\n   - Player 3 receives the same message\n   - They see it in their SMS app as part of the group thread\n   - **They DO NOT send individual webhook requests - they just receive SMS**\n\n### How Our Tests Currently Work\n\n1. **Test sends webhook**: `sendSms(\"+15551111111\", \"I attack\")`\n2. **Webhook processes**: Creates Player, processes action\n3. **Game tries to send group message**: `sendGroupMessage(conversationSid, ...)`\n4. **With mocking**: Does nothing - message disappears into void\n5. **No other test players receive anything**\n6. **Group messaging completely untested**\n\n## What's Actually Being Tested\n\n‚úÖ **TESTED**:\n- Individual webhook delivery (Player ‚Üí Server)\n- Individual SMS responses (Server ‚Üí Player via `TwilioSmsService`)\n- Onboarding conversation flows (individual, 1-to-1)\n- Database persistence\n\n‚ùå **NOT TESTED**:\n- Twilio Conversation creation\n- Participant management (add/remove)\n- Group message delivery (1 message ‚Üí N players)\n- Players seeing each other's messages\n- Group thread continuity\n- Invite flow (new player joins existing conversation)\n- Leave flow (player removed from conversation)\n\n## The Real Message Flows\n\n### Onboarding (1-to-1, INDIVIDUAL channel)\n\n```\nHost creates game:\nHost ‚Üí Webhook ‚Üí \"START\"\nServer ‚Üí TwilioSmsService.sendMessage(host, \"Choose realm\") ‚Üí Host receives SMS\nHost ‚Üí Webhook ‚Üí \"FANTASY\"\nServer ‚Üí TwilioSmsService.sendMessage(host, \"Choose name\") ‚Üí Host receives SMS\n...\n```\n\n**This works in tests because it's 1-to-1 SMS, no group involved.**\n\n### Gameplay (Group, GROUP channel)\n\n```\nSetup:\n- Twilio Conversation \"CH123\" exists\n- Participants: Host (+1555111), Player1 (+1555222), Player2 (+1555333)\n\nPlayer1 sends action:\nPlayer1 ‚Üí Webhook ‚Üí \"I examine the door\"\nServer ‚Üí TwilioConversationsService.sendGroupMessage(\"CH123\", \"Raven\", \"Raven examines...\")\nTwilio ‚Üí AUTOMATICALLY sends to ALL participants:\n  - Host receives: \"[Game Master] Raven examines the ancient door...\"\n  - Player1 receives: \"[Game Master] Raven examines the ancient door...\"\n  - Player2 receives: \"[Game Master] Raven examines the ancient door...\"\n\nPlayer2 replies to group thread:\nPlayer2 ‚Üí (sends SMS to proxy +18777040308 as REPLY to group thread)\nTwilio ‚Üí Receives as part of conversation \"CH123\"\nTwilio ‚Üí Webhook ‚Üí \"From: +1555333, ConversationSid: CH123, Body: I help examine\"\nServer ‚Üí Processes with ActionChannel.GROUP\nServer ‚Üí sendGroupMessage(\"CH123\", \"Gandor\", \"Gandor helps examine...\")\nTwilio ‚Üí AUTOMATICALLY sends to ALL participants again\n```\n\n**NONE of this multi-player interaction is tested!**\n\n## Why Onboarding Tests Didn't Catch This\n\nThe `NewHostOnboardingE2ETest` only tests:\n1. Host creates game (solo, INDIVIDUAL messages)\n2. Player joins game (solo, INDIVIDUAL messages during onboarding)\n3. Database validation (conversation_sid is stored)\n\n**It does NOT test**:\n- Sending messages to the group conversation\n- Multiple players in the same game sending actions\n- Players receiving each other's messages\n- The full group gameplay loop\n\n##What Actually Needs To Happen in Tests\n\n###Option 1: Mock at a Higher Level (Current Approach - INCOMPLETE)\n\n```java\n@MockBean\nprivate TwilioConversationsService twilioConversationsService;\n\n// Mock returns a fake conversation SID\nwhen(twilioConversationsService.createPartyConversation(any(), anyString()))\n    .thenReturn(\"TEST_CONVERSATION_SID\");\n\n// Mock does nothing when group message sent\ndoNothing().when(twilioConversationsService)\n    .sendGroupMessage(anyString(), anyString(), anyString());\n```\n\n**Problem**: This doesn't simulate multi-player interaction at all! Messages just disappear.\n\n### Option 2: Test Infrastructure That Simulates Group Messaging (NEEDED)\n\nCreate a **Mock Twilio Conversations Manager** that:\n\n1. **Tracks active conversations**:\n```java\nMap<String, MockConversation> conversations;\n\nclass MockConversation {\n    String conversationSid;\n    List<String> participantPhones;\n    List<Message> messageHistory;\n}\n```\n\n2. **When `createPartyConversation()` called**:\n   - Create MockConversation with unique SID\n   - Store it\n\n3. **When `addParticipant()` called**:\n   - Add phone number to conversation's participant list\n\n4. **When `sendGroupMessage()` called**:\n   - Get conversation by SID\n   - **For each participant phone number**:\n     - Simulate receiving SMS by calling webhook!\n     - `POST /api/sms/webhook/incoming` with `From: {participantPhone}, ConversationSid: {sid}, Body: {message}`\n\n5. **Tests can then verify**:\n   - All players received the message\n   - Players can reply within the conversation\n   - Message history is maintained\n   - Participants can be added/removed dynamically\n\n### Option 3: Disable Group Messaging in Tests (AVOID)\n\n```yaml\ntwilio:\n  conversations:\n    enabled: false\n```\n\n**Problem**: Completely defeats the purpose of testing production code paths!\n\n## Required Test Scenarios\n\n### 1. Multi-Player Group Messaging\n- Host creates game\n- Player 1 joins ‚Üí added to conversation\n- Player 2 joins ‚Üí added to conversation\n- Player 1 sends GROUP action\n- **Verify**: Host, Player 1, Player 2 all receive the narrative\n- Player 2 sends GROUP action\n- **Verify**: All three receive the new narrative\n\n### 2. Dynamic Participant Management\n- Start with 2 players in game\n- Player 3 joins mid-game\n- **Verify**: Player 3 added to conversation\n- **Verify**: Player 3 receives subsequent group messages\n- Player 1 leaves game\n- **Verify**: Player 1 removed from conversation\n- **Verify**: Player 1 does NOT receive subsequent messages\n\n### 3. Mixed Individual/Group Messaging\n- Player sends INDIVIDUAL action (solo exploration)\n- **Verify**: Only that player receives response (via TwilioSmsService)\n- Player sends GROUP action (party activity)\n- **Verify**: All players receive response (via TwilioConversationsService)\n\n### 4. Conversation State Management\n- Game created ‚Üí conversation created\n- 3 players join ‚Üí 3 participants added\n- Game ends ‚Üí conversation deleted\n- **Verify**: All participants removed\n- **Verify**: Future messages fail (conversation no longer exists)\n\n## Autonomous Testing Implications\n\nWhen autonomous tests run with multiple AI agents:\n\n**Current behavior**:\n1. AI Agent 1 sends action via SMS webhook\n2. Game processes with GROUP channel\n3. `sendGroupMessage()` called\n4. Mock does nothing\n5. **Other AI agents never \"see\" the message**\n6. **AI agents can't react to each other's actions**\n7. **Group coordination completely untested**\n\n**What should happen**:\n1. AI Agent 1 sends action via SMS webhook\n2. Game processes with GROUP channel\n3. `sendGroupMessage()` triggers mock\n4. **Mock simulates delivery to ALL AI agents**\n5. **Each AI agent's \"phone number\" receives webhook callback**\n6. **AI agents can observe and react to each other**\n7. **True multi-player dynamics tested**\n\n## Recommendations\n\n### Immediate (Critical for Tests to be Valid)\n\n1. **Create `MockTwilioConversationsService`** that:\n   - Maintains in-memory conversation state\n   - Simulates group message delivery to all participants\n   - Triggers webhook callbacks for each participant\n\n2. **Update all E2E tests** to use this mock\n\n3. **Add multi-player test scenarios** that verify:\n   - Multiple players in same game\n   - Players see each other's messages\n   - Invites add participants correctly\n   - Leaves remove participants correctly\n\n### Short-Term (Before Production)\n\n1. **Integration tests with real Twilio Conversations**:\n   - Create actual conversation\n   - Add real participants\n   - Send real group messages\n   - Verify delivery\n\n2. **Load testing**:\n   - Multiple games with multiple players\n   - High message volume\n   - Participant churn (joins/leaves)\n\n### Long-Term (Ongoing)\n\n1. **Monitor in production**:\n   - Conversation creation success rate\n   - Participant add/remove success rate\n   - Message delivery latency\n   - Group message failures\n\n2. **Automated E2E tests in staging**:\n   - Real phone numbers\n   - Real Twilio Conversations\n   - End-to-end validation\n\n## Conclusion\n\n**The current test architecture fundamentally cannot test group messaging because it only tests the incoming webhook half of the conversation, not the outgoing group delivery.**\n\nTo properly test group messaging, we need test infrastructure that simulates Twilio's automatic message distribution to all conversation participants.\n\nWithout this, we're essentially testing in \"single-player mode\" even when the game is designed for multi-player parties.\n\n---\n\n**Impact**: HIGH - Group messaging is a core feature that is currently completely untested\n**Urgency**: HIGH - Should be fixed before production deployment\n**Complexity**: MEDIUM - Requires new test infrastructure but approach is clear\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/GROUP_MESSAGING_TEST_ISSUES.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "4117a0a14f4847b2",
      "size_bytes": 9876,
      "created_at": "2026-01-02T20:42:12.439647"
    },
    {
      "doc_id": "local_party-lore_docs_archive_NARRATIVE-QUALITY-IMPROVEMENT",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/NARRATIVE-QUALITY-IMPROVEMENT.md",
      "content": "# Narrative Quality Improvement Plan\n\n**Date**: October 11, 2025\n**Context**: Post-TASK-163 Session Architecture Fixes\n**Current State**: Session errors eliminated (768‚Üí0), but quality scores remain low (1.0/10)\n\n## Executive Summary\n\nAfter successfully eliminating all \"Session not found\" errors through EntityManager.merge() architecture, full test suite shows consistent quality scores of 1.0/10 across all 12 scenarios. This indicates the low scores are NOT caused by session/memory issues, but by deeper narrative generation or scoring problems.\n\n**Test Results:**\n- ‚úÖ 0 \"Session not found\" errors (was 768)\n- ‚úÖ All memory fragments stored successfully\n- ‚ö†Ô∏è Quality scores: 1.0/10 average (6-8 issues per scenario)\n- ‚ö†Ô∏è No improvement from OLD code (1.2-1.8) to NEW code (1.0)\n\n**Hypothesis**: The narrative generation system may be using simple templates or lacking sufficient context depth, OR the quality scoring rubric is miscalibrated for test scenarios.\n\n---\n\n## Priority 1: Investigate Narrative Generation Pipeline\n\n### Current Architecture\n\nThe narrative generation flow is:\n```\nGameServiceImpl.processPlayerAction()\n  ‚Üí NarrativeGenerationService.generateAdvancedNarrative()\n    ‚Üí TemplateNarrativeEngine OR ClaudeNarrativeService\n      ‚Üí Returns IntelligentNarrativeResponse\n```\n\n### Investigation Tasks\n\n#### Task 1.1: Determine Which Narrative Engine Is Active\n\n**Location**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/NarrativeGenerationService.java`\n\n**Questions:**\n1. Is `TemplateNarrativeEngine` or `ClaudeNarrativeService` being used?\n2. What determines which engine is selected?\n3. Are there configuration properties that control this?\n\n**Action Items:**\n- [ ] Search for `@Primary` annotation on narrative services\n- [ ] Check `application-autonomous-test.yml` for narrative configuration\n- [ ] Add debug logging to identify which engine handles each request\n- [ ] Review `NarrativeGenerationService.generateAdvancedNarrative()` implementation\n\n**Expected Files to Check:**\n```\nparty-lore-ai/src/main/java/com/partylore/ai/narrative/\n‚îú‚îÄ‚îÄ NarrativeGenerationService.java\n‚îú‚îÄ‚îÄ ClaudeNarrativeService.java\n‚îú‚îÄ‚îÄ TemplateNarrativeEngine.java\n‚îî‚îÄ‚îÄ NarrativeRequestBuilder.java\n\nparty-lore-app/src/main/resources/\n‚îî‚îÄ‚îÄ application-autonomous-test.yml\n```\n\n**Success Criteria:**\n- Understand which engine is active during tests\n- Document the selection logic\n- Identify if template-based generation is causing low scores\n\n---\n\n#### Task 1.2: Analyze Prompt Engineering for Claude Narrative Service\n\n**If Claude is being used**, check prompt quality:\n\n**Location**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/ClaudeNarrativeService.java`\n\n**Questions:**\n1. What is the system prompt for narrative generation?\n2. How is game context included in the prompt?\n3. Are memory fragments being passed to Claude?\n4. What temperature/parameters are used?\n\n**Action Items:**\n- [ ] Extract current narrative generation prompt\n- [ ] Review context assembly in prompt\n- [ ] Check if recent memories are included\n- [ ] Verify character information is provided\n- [ ] Assess prompt structure for quality guidance\n\n**Key Areas to Review:**\n```java\n// Check prompt structure\nString systemPrompt = buildSystemPrompt(...);\nString userPrompt = buildUserPrompt(context, action, memories);\n\n// Check context inclusion\n- Character names, classes, personalities\n- Recent memory fragments (last 5-10 actions)\n- Current scene description\n- Emotional tone/tension\n- Plot threads\n```\n\n**Success Criteria:**\n- Document current prompt structure\n- Identify gaps in context provision\n- Propose enhanced prompt template\n\n---\n\n#### Task 1.3: Verify Template Quality (If Templates Are Used)\n\n**If templates are being used**:\n\n**Location**: `party-lore-ai/src/main/resources/prompts/templates/`\n\n**Questions:**\n1. How many templates are available?\n2. Are templates scenario-specific or generic?\n3. Do templates support variable context injection?\n4. Is there variety in template responses?\n\n**Action Items:**\n- [ ] Count available templates by category\n- [ ] Review template structure and variables\n- [ ] Check if templates support memory context\n- [ ] Assess template complexity and depth\n\n**Template Categories to Review:**\n```\ntemplates/\n‚îú‚îÄ‚îÄ combat/          (combat scenario templates)\n‚îú‚îÄ‚îÄ exploration/     (exploration templates)\n‚îú‚îÄ‚îÄ social/          (NPC interaction templates)\n‚îî‚îÄ‚îÄ muca/           (group decision templates)\n```\n\n**Success Criteria:**\n- Understand template coverage\n- Identify template limitations\n- Document gaps in template variety\n\n---\n\n## Priority 2: Enhance Memory Context Assembly\n\n### Current Memory System\n\nThe context assembly flow is:\n```\nGameContextAssembler.assembleContext()\n  ‚Üí MemoryService.getRecentFragments()\n  ‚Üí MemoryService.generateContextSummary()\n    ‚Üí Returns memory-enhanced GameContext\n```\n\n### Investigation Tasks\n\n#### Task 2.1: Audit Memory Fragment Retrieval\n\n**Location**: `party-lore-memory/src/main/java/com/partylore/memory/MemoryServiceImpl.java`\n\n**Questions:**\n1. How many recent fragments are retrieved for context?\n2. What criteria determine \"recent\" (turn count, time window)?\n3. Are fragments prioritized by importance score?\n4. Is there a maximum context size limit?\n\n**Action Items:**\n- [ ] Check `getRecentFragments()` implementation\n- [ ] Document current retrieval count (likely 5-10)\n- [ ] Review fragment ordering/prioritization\n- [ ] Assess if more history would improve quality\n\n**Key Code Sections:**\n```java\n// Check retrieval limit\nList<MemoryFragment> getRecentFragments(String sessionId, int limit);\n\n// Check importance filtering\nfragments.stream()\n    .filter(f -> f.getImportance() >= threshold)\n    .sorted(...)\n    .limit(N)\n```\n\n**Success Criteria:**\n- Document current retrieval strategy\n- Identify optimal fragment count\n- Propose enhanced retrieval algorithm\n\n---\n\n#### Task 2.2: Analyze Context Summary Generation\n\n**Location**: `party-lore-memory/src/main/java/com/partylore/memory/MemoryServiceImpl.java`\n\n**Method**: `generateContextSummary()`\n\n**Questions:**\n1. How are fragments assembled into summary text?\n2. Is the summary structured or free-form?\n3. What's the maximum summary length?\n4. Are emotional tones preserved in summary?\n\n**Action Items:**\n- [ ] Review `generateContextSummary()` implementation\n- [ ] Check summary length and format\n- [ ] Verify emotional context inclusion\n- [ ] Test summary quality with actual fragments\n\n**Expected Summary Structure:**\n```java\n// Current format (likely simple concatenation)\nString summary = fragments.stream()\n    .map(f -> f.getContent())\n    .collect(Collectors.joining(\"\\n\"));\n\n// Enhanced format (with structure)\nString summary = buildStructuredSummary(\n    recentActions,\n    emotionalState,\n    relationshipContext,\n    plotThreads\n);\n```\n\n**Success Criteria:**\n- Document current summary format\n- Identify missing contextual elements\n- Propose structured summary template\n\n---\n\n#### Task 2.3: Verify Context Usage in Narrative Generation\n\n**Location**: `party-lore-game/src/main/java/com/partylore/game/context/GameContextAssembler.java`\n\n**Questions:**\n1. Is the memory context actually passed to narrative generation?\n2. What fields from GameContext reach the narrative engine?\n3. Are there any context truncation issues?\n\n**Action Items:**\n- [ ] Trace GameContext flow from assembly to narrative generation\n- [ ] Verify `context.getRecentMemories()` is used\n- [ ] Check `context.getConversationState()` population\n- [ ] Add logging to track context size/content\n\n**Context Flow Check:**\n```java\n// GameContextAssembler.assembleContext()\nGameContext context = GameContext.builder()\n    .recentMemories(memoryFragments)        // ‚Üê Is this populated?\n    .conversationState(summary)              // ‚Üê Is this used?\n    .emotionalContext(emotionalState)        // ‚Üê Is this passed?\n    .build();\n\n// NarrativeGenerationService receives context\n// Does it actually USE these fields in prompts?\n```\n\n**Success Criteria:**\n- Confirm context reaches narrative engine\n- Verify all context fields are utilized\n- Identify any data loss in pipeline\n\n---\n\n## Priority 3: Review Quality Scoring Rubric\n\n### Current Quality Analysis System\n\nThe quality scoring flow is:\n```\nNarrativeQualityAnalysisService.analyzeQuality()\n  ‚Üí Build quality analysis prompt for Claude\n  ‚Üí Extract score from Claude response\n  ‚Üí Detect specific issue types\n```\n\n### Investigation Tasks\n\n#### Task 3.1: Understand Scoring Criteria\n\n**Location**: `party-lore-ai/src/main/java/com/partylore/ai/quality/NarrativeQualityAnalysisService.java`\n\n**Questions:**\n1. What criteria does Claude use to score narratives?\n2. Is the scoring prompt well-defined and clear?\n3. Are expectations appropriate for test scenarios?\n4. What constitutes a \"good\" score (6+, 8+)?\n\n**Action Items:**\n- [ ] Extract quality analysis prompt from service\n- [ ] Document scoring criteria (coherence, engagement, consistency, etc.)\n- [ ] Review if criteria match test scenario characteristics\n- [ ] Check if scores are calibrated correctly (1-10 scale)\n\n**Scoring Prompt Analysis:**\n```java\n// Extract from NarrativeQualityAnalysisService\nString qualityPrompt = buildQualityAnalysisPrompt(transcript);\n\n// Check for:\n- Narrative coherence (logical flow)\n- Character consistency\n- World building\n- Engagement/interest\n- Grammar/clarity\n- Memory consistency\n- Emotional depth\n```\n\n**Success Criteria:**\n- Document complete scoring rubric\n- Identify if criteria are too strict\n- Propose calibration adjustments if needed\n\n---\n\n#### Task 3.2: Analyze Issue Detection Patterns\n\n**Current Issues**: 6-8 detected per scenario, but unclear what types\n\n**Location**: `party-lore-ai/src/main/java/com/partylore/ai/quality/`\n\n**Questions:**\n1. What are the 6-8 issues being detected?\n2. Are they MISSING_CONTEXT, MECHANICAL_ERROR, or NARRATIVE_VACUUM?\n3. Are issues legitimate or false positives?\n4. Is issue detection too sensitive?\n\n**Action Items:**\n- [ ] Extract issue details from test logs\n- [ ] Categorize issues by type\n- [ ] Review examples of detected issues\n- [ ] Assess if detection thresholds are appropriate\n\n**Issue Categories to Analyze:**\n```\nMISSING_CONTEXT:\n- \"Character actions lack motivation\"\n- \"Scene transitions feel abrupt\"\n- \"No reference to previous events\"\n\nMECHANICAL_ERROR:\n- \"Invalid skill usage\"\n- \"Resource tracking inconsistencies\"\n- \"Rule violations\"\n\nNARRATIVE_VACUUM:\n- \"Generic, uninspired descriptions\"\n- \"Lack of character voice\"\n- \"Repetitive patterns\"\n```\n\n**Log Search Commands:**\n```bash\n# Extract issue details from test logs\ngrep -A 5 \"Issue detected:\" test-full-suite-fixed.log\n\n# Count issues by type\ngrep \"MISSING_CONTEXT\\|MECHANICAL_ERROR\\|NARRATIVE_VACUUM\" test-full-suite-fixed.log | sort | uniq -c\n\n# Find issue descriptions\ngrep -B 2 -A 2 \"issues found\" test-full-suite-fixed.log\n```\n\n**Success Criteria:**\n- Categorize all detected issues\n- Understand primary failure modes\n- Validate issue detection accuracy\n\n---\n\n#### Task 3.3: Compare Baseline Expectations vs Reality\n\n**Questions:**\n1. What quality score should we expect for test scenarios?\n2. Are 1-turn test scenarios expected to have low scores?\n3. How do production game sessions compare to test scenarios?\n\n**Action Items:**\n- [ ] Review test scenario design (max turns, complexity)\n- [ ] Check if scenarios run to completion or truncate early\n- [ ] Compare test narratives to hand-crafted examples\n- [ ] Establish realistic quality targets\n\n**Scenario Analysis:**\n```bash\n# Check actual turns executed per scenario\ngrep \"Turn [0-9]\" test-full-suite-fixed.log | wc -l\n\n# Expected: 50 turns √ó 12 scenarios = 600 turns\n# If much less, scenarios may be too short for quality\n```\n\n**Quality Target Calibration:**\n| Scenario Type | Expected Score | Notes |\n|--------------|----------------|-------|\n| Quick (1-2 turns) | 2-4/10 | Limited context, basic flow |\n| Short (5-10 turns) | 4-6/10 | Some continuity, character development |\n| Full (20-50 turns) | 6-8/10 | Rich context, plot progression |\n| Production game | 7-9/10 | Player-driven, emergent storytelling |\n\n**Success Criteria:**\n- Establish realistic score expectations\n- Validate if 1.0/10 is appropriate or too low\n- Define \"passing\" quality threshold\n\n---\n\n## Implementation Strategy\n\n### Phase 1: Diagnostic (Week 1)\n\n**Goal**: Understand the current system\n\n1. **Day 1-2**: Complete P1 investigation (narrative generation)\n   - Identify active engine\n   - Document prompt structure\n   - Review template system\n\n2. **Day 3-4**: Complete P2 investigation (memory context)\n   - Audit fragment retrieval\n   - Analyze context assembly\n   - Trace context usage\n\n3. **Day 5**: Complete P3 investigation (quality scoring)\n   - Extract scoring criteria\n   - Analyze issue patterns\n   - Establish baselines\n\n**Deliverables:**\n- Diagnostic report with findings\n- Gap analysis document\n- Prioritized improvement backlog\n\n---\n\n### Phase 2: Quick Wins (Week 2)\n\n**Goal**: Implement high-impact, low-effort improvements\n\n**Quick Win Candidates:**\n\n1. **If templates are used**: Switch to AI-powered generation\n   - Update configuration to use ClaudeNarrativeService\n   - Test quality improvement\n   - Estimated: 1 day\n\n2. **If prompts lack context**: Enhance prompt engineering\n   - Add memory fragments to narrative prompts\n   - Include emotional/relationship context\n   - Estimated: 2 days\n\n3. **If fragment retrieval is limited**: Increase context window\n   - Change retrieval from 5 to 10-15 fragments\n   - Test quality improvement\n   - Estimated: 0.5 days\n\n4. **If scoring is miscalibrated**: Adjust quality rubric\n   - Update analysis prompt with clearer criteria\n   - Recalibrate score expectations\n   - Estimated: 1 day\n\n**Expected Outcome**: Quality scores improve to 3-5/10 range\n\n---\n\n### Phase 3: Structural Enhancements (Weeks 3-4)\n\n**Goal**: Implement deeper architectural improvements\n\n**Enhancement Candidates:**\n\n1. **Structured Memory Summaries** (P2.2)\n   - Implement rich context summary format\n   - Include emotional states, relationships, plot threads\n   - Estimated: 3 days\n\n2. **Enhanced Narrative Prompts** (P1.2)\n   - Design comprehensive prompt template\n   - Include style guidance and quality criteria\n   - Test with multiple scenarios\n   - Estimated: 3 days\n\n3. **Intelligent Fragment Prioritization** (P2.1)\n   - Implement importance-based retrieval\n   - Add recency decay algorithm\n   - Weight by emotional impact\n   - Estimated: 2 days\n\n4. **Context-Aware Template Selection** (P1.3, if applicable)\n   - Create scenario-specific template categories\n   - Implement template blending\n   - Add variable injection system\n   - Estimated: 4 days\n\n**Expected Outcome**: Quality scores improve to 5-7/10 range\n\n---\n\n### Phase 4: Advanced Features (Month 2)\n\n**Goal**: Implement sophisticated narrative systems\n\n**Advanced Features:**\n\n1. **Plot Thread Tracking**\n   - Track ongoing story arcs\n   - Inject plot context into narratives\n   - Resolve threads over multiple sessions\n\n2. **Relationship Dynamics**\n   - Model character relationships\n   - Influence narrative tone based on relationships\n   - Track relationship evolution\n\n3. **Emotional Arc Management**\n   - Track emotional progression\n   - Ensure variety in emotional tones\n   - Balance tension and relief\n\n4. **Style Adaptation**\n   - Learn player preferences\n   - Adapt narrative style to player behavior\n   - Personalize descriptions and pacing\n\n**Expected Outcome**: Quality scores improve to 7-9/10 range\n\n---\n\n## Measurement & Validation\n\n### Success Metrics\n\n**Primary Metric**: Average Quality Score\n- **Current**: 1.0/10\n- **Phase 1 Target**: 1.5/10 (understand the system)\n- **Phase 2 Target**: 3.5/10 (quick wins)\n- **Phase 3 Target**: 6.0/10 (structural improvements)\n- **Phase 4 Target**: 8.0/10 (advanced features)\n\n**Secondary Metrics**:\n- Issue count per scenario (currently 6-8)\n- Issue type distribution (MISSING_CONTEXT vs others)\n- Narrative coherence score\n- Memory consistency score\n- Player engagement (production metrics)\n\n### Testing Protocol\n\n**After Each Change:**\n\n1. Run quick test suite (4 scenarios, ~10 minutes)\n   ```bash\n   mvn package -DskipTests -q\n   java -jar party-lore-app/target/party-lore-app-1.0.0-SNAPSHOT.jar \\\n     --spring.profiles.active=autonomous-test \\\n     --suite=quick \\\n     --max-turns=20\n   ```\n\n2. Check quality scores and session errors\n   ```bash\n   grep \"quality score:\" test-log.log\n   grep -c \"Session not found\" test-log.log\n   grep -c \"Merged session\" test-log.log\n   ```\n\n3. Analyze issue patterns\n   ```bash\n   grep \"issues found\" test-log.log\n   grep \"Issue detected:\" test-log.log | head -20\n   ```\n\n4. Compare to baseline results\n\n**Before Major Releases:**\n- Run full test suite (12 scenarios, ~1 hour)\n- Validate quality scores meet targets\n- Review representative narrative samples\n- Check for regressions in session handling\n\n---\n\n## Investigation Starting Points\n\n### Immediate Next Steps\n\n1. **Start with P1.1**: Determine which narrative engine is active\n   ```bash\n   # Search for narrative service configuration\n   grep -r \"NarrativeService\\|TemplateEngine\" party-lore-ai/src/main/java/ --include=\"*.java\"\n\n   # Check application configuration\n   cat party-lore-app/src/main/resources/application-autonomous-test.yml | grep -i narrative\n\n   # Look for @Primary annotation\n   grep -r \"@Primary\" party-lore-ai/src/main/java/com/partylore/ai/narrative/\n   ```\n\n2. **Add diagnostic logging** to identify active engine:\n   ```java\n   // In NarrativeGenerationService.generateAdvancedNarrative()\n   log.info(\"DIAGNOSTIC: Using narrative engine: {}\",\n            narrativeService.getClass().getSimpleName());\n   log.debug(\"DIAGNOSTIC: Context has {} recent memories\",\n            context.getRecentMemories().size());\n   log.debug(\"DIAGNOSTIC: Conversation state length: {}\",\n            context.getConversationState() != null ?\n            context.getConversationState().length() : 0);\n   ```\n\n3. **Run single scenario test** with enhanced logging:\n   ```bash\n   mvn package -DskipTests -q\n   java -jar party-lore-app/target/party-lore-app-1.0.0-SNAPSHOT.jar \\\n     --spring.profiles.active=autonomous-test \\\n     --suite=quick \\\n     --max-turns=5 \\\n     --debug\n   ```\n\n4. **Analyze narrative generation flow**:\n   - Trace one player action through the entire pipeline\n   - Document each transformation step\n   - Identify where context is lost or underutilized\n\n---\n\n## Key Files Reference\n\n### Narrative Generation\n```\nparty-lore-ai/src/main/java/com/partylore/ai/\n‚îú‚îÄ‚îÄ narrative/\n‚îÇ   ‚îú‚îÄ‚îÄ NarrativeGenerationService.java          ‚Üê Main orchestrator\n‚îÇ   ‚îú‚îÄ‚îÄ ClaudeNarrativeService.java              ‚Üê AI-powered generation\n‚îÇ   ‚îú‚îÄ‚îÄ TemplateNarrativeEngine.java             ‚Üê Template-based generation\n‚îÇ   ‚îî‚îÄ‚îÄ AdvancedNarrativeRequest.java            ‚Üê Request model\n‚îú‚îÄ‚îÄ quality/\n‚îÇ   ‚îú‚îÄ‚îÄ NarrativeQualityAnalysisService.java     ‚Üê Quality scoring\n‚îÇ   ‚îî‚îÄ‚îÄ IssueDetectionService.java               ‚Üê Issue detection\n‚îî‚îÄ‚îÄ client/\n    ‚îî‚îÄ‚îÄ ClaudeClient.java                         ‚Üê API client\n```\n\n### Memory & Context\n```\nparty-lore-memory/src/main/java/com/partylore/memory/\n‚îú‚îÄ‚îÄ MemoryService.java                            ‚Üê Interface\n‚îú‚îÄ‚îÄ MemoryServiceImpl.java                        ‚Üê Implementation\n‚îú‚îÄ‚îÄ MemoryFragment.java                           ‚Üê Fragment model\n‚îî‚îÄ‚îÄ NarrativeMemory.java                          ‚Üê Memory aggregate\n\nparty-lore-game/src/main/java/com/partylore/game/\n‚îú‚îÄ‚îÄ context/\n‚îÇ   ‚îú‚îÄ‚îÄ GameContextAssembler.java                 ‚Üê Context builder\n‚îÇ   ‚îî‚îÄ‚îÄ GameContext.java                          ‚Üê Context model\n‚îî‚îÄ‚îÄ GameServiceImpl.java                          ‚Üê Main game loop\n```\n\n### Configuration\n```\nparty-lore-app/src/main/resources/\n‚îú‚îÄ‚îÄ application.yml                               ‚Üê Main config\n‚îú‚îÄ‚îÄ application-autonomous-test.yml               ‚Üê Test config\n‚îî‚îÄ‚îÄ application-dev.yml                           ‚Üê Dev config\n\nparty-lore-ai/src/main/resources/\n‚îî‚îÄ‚îÄ prompts/\n    ‚îî‚îÄ‚îÄ templates/                                ‚Üê Template directory\n```\n\n---\n\n## Expected Challenges\n\n### Technical Challenges\n\n1. **Context Size Limitations**\n   - Claude has token limits (~200K)\n   - May need to summarize/compress long histories\n   - Solution: Implement intelligent context pruning\n\n2. **Template vs AI Tradeoff**\n   - Templates are fast and cheap\n   - AI is slow and expensive\n   - Solution: Hybrid approach (templates + AI enhancement)\n\n3. **Memory Consistency**\n   - Long sessions may have contradictions\n   - Need deduplication and conflict resolution\n   - Solution: Implement memory consolidation\n\n4. **Performance**\n   - Each Claude API call takes 1-3 seconds\n   - May slow down gameplay\n   - Solution: Async generation with streaming responses\n\n### Process Challenges\n\n1. **Subjective Quality**\n   - Narrative quality is subjective\n   - Hard to define \"good\" precisely\n   - Solution: Define concrete, measurable criteria\n\n2. **Test Scenario Limitations**\n   - Automated tests lack human player creativity\n   - May not represent real gameplay\n   - Solution: Include human playtest validation\n\n3. **Calibration Difficulty**\n   - Hard to know if scores are accurate\n   - Need human benchmark comparisons\n   - Solution: Review narrative samples manually\n\n---\n\n## Success Criteria Summary\n\n### Phase 1 (Diagnostic) - Complete When:\n- [x] Active narrative engine identified\n- [x] Prompt structure documented\n- [x] Memory retrieval strategy understood\n- [x] Quality scoring criteria extracted\n- [x] Baseline metrics established\n\n### Phase 2 (Quick Wins) - Complete When:\n- [ ] Quality scores improve to 3-5/10\n- [ ] Issue count reduces to 3-5 per scenario\n- [ ] At least 2 quick wins implemented\n- [ ] Improvements validated with test suite\n\n### Phase 3 (Structural) - Complete When:\n- [ ] Quality scores reach 5-7/10\n- [ ] Issue count reduces to 1-3 per scenario\n- [ ] Structured memory summaries implemented\n- [ ] Enhanced narrative prompts deployed\n\n### Phase 4 (Advanced) - Complete When:\n- [ ] Quality scores reach 7-9/10\n- [ ] Issue count < 2 per scenario\n- [ ] Plot thread tracking active\n- [ ] Relationship dynamics integrated\n- [ ] Production-ready narrative quality\n\n---\n\n## Notes & Observations\n\n### From Initial Testing\n\n**Current Behavior (1.0/10 scores):**\n- All scenarios score identically (1.0/10)\n- Issue count varies slightly (6-8 per scenario)\n- No apparent relationship between scenario type and score\n- Session errors eliminated but quality unchanged\n\n**This Suggests:**\n- Scoring may hit a \"floor\" value\n- Core narrative generation may be minimal\n- Context may not be reaching narrative engine\n- OR scoring rubric may be miscalibrated\n\n**Priority**: Start with P1.1 to understand generation pipeline\n\n---\n\n## Appendix: Test Commands\n\n### Run Diagnostic Tests\n```bash\n# Quick test with debug logging\nmvn package -DskipTests -q && \\\njava -jar party-lore-app/target/party-lore-app-1.0.0-SNAPSHOT.jar \\\n  --spring.profiles.active=autonomous-test \\\n  --suite=quick \\\n  --max-turns=10 \\\n  --debug \\\n  2>&1 | tee diagnostic-test.log\n\n# Analyze results\ngrep \"DIAGNOSTIC\\|quality score\\|issues found\" diagnostic-test.log\n```\n\n### Extract Issue Details\n```bash\n# Get issue breakdown\ngrep -A 10 \"Issue detected:\" test-log.log | head -50\n\n# Count issue types\ngrep \"MISSING_CONTEXT\\|MECHANICAL_ERROR\\|NARRATIVE_VACUUM\" test-log.log | \\\n  awk '{print $NF}' | sort | uniq -c\n\n# Get quality analysis details\ngrep -B 5 -A 15 \"Analyzing narrative quality\" test-log.log | head -100\n```\n\n### Compare Test Runs\n```bash\n# Before changes\ngrep \"quality score:\" baseline-test.log | \\\n  awk -F': ' '{print $3}' | \\\n  awk '{sum+=$1; count++} END {print \"Average:\", sum/count}'\n\n# After changes\ngrep \"quality score:\" improved-test.log | \\\n  awk -F': ' '{print $3}' | \\\n  awk '{sum+=$1; count++} END {print \"Average:\", sum/count}'\n```\n\n---\n\n## Document Maintenance\n\n**Last Updated**: October 11, 2025\n**Status**: Active Investigation\n**Owner**: Development Team\n**Review Cadence**: Weekly during active development\n\n**Change Log:**\n- 2025-10-11: Initial document creation after TASK-163 completion\n- [Future updates here]\n\n---\n\n**Next Action**: Begin P1.1 investigation to determine active narrative engine\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/NARRATIVE-QUALITY-IMPROVEMENT.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "memory",
        "test"
      ],
      "content_hash": "633661604f1b5cc8",
      "size_bytes": 24404,
      "created_at": "2026-01-02T20:42:12.439713"
    },
    {
      "doc_id": "local_party-lore_docs_archive_TASK-201-FINDINGS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/TASK-201-FINDINGS.md",
      "content": "# TASK-201 Domain Model Analysis\n\n## Architecture Review Findings\n\nAfter thorough review of TASK-196, TASK-198, FR-167, FR-168, and the domain model:\n\n### Correct Design (Already Implemented)\n1. **NarrativeHintEngine.generateHintsForNPC()** expects `Map<String, Object>` for personality ‚úÖ\n2. **PersonalityProfile** is ONLY for AIPlayer entities (JPA @Embeddable) ‚úÖ  \n3. **NPC** stores personality as JSON String in database, Map at runtime ‚úÖ\n4. **Tests work with domain.narrative DTOs**, not JPA entities directly ‚úÖ\n\n### ArcType Enum Values\n- ACTION, MYSTERY, SOCIAL, EXPLORATION, PERSONAL\n- ‚ùå No QUEST value exists\n\n### Correct API Methods\n- ‚úÖ `NarrativeHint.getTargetActorId()` (not getTargetNPC())\n- ‚úÖ `NarrativeHintBuilder.withSubtlety()` (not withSubtletyLevel())\n- ‚úÖ `Map.of(\"aggression\", 0.9)` for NPC personality (not entity setters)\n\n### Test Implementation Status\n\n**HintFilteringTest.java** - Can be fully fixed:\n- Uses NarrativeHintEngine with Map-based personality ‚úÖ\n- No AIPlayer dependencies ‚úÖ\n- Just needs API method corrections ‚úÖ\n\n**DualHintSystemIntegrationTest.java** - Blocked:\n- Requires AIPlayer.setTestHints() - not yet implemented ‚ùå\n- Needs test hint distribution system (future task) ‚ùå\n\n**StoryArcProgressionTest.java** - Blocked:  \n- Requires AIPlayer test hint system ‚ùå\n- Needs GameContext.setTestHints() ‚ùå\n\n### Recommendation\n1. Fix and enable HintFilteringTest.java immediately\n2. Keep other tests disabled until test hint system implemented\n3. All test logic is sound - just waiting on domain model features\n\n## Next Steps\n- Implement test hint storage on AIPlayer entity\n- Implement test hint distribution in AIActorService  \n- Then re-enable remaining 20 integration tests\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/TASK-201-FINDINGS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "md",
        "test"
      ],
      "content_hash": "33229eb8bfbadc22",
      "size_bytes": 1735,
      "created_at": "2026-01-02T20:42:12.439760"
    },
    {
      "doc_id": "local_party-lore_docs_archive_QUICK-WIN-1-FINAL",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/QUICK-WIN-1-FINAL.md",
      "content": "# Quick Win #1: Store GM Responses - IMPLEMENTED ‚úÖ\n\n**Date**: October 12, 2025\n**Status**: **CODE COMPLETE** (Testing blocked by secondary issue)\n\n---\n\n## Summary\n\nQuick Win #1 has been **successfully implemented** with a synchronous database operation approach. The fix in GameServiceImpl is complete and correct. Full testing is blocked by connection leaks in a different service (NarrativeGenerationService).\n\n---\n\n## The Fix\n\n### What Changed\n**File**: `party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java`\n\nChanged from async database operations (which leaked connections) to synchronous operations with proper transaction management.\n\n**Before** (‚ùå BROKEN):\n```java\nfutureResponse.thenApplyAsync(response -> {\n    playerActionUpdateService.updatePlayerActionResolution(...); // Fails in async thread\n});\n```\n\n**After** (‚úÖ FIXED):\n```java\nIntelligentNarrativeResponse response = futureResponse.join(); // Wait for Claude API\nstoreGMResponseToAction(playerActionId, response.getNarrativeContent()); // Store synchronously\n\n@Transactional(propagation = Propagation.REQUIRES_NEW)\nprivate void storeGMResponseToAction(UUID playerActionId, String narrativeContent) {\n    playerActionRepository.findById(playerActionId).ifPresent(action -> {\n        action.setResolutionOutcome(narrativeContent);\n        playerActionRepository.save(action);\n        log.info(\"‚úì Successfully stored GM response ({} chars) to action: {}\",\n            narrativeContent.length(), playerActionId);\n    });\n}\n```\n\n### Why This Works\n1. ‚úÖ `.join()` blocks until narrative generation completes (Claude API is the bottleneck anyway - 5-10s)\n2. ‚úÖ Synchronous database operation runs in main thread with proper transaction\n3. ‚úÖ No connection leaks from this code path\n4. ‚úÖ Database update is fast (<10ms) - negligible compared to Claude API time\n\n---\n\n## Testing Status\n\n### Build: ‚úÖ SUCCESS\n```bash\nmvn clean install -DskipTests\n# Build successful - all modules compile\n```\n\n### Runtime Test: ‚ö†Ô∏è BLOCKED BY SECONDARY ISSUE\n\n**Blocking Issue**: `NarrativeGenerationService` (different file) has connection leaks from its own async database operations:\n\n```\nConnection leak at com.partylore.memory.MemoryServiceImpl.storeNarrativeFragment\n    at NarrativeGenerationService.lambda$generateAdvancedNarrative$0 (line 124)\n```\n\nThis is **NOT a problem with our fix** - it's a separate issue in a different service that also needs the synchronous approach.\n\n---\n\n## Expected Impact (Once Unblocked)\n\n### Quality Scores\n- **Before**: 1.0/10 (transcripts missing GM responses)\n- **After**: 6-8/10 (complete transcripts)\n\n### Transcripts\n- **Before**: 50% complete (player actions only)\n- **After**: 100% complete (player actions + GM responses)\n\n### Issues Detected\n- **Before**: 6-8 critical issues (\"Zero GM Responses\", \"No Turn Structure\")\n- **After**: 1-3 minor issues (pacing, coherence)\n\n---\n\n## Next Steps to Unblock\n\n### Option 1: Quick Test (15 minutes)\nTemporarily disable memory storage in NarrativeGenerationService to test our fix:\n\n```java\n// In NarrativeGenerationService.java line 124, comment out:\n// storeNarrativeForLearning(...);\n```\n\nThis will let us validate that Quick Win #1 works correctly.\n\n### Option 2: Complete Fix (1-2 hours)\nApply the same synchronous approach to NarrativeGenerationService:\n\n```java\n// Change from:\n.thenApplyAsync(response -> { storeNarrativeForLearning(...); })\n\n// To:\nIntelligentNarrativeResponse response = future.join();\nstoreNarrativeForLearningSync(response);\n```\n\n---\n\n## Files Modified\n\n1. **party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java**\n   - Lines 191-224: Refactored `processPlayerActionAsync()`\n   - Lines 226-253: Added `storeGMResponseToAction()` method\n\n2. **party-lore-app/src/main/resources/application-autonomous-test.yml**\n   - Added HikariCP configuration (pool size 30, leak detection 60s)\n\n---\n\n## Conclusion\n\n‚úÖ **Quick Win #1 is COMPLETE and CORRECT**\n\nThe implementation:\n- Follows best practices (synchronous DB operations)\n- Has no connection leaks from this code path\n- Is well-documented and maintainable\n- Will work once NarrativeGenerationService is also fixed\n\n‚ö†Ô∏è Testing blocked by unrelated service - recommend Option 1 or 2 above to unblock.\n\n---\n\n**Last Updated**: October 12, 2025\n**Next Action**: Fix or disable NarrativeGenerationService async DB operations\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/QUICK-WIN-1-FINAL.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "md",
        "test"
      ],
      "content_hash": "4ff7ab267337c2af",
      "size_bytes": 4382,
      "created_at": "2026-01-02T20:42:12.439871"
    },
    {
      "doc_id": "local_party-lore_docs_archive_ARCHITECTURAL-FINDINGS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/ARCHITECTURAL-FINDINGS.md",
      "content": "# Architectural Findings - Test Quality Investigation\n\n**Date:** 2025-10-11\n**Investigation:** TASK-163 Autonomous Test Quality Issues\n**Status:** Deep root cause identified, requires architectural refactoring\n\n---\n\n## Executive Summary\n\nThrough comprehensive testing and fixing, we discovered a **fundamental architectural issue** with transaction boundaries and async operations that prevents memory accumulation and causes \"Session not found\" errors.\n\n**Quality Score Results:**\n- **Before any fixes:** 1.2-1.8/10\n- **After all fixes:** 1.2-1.8/10 (one scenario reached 1.8, showing fixes CAN work)\n- **Root Cause:** Transaction isolation prevents async operations from seeing session data\n\n---\n\n## The Core Problem\n\n### Issue: Class-Level @Transactional + Async Operations\n\n```java\n@Service\n@Transactional  // ‚Üê THIS IS THE PROBLEM\npublic class GameServiceImpl implements GameService {\n\n    public void processPlayerAction(...) {\n        // STEP 1: Store action (writes to DB)\n        PlayerAction action = storePlayerAction(...);\n\n        // STEP 2: Flush (forces DB write)\n        entityManager.flush();  // ‚Üê This writes to DB...\n\n        // STEP 3: Async narrative generation\n        CompletableFuture<Response> future = narrativeService.generate(...);\n\n        // STEP 4: Async delivery (DIFFERENT THREAD)\n        future.thenAccept(response -> {\n            deliveryOrchestrator.deliver(response, context);  // ‚Üê But THIS can't see it!\n        });\n    }\n    // ‚Üê Transaction commits HERE (after method returns)\n}\n```\n\n**Why It Fails:**\n1. Class-level `@Transactional` means entire method is ONE transaction\n2. `entityManager.flush()` writes to DB but doesn't COMMIT transaction\n3. Async operations in different threads can't see uncommitted data\n4. DeliveryOrchestrator tries to load session ‚Üí \"Session not found\"\n5. MemoryService tries to store fragments ‚Üí \"Session not found\"\n6. **Result:** No memory accumulation, poor narrative quality\n\n---\n\n## What We Fixed (Successfully)\n\nAll these fixes ARE working and WILL improve quality once session lifecycle is resolved:\n\n### ‚úÖ P0 Fixes (Implemented)\n1. **Fallback Context Detection** (GameContextAssembler)\n   - Now requires 100+ chars of meaningful content\n   - Detects empty field patterns\n   - Will trigger once session lifecycle is fixed\n\n2. **Session Lifecycle - Flush** (GameServiceImpl + AutonomousTestingService)\n   - Added `entityManager.flush()` before async operations\n   - Ensures DB writes happen\n   - **Limitation:** Doesn't commit transaction (see root cause above)\n\n### ‚úÖ P1 Fixes (Implemented)\n1. **Sonnet 4.5 for Quality Analysis** (NarrativeQualityAnalysisService)\n   - Changed from deprecated `getDefaultForAnalysis()` to `getMostCapable()`\n   - Verified in bytecode - IS being used\n   - Provides accurate quality assessment\n\n2. **Mechanical Error Detection** (IssueDetectionService)\n   - Validates combat (impossible crits, negative damage)\n   - Validates resources (negative HP without death)\n   - Validates skill checks (contradictory outcomes)\n\n3. **MemoryServiceImpl Logging** (MemoryServiceImpl)\n   - Logs context generation with char counts\n   - Logs session lookups\n   - Provides debugging visibility\n\n### ‚úÖ P2 Fixes (Implemented)\n1. **90s Claude Timeout** (application-autonomous-test.yml)\n   - Increased from 30s to 90s\n   - AutoFixService now completes successfully (was timing out before)\n\n2. **Initial Narrative Memory** (AutonomousTestingService)\n   - Creates plot threads with importance 7\n   - Sets campaign phase to ACT1\n   - Provides starter context\n   - **Note:** This is test-specific, correctly placed\n\n3. **DEBUG Logging** (application-autonomous-test.yml)\n   - Enabled for memory, context, quality services\n   - Provided full visibility into issues\n\n---\n\n## Architectural Lessons Learned\n\n### Critical Distinction: Test Code vs Production Code\n\n**GOLDEN RULE:** If production users would hit this issue, fix it in PRODUCTION code!\n\n#### Production Issues (Fix in GameServiceImpl, etc.)\n- ‚úÖ Session lifecycle\n- ‚úÖ Transaction boundaries\n- ‚úÖ Memory context generation\n- ‚úÖ Async operation coordination\n- ‚úÖ Narrative quality\n\n#### Test-Only Issues (Fix in AutonomousTestingService)\n- ‚úÖ Test scenario initialization\n- ‚úÖ Test data setup\n- ‚úÖ AI player creation\n\n**What We Learned:**\nInitial fixes were placed in AutonomousTestingService (test code), but the REAL bug is in GameServiceImpl (production code). Tests exposed the production bug!\n\n---\n\n## The Real Solution (Requires Refactoring)\n\n### Option A: Remove Class-Level @Transactional (Recommended)\n\n```java\n@Service\n// @Transactional  ‚Üê REMOVE THIS\npublic class GameServiceImpl implements GameService {\n\n    @Transactional(propagation = Propagation.REQUIRES_NEW)\n    public void processPlayerAction(...) {\n        // STEP 1: Store action and context\n        PlayerAction action = storePlayerAction(...);\n\n        // STEP 2: Context assembly\n        GameContext context = contextAssembler.assembleContext(...);\n\n        // Transaction commits HERE when method ends\n    }\n    // ‚Üê Transaction is NOW committed\n\n    // STEP 3: Trigger async narrative generation (AFTER commit)\n    triggerAsyncNarrativeGeneration(context);  // Separate method, NO transaction\n}\n```\n\n**Benefits:**\n- Session/actions committed before async operations\n- Async operations can see committed data\n- Memory fragments can be stored\n- Cleaner transaction boundaries\n\n---\n\n### Option B: Use @TransactionalEventListener\n\n```java\n@Service\n@Transactional\npublic class GameServiceImpl implements GameService {\n\n    public void processPlayerAction(...) {\n        PlayerAction action = storePlayerAction(...);\n        GameContext context = contextAssembler.assembleContext(...);\n\n        // Publish event AFTER transaction commits\n        applicationEventPublisher.publishEvent(\n            new ActionStoredEvent(context, action)\n        );\n    }\n}\n\n@Component\npublic class NarrativeGenerationListener {\n\n    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)\n    public void handleActionStored(ActionStoredEvent event) {\n        // This runs AFTER transaction commits\n        CompletableFuture<Response> future = narrativeService.generate(...);\n        future.thenAccept(response -> {\n            deliveryOrchestrator.deliver(response, event.getContext());\n        });\n    }\n}\n```\n\n**Benefits:**\n- Preserves existing structure\n- Event-driven architecture\n- Clear transaction boundaries\n- Testable\n\n---\n\n### Option C: Synchronous Delivery (Quick Fix, Not Recommended)\n\nWait for async operations before returning:\n\n```java\npublic void processPlayerAction(...) {\n    PlayerAction action = storePlayerAction(...);\n    GameContext context = contextAssembler.assembleContext(...);\n\n    CompletableFuture<Response> future = narrativeService.generate(...);\n\n    // WAIT for completion before transaction commits\n    Response response = future.join();  // Blocks until complete\n    deliveryOrchestrator.deliver(response, context);\n\n    // Transaction commits here with everything done\n}\n```\n\n**Drawbacks:**\n- Blocks user action processing\n- Defeats purpose of async\n- Slower response times\n\n---\n\n## Files Modified (All Staged)\n\n### Production Code Fixes\n1. `party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java`\n   - Added EntityManager injection\n   - Added flush before async operations\n   - **Needs:** Transaction refactoring (Option A or B above)\n\n2. `party-lore-game/src/main/java/com/partylore/game/context/GameContextAssembler.java`\n   - Enhanced fallback detection (< 100 chars, empty patterns)\n   - Added buildFallbackContext() method\n   - **Working:** Ready to trigger when session lifecycle fixed\n\n3. `party-lore-ai/src/main/java/com/partylore/ai/quality/NarrativeQualityAnalysisService.java`\n   - Using Sonnet 4.5 for analysis (lines 85, 123)\n   - **Working:** Verified in bytecode\n\n4. `party-lore-ai/src/main/java/com/partylore/ai/quality/IssueDetectionService.java`\n   - Implemented mechanical error validation\n   - **Working:** Detecting errors\n\n5. `party-lore-memory/src/main/java/com/partylore/memory/MemoryServiceImpl.java`\n   - Added debug logging for context generation\n   - **Working:** Providing visibility\n\n6. `party-lore-app/src/main/resources/application-autonomous-test.yml`\n   - 90s timeout, DEBUG logging\n   - **Working:** AutoFixService completing\n\n### Test Code Fixes (Correctly Placed)\n7. `party-lore-game/src/main/java/com/partylore/game/testing/AutonomousTestingService.java`\n   - Initialize narrative memory with starter data\n   - Flush after scenario creation\n   - **Working:** Test-specific setup\n\n### Documentation/Guidance\n8. `.claude/commands/test.md`\n   - Added architectural guidance\n   - Production vs test code classification\n\n9. `party-lore-game/src/main/java/com/partylore/game/testing/AutoFixService.java`\n   - Updated system prompt with architectural guidance\n   - **Working:** Will guide future fix recommendations\n\n10. `TEST-ANALYSIS-FINAL.md` (new)\n11. `ARCHITECTURAL-FINDINGS.md` (this document)\n\n---\n\n## Recommendations\n\n### Immediate (To Fix Quality Issues)\n1. **Implement Option A** (remove class-level @Transactional)\n   - Cleanest solution\n   - Best practice for async operations\n   - Requires refactoring GameServiceImpl\n\n2. **Re-run tests** after transaction refactoring\n   - Should see dramatic quality improvement\n   - Memory accumulation will work\n   - \"Session not found\" errors eliminated\n\n### Short-Term (Code Quality)\n3. **Apply all staged fixes** - They're correct and will work once transactions are fixed\n4. **Add integration test** for session lifecycle\n5. **Document transaction boundaries** in code\n\n### Long-Term (Architecture)\n6. **Review all @Transactional usage** - Ensure proper boundaries\n7. **Event-driven architecture** - Consider for other async operations\n8. **Monitoring** - Track \"Session not found\" errors in production\n\n---\n\n## What This Proves\n\n**Tests ARE working as designed!**\nThe autonomous test suite successfully:\n- ‚úÖ Detected the real production bug\n- ‚úÖ Exposed transaction architecture issues\n- ‚úÖ Validated fixes work (when conditions allow)\n- ‚úÖ Provided clear diagnostic information\n\n**One scenario improved to 1.8/10** (50% improvement), proving:\n- Fixes are correct\n- Quality CAN improve\n- Session lifecycle is the only blocker\n\n---\n\n## Next Steps\n\n**Option 1: Commit what we have + document issue**\n- All fixes are correct\n- Architectural issue documented\n- Ready for transaction refactoring\n\n**Option 2: Fix transactions first, then commit everything**\n- Requires refactoring GameServiceImpl\n- Will show dramatic quality improvement\n- More complete solution\n\n**Recommendation:** Option 2 - Fix the root cause, see quality improve, then commit everything together with confidence.\n\n---\n\n**Date:** 2025-10-11\n**Author:** Claude (Anthropic)\n**Status:** Investigation complete, root cause identified, solution designed\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/ARCHITECTURAL-FINDINGS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "async",
        "md",
        "memory",
        "test"
      ],
      "content_hash": "77f2bb2bbc98c819",
      "size_bytes": 10897,
      "created_at": "2026-01-02T20:42:12.439909"
    },
    {
      "doc_id": "local_party-lore_docs_archive_TEST-ANALYSIS-FINAL",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/TEST-ANALYSIS-FINAL.md",
      "content": "# Test Analysis - Post-Fix Verification\n**Date:** 2025-10-11\n**Test Run:** Quick Suite (--max-turns=5) with ALL P0-P2 fixes applied\n**Scenarios Executed:** 3 scenarios (Basic Combat, Solo Exploration, Coordinated Combat)\n\n---\n\n## Executive Summary\n\n**‚ùå QUALITY SCORES DID NOT IMPROVE**\n- **Previous:** 1.2-1.8/10\n- **Current:** 1.2/10 (all 3 scenarios)\n- **Target:** 5-7/10\n- **Status:** NO CHANGE - Scores remain critically low\n\n**Fixes Implemented and Verified:**\n1. ‚úÖ Fallback context in GameContextAssembler - **WORKING** (but not triggered)\n2. ‚úÖ Use Sonnet 4.5 for quality analysis - **WORKING** (getMostCapable() in bytecode)\n3. ‚úÖ Mechanical error detection - **WORKING** (found issues)\n4. ‚úÖ 90s Claude API timeout - **WORKING** (AutoFixService completed)\n5. ‚úÖ DEBUG logging enabled - **WORKING** (detailed logs present)\n\n---\n\n## Issue Detection Report\n\n### Issues Found (3 scenarios)\n- **MECHANICAL_ERROR (CRITICAL):** 3 instances\n- **MISSING_CONTEXT (CRITICAL):** 3 instances\n\n**Same pattern as before** - No reduction in issue frequency\n\n---\n\n## Root Cause Analysis - The REAL Problem\n\n### Finding #1: MemoryService DOES Return Data (But It's Insufficient)\n\n**Evidence:**\n- ‚úÖ GameContextAssembler assembles context in 27-98ms\n- ‚úÖ NO \"using fallback\" warnings\n- ‚úÖ MemoryServiceImpl.generateContextSummary() successfully called\n- ‚ùå **BUT** - The context returned is likely minimal/empty\n\n**What's happening:**\n```java\n// Our fallback check:\nif (aiContextSummary == null || aiContextSummary.isBlank() ||\n    aiContextSummary.contains(\"stub\") || aiContextSummary.contains(\"No session data available\"))\n```\n\n**Problem:** MemoryServiceImpl returns something like:\n```\n\"Campaign Phase: null\\n\"\n```\n\nThis passes all our checks (not null, not blank, doesn't contain \"stub\"), but contains NO useful context!\n\n**Solution Needed:**\n- Make fallback check MORE aggressive\n- Check for meaningful content, not just non-empty strings\n- Add minimum length requirement (e.g., > 50 chars)\n\n---\n\n### Finding #2: Session Lifecycle Issue is BLOCKING Everything\n\n**Evidence from logs:**\n```\nSession not found for narrative fragment storage: 7fe5e074-b348-4e32-9810-e3adda076285\nError handling narrative response: Session not found\n```\n\n**Impact:**\n- Narratives ARE generated (752-1262 chars)\n- Delivery FAILS (session not found in DeliveryOrchestrator)\n- Memory fragments CANNOT be stored\n- Each action operates with NO historical context\n\n**Root Cause:** Test scenarios create sessions that aren't properly persisted before async narrative generation completes.\n\n**Solution Needed:**\n- Fix test scenario session creation/persistence\n- Ensure sessions are committed to DB before generating narratives\n- Add proper transaction boundaries\n\n---\n\n### Finding #3: Sonnet IS Being Used (Quality Analysis is Accurate)\n\n**Evidence:**\n- Bytecode shows `getMostCapable()` is compiled\n- No errors in quality analysis\n- Scores are consistent (all 1.2/10)\n\n**Conclusion:** Sonnet is correctly reporting that narratives are genuinely poor quality. The 1.2/10 score is ACCURATE, not a model problem.\n\n---\n\n## Why Quality Didn't Improve\n\nOur fixes addressed **analysis** and **detection**, but the **ROOT CAUSE** is:\n\n1. **Session lifecycle breaks memory storage** ‚Üí No context accumulation\n2. **Minimal context from MemoryService** ‚Üí Narratives lack depth\n3. **Delivery failures** ‚Üí Players never see responses (in production)\n\n**The narrative GENERATION is broken, not the analysis!**\n\n---\n\n## Recommendations - Priority Order\n\n### P0 - CRITICAL (Fix Immediately)\n\n**1. Fix Session Lifecycle in Test Scenarios**\n```java\n// In AutonomousTestingService or TestScenarioGenerator\n@Transactional\npublic TestScenario createScenario() {\n    // Create session\n    GameSession session = new GameSession();\n    session = sessionRepository.save(session);\n\n    // FLUSH to ensure DB persistence BEFORE async operations\n    sessionRepository.flush();\n\n    // Now safe to generate narratives asynchronously\n}\n```\n\n**Files to modify:**\n- `party-lore-game/src/main/java/com/partylore/game/testing/AutonomousTestingService.java`\n- `party-lore-game/src/main/java/com/partylore/game/testing/TestScenarioGenerator.java`\n\n**Impact:** This single fix would eliminate \"Session not found\" errors and allow memory accumulation.\n\n---\n\n**2. Improve Fallback Context Detection**\n```java\n// GameContextAssembler.java:93\nif (aiContextSummary == null || aiContextSummary.isBlank() ||\n    aiContextSummary.contains(\"stub\") ||\n    aiContextSummary.contains(\"No session data available\") ||\n    aiContextSummary.length() < 100 ||  // NEW: Check for meaningful length\n    aiContextSummary.matches(\"Campaign Phase: null.*\")) {  // NEW: Detect empty data\n\n    log.warn(\"MemoryService returned insufficient context (length: {}), using fallback\",\n             aiContextSummary != null ? aiContextSummary.length() : 0);\n    aiContextSummary = buildFallbackContext(session, currentScene, recentMemories);\n}\n```\n\n**Impact:** Ensures narratives ALWAYS have rich context, even when MemoryService returns minimal data.\n\n---\n\n### P1 - HIGH (Fix Soon)\n\n**3. Add Transaction Boundaries to Narrative Generation**\n```java\n// GameServiceImpl.java\n@Transactional(propagation = Propagation.REQUIRES_NEW)\npublic CompletableFuture<String> processPlayerAction(...) {\n    // Ensure session is committed before async narrative generation\n}\n```\n\n**4. Debug MemoryServiceImpl Context Generation**\n- Add logging to show EXACTLY what context is being returned\n- Verify plot threads, memory fragments are being loaded\n- Check NarrativeMemory table for data\n\n---\n\n### P2 - MEDIUM (Nice to Have)\n\n**5. Improve Test Scenario Data Setup**\n- Pre-populate plot threads for richer context\n- Create initial memory fragments\n- Set campaign phase to non-null value\n\n---\n\n## What Our Fixes DID Accomplish\n\nDespite quality scores not improving, our fixes ARE working:\n\n1. ‚úÖ **Fallback context ready** - Will trigger once we improve detection\n2. ‚úÖ **Sonnet analysis** - Giving us accurate quality assessment\n3. ‚úÖ **Mechanical validation** - Detecting errors (though narratives still have them)\n4. ‚úÖ **90s timeout** - AutoFixService completing successfully\n5. ‚úÖ **DEBUG logging** - Providing visibility into the real problems\n\n**The fixes weren't wrong - they just revealed DEEPER issues!**\n\n---\n\n## Next Steps\n\n**Immediate Actions:**\n1. Implement P0 fixes (session lifecycle + better fallback detection)\n2. Re-run tests to verify improvement\n3. If quality scores still low, investigate narrative generation prompts\n\n**Don't Commit Yet:** Wait until we see quality scores improve to 5-7/10 range.\n\n---\n\n## Conclusion\n\nThe test quality issues are NOT caused by:\n- ‚ùå Wrong Claude model (Sonnet is correct)\n- ‚ùå Missing context detection (detection is working)\n- ‚ùå Mechanical validation (validation is working)\n\nThe REAL issues are:\n- ‚úÖ Session lifecycle breaking memory accumulation\n- ‚úÖ Minimal context from MemoryService passing our checks\n- ‚úÖ Narrative generation operating with NO historical context\n\n**Fix the session lifecycle first, then re-test.**\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/TEST-ANALYSIS-FINAL.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "test"
      ],
      "content_hash": "0ef6c471ee211729",
      "size_bytes": 7093,
      "created_at": "2026-01-02T20:42:12.440135"
    },
    {
      "doc_id": "local_party-lore_docs_archive_NARRATIVE_GENERATOR_FIX",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/NARRATIVE_GENERATOR_FIX.md",
      "content": "# Opening Narrative Generator - Fixed\n\n## The Problem\n\nWhen testing the complete E2E flow, the opening narrative was **terrible**:\n\n```\nüé≠ THE STORY BEGINS...\n\nA new chapter begins in Ashen Crowns. The Adventure Begins spreads before you,\nfull of mystery and opportunity. The world awaits your actions. Where will your\nstory lead?\n\nWhat do you do?\n```\n\n**This is generic template garbage with:**\n- No actual story content\n- No character context\n- No setting details\n- No dramatic hook\n- No tension or intrigue\n- Only 170 characters (pathetically short!)\n\n## Root Cause Analysis\n\n### File: `GameStartedEventListener.java:89`\n\nThe event listener was **hardcoded** to use the fallback template instead of calling the AI:\n\n```java\n// OLD CODE (BROKEN):\nopeningNarrative = openingNarrativeGenerator.generateFallbackOpening(currentScene, game);\n```\n\nThis method just returns a boring template based on scene type - **NO AI GENERATION AT ALL!**\n\n### Why This Existed\n\nThe actual AI-powered `generateOpeningNarrative()` method exists and works, but it was never being called! The code was using the fallback that's only supposed to be used when the AI fails.\n\n## The Fix\n\n### 1. Call the REAL AI Generator\n\n**File**: `party-lore-app/src/main/java/com/partylore/app/gameplay/GameStartedEventListener.java`\n\nChanged from calling the fallback template to actually using AI:\n\n```java\n// NEW CODE (FIXED):\n// Build game context for AI generation\nUUID firstPlayerId = game.getPlayers().isEmpty()\n    ? null\n    : game.getPlayers().iterator().next().getId();\n\nGameContext gameContext = gameContextAssembler.assembleContext(game.getId(), firstPlayerId);\n\n// Generate REAL AI narrative (not fallback template!)\ntry {\n    openingNarrative = openingNarrativeGenerator.generateOpeningNarrativeSync(\n        currentScene, game, gameContext);\n    currentScene.setOpeningNarrative(openingNarrative);\n    sceneRepository.save(currentScene);\n    logger.info(\"Opening narrative generated ({} chars)\", openingNarrative.length());\n} catch (Exception e) {\n    logger.error(\"AI narrative generation failed, using fallback\", e);\n    openingNarrative = openingNarrativeGenerator.generateFallbackOpening(currentScene, game);\n    currentScene.setOpeningNarrative(openingNarrative);\n    sceneRepository.save(currentScene);\n    logger.warn(\"Using fallback narrative ({} chars)\", openingNarrative.length());\n}\n```\n\nNow it:\n1. ‚úÖ Builds proper game context with all characters, realm info, etc.\n2. ‚úÖ Calls the AI to generate REAL narrative\n3. ‚úÖ Only uses fallback if AI actually fails (with error logging)\n\n### 2. Increase Narrative Length\n\n**File**: `party-lore-game/src/main/java/com/partylore/game/scene/OpeningNarrativeGenerator.java`\n\nChanged the request to ask for much more content:\n\n```java\n// OLD:\n.targetResponseLength(800) // Longer for scene establishment\n.currentNarrativeTone(\"atmospheric\")\n\n// NEW:\n.targetResponseLength(2400) // Longer - can span multiple SMS (up to 3 messages)\n.currentNarrativeTone(\"atmospheric, dramatic, immersive\")\n```\n\n### 3. Better AI Prompt\n\nAdded explicit instructions to generate engaging content:\n\n```java\n.playerActions(List.of(\"[SCENE OPENING - Generate rich, immersive opening narrative with vivid details, character introductions, and immediate hooks. This is the first thing players see - make it captivating!]\"))\n```\n\n## Expected Results\n\nWith these fixes, the opening narrative should now:\n\n1. **Be AI-generated** - Not a template!\n2. **Be much longer** - Up to 2400 characters (2-3 SMS messages worth)\n3. **Include vivid details** - Scene descriptions, character introductions\n4. **Have dramatic hooks** - Immediate engagement, tension, intrigue\n5. **Set the tone** - Atmospheric and immersive from the start\n\nInstead of:\n> \"A new chapter begins in Ashen Crowns...\"\n\nYou'll get something like:\n> \"The ancient gates of Thornkeep loom before you, their iron hinges groaning in the bitter wind. Thorin, the Knight Commander, feels the weight of his ancestral sword at his hip - the same blade that defended these walls generations ago, before the darkness came. Sarah, the master Spymaster, notices the ravens circling overhead, their cries carrying an omen she's learned never to ignore...\"\n\n(etc. for 2400 characters of actual story!)\n\n## Files Modified\n\n1. `party-lore-app/src/main/java/com/partylore/app/gameplay/GameStartedEventListener.java`\n   - Added GameContextAssembler dependency\n   - Changed to call AI generation instead of fallback\n   - Added proper error handling\n\n2. `party-lore-game/src/main/java/com/partylore/game/scene/OpeningNarrativeGenerator.java`\n   - Increased target length from 800 ‚Üí 2400 characters\n   - Improved AI prompt with explicit instructions\n   - Enhanced narrative tone specification\n\n## Testing\n\nThe E2E test (`CompleteGameplayFlowE2ETest`) will now show REAL AI-generated narratives in the output, not that lame template.\n\nRun it to verify the opening narrative is actually good:\n\n```bash\nmvn test -Dtest=CompleteGameplayFlowE2ETest -pl party-lore-app\n```\n\nLook for the log line:\n```\nOpening narrative generated (XXXX chars)\n```\n\nWhere XXXX should be much larger than 170 chars!\n\n---\n\n**Date**: 2025-10-18\n**Issue**: Hardcoded fallback template instead of AI generation\n**Impact**: Every new game started with boring, generic text\n**Status**: ‚úÖ Fixed - Now uses real AI narrative generation\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/NARRATIVE_GENERATOR_FIX.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "await",
        "md",
        "test"
      ],
      "content_hash": "b9b67de857521300",
      "size_bytes": 5352,
      "created_at": "2026-01-02T20:42:12.440173"
    },
    {
      "doc_id": "local_party-lore_docs_archive_BETA-REMOVAL",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/BETA-REMOVAL.md",
      "content": "# Beta Access Control System - Removal Guide\n\n**Purpose**: This document provides step-by-step instructions for removing the beta access control system when Party Lore goes public.\n\n**Estimated Time**: 30-45 minutes\n\n---\n\n## Overview\n\nThe beta access control system is designed to be easily removable. It consists of:\n- **13 Java files** in dedicated beta packages\n- **1 database migration** (can be reversed)\n- **1 integration point** (SmsWebhookController)\n- **Configuration sections** in 4 YAML files\n\nAll beta-related code is isolated and clearly marked with comments:\n```\n// Part of the beta access control system - can be removed when going public\n```\n\n---\n\n## Step 1: Delete Service Files (10 files)\n\nDelete the entire beta service package:\n\n```bash\ncd party-lore-app/src/main/java/com/partylore/app/service\nrm -rf beta/\n```\n\nThis removes:\n- `BetaAccessGatekeeper.java` - Entry point validator\n- `BetaAccessService.java` - Access management\n- `InviteCodeService.java` - Code generation/validation\n- `WaitlistService.java` - Waitlist management\n- `BetaAccessResult.java` - Result wrapper\n\n---\n\n## Step 2: Delete Configuration (1 file)\n\n```bash\ncd party-lore-app/src/main/java/com/partylore/app/config\nrm BetaConfig.java\n```\n\n---\n\n## Step 3: Delete Domain Models (5 files)\n\n```bash\ncd party-lore-domain/src/main/java/com/partylore/domain/model\n\nrm BetaUser.java\nrm BetaUserStatus.java\nrm InviteCode.java\nrm InviteType.java\nrm WaitlistEntry.java\nrm WaitlistStatus.java\n```\n\n---\n\n## Step 4: Delete Repositories (3 files)\n\n```bash\ncd party-lore-domain/src/main/java/com/partylore/domain/repository\n\nrm BetaUserRepository.java\nrm InviteCodeRepository.java\nrm WaitlistRepository.java\n```\n\n---\n\n## Step 5: Remove Integration Point\n\nEdit `party-lore-sms/src/main/java/com/partylore/sms/controller/SmsWebhookController.java`:\n\n### Remove imports:\n```java\n// DELETE these imports\nimport com.partylore.app.service.beta.BetaAccessGatekeeper;\nimport com.partylore.app.service.beta.BetaAccessResult;\nimport com.partylore.game.ActionSource;\n```\n\n### Remove field and constructor parameter:\n```java\n// DELETE this field\nprivate final BetaAccessGatekeeper betaGatekeeper;\n\n// DELETE betaGatekeeper parameter from constructor\n@Autowired\npublic SmsWebhookController(MessageProcessor messageProcessor,\n                           TwilioSmsService twilioSmsService,\n                           PhoneNumberPoolService phoneNumberPoolService,\n                           // DELETE: BetaAccessGatekeeper betaGatekeeper,\n                           @Value(\"${twilio.auth-token}\") String authToken) {\n    // ...\n    // DELETE: this.betaGatekeeper = betaGatekeeper;\n}\n```\n\n### Remove beta access check in `handleIncomingSms()`:\n```java\n// DELETE entire beta access check block (lines ~98-135)\n// From:\n//     // BETA ACCESS CHECK - validate user has beta access\n//     Optional<String> accessError = betaGatekeeper.validateAccess(...);\n//     ...\n//     }\n// To: Just keep the message processing line:\n\n// Access granted - process the incoming message through the message routing system\nIncomingSMSMessage incomingMessage = messageProcessor.processIncomingMessage(from, to, body, twilioMessageSid);\n```\n\n**Result**: The controller should go directly from validating parameters to processing the message.\n\n---\n\n## Step 6: Remove Configuration Sections\n\n### application.yml\n\nDelete the beta configuration section:\n\n```yaml\n# DELETE this entire section (lines 126-140)\n  # =======================================================================\n  # BETA ACCESS CONTROL CONFIGURATION\n  # =======================================================================\n  # This section can be removed when going public\n  beta:\n    enabled: ${BETA_MODE_ENABLED:true}\n    enforce-for-sources:\n      - SMS_WEBHOOK\n      - API\n    exempt-sources:\n      - CONSOLE\n      - AI_TEST\n    capacity:\n      max-users: ${BETA_MAX_USERS:100}\n      daily-limit: ${BETA_DAILY_LIMIT:10}\n```\n\n### application-dev.yml\n\nDelete:\n```yaml\n# DELETE this section\nparty-lore:\n  beta:\n    enabled: false\n```\n\n### application-test.yml\n\nDelete:\n```yaml\n# DELETE this section\nparty-lore:\n  beta:\n    enabled: true\n    capacity:\n      max-users: 1000\n      daily-limit: 1000\n```\n\n### application-prod.yml\n\nDelete:\n```yaml\n# DELETE this section\nparty-lore:\n  beta:\n    enabled: ${BETA_MODE_ENABLED:true}\n    capacity:\n      max-users: ${BETA_MAX_USERS:100}\n      daily-limit: ${BETA_DAILY_LIMIT:10}\n```\n\n---\n\n## Step 7: Database Cleanup\n\n### Option A: Drop Tables (Production - One-Time)\n\nCreate and run migration `V999__Drop_beta_tables.sql`:\n\n```sql\n-- Drop beta access tables\nDROP TABLE IF EXISTS beta_users CASCADE;\nDROP TABLE IF EXISTS beta_waitlist CASCADE;\nDROP TABLE IF EXISTS beta_invite_codes CASCADE;\n```\n\nRun migration:\n```bash\n./mvnw flyway:migrate -Dflyway.configFiles=flyway-prod.conf\n```\n\n### Option B: Keep Historical Data (Optional)\n\nIf you want to preserve beta user data for analytics:\n\n1. Export data before dropping:\n```sql\nCOPY beta_users TO '/tmp/beta_users_export.csv' CSV HEADER;\nCOPY beta_invite_codes TO '/tmp/beta_invite_codes_export.csv' CSV HEADER;\nCOPY beta_waitlist TO '/tmp/beta_waitlist_export.csv' CSV HEADER;\n```\n\n2. Then drop tables as in Option A.\n\n---\n\n## Step 8: Delete Integration Tests\n\n```bash\n# If beta-specific integration tests exist\nfind . -name \"*BetaAccess*Test.java\" -type f -delete\n```\n\n---\n\n## Step 9: Verification\n\n### Search for remaining references:\n```bash\n# Should find NO results\ngrep -r \"beta\" src/main/java --include=\"*.java\" | grep -i \"access\"\ngrep -r \"BetaGatekeeper\" src/main/java --include=\"*.java\"\ngrep -r \"BetaConfig\" src/main/java --include=\"*.java\"\n```\n\n### Verify compilation:\n```bash\n./mvnw clean compile\n```\n\n### Verify tests pass:\n```bash\n./mvnw test\n```\n\n### Verify database migrations work:\n```bash\n./mvnw flyway:info\n./mvnw flyway:validate\n```\n\n---\n\n## Step 10: Cleanup This Document\n\nDelete this removal guide:\n```bash\nrm BETA-REMOVAL.md\n```\n\n---\n\n## Summary Checklist\n\n- [ ] Deleted `party-lore-app/src/main/java/com/partylore/app/service/beta/` directory (5 files)\n- [ ] Deleted `BetaConfig.java` from config package (1 file)\n- [ ] Deleted beta domain models (6 files: BetaUser, BetaUserStatus, InviteCode, InviteType, WaitlistEntry, WaitlistStatus)\n- [ ] Deleted beta repositories (3 files)\n- [ ] Removed imports from `SmsWebhookController.java`\n- [ ] Removed `betaGatekeeper` field and constructor parameter\n- [ ] Removed beta access check from `handleIncomingSms()` method\n- [ ] Removed beta configuration from `application.yml`\n- [ ] Removed beta configuration from `application-dev.yml`\n- [ ] Removed beta configuration from `application-test.yml`\n- [ ] Removed beta configuration from `application-prod.yml`\n- [ ] Created and ran `V999__Drop_beta_tables.sql` migration\n- [ ] Verified no remaining references with grep\n- [ ] Compiled successfully\n- [ ] All tests pass\n- [ ] Deleted BETA-REMOVAL.md\n\n---\n\n## Files Deleted Summary\n\n**Total: 19 files**\n\n1. `party-lore-app/src/main/java/com/partylore/app/service/beta/BetaAccessGatekeeper.java`\n2. `party-lore-app/src/main/java/com/partylore/app/service/beta/BetaAccessService.java`\n3. `party-lore-app/src/main/java/com/partylore/app/service/beta/InviteCodeService.java`\n4. `party-lore-app/src/main/java/com/partylore/app/service/beta/WaitlistService.java`\n5. `party-lore-app/src/main/java/com/partylore/app/service/beta/BetaAccessResult.java`\n6. `party-lore-app/src/main/java/com/partylore/app/config/BetaConfig.java`\n7. `party-lore-domain/src/main/java/com/partylore/domain/model/BetaUser.java`\n8. `party-lore-domain/src/main/java/com/partylore/domain/model/BetaUserStatus.java`\n9. `party-lore-domain/src/main/java/com/partylore/domain/model/InviteCode.java`\n10. `party-lore-domain/src/main/java/com/partylore/domain/model/InviteType.java`\n11. `party-lore-domain/src/main/java/com/partylore/domain/model/WaitlistEntry.java`\n12. `party-lore-domain/src/main/java/com/partylore/domain/model/WaitlistStatus.java`\n13. `party-lore-domain/src/main/java/com/partylore/domain/repository/BetaUserRepository.java`\n14. `party-lore-domain/src/main/java/com/partylore/domain/repository/InviteCodeRepository.java`\n15. `party-lore-domain/src/main/java/com/partylore/domain/repository/WaitlistRepository.java`\n16. `party-lore-domain/src/main/resources/db/migration/V034__Create_beta_access_tables.sql` (archived, not deleted)\n17. `party-lore-domain/src/main/resources/db/migration/V999__Drop_beta_tables.sql` (new, for cleanup)\n18. `BETA-REMOVAL.md` (this file)\n19. Any beta integration tests\n\n**Files Modified**: 1\n- `party-lore-sms/src/main/java/com/partylore/sms/controller/SmsWebhookController.java` (~40 lines removed)\n\n**Configuration Changes**: 4 files\n- `application.yml` - Remove beta section\n- `application-dev.yml` - Remove beta section\n- `application-test.yml` - Remove beta section\n- `application-prod.yml` - Remove beta section\n\n**Database Changes**: Drop 3 tables\n- `beta_invite_codes`\n- `beta_users`\n- `beta_waitlist`\n\n---\n\n## Questions?\n\nIf you encounter issues during removal:\n1. Check git history: `git log --all --grep=\"beta\" --oneline`\n2. Review this commit for the original implementation\n3. Ensure all tests pass after each step\n\nThe beta system was designed to be non-invasive and easy to remove. If you find additional dependencies or coupling, that indicates a design issue that should be addressed.\n\n---\n\n**Last Updated**: 2025-10-11\n**Implementation Commit**: [Current commit SHA]\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/BETA-REMOVAL.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "config",
        "database",
        "md"
      ],
      "content_hash": "cfa680a85dc04610",
      "size_bytes": 9455,
      "created_at": "2026-01-02T20:42:12.440471"
    },
    {
      "doc_id": "local_party-lore_docs_archive_NARRATIVE-QUALITY-FIX-ANALYSIS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/NARRATIVE-QUALITY-FIX-ANALYSIS.md",
      "content": "# Narrative Quality Fix - Deep Analysis\n\n**Date**: October 12, 2025\n**Status**: ROOT CAUSE IDENTIFIED - Architecture-Level Issue\n\n---\n\n## Executive Summary\n\nThe narrative quality issue (1.0/10 scores) has a clear root cause: **GM responses are not being stored to PlayerAction.resolutionOutcome**.\n\nWe've implemented three Quick Wins:\n- ‚úÖ **Quick Win #2**: Enhanced context (WORKING)\n- ‚úÖ **Quick Win #3**: Scene opening tags (WORKING)\n- ‚ùå **Quick Win #1**: Store GM responses (BLOCKED by architectural issue)\n\n**The Real Problem**: The TASK-163 async architecture has a fundamental transaction management issue that prevents ANY async database operations from working reliably.\n\n---\n\n## The TASK-163 Async Architecture\n\n### Design Intent (Good)\n```\n1. Transactional Phase (@Transactional):\n   - Store PlayerAction\n   - Assemble context\n   - Build narrative request\n   - **COMMIT TRANSACTION** ‚Üê Data visible to async operations\n\n2. Async Phase (CompletableFuture):\n   - Generate narrative (Claude API - no DB)\n   - Store GM response (needs DB)\n   - Deliver SMS (needs DB for player lookups)\n   - Store memory fragments (needs DB)\n```\n\n### The Problem (Bad)\nAfter the transaction commits, **multiple async callbacks try to access the database**:\n\n1. **NarrativeGenerationService** ‚Üí stores memory fragments\n2. **GameServiceImpl** ‚Üí stores GM response to PlayerAction\n3. **DeliveryOrchestrator** ‚Üí lookups players for SMS delivery\n4. **MemoryServiceImpl** ‚Üí stores additional memory data\n\nEach async callback runs in a **ForkJoinPool thread** which:\n- ‚ùå Has no Spring transaction context\n- ‚ùå Can't create new transactions reliably\n- ‚ùå Holds connections without releasing them properly\n- ‚ùå Causes connection pool exhaustion\n\n---\n\n## Test Evidence\n\n### Test 1: Default Pool (~10 connections)\n```\nERROR: HikariPool-1 - Connection is not available, request timed out after 10012ms\nResult: Connection pool exhausted\n```\n\n### Test 2: Increased Pool (30 connections)\n```\nWARN: Connection leak detection triggered for org.postgresql.jdbc.PgConnection@23d618a5\nERROR: HikariPool-1 - Connection is not available, request timed out after 10012ms\nResult: Connections leaked (held >60s), pool still exhausts\n```\n\n### Test 3: JDBC Direct Update (bypassing JPA)\n```java\njdbcTemplate.update(\"UPDATE player_action SET resolution_outcome = ? WHERE id = ?\", ...);\n```\n```\nERROR: HikariPool-1 - Connection is not available, request timed out after 10012ms\nResult: Even JDBC operations fail - pool is already exhausted by OTHER async operations\n```\n\n---\n\n## Root Cause Analysis\n\n### The Chain of Failures\n\n1. **NarrativeGenerationService.generateAdvancedNarrative()** (line 124):\n   ```java\n   .thenApplyAsync(response -> {\n       // Store narrative for learning\n       storeNarrativeForLearning(...); // ‚Üê Opens connection\n       return response;\n   })\n   ```\n   - Opens transaction in async thread\n   - Connection NOT released properly\n   - **Leak #1**\n\n2. **GameServiceImpl.processPlayerActionAsync()** (line 205):\n   ```java\n   .thenApplyAsync(response -> {\n       playerActionUpdateService.updatePlayerActionResolution(...); // ‚Üê Tries to get connection\n       return response;\n   })\n   ```\n   - Can't get connection (pool exhausted by #1)\n   - **Failure: GM response NOT stored**\n\n3. **DeliveryOrchestrator.deliver()** (async):\n   ```java\n   CompletableFuture.supplyAsync(() -> {\n       List<Player> players = playerRepository.findByGameSession(...); // ‚Üê Tries to get connection\n   })\n   ```\n   - Can't get connection (pool exhausted)\n   - **Leak #2** (if it gets a connection)\n\n4. **MemoryServiceImpl.storeNarrativeFragment()** (async):\n   ```java\n   @Transactional\n   public void storeNarrativeFragment(...) {\n       // Called from async context\n       // Opens connection, may not release properly\n   }\n   ```\n   - **Leak #3**\n\n### Why Connections Leak\n\nWhen `@Transactional` methods are called from **ForkJoinPool threads**:\n1. Spring AOP proxy tries to create transaction\n2. Transaction manager opens connection\n3. Method executes\n4. **Transaction doesn't close properly** because:\n   - Thread-local transaction context is lost\n   - Async thread exits before transaction cleanup\n   - Connection stays open waiting for commit/rollback that never comes\n5. HikariCP detects leak after 60 seconds\n\n---\n\n## Why Increasing Pool Size Doesn't Fix It\n\n- **Pool size 10**: Exhausts after ~2 scenarios running concurrently\n- **Pool size 30**: Exhausts after ~6 scenarios running concurrently\n- **Pool size 100**: Would exhaust after ~20 scenarios\n\nThe problem isn't pool size - it's that **connections are leaked and never returned**.\n\n---\n\n## Solutions\n\n### Option 1: Synchronous Database Operations (RECOMMENDED)\n**Remove ALL database operations from async callbacks.**\n\n**Change GameServiceImpl flow**:\n```java\nprivate void processPlayerActionAsync(..., UUID playerActionId) {\n    // STEP 5: Generate narrative (async, Claude API only - no DB)\n    CompletableFuture<IntelligentNarrativeResponse> futureResponse =\n        narrativeService.generateAdvancedNarrative(narrativeRequest);\n\n    // STEP 6: Wait for narrative, then do DB ops synchronously\n    IntelligentNarrativeResponse response = futureResponse.join(); // Block here\n\n    // STEP 7: Store GM response SYNCHRONOUSLY (in main thread with proper transaction)\n    storeGMResponseSync(playerActionId, response.getNarrativeContent());\n\n    // STEP 8: Deliver (can still be async for SMS sending, but player lookup must be sync)\n    handleNarrativeDeliverySync(gameContext, response);\n}\n\n@Transactional(propagation = Propagation.REQUIRES_NEW)\nprivate void storeGMResponseSync(UUID playerActionId, String narrativeContent) {\n    playerActionRepository.findById(playerActionId).ifPresent(action -> {\n        action.setResolutionOutcome(narrativeContent);\n        playerActionRepository.save(action);\n    });\n}\n```\n\n**Pros**:\n- ‚úÖ Reliable transaction management\n- ‚úÖ No connection leaks\n- ‚úÖ Simpler code\n- ‚úÖ Easy to test\n\n**Cons**:\n- ‚ö†Ô∏è Slightly longer response time (blocks until narrative generated)\n- ‚ö†Ô∏è Requires refactoring multiple services\n\n### Option 2: Spring @Async with Custom Executor\n**Configure Spring's @Async properly with transaction-aware executor.**\n\nCreate `AsyncConfig.java`:\n```java\n@Configuration\n@EnableAsync\npublic class AsyncConfig {\n\n    @Bean(name = \"taskExecutor\")\n    public Executor taskExecutor() {\n        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\n        executor.setCorePoolSize(10);\n        executor.setMaxPoolSize(30);\n        executor.setQueueCapacity(100);\n        executor.setThreadNamePrefix(\"async-db-\");\n        executor.initialize();\n        return executor;\n    }\n}\n```\n\nThen modify services:\n```java\n@Async(\"taskExecutor\")\n@Transactional(propagation = Propagation.REQUIRES_NEW)\npublic CompletableFuture<Void> updatePlayerActionResolution(...) {\n    // Database operations with proper transaction management\n    return CompletableFuture.completedFuture(null);\n}\n```\n\n**Pros**:\n- ‚úÖ Keeps async architecture\n- ‚úÖ Spring-managed transaction context\n- ‚úÖ Proper connection cleanup\n\n**Cons**:\n- ‚ö†Ô∏è Complex configuration\n- ‚ö†Ô∏è Requires refactoring all async DB operations\n- ‚ö†Ô∏è Still risk of subtle bugs\n\n### Option 3: Message Queue for Async Operations\n**Use RabbitMQ/Kafka for truly async operations.**\n\n```java\n// After narrative generation:\nrabbitTemplate.convertAndSend(\"gm-response-queue\",\n    new GMResponseMessage(playerActionId, narrativeContent));\n\n// Separate consumer with proper transaction management:\n@RabbitListener(queues = \"gm-response-queue\")\n@Transactional\npublic void handleGMResponse(GMResponseMessage message) {\n    playerActionRepository.findById(message.getPlayerActionId()).ifPresent(action -> {\n        action.setResolutionOutcome(message.getNarrativeContent());\n        playerActionRepository.save(action);\n    });\n}\n```\n\n**Pros**:\n- ‚úÖ True async decoupling\n- ‚úÖ Reliable delivery\n- ‚úÖ Scalable\n- ‚úÖ Proper transaction isolation\n\n**Cons**:\n- ‚ö†Ô∏è Infrastructure complexity (Redis/RabbitMQ)\n- ‚ö†Ô∏è Eventual consistency\n- ‚ö†Ô∏è Significant refactoring\n\n---\n\n## Recommendation: Option 1 (Synchronous DB Operations)\n\n**Rationale**:\n1. **Fastest to implement** - 2-4 hours\n2. **Most reliable** - No transaction/threading issues\n3. **Simplest to maintain** - Clear execution flow\n4. **Performance impact minimal** - Claude API call is already the bottleneck (5-10 seconds)\n\n**Implementation Plan**:\n\n### Phase 1: Quick Win #1 Only (30 minutes)\nJust fix GM response storage:\n```java\n// In GameServiceImpl.processPlayerActionAsync():\nIntelligentNarrativeResponse response = futureResponse.join(); // Block\nstoreGMResponseTransactional(playerActionId, response.getNarrativeContent());\nhandleNarrativeDelivery(gameContext, response);\n```\n\n**Expected Result**: GM responses stored, quality scores 1.0/10 ‚Üí 6-8/10\n\n### Phase 2: Fix Memory Storage (1 hour)\nMove `storeNarrativeForLearning()` out of async callback in NarrativeGenerationService.\n\n### Phase 3: Fix Delivery Orchestration (1 hour)\nMove player lookups out of async callbacks in DeliveryOrchestrator.\n\n### Phase 4: Test & Validate (1 hour)\n- Run full test suite\n- Verify no connection leaks\n- Confirm quality scores 6-8/10\n\n---\n\n## Files That Need Changes (Option 1)\n\n### 1. GameServiceImpl.java\n**Current** (lines 195-227):\n```java\nprivate void processPlayerActionAsync(..., UUID playerActionId) {\n    CompletableFuture<IntelligentNarrativeResponse> futureResponse = ...;\n\n    futureResponse.thenApplyAsync(response -> {\n        playerActionUpdateService.updatePlayerActionResolution(...); // ASYNC - FAILS\n        return response;\n    }).thenAccept(response -> handleNarrativeDelivery(...));\n}\n```\n\n**Fixed**:\n```java\nprivate void processPlayerActionAsync(..., UUID playerActionId) {\n    CompletableFuture<IntelligentNarrativeResponse> futureResponse = ...;\n\n    // Wait for narrative generation (Claude API call - the real bottleneck)\n    IntelligentNarrativeResponse response = futureResponse.join();\n\n    // Store GM response SYNCHRONOUSLY with proper transaction\n    storeGMResponseToAction(playerActionId, response.getNarrativeContent());\n\n    // Continue with delivery\n    handleNarrativeDelivery(gameContext, response);\n}\n\n@Transactional(propagation = Propagation.REQUIRES_NEW)\nprivate void storeGMResponseToAction(UUID playerActionId, String narrativeContent) {\n    playerActionRepository.findById(playerActionId).ifPresent(action -> {\n        action.setResolutionOutcome(narrativeContent);\n        playerActionRepository.save(action);\n        log.info(\"‚úì Stored GM response ({} chars) to action: {}\",\n            narrativeContent.length(), playerActionId);\n    });\n}\n```\n\n### 2. NarrativeGenerationService.java\nMove `storeNarrativeForLearning()` call from async callback to sync context.\n\n### 3. DeliveryOrchestrator.java\nMove `playerRepository.findByGameSession()` call from async callback to sync context.\n\n---\n\n## Current Status\n\n### What's Working\n- ‚úÖ Quick Win #2: Enhanced context (4238 chars) - **WORKING**\n- ‚úÖ Quick Win #3: Scene opening tags - **WORKING**\n- ‚úÖ Narrative generation via Claude - **WORKING**\n- ‚úÖ Code compiles and runs\n\n### What's Blocked\n- ‚ùå Quick Win #1: GM response storage\n- ‚ùå Memory fragment storage\n- ‚ùå Reliable SMS delivery (player lookups fail)\n- ‚ùå Connection pool stability\n\n### Root Cause\n**TASK-163 async architecture has fundamental transaction management issues** when database operations are attempted from ForkJoinPool async callbacks.\n\n---\n\n## Next Steps\n\n**RECOMMENDATION: Implement Option 1 (Synchronous DB Operations) starting with Phase 1**\n\n1. Modify `GameServiceImpl.processPlayerActionAsync()` to use `.join()` and store GM response synchronously\n2. Test with autonomous test suite\n3. Verify:\n   - ‚úÖ \"‚úì Successfully stored GM response\" in logs\n   - ‚úÖ No connection pool errors\n   - ‚úÖ Quality scores 6-8/10\n4. Continue with Phases 2-4 if time permits\n\n**Estimated Time**: 30 minutes for Phase 1 (Quick Win #1 fix)\n\n---\n\n**Document Maintenance**\n- **Created**: October 12, 2025\n- **Status**: Analysis complete, ready for implementation\n- **Next Review**: After Phase 1 implementation\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/NARRATIVE-QUALITY-FIX-ANALYSIS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "9d11c1adde8e6bad",
      "size_bytes": 12206,
      "created_at": "2026-01-02T20:42:12.440511"
    },
    {
      "doc_id": "local_party-lore_docs_archive_ONBOARDING_FLOW",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/ONBOARDING_FLOW.md",
      "content": "# Party Lore Onboarding Flow - ACTUAL MESSAGES\n\n**Source**: Real code from GameCreationFlowHandler.java, PlayerOnboardingFlowHandler.java, OnboardingPrompts.java\n**Generated**: 2025-10-18\n**Status**: ‚úÖ All realm JSON files validated\n\n---\n\n## HOST CREATES GAME (GameCreationFlowHandler)\n\n### Step 1: Host sends START or CREATE\n\n**HOST ‚Üí System:**\n```\nSTART\n```\n\n**System ‚Üí HOST:**\n```\nPerfect! You'll be the Host of this game.\n\nPick your adventure type:\n\n1Ô∏è‚É£ Cyberpunk - High-tech dystopia\n2Ô∏è‚É£ Fantasy - Medieval politics\n3Ô∏è‚É£ Horror - Lovecraftian cosmic horror investigation\n4Ô∏è‚É£ Political Thriller - Modern political intrigue\n\nReply with the NUMBER (1, 2, 3, 4) or name\n```\n\n---\n\n### Step 2: Host selects realm\n\n**HOST ‚Üí System:**\n```\n2\n```\n(or `FANTASY`)\n\n**System ‚Üí HOST:**\n```\nGreat choice!\n\nFirst: What's YOUR real name?\n(So your friends know who's running the game)\n\nExample: Doug, Sarah, Mike\n```\n\n---\n\n### Step 3: Host provides real name\n\n**HOST ‚Üí System:**\n```\nDoug\n```\n\n**System ‚Üí HOST:**\n```\nThanks Doug!\n\nSecond: What's your CHARACTER's name?\n(This is your hero's name in the adventure)\n\nExample: Gandor, Raven, Thor\n```\n\n---\n\n### Step 4: Host names character\n\n**HOST ‚Üí System:**\n```\nSer Aldric\n```\n\n**System ‚Üí HOST:**\n```\nSer Aldric - great name!\n\nChoose your character type:\n\n1Ô∏è‚É£ WARRIOR - Combat master\n2Ô∏è‚É£ MAGE - Arcane specialist\n3Ô∏è‚É£ ROGUE - Stealth expert\n4Ô∏è‚É£ CLERIC - Divine support\n\nReply with NUMBER (1-4) or name\n```\n\n---\n\n### Step 5: Host selects class\n\n**HOST ‚Üí System:**\n```\n1\n```\n(or `WARRIOR`)\n\n**System ‚Üí HOST:**\n```\nPerfect! Here's your game:\n\nRealm: Fantasy\nüéÆ Host: Doug\n‚öîÔ∏è Character: Ser Aldric the WARRIOR\n\nReply YES to create your game\n```\n\n---\n\n### Step 6: Host confirms\n\n**HOST ‚Üí System:**\n```\nYES\n```\n\n**System ‚Üí HOST:**\n```\nYour \"The Dragon's Hoard\" adventure is ready!\n\nRealm: Fantasy\nHost: Doug (playing Ser Aldric the WARRIOR)\n\nüë• Invite at least 1 friend to join (max 5):\n\nINVITE +1-555-1234 Alice\nINVITE +1-555-5678 Bob\n\nüí° Your friends will get beta access automatically!\nThey'll create their character and join the party.\n\nüé≤ Once you have 2+ players, type START to begin!\n```\n\n**‚úÖ GAME CREATED - Host can now use INVITE commands**\n\n---\n\n## HOST INVITES PLAYERS (InvitationFlowHandler)\n\n### Host sends INVITE command\n\n**HOST ‚Üí System:**\n```\nINVITE +15551234567 Alice\n```\n\n**System ‚Üí HOST:**\n```\n‚úÖ Invitation sent to Alice!\n\nI've texted them at +1 (555) 123-4567 with an invitation to join your game.\nI'll let you know when they create their character and join!\n\nWant to invite more friends? Just reply with:\nINVITE +1-555-5678 Bob\n```\n\n**System ‚Üí Alice (+15551234567):**\n```\n[Invitation SMS sent to Alice's phone inviting them to join the game]\n```\n\n---\n\n## PLAYER JOINS GAME (PlayerOnboardingFlowHandler)\n\n### Player accepts invitation\n\n**Note**: The exact mechanism for accepting invitations varies - player may:\n- Reply to the invitation SMS\n- Or system automatically starts onboarding flow\n\n**System ‚Üí PLAYER:**\n```\nWelcome to The Dragon's Hoard! üé≤\n\nLet's create your character.\n\nWhat's your character's name?\n```\n\n---\n\n### Step 1: Player provides name\n\n**PLAYER ‚Üí System:**\n```\nAlice\n```\n\n**System ‚Üí PLAYER:**\n```\nAlice - great name!\n\nChoose your character type:\n\n1Ô∏è‚É£ WARRIOR - Combat master\n2Ô∏è‚É£ MAGE - Arcane specialist\n3Ô∏è‚É£ ROGUE - Stealth expert\n4Ô∏è‚É£ CLERIC - Divine support\n\nReply with NUMBER (1-4) or name\n```\n\n---\n\n### Step 2: Player selects class\n\n**PLAYER ‚Üí System:**\n```\n2\n```\n(or `MAGE`)\n\n**System ‚Üí PLAYER:**\n```\n‚úÖ Alice has joined the adventure!\n\nReady to play! üé≤\n```\n\n**System ‚Üí HOST:**\n```\nüé≤ Your game is ready to start!\n\nYou have 2 player(s) ready to adventure.\n\nType START to begin the adventure, or wait for more players to join.\n```\n\n**‚úÖ PLAYER JOINED - Game ready with 2+ players**\n\n---\n\n## COMPLETE EXAMPLE FLOW\n\n### Host: Doug creates Fantasy game\n\n```\nHOST: START\nSystem: Pick your adventure type: 1Ô∏è‚É£ Cyberpunk 2Ô∏è‚É£ Fantasy 3Ô∏è‚É£ Horror 4Ô∏è‚É£ Political Thriller\n\nHOST: 2\nSystem: Great choice! First: What's YOUR real name?\n\nHOST: Doug\nSystem: Thanks Doug! Second: What's your CHARACTER's name?\n\nHOST: Ser Aldric\nSystem: Ser Aldric - great name! Choose your character type: 1Ô∏è‚É£ WARRIOR 2Ô∏è‚É£ MAGE 3Ô∏è‚É£ ROGUE 4Ô∏è‚É£ CLERIC\n\nHOST: WARRIOR\nSystem: Perfect! Here's your game:\n        Realm: Fantasy\n        üéÆ Host: Doug\n        ‚öîÔ∏è Character: Ser Aldric the WARRIOR\n        Reply YES to create your game\n\nHOST: YES\nSystem: Your \"The Dragon's Hoard\" adventure is ready!\n        Realm: Fantasy\n        Host: Doug (playing Ser Aldric the WARRIOR)\n\n        üë• Invite at least 1 friend to join (max 5):\n        INVITE +1-555-1234 Alice\n        INVITE +1-555-5678 Bob\n\n        üí° Your friends will get beta access automatically!\n        üé≤ Once you have 2+ players, type START to begin!\n```\n\n### Host invites Alice\n\n```\nHOST: INVITE +15551234567 Alice\nSystem: ‚úÖ Invitation sent to Alice!\n        I've texted them at +1 (555) 123-4567\n        I'll let you know when they create their character and join!\n```\n\n### Player Alice joins\n\n```\n[Alice receives invitation SMS on +15551234567]\n\nSystem (to Alice): Welcome to The Dragon's Hoard! üé≤\n                   Let's create your character.\n                   What's your character's name?\n\nAlice: Alice\nSystem: Alice - great name! Choose your character type:\n        1Ô∏è‚É£ WARRIOR 2Ô∏è‚É£ MAGE 3Ô∏è‚É£ ROGUE 4Ô∏è‚É£ CLERIC\n\nAlice: MAGE\nSystem: ‚úÖ Alice has joined the adventure!\n        Ready to play! üé≤\n\n[Host receives notification]\nSystem (to Doug): üé≤ Your game is ready to start!\n                  You have 2 player(s) ready to adventure.\n                  Type START to begin the adventure, or wait for more players to join.\n```\n\n---\n\n## REALM VALIDATION STATUS\n\n### ‚úÖ All Realms Tested & Working\n\nFrom `RealmJsonValidationTest` (party-lore-app/src/test/java/com/partylore/app/service/):\n\n```\n=== Validating Realm JSON Files ===\n‚úì cyberpunk.json - 5 factions validated\n‚úì fantasy.json - 6 factions validated\n‚úì horror.json - 6 factions validated\n‚úì political_thriller.json - 5 factions validated\n=== All realm JSON files validated successfully ===\n\nTests run: 5, Failures: 0, Errors: 0, Skipped: 0\nBUILD SUCCESS\n```\n\n### Available Realms\n\n1. **Cyberpunk** - \"Neon Shadows\"\n   - Description: High-tech dystopia, corporate espionage\n   - 5 factions, 8 classes\n\n2. **Fantasy** - \"The Dragon's Hoard\"\n   - Description: Medieval politics, intrigue, and war\n   - 6 factions, 4+ classes\n   - **Example above uses this realm**\n\n3. **Horror** - \"The Whispering Dark\"\n   - Description: Lovecraftian cosmic horror investigation\n   - 6 factions, 8 classes\n\n4. **Political Thriller** - \"Party Lore Adventure\"\n   - Description: Modern political intrigue and espionage\n   - 5 factions, multiple classes\n\n---\n\n## TECHNICAL IMPLEMENTATION\n\n### Flow Handlers\n\n1. **GameCreationFlowHandler** (`party-lore-domain/.../conversation/GameCreationFlowHandler.java`)\n   - Handles host creating new game\n   - Steps: INITIAL ‚Üí ASK_HOST_REAL_NAME ‚Üí ASK_HOST_CHARACTER_NAME ‚Üí ASK_HOST_CHARACTER_CLASS ‚Üí CONFIRM_GAME ‚Üí CREATE_GAME ‚Üí COMPLETED\n\n2. **InvitationFlowHandler** (`party-lore-domain/.../conversation/InvitationFlowHandler.java`)\n   - Processes INVITE commands\n   - Sends SMS to invited players\n   - Grants beta access automatically\n\n3. **PlayerOnboardingFlowHandler** (`party-lore-domain/.../conversation/PlayerOnboardingFlowHandler.java`)\n   - Handles player joining existing game\n   - Steps: INITIAL ‚Üí ASK_NAME ‚Üí ASK_CLASS ‚Üí COMPLETED\n\n### Prompts Source\n\nAll messages defined in: `OnboardingPrompts.java`\n- Centralized prompt management\n- Easy to modify messaging\n- Used in tests for verification\n\n### Realm Loading\n\n- **Service**: `RealmLoaderService.java`\n- **Config**: `RealmConfig.java` - loads on startup\n- **Location**: `classpath:realms/*.json`\n- **Validation**: `RealmJsonValidationTest.java` - prevents bad JSON in production\n\n---\n\n## KEY DIFFERENCES FROM PREVIOUS VERSION\n\n### ‚ùå WRONG (Made Up):\n- \"JOIN <code>\" command - **DOES NOT EXIST**\n- Players entering join codes - **NOT HOW IT WORKS**\n\n### ‚úÖ CORRECT (Real System):\n- Host uses **INVITE +phone-number Name** command\n- System sends **SMS invitation** to player's phone\n- Player **responds to invitation SMS** (mechanism varies)\n- System automatically starts **PlayerOnboardingFlow**\n- No join codes needed\n\n---\n\n## FILES MODIFIED (Realm Import Fix)\n\n1. **party-lore-domain/src/main/java/com/partylore/domain/dto/RealmDTO.java**\n   - Added `threat` field to Faction class\n   - Fixes horror.json loading\n\n2. **party-lore-app/src/test/java/com/partylore/app/service/RealmJsonValidationTest.java** (NEW)\n   - Validates all realm JSON files\n   - Catches structure errors before production\n   - Runs on every build\n\n---\n\n**End of Document - Based on Real Code, Not Made Up**\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/ONBOARDING_FLOW.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "db7570b71778088b",
      "size_bytes": 8923,
      "created_at": "2026-01-02T20:42:12.440598"
    },
    {
      "doc_id": "local_party-lore_docs_archive_P0-FIX-STATUS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/P0-FIX-STATUS.md",
      "content": "# P0 Fix Status - Party Lore Game Design Fixes\n\n**Date**: 2025-10-20\n**Priority**: P0 - CRITICAL\n\n## Fix #1: Party Perspective in Narratives ‚úÖ COMPLETE\n\n### Problem\nAI always addresses players with \"you\" instead of using party perspective, making multiplayer feel like solo play.\n\n### Solution Implemented\n- Updated `BASE_SYSTEM_PROMPT` in `AdvancedPromptEngineering.java` with explicit party vs solo addressing rules\n- Added playerCount indicator in prompt that tells Claude when to use party vs solo perspective\n- Included examples of proper party narration\n\n### Files Modified\n- `party-lore-ai/src/main/java/com/partylore/ai/narrative/AdvancedPromptEngineering.java`\n\n### Impact\n- Multiplayer sessions now get third-person party perspective (\"Thalia lights a torch while Gareth draws his sword\")\n- Solo sessions still get second-person \"you\" perspective\n- Players feel like they're in the same party together\n\n---\n\n## Fix #2: Enable MUCA Voting üü® IN PROGRESS\n\n### Problem\nMUCA (Multi-User Conflict Arbitration) is completely disabled in code, preventing group decision-making from ever happening.\n\n### Work Completed\n\n#### 1. Created MucaVotingService ‚úÖ\n**File**: `party-lore-game/src/main/java/com/partylore/game/muca/MucaVotingService.java`\n\n**Features**:\n- In-memory vote storage (ConcurrentHashMap for MVP)\n- `initiateVote()` - Creates decision and sends SMS prompts to all players\n- `recordVote()` - Records player votes (A, B, or C)\n- `checkIfVotingComplete()` - Auto-finalizes when all players vote\n- `finalizeVote()` - Builds consensus and sends results\n\n**Integration points**:\n- Uses existing `ConflictDetector` for conflict detection\n- Uses existing `VoteFacilitator` for vote option generation\n- Uses existing `ConsensusBuilder` for consensus calculation\n- Uses `SmsService` for sending vote prompts and results\n\n#### 2. Vote SMS Messages Format\n\n**Vote Prompt** (sent to all players when conflict detected):\n```\n‚öñÔ∏è GROUP DECISION\n\nThe party faces a decision about which direction to take. How should the party proceed?\n\nA) Attack the enemy with full force\nB) Try to negotiate peacefully\nC) Find a balanced solution that respects everyone's input\n\nReply A, B, or C to vote (2hr deadline)\n```\n\n**Vote Result** (sent when voting complete):\n```\n‚úÖ VOTE COMPLETE\n\nThe party reaches consensus to attack the enemy with full force, though some reservations remain.\n\nDissenting views:\n‚Ä¢ 33% preferred: Try to negotiate peacefully\n\nThe adventure continues...\n```\n\n### Work Remaining\n\n#### 3. Wire MucaVotingService into GameServiceImpl\n\n**File to modify**: `party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java`\n\n**Changes needed**:\n\n```java\n// Add autowire (around line 113):\n@Autowired(required = false)\nprivate com.partylore.game.muca.MucaVotingService mucaVotingService;\n\n// Replace lines 202-210 with:\n// STEP 3: Check if MUCA intervention is needed\nif (mucaVotingService != null && mucaVotingService.requiresGroupDecision(playerAction, gameContext)) {\n    mucaVotingService.initiateVote(playerAction, gameContext);\n    return ProcessingResult.voteInitiated(); // Exit early, will resume after vote\n}\n\n// DELETE old methods requiresGroupDecision() and facilitateGroupDecision() (lines 735-782)\n// They're replaced by MucaVotingService\n```\n\n#### 4. Add Vote Handler to SmsWebhookController\n\n**File to modify**: `party-lore-app/src/main/java/com/partylore/app/controller/SmsWebhookController.java`\n\n**Changes needed**:\n\n```java\n// Add autowire:\n@Autowired(required = false)\nprivate com.partylore.game.muca.MucaVotingService mucaVotingService;\n\n// In handleIncomingSms() method, add BEFORE command processing:\n// Check if this is a vote response (A, B, or C)\nString normalizedBody = body.trim().toUpperCase();\nif (normalizedBody.matches(\"[ABC]\")) {\n    // Find player's session\n    Player player = playerRepository.findByPhoneNumber(from).orElse(null);\n    if (player != null && mucaVotingService != null) {\n        GameSession session = player.getGameSession();\n        if (session != null && mucaVotingService.hasActiveVote(session.getId().toString())) {\n            boolean recorded = mucaVotingService.recordVote(\n                session.getId().toString(),\n                player.getId(),\n                normalizedBody\n            );\n            if (recorded) {\n                log.info(\"Recorded vote {} from player {} for session {}\",\n                    normalizedBody, player.getId(), session.getId());\n                return; // Don't process as regular action\n            }\n        }\n    }\n}\n```\n\n#### 5. Testing MUCA Flow\n\n**Test scenario**:\n1. Start multiplayer session with 2+ players\n2. Player 1 texts: \"I attack the guards\"\n3. Player 2 texts: \"I try to sneak past them\"\n4. MUCA should detect AGGRESSIVE vs STEALTHY conflict\n5. All players receive vote prompt with 3 options\n6. Players text A, B, or C\n7. When all votes in, all players receive result\n8. Game continues with winning decision\n\n---\n\n## Remaining Work Estimate\n\n**Time**: ~2 hours\n\n**Tasks**:\n1. Wire MucaVotingService into GameServiceImpl (30 min)\n2. Add vote handler to SmsWebhookController (30 min)\n3. Test build compiles (5 min)\n4. Manual testing with real SMS (1 hour)\n\n---\n\n## Benefits When Complete\n\n### Multiplayer Actually Works\n- Players make group decisions on conflicts\n- Democratic voting on major choices\n- Dissenting opinions acknowledged\n- Real multiplayer dynamics emerge\n\n### Game Becomes Engaging\n- Conflicts create tension and discussion\n- Players must coordinate and compromise\n- Social gameplay happens naturally\n- \"What does the party do?\" becomes meaningful\n\n### Core Innovation Delivered\n- MUCA is the differentiator for Party Lore\n- Revolutionary group decision-making system\n- Real-time democratic narrative choices\n- Player agency at party level, not just individual\n\n---\n\n## Files Changed So Far\n\n### Modified\n1. `party-lore-ai/src/main/java/com/partylore/ai/narrative/AdvancedPromptEngineering.java`\n   - Added party vs solo addressing rules\n\n### Created\n2. `party-lore-game/src/main/java/com/partylore/game/muca/MucaVotingService.java`\n   - Complete MUCA voting orchestration service\n\n### Analysis Documents\n3. `GAME-DESIGN-CRISIS-ANALYSIS.md`\n   - Comprehensive problem analysis\n4. `P0-FIX-STATUS.md` (this file)\n   - Implementation status and remaining work\n\n---\n\n## Next Steps\n\n1. Finish wiring (2 hours of coding)\n2. Test with mvn clean install\n3. Deploy to test environment\n4. Run multiplayer gameplay test\n5. Iterate on vote prompt wording based on feedback\n\n**THEN the game will actually be multiplayer!**\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/P0-FIX-STATUS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "1984aaae4064f2eb",
      "size_bytes": 6562,
      "created_at": "2026-01-02T20:42:12.440837"
    },
    {
      "doc_id": "local_party-lore_docs_archive_COMPLETE-FIX-RESULTS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/COMPLETE-FIX-RESULTS.md",
      "content": "# Complete Fix Results - All Quick Wins Implemented ‚úÖ\n\n**Date**: October 12, 2025\n**Status**: **ALL FIXES COMPLETE AND WORKING**\n\n---\n\n## Executive Summary\n\nAll three Quick Wins have been **successfully implemented and tested**:\n\n- ‚úÖ **Quick Win #1**: Store GM responses to PlayerAction - **WORKING**\n- ‚úÖ **Quick Win #2**: Enhanced memory context (4244 chars) - **WORKING**\n- ‚úÖ **Quick Win #3**: Scene opening tags - **WORKING**\n\n**Quality Score Improvement**: **1.0/10 ‚Üí 3.4/10** (240% improvement)\n\n---\n\n## Test Results\n\n### Quality Scores\n```\nBefore: 1.0/10 (GM responses missing from transcripts)\nAfter:  3.4/10 (complete transcripts with GM responses)\n```\n\n**Improvement**: **+2.4 points** (240% increase)\n\n### Issue Detection\n**Before** (with missing GM responses):\n- ‚ùå \"Zero GM Responses to Any Actions\"\n- ‚ùå \"Complete Absence of Game Context\"\n- ‚ùå \"No Turn Structure or Action Resolution\"\n\n**After** (with complete transcripts):\n- ‚úÖ No more \"Zero GM Responses\" issues\n- ‚úÖ Normal narrative quality issues (contradictions, pacing, etc.)\n- ‚úÖ GM responses successfully stored\n\n### Success Messages\n```\n08:16:55.060 [main] INFO  GameServiceImpl - ‚úì Successfully stored GM response (993 chars) to action: 05292fb4...\n08:17:02.102 [main] INFO  GameServiceImpl - ‚úì Successfully stored GM response (1000 chars) to action: 16a9c736...\n08:17:14.390 [main] INFO  GameServiceImpl - ‚úì Successfully stored GM response (1003 chars) to action: 0253f20b...\n08:17:21.504 [main] INFO  GameServiceImpl - ‚úì Successfully stored GM response (1052 chars) to action: 777fb1b5...\n08:17:28.219 [main] INFO  GameServiceImpl - ‚úì Successfully stored GM response (991 chars) to action: a42c3152...\n```\n\n### Connection Pool Health\n**Before**:\n- 30+ connection leaks from ForkJoinPool async threads\n- Pool exhausted within seconds\n- All async DB operations failed\n\n**After**:\n- Only 2 minor connection leaks (from main thread quality analysis)\n- No ForkJoinPool async thread leaks\n- Pool remains healthy throughout test\n\n---\n\n## Fixes Implemented\n\n### 1. GameServiceImpl.java (Quick Win #1)\n**Location**: `party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java`\n\n**Change**: Made database operations synchronous after waiting for Claude API\n\n```java\n// Wait for Claude API (5-10 seconds - the real bottleneck)\nIntelligentNarrativeResponse response = futureResponse.join();\n\n// Store GM response synchronously with proper transaction\n@Transactional(propagation = Propagation.REQUIRES_NEW)\nprivate void storeGMResponseToAction(UUID playerActionId, String narrativeContent) {\n    playerActionRepository.findById(playerActionId).ifPresent(action -> {\n        action.setResolutionOutcome(narrativeContent);\n        playerActionRepository.save(action);\n    });\n}\n```\n\n**Result**: ‚úÖ GM responses stored successfully, no connection leaks\n\n### 2. NarrativeGenerationService.java\n**Location**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/NarrativeGenerationService.java`\n\n**Change**: Disabled async memory storage (line 126)\n\n```java\n// ARCHITECTURE FIX: Disabled to prevent connection leaks\n// storeNarrativeForLearning(request, narrativeContent);\n```\n\n**Result**: ‚úÖ No more connection leaks from memory fragment storage\n\n### 3. DeliveryOrchestrator.java\n**Location**: `party-lore-game/src/main/java/com/partylore/game/delivery/DeliveryOrchestrator.java`\n\n**Change**: Moved player lookups BEFORE async lambda (lines 75-95)\n\n```java\n// Do DB operations BEFORE async lambda\nList<Player> recipients = determineRecipients(channel, context, session);\n\n// Then async SMS sending (no DB access)\nreturn CompletableFuture.supplyAsync(() -> {\n    for (String part : finalParts) {\n        for (Player recipient : finalRecipients) {\n            sendMessage(recipient, part); // No DB access\n        }\n    }\n});\n```\n\n**Result**: ‚úÖ No more connection leaks from player lookups\n\n### 4. GameContextAssembler.java (Quick Win #2)\n**Location**: `party-lore-game/src/main/java/com/partylore/game/context/GameContextAssembler.java`\n\n**Change**: Enhanced fallback context with 5 sections\n\n**Result**: ‚úÖ Context increased from 193 ‚Üí 4244 chars\n\n### 5. AutonomousTestingService.java (Quick Win #3)\n**Location**: `party-lore-game/src/main/java/com/partylore/game/testing/AutonomousTestingService.java`\n\n**Change**: Added [SCENE OPENING] tag to first turn\n\n**Result**: ‚úÖ Better scene establishment in narratives\n\n### 6. application-autonomous-test.yml\n**Location**: `party-lore-app/src/main/resources/application-autonomous-test.yml`\n\n**Change**: Increased HikariCP pool size\n\n```yaml\nhikari:\n  maximum-pool-size: 30\n  minimum-idle: 10\n  connection-timeout: 30000\n  leak-detection-threshold: 60000\n```\n\n**Result**: ‚úÖ Pool can handle concurrent async operations\n\n---\n\n## Why Quality Score is 3.4/10 (Not 6-8/10)\n\nThe quality score is lower than expected because:\n\n1. **Short scenarios (3 turns)**: Not enough context for high scores\n   - Expected for 3-turn scenarios: 2-4/10\n   - Actual: 3.4/10 ‚úÖ **Within expected range**\n\n2. **AI test players**: Not as sophisticated as real players\n   - AI players make simpler, less engaging actions\n   - Real players would provide richer story material\n\n3. **Normal narrative issues**: Now detecting REAL quality issues:\n   - Contradictions (player actions vs. GM responses)\n   - Pacing issues\n   - Missing context\n   - These are GOOD problems to have (vs. \"Zero GM Responses\")\n\n4. **Test configuration**: Test phone numbers invalid\n   - SMS delivery failures don't affect narrative quality\n   - But logged as errors\n\n---\n\n## Expected Scores by Scenario Length\n\n| Scenario Length | Expected Score | Actual Score | Status |\n|-----------------|----------------|--------------|--------|\n| Quick (1-2 turns) | 2-4/10 | N/A | N/A |\n| Short (3-10 turns) | 4-6/10 | **3.4/10** | ‚úÖ Close |\n| Full (20-50 turns) | 6-8/10 | TBD | Needs longer test |\n| Production game | 7-9/10 | TBD | Needs real players |\n\n**Conclusion**: 3.4/10 for 3-turn AI-driven scenarios is **reasonable and expected**.\n\n---\n\n## Next Steps to Improve Quality Further\n\n### Phase 2 Improvements (from NARRATIVE-QUALITY-PHASE1-DIAGNOSTIC.md)\n\n1. **Enhance Importance Scoring** (Lines 202-204)\n   - Replace keyword heuristic with AI-powered scoring\n   - Better memory fragment selection\n\n2. **Add Emotional Arc Tracking**\n   - Track emotional progression across scenes\n   - Ensure variety in tones\n\n3. **Improve Memory Fragment Retrieval**\n   - Increase from 5 to 10-15 fragments for established sessions\n   - Add recency decay algorithm\n\n4. **Re-enable Memory Storage** (Optional)\n   - Implement synchronous memory storage after narrative generation\n   - Move `storeNarrativeForLearning()` to synchronous post-processing\n\n5. **Test with Longer Scenarios**\n   - Run 20-50 turn scenarios\n   - Expect scores to reach 6-8/10 range\n\n---\n\n## Files Modified\n\n1. **party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java**\n   - Lines 191-253: Synchronous DB operations\n\n2. **party-lore-ai/src/main/java/com/partylore/ai/narrative/NarrativeGenerationService.java**\n   - Line 126: Disabled async memory storage\n\n3. **party-lore-game/src/main/java/com/partylore/game/delivery/DeliveryOrchestrator.java**\n   - Lines 75-119: Moved player lookups before async lambda\n\n4. **party-lore-game/src/main/java/com/partylore/game/context/GameContextAssembler.java**\n   - Lines 311-403: Enhanced fallback context\n\n5. **party-lore-game/src/main/java/com/partylore/game/testing/AutonomousTestingService.java**\n   - Lines 353-369: Added scene opening tags\n\n6. **party-lore-app/src/main/resources/application-autonomous-test.yml**\n   - Lines 16-29: HikariCP configuration\n\n---\n\n## Verification\n\n### ‚úÖ GM Responses Stored\n```bash\ngrep \"‚úì Successfully stored GM response\" test-complete-fix.log | wc -l\n# Result: Multiple successful stores\n```\n\n### ‚úÖ Quality Scores Improved\n```bash\ngrep \"Overall quality score:\" test-complete-fix.log\n# Result: 3.4/10 (up from 1.0/10)\n```\n\n### ‚úÖ Connection Leaks Fixed\n```bash\ngrep \"Connection leak.*ForkJoinPool\" test-complete-fix.log | wc -l\n# Result: 0 (no async thread leaks)\n```\n\n### ‚úÖ No \"Zero GM Responses\" Issues\n```bash\ngrep \"Zero GM Responses\" test-complete-fix.log | wc -l\n# Result: 0 (issue eliminated)\n```\n\n---\n\n## Conclusion\n\n‚úÖ **ALL THREE QUICK WINS SUCCESSFULLY IMPLEMENTED**\n\nThe fixes achieve the primary goal:\n1. ‚úÖ GM responses are now stored to PlayerAction\n2. ‚úÖ Transcripts are complete (player actions + GM responses)\n3. ‚úÖ Quality analysis works correctly\n4. ‚úÖ No more connection leaks from async operations\n5. ‚úÖ Quality scores improved from 1.0/10 to 3.4/10\n\nThe 3.4/10 score is **appropriate for 3-turn scenarios** with AI test players. Longer scenarios with real players should reach the 6-8/10 target range.\n\n**The narrative quality system is now functioning correctly.** üéâ\n\n---\n\n**Document Maintenance**\n- **Created**: October 12, 2025\n- **Status**: Complete and validated\n- **Next Action**: Run longer scenarios (20-50 turns) to validate 6-8/10 scores\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/COMPLETE-FIX-RESULTS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md",
        "memory",
        "test"
      ],
      "content_hash": "eadd737a05520117",
      "size_bytes": 9035,
      "created_at": "2026-01-02T20:42:12.440886"
    },
    {
      "doc_id": "local_party-lore_docs_archive_REFACTORING-PROGRESS",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/REFACTORING-PROGRESS.md",
      "content": "# Architecture Refactoring - Progress Report\n\n**Date**: January 2025\n**Status**: Phase 1-2 Complete, Phase 3-4 In Progress (85%)\n\n---\n\n## ‚úÖ COMPLETED\n\n### Phase 1: Model Consolidation\n1. ‚úÖ **Updated all imports** from `game.quality.model.*` to `domain.quality.*`\n   - Updated 10 files across console and game modules\n   - All model imports now reference domain module\n\n2. ‚úÖ **Enhanced domain GameplayTranscript**\n   - Added `addSceneTransition(UUID, String)` method\n   - Added `complete()` method\n   - Added `getEntryCount()` method\n   - Added `getGMNarrativeCount()` method\n   - Domain model now has feature parity with game module version\n\n3. ‚úÖ **Deleted duplicate game.quality package**\n   - Removed `party-lore-game/src/main/java/com/partylore/game/quality/` entirely\n   - Removed duplicate models: GameplayTranscript, IllogicalMoment, NarrativeAnalysisResult\n   - Removed duplicate services: NarrativeQualityAnalysisService, GameplayTranscriptService\n\n### Phase 2: Service Consolidation\n1. ‚úÖ **Updated service imports** to use AI module\n   - Console module now imports from `ai.quality.*`\n   - Game module now imports from `ai.quality.*`\n   - AI module is now authoritative for quality analysis services\n\n2. ‚úÖ **Fixed game module compilation issues**\n   - Updated `AutonomousTestingService` to use AI module's `GameplayTranscriptService` API\n   - Fixed `buildSessionTranscript(UUID)` ‚Üí `buildTranscript(GameSession, int)`\n   - Fixed `getOverallQuality()` ‚Üí `getOverallQualityScore()`\n   - Fixed `getNarrativeConsistency()` ‚Üí `getNarrativeCoherence()`\n   - Fixed enum mapping: `HIGH/LOW` ‚Üí `MAJOR/MINOR`\n   - Updated `AutoFixService` to use correct domain model API\n\n3. ‚úÖ **Game module compiles successfully**\n   - All tests pass: 17 tests in AdvancedAITestAgentServiceTest\n   - No compilation errors in game module\n\n4. ‚úÖ **Fixed console module compilation issues**\n   - Updated `InteractiveDebugService` to use AI module's API\n   - Replaced `hasIssues()` with `!result.getIllogicalMoments().isEmpty()`\n   - Replaced `buildRecentTranscript(UUID, int)` with `buildTranscript(GameSession, int)`\n   - Replaced `formatSummary()` with manual formatting code\n   - Replaced `isHighSeverity()` with explicit severity checks\n   - Updated `RealTimeMonitorService` to build transcripts then analyze\n   - Replaced `Severity.LOW` with `Severity.MINOR`\n\n5. ‚úÖ **Console module compiles successfully**\n   - All compilation errors resolved\n   - No errors in console module\n\n6. ‚úÖ **All modules compile and tests pass**\n   - Domain: 20 tests passing\n   - SMS: 29 tests passing\n   - Game: 17 tests passing\n   - App: 13 tests passing\n   - **Total: 79 tests passing**\n\n---\n\n## ‚ö†Ô∏è IN PROGRESS\n\n### Phase 3: Module Dependencies (90% Complete)\n1. ‚úÖ **Verified console pom.xml dependencies** - Already correct\n2. ‚úÖ **Cleaned up console module package structure**:\n   - Deleted duplicate `console.ai` package\n   - Deleted duplicate `console.autonomous` package\n   - Deleted duplicate `console.debug` package (old location)\n   - Deleted duplicate `console.channel` package (old location)\n3. ‚úÖ **Updated console imports** to use game module services\n4. ‚ö†Ô∏è **Remaining issues**: Type mismatches between `game.model.AIPlayer` and `domain.model.AIPlayer`\n\n### Phase 4: Unified Testing API (75% Complete)\n1. ‚úÖ **Created `TestingOrchestrator` facade** in game.testing package\n   - Provides simplified API for quality analysis\n   - Wraps NarrativeQualityAnalysisService (ai module)\n   - Wraps GameplayTranscriptService (ai module)\n   - Wraps AutonomousTestingService (game module)\n   - Clean, consistent API for console and web modules\n2. ‚úÖ **Added utility methods** for common operations\n3. ‚ö†Ô∏è **Console integration incomplete** due to type mismatches\n\n### Phase 5: Web App Integration\n- Create `GameplayQualityService` in app module\n- Create REST endpoints for quality monitoring\n- Create WebSocket for real-time updates\n\n---\n\n## üìä Impact Summary\n\n### Code Reduction\n- **Deleted**: ~2,000 lines of duplicate code\n- **game.quality.model package**: Deleted (3 duplicate models)\n- **game.quality services**: Deleted (2 duplicate services)\n\n### Architecture Improvements\n- ‚úÖ Single source of truth for models (domain module)\n- ‚úÖ Single source of truth for quality services (ai module)\n- ‚úÖ Game module compiles and tests pass\n- ‚úÖ Console module compiles and tests pass\n- ‚úÖ All 79 tests passing across all modules\n\n### Files Modified\n- **Phase 1-2**:\n  - **10 files**: Import changes from game.quality.model ‚Üí domain.quality\n  - **5 files**: Service import changes from game.quality ‚Üí ai.quality\n  - **1 file**: Enhanced domain GameplayTranscript with missing methods\n  - **4 files**: Fixed API compatibility (game.testing + console services)\n\n- **Phase 3-4**:\n  - **4 duplicate packages deleted** from console module (~1,500 lines)\n  - **1 new file**: TestingOrchestrator facade (game.testing)\n  - **3 files**: Updated console services (RealTimeMonitorService, ConsoleChannelSimulator, PartyLoreConsole)\n  - **Directories cleaned**: Removed console.ai, console.autonomous, console.debug, console.channel\n\n---\n\n## üéØ Next Steps\n\n### ‚úÖ Immediate (COMPLETED)\n1. ‚úÖ Fixed console `InteractiveDebugService` API calls\n2. ‚úÖ Fixed console `RealTimeMonitorService` API calls\n3. ‚úÖ Compiled and tested console module\n4. ‚úÖ Verified all modules compile\n5. ‚úÖ Ran full test suite (79/79 tests passing)\n\n### Short-term (Next - 1-2 hours)\n6. Update console pom.xml dependencies\n7. Stage and document all changes\n\n### Medium-term (Future)\n8. Create `TestingOrchestrator` facade\n9. Enable web app quality monitoring\n10. Documentation updates\n\n---\n\n## üêõ Known Issues\n\n### ‚úÖ RESOLVED\n1. ‚úÖ **Console Module Compilation**: Fixed 7 API mismatch errors\n   - Root cause: Console was using game module's enhanced API\n   - Solution: Updated console to use AI module's API\n   - Status: All errors resolved\n\n2. ‚úÖ **Missing Helper Methods**: Implemented locally in console services\n   - `hasIssues()` ‚Üí `!result.getIllogicalMoments().isEmpty()`\n   - `formatSummary()` ‚Üí Manual formatting in InteractiveDebugService\n   - `isHighSeverity()` ‚Üí Explicit severity comparisons\n   - Status: All methods replaced with working alternatives\n\n3. ‚úÖ **API Differences**: Updated all callers to match AI module API\n   - `buildTranscript(GameSession, int)` - updated all callers\n   - `analyzeTranscript(GameplayTranscript)` - replaced quickAnalysis()\n   - Status: All API calls updated and working\n\n---\n\n## üìù Files Changed\n\n### Domain Module\n- `party-lore-domain/src/main/java/com/partylore/domain/quality/GameplayTranscript.java` - Enhanced\n\n### Game Module\n- **Deleted**: Entire `party-lore-game/src/main/java/com/partylore/game/quality/` package\n- `party-lore-game/src/main/java/com/partylore/game/testing/AutonomousTestingService.java` - Updated API calls\n- `party-lore-game/src/main/java/com/partylore/game/testing/AutoFixService.java` - Updated API calls\n\n### Console Module\n- `party-lore-console/src/main/java/com/partylore/console/service/InteractiveDebugService.java` - API fixes + imports\n- `party-lore-console/src/main/java/com/partylore/console/service/RealTimeMonitorService.java` - API fixes + imports\n- `party-lore-console/src/main/java/com/partylore/console/service/DebugReportService.java` - Import changes\n\n### Test Files\n- `party-lore-game/src/test/java/com/partylore/game/testing/AdvancedAITestAgentServiceTest.java` - Created (17 tests)\n\n---\n\n## ‚úÖ Success Criteria Met\n\n- [x] Domain models are single source of truth\n- [x] AI module provides quality analysis (authoritative)\n- [x] Game module compiles successfully\n- [x] Game module tests pass (17/17)\n- [x] Console module compiles successfully\n- [x] All tests pass across all modules (79/79)\n- [x] Zero duplicate classes\n\n**Overall Progress**: 85% Complete (Phase 1-4)\n\n**Status**:\n- ‚úÖ Phase 1-2 complete (model & service consolidation)\n- ‚úÖ Phase 3 mostly complete (module cleanup, 90%)\n- ‚úÖ Phase 4 mostly complete (TestingOrchestrator created, 75%)\n- ‚ö†Ô∏è Remaining: Fix type mismatches between game.model and domain.model AIPlayer\n\n**Key Achievement**: Eliminated ~3,500 lines of duplicate code across quality models, services, and console packages.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/REFACTORING-PROGRESS.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "8a57521a517876c6",
      "size_bytes": 8254,
      "created_at": "2026-01-02T20:42:12.441028"
    },
    {
      "doc_id": "local_party-lore_docs_archive_DEVELOPMENT",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/DEVELOPMENT.md",
      "content": "# Party Lore - Quick Start Development Guide\n\n> **New to the project?** This is the fastest way to get started. For comprehensive documentation, see [docs/development-setup.md](docs/development-setup.md).\n\n## TL;DR - Get Running in 60 Seconds\n\n```bash\n# 1. Make sure Docker Desktop is running\n\n# 2. Run the app\ncd party-lore-app\nmvn spring-boot:run\n```\n\n**That's it!** üöÄ\n\nSpring Boot automatically:\n- Starts PostgreSQL and Redis containers\n- Configures all connections\n- Runs database migrations\n- Starts your application\n\n## Prerequisites\n\n- **Docker Desktop** (must be running)\n- **Java 17+**\n- **Maven 3.9+**\n\n### ‚ö†Ô∏è Windows Users: Stop Local PostgreSQL\n\nIf you have PostgreSQL installed locally, you **must** stop the service (run as Administrator):\n\n```cmd\nnet stop postgresql-x64-17\n```\n\nOtherwise you'll get port conflicts.\n\n## What Just Happened?\n\nSpring Boot 3.1+ has built-in Docker Compose support. When you run `mvn spring-boot:run`, it:\n\n1. **Detects** `compose.yml` in the project root\n2. **Starts** PostgreSQL & Redis containers\n3. **Waits** for health checks\n4. **Auto-configures** database and Redis connections (no JDBC URLs needed!)\n5. **Runs** your application\n6. **Stops** containers when you exit (optional)\n\n**Zero manual configuration required.**\n\n## Development Workflow\n\n### Start Development\n```bash\nmvn spring-boot:run\n```\n\n### Make Code Changes\nSave your Java files ‚Üí DevTools auto-restarts the app (~3 seconds)\n\n### Stop Development\n`Ctrl+C` ‚Üí Containers stop automatically\n\n### View Logs\n```bash\ndocker compose logs -f\n```\n\n### Reset Database (Clean Slate)\n```bash\ndocker compose down -v  # ‚ö†Ô∏è Deletes all data!\nmvn spring-boot:run     # Fresh start\n```\n\n## Configuration Files (Simplified!)\n\n**Before this refactor:**\n- 7+ config files with duplicated database credentials üòµ\n\n**After (now):**\n- 3 clean files üéâ\n\n```\ncompose.yml              <- PostgreSQL & Redis (single source of truth)\napplication.yml          <- Base config (Flyway, JPA, logging)\napplication-dev.yml      <- Dev-specific overrides\n```\n\n## Profiles\n\n### Default (`dev`)\n```bash\nmvn spring-boot:run\n```\nFull web server + API\n\n### Console Mode\n```bash\nmvn spring-boot:run -Dspring.profiles.active=dev-console\n```\nCLI interface for testing game logic\n\n### Web Mode\n```bash\nmvn spring-boot:run -Dspring.profiles.active=dev-web\n```\nExplicit web mode with Twilio integration\n\n## Common Tasks\n\n### Connect to Database\n```bash\ndocker exec -it postgres psql -U party_lore -d party_lore_dev\n```\n\n### Connect to Redis\n```bash\ndocker exec -it redis redis-cli\n```\n\n### Check Container Status\n```bash\ndocker ps\n```\n\n### Manual Container Control\n```bash\n# Start (if needed)\ndocker compose up -d\n\n# Stop\ndocker compose down\n\n# Reset everything\ndocker compose down -v\n```\n\n## Troubleshooting\n\n### \"Port 5432 already in use\"\nLocal PostgreSQL is running. Stop it:\n```cmd\nnet stop postgresql-x64-17  # Windows (as Administrator)\n```\n\n### \"Cannot connect to Docker daemon\"\nStart Docker Desktop and wait for it to initialize.\n\n### Flyway migration failures\nReset database:\n```bash\ndocker compose down -v\nmvn spring-boot:run\n```\n\n### Enable debug logging\nAdd to `application-dev.yml`:\n```yaml\nlogging:\n  level:\n    org.springframework.boot.docker.compose: DEBUG\n```\n\n## Project Structure\n\n```\nparty-lore/\n‚îú‚îÄ‚îÄ compose.yml                    # Docker services\n‚îú‚îÄ‚îÄ party-lore-app/                # Main Spring Boot app\n‚îú‚îÄ‚îÄ party-lore-domain/             # Domain models\n‚îú‚îÄ‚îÄ party-lore-ai/                 # AI integration\n‚îú‚îÄ‚îÄ party-lore-game/               # Game logic\n‚îú‚îÄ‚îÄ party-lore-sms/                # SMS handling\n‚îú‚îÄ‚îÄ docs/development-setup.md      # Comprehensive guide\n‚îî‚îÄ‚îÄ .specify/                      # Specifications\n```\n\n## IDE Setup\n\n### IntelliJ IDEA\n1. Open project\n2. Enable auto-build (Settings ‚Üí Compiler)\n3. Run ‚Üí Spring Boot (main class: `com.partylore.app.PartyLoreApplication`)\n\n### VS Code\n1. Install Spring Boot Extension Pack\n2. Press F5 to debug\n\n**Both IDEs**: Docker containers auto-start when you run/debug!\n\n## Key Benefits of This Setup\n\n‚úÖ **One command to start** - No manual Docker management\n‚úÖ **Auto-configuration** - Database credentials in one place\n‚úÖ **Hot reload** - Code changes detected automatically\n‚úÖ **Fast iteration** - DevTools restarts in ~3 seconds\n‚úÖ **Clean codebase** - 57% fewer config files\n\n## Next Steps\n\n- üìñ **Read comprehensive guide**: [docs/development-setup.md](docs/development-setup.md)\n- üîß **Configure Twilio**: [docs/TWILIO_SETUP.md](docs/TWILIO_SETUP.md)\n- üìã **View project specs**: [.specify/README.md](.specify/README.md)\n- üöÄ **See what we're building**: [README.md](README.md)\n\n## Help\n\n**Need more details?** See [docs/development-setup.md](docs/development-setup.md)\n\n**Still stuck?** Check:\n- Container logs: `docker compose logs -f`\n- Container status: `docker ps`\n- Application logs: `party-lore-app/logs/`\n\n---\n\n**Setup Time**: < 1 minute\n**First Run**: ~30 seconds (downloads Docker images)\n**Subsequent Runs**: ~5 seconds\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/DEVELOPMENT.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "config",
        "database",
        "md",
        "test"
      ],
      "content_hash": "e1e84b7a854295ab",
      "size_bytes": 5069,
      "created_at": "2026-01-02T20:42:12.441152"
    },
    {
      "doc_id": "local_party-lore_docs_archive_CONTINUE_MEMORY_WORK",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/archive/CONTINUE_MEMORY_WORK.md",
      "content": "# Continue Memory System Work - Session Handoff\n\n**Date:** 2025-01-10\n**Session:** Memory System Foundation Implementation\n**Next Session:** Testing and Optimization\n\n---\n\n## What Was Completed\n\n### ‚úÖ Phase 1: Foundation (COMPLETE)\n\n**1. MemoryServiceImpl Created**\n- **File:** `party-lore-memory/src/main/java/com/partylore/memory/MemoryServiceImpl.java`\n- **Status:** ‚úÖ Complete (700+ lines, fully functional)\n- **Capabilities:**\n  - Stores narrative fragments with importance scoring, emotional tone, memory type\n  - Synthesizes context from memories, plot threads, relationships\n  - Calculates narrative tension\n  - Retrieves character relationships\n  - Generates context summaries\n  - Prunes insignificant memories\n\n**2. GameContextAssembler Enhanced**\n- **File:** `party-lore-game/src/main/java/com/partylore/game/context/GameContextAssembler.java`\n- **Status:** ‚úÖ Complete\n- **Enhancements:**\n  - Integrated MemoryService, MemoryFragmentRepository, PlotThreadRepository\n  - Populates all memory-related GameContext fields\n  - Builds semantic memory context\n\n**3. AI Prompts Enhanced**\n- **File:** `party-lore-ai/src/main/java/com/partylore/ai/AiServiceImpl.java`\n- **Status:** ‚úÖ Complete\n- **Enhancements:**\n  - Injects story context (campaign phase, significant events)\n  - Injects active plot threads with importance\n  - Injects character relationships with affinity scores\n  - Injects narrative tension indicators\n\n**4. Bug Fixes**\n- **File:** `party-lore-console/src/main/java/com/partylore/console/PartyLoreConsole.java`\n- **Status:** ‚úÖ Complete\n- **Fix:** Checks for existing player before creation (no more duplicates)\n\n**5. Cleanup**\n- ‚úÖ Deleted 6 duplicate entity files\n- ‚úÖ Using existing domain entities (MemoryFragment, PlotThread, NarrativeMemory, NPCRelationship)\n\n**6. Documentation**\n- ‚úÖ `MEMORY_SYSTEM_ANALYSIS.md` - Complete architecture analysis\n- ‚úÖ `FR-165` updated with implementation status\n- ‚úÖ Tasks created for next phase\n\n**Commits:**\n- `48ffe13` - feat: Add narrative context & memory system foundation (FR-165)\n- `ac2335e` - docs: Update FR-165 status and create Phase 2 tasks\n\n---\n\n## What Needs to Be Done Next\n\n### üî≤ Phase 2: Testing & Validation (NEXT SESSION)\n\n**Priority Order:**\n\n#### 1. TASK-186: Test Memory System Foundation (HIGHEST PRIORITY)\n- **Estimated:** 2-4 hours\n- **Why First:** Validates foundation works before building on it\n- **Actions:**\n  1. Run Console application with manual gameplay\n  2. Verify memory fragments being created\n  3. Check GameContext population\n  4. Run `/test all` autonomous tests\n  5. Compare quality scores (target: ‚â•7.0/10)\n  6. Document results\n\n**Success Criteria:**\n- Console runs without errors\n- Memory fragments in database after gameplay\n- AI responses show improved narrative continuity\n- Autonomous test quality scores improve\n\n#### 2. TASK-187: Add Database Indexes (AFTER TESTING)\n- **Estimated:** 2-3 hours\n- **Why Second:** Only optimize if foundation works correctly\n- **Actions:**\n  1. Create Liquibase changelog for indexes\n  2. Add composite indexes for common query patterns\n  3. Test query performance (EXPLAIN ANALYZE)\n  4. Document improvements\n\n**Success Criteria:**\n- Context assembly <200ms (from 300-500ms)\n- High-importance memory query <50ms\n- Active plot thread query <30ms\n\n#### 3. TASK-188: Implement Redis Caching (OPTIONAL)\n- **Estimated:** 8-12 hours\n- **Why Third:** Performance optimization, not critical for functionality\n- **Actions:**\n  1. Add Redis dependencies\n  2. Configure RedisTemplate\n  3. Implement MemoryCacheService\n  4. Integrate into MemoryServiceImpl\n  5. Add health checks and metrics\n\n**Success Criteria:**\n- Cache hit rate >80%\n- Context assembly <50ms with cache\n- Graceful fallback to database if Redis unavailable\n\n---\n\n## How to Continue\n\n### Step 1: Review Current State\n\n**Read these files first:**\n1. `MEMORY_SYSTEM_ANALYSIS.md` - Architecture documentation\n2. `FR-165` Implementation Status section (top of file)\n3. `TASK-186` - Testing task details\n\n**Verify implementation:**\n```bash\n# Check files were created/modified\nls -la party-lore-memory/src/main/java/com/partylore/memory/MemoryServiceImpl.java\nls -la party-lore-game/src/main/java/com/partylore/game/context/GameContextAssembler.java\nls -la party-lore-ai/src/main/java/com/partylore/ai/AiServiceImpl.java\n\n# Check git status\ngit log --oneline -5\ngit diff HEAD~2 --stat  # See what changed\n```\n\n### Step 2: Start Testing (TASK-186)\n\n**Option A: Console Testing (Recommended First)**\n```bash\ncd party-lore-console\nmvn spring-boot:run\n```\n\n**Manual Test Scenario:**\n1. Start game session\n2. Perform 10+ varied actions:\n   - Combat: \"attack the goblin with my sword\"\n   - Dialogue: \"ask the merchant about the missing villagers\"\n   - Exploration: \"search the ancient ruins carefully\"\n   - Discovery: \"examine the glowing crystal\"\n3. Observe AI responses for narrative continuity\n4. Check logs for memory storage confirmation\n\n**Verify Database:**\n```sql\n-- After gameplay, check memory fragments\nSELECT\n    COUNT(*) as total,\n    AVG(importance) as avg_importance,\n    type,\n    emotional_tone\nFROM memory_fragments\nGROUP BY type, emotional_tone;\n\n-- Check recent important memories\nSELECT\n    turn_number,\n    importance,\n    type,\n    emotional_tone,\n    LEFT(description, 100) as excerpt\nFROM memory_fragments\nWHERE importance >= 7\nORDER BY timestamp DESC\nLIMIT 10;\n```\n\n**Option B: Autonomous Testing**\n```bash\n# If Console works, run full test suite\n/test all\n\n# Look for improvements in:\n# - Overall quality scores (target: ‚â•7.0/10)\n# - \"Lack of context\" issues (should be reduced)\n# - \"Lack of world-building\" issues (should be reduced)\n```\n\n### Step 3: Document Results\n\n**Create Test Report:**\n```markdown\n# TASK-186 Test Results\n\n## Console Testing\n- ‚úÖ/‚ùå Application started successfully\n- ‚úÖ/‚ùå Memory fragments created (count: X)\n- ‚úÖ/‚ùå GameContext populated correctly\n- ‚úÖ/‚ùå AI responses showed continuity\n- Issues: [list any problems]\n\n## Autonomous Testing\n- Baseline quality: 5.0-7.6/10\n- Current quality: X.X/10\n- Improvement: +X%\n- Context issues: Before X, After Y\n- Issues: [list any problems]\n\n## Database Verification\n- Total fragments: X\n- Importance distribution: [data]\n- Memory types: [data]\n- Emotional tones: [data]\n\n## Recommendation\n- [PASS/FAIL] - [reasons]\n- [If PASS: Proceed to TASK-187]\n- [If FAIL: Fix issues, list them]\n```\n\n### Step 4: Decision Point\n\n**If Testing Passes:**\n- ‚úÖ Proceed to TASK-187 (Database Indexes)\n- ‚úÖ Then consider TASK-188 (Redis Caching)\n\n**If Testing Fails:**\n- ‚ùå Document failures clearly\n- ‚ùå Fix root issues in MemoryServiceImpl or GameContextAssembler\n- ‚ùå Re-test before proceeding\n\n---\n\n## Key Files Reference\n\n### Implementation Files (DO NOT MODIFY unless fixing bugs)\n```\nparty-lore-memory/src/main/java/com/partylore/memory/\n‚îú‚îÄ‚îÄ MemoryServiceImpl.java          (700+ lines - core implementation)\n‚îî‚îÄ‚îÄ StubMemoryService.java          (old stub - not used anymore)\n\nparty-lore-game/src/main/java/com/partylore/game/context/\n‚îî‚îÄ‚îÄ GameContextAssembler.java       (enhanced with memory integration)\n\nparty-lore-ai/src/main/java/com/partylore/ai/\n‚îî‚îÄ‚îÄ AiServiceImpl.java              (enhanced prompts)\n\nparty-lore-console/src/main/java/com/partylore/console/\n‚îî‚îÄ‚îÄ PartyLoreConsole.java           (player creation fix)\n```\n\n### Documentation Files\n```\nMEMORY_SYSTEM_ANALYSIS.md           (architecture deep-dive)\nCONTINUE_MEMORY_WORK.md             (this file)\n.specify/requirements/fr-165-*.md   (requirements with status)\n.specify/tasks/phase-0/task-186.md  (testing task)\n.specify/tasks/phase-0/task-187.md  (indexing task)\n.specify/tasks/phase-0/task-188.md  (caching task)\n```\n\n---\n\n## Important Notes\n\n### What's Working\n- ‚úÖ Memory fragments stored automatically after AI interactions\n- ‚úÖ GameContext populated with plot threads, relationships, tension\n- ‚úÖ AI prompts include rich context sections\n- ‚úÖ Uses existing domain entities (no duplicates)\n- ‚úÖ PostgreSQL-backed (no Redis required yet)\n\n### What's Missing (NOT CRITICAL)\n- ‚ùå Redis caching (direct DB queries only - acceptable for now)\n- ‚ùå AI-powered importance scoring (using keyword heuristics)\n- ‚ùå Advanced relevance filtering (using importance threshold only)\n- ‚ùå Vector embeddings / semantic search (Phase 3)\n\n### Testing Philosophy\n1. **Validate foundation first** - Don't optimize until we know it works\n2. **Measure improvements** - Compare to baseline (autonomous test scores)\n3. **Fix bugs before proceeding** - Don't build on broken foundation\n4. **Document everything** - Next session needs clear results\n\n### Common Issues to Watch For\n\n**Issue: Memory fragments not being created**\n- Check: AiServiceImpl line 137 is being executed\n- Check: MemoryServiceImpl logs show \"Stored narrative fragment\"\n- Fix: Verify @Primary annotation on MemoryServiceImpl\n\n**Issue: GameContext fields are null**\n- Check: GameContextAssembler logs show \"memory-enhanced\"\n- Check: MemoryService methods returning data\n- Fix: Verify Spring bean injection\n\n**Issue: Poor quality scores**\n- Check: AI prompts actually include memory sections (log full prompts)\n- Check: Memory data is meaningful (not empty strings)\n- Fix: May need to adjust importance scoring or context synthesis\n\n**Issue: Database errors**\n- Check: MemoryFragment entity mapping\n- Check: Foreign key constraints\n- Fix: Verify session/player UUIDs are valid\n\n---\n\n## Quick Commands Reference\n\n```bash\n# Start Console for manual testing\ncd party-lore-console && mvn spring-boot:run\n\n# Run autonomous tests (if Console works)\n# In Console: /test all\n\n# Check database (PostgreSQL)\npsql -U partylore -d partylore\n\\dt memory_*   # List memory tables\nSELECT COUNT(*) FROM memory_fragments;\n\n# View recent commits\ngit log --oneline -5\n\n# See what was changed\ngit diff HEAD~2\n\n# Check Spring Boot logs\ntail -f logs/application.log | grep -i memory\n```\n\n---\n\n## Success Criteria for Next Session\n\n### Minimum Success (Must Have)\n- [ ] Console application runs without errors\n- [ ] Memory fragments are being created (verified in database)\n- [ ] GameContext fields are populated (not null)\n- [ ] AI responses reference previous events (observed manually)\n\n### Target Success (Should Have)\n- [ ] Autonomous test quality scores ‚â•7.0/10 average\n- [ ] \"Lack of context\" issues reduced by ‚â•50%\n- [ ] No memory-related errors in logs\n- [ ] Performance acceptable (<500ms context assembly)\n\n### Stretch Goals (Nice to Have)\n- [ ] Database indexes added (TASK-187)\n- [ ] Query performance optimized\n- [ ] Redis caching started (TASK-188)\n\n---\n\n## Questions to Answer in Next Session\n\n1. **Does the foundation work?**\n   - Are memory fragments being created?\n   - Is GameContext populated correctly?\n   - Do AI prompts include memory context?\n\n2. **Does it improve narrative quality?**\n   - Are autonomous test scores better?\n   - Is narrative continuity observable?\n   - Are context-related failures reduced?\n\n3. **What needs fixing?**\n   - Any bugs in MemoryServiceImpl?\n   - Any issues with GameContextAssembler?\n   - Any prompt formatting problems?\n\n4. **What should we optimize?**\n   - Database query performance?\n   - Context synthesis logic?\n   - Importance scoring accuracy?\n\n---\n\n## Contact Context\n\n**Current Branch:** main\n**Last Commit:** ac2335e (docs: Update FR-165 status and create Phase 2 tasks)\n**Next Task:** TASK-186 (Test Memory System Foundation)\n**Status:** Foundation complete, ready for testing\n\n**If starting a new chat:**\n- Read this file first\n- Review MEMORY_SYSTEM_ANALYSIS.md for architecture\n- Check TASK-186 for detailed testing instructions\n- Start with Console testing before autonomous tests\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/archive/CONTINUE_MEMORY_WORK.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "function",
        "md",
        "memory",
        "test"
      ],
      "content_hash": "c41747063404217a",
      "size_bytes": 11693,
      "created_at": "2026-01-02T20:42:12.441204"
    },
    {
      "doc_id": "local_party-lore_docs_original_party-lore-beta-requirements",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/original/party-lore-beta-requirements.md",
      "content": "# Party Lore - Beta Requirements & Content Policy\n\n**Version:** 1.0 - Beta Enrollment Program  \n**Date:** January 5, 2025  \n**Status:** Ready for Implementation\n\n---\n\n## Table of Contents\n\n1. [Content Rating Decision](#content-rating-decision)\n2. [Beta Enrollment Program](#beta-enrollment-program)\n3. [Access Control System](#access-control-system)\n4. [Content Moderation (Beta)](#content-moderation-beta)\n5. [Terms of Service](#terms-of-service)\n6. [Database Schema](#database-schema)\n7. [Beta Onboarding Flow](#beta-onboarding-flow)\n8. [Future Requirements](#future-requirements)\n\n---\n\n## Content Rating Decision\n\n### Final Decision: Mature 17+ (R-Rated)\n\n**Rationale:**\n- Payment processors (Stripe, PayPal, Square) ban NC-17/AO content\n- Visa/Mastercard require special compliance for explicit adult content\n- AO-rated games are banned from major platforms\n- Target demographic (25-45 year olds) want mature themes, not explicit content\n- 30-35% conversion proven for M-rated content vs 5-10% for AO content\n\n### Content Policy: What IS Allowed\n\n```yaml\nviolence:\n  level: \"R-rated movie (Game of Thrones)\"\n  includes:\n    - Fantasy combat with blood and consequences\n    - Character death and injury\n    - Torture as plot device (not gratuitous)\n  excludes:\n    - Torture porn (violence for titillation)\n    - Extreme graphic gore without purpose\n\nlanguage:\n  level: \"TV-MA / R-rated\"\n  includes:\n    - F-word, s-word, profanity\n    - Natural dialogue for characters\n  excludes:\n    - Real-world slurs (n-word, anti-LGBTQ slurs, etc.)\n\nsexual_content:\n  level: \"HBO drama - Fade to Black ALWAYS\"\n  includes:\n    - Romance and relationships\n    - Seduction and attraction\n    - \"What happens next is left to imagination\"\n  excludes:\n    - Explicit sexual descriptions\n    - Sexual violence or assault scenarios\n    - Any sexual content involving minors\n\nhorror:\n  level: \"R-rated psychological horror\"\n  includes:\n    - Body horror and transformations\n    - Psychological terror\n    - Cosmic dread and existential themes\n  excludes:\n    - Graphic gore for shock value\n\nmature_themes:\n  includes:\n    - Moral ambiguity and difficult choices\n    - Political intrigue and betrayal\n    - Loss, grief, and consequences\n    - Complex character motivations\n  excludes:\n    - Glorification of real-world atrocities\n```\n\n### Content Policy: What is NEVER Allowed\n\n```yaml\nabsolutely_prohibited:\n  - Child sexual abuse material (CSAM) - ILLEGAL\n  - Credible threats of real-world violence - ILLEGAL\n  - Sexual assault/rape scenarios (player-initiated)\n  - Explicit sexual content or pornography\n  - Real-world hate speech and slurs\n  - Coordination of illegal activities\n  - Human trafficking content\n```\n\n---\n\n## Beta Enrollment Program\n\n### Why Start with Closed Beta\n\n**Rationale:**\n1. **Validate concept quickly** without building full moderation\n2. **Controlled risk** - trusted users only\n3. **Fast iteration** based on direct feedback\n4. **Lower legal exposure** - private beta has more protection\n5. **Natural viral growth** through invitation system\n6. **Cost efficient** - no need for expensive safety infrastructure yet\n\n### Beta Program Structure\n\n```yaml\nphase_1_beta:\n  duration: 8 weeks\n  target_users: 50-100\n  goal: Validate product-market fit\n  \n  success_criteria:\n    session_completion: 40%+\n    day1_retention: 30%+\n    willing_to_pay: 25%+ at $9.99/month\n    nps_score: 40+\n    \n  decision_point:\n    week_8: Go/No-Go based on metrics\n```\n\n---\n\n## Access Control System\n\n### Four-Tier Access Model\n\n```yaml\ntier_0_admin:\n  role: \"Founders/Core Team\"\n  permissions:\n    - Full system access\n    - Can whitelist Tier 1 users\n    - Can override any action\n    - Access to admin dashboard\n  users: 1-3 people\n\ntier_1_beta_testers:\n  role: \"Approved Beta Testers\"\n  permissions:\n    - Can create campaigns\n    - Can invite friends (who become Tier 2)\n    - Can play in any campaign\n  acquisition: Manual approval via beta application\n  target: 20-30 users\n  \ntier_2_invited_players:\n  role: \"Friends of Beta Testers\"\n  permissions:\n    - Can join campaigns they're invited to\n    - Cannot create own campaigns\n    - Can request upgrade to Tier 1\n  acquisition: Invited by Tier 1 users\n  target: 50-100 users\n\ntier_3_waitlist:\n  role: \"Applied but not yet approved\"\n  permissions:\n    - None - cannot play yet\n  acquisition: Submitted beta application\n  action: Wait for manual approval to Tier 1\n```\n\n### Database Schema: Access Control\n\n```sql\nCREATE TABLE user_access (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    phone_number VARCHAR(20) UNIQUE NOT NULL,\n    email VARCHAR(255),\n    \n    tier INT NOT NULL CHECK (tier IN (0, 1, 2, 3)),\n    -- 0=Admin, 1=Beta Tester, 2=Invited, 3=Waitlist\n    \n    invited_by_phone VARCHAR(20),\n    whitelisted_by_phone VARCHAR(20),\n    approved_at TIMESTAMP,\n    \n    -- Permissions\n    can_create_campaigns BOOLEAN DEFAULT FALSE,\n    can_invite_players BOOLEAN DEFAULT FALSE,\n    is_admin BOOLEAN DEFAULT FALSE,\n    \n    -- Age verification (simple for beta)\n    birth_year INT,\n    is_18_plus BOOLEAN DEFAULT FALSE,\n    verified_at TIMESTAMP,\n    \n    created_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE beta_applications (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    email VARCHAR(255) NOT NULL,\n    phone_number VARCHAR(20) NOT NULL,\n    why_interested TEXT,\n    \n    status VARCHAR(20) DEFAULT 'pending',\n    -- pending, approved, rejected\n    \n    reviewed_by VARCHAR(20),\n    reviewed_at TIMESTAMP,\n    notes TEXT,\n    \n    applied_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE INDEX idx_access_phone ON user_access(phone_number);\nCREATE INDEX idx_access_tier ON user_access(tier);\nCREATE INDEX idx_applications_status ON beta_applications(status);\n```\n\n---\n\n## Content Moderation (Beta)\n\n### Lightweight Approach for Beta\n\n**Rationale:**\n- Small user count (50-100 users)\n- Invitation-only = trusted users\n- Founder can manually review issues\n- Build full moderation system after validation\n\n### Required Safety Features (Minimum)\n\n```yaml\nautomated_screening:\n  hard_blocks:\n    - CSAM keywords (report to NCMEC immediately)\n    - Credible threat patterns\n    - Must respond < 1 second\n  \n  soft_flags:\n    - Explicit sexual language\n    - Violence beyond R-rated\n    - Alert admin for manual review\n\nmessage_logging:\n  requirement: Log ALL messages\n  purpose: \n    - Evidence if legal issues arise\n    - Debug game issues\n    - Respond to reports\n  retention: 90 days minimum\n\nreporting_system:\n  command: \"!REPORT [description]\"\n  response_time: 24 hours maximum\n  action: Admin reviews and decides\n\nadmin_alerts:\n  critical_incidents: SMS to founder immediately\n  flagged_content: Daily digest email\n  \nmanual_review:\n  founder_reviews: 15 minutes/day\n  response_to_reports: Within 24 hours\n```\n\n### Java Implementation (Minimal)\n\n```java\n@Service\npublic class BetaModerationService {\n    \n    private final String ADMIN_PHONE;\n    \n    public ModerationResult screenMessage(\n        String fromPhone, \n        String messageBody\n    ) {\n        // 1. Hard blocks - illegal content\n        if (containsProhibitedContent(messageBody)) {\n            alertAdmin(\"üö® CRITICAL: \" + fromPhone);\n            return ModerationResult.blocked();\n        }\n        \n        // 2. Soft flags - review needed\n        if (containsFlaggedContent(messageBody)) {\n            alertAdmin(\"‚ö†Ô∏è Review needed: \" + fromPhone);\n        }\n        \n        // 3. Log everything\n        auditLog.record(fromPhone, messageBody);\n        \n        return ModerationResult.allowed();\n    }\n    \n    private boolean containsProhibitedContent(String msg) {\n        String lower = msg.toLowerCase();\n        \n        // CSAM - must report\n        if (lower.contains(\"child porn\") || \n            lower.contains(\"pedo\") || \n            lower.contains(\"cp\")) {\n            reportToNCMEC(msg);\n            return true;\n        }\n        \n        // Credible threats\n        boolean hasViolence = lower.matches(\".*(kill|shoot|bomb).*\");\n        boolean hasLocation = lower.matches(\".*(school|mall|\\\\d+\\\\s+\\\\w+\\\\s+street).*\");\n        boolean hasTime = lower.matches(\".*(tomorrow|tonight|monday).*\");\n        \n        return hasViolence && hasLocation && hasTime;\n    }\n}\n```\n\n---\n\n## Terms of Service\n\n### Beta Terms of Service (Simplified)\n\n```markdown\n# Party Lore Beta - Terms of Service\n\nVersion 1.0 - Beta Testing\n\n## 1. Beta Access\n- Private beta for invited users only\n- Access may be revoked at any time\n- Service may be unstable\n- Features may change without notice\n\n## 2. Age & Content Rating\n\n### Age Requirement\nYou must be **18 years or older** to participate.\nBy using this service, you confirm you are 18+.\n\n### Content Rating: Mature 17+\nParty Lore features Mature (17+) content including:\n- Fantasy violence and combat\n- Strong language (profanity)\n- Adult themes (moral complexity, dark storylines)\n- Implied romantic content (fade-to-black)\n- Horror elements (psychological terror)\n\n**Similar to:** Game of Thrones, The Witcher, Breaking Bad\n\n### What is NOT Included\n- Explicit sexual content (we use \"fade to black\")\n- Sexual violence or assault\n- Graphic torture\n- Real-world hate speech\n\n## 3. User Conduct - You Agree NOT To:\n- Harass or threaten other players\n- Use racist, sexist, or discriminatory language\n- Share sexually explicit content\n- Coordinate illegal activities\n- Share content involving minors sexually\n- Make credible threats of violence\n\n### Consequences:\n- First violation: Warning\n- Second violation: 7-day suspension\n- Serious violations: Permanent ban + authorities notified\n\n## 4. Content Moderation\n- All messages are logged\n- Automated screening for prohibited content\n- Violations reviewed within 24 hours\n- Illegal content reported to authorities\n\n## 5. Safety Tools\n- **X-Card**: Text \"X-CARD\" to skip any scene\n- **Content Warnings**: Before intense scenes\n- **Report**: Text \"!REPORT [reason]\" to flag issues\n\n## 6. Privacy\n- Phone number kept private\n- Messages stored for safety and functionality\n- No data sharing with third parties\n- Request deletion: Text \"DELETE MY DATA\"\n\n## 7. Liability\n- Beta software - expect bugs\n- You are responsible for your content\n- We are not liable for user-generated content\n- Section 230 protections apply\n\n## 8. Acceptance\nBy replying \"I AGREE\", you accept these terms.\n\nContact: support@partylore.com\n```\n\n---\n\n## Database Schema\n\n### Core Tables for Beta\n\n```sql\n-- Phone Number Pool (8 numbers: 4 game slots)\nCREATE TABLE phone_numbers (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    phone_number VARCHAR(20) UNIQUE NOT NULL,\n    type VARCHAR(10) NOT NULL CHECK (type IN ('group', 'dm')),\n    slot_number INT NOT NULL CHECK (slot_number BETWEEN 1 AND 4),\n    is_available BOOLEAN DEFAULT TRUE,\n    assigned_at TIMESTAMP,\n    created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Insert 8 numbers on setup\nINSERT INTO phone_numbers (phone_number, type, slot_number) VALUES\n    ('+15550101', 'group', 1), ('+15550102', 'dm', 1),\n    ('+15550201', 'group', 2), ('+15550202', 'dm', 2),\n    ('+15550301', 'group', 3), ('+15550302', 'dm', 3),\n    ('+15550401', 'group', 4), ('+15550402', 'dm', 4);\n\n-- Campaigns\nCREATE TABLE campaigns (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name VARCHAR(255) NOT NULL,\n    realm_type VARCHAR(100) NOT NULL DEFAULT 'fantasy',\n    \n    group_phone_id UUID REFERENCES phone_numbers(id),\n    dm_phone_id UUID REFERENCES phone_numbers(id),\n    \n    status VARCHAR(20) DEFAULT 'recruiting',\n    content_rating VARCHAR(10) DEFAULT 'MATURE_17',\n    \n    created_at TIMESTAMP DEFAULT NOW(),\n    last_activity TIMESTAMP DEFAULT NOW()\n);\n\n-- Players\nCREATE TABLE players (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    phone_number VARCHAR(20) NOT NULL,\n    campaign_id UUID REFERENCES campaigns(id),\n    \n    character_name VARCHAR(100),\n    character_class VARCHAR(50),\n    \n    current_health INT DEFAULT 20,\n    max_health INT DEFAULT 20,\n    level INT DEFAULT 1,\n    \n    personality_profile JSONB DEFAULT '{}',\n    \n    is_ai_controlled BOOLEAN DEFAULT FALSE,\n    last_action_time TIMESTAMP,\n    status VARCHAR(20) DEFAULT 'active',\n    \n    created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Messages (Audit Log)\nCREATE TABLE messages (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    campaign_id UUID REFERENCES campaigns(id),\n    from_phone VARCHAR(20) NOT NULL,\n    to_phone VARCHAR(20) NOT NULL,\n    \n    message_type VARCHAR(20) NOT NULL,\n    body TEXT NOT NULL,\n    \n    was_flagged BOOLEAN DEFAULT FALSE,\n    flag_reason VARCHAR(255),\n    \n    twilio_sid VARCHAR(100),\n    sent_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Moderation Incidents (Beta)\nCREATE TABLE moderation_incidents (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    campaign_id UUID REFERENCES campaigns(id),\n    player_phone VARCHAR(20),\n    \n    incident_type VARCHAR(50),\n    description TEXT,\n    severity VARCHAR(20), -- low, medium, high, critical\n    \n    status VARCHAR(20) DEFAULT 'pending',\n    reviewed_by VARCHAR(20),\n    reviewed_at TIMESTAMP,\n    \n    created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- AI Interactions (Cost Tracking)\nCREATE TABLE ai_interactions (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    campaign_id UUID REFERENCES campaigns(id),\n    \n    input_tokens INT,\n    output_tokens INT,\n    cost_usd DECIMAL(10, 4),\n    model_used VARCHAR(50) DEFAULT 'claude-sonnet-4.5',\n    \n    created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n---\n\n## Beta Onboarding Flow\n\n### For Beta Testers (Tier 1)\n\n```\nStep 1: EMAIL INVITATION\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\"You're invited to Party Lore beta!\n\nParty Lore is an async RPG via SMS.\nPlay D&D-style adventures with friends anytime.\n\nReply to accept.\"\n\nStep 2: PHONE NUMBERS\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nSMS to beta tester:\n\"Welcome to Party Lore beta!\n\nSave these 2 contacts:\n1. üéÆ [Campaign] Group - +1555XXXX\n2. üí¨ [Campaign] DM - +1555YYYY\n\nThen text the GROUP number: START\"\n\nStep 3: TERMS ACCEPTANCE\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\"Before we begin, accept our terms.\n\nParty Lore is MATURE 17+. Includes:\n‚Ä¢ Fantasy violence & combat\n‚Ä¢ Strong language\n‚Ä¢ Adult themes\n‚Ä¢ Fade-to-black romance\n\nSimilar to: Game of Thrones\n\nYou must be 18+.\n\nReply: I AM 18 AND I AGREE\"\n\nStep 4: CHARACTER CREATION\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\"Great! Let's create your character.\n\nWhat's your character's name?\"\n\n[Player: \"Luna\"]\n\n\"Perfect! Is Luna a Fighter, Wizard, or Rogue?\"\n\n[Player: \"Wizard\"]\n\n\"Excellent! Luna the Wizard joins the party.\n\nWaiting for other players... [2/4 ready]\"\n\nStep 5: GAME BEGINS\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\"üé≤ Your party is assembled!\n\n[AI-generated opening scene]\n\nWhat do you do?\n(Just reply naturally)\n\nHelp: Text !HELP\"\n```\n\n### For Invited Players (Tier 2)\n\n```\nINVITATION FROM TIER 1\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n[Beta tester invites friend]\n\nSMS to friend:\n\"üéÆ You're invited to Party Lore!\n\n[Name] invited you to '[Campaign]'\n\nParty Lore = async RPG via text\nMature 17+ content\n\nReply YES to join\nReply INFO to learn more\"\n\n[Friend replies: YES]\n\n[Continue with Steps 2-5 above]\n```\n\n---\n\n## Future Requirements\n\n### When Beta Succeeds (100+ users)\n\n#### Full Content Moderation System\n\n```yaml\nai_moderation:\n  tool: Claude API for contextual review\n  triggers:\n    - Flagged keywords detected\n    - User reports received\n    - Random sampling (5% of messages)\n  cost: ~$0.01 per message reviewed\n\nhuman_moderation:\n  hire: Part-time moderator (20 hrs/week)\n  response_time: 4 hours for reports\n  cost: ~$2,000/month\n\nappeals_process:\n  users_can: Appeal bans within 48 hours\n  review_by: Human moderator\n  response: Within 72 hours\n\nlegal_compliance:\n  terms_review: Full legal review ($2-5K)\n  insurance: Cyber liability ($2-5K/year)\n  ncmec_reporting: Automated system for CSAM\n```\n\n#### Payment Integration\n\n```yaml\npayment_processor: Stripe (Mature 17+ allowed)\n\npricing_tiers:\n  free:\n    sessions: 2/month\n    campaigns: 1\n    \n  premium:\n    price: $4.99/month\n    sessions: Unlimited\n    campaigns: 2\n    \n  pro:\n    price: $9.99/month\n    sessions: Unlimited\n    campaigns: 4\n    features: [AI images, priority support]\n\nimplementation:\n  stripe_integration: 1 week\n  subscription_management: 1 week\n  billing_webhooks: 3 days\n```\n\n#### Multiple Realm Types\n\n```yaml\nlaunch_realms:\n  fantasy: (Available in beta)\n  cyberpunk: (Post-beta)\n  horror: (Post-beta)\n  \nfuture_realms:\n  scifi: Space opera adventures\n  noir: Detective mysteries\n  superhero: Modern hero stories\n  \ndevelopment_time: 2-3 days per realm\n```\n\n#### Mobile App (Optional)\n\n```yaml\nplatform: React Native\nfeatures:\n  - Push notifications\n  - Character sheets\n  - Message history\n  - Quick actions\n  \ndevelopment_time: 3-4 months\nrationale: Optional - SMS works great\n```\n\n#### Advanced Features\n\n```yaml\nai_generated_images:\n  tool: DALL-E 3 or Stable Diffusion\n  use_cases:\n    - Character portraits\n    - Scene illustrations\n    - Battle maps\n  cost: ~$0.04 per image\n\nai_autopilot_v2:\n  features:\n    - Advanced personality profiles\n    - Learning from player behavior\n    - More natural decision-making\n  \nmultiple_concurrent_campaigns:\n  tier_1: 1 campaign\n  tier_premium: 2 campaigns\n  tier_pro: 4 campaigns\n\nweb_dashboard:\n  features:\n    - Campaign management\n    - Character editing\n    - Analytics\n    - Admin tools\n```\n\n#### Age-Gated Realms (Future)\n\n```yaml\nteen_realms:\n  rating: Teen 13+\n  content: PG-13 equivalent\n  verification: Parental consent required\n  moderation: 2x stricter than mature\n  \nmature_plus:\n  rating: Mature 18+\n  content: R-rated (current level)\n  verification: Simple self-attestation\n  \nnote: No NC-17/AO ever due to payment processor bans\n```\n\n---\n\n## Success Metrics\n\n### Beta Phase (Week 1-8)\n\n```yaml\nweek_1:\n  users: 10\n  campaigns: 3\n  bugs: 0 critical\n  response_time: <5 seconds\n\nweek_4:\n  users: 50\n  session_completion: 40%+\n  retention_d1: 30%+\n  nps: 40+\n\nweek_8_decision:\n  green_light:\n    - session_completion: 40%+\n    - retention_d1: 30%+\n    - willing_to_pay: 25%+ at $9.99/mo\n    - positive_feedback: majority\n  \n  yellow_light:\n    - session_completion: 25-40%\n    - mixed_feedback\n    - iterate_and_retest\n  \n  red_light:\n    - session_completion: <25%\n    - negative_feedback\n    - pivot_or_stop\n```\n\n### Post-Beta Targets\n\n```yaml\nmonth_3:\n  users: 250\n  paying: 75 (30%)\n  mrr: $749\n  \nmonth_6:\n  users: 1000\n  paying: 300 (30%)\n  mrr: $2,997\n  target: Break-even\n  \nyear_1:\n  users: 5000\n  paying: 1750 (35%)\n  mrr: $17,482\n  target: Profitable\n```\n\n---\n\n## Implementation Roadmap\n\n### Week 1: Core Infrastructure\n- [ ] PostgreSQL database setup\n- [ ] Run schema migrations\n- [ ] Insert phone number pool\n- [ ] Twilio account + 8 numbers\n- [ ] SMS webhook configuration\n- [ ] Test SMS send/receive\n\n### Week 2: Game Logic + Safety\n- [ ] AccessControlService\n- [ ] MessageRouter\n- [ ] Claude API integration\n- [ ] Character creation\n- [ ] Basic combat system\n- [ ] BetaModerationService\n- [ ] !REPORT command\n- [ ] Admin SMS alerts\n\n### Week 3: Beta Launch\n- [ ] Finalize Terms of Service\n- [ ] Beta application form\n- [ ] Onboarding flow testing\n- [ ] Whitelist 10 friends\n- [ ] Send invitations\n- [ ] Monitor & fix issues\n\n### Week 4-8: Iterate\n- [ ] Gather feedback daily\n- [ ] Fix bugs immediately\n- [ ] Add features based on feedback\n- [ ] Scale to 50-100 users\n- [ ] Track all success metrics\n- [ ] Week 8: Go/No-Go decision\n\n### Post-Beta (If Successful)\n- [ ] Add payment processing (Stripe)\n- [ ] Add cyberpunk + horror realms\n- [ ] Build full moderation system\n- [ ] Hire part-time moderator\n- [ ] Get legal/insurance\n- [ ] Public launch\n\n---\n\n## Cost Estimates\n\n### Beta Phase (50 users)\n\n```\nOne-time:\n  Legal (ToS review): $500\n  Development: Your time (2-3 weeks)\n\nMonthly:\n  Twilio (8 numbers): $9/month\n  SMS (1,500 messages): $11/month\n  Claude API (~400 turns): $8/month\n  Infrastructure (Railway): $5/month\n  \n  Total: ~$33/month\n  Per user: $0.66/month\n```\n\n### At Scale (1,000 users)\n\n```\nMonthly:\n  Twilio: $9/month\n  SMS (30,000 messages): $225/month\n  Claude API (8,000 turns): $152/month\n  Infrastructure: $50/month\n  Moderation: $2,000/month\n  Legal/Insurance: $417/month\n  \n  Total: $2,853/month\n  Per user: $2.85/month\n\nRevenue (30% conversion):\n  300 paying √ó $9.99 = $2,997/month\n  \nProfit: $144/month (5% margin)\n  \nNote: Margin improves significantly at 35-40% conversion\n```\n\n---\n\n## Legal & Compliance\n\n### Required Actions Before Launch\n\n```yaml\nterms_of_service:\n  status: Draft complete (see above)\n  action: Review by lawyer ($500)\n  timeline: Before first user\n\nage_verification:\n  method: Simple self-attestation (\"I am 18+\")\n  sufficient_for: Beta phase\n  upgrade_later: More robust system if needed\n\nmessage_logging:\n  requirement: Log all messages\n  retention: 90 days minimum\n  purpose: Evidence for legal issues\n\nncmec_reporting:\n  requirement: Report CSAM immediately\n  method: Manual during beta\n  upgrade: Automated system post-beta\n\nprivacy_policy:\n  status: To be written\n  key_points:\n    - What data we collect\n    - How we use it\n    - User rights (deletion, export)\n  compliance: GDPR, CCPA basics\n```\n\n### Risk Management\n\n```yaml\nbeta_risk_level: LOW\n  reasons:\n    - Small user count (50-100)\n    - Invitation-only (trusted users)\n    - Active monitoring (founder reviews daily)\n    - Clear content policy\n    - Reporting system in place\n\npost_beta_risk: MEDIUM\n  mitigation:\n    - Full moderation system\n    - Legal review\n    - Insurance coverage\n    - Established policies\n```\n\n---\n\n## Appendix: Key Decisions Made\n\n### Decision Log\n\n```yaml\ndecision_1:\n  topic: Content Rating\n  options: [Mature 17+, NC-17/AO]\n  chosen: Mature 17+\n  rationale: Payment processors ban AO, target demo wants mature themes not explicit content\n\ndecision_2:\n  topic: Launch Strategy\n  options: [Public launch, Closed beta]\n  chosen: Closed beta\n  rationale: Validate before building expensive moderation, controlled risk\n\ndecision_3:\n  topic: Moderation Approach\n  options: [Full system now, Lightweight for beta]\n  chosen: Lightweight for beta\n  rationale: Small trusted user base, add full system after validation\n\ndecision_4:\n  topic: Access Control\n  options: [Open to all, Whitelist only]\n  chosen: Whitelist with tiers\n  rationale: Quality control, viral growth built-in, low risk\n\ndecision_5:\n  topic: Age Verification\n  options: [ID verification, Simple attestation]\n  chosen: Simple attestation for beta\n  rationale: Sufficient for Mature 17+, upgrade if needed later\n```\n\n---\n\n**Document Version:** 1.0  \n**Last Updated:** January 5, 2025  \n**Next Review:** After Week 8 Beta Results  \n**Status:** Approved - Ready for Implementation",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/original/party-lore-beta-requirements.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "llm",
        "md"
      ],
      "content_hash": "73dbfc660a82602b",
      "size_bytes": 22851,
      "created_at": "2026-01-02T20:42:12.441299"
    },
    {
      "doc_id": "local_party-lore_docs_original_overview_and_biz_plan",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/original/overview_and_biz_plan.md",
      "content": "# Party Lore - Product Overview & Business Plan\n\n**Version:** 1.0  \n**Last Updated:** 2025-01-05  \n**Game:** Party Lore - Async SMS RPG with AI Dungeon Master  \n**Status:** Development Ready\n\n---\n\n## Executive Summary\n\n### What is Party Lore?\n\nParty Lore is an asynchronous multiplayer RPG delivered entirely through SMS text messaging, where an AI Dungeon Master (powered by Claude) orchestrates epic adventures for groups of 3-6 friends. No app required - just text to play.\n\n### The Problem We're Solving\n\n**10+ million D&D players can't find time to play together.**\n\nTraditional tabletop RPGs require:\n- 3-5 hour sessions\n- Everyone free at the same time\n- Weekly commitments\n- Complex scheduling coordination\n\n**82% of D&D groups dissolve within 6 months due to scheduling conflicts.**\n\n### Our Solution\n\n**Play tabletop RPGs over text. Take your turn whenever you have 2 minutes.**\n\n- **Async gameplay**: Respond in 5 minutes or 5 hours - the game adapts\n- **SMS delivery**: Works on any phone, no app needed\n- **AI Dungeon Master**: Always available, never cancels\n- **Auto-pilot**: AI plays for absent players based on their personality\n- **Persistent stories**: Pick up where you left off, even months later\n\n---\n\n## Product Vision & Strategy\n\n### Mission Statement\nEnable every tabletop RPG fan to experience epic adventures with friends, regardless of schedule, location, or device.\n\n### Core Principles\n1. **Accessibility First** - If it works on a 10-year-old flip phone, it works\n2. **Story Over Systems** - Narrative engagement trumps complex mechanics\n3. **Respect Player Time** - 2-minute turns, play when convenient\n4. **Social Connection** - Strengthen friendships through shared adventures\n5. **AI as Enabler** - Technology serves the story, not vice versa\n\n### 3-Year Vision\nBecome the default way busy adults play tabletop RPGs together, with 100,000+ active players across multiple game systems and genres.\n\n---\n\n## Product Differentiation\n\n### Why SMS Instead of an App?\n\n| **SMS Approach** | **Mobile App Approach** |\n|-----------------|------------------------|\n| **Zero friction** - text to play | Download required |\n| **100% reach** - every phone works | App store approval needed |\n| **Native notifications** - never missed | Push notification fatigue |\n| **No storage needed** | Uses phone storage |\n| **Instant onboarding** - save 2 contacts | Account creation required |\n| **Group chat familiar** | New interface to learn |\n| **$0 customer acquisition** via referral | $2-10 CAC via ads |\n\n### Unique Value Propositions\n\n1. **Dual-Channel System**\n   - Group chat for main story (everyone sees)\n   - Private DM chat for secrets/questions (1:1)\n\n2. **Deep Narrative Memory**\n   - AI remembers months of gameplay\n   - Tracks relationships, plot threads, consequences\n   - Every decision matters long-term\n\n3. **Multiple Concurrent Campaigns**\n   - Play up to 4 different games simultaneously\n   - Different genres: Fantasy, Sci-Fi, Horror, Cyberpunk\n\n4. **AI Autopilot**\n   - Never stall because someone is busy\n   - AI plays missing players in-character\n   - Players can review and adjust AI actions\n\n5. **Scene-Based Resolution**\n   - Major scenes resolve when 75% of players act\n   - Quick scenes need only 50%\n   - Momentum tokens reward active players\n\n---\n\n## Market Analysis\n\n### TAM (Total Addressable Market)\n- **Tabletop RPG Players**: 40M globally, 10M+ in US\n- **D&D Specific**: 10M+ active players\n- **Mobile Gaming**: $90B annual market\n- **SMS Users**: 5B+ people globally\n\n### SAM (Serviceable Addressable Market)\n- **English-speaking RPG players**: ~7M\n- **Ages 25-45 with smartphones**: ~5M\n- **Willing to pay for games**: ~2.5M\n\n### SOM (Serviceable Obtainable Market)\n- **Year 1**: 1,000 users (0.04% of SAM)\n- **Year 3**: 25,000 users (1% of SAM)\n- **Year 5**: 100,000 users (4% of SAM)\n\n### Competition Analysis\n\n| Competitor | Strengths | Weaknesses | Our Advantage |\n|------------|-----------|------------|---------------|\n| **Roll20/Foundry VTT** | Full D&D rules, maps | Requires scheduled sessions | Async play |\n| **AI Dungeon** | AI storytelling | Single player only | Multiplayer social |\n| **Discord RPG Bots** | Free, familiar platform | Requires app, complex setup | SMS simplicity |\n| **Play-by-post Forums** | Async, deep RP | Slow (days between posts) | Fast resolution |\n| **D&D Beyond** | Official, comprehensive | No gameplay, just tools | Complete game experience |\n\n### Target Customer Segments\n\n**Primary: Lapsed RPG Players (60%)**\n- Ages 28-40\n- Played D&D in college/high school\n- Now have careers/families\n- Miss the experience but can't commit time\n\n**Secondary: Current Players (25%)**\n- Active in regular campaigns\n- Want additional games between sessions\n- Testing new characters/stories\n\n**Tertiary: RPG Curious (15%)**\n- Heard of D&D through pop culture\n- Intimidated by complexity\n- Want easy entry point\n\n---\n\n## Go-to-Market Strategy\n\n### Phase 1: Community Validation (Months 1-2)\n**Goal**: Validate core concept with 10-15 test groups\n\n**Channels:**\n- Reddit communities (r/DnD, r/lfg)\n- Discord RPG servers\n- Local gaming groups\n- Friends and family\n\n**Metrics:**\n- 70% session completion rate\n- 40% next-day retention\n- 30% willing to pay $10/month\n\n### Phase 2: Beta Launch (Months 3-4)\n**Goal**: 100 active players, refine experience\n\n**Features:**\n- SMS PoC fully functional\n- 3 realm types (Fantasy, Sci-Fi, Horror)\n- Basic onboarding flow\n- Payment integration\n\n**Marketing:**\n- RPG podcast sponsorships ($500 budget)\n- Actual play demo videos\n- Influencer partnerships (micro-influencers)\n\n### Phase 3: Public Launch (Months 5-6)\n**Goal**: 1,000 paying users\n\n**Channels:**\n- Product Hunt launch\n- Hacker News Show HN\n- Gaming press (Polygon, Kotaku)\n- TikTok D&D creators\n\n**Retention Strategy:**\n- Referral rewards (free month for each friend)\n- Guild system (multiple groups connected)\n- Seasonal events and new realms\n\n### Customer Acquisition Strategy\n\n**Viral Loop Built-In:**\n```\n1. Player starts campaign ‚Üí Invites 3-5 friends\n2. Friends love it ‚Üí Each starts their own campaign\n3. Viral coefficient: 1.5-2.0 (each user brings 1.5-2 new users)\n4. CAC: ~$0 (organic growth through invites)\n```\n\n**Content Marketing:**\n- \"Best moments\" from campaigns (anonymized)\n- How-to guides for new DMs\n- Character creation tools\n- World-building resources\n\n---\n\n## Revenue Model\n\n### Pricing Tiers\n\n**Free Tier - \"Adventurer\"**\n- 2 sessions per month\n- 1 concurrent campaign\n- Standard realms only\n- Purpose: Acquisition funnel\n\n**Premium - \"Hero\" ($4.99/month)**\n- Unlimited sessions\n- 2 concurrent campaigns\n- All realm types\n- Priority AI responses\n- Purpose: Core monetization\n\n**Pro - \"Legend\" ($9.99/month)**\n- Everything in Hero\n- 4 concurrent campaigns\n- Custom realm creation\n- Advanced AI features\n- Beta features early access\n- Purpose: Power user monetization\n\n### Revenue Projections\n\n| Metric | Year 1 | Year 2 | Year 3 | Year 5 |\n|--------|--------|--------|--------|--------|\n| **Total Users** | 1,000 | 10,000 | 25,000 | 100,000 |\n| **Paying Users** | 300 (30%) | 3,000 (30%) | 8,750 (35%) | 40,000 (40%) |\n| **ARPU** | $6.00 | $6.50 | $7.00 | $7.50 |\n| **MRR** | $1,800 | $19,500 | $61,250 | $300,000 |\n| **ARR** | $21,600 | $234,000 | $735,000 | $3,600,000 |\n\n### Unit Economics\n\n**Per User Per Month:**\n- Revenue: $6.50 (average)\n- SMS Costs: $2.00\n- AI Costs: $1.80\n- Infrastructure: $0.20\n- **Gross Margin: $2.50 (38%)**\n\n**At Scale (10,000 users):**\n- Revenue: $65,000/month\n- Total Costs: $40,000/month\n- **Net Profit: $25,000/month (38%)**\n\n---\n\n## Development Roadmap\n\n### PoC Phase (Weeks 1-3) ‚úì Ready to Start\n**Goal**: Prove concept with basic SMS bot\n- Simple group gameplay via Twilio\n- Claude AI integration\n- Basic character tracking\n- 10-15 test groups\n\n### MVP Phase (Months 1-3)\n**Goal**: Core product with payment\n- Full SMS architecture\n- Multiple realm types\n- Character progression\n- Narrative memory system\n- Subscription billing\n\n### Growth Phase (Months 4-6)\n**Goal**: Scale to 1,000 users\n- Mobile app (optional, complementary)\n- AI-generated images\n- Advanced memory system\n- Referral system\n- Analytics dashboard\n\n### Expansion Phase (Months 7-12)\n**Goal**: Platform maturity\n- Custom realm builder\n- User-generated content\n- API for third-party tools\n- International expansion\n- White-label offerings\n\n---\n\n## Key Metrics & KPIs\n\n### User Engagement\n- **D1 Retention**: Target 40% (industry avg: 25%)\n- **D7 Retention**: Target 25% (industry avg: 15%)\n- **D30 Retention**: Target 15% (industry avg: 10%)\n- **Session Frequency**: 2-3 times per week\n- **Actions per Session**: 4-8 per player\n\n### Business Metrics\n- **CAC**: <$5 (mostly organic)\n- **LTV**: $65 (10-month avg lifetime)\n- **LTV:CAC**: 13:1\n- **Payback Period**: <2 months\n- **Churn Rate**: <10% monthly\n\n### Operational Metrics\n- **SMS Delivery Rate**: >98%\n- **AI Response Time**: <3 seconds\n- **Scene Resolution Time**: <2 hours\n- **Support Response Time**: <4 hours\n\n---\n\n## Risk Analysis & Mitigation\n\n### Technical Risks\n\n| Risk | Impact | Probability | Mitigation |\n|------|--------|------------|------------|\n| **AI API Downtime** | High | Low | Fallback to GPT-4, cached responses |\n| **SMS Delivery Issues** | High | Medium | Multiple provider redundancy |\n| **Scaling Challenges** | Medium | Medium | Start with proven architecture |\n| **Data Loss** | High | Low | Regular backups, redundant storage |\n\n### Business Risks\n\n| Risk | Impact | Probability | Mitigation |\n|------|--------|------------|------------|\n| **Low Retention** | High | Medium | Rapid iteration on engagement |\n| **Competition from WotC** | High | Low | Avoid D&D trademarks, unique features |\n| **High Churn Rate** | High | Medium | Focus on social bonds, guild system |\n| **Platform Dependencies** | Medium | Low | Abstract providers, avoid lock-in |\n\n### Legal Risks\n\n| Risk | Impact | Probability | Mitigation |\n|------|--------|------------|------------|\n| **Copyright Infringement** | Critical | Medium | Strict content filtering, legal review |\n| **TCPA Compliance** | High | Low | Clear opt-in, unsubscribe options |\n| **Data Privacy (GDPR)** | Medium | Low | Privacy-first design, compliance audit |\n\n---\n\n## Team & Resources\n\n### Current Team\n- **Solo Founder/Developer**\n  - Full-stack development\n  - Game design\n  - Initial go-to-market\n\n### Hiring Plan\n\n**Month 3-6:**\n- Contract illustrator for marketing assets\n- Part-time community manager\n- QA tester (contract)\n\n**Month 7-12:**\n- Full-time backend engineer\n- Full-time growth marketer\n- Part-time customer support\n\n**Year 2:**\n- AI/ML engineer\n- Mobile developer\n- Content creators (2)\n- Head of growth\n\n### Funding Strategy\n\n**Bootstrap Phase (Months 1-6):**\n- Personal investment: $5,000\n- Revenue from early users\n- Keep costs <$500/month\n\n**Seed Round (Month 7-12):**\n- Target: $500K-$1M\n- Use: Team, marketing, infrastructure\n- Investors: Gaming-focused angels, small funds\n\n**Series A (Year 2-3):**\n- Target: $3-5M\n- Use: Scale team, expand internationally\n- Investors: Gaming/AI focused VCs\n\n---\n\n## Success Criteria\n\n### 3-Month Goals\n- [ ] 100 active players\n- [ ] 30% paid conversion\n- [ ] 40% D1 retention\n- [ ] $500 MRR\n\n### 6-Month Goals\n- [ ] 1,000 active players\n- [ ] 35% paid conversion\n- [ ] NPS score >50\n- [ ] $3,000 MRR\n\n### 12-Month Goals\n- [ ] 5,000 active players\n- [ ] 40% paid conversion\n- [ ] 3+ realm types\n- [ ] $15,000 MRR\n- [ ] Break-even operations\n\n### 3-Year Vision\n- [ ] 50,000+ active players\n- [ ] $200K+ MRR\n- [ ] 10+ realm types\n- [ ] API platform\n- [ ] Acquisition opportunity\n\n---\n\n## Competitive Advantages\n\n### Moats\n\n1. **Network Effects**\n   - More players = better games\n   - Friend groups create stickiness\n   - Shared narratives build community\n\n2. **Technical Complexity**\n   - SMS + AI orchestration is non-trivial\n   - Narrative memory system is unique\n   - Multi-channel architecture is novel\n\n3. **Data Advantage**\n   - Learn optimal narrative pacing\n   - Understand player preferences\n   - Train custom AI models\n\n4. **Brand & Community**\n   - First mover in async SMS RPG\n   - Strong word-of-mouth growth\n   - Creator ecosystem potential\n\n---\n\n## Exit Strategy\n\n### Potential Acquirers\n\n**Gaming Companies:**\n- Wizards of the Coast (D&D synergy)\n- Paradox Interactive (RPG focus)\n- Embracer Group (broad portfolio)\n\n**AI Companies:**\n- Anthropic (showcase for Claude)\n- Character.AI (gaming expansion)\n\n**Communication Platforms:**\n- Discord (RPG features)\n- Twilio (showcase customer)\n\n### Exit Scenarios\n\n**Base Case (Year 3-4):**\n- 25,000 users\n- $750K ARR\n- Valuation: $5-7M\n- Acqui-hire opportunity\n\n**Success Case (Year 5):**\n- 100,000 users\n- $3.6M ARR\n- Valuation: $25-35M\n- Strategic acquisition\n\n**Best Case (Year 7):**\n- 500,000+ users\n- $20M+ ARR\n- Valuation: $100M+\n- IPO potential or major acquisition\n\n---\n\n## Conclusion\n\nParty Lore represents a unique convergence of proven technologies (SMS, AI) applied to an underserved market (busy RPG players). With minimal technical risk, clear monetization path, and viral growth mechanics, it's positioned to capture a significant share of the growing async gaming market.\n\nThe SMS-first approach eliminates traditional mobile game barriers while the AI Dungeon Master solves the fundamental scheduling problem that kills 82% of RPG groups. With disciplined execution and focus on player retention, Party Lore can become the definitive platform for async tabletop RPG experiences.\n\n**Next Steps:**\n1. Complete SMS PoC (3 days with existing code)\n2. Run 10-15 test groups (2 weeks)\n3. Validate willingness to pay\n4. Begin MVP development if metrics hit targets\n\n---\n\n**Document Status:** Final  \n**Review Schedule:** Monthly after launch  \n**Contact:** [founder email]  \n**Last Updated:** 2025-01-05",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/original/overview_and_biz_plan.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "async",
        "md"
      ],
      "content_hash": "f66935b144a38260",
      "size_bytes": 13770,
      "created_at": "2026-01-02T20:42:12.441357"
    },
    {
      "doc_id": "local_party-lore_docs_original_sms_auth_spec",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/original/sms_auth_spec.md",
      "content": "# Party Lore - SMS Verification & Phone Transfer Specification\n\n**Version:** 1.0  \n**Date:** January 5, 2025  \n**Status:** Ready for Implementation  \n**Architecture Decision:** Phone Number as Primary Identity (No Login Required)\n\n---\n\n## Table of Contents\n\n1. [Architecture Overview](#architecture-overview)\n2. [SMS Verification for Campaign Creation](#sms-verification-for-campaign-creation)\n3. [Phone Number Transfer System](#phone-number-transfer-system)\n4. [Database Schema](#database-schema)\n5. [API Specifications](#api-specifications)\n6. [Frontend Implementation](#frontend-implementation)\n7. [Error Handling](#error-handling)\n8. [Security Considerations](#security-considerations)\n9. [Testing Strategy](#testing-strategy)\n10. [Monitoring & Alerts](#monitoring--alerts)\n\n---\n\n## Architecture Overview\n\n### Identity Model\n\n**Phase 1 (MVP): Phone Number = Identity**\n\n- No user accounts, no passwords, no login required\n- Phone number is the unique identifier for all players\n- SMS verification only used for sensitive actions (campaign creation, phone transfer)\n- All game data keyed to phone number in database\n\n**Why This Approach:**\n- ‚úÖ Zero friction for users (no account creation)\n- ‚úÖ Perfect for SMS-first product vision\n- ‚úÖ Gen X demographic comfortable with SMS\n- ‚úÖ Faster time to market (less code to build)\n- ‚úÖ Can add accounts later if needed (Phase 2+)\n\n### When SMS Verification Is Required\n\n1. **Campaign Creation** - Verify creator's phone before sending invites\n2. **Phone Transfer** - Verify old phone before initiating, verify new phone to complete\n3. **Future: Payment Setup** - When adding billing (Phase 2)\n\n### When NO Verification Needed\n\n- Gameplay (already authenticated by SMS sender)\n- Receiving invites\n- Joining campaigns (reply YES to invite)\n- All game commands (!status, !inventory, etc.)\n\n---\n\n## SMS Verification for Campaign Creation\n\n### User Journey\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Step 1: Campaign Details           ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Campaign Name: [Dragon Heist____]  ‚îÇ\n‚îÇ  Your Phone: [+1 (555) 123-4567]   ‚îÇ\n‚îÇ  Realm: ‚óã Fantasy ‚óã Sci-Fi ‚óã Horror‚îÇ\n‚îÇ                                     ‚îÇ\n‚îÇ  [ Send Verification Code ]         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n              ‚Üì\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Step 2: Verify Phone               ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Code sent to: +1 (555) 123-4567   ‚îÇ\n‚îÇ  Enter 6-digit code:                ‚îÇ\n‚îÇ  [_] [_] [_] [_] [_] [_]           ‚îÇ\n‚îÇ                                     ‚îÇ\n‚îÇ  Didn't receive? [ Resend ] (30s)  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n              ‚Üì\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Step 3: Invite Friends             ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Friend #1                          ‚îÇ\n‚îÇ  Name: [Sarah___] Phone: [+1...]   ‚îÇ\n‚îÇ  Friend #2                          ‚îÇ\n‚îÇ  Name: [Mike____] Phone: [+1...]   ‚îÇ\n‚îÇ                                     ‚îÇ\n‚îÇ  [ Create Campaign & Send Invites ] ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n              ‚Üì\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Step 4: Success                    ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  üéâ Campaign Created!               ‚îÇ\n‚îÇ  Invites sent to 2 friends.         ‚îÇ\n‚îÇ  Save these contacts:               ‚îÇ\n‚îÇ  ‚Ä¢ üéÆ Dragon Heist Group            ‚îÇ\n‚îÇ  ‚Ä¢ üí¨ Dragon Heist DM               ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### SMS Messages\n\n**Verification Code SMS:**\n```\nParty Lore: Your verification code for \"Dragon Heist\" is: 123456\n\nExpires in 10 minutes.\n```\n\n**Invitation SMS (to friends):**\n```\nHey Sarah! You've been invited to Party Lore üéÆ\n\nCampaign: Dragon Heist\nRealm: Fantasy\n\nReply YES to join the adventure!\n\nOnce you join, save these contacts:\nüì± Group: +1-555-0101\nüí¨ DM: +1-555-0102\n\nReply STOP to decline.\nMsg&data rates may apply.\n```\n\n---\n\n## Phone Number Transfer System\n\n### Use Case\n\nPlayer gets a new phone and needs to transfer their account:\n- Old phone: +1-555-111-1111\n- New phone: +1-555-222-2222\n\n### User Journey\n\n**From Old Phone:**\n```\nPlayer texts: \"TRANSFER\"\n                ‚Üì\nSystem responds:\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüì± Phone Transfer\n\nTo move your account to a new phone:\n\n1. Your transfer code is: ABC-123-XYZ\n2. This code expires in 24 hours\n3. Text this code from your NEW phone\n4. Format: TRANSFER ABC-123-XYZ\n\nNeed help? Reply HELP\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n```\n\n**From New Phone:**\n```\nPlayer texts: \"TRANSFER ABC-123-XYZ\"\n                ‚Üì\nSystem responds:\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚úÖ Transfer Complete!\n\nYour account has been moved to this phone.\n\nCampaigns:\n‚Ä¢ Dragon Heist (Active)\n‚Ä¢ Cyber Run (Paused)\n\nYou'll now receive all messages here.\n\nWelcome back! üéÆ\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n```\n\n**Security Notification (to old phone):**\n```\n‚ÑπÔ∏è Your Party Lore account was transferred \nto a new phone (ending in 2222) on Jan 5.\n\nIf this wasn't you, reply CANCEL immediately \nand we'll help secure your account.\n```\n\n### Transfer Code Format\n\n**Format:** `ABC-123-XYZ`\n- 3 uppercase letters (no I, O to avoid confusion)\n- 3 digits\n- 3 uppercase letters\n- Dashes for readability\n\n**Security Features:**\n- Expires in 24 hours\n- Single use only\n- Cannot transfer to same phone\n- Rate limited (1 transfer per week)\n- Suspicious activity detection\n\n---\n\n## Database Schema\n\n```sql\n-- =====================================================\n-- VERIFICATION CODES\n-- =====================================================\nCREATE TABLE verification_codes (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    phone_number VARCHAR(20) NOT NULL,\n    code VARCHAR(6) NOT NULL,\n    purpose VARCHAR(50) NOT NULL, -- 'campaign_creation', 'phone_transfer', 'login'\n    attempts INT DEFAULT 0,\n    max_attempts INT DEFAULT 3,\n    created_at TIMESTAMP DEFAULT NOW(),\n    expires_at TIMESTAMP NOT NULL,\n    verified_at TIMESTAMP,\n    ip_address VARCHAR(45),\n    user_agent TEXT,\n    INDEX idx_phone_purpose (phone_number, purpose),\n    INDEX idx_expires (expires_at)\n);\n\n-- =====================================================\n-- SMS RATE LIMITING\n-- =====================================================\nCREATE TABLE sms_rate_limits (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    phone_number VARCHAR(20) NOT NULL,\n    action_type VARCHAR(50) NOT NULL, -- 'verification', 'invite', 'gameplay'\n    count INT DEFAULT 1,\n    window_start TIMESTAMP DEFAULT NOW(),\n    INDEX idx_phone_action (phone_number, action_type, window_start)\n);\n\n-- =====================================================\n-- PHONE TRANSFERS\n-- =====================================================\nCREATE TABLE phone_transfers (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    old_phone VARCHAR(20) NOT NULL,\n    new_phone VARCHAR(20),\n    transfer_code VARCHAR(15) UNIQUE NOT NULL, -- ABC-123-XYZ format\n    status VARCHAR(20) DEFAULT 'pending', -- pending, completed, cancelled, expired\n    initiated_at TIMESTAMP DEFAULT NOW(),\n    completed_at TIMESTAMP,\n    expires_at TIMESTAMP NOT NULL,\n    ip_address VARCHAR(45),\n    confirmed_by_new_phone BOOLEAN DEFAULT FALSE,\n    INDEX idx_old_phone (old_phone),\n    INDEX idx_transfer_code (transfer_code),\n    INDEX idx_expires (expires_at)\n);\n\n-- =====================================================\n-- TRANSFER AUDIT LOG\n-- =====================================================\nCREATE TABLE phone_transfer_log (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    transfer_id UUID REFERENCES phone_transfers(id),\n    action VARCHAR(50) NOT NULL, -- initiated, completed, cancelled, expired\n    old_phone VARCHAR(20),\n    new_phone VARCHAR(20),\n    ip_address VARCHAR(45),\n    user_agent TEXT,\n    timestamp TIMESTAMP DEFAULT NOW()\n);\n```\n\n---\n\n## API Specifications\n\n### Verification Endpoints\n\n#### 1. Request Verification Code\n\n```typescript\nPOST /api/verify/request\n\nRequest Body:\n{\n  phone_number: string;        // E.164 format: +12345678900\n  purpose: string;              // 'campaign_creation' | 'phone_transfer' | 'login'\n  campaign_name?: string;       // Optional, for SMS context\n}\n\nSuccess Response (200):\n{\n  success: true,\n  verification_id: string,      // UUID\n  phone_number: string,          // Cleaned E.164\n  expires_in: number,            // Seconds (600)\n  can_resend_in: number          // Seconds (30)\n}\n\nError Responses:\n400 - Invalid phone number format\n429 - Too many verification attempts (3 per hour limit)\n500 - Failed to send SMS\n```\n\n#### 2. Confirm Verification Code\n\n```typescript\nPOST /api/verify/confirm\n\nRequest Body:\n{\n  verification_id: string;\n  code: string;                  // 6 digits\n}\n\nSuccess Response (200):\n{\n  success: true,\n  session_token: string,         // For next step (expires 10 min)\n  phone_number: string,\n  expires_in: number\n}\n\nError Responses:\n400 - Invalid code, expired, or max attempts reached\n404 - Verification not found or already used\n```\n\n#### 3. Create Campaign (After Verification)\n\n```typescript\nPOST /api/campaigns/create\n\nRequest Body:\n{\n  session_token: string;\n  campaign_name: string;\n  realm_type: string;            // 'fantasy' | 'scifi' | 'horror'\n  invited_players: Array<{\n    name: string;\n    phone_number: string;\n  }>;\n}\n\nSuccess Response (201):\n{\n  success: true,\n  campaign: {\n    id: string,\n    name: string,\n    realm_type: string,\n    group_phone: string,\n    dm_phone: string,\n    status: string,\n    created_at: string\n  },\n  invited_count: number\n}\n\nError Responses:\n401 - Invalid or expired session\n400 - Validation errors\n503 - No available game slots\n```\n\n### Transfer Endpoints (SMS Commands)\n\n**Initiate Transfer:**\n```\nSMS Command: \"TRANSFER\"\nTrigger: Player texts from old phone\nResponse: Transfer code via SMS\n```\n\n**Complete Transfer:**\n```\nSMS Command: \"TRANSFER ABC-123-XYZ\"\nTrigger: Player texts from new phone\nResponse: Confirmation via SMS\n```\n\n**Cancel Transfer:**\n```\nSMS Command: \"CANCEL\"\nTrigger: Old phone holder within 24h\nResponse: Reversal confirmation\n```\n\n---\n\n## Frontend Implementation\n\n### Campaign Creator Component\n\n```typescript\n// components/CampaignCreator.tsx\n\nimport React, { useState } from 'react';\nimport { api } from '../services/api';\n\ntype Step = 'details' | 'verify' | 'invites' | 'success';\n\nexport function CampaignCreator() {\n  const [step, setStep] = useState<Step>('details');\n  const [phone, setPhone] = useState('');\n  const [campaignName, setCampaignName] = useState('');\n  const [realmType, setRealmType] = useState('fantasy');\n  const [verificationId, setVerificationId] = useState('');\n  const [code, setCode] = useState('');\n  const [sessionToken, setSessionToken] = useState('');\n  const [invites, setInvites] = useState([\n    { name: '', phone: '' },\n    { name: '', phone: '' }\n  ]);\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  async function handleRequestCode() {\n    setLoading(true);\n    setError('');\n    \n    try {\n      const response = await api.post('/verify/request', {\n        phone_number: phone,\n        purpose: 'campaign_creation',\n        campaign_name: campaignName\n      });\n      \n      setVerificationId(response.data.verification_id);\n      setStep('verify');\n    } catch (err: any) {\n      setError(err.response?.data?.error || 'Failed to send code');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleVerifyCode() {\n    setLoading(true);\n    setError('');\n    \n    try {\n      const response = await api.post('/verify/confirm', {\n        verification_id: verificationId,\n        code: code\n      });\n      \n      setSessionToken(response.data.session_token);\n      setStep('invites');\n    } catch (err: any) {\n      setError(err.response?.data?.error || 'Invalid code');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleCreateCampaign() {\n    setLoading(true);\n    setError('');\n    \n    try {\n      await api.post('/campaigns/create', {\n        session_token: sessionToken,\n        campaign_name: campaignName,\n        realm_type: realmType,\n        invited_players: invites.filter(i => i.name && i.phone)\n      });\n      \n      setStep('success');\n    } catch (err: any) {\n      setError(err.response?.data?.error || 'Failed to create campaign');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Render steps...\n  return (\n    <div className=\"campaign-creator\">\n      {step === 'details' && (\n        <DetailsStep\n          phone={phone}\n          setPhone={setPhone}\n          campaignName={campaignName}\n          setCampaignName={setCampaignName}\n          realmType={realmType}\n          setRealmType={setRealmType}\n          onNext={handleRequestCode}\n          loading={loading}\n          error={error}\n        />\n      )}\n      \n      {step === 'verify' && (\n        <VerifyStep\n          code={code}\n          setCode={setCode}\n          onVerify={handleVerifyCode}\n          onResend={handleRequestCode}\n          loading={loading}\n          error={error}\n        />\n      )}\n      \n      {step === 'invites' && (\n        <InvitesStep\n          invites={invites}\n          setInvites={setInvites}\n          onCreate={handleCreateCampaign}\n          loading={loading}\n          error={error}\n        />\n      )}\n      \n      {step === 'success' && (\n        <SuccessStep campaignName={campaignName} />\n      )}\n    </div>\n  );\n}\n```\n\n---\n\n## Error Handling\n\n### User-Friendly Error Messages\n\n```typescript\nfunction getErrorMessage(statusCode: number, errorData: any): string {\n  switch (statusCode) {\n    case 429:\n      const minutes = Math.ceil(errorData.retry_after / 60);\n      return `You've requested too many codes. Please wait ${minutes} minutes and try again.`;\n      \n    case 400:\n      if (errorData.expired) {\n        return 'Your code expired. Click \"Resend Code\" to get a new one.';\n      }\n      if (errorData.max_attempts_reached) {\n        return 'Too many incorrect attempts. Please request a new code.';\n      }\n      if (errorData.attempts_remaining) {\n        return `Incorrect code. ${errorData.attempts_remaining} attempts remaining.`;\n      }\n      return errorData.error || 'Invalid request';\n      \n    case 503:\n      return 'All game slots are currently full. Please try again in a few hours.';\n      \n    default:\n      return 'Something went wrong. Please try again or contact support.';\n  }\n}\n```\n\n### Transfer Error Messages\n\n```typescript\nfunction getTransferErrorMessage(errorCode: string): string {\n  const messages = {\n    'PLAYER_NOT_FOUND': 'No account found for this phone number.',\n    'INVALID_CODE_FORMAT': 'Invalid code format. Use: TRANSFER ABC-123-XYZ',\n    'TRANSFER_NOT_FOUND': 'Invalid or expired code. Request a new one by texting TRANSFER from your old phone.',\n    'TRANSFER_EXPIRED': 'Code expired. Text TRANSFER from your old phone to get a new code.',\n    'SAME_PHONE_NUMBER': 'You must use a different phone number.',\n    'PHONE_ALREADY_IN_USE': 'This phone number is already registered. Contact support if you need help.',\n    'RATE_LIMIT': 'You can only transfer once per week. Contact support if you need help.'\n  };\n  \n  return messages[errorCode] || 'Transfer failed. Please contact support.';\n}\n```\n\n---\n\n## Security Considerations\n\n### Rate Limiting\n\n**Verification Requests:**\n- Max 3 codes per phone per hour\n- Max 10 codes per IP per hour\n- 30 second cooldown between requests\n\n**Verification Attempts:**\n- Max 3 attempts per code\n- Code expires after max attempts\n- Must request new code\n\n**Phone Transfers:**\n- Max 1 transfer per phone per week\n- 24 hour window to cancel\n- IP address logged for audit\n\n### Code Generation\n\n```typescript\nfunction generateVerificationCode(): string {\n  // Cryptographically secure 6-digit code\n  return crypto.randomInt(100000, 999999).toString();\n}\n\nfunction generateTransferCode(): string {\n  // Format: ABC-123-XYZ\n  const segments = [\n    generateRandomString(3, 'ABCDEFGHJKLMNPQRSTUVWXYZ'), // No I, O\n    generateRandomString(3, '0123456789'),\n    generateRandomString(3, 'ABCDEFGHJKLMNPQRSTUVWXYZ')\n  ];\n  return segments.join('-');\n}\n\nfunction generateRandomString(length: number, charset: string): string {\n  let result = '';\n  for (let i = 0; i < length; i++) {\n    const randomIndex = crypto.randomInt(0, charset.length);\n    result += charset[randomIndex];\n  }\n  return result;\n}\n```\n\n### Phone Number Validation\n\n```typescript\nfunction cleanPhoneNumber(phone: string): string {\n  // Remove all non-numeric characters\n  const cleaned = phone.replace(/\\D/g, '');\n  \n  // Add +1 if US number without country code\n  if (cleaned.length === 10) {\n    return `+1${cleaned}`;\n  }\n  \n  // Add + if missing\n  if (!phone.startsWith('+')) {\n    return `+${cleaned}`;\n  }\n  \n  return `+${cleaned}`;\n}\n\nfunction isValidPhoneNumber(phone: string): boolean {\n  // E.164 format: +[country code][number]\n  // US: +1 followed by 10 digits\n  const e164Regex = /^\\+[1-9]\\d{1,14}$/;\n  return e164Regex.test(phone);\n}\n\nfunction maskPhone(phone: string): string {\n  // Mask for logging: +1 (555) ***-4567\n  const cleaned = phone.replace(/\\D/g, '');\n  if (cleaned.length === 11) { // US: +1XXXXXXXXXX\n    return `+1 (${cleaned.slice(1, 4)}) ***-${cleaned.slice(-4)}`;\n  }\n  return phone.slice(0, 6) + '***' + phone.slice(-4);\n}\n```\n\n### Suspicious Activity Detection\n\n```typescript\nasync function detectSuspiciousTransfer(\n  oldPhone: string, \n  newPhone: string\n): Promise<boolean> {\n  // Check last game activity\n  const lastActivity = await db.queryOne(\n    `SELECT MAX(last_action_time) as last_action\n     FROM players\n     WHERE phone_number = $1`,\n    [oldPhone]\n  );\n  \n  if (!lastActivity?.last_action) {\n    return false; // Inactive account, not suspicious\n  }\n  \n  const hoursSinceActivity = \n    (Date.now() - new Date(lastActivity.last_action).getTime()) / (1000 * 60 * 60);\n  \n  // Suspicious if transfer within 24 hours of activity\n  if (hoursSinceActivity < 24) {\n    logger.warn('Suspicious transfer detected', {\n      old_phone: maskPhone(oldPhone),\n      new_phone: maskPhone(newPhone),\n      hours_since_activity: hoursSinceActivity\n    });\n    \n    // Send extra security alert\n    await sendSMS(oldPhone, \n      `üîê SECURITY ALERT: Account transfer requested ${Math.round(hoursSinceActivity)} hours after your last game. Reply CANCEL if this wasn't you.`\n    );\n    \n    return true;\n  }\n  \n  return false;\n}\n```\n\n---\n\n## Testing Strategy\n\n### Unit Tests\n\n```typescript\ndescribe('Verification System', () => {\n  \n  test('generates valid 6-digit code', () => {\n    const code = generateVerificationCode();\n    expect(code).toMatch(/^\\d{6}$/);\n    expect(parseInt(code)).toBeGreaterThanOrEqual(100000);\n    expect(parseInt(code)).toBeLessThan(1000000);\n  });\n  \n  test('cleans phone number to E.164 format', () => {\n    expect(cleanPhoneNumber('555-123-4567')).toBe('+15551234567');\n    expect(cleanPhoneNumber('(555) 123-4567')).toBe('+15551234567');\n    expect(cleanPhoneNumber('+1 555 123 4567')).toBe('+15551234567');\n  });\n  \n  test('validates phone number format', () => {\n    expect(isValidPhoneNumber('+15551234567')).toBe(true);\n    expect(isValidPhoneNumber('+442012345678')).toBe(true);\n    expect(isValidPhoneNumber('5551234567')).toBe(false);\n    expect(isValidPhoneNumber('not a phone')).toBe(false);\n  });\n  \n  test('masks phone number for logging', () => {\n    expect(maskPhone('+15551234567')).toBe('+1 (555) ***-4567');\n  });\n  \n});\n\ndescribe('Transfer System', () => {\n  \n  test('generates valid transfer code', () => {\n    const code = generateTransferCode();\n    expect(code).toMatch(/^[A-Z]{3}-[0-9]{3}-[A-Z]{3}$/);\n  });\n  \n  test('validates transfer code format', () => {\n    expect(isValidTransferCode('ABC-123-XYZ')).toBe(true);\n    expect(isValidTransferCode('abc-123-xyz')).toBe(false);\n    expect(isValidTransferCode('AB-123-XYZ')).toBe(false);\n    expect(isValidTransferCode('ABC123XYZ')).toBe(false);\n  });\n  \n});\n```\n\n### Integration Tests\n\n```typescript\ndescribe('Verification Flow (E2E)', () => {\n  \n  test('complete verification flow', async () => {\n    // 1. Request code\n    const response1 = await request(app)\n      .post('/api/verify/request')\n      .send({\n        phone_number: '+15551234567',\n        purpose: 'campaign_creation',\n        campaign_name: 'Test Campaign'\n      });\n    expect(response1.status).toBe(200);\n    expect(response1.body.verification_id).toBeDefined();\n    \n    // 2. Get code from database (for testing)\n    const verification = await db.queryOne(\n      `SELECT code FROM verification_codes WHERE id = $1`,\n      [response1.body.verification_id]\n    );\n    \n    // 3. Verify code\n    const response2 = await request(app)\n      .post('/api/verify/confirm')\n      .send({\n        verification_id: response1.body.verification_id,\n        code: verification.code\n      });\n    expect(response2.status).toBe(200);\n    expect(response2.body.session_token).toBeDefined();\n  });\n  \n  test('rejects invalid code', async () => {\n    const response = await request(app)\n      .post('/api/verify/confirm')\n      .send({\n        verification_id: 'valid-uuid',\n        code: '000000'\n      });\n    expect(response.status).toBe(400);\n    expect(response.body.error).toContain('Invalid');\n  });\n  \n});\n\ndescribe('Transfer Flow (E2E)', () => {\n  \n  test('complete transfer flow', async () => {\n    // Setup: Create player with old phone\n    await createTestPlayer('+15551111111');\n    \n    // 1. Initiate transfer\n    await request(app)\n      .post('/api/sms/incoming')\n      .send({\n        From: '+15551111111',\n        Body: 'TRANSFER'\n      });\n    \n    // Get code from database\n    const transfer = await db.queryOne(\n      `SELECT transfer_code FROM phone_transfers \n       WHERE old_phone = $1 AND status = 'pending'`,\n      ['+15551111111']\n    );\n    \n    // 2. Complete transfer\n    await request(app)\n      .post('/api/sms/incoming')\n      .send({\n        From: '+15552222222',\n        Body: `TRANSFER ${transfer.transfer_code}`\n      });\n    \n    // 3. Verify player phone updated\n    const player = await db.queryOne(\n      `SELECT phone_number FROM players WHERE phone_number = $1`,\n      ['+15552222222']\n    );\n    expect(player).toBeDefined();\n  });\n  \n});\n```\n\n### Load Testing\n\n```bash\n# Test rate limiting with Apache Bench\nab -n 100 -c 10 -p verify_request.json \\\n   -T application/json \\\n   http://localhost:3000/api/verify/request\n\n# Expected: 429 errors after hitting rate limit\n```\n\n---\n\n## Monitoring & Alerts\n\n### Metrics to Track\n\n```typescript\n// Verification metrics\n{\n  'verification.requests.total': Counter,\n  'verification.requests.success': Counter,\n  'verification.requests.failed': Counter,\n  'verification.requests.rate_limited': Counter,\n  'verification.codes.expired': Counter,\n  'verification.attempts.failed': Counter,\n  'verification.response_time': Histogram\n}\n\n// Transfer metrics\n{\n  'transfer.initiated.total': Counter,\n  'transfer.completed.total': Counter,\n  'transfer.cancelled.total': Counter,\n  'transfer.failed.total': Counter,\n  'transfer.suspicious.detected': Counter,\n  'transfer.time_to_complete': Histogram\n}\n```\n\n### Alert Conditions\n\n```typescript\n// Critical alerts\nasync function checkCriticalAlerts() {\n  // 1. High SMS failure rate\n  const failureRate = await metrics.getRate('sms.send.failed', '5m');\n  if (failureRate > 0.1) { // >10% failure\n    await alertTeam('CRITICAL', 'High SMS failure rate', { rate: failureRate });\n  }\n  \n  // 2. Verification code delivery issues\n  const deliveryRate = await metrics.getRate('verification.codes.delivered', '15m');\n  if (deliveryRate < 0.9) { // <90% delivery\n    await alertTeam('CRITICAL', 'Verification codes not delivering', { rate: deliveryRate });\n  }\n  \n  // 3. Database connection issues\n  const dbErrors = await metrics.getCount('database.errors', '5m');\n  if (dbErrors > 10) {\n    await alertTeam('CRITICAL', 'Database errors detected', { count: dbErrors });\n  }\n}\n\n// Warning alerts\nasync function checkWarningAlerts() {\n  // 1. High rate limit hits\n  const rateLimitHits = await metrics.getCount('verification.rate_limited', '1h');\n  if (rateLimitHits > 50) {\n    await alertTeam('WARNING', 'High rate limiting', { count: rateLimitHits });\n  }\n  \n  // 2. Suspicious transfer activity\n  const suspiciousTransfers = await metrics.getCount('transfer.suspicious', '24h');\n  if (suspiciousTransfers > 5) {\n    await alertTeam('WARNING', 'Suspicious transfer activity', { count: suspiciousTransfers });\n  }\n  \n  // 3. High transfer cancellation rate\n  const cancellationRate = await metrics.getRate('transfer.cancelled', '24h');\n  if (cancellationRate > 0.2) { // >20% cancelled\n    await alertTeam('WARNING', 'High transfer cancellation rate', { rate: cancellationRate });\n  }\n}\n\n// Run monitoring\nschedule.scheduleJob('*/5 * * * *', checkCriticalAlerts);\nschedule.scheduleJob('0 * * * *', checkWarningAlerts);\n```\n\n### Cleanup Jobs\n\n```typescript\n// Run hourly\nasync function cleanupExpiredRecords() {\n  // 1. Expired verification codes\n  const expiredCodes = await db.query(\n    `DELETE FROM verification_codes \n     WHERE expires_at < NOW() - INTERVAL '1 hour'\n     RETURNING id`\n  );\n  logger.info('Cleaned expired verification codes', { count: expiredCodes.length });\n  \n  // 2. Old rate limit records\n  const oldRateLimits = await db.query(\n    `DELETE FROM sms_rate_limits \n     WHERE window_start < NOW() - INTERVAL '24 hours'\n     RETURNING id`\n  );\n  logger.info('Cleaned old rate limits', { count: oldRateLimits.length });\n  \n  // 3. Expired transfers\n  const expiredTransfers = await db.query(\n    `UPDATE phone_transfers \n     SET status = 'expired' \n     WHERE status = 'pending' \n     AND expires_at < NOW()\n     RETURNING id`\n  );\n  logger.info('Marked expired transfers', { count: expiredTransfers.length });\n}\n\nschedule.scheduleJob('0 * * * *', cleanupExpiredRecords);\n```\n\n---\n\n## Edge Cases & Recovery\n\n### Lost Both Phones\n\n**Manual Recovery Process:**\n1. Player contacts support via email\n2. Support verifies identity (security questions, campaign details)\n3. Support creates manual transfer ticket\n4. Admin endpoint executes transfer with override\n5. Player receives SMS on new phone\n\n```typescript\n// Admin endpoint (requires auth)\nPOST /api/admin/phone-recovery\n{\n  support_ticket_id: string,\n  old_phone: string,\n  new_phone: string,\n  verified_by: string  // Support agent ID\n}\n```\n\n### Phone Number Recycled by Carrier\n\nIf carrier reassigns a phone number to new person:\n\n1. New owner cannot access old campaigns (no knowledge)\n2. If they try to play, system creates new player record\n3. Original owner can use \"Lost Access\" support flow\n4. Support manually verifies and transfers to new number\n\n### Multiple Failed Transfer Attempts\n\nAfter 3 failed code attempts:\n- Code invalidated\n- Must request new code from old phone\n- Rate limit prevents abuse (1 transfer/week)\n\n---\n\n## Implementation Checklist\n\n### Phase 1: Verification System\n- [ ] Database schema for verification codes\n- [ ] SMS rate limiting table and logic\n- [ ] `/api/verify/request` endpoint\n- [ ] `/api/verify/confirm` endpoint\n- [ ] `/api/campaigns/create` endpoint (with session validation)\n- [ ] Phone number cleaning and validation\n- [ ] Code generation (secure random)\n- [ ] SMS sending via Twilio\n- [ ] Frontend verification flow\n- [ ] Error handling and user feedback\n- [ ] Unit tests for validation logic\n- [ ] Integration tests for full flow\n- [ ] Monitoring and metrics\n\n### Phase 2: Transfer System\n- [ ] Database schema for transfers\n- [ ] Transfer audit log table\n- [ ] Transfer code generation\n- [ ] SMS command handler for \"TRANSFER\"\n- [ ] SMS command handler for \"TRANSFER [code]\"\n- [ ] SMS command handler for \"CANCEL\"\n- [ ] Security checks (rate limits, suspicious activity)\n- [ ] Notifications to old phone\n- [ ] Transfer completion logic\n- [ ] Transfer cancellation logic\n- [ ] Admin recovery endpoint (for lost phones)\n- [ ] Unit tests for transfer logic\n- [ ] Integration tests for full flow\n- [ ] Security testing\n- [ ] Load testing\n\n### Phase 3: Production Readiness\n- [ ] Logging and monitoring setup\n- [ ] Alert configuration\n- [ ] Cleanup jobs (scheduled)\n- [ ] Documentation for support team\n- [ ] Runbook for common issues\n- [ ] Performance testing\n- [ ] Security audit\n- [ ] TCPA compliance review\n\n---\n\n## Future Enhancements (Phase 2+)\n\n### Optional Web Login\nWhen player needs web dashboard access, add magic links:\n- Text \"DASHBOARD\" to DM number\n- Receive link: `partylore.com/auth/xyz123`\n- Click ‚Üí auto-login for 30 days\n\n### Multi-Device Support\nAllow players to access from multiple devices:\n- Link email to phone number\n- Generate device-specific tokens\n- Sync state across devices\n\n### Biometric Authentication\nFor sensitive actions (payments):\n- Face ID / Touch ID on mobile\n- WebAuthn for desktop\n- Fallback to SMS code\n\n---\n\n## Conclusion\n\nThis specification provides a complete, production-ready implementation of SMS-based verification and phone number transfer for Party Lore. The architecture prioritizes:\n\n1. **Zero friction** - No login required for core gameplay\n2. **Security** - Proper verification when needed\n3. **Reliability** - Robust error handling and recovery\n4. **Scalability** - Rate limiting and monitoring built-in\n5. **Gen X friendly** - Simple SMS-based flows\n\nThe system can be built in 2-3 weeks and provides a solid foundation for Phase 1 launch.\n\n---\n\n**Document Status:** Final  \n**Implementation Priority:** P0 (Critical)  \n**Estimated Effort:** 2-3 weeks  \n**Dependencies:** Twilio account, PostgreSQL, Redis\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/original/sms_auth_spec.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "md"
      ],
      "content_hash": "e9da922e46f5cb4f",
      "size_bytes": 30766,
      "created_at": "2026-01-02T20:42:12.441444"
    },
    {
      "doc_id": "local_party-lore_docs_original_party-lore-requirements",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/original/party-lore-requirements.md",
      "content": "# Party Lore - Complete Solution Requirements Document\n\n**Version:** 1.0.0  \n**Date:** January 5, 2025  \n**Status:** Ready for Implementation  \n**Document Purpose:** Master requirements reference for spec kit development\n\n---\n\n## Table of Contents\n\n1. [Executive Summary](#executive-summary)\n2. [Product Vision](#product-vision)\n3. [System Architecture](#system-architecture)\n4. [Functional Requirements](#functional-requirements)\n5. [Non-Functional Requirements](#non-functional-requirements)\n6. [Data Models](#data-models)\n7. [API Specifications](#api-specifications)\n8. [User Stories](#user-stories)\n9. [Test Scenarios](#test-scenarios)\n10. [Implementation Phases](#implementation-phases)\n11. [Acceptance Criteria](#acceptance-criteria)\n\n---\n\n## 1. Executive Summary\n\nParty Lore is an asynchronous multiplayer RPG delivered via SMS where groups of 3-6 friends play tabletop adventures guided by an AI Dungeon Master. The game solves the scheduling problem that kills 82% of traditional D&D groups by allowing players to take turns whenever they have 2 minutes free.\n\n### Core Innovations\n\n1. **Dual-Channel SMS Architecture**: Separate group and private messaging channels\n2. **Intelligent Scene Resolution**: Dynamic participation thresholds\n3. **AI Autopilot System**: Absent players controlled by personality-aware AI\n4. **Deep Narrative Memory**: Persistent story tracking across months\n5. **Multi-Realm Support**: Fantasy, Sci-Fi, Horror settings with unique mechanics\n\n### Target Metrics\n\n- **User Acquisition**: 1,000 users in 6 months\n- **Retention**: 40% D1, 25% D7, 15% D30\n- **Monetization**: 30% free-to-paid conversion\n- **Unit Economics**: <$3 cost per user per month\n- **Performance**: <5 second response time, 98% SMS delivery\n\n---\n\n## 2. Product Vision\n\n### Mission Statement\nEnable every tabletop RPG fan to experience epic adventures with friends, regardless of schedule, location, or device.\n\n### Core Principles\n\n1. **Accessibility First** - Works on any phone, no app required\n2. **Story Over Systems** - Narrative engagement trumps complex mechanics  \n3. **Respect Player Time** - 2-minute turns, play when convenient\n4. **Social Connection** - Strengthen friendships through shared adventures\n5. **AI as Enabler** - Technology serves the story, not vice versa\n\n### Success Criteria\n\n- 70% scene completion rate\n- 40% next-day retention\n- 30% willing to pay $10/month\n- NPS score >50\n- Average 3-4 sessions per week per user\n\n---\n\n## 3. System Architecture\n\n### High-Level Architecture\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ           SMS Gateway (Twilio)                           ‚îÇ\n‚îÇ     Inbound: Player messages ‚Üí Webhook                   ‚îÇ\n‚îÇ     Outbound: AI responses ‚Üí Players                     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                       ‚îÇ\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ         SMS Controller (Spring Boot REST)                ‚îÇ\n‚îÇ   Receives webhooks ‚Üí Routes to handlers                 ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                       ‚îÇ\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                 Service Layer                            ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ SMS Router   ‚îÇ  ‚îÇ  AI Service  ‚îÇ  ‚îÇ Game Engine  ‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇTurn Manager  ‚îÇ  ‚îÇMemory Service‚îÇ  ‚îÇPlayer Service‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                       ‚îÇ\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ       Data Layer (PostgreSQL + Redis)                    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Technology Stack\n\n- **Backend**: Java 17+ with Spring Boot 3.2+\n- **Database**: PostgreSQL 15+ (primary), Redis 7+ (cache)\n- **SMS**: Twilio Programmable SMS\n- **AI**: Anthropic Claude API (claude-sonnet-4.5)\n- **Infrastructure**: Docker, AWS/Railway for hosting\n- **Monitoring**: Spring Actuator, Sentry, Prometheus\n\n### Phone Number Architecture\n\n- **Pool Size**: 8 phone numbers total\n- **Configuration**: 2 numbers per game (group + DM)\n- **Capacity**: 4 concurrent games maximum\n- **Format**: E.164 standard (+1XXXXXXXXXX)\n\n---\n\n## 4. Functional Requirements\n\n### FR-001: Dual-Channel SMS System\n**Priority:** P0 (Critical)  \n**Phase:** 1\n\n#### Description\nSystem provides two distinct SMS channels per game session for different communication types.\n\n#### Requirements\n- **FR-001.1**: Group channel for public game actions visible to all players\n- **FR-001.2**: Private channel for 1:1 DM-player conversations\n- **FR-001.3**: Automatic vCard generation for easy contact saving\n- **FR-001.4**: Message routing based on destination phone number\n- **FR-001.5**: Support for 3-6 players per game\n\n#### Technical Implementation\n```yaml\ngroup_channel:\n  visibility: all_players_except_sender\n  message_types: [actions, narrative, combat]\n  \nprivate_channel:\n  visibility: player_and_dm_only\n  message_types: [secrets, questions, clarifications]\n```\n\n---\n\n### FR-002: Intelligent Scene Resolution\n**Priority:** P0 (Critical)  \n**Phase:** 1\n\n#### Description\nScenes resolve based on dynamic participation thresholds, adapting to player availability.\n\n#### Scene Types and Thresholds\n\n| Scene Type | Players Needed | Timeout | Use Case |\n|------------|----------------|---------|----------|\n| **Quick** | 50% (2 of 4) | 12 hours | Exploration, minor decisions |\n| **Major** | 75% (3 of 4) | 24 hours | Important story beats |\n| **Critical** | 100% (4 of 4) | 48 hours | Boss fights, campaign climax |\n| **Combat** | Turn-based | 24h/turn | Tactical encounters |\n| **Social** | 50% | 12 hours | NPC interactions |\n\n#### Requirements\n- **FR-002.1**: Automatic scene initiation based on story triggers\n- **FR-002.2**: Player action collection with timestamps\n- **FR-002.3**: Threshold checking every hour\n- **FR-002.4**: AI narrative generation combining all actions\n- **FR-002.5**: Notification to all players upon resolution\n- **FR-002.6**: Automatic progression to next scene\n\n---\n\n### FR-003: AI Autopilot System\n**Priority:** P0 (Critical)  \n**Phase:** 1\n\n#### Description\nAI controls absent player characters based on personality profiles to prevent game stalling.\n\n#### Personality Profile Dimensions\n\n```yaml\npersonality_profile:\n  conflict_style: \n    options: [aggressive, defensive, balanced]\n    description: \"How character approaches combat\"\n    \n  risk_tolerance:\n    options: [cautious, moderate, bold]\n    description: \"Willingness to take dangerous actions\"\n    \n  motivation:\n    options: [glory, treasure, knowledge, justice]\n    description: \"Primary driving force\"\n    \n  social_approach:\n    options: [leader, follower, loner, mediator]\n    description: \"Group dynamics preference\"\n```\n\n#### Requirements\n- **FR-003.1**: Personality profile creation during character setup\n- **FR-003.2**: AI action generation after timeout (20 hours)\n- **FR-003.3**: Conservative decision-making when autopiloted\n- **FR-003.4**: Notification to player of AI actions taken\n- **FR-003.5**: Retroactive adjustment allowed within 24 hours\n- **FR-003.6**: AI actions consistent with established personality\n\n#### AI Behavior Rules\n```\n1. Never make irreversible decisions (killing NPCs, using rare items)\n2. Support party goals over individual gain\n3. Preserve character resources when possible\n4. Maintain character voice and mannerisms\n5. Take safe, supportive actions in combat\n```\n\n---\n\n### FR-004: Deep Narrative Memory System\n**Priority:** P0 (Critical)  \n**Phase:** 1\n\n#### Description\nSystem maintains persistent memory of all significant events, relationships, and consequences.\n\n#### Memory Components\n\n##### Memory Fragments\n```yaml\nmemory_fragment:\n  type: [EVENT, DIALOGUE, DISCOVERY, DECISION]\n  importance: 1-10  # Scale for retention priority\n  participants: []   # Characters involved\n  consequences: \"\"   # Long-term effects\n  location: \"\"       # Where it happened\n  turn_number: int   # When it happened\n```\n\n##### Plot Threads\n```yaml\nplot_thread:\n  name: \"The Missing Crown\"\n  status: [ACTIVE, RESOLVED, FAILED, ABANDONED]\n  initiated_turn: 15\n  key_events: []\n  resolution_condition: \"\"\n```\n\n##### NPC Relationships\n```yaml\nrelationship:\n  npc_id: \"uuid\"\n  player_id: \"uuid\"\n  affinity: -100 to 100  # Hate to Love\n  history: []  # Past interactions\n  status: [ALLY, NEUTRAL, RIVAL, ENEMY]\n```\n\n#### Requirements\n- **FR-004.1**: Store all events with importance >= 5\n- **FR-004.2**: Track active plot threads across sessions\n- **FR-004.3**: Maintain NPC relationship scores\n- **FR-004.4**: Generate context for AI from recent memories\n- **FR-004.5**: Prune low-importance old memories (keep last 100)\n- **FR-004.6**: Serialize memories for campaign resumption\n\n---\n\n### FR-005: Multi-Realm System\n**Priority:** P0 (Critical)  \n**Phase:** 1\n\n#### Description\nSupport multiple game settings with unique mechanics and narrative styles.\n\n#### Launch Realms\n\n##### 1. Epic Fantasy\n```yaml\nrealm: epic_fantasy\ntheme: \"Classic sword & sorcery\"\ntone: \"Heroic and adventurous\"\nmechanics:\n  magic: true\n  classes: [Fighter, Wizard, Rogue, Cleric]\n  combat: d20_system\nspecial_features:\n  - Spell casting\n  - Magical items\n  - Dragon encounters\n```\n\n##### 2. Neon Underground (Cyberpunk)\n```yaml\nrealm: cyberpunk\ntheme: \"Dystopian future megacity\"\ntone: \"Dark and gritty\"\nmechanics:\n  hacking: true\n  classes: [Hacker, Street Sam, Face, Rigger]\n  combat: dice_pool_system\nspecial_features:\n  - Cyberware upgrades\n  - Matrix runs\n  - Corporate intrigue\n```\n\n##### 3. Shadows of Arkham (Horror)\n```yaml\nrealm: horror\ntheme: \"Cosmic horror investigation\"\ntone: \"Tense and mysterious\"\nmechanics:\n  sanity: true\n  classes: [Investigator, Occultist, Scholar, Soldier]\n  combat: percentile_system\nspecial_features:\n  - Sanity mechanics\n  - Mystery solving\n  - Ritual magic\n```\n\n---\n\n### FR-006: Momentum Token System\n**Priority:** P1 (Important)  \n**Phase:** 2\n\n#### Description\nReward active participation with tokens that provide narrative advantages.\n\n#### Earning Tokens\n- Respond within 2 hours: +2 tokens\n- Respond within 6 hours: +1 token\n- Complete scene participation: +1 token\n- Exceptional roleplay (AI determined): +1 token\n\n#### Spending Tokens\n- **Narrative Advantage** (2 tokens): Reroll an action\n- **Lucky Break** (3 tokens): Find helpful item/clue\n- **Spotlight Moment** (5 tokens): Center next scene on character\n- **Divine Intervention** (10 tokens): Avoid character death\n\n---\n\n### FR-007: Onboarding Flow\n**Priority:** P0 (Critical)  \n**Phase:** 1\n\n#### Description\nStreamlined process to get new players into a game within 5 minutes.\n\n#### Onboarding Steps\n\n```\n1. INVITATION (via SMS)\n   \"You're invited to Party Lore! Save these contacts:\"\n   \n2. CONTACT SETUP (2 vCards sent)\n   - üéÆ [Game Name] Group\n   - üí¨ [Game Name] DM\n   \n3. CHARACTER CREATION (Conversational)\n   DM: \"Welcome! What's your character's name?\"\n   Player: \"Raven\"\n   DM: \"Great! Is Raven a Fighter, Wizard, or Rogue?\"\n   Player: \"Rogue\"\n   \n4. PERSONALITY SETUP\n   DM: \"How does Raven handle conflict?\"\n   [Quick selection of personality traits]\n   \n5. TUTORIAL SCENE\n   [Solo mini-scene to learn commands]\n   \n6. GROUP INTRODUCTION\n   \"Raven the Rogue has joined the party!\"\n```\n\n---\n\n## 5. Non-Functional Requirements\n\n### Performance Requirements\n\n| Metric | Target | Critical Threshold |\n|--------|--------|-------------------|\n| SMS Delivery Rate | 98% | 95% |\n| AI Response Time | <5 seconds | <10 seconds |\n| Scene Resolution | <2 hours avg | <4 hours |\n| Message Processing | <3 seconds | <5 seconds |\n| System Uptime | 99.5% | 99% |\n| Database Query | <100ms | <500ms |\n\n### Scalability Requirements\n\n- Support 1,000 concurrent game sessions\n- Handle 10,000 active users\n- Process 50 messages/second peak\n- Store 1M+ memory fragments\n- Cache 10,000 recent scenes\n\n### Security Requirements\n\n- Phone number verification via SMS code\n- Rate limiting: 10 messages/minute per number\n- Message encryption in transit (TLS)\n- PII data encryption at rest\n- TCPA compliance for SMS\n- GDPR compliance for EU users\n\n### Reliability Requirements\n\n- Automatic failover for critical services\n- Message retry with exponential backoff\n- Database backups every 6 hours\n- Transaction logs retained for 30 days\n- Graceful degradation if AI unavailable\n\n---\n\n## 6. Data Models\n\n### Core Entities\n\n#### GameSession\n```typescript\ninterface GameSession {\n  id: string;\n  realmId: string;\n  name: string;\n  status: 'RECRUITING' | 'ACTIVE' | 'PAUSED' | 'COMPLETED';\n  groupPhoneNumber: string;\n  dmPhoneNumber: string;\n  players: Player[];\n  currentScene: Scene;\n  narrativeMemory: NarrativeMemory;\n  settings: GameSettings;\n  createdAt: Date;\n  lastActivity: Date;\n}\n```\n\n#### Player\n```typescript\ninterface Player {\n  id: string;\n  phoneNumber: string;\n  gameSessionId: string;\n  character: Character;\n  personalityProfile: PersonalityProfile;\n  isAIControlled: boolean;\n  lastActionTime: Date;\n  momentum: number;\n  reminderPreferences: ReminderSettings;\n  status: 'ACTIVE' | 'IDLE' | 'AWAY';\n}\n```\n\n#### Character\n```typescript\ninterface Character {\n  name: string;\n  class: string;\n  level: number;\n  health: {\n    current: number;\n    max: number;\n  };\n  stats: {\n    strength: number;\n    dexterity: number;\n    intelligence: number;\n    wisdom: number;\n    charisma: number;\n    constitution: number;\n  };\n  inventory: Item[];\n  activeQuests: Quest[];\n  abilities: Ability[];\n  backstory: string;\n}\n```\n\n#### Scene\n```typescript\ninterface Scene {\n  id: string;\n  type: 'QUICK' | 'MAJOR' | 'CRITICAL' | 'COMBAT' | 'SOCIAL';\n  title: string;\n  description: string;\n  setupPrompt: string;  // For AI context\n  requiredPlayers: number;\n  currentPlayers: string[];  // Player IDs who have acted\n  playerActions: PlayerAction[];\n  timeoutHours: number;\n  initiatedAt: Date;\n  resolvedAt?: Date;\n  resolution?: string;\n  nextSceneId?: string;\n  consequences: Consequence[];\n}\n```\n\n#### NarrativeMemory\n```typescript\ninterface NarrativeMemory {\n  id: string;\n  gameSessionId: string;\n  fragments: MemoryFragment[];\n  plotThreads: PlotThread[];\n  worldState: WorldState;\n  npcRelationships: Map<string, Relationship>;\n  importantLocations: Location[];\n  campaignPhase: 'ACT1' | 'ACT2' | 'ACT3' | 'EPILOGUE';\n}\n```\n\n#### MemoryFragment\n```typescript\ninterface MemoryFragment {\n  id: string;\n  type: 'EVENT' | 'DIALOGUE' | 'DISCOVERY' | 'DECISION';\n  turnNumber: number;\n  description: string;\n  importance: number;  // 1-10 scale\n  participants: string[];\n  location?: string;\n  consequences?: string;\n  emotionalTone?: 'TRIUMPH' | 'TRAGEDY' | 'MYSTERY' | 'COMEDY';\n  relatedPlotThreads: string[];\n  timestamp: Date;\n}\n```\n\n---\n\n## 7. API Specifications\n\n### SMS Webhook Endpoints\n\n#### Receive Inbound SMS\n```yaml\nPOST /api/sms/incoming\nContent-Type: application/x-www-form-urlencoded\n\nParameters:\n  From: string     # Sender phone number\n  To: string       # Destination number (group or DM)\n  Body: string     # Message content\n  MessageSid: string  # Twilio message ID\n\nResponse:\n  200 OK  # Must respond quickly to Twilio\n```\n\n#### SMS Status Callback\n```yaml\nPOST /api/sms/status\nContent-Type: application/x-www-form-urlencoded\n\nParameters:\n  MessageSid: string\n  MessageStatus: string  # sent|delivered|failed\n  ErrorCode?: string\n  \nResponse:\n  200 OK\n```\n\n### Game Management Endpoints\n\n#### Create Campaign\n```yaml\nPOST /api/campaigns\nContent-Type: application/json\n\nRequest:\n{\n  \"name\": \"Shadow Heist\",\n  \"realmId\": \"cyberpunk\",\n  \"creatorPhone\": \"+1234567890\",\n  \"invitedPlayers\": [\"+1234567891\", \"+1234567892\"]\n}\n\nResponse:\n{\n  \"campaignId\": \"uuid\",\n  \"groupPhone\": \"+1555000001\",\n  \"dmPhone\": \"+1555000002\",\n  \"invitationsSent\": true\n}\n```\n\n#### Get Campaign Status\n```yaml\nGET /api/campaigns/{campaignId}/status\n\nResponse:\n{\n  \"campaign\": \"Shadow Heist\",\n  \"currentScene\": \"The Data Heist\",\n  \"playersActed\": 2,\n  \"playersTotal\": 4,\n  \"hoursRemaining\": 18,\n  \"nextThreshold\": \"75%\"\n}\n```\n\n### AI Service Endpoints (Internal)\n\n#### Generate Narrative\n```yaml\nPOST /internal/ai/narrative\n\nRequest:\n{\n  \"sceneId\": \"uuid\",\n  \"playerActions\": [...],\n  \"memoryContext\": {...},\n  \"realmSettings\": {...}\n}\n\nResponse:\n{\n  \"narrative\": \"The dragon roars as...\",\n  \"tokens\": 650,\n  \"cost\": 0.019\n}\n```\n\n---\n\n## 8. User Stories\n\n### Player Stories\n\n#### US-001: Starting a Campaign\n**As a** player  \n**I want to** start a new campaign with friends  \n**So that** we can play D&D together despite busy schedules\n\n**Acceptance Criteria:**\n- Can invite 3-5 friends via phone number\n- Friends receive clear SMS instructions\n- Everyone completes character creation in <5 minutes\n- Group receives first scene within 10 minutes\n\n---\n\n#### US-002: Taking a Turn\n**As a** player  \n**I want to** respond to game events via text  \n**So that** I can play anywhere in 2 minutes\n\n**Acceptance Criteria:**\n- Receive scene description via SMS\n- Reply with natural language action\n- See AI narrative response within 10 seconds\n- View other players' actions in group chat\n\n---\n\n#### US-003: Private Communication\n**As a** player  \n**I want to** message the DM privately  \n**So that** I can pursue secret objectives\n\n**Acceptance Criteria:**\n- Send message to DM phone number\n- Receive private response only I can see\n- Actions affect game but stay hidden\n- Can reveal secrets later if desired\n\n---\n\n#### US-004: Catching Up\n**As a** player who's been away  \n**I want to** quickly understand what happened  \n**So that** I can jump back into the action\n\n**Acceptance Criteria:**\n- Send \"!recap\" command\n- Receive summary of missed scenes\n- See my character's AI actions\n- Can adjust recent AI decisions\n\n---\n\n### System Stories\n\n#### US-005: Scene Resolution\n**As the** system  \n**I need to** resolve scenes automatically  \n**So that** games progress smoothly\n\n**Acceptance Criteria:**\n- Check participation every hour\n- Trigger AI for missing players at 20 hours\n- Generate combined narrative\n- Broadcast resolution to all players\n- Initiate next scene automatically\n\n---\n\n## 9. Test Scenarios\n\n### Critical Path Testing\n\n#### Scenario 1: New Player Onboarding\n```gherkin\nFeature: New Player Onboarding\n  Scenario: Successful campaign join\n    Given I receive an SMS invitation to Party Lore\n    When I save both phone numbers as contacts\n    And I respond with my character name \"Luna\"\n    And I choose \"Wizard\" as my class\n    And I select my personality traits\n    Then I should receive a welcome message\n    And I should see the first group scene\n    And other players should see \"Luna the Wizard has joined\"\n```\n\n#### Scenario 2: Scene Resolution with Autopilot\n```gherkin\nFeature: Scene Resolution\n  Scenario: Major scene with one absent player\n    Given a major scene requiring 75% participation\n    And 4 players in the campaign\n    When 2 players submit actions within 12 hours\n    And 1 player submits action at hour 20\n    And 1 player hasn't responded by hour 20\n    Then AI should generate action for absent player\n    And scene should resolve with all 4 actions\n    And absent player should receive notification\n```\n\n#### Scenario 3: Private vs Group Messages\n```gherkin\nFeature: Message Privacy\n  Scenario: Secret action remains hidden\n    Given I'm in an active scene\n    When I text the DM number \"I secretly pocket the gem\"\n    Then I should receive a private confirmation\n    And other players should not see my action\n    But the gem should be in my inventory\n    And scene resolution should account for missing gem\n```\n\n### Load Testing Requirements\n\n- 100 concurrent games\n- 10 messages/second sustained\n- 50 messages/second peak\n- 1000 AI API calls/hour\n- 10,000 SMS messages/hour\n\n### Security Testing\n\n- SQL injection via SMS body\n- Rate limiting bypass attempts\n- Phone number spoofing\n- Command injection in player names\n- Memory overflow with long messages\n\n---\n\n## 10. Implementation Phases\n\n### Phase 0: SMS PoC (Weeks 1-2) ‚úÖ\n**Goal:** Validate core concept with basic SMS bot\n\n**Deliverables:**\n- Twilio integration\n- Basic Claude integration\n- Simple group gameplay\n- Character HP tracking\n- Test with 10-15 groups\n\n**Success Metrics:**\n- 70% completion rate\n- 40% want to continue\n- Technical feasibility proven\n\n---\n\n### Phase 1: Foundation MVP (Months 1-2)\n**Goal:** Core product with essential features\n\n**Deliverables:**\n- Complete SMS architecture\n- Dual-channel routing\n- AI narrative engine\n- Scene resolution system\n- Memory persistence\n- 3 realm templates\n- AI autopilot\n- Basic payment integration\n\n**Success Metrics:**\n- 100 active users\n- 30% paid conversion\n- <$3 cost per user\n- 40% D1 retention\n\n---\n\n### Phase 2: Engagement (Months 3-4)\n**Goal:** Improve retention and engagement\n\n**Deliverables:**\n- Momentum token system\n- Advanced NPC relationships\n- Multiple concurrent campaigns\n- Achievement system\n- Referral program\n- Session recaps\n\n**Success Metrics:**\n- 500 active users\n- 35% paid conversion\n- 25% D7 retention\n- 2.5 sessions/week average\n\n---\n\n### Phase 3: Scale (Months 5-6)\n**Goal:** Prepare for growth\n\n**Deliverables:**\n- Performance optimization\n- 3 additional realms\n- API for third-party tools\n- Analytics dashboard\n- International SMS support\n- Advanced AI features\n\n**Success Metrics:**\n- 1,000 active users\n- 40% paid conversion\n- <2 second response time\n- 99.5% uptime\n\n---\n\n## 11. Acceptance Criteria\n\n### MVP Launch Criteria\n\n#### Core Functionality ‚úì\n- [ ] SMS routing works for group and private channels\n- [ ] AI generates appropriate narratives\n- [ ] Scenes resolve based on thresholds\n- [ ] Characters persist between sessions\n- [ ] AI autopilot activates for absent players\n- [ ] Memory system tracks important events\n- [ ] 3 realms fully implemented\n\n#### Performance ‚úì\n- [ ] 98% SMS delivery rate\n- [ ] <5 second AI response time\n- [ ] <2 hour average scene resolution\n- [ ] 99% uptime during testing\n\n#### User Experience ‚úì\n- [ ] Onboarding takes <5 minutes\n- [ ] Natural language commands work\n- [ ] Error messages are helpful\n- [ ] Recaps are accurate and useful\n\n#### Business ‚úì\n- [ ] Payment processing works\n- [ ] Cost tracking implemented\n- [ ] <$3 per user per month\n- [ ] Analytics tracking active\n\n### Post-MVP Success Criteria\n\n#### Month 3\n- 250 active users\n- 32% paid conversion  \n- 45% D1 retention\n- NPS >50\n\n#### Month 6\n- 1,000 active users\n- 35% paid conversion\n- 50% D1 retention\n- 3+ sessions per week\n- Break-even on operations\n\n#### Year 1\n- 5,000 active users\n- 40% paid conversion\n- Profitable operations\n- API ecosystem emerging\n\n---\n\n## Appendix A: Commands Reference\n\n### Player Commands\n```\n!help          - Show available commands\n!status        - Character status and stats\n!inventory     - List items\n!quests        - Active quests\n!map           - Current location\n!party         - Party member status\n!recap         - Recent events summary\n!personality   - Update AI behavior\n!pause         - Pause notifications\n!resume        - Resume notifications\n```\n\n### DM Commands (Private Channel)\n```\n!secret [action]    - Perform hidden action\n!whisper [npc]      - Private NPC conversation\n!investigate        - Detailed area description\n!lore [topic]       - Background information\n!relationship       - NPC affinity scores\n```\n\n---\n\n## Appendix B: Error Messages\n\n### User-Friendly Error Responses\n```\n\"‚ùå I didn't understand that. Try describing your action, like 'I attack the goblin' or 'I search the room'\"\n\n\"‚è∞ Waiting for 2 more players before resolving scene. They have 18 hours remaining.\"\n\n\"üîÑ Your message was too long. Please keep actions under 160 characters for best results.\"\n\n\"üé≠ Your character is currently controlled by AI. Reply 'TAKE CONTROL' to resume playing.\"\n\n\"üìµ Network issues detected. Your action has been saved and will process shortly.\"\n```\n\n---\n\n## Appendix C: Realm Configuration\n\n### Fantasy Realm\n```yaml\nsystem_prompt: |\n  You are the DM for an epic fantasy adventure.\n  Tone: Heroic, adventurous, optimistic\n  Style: Tolkien meets modern sensibility\n  Magic: Common and wondrous\n  \nmechanics:\n  dice: d20\n  classes: [Fighter, Wizard, Rogue, Cleric, Ranger, Barbarian]\n  magic_system: spell_slots\n  death: saving_throws\n```\n\n### Cyberpunk Realm  \n```yaml\nsystem_prompt: |\n  You are the GM for a dystopian cyberpunk thriller.\n  Tone: Dark, gritty, cynical\n  Style: Blade Runner meets Mr. Robot\n  Technology: Omnipresent and dangerous\n  \nmechanics:\n  dice: dice_pool\n  classes: [Hacker, Street_Samurai, Face, Rigger]\n  hacking_system: matrix_runs\n  death: permanent_with_backup\n```\n\n### Horror Realm\n```yaml\nsystem_prompt: |\n  You are the Keeper for a cosmic horror mystery.\n  Tone: Tense, mysterious, unsettling\n  Style: Lovecraft meets True Detective\n  Supernatural: Subtle and sanity-breaking\n  \nmechanics:\n  dice: percentile\n  classes: [Investigator, Occultist, Scholar, Soldier]\n  sanity_system: gradual_loss\n  death: permanent_but_meaningful\n```\n\n---\n\n## Appendix D: Cost Optimization\n\n### SMS Cost Reduction\n- Batch related messages\n- Use shorthand for stats\n- Compress narrative descriptions\n- Cache common responses\n\n### AI Token Optimization\n- Aggressive prompt caching (90% reduction)\n- Limit context to 8 memories\n- Summarize old threads\n- Use Haiku for simple formatting\n\n### Target Costs Per User/Month\n```\nSMS: $2.00 (267 messages)\nAI: $1.50 (79 API calls)\nInfrastructure: $0.30\nTotal: $3.80\nPrice: $4.99-9.99\nMargin: 24-62%\n```\n\n---\n\n## Document Control\n\n**Version History:**\n- v1.0.0 (2025-01-05): Initial complete requirements\n\n**Review Schedule:**\n- Technical Review: Before Phase 1 start\n- Business Review: After MVP launch\n- Quarterly Updates: Based on metrics\n\n**Distribution:**\n- Development Team\n- Product Stakeholders\n- Technical Advisors\n\n**Confidentiality:**\nThis document contains proprietary information and should be treated as confidential.\n\n---\n\n*End of Requirements Document*",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/original/party-lore-requirements.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "function",
        "md"
      ],
      "content_hash": "611de916376e45a5",
      "size_bytes": 27416,
      "created_at": "2026-01-02T20:42:12.441872"
    },
    {
      "doc_id": "local_party-lore_docs_original_party_lore_monetization",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/original/party_lore_monetization.md",
      "content": "# Party Lore - Monetization System Requirements\n## \"Patreon Plus\" Hybrid Model\n\n**Version:** 1.0.0  \n**Date:** January 5, 2025  \n**Status:** Ready for Implementation  \n**Document Purpose:** Complete monetization requirements for Party Lore\n\n---\n\n## Table of Contents\n\n1. [Monetization Overview](#monetization-overview)\n2. [Pricing Tiers](#pricing-tiers)\n3. [Feature Matrix](#feature-matrix)\n4. [User Flows](#user-flows)\n5. [Payment Integration](#payment-integration)\n6. [Database Schema](#database-schema)\n7. [API Specifications](#api-specifications)\n8. [Messaging & UX](#messaging--ux)\n9. [Analytics & Tracking](#analytics--tracking)\n10. [Implementation Phases](#implementation-phases)\n11. [Success Metrics](#success-metrics)\n\n---\n\n## 1. Monetization Overview\n\n### Philosophy\n\nParty Lore follows a \"**Free Forever, Support Optional**\" model that:\n- Provides full game experience at no cost\n- Offers optional support tiers with valuable perks\n- Enables one-time content purchases\n- Allows voluntary donations\n- Never gates core gameplay behind paywalls\n\n### Target Demographics\n\n**Primary (40-50 years old):**\n- Higher disposable income\n- Values time over money\n- Appreciates transparent, fair pricing\n- Loyal to products that respect them\n- Willing to support creators\n- Prefers predictable costs\n\n### Core Principles\n\n1. **Respect First** - Never manipulate or pressure users\n2. **Value Clear** - Users understand what they're paying for\n3. **Fairness Always** - Free users get excellent experience\n4. **Multiple Options** - Different ways to support\n5. **Social Spending** - Enable group cost-sharing\n\n---\n\n## 2. Pricing Tiers\n\n### Tier 1: Free Forever ‚úÖ\n\n**Cost:** $0/month (no credit card required)\n\n**Core Features:**\n```yaml\ngameplay:\n  - unlimited_sessions: true\n  - unlimited_campaigns: 2\n  - all_standard_realms: true  # Fantasy, Cyberpunk, Horror\n  - full_ai_dm: true\n  - dual_channel_sms: true\n  - character_progression: true\n  - campaign_memory: true\n  - party_chat: true\n  - all_commands: true\n  \nlimitations:\n  - ai_response_time: standard  # 3-5 seconds\n  - concurrent_campaigns: 2\n  - premium_realms: false\n  - priority_support: false\n  - custom_realm_builder: false\n```\n\n**Gentle Monetization:**\n- Reminder every 10 sessions: \"Loving Party Lore? Consider supporting for $5/month ‚òï\"\n- After epic moments: \"Epic session! Buy the DM a coffee? [Donate] [No thanks]\"\n- No popups, no interruptions, no pressure\n\n---\n\n### Tier 2: Supporter üåü\n\n**Cost:** $4.99/month\n\n**Value Proposition:** \"Support the creator, get VIP perks\"\n\n**Features:**\n```yaml\nincludes_all_free_features: true\n\nsupporter_perks:\n  ai_features:\n    - priority_ai_response: \"30% faster (2-3 seconds)\"\n    - enhanced_narration: \"More detailed, cinematic\"\n    - custom_personality_training: \"Fine-tune AI to your style\"\n    \n  visual_features:\n    - character_portraits: \"1 AI-generated portrait per month\"\n    - custom_dice_skins: \"Exclusive designs\"\n    - supporter_badge: \"Visible in game messages\"\n    \n  content_access:\n    - early_realm_access: \"2 weeks before public release\"\n    - beta_features: \"Test new mechanics first\"\n    - monthly_bonus_pack: \"Extra NPCs, items, scenarios\"\n    \n  community:\n    - supporter_discord: \"Private channel access\"\n    - voting_rights: \"Vote on next realm themes\"\n    - dev_updates: \"Behind-the-scenes content\"\n    \n  analytics:\n    - basic_campaign_stats: \"Sessions played, characters met\"\n    - story_recap_tool: \"Generate summaries\"\n```\n\n**Messaging:**\n```\n\"Thanks for supporting Party Lore! üéâ\n\nYour $5/month helps us:\n‚úÖ Keep servers running\n‚úÖ Train better AI models  \n‚úÖ Create new realms\n‚úÖ Support indie game dev\n\nPlus you get awesome perks! Check your DM for details.\"\n```\n\n---\n\n### Tier 3: Champion üëë\n\n**Cost:** $9.99/month\n\n**Value Proposition:** \"For serious adventurers running multiple campaigns\"\n\n**Features:**\n```yaml\nincludes_all_supporter_features: true\n\nchampion_exclusive:\n  campaign_management:\n    - concurrent_campaigns: 4  # vs 2 free\n    - unlimited_session_length: true\n    - campaign_analytics: \"Deep stats dashboard\"\n    \n  content_creation:\n    - custom_realm_builder: \"Create your own settings\"\n    - custom_npc_generator: \"AI creates characters for you\"\n    - scenario_templates: \"Pre-built adventure frameworks\"\n    \n  premium_content:\n    - all_premium_realms: \"Immediate access to new releases\"\n    - pre_written_campaigns: \"Professional adventures\"\n    - advanced_mechanics: \"Complex rule systems\"\n    \n  ai_features:\n    - priority_plus_ai: \"Instant responses\"\n    - extended_memory: \"2x memory capacity\"\n    - custom_ai_style: \"Train AI voice/tone\"\n    \n  support:\n    - priority_customer_service: \"Response within 4 hours\"\n    - dm_consultation: \"30 min session/month with creator\"\n    - white_glove_onboarding: \"Personal setup help\"\n    \n  social:\n    - featured_campaigns: \"Showcase on community page\"\n    - guild_master_badge: \"Prestigious recognition\"\n    - exclusive_events: \"Champion-only game nights\"\n```\n\n**Messaging:**\n```\n\"Welcome to Champion status! üèÜ\n\nYou're now part of the inner circle helping shape Party Lore's future.\n\nYour benefits:\nüë• Run 4 campaigns simultaneously\nüé® Create custom realms\n‚ö° Instant AI responses\nüéØ Priority support\nüåü Featured on community page\n\nYou're a legend. Thank you! üôè\"\n```\n\n---\n\n### √Ä La Carte Options üõí\n\n**Available to all users (free or paid):**\n\n#### One-Time Purchases\n\n```yaml\npremium_realms:\n  - name: \"Starship Mutiny\"\n    type: sci_fi_horror\n    price: 7.99\n    description: \"Survival horror on a generation ship\"\n    includes: [full_campaign, 20_npcs, custom_mechanics]\n    \n  - name: \"Wild West Weird\"  \n    type: supernatural_western\n    price: 7.99\n    description: \"Gunslinging meets dark magic\"\n    includes: [full_campaign, 15_npcs, custom_items]\n    \n  - name: \"Superhero City\"\n    type: modern_heroes\n    price: 7.99\n    description: \"Defend the city with superpowers\"\n    includes: [full_campaign, power_system, 25_npcs]\n\ncampaign_packs:\n  - name: \"Heist of the Century\"\n    type: pre_written_adventure\n    price: 4.99\n    sessions: 8_to_12\n    description: \"Professional heist scenario\"\n    \n  - name: \"Murder Mystery Manor\"\n    type: whodunit\n    price: 4.99  \n    sessions: 6_to_10\n    description: \"Classic murder mystery\"\n    \n  - name: \"Zombie Apocalypse\"\n    type: survival_horror\n    price: 4.99\n    sessions: 10_to_15\n    description: \"Survive the undead hordes\"\n\ncosmetic_items:\n  - character_portrait: 2.99\n  - custom_dice_set: 1.99\n  - campaign_theme: 0.99\n  - sound_effects_pack: 3.99\n\nspecial_features:\n  - voice_narration_session: 14.99  # One-time AI voice event\n  - custom_npc_creation: 4.99       # AI creates specific NPC\n  - group_portrait: 9.99            # Party illustration\n```\n\n#### Donation Options\n\n```yaml\ncoffee_donations:\n  amounts: [3, 5, 10, 25, 50]\n  triggers:\n    - after_epic_moments: true\n    - every_10_sessions: true\n    - player_initiated: true\n    - never_during_gameplay: true\n    \n  messaging:\n    prompt: \"That was epic! ‚òï Buy the DM a coffee?\"\n    options: [\"$3\", \"$5\", \"$10\", \"No thanks\"]\n    no_pressure: true\n    max_frequency: \"once per 10 sessions\"\n```\n\n---\n\n## 3. Feature Matrix\n\n### Complete Comparison Table\n\n| Feature | Free | Supporter | Champion |\n|---------|------|-----------|----------|\n| **Core Gameplay** |\n| Unlimited Sessions | ‚úÖ | ‚úÖ | ‚úÖ |\n| Concurrent Campaigns | 2 | 2 | 4 |\n| Standard Realms | ‚úÖ | ‚úÖ | ‚úÖ |\n| Premium Realms | ‚ùå | Via purchase | ‚úÖ All |\n| Full AI DM | ‚úÖ | ‚úÖ | ‚úÖ |\n| Dual-Channel SMS | ‚úÖ | ‚úÖ | ‚úÖ |\n| Character Progression | ‚úÖ | ‚úÖ | ‚úÖ |\n| Campaign Memory | Standard | Standard | 2x Capacity |\n| **AI Features** |\n| Response Time | 3-5 sec | 2-3 sec | Instant |\n| Narrative Quality | Standard | Enhanced | Premium |\n| Custom Personality | ‚ùå | ‚úÖ | ‚úÖ Advanced |\n| Extended Memory | ‚ùå | ‚ùå | ‚úÖ |\n| **Visual/Audio** |\n| Character Portrait | Via purchase | 1/month | Unlimited |\n| Dice Skins | ‚ùå | ‚úÖ | ‚úÖ |\n| Voice Narration | Via purchase | Via purchase | Included |\n| **Content** |\n| Early Access | ‚ùå | 2 weeks | Immediate |\n| Beta Features | ‚ùå | ‚úÖ | ‚úÖ |\n| Custom Realms | ‚ùå | ‚ùå | ‚úÖ |\n| Pre-written Campaigns | Via purchase | Via purchase | ‚úÖ All |\n| **Community** |\n| Public Discord | ‚úÖ | ‚úÖ | ‚úÖ |\n| Supporter Channel | ‚ùå | ‚úÖ | ‚úÖ |\n| Vote on Features | ‚ùå | ‚úÖ | ‚úÖ Priority |\n| Featured Campaigns | ‚ùå | ‚ùå | ‚úÖ |\n| **Support** |\n| Response Time | 48 hours | 24 hours | 4 hours |\n| DM Consultation | ‚ùå | ‚ùå | 30 min/month |\n| Onboarding Help | Self-service | Email | White-glove |\n| **Analytics** |\n| Basic Stats | ‚ùå | ‚úÖ | ‚úÖ |\n| Deep Analytics | ‚ùå | ‚ùå | ‚úÖ |\n| Campaign Insights | ‚ùå | ‚ùå | ‚úÖ |\n\n---\n\n## 4. User Flows\n\n### 4.1 Free User Onboarding\n\n```mermaid\ngraph TD\n    A[New User Joins] --> B[Complete Onboarding]\n    B --> C[First Session]\n    C --> D{Enjoyed?}\n    D -->|Yes| E[Play 5+ Sessions]\n    D -->|No| F[Churn]\n    E --> G{Epic Moment}\n    G --> H[Gentle Prompt: 'Buy DM Coffee?']\n    H --> I{User Response}\n    I -->|Donate| J[Thanks Message + Badge]\n    I -->|No Thanks| K[Continue Free]\n    K --> L[After 10 Sessions]\n    L --> M[Gentle Reminder: 'Support at $5/mo?']\n    M --> N{User Response}\n    N -->|Subscribe| O[Upgrade to Supporter]\n    N -->|Not Now| K\n```\n\n### 4.2 Supporter Upgrade Flow\n\n```yaml\ntrigger_points:\n  # Natural upgrade moments\n  - after_session_10: \n      message: \"You've played 10 epic sessions! üéâ\"\n      offer: \"Become a Supporter and get priority AI + portraits\"\n      cta: \"Support for $5/month\"\n      \n  - after_epic_moment:\n      message: \"That was legendary! ‚öîÔ∏è\"\n      offer: \"Support Party Lore and get VIP perks\"\n      cta: \"See Supporter Benefits\"\n      \n  - when_viewing_features:\n      trigger: \"User tries locked feature\"\n      message: \"This is a Supporter perk ‚ú®\"\n      offer: \"Upgrade for $5/month to unlock\"\n      cta: \"Become a Supporter\"\n      \n  - manual_inquiry:\n      trigger: \"User texts '!support' or '!upgrade'\"\n      response: \"Full tier comparison + upgrade link\"\n\nupgrade_process:\n  1: \"Show benefits clearly\"\n  2: \"One-click Stripe payment\"\n  3: \"Immediate feature activation\"\n  4: \"Welcome message with perks guide\"\n  5: \"No interruption to gameplay\"\n```\n\n### 4.3 Champion Upgrade Flow\n\n```yaml\ntrigger_points:\n  # Power user signals\n  - running_max_campaigns:\n      condition: \"User has 2 active campaigns\"\n      message: \"You're a power player! üî•\"\n      offer: \"Champion tier lets you run 4 campaigns\"\n      cta: \"Upgrade to Champion\"\n      \n  - frequent_player:\n      condition: \"20+ sessions in 30 days\"\n      message: \"You're logging serious hours! üëë\"\n      offer: \"Champion perks designed for players like you\"\n      cta: \"See Champion Benefits\"\n      \n  - premium_content_interest:\n      condition: \"Purchased 2+ premium items\"\n      message: \"You love premium content!\"\n      offer: \"Champion includes ALL premium content\"\n      cta: \"Save money with Champion\"\n      \n  - supporter_for_3_months:\n      message: \"You've been a loyal Supporter! üôè\"\n      offer: \"Champion unlocks even more features\"\n      cta: \"Level up to Champion\"\n\nvalue_messaging:\n  show_savings: \"You've spent $X on premium content. Champion includes it all for $10/mo!\"\n  highlight_exclusives: \"Custom realm builder only for Champions\"\n  emphasize_status: \"Join the inner circle of Party Lore legends\"\n```\n\n### 4.4 √Ä La Carte Purchase Flow\n\n```yaml\ndiscovery:\n  in_game_prompts:\n    - \"üÜï New Realm Available: Starship Mutiny - $7.99\"\n    - \"üìö Pre-written Campaign: Murder Mystery Manor - $4.99\"\n    \n  command_based:\n    - \"Text !shop to browse premium content\"\n    - \"Text !realms to see new worlds\"\n    \n  contextual_offers:\n    - condition: \"Campaign nearing completion\"\n      message: \"Loved this adventure? Try 'Heist of the Century' next! $4.99\"\n\npurchase_process:\n  1: \"Show clear description + price\"\n  2: \"Text YES to purchase\"\n  3: \"Redirect to Stripe payment link\"\n  4: \"Immediate unlock after payment\"\n  5: \"Receipt via SMS + email\"\n  6: \"New content ready to play\"\n\ngroup_purchasing:\n  enabled: true\n  flow:\n    - \"One player initiates purchase\"\n    - \"System asks: 'Split cost with party?'\"\n    - \"Sends request to party members\"\n    - \"Each can contribute their share\"\n    - \"Unlocks when 50% paid\"\n```\n\n### 4.5 Donation Flow\n\n```yaml\ntriggers:\n  epic_moments:\n    - \"Boss defeated\"\n    - \"Major plot reveal\"\n    - \"Character milestone\"\n    - \"Campaign completion\"\n    \n  regular_reminders:\n    frequency: \"Every 10 sessions\"\n    message: \"Enjoying Party Lore? ‚òï Support development\"\n    \n  player_initiated:\n    command: \"!donate or !support\"\n    response: \"Thanks for wanting to support! üôè\"\n\ndonation_ux:\n  message: |\n    That was epic! ‚òï Buy the DM a coffee?\n    \n    Your support keeps Party Lore running and helps us create new realms!\n    \n    [$3] [$5] [$10] [Other] [No thanks]\n  \n  no_pressure: true\n  max_frequency: \"Once per 10 sessions\"\n  never_during_gameplay: true\n  \n  post_donation:\n    message: \"Thank you so much! üôè Your support means everything.\"\n    badge: \"Supporter badge added to profile\"\n    benefits: \"No automatic benefits, just gratitude\"\n```\n\n---\n\n## 5. Payment Integration\n\n### 5.1 Requirements\n\n**Payment Provider:** Stripe\n\n**Supported Payment Methods:**\n- Credit/Debit Cards (Visa, Mastercard, Amex, Discover)\n- Apple Pay\n- Google Pay\n- PayPal (optional Phase 2)\n\n**Geographic Support:**\n- Launch: US only\n- Phase 2: UK, Canada, Australia\n- Phase 3: EU countries\n\n### 5.2 Subscription Management\n\n```typescript\ninterface Subscription {\n  id: string;\n  userId: string;\n  tier: 'free' | 'supporter' | 'champion';\n  status: 'active' | 'past_due' | 'canceled' | 'trialing';\n  \n  // Stripe details\n  stripeCustomerId: string;\n  stripeSubscriptionId: string;\n  stripePriceId: string;\n  \n  // Billing\n  currentPeriodStart: Date;\n  currentPeriodEnd: Date;\n  cancelAtPeriodEnd: boolean;\n  \n  // Metadata\n  createdAt: Date;\n  upgradedFrom?: 'free' | 'supporter';\n  upgradedAt?: Date;\n  canceledAt?: Date;\n  cancelReason?: string;\n}\n```\n\n### 5.3 Stripe Webhook Events\n\n```yaml\nrequired_webhooks:\n  subscription_events:\n    - customer.subscription.created\n    - customer.subscription.updated\n    - customer.subscription.deleted\n    - customer.subscription.trial_will_end\n    \n  payment_events:\n    - invoice.paid\n    - invoice.payment_failed\n    - payment_intent.succeeded\n    - payment_intent.payment_failed\n    \n  customer_events:\n    - customer.created\n    - customer.updated\n    - customer.deleted\n\nevent_handling:\n  subscription.created:\n    actions:\n      - activate_tier_features\n      - send_welcome_message\n      - grant_tier_badge\n      \n  subscription.deleted:\n    actions:\n      - deactivate_tier_features\n      - keep_purchased_content\n      - send_goodbye_message\n      - request_feedback\n      \n  invoice.payment_failed:\n    actions:\n      - send_payment_failure_notification\n      - retry_payment_3_times\n      - downgrade_if_still_failed\n```\n\n### 5.4 One-Time Purchase Handling\n\n```typescript\ninterface Purchase {\n  id: string;\n  userId: string;\n  productType: 'realm' | 'campaign_pack' | 'portrait' | 'cosmetic';\n  productId: string;\n  productName: string;\n  \n  // Payment\n  amount: number;  // cents\n  currency: string;\n  stripePaymentIntentId: string;\n  \n  // Status\n  status: 'pending' | 'completed' | 'refunded';\n  purchasedAt: Date;\n  \n  // Access\n  grantedAccess: boolean;\n  accessGrantedAt?: Date;\n}\n```\n\n---\n\n## 6. Database Schema\n\n### 6.1 Subscription Tables\n\n```sql\n-- User Subscriptions\nCREATE TABLE subscriptions (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    tier VARCHAR(20) NOT NULL DEFAULT 'free' \n        CHECK (tier IN ('free', 'supporter', 'champion')),\n    status VARCHAR(20) NOT NULL \n        CHECK (status IN ('active', 'past_due', 'canceled', 'trialing')),\n    \n    -- Stripe Integration\n    stripe_customer_id VARCHAR(255) UNIQUE,\n    stripe_subscription_id VARCHAR(255) UNIQUE,\n    stripe_price_id VARCHAR(255),\n    \n    -- Billing Cycle\n    current_period_start TIMESTAMP,\n    current_period_end TIMESTAMP,\n    cancel_at_period_end BOOLEAN DEFAULT FALSE,\n    \n    -- Metadata\n    created_at TIMESTAMP DEFAULT NOW(),\n    upgraded_from VARCHAR(20),\n    upgraded_at TIMESTAMP,\n    canceled_at TIMESTAMP,\n    cancel_reason TEXT,\n    \n    INDEX idx_user (user_id),\n    INDEX idx_stripe_customer (stripe_customer_id),\n    INDEX idx_status (status)\n);\n\n-- Purchase History\nCREATE TABLE purchases (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id),\n    \n    -- Product Info\n    product_type VARCHAR(50) NOT NULL \n        CHECK (product_type IN ('realm', 'campaign_pack', 'portrait', \n                                'cosmetic', 'donation')),\n    product_id VARCHAR(100),\n    product_name VARCHAR(255) NOT NULL,\n    \n    -- Payment\n    amount_cents INT NOT NULL,\n    currency VARCHAR(3) DEFAULT 'USD',\n    stripe_payment_intent_id VARCHAR(255),\n    stripe_charge_id VARCHAR(255),\n    \n    -- Status\n    status VARCHAR(20) DEFAULT 'pending' \n        CHECK (status IN ('pending', 'completed', 'refunded', 'failed')),\n    \n    -- Access Control\n    granted_access BOOLEAN DEFAULT FALSE,\n    access_granted_at TIMESTAMP,\n    \n    -- Timestamps\n    purchased_at TIMESTAMP DEFAULT NOW(),\n    refunded_at TIMESTAMP,\n    \n    INDEX idx_user (user_id),\n    INDEX idx_product (product_type, product_id),\n    INDEX idx_stripe_intent (stripe_payment_intent_id)\n);\n\n-- Donation History\nCREATE TABLE donations (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id),\n    \n    amount_cents INT NOT NULL,\n    currency VARCHAR(3) DEFAULT 'USD',\n    message TEXT,  -- Optional thank you message\n    \n    stripe_payment_intent_id VARCHAR(255),\n    \n    donated_at TIMESTAMP DEFAULT NOW(),\n    \n    INDEX idx_user (user_id),\n    INDEX idx_donated_at (donated_at)\n);\n\n-- Feature Access (Track what users have access to)\nCREATE TABLE feature_access (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id),\n    \n    feature_type VARCHAR(50) NOT NULL,\n    feature_id VARCHAR(100),\n    \n    -- Access Method\n    access_method VARCHAR(20) NOT NULL \n        CHECK (access_method IN ('subscription', 'purchase', 'gift', 'promotion')),\n    \n    -- Validity\n    granted_at TIMESTAMP DEFAULT NOW(),\n    expires_at TIMESTAMP,  -- NULL for permanent\n    \n    -- Metadata\n    granted_by_subscription_id UUID REFERENCES subscriptions(id),\n    granted_by_purchase_id UUID REFERENCES purchases(id),\n    \n    INDEX idx_user_feature (user_id, feature_type),\n    INDEX idx_expires (expires_at)\n);\n```\n\n### 6.2 Usage Tracking\n\n```sql\n-- Track tier-specific usage for analytics\nCREATE TABLE tier_usage_tracking (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id),\n    tier VARCHAR(20) NOT NULL,\n    \n    -- Usage Metrics\n    sessions_played INT DEFAULT 0,\n    ai_calls_made INT DEFAULT 0,\n    portraits_generated INT DEFAULT 0,\n    campaigns_run INT DEFAULT 0,\n    \n    -- Period\n    period_start TIMESTAMP NOT NULL,\n    period_end TIMESTAMP NOT NULL,\n    \n    updated_at TIMESTAMP DEFAULT NOW(),\n    \n    INDEX idx_user_period (user_id, period_start)\n);\n\n-- Monetization Events (for funnel analysis)\nCREATE TABLE monetization_events (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id),\n    \n    event_type VARCHAR(50) NOT NULL,\n    -- 'upgrade_prompt_shown', 'upgrade_clicked', 'payment_initiated',\n    -- 'payment_completed', 'donation_prompt_shown', 'donated', etc.\n    \n    -- Context\n    tier_from VARCHAR(20),\n    tier_to VARCHAR(20),\n    amount_cents INT,\n    \n    -- Metadata\n    source VARCHAR(50),  -- Where the event occurred\n    metadata JSONB,\n    \n    created_at TIMESTAMP DEFAULT NOW(),\n    \n    INDEX idx_user (user_id),\n    INDEX idx_event_type (event_type),\n    INDEX idx_created_at (created_at)\n);\n```\n\n---\n\n## 7. API Specifications\n\n### 7.1 Subscription Endpoints\n\n```yaml\nPOST /api/subscriptions/create\nDescription: Create new subscription\nAuth: Required\nRequest:\n  tier: 'supporter' | 'champion'\n  payment_method_id: string  # Stripe payment method\nResponse:\n  subscription_id: string\n  status: 'active'\n  current_period_end: ISO8601\n  stripe_hosted_url: string  # For payment confirmation\n```\n\n```yaml\nPOST /api/subscriptions/upgrade\nDescription: Upgrade existing subscription\nAuth: Required\nRequest:\n  from_tier: 'supporter'\n  to_tier: 'champion'\nResponse:\n  subscription_id: string\n  prorated_amount: number\n  new_price: number\n  effective_date: ISO8601\n```\n\n```yaml\nPOST /api/subscriptions/cancel\nDescription: Cancel subscription\nAuth: Required\nRequest:\n  subscription_id: string\n  cancel_reason: string (optional)\n  cancel_immediately: boolean (default: false)\nResponse:\n  status: 'canceled'\n  end_date: ISO8601\n  message: \"Subscription will end on {date}\"\n```\n\n```yaml\nGET /api/subscriptions/status\nDescription: Get current subscription status\nAuth: Required\nResponse:\n  tier: 'champion'\n  status: 'active'\n  billing_cycle_anchor: ISO8601\n  current_period_end: ISO8601\n  cancel_at_period_end: false\n  features: {\n    concurrent_campaigns: 4,\n    priority_ai: true,\n    custom_realms: true,\n    ...\n  }\n```\n\n### 7.2 Purchase Endpoints\n\n```yaml\nPOST /api/purchases/initiate\nDescription: Start purchase flow\nAuth: Required\nRequest:\n  product_type: 'realm'\n  product_id: 'starship_mutiny'\nResponse:\n  purchase_id: string\n  product_name: string\n  price_cents: number\n  stripe_payment_url: string\n```\n\n```yaml\nPOST /api/purchases/complete\nDescription: Complete purchase after payment\nAuth: Required (or webhook)\nRequest:\n  purchase_id: string\n  stripe_payment_intent_id: string\nResponse:\n  status: 'completed'\n  access_granted: true\n  product_available_at: '/api/content/starship_mutiny'\n```\n\n```yaml\nGET /api/purchases/history\nDescription: Get user's purchase history\nAuth: Required\nResponse:\n  purchases: [\n    {\n      id: string,\n      product_name: string,\n      amount: number,\n      purchased_at: ISO8601,\n      status: 'completed'\n    }\n  ]\n```\n\n### 7.3 Donation Endpoints\n\n```yaml\nPOST /api/donations/create\nDescription: Process donation\nAuth: Required\nRequest:\n  amount_cents: number\n  message: string (optional)\n  payment_method_id: string\nResponse:\n  donation_id: string\n  amount: number\n  thank_you_message: string\n```\n\n### 7.4 Feature Access Endpoints\n\n```yaml\nGET /api/features/check\nDescription: Check if user has access to feature\nAuth: Required\nRequest:\n  feature_type: 'realm'\n  feature_id: 'starship_mutiny'\nResponse:\n  has_access: true\n  access_method: 'subscription'\n  expires_at: null\n```\n\n---\n\n## 8. Messaging & UX\n\n### 8.1 Upgrade Prompts\n\n#### Timing Rules\n```yaml\nprompt_rules:\n  max_frequency: \"Once every 10 sessions\"\n  never_during: \n    - active_scene\n    - combat\n    - important_dialogue\n    - first_3_sessions\n  \n  only_after:\n    - scene_completion\n    - epic_moments\n    - session_milestones\n    \n  suppress_if:\n    - user_recently_donated  # Within 30 days\n    - user_recently_upgraded # Within 7 days\n    - user_explicitly_declined # Within 90 days\n```\n\n#### Message Templates\n\n**After Session 10:**\n```\nüéâ You've played 10 epic sessions!\n\nHaving fun? Support Party Lore for $5/month and get:\n‚ú® Priority AI responses (30% faster)\nüé® Free character portrait each month\nüÜï Early access to new realms\nüëë Supporter badge\n\n[Become a Supporter] [Not Now]\n```\n\n**After Epic Moment:**\n```\n‚öîÔ∏è Epic session! That dragon fight was legendary!\n\nBuy the DM a coffee? Your support helps us create more adventures.\n\n[$3] [$5] [$10] [No thanks]\n```\n\n**When Trying Locked Feature:**\n```\n‚ú® Custom realm builder is a Champion feature ($10/month)\n\nChampions also get:\nüë• Run 4 campaigns at once\n‚ö° Instant AI responses\nüéÅ All premium content included\n\n[Upgrade to Champion] [Learn More] [Not Now]\n```\n\n### 8.2 Tier Welcome Messages\n\n**New Supporter:**\n```\nüåü Welcome to Supporter status!\n\nYour benefits are now active:\n‚úÖ Priority AI (30% faster responses)\n‚úÖ 1 free character portrait this month\n‚úÖ Supporter badge unlocked\n‚úÖ Early access to upcoming realms\n\nThanks for supporting Party Lore! You're helping us grow. üôè\n\nText !supporter to see all your perks anytime.\n```\n\n**New Champion:**\n```\nüëë You're now a CHAMPION!\n\nYour exclusive benefits:\n‚úÖ Run 4 campaigns simultaneously\n‚úÖ Custom realm builder unlocked\n‚úÖ Instant AI responses\n‚úÖ All premium content included\n‚úÖ Priority support (4hr response)\n‚úÖ Champion badge + featured status\n\nYou're part of the inner circle now. Thank you for believing in Party Lore! üèÜ\n\nText !champion to explore all your powers.\n```\n\n### 8.3 Cancellation Flow\n\n**When User Cancels:**\n```\nüò¢ Sorry to see you go!\n\nBefore you cancel, know that:\n‚Ä¢ You'll keep access until {end_date}\n‚Ä¢ You can reactivate anytime\n‚Ä¢ Your progress is always saved\n‚Ä¢ Any purchased content stays yours\n\nWhat could we improve?\n[Too expensive] [Not using enough] [Technical issues] [Other]\n\nOr [Keep Subscription]\n```\n\n**After Cancellation:**\n```\nYour subscription will end on {date}. Until then, enjoy all your benefits!\n\nWe'd love to have you back someday. üôè\n\nYou can resubscribe anytime with !upgrade\n```\n\n**Re-engagement (30 days later):**\n```\nHey! We've added some cool new features since you left:\n\nüÜï New realm: Wild West Weird\n‚ö° 40% faster AI responses\nüé® Better character portraits\n\nMiss the adventure? Come back for $5/month.\n\n[Reactivate Supporter] [Not Now]\n```\n\n---\n\n## 9. Analytics & Tracking\n\n### 9.1 Key Metrics\n\n```yaml\nacquisition_metrics:\n  - new_users_total\n  - new_users_by_source\n  - onboarding_completion_rate\n  - time_to_first_session\n\nengagement_metrics:\n  - sessions_per_user_per_week\n  - session_completion_rate\n  - average_session_length\n  - d1_retention\n  - d7_retention\n  - d30_retention\n\nmonetization_metrics:\n  - free_to_paid_conversion_rate\n  - supporter_conversion_rate\n  - champion_conversion_rate\n  - arpu  # Average revenue per user\n  - arppu # Average revenue per paying user\n  - ltv   # Lifetime value\n  - churn_rate\n  - upgrade_rate  # Supporter ‚Üí Champion\n  \n  # Funnel metrics\n  - upgrade_prompt_shown\n  - upgrade_prompt_clicked\n  - payment_initiated\n  - payment_completed\n  - payment_failed\n  \n  # Donation metrics\n  - donation_prompt_shown\n  - donation_completed\n  - average_donation_amount\n  \n  # Purchase metrics\n  - shop_visits\n  - product_views\n  - purchase_initiated\n  - purchase_completed\n  - cart_abandonment_rate\n\ntier_performance:\n  by_tier:\n    - average_sessions_per_week\n    - average_ai_calls_per_session\n    - churn_rate\n    - upgrade_rate\n```\n\n### 9.2 Event Tracking\n\n```typescript\n// Track all monetization events\nenum MonetizationEvent {\n  // Prompts\n  UPGRADE_PROMPT_SHOWN = 'upgrade_prompt_shown',\n  DONATION_PROMPT_SHOWN = 'donation_prompt_shown',\n  SHOP_SHOWN = 'shop_shown',\n  \n  // User Actions\n  UPGRADE_CLICKED = 'upgrade_clicked',\n  DONATION_CLICKED = 'donation_clicked',\n  PRODUCT_CLICKED = 'product_clicked',\n  \n  // Payment Flow\n  PAYMENT_INITIATED = 'payment_initiated',\n  PAYMENT_COMPLETED = 'payment_completed',\n  PAYMENT_FAILED = 'payment_failed',\n  \n  // Subscriptions\n  SUBSCRIPTION_CREATED = 'subscription_created',\n  SUBSCRIPTION_UPGRADED = 'subscription_upgraded',\n  SUBSCRIPTION_CANCELED = 'subscription_canceled',\n  SUBSCRIPTION_RENEWED = 'subscription_renewed',\n  \n  // Donations\n  DONATED = 'donated',\n  \n  // Dismissals\n  PROMPT_DISMISSED = 'prompt_dismissed',\n  NOT_NOW_CLICKED = 'not_now_clicked',\n}\n\ninterface EventPayload {\n  userId: string;\n  eventType: MonetizationEvent;\n  timestamp: Date;\n  \n  // Context\n  currentTier: 'free' | 'supporter' | 'champion';\n  targetTier?: 'supporter' | 'champion';\n  \n  // Amounts\n  amount?: number;\n  \n  // Source\n  source: string;  // Where event occurred\n  \n  // Session context\n  sessionNumber?: number;\n  daysSinceSignup?: number;\n  \n  // Additional metadata\n  metadata?: Record<string, any>;\n}\n```\n\n### 9.3 Dashboard Requirements\n\n**Admin Dashboard Views:**\n\n```yaml\nrevenue_overview:\n  - mrr  # Monthly recurring revenue\n  - arr  # Annual recurring revenue\n  - total_revenue_today\n  - total_revenue_this_month\n  - revenue_by_tier\n  - revenue_by_product_type\n\nuser_overview:\n  - total_users\n  - active_users_today\n  - active_users_this_week\n  - new_users_today\n  - users_by_tier\n\nconversion_funnel:\n  - free_users ‚Üí upgrade_prompt_shown ‚Üí clicked ‚Üí paid\n  - prompt_shown ‚Üí donated\n  - shop_visit ‚Üí product_view ‚Üí purchased\n\ncohort_analysis:\n  - retention_by_signup_month\n  - ltv_by_cohort\n  - conversion_rate_by_cohort\n\nchurn_analysis:\n  - churn_rate_by_tier\n  - churn_reasons\n  - time_to_churn\n  - reactivation_rate\n```\n\n---\n\n## 10. Implementation Phases\n\n### Phase 1: Foundation (Week 1-2)\n**Goal:** Free tier works perfectly\n\n```yaml\ndeliverables:\n  - Complete free tier features\n  - All core gameplay\n  - No monetization yet\n  - Track would-be conversion points\n  \nsuccess_criteria:\n  - 50+ users playing\n  - 40% D1 retention\n  - Identify upgrade moments\n```\n\n### Phase 2: Donations (Week 3)\n**Goal:** Validate willingness to pay\n\n```yaml\ndeliverables:\n  - \"Buy the DM a coffee\" feature\n  - Stripe integration (donations only)\n  - Thank you messages\n  - Track conversion rate\n  \nsuccess_criteria:\n  - 10%+ users donate at least once\n  - Average donation $5+\n  - Positive user feedback\n```\n\n### Phase 3: Supporter Tier (Week 4-5)\n**Goal:** Launch first paid tier\n\n```yaml\ndeliverables:\n  - Supporter subscription ($4.99/mo)\n  - Priority AI implementation\n  - Character portrait generation\n  - Supporter badge system\n  - Upgrade prompts\n  - Billing management\n  \nsuccess_criteria:\n  - 20%+ conversion rate\n  - <10% payment failures\n  - Positive feedback on perks\n```\n\n### Phase 4: √Ä La Carte (Week 6-7)\n**Goal:** One-time purchases\n\n```yaml\ndeliverables:\n  - First premium realm ($7.99)\n  - First campaign pack ($4.99)\n  - Product catalog system\n  - Purchase flow\n  \nsuccess_criteria:\n  - 30% of users buy something\n  - Clear value perception\n  - Smooth purchase UX\n```\n\n### Phase 5: Champion Tier (Week 8+)\n**Goal:** Power user monetization\n\n```yaml\ndeliverables:\n  - Champion subscription ($9.99/mo)\n  - Custom realm builder\n  - Advanced features\n  - 4 concurrent campaigns\n  - Priority support system\n  \nsuccess_criteria:\n  - 10% of Supporters upgrade\n  - Low churn on Champions\n  - High engagement from Champions\n```\n\n---\n\n## 11. Success Metrics\n\n### 11.1 Target Metrics by Phase\n\n**After Phase 3 (Supporter Launch):**\n```yaml\nusers:\n  total: 100\n  active: 80\n  retention_d7: 40%\n\nrevenue:\n  paying_users: 20-30\n  conversion_rate: 25-30%\n  mrr: $100-150\n  arpu: $1.50\n\ncosts:\n  per_user: $3\n  total: $240\n  \nresult: ~Break-even, validates model ‚úÖ\n```\n\n**Month 6:**\n```yaml\nusers:\n  total: 1000\n  active: 700\n  retention_d7: 40%\n\nrevenue:\n  paying_users: 250-300\n  supporter: 200 √ó $4.99 = $998\n  champion: 50 √ó $9.99 = $500\n  purchases: 300 √ó $7 avg = $2,100/mo amortized\n  donations: $200/mo\n  mrr: $3,798\n  arpu: $3.80\n\ncosts:\n  per_user: $3\n  total: $2,100\n  \nprofit: $1,698/mo ‚úÖ Profitable!\n```\n\n**Year 1:**\n```yaml\nusers:\n  total: 5000\n  active: 3500\n\nrevenue:\n  paying_users: 40%\n  mrr: $15,000\n  arpu: $4.29\n\ncosts:\n  total: $10,500\n  \nprofit: $4,500/mo ‚úÖ Sustainable!\n```\n\n### 11.2 Critical Success Factors\n\n```yaml\nmust_achieve:\n  - 25%+ free-to-paid conversion\n  - <15% monthly churn on paid tiers\n  - 40%+ D7 retention overall\n  - <$3 cost per active user\n  - NPS 50+ from paying users\n\ndanger_signals:\n  - <15% conversion rate\n  - >25% monthly churn\n  - <30% D7 retention\n  - Negative user feedback on pricing\n  - Payment failure rate >5%\n```\n\n---\n\n## Appendix A: Competitive Pricing Analysis\n\n### Market Comparison\n\n| Product | Model | Price | Features |\n|---------|-------|-------|----------|\n| **D&D Beyond** | Freemium + Content | $6/mo + $30 books | Character tools + content |\n| **Roll20** | Freemium | $5-10/mo | Virtual tabletop + assets |\n| **Foundry VTT** | One-time | $50 | Self-hosted VTT |\n| **AI Dungeon** | Subscription | $10-30/mo | AI storytelling (solo) |\n| **Netflix** | Subscription | $15.49/mo | Entertainment comparison |\n| **Spotify** | Freemium | $10.99/mo | Music streaming |\n| **Patreon (avg creator)** | Support | $5-10/mo | Creator support |\n\n**Key Insights:**\n- $5-10/mo is \"sweet spot\" for RPG tools\n- $5 feels like \"coffee money\"\n- $10 feels like \"Netflix alternative\"\n- Content purchases ($30-50) accepted for books/campaigns\n\n---\n\n## Appendix B: A/B Testing Plan\n\n### Tests to Run\n\n```yaml\ntest_1_supporter_price:\n  variants:\n    - $3.99/mo\n    - $4.99/mo\n    - $5.99/mo\n  measure: Conversion rate, churn, revenue\n  duration: 30 days\n  winner: Highest MRR\n\ntest_2_upgrade_prompt_frequency:\n  variants:\n    - Every 7 sessions\n    - Every 10 sessions\n    - Every 15 sessions\n  measure: Conversion vs annoyance\n  duration: 30 days\n  \ntest_3_donation_amounts:\n  variants:\n    - [$3, $5, $10, $25]\n    - [$5, $10, $20]\n    - [$1, $5, $10, $50]\n  measure: Click rate, average donation\n  duration: 21 days\n\ntest_4_champion_messaging:\n  variants:\n    - Focus on \"Power user\"\n    - Focus on \"Support creator\"\n    - Focus on \"Exclusive features\"\n  measure: Supporter ‚Üí Champion conversion\n  duration: 45 days\n```\n\n---\n\n## Document Control\n\n**Version:** 1.0.0  \n**Last Updated:** January 5, 2025  \n**Next Review:** After Phase 3 completion\n\n**Stakeholders:**\n- Product Lead\n- Development Team\n- Business/Finance\n\n**Approval:**\n- [ ] Product requirements approved\n- [ ] Technical feasibility confirmed\n- [ ] Financial projections validated\n- [ ] Legal review completed (pricing, subscriptions)\n\n---\n\n*End of Monetization Requirements Document*",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/original/party_lore_monetization.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "database",
        "md"
      ],
      "content_hash": "9bc04069098da4d9",
      "size_bytes": 33751,
      "created_at": "2026-01-02T20:42:12.442188"
    },
    {
      "doc_id": "local_party-lore_docs_workflows_game-loop",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/workflows/game-loop.md",
      "content": "# Main Game Loop\n\nThis diagram shows the complete flow from when an SMS arrives to when the response is delivered back to players.\n\n## High-Level Flow\n\n```mermaid\nflowchart TB\n    subgraph Entry[\"üì± SMS Entry Point\"]\n        SMS[Player sends SMS]\n        Twilio[Twilio Webhook]\n        Controller[SmsWebhookController]\n    end\n\n    subgraph Routing[\"üîÄ Message Routing\"]\n        Router[MessageRouter]\n        Lookup[Phone Number Lookup]\n        SessionFind[Find Game Session]\n    end\n\n    subgraph Queue[\"üì¨ Queue Infrastructure\"]\n        Orchestrator[QueueOrchestrator]\n        Redis[(Redis Queue)]\n        Worker[GameSessionWorker]\n    end\n\n    subgraph Processing[\"‚öôÔ∏è Game Processing\"]\n        GameService[GameServiceImpl]\n        Validation[Action Validation]\n        ModeCheck[Mode Transition Check]\n        MUCA[MUCA Coordination]\n    end\n\n    subgraph Narrative[\"üìñ Narrative Generation\"]\n        TwoTier[TwoTierNarrativeService]\n        Tier1[Tier 1: Mechanics LLM]\n        Tier2[Tier 2: Narrative LLM]\n    end\n\n    subgraph Delivery[\"üì§ Response Delivery\"]\n        DeliveryOrch[DeliveryOrchestrator]\n        TwilioSms[TwilioSmsService]\n        Response[SMS to Player]\n    end\n\n    SMS --> Twilio\n    Twilio --> Controller\n    Controller --> Router\n    Router --> Lookup\n    Lookup --> SessionFind\n    SessionFind --> Orchestrator\n    Orchestrator --> Redis\n    Redis --> Worker\n    Worker --> GameService\n    GameService --> Validation\n    Validation --> ModeCheck\n    ModeCheck --> MUCA\n    MUCA --> TwoTier\n    TwoTier --> Tier1\n    Tier1 --> Tier2\n    Tier2 --> DeliveryOrch\n    DeliveryOrch --> TwilioSms\n    TwilioSms --> Response\n```\n\n## Detailed Sequence\n\n```mermaid\nsequenceDiagram\n    participant P as Player Phone\n    participant T as Twilio\n    participant C as SmsWebhookController\n    participant R as MessageRouter\n    participant Q as QueueOrchestrator\n    participant W as GameSessionWorker\n    participant G as GameServiceImpl\n    participant N as TwoTierNarrativeService\n    participant D as DeliveryOrchestrator\n\n    P->>T: SMS \"I attack the goblin\"\n    T->>C: POST /sms/webhook\n    C->>R: routeIncomingMessage()\n    R->>R: lookupPlayerByPhone()\n    R->>Q: enqueueMessage()\n    Q-->>W: Redis pub/sub\n\n    Note over W: Async Processing Begins\n\n    W->>G: processPlayerAction()\n    G->>G: validateAction()\n    G->>G: checkModeTransitions()\n    G->>N: generateNarrative()\n\n    Note over N: Two-Tier LLM Processing\n    N->>N: Tier 1: Extract Mechanics\n    N->>N: Tier 2: Generate Story\n\n    N-->>G: NarrativeResult\n    G->>D: deliverToPlayers()\n    D->>T: sendSms()\n    T->>P: SMS Response\n```\n\n## Key Components\n\n### SmsWebhookController\nEntry point for all incoming SMS messages. Validates Twilio signatures and extracts message content.\n\n**Location**: `party-lore-sms/src/main/java/com/partylore/sms/controller/SmsWebhookController.java`\n\n### MessageRouter\nRoutes messages to appropriate handlers based on message type (game action, system command, vote, etc.).\n\n**Location**: `party-lore-domain/src/main/java/com/partylore/domain/service/game/MessageRouter.java`\n\n### QueueOrchestrator\nManages message queues for async processing. Ensures messages are processed in order per session.\n\n**Location**: `party-lore-domain/src/main/java/com/partylore/domain/service/queue/QueueOrchestrator.java`\n\n### GameSessionWorker\nConsumes messages from session queues and coordinates game logic execution.\n\n**Location**: `party-lore-domain/src/main/java/com/partylore/domain/service/queue/GameSessionWorker.java`\n\n### GameServiceImpl\nCore game logic including action validation, state updates, and coordination with narrative generation.\n\n**Location**: `party-lore-game/src/main/java/com/partylore/game/GameServiceImpl.java`\n\n### DeliveryOrchestrator\nCoordinates response delivery to players, handling multi-player broadcasts and chunking.\n\n**Location**: `party-lore-game/src/main/java/com/partylore/game/delivery/DeliveryOrchestrator.java`\n\n### TwilioSmsService\nSends SMS messages via Twilio API.\n\n**Location**: `party-lore-sms/src/main/java/com/partylore/sms/service/TwilioSmsService.java`\n\n## Transaction Boundaries\n\n```mermaid\nflowchart LR\n    subgraph Sync[\"Synchronous (DB Transaction)\"]\n        A[Receive Message]\n        B[Validate Action]\n        C[Check Conflicts]\n        D[Update State]\n    end\n\n    subgraph Async[\"Asynchronous (No Transaction)\"]\n        E[Generate Narrative]\n        F[Deliver SMS]\n    end\n\n    A --> B --> C --> D\n    D -.->|Commit & Release| E\n    E --> F\n```\n\nThe system uses careful transaction boundaries:\n1. **Synchronous Phase**: Message receipt, validation, state updates - all within a single DB transaction\n2. **Async Handoff**: Transaction commits before narrative generation begins\n3. **Asynchronous Phase**: LLM calls and SMS delivery happen outside transaction scope\n\n## Error Handling\n\n```mermaid\nflowchart TB\n    subgraph Entry[\"Entry Errors\"]\n        E1[Invalid Twilio Signature]\n        E2[Malformed Request]\n        E3[Rate Limited]\n    end\n\n    subgraph Routing[\"Routing Errors\"]\n        E4[Unknown Phone Number]\n        E5[No Active Session]\n        E6[Player Not in Game]\n    end\n\n    subgraph Processing[\"Processing Errors\"]\n        E7[Invalid Action]\n        E8[MUCA Conflict - Vote Required]\n        E9[State Validation Failed]\n    end\n\n    subgraph LLM[\"LLM Errors\"]\n        E10[LLM Timeout]\n        E11[LLM Rate Limited]\n        E12[Parse Error]\n    end\n\n    subgraph Delivery[\"Delivery Errors\"]\n        E13[SMS Send Failed]\n        E14[Invalid Phone Number]\n    end\n\n    subgraph Responses[\"Error Responses\"]\n        R1[403 Forbidden]\n        R2[400 Bad Request]\n        R3[429 Too Many Requests]\n        R4[Help Message SMS]\n        R5[Retry with Backoff]\n        R6[Fallback Narrative]\n        R7[Queue for Retry]\n    end\n\n    E1 --> R1\n    E2 --> R2\n    E3 --> R3\n    E4 --> R4\n    E5 --> R4\n    E6 --> R4\n    E7 --> R4\n    E8 -->|\"Pause flow\"| VoteWait[Wait for Votes]\n    E9 --> R4\n    E10 --> R5\n    E11 --> R5\n    E12 --> R6\n    E13 --> R7\n    E14 --> R4\n```\n\n### Error Categories\n\n| Category | Handling Strategy | User Experience |\n|----------|------------------|-----------------|\n| **Entry Errors** | Reject at gateway | No SMS sent (silent fail for attacks) |\n| **Routing Errors** | Send help message | \"Reply HELP for commands\" or onboarding |\n| **Processing Errors** | Explain and guide | \"I don't understand. Try: attack, talk, move\" |\n| **LLM Errors** | Retry with fallback | Delayed response or generic narrative |\n| **Delivery Errors** | Queue and retry | May receive duplicate if retry succeeds |\n\n### MUCA Conflict Pause\n\nWhen MUCA detects a conflict requiring player votes, the normal flow **pauses**:\n\n```mermaid\nsequenceDiagram\n    participant P1 as Player 1\n    participant P2 as Player 2\n    participant G as GameService\n    participant M as MUCA\n    participant V as VoteFacilitator\n\n    P1->>G: \"I go north\"\n    P2->>G: \"I go south\"\n\n    G->>M: detectConflict()\n    M-->>G: Conflict! Direction disagreement\n\n    Note over G,V: Flow Pauses - Vote Required\n\n    G->>V: initiateVote()\n    V->>P1: SMS \"Vote: North or South?\"\n    V->>P2: SMS \"Vote: North or South?\"\n\n    Note over V: Wait up to 5 minutes\n\n    P1-->>V: \"North\"\n    P2-->>V: \"South\"\n\n    V->>M: resolveConflict(votes)\n    M-->>G: Result: North (tiebreaker: first action)\n\n    Note over G: Flow Resumes\n\n    G->>G: Continue with \"go north\"\n```\n\n### LLM Fallback Chain\n\n```mermaid\nflowchart LR\n    subgraph Primary[\"Primary: Groq\"]\n        G1[Llama 70B]\n    end\n\n    subgraph Fallback1[\"Fallback 1: Claude\"]\n        C1[Claude Sonnet]\n    end\n\n    subgraph Fallback2[\"Fallback 2: Generic\"]\n        F1[Template Response]\n    end\n\n    G1 -->|Timeout/Error| C1\n    C1 -->|Timeout/Error| F1\n\n    F1 --> Result[Generic but valid narrative]\n```\n\nThe system degrades gracefully:\n1. **Primary (Groq)**: Fast, cost-effective for most requests\n2. **Fallback (Claude)**: Higher quality but slower/costlier\n3. **Generic Template**: Always succeeds, maintains game state consistency\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/workflows/game-loop.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "graph",
        "md"
      ],
      "content_hash": "f4794dc5c6e49ca7",
      "size_bytes": 8039,
      "created_at": "2026-01-02T20:42:12.442278"
    },
    {
      "doc_id": "local_party-lore_docs_workflows_README",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/workflows/README.md",
      "content": "# Party Lore Architecture Workflows\n\nThis folder contains Mermaid flow diagrams documenting the Party Lore SMS-based RPG system architecture.\n\n## Viewing the Diagrams\n\n### GitHub\nGitHub natively renders Mermaid diagrams in markdown files. Simply view any `.md` file in this folder on GitHub.\n\n### VS Code\nInstall the **Markdown Preview Mermaid Support** extension:\n1. Open VS Code Extensions (Ctrl+Shift+X)\n2. Search for \"Markdown Preview Mermaid Support\"\n3. Install the extension by Matt Bierner\n4. Open any `.md` file and press Ctrl+Shift+V to preview\n\nAlternative extensions:\n- **Mermaid Markdown Syntax Highlighting** - Syntax highlighting in `.md` files\n- **Mermaid Editor** - Dedicated Mermaid editing with live preview\n\n## Diagrams\n\n| File | Description |\n|------|-------------|\n| [game-loop.md](game-loop.md) | Main game loop from SMS receipt to response delivery |\n| [two-tier-narrative.md](two-tier-narrative.md) | Two-tier narrative generation (Mechanics ‚Üí Narrative) |\n| [muca-coordination.md](muca-coordination.md) | Multi-User Conflict Arbitration (MUCA) framework |\n| [mode-transitions.md](mode-transitions.md) | Game mode state machine (Combat, Exploration, Social, Stealth) |\n| [arc-generation.md](arc-generation.md) | Story arc generation and transitions |\n\n## System Overview\n\nParty Lore is an SMS-based asynchronous RPG where players interact via text messages. The system handles:\n\n- **Async Gameplay**: Players can respond at their own pace\n- **Multi-Player Coordination**: MUCA framework handles conflicts and consensus\n- **Dynamic Narratives**: Two-tier LLM system for mechanics + storytelling\n- **Story Arcs**: Template-driven narrative arcs with continuity tracking\n- **Game Modes**: Context-aware mode transitions (Combat, Exploration, Social, Stealth)\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/workflows/README.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "install",
        "md",
        "readme"
      ],
      "content_hash": "9f1b3402079bcfff",
      "size_bytes": 1782,
      "created_at": "2026-01-02T20:42:12.442313"
    },
    {
      "doc_id": "local_party-lore_docs_workflows_two-tier-narrative",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/workflows/two-tier-narrative.md",
      "content": "# Two-Tier Narrative Generation\n\nParty Lore uses a two-tier LLM system to separate game mechanics from storytelling. This ensures mechanical accuracy while allowing creative narrative freedom.\n\n## Overview\n\n```mermaid\nflowchart TB\n    subgraph Input[\"üì• Input Assembly\"]\n        Action[Player Action]\n        Context[GameContext]\n        World[World State]\n        Arc[Active Story Arc]\n    end\n\n    subgraph Tier1[\"üîß Tier 1: Mechanics Engine\"]\n        T1LLM[Groq/Llama 70B]\n        Intent[Intent Detection]\n        Mode[Mode Detection]\n        Mechanics[Mechanics Extraction]\n        Validation[Validation]\n    end\n\n    subgraph Between[\"üìã Mechanics Result\"]\n        HP[HP Changes]\n        Location[Location Updates]\n        Items[Item Changes]\n        Status[Status Effects]\n        ModeChange[Mode Transitions]\n    end\n\n    subgraph Tier2[\"üìñ Tier 2: Narrative Engine\"]\n        T2LLM[Claude/Groq]\n        Story[Story Weaving]\n        Voice[Character Voice]\n        Atmosphere[Atmosphere]\n    end\n\n    subgraph Output[\"üì§ Final Output\"]\n        Narrative[Player Narrative]\n        Delivery[SMS Delivery]\n    end\n\n    Action --> Context\n    World --> Context\n    Arc --> Context\n    Context --> T1LLM\n    T1LLM --> Intent\n    Intent --> Mode\n    Mode --> Mechanics\n    Mechanics --> Validation\n    Validation --> HP\n    Validation --> Location\n    Validation --> Items\n    Validation --> Status\n    Validation --> ModeChange\n\n    HP --> T2LLM\n    Location --> T2LLM\n    Items --> T2LLM\n    Status --> T2LLM\n    ModeChange --> T2LLM\n    Context --> T2LLM\n\n    T2LLM --> Story\n    Story --> Voice\n    Voice --> Atmosphere\n    Atmosphere --> Narrative\n    Narrative --> Delivery\n```\n\n## Tier 1: Mechanics Engine\n\nThe mechanics tier extracts structured game data from player actions.\n\n### Intent Detection\n\n```mermaid\nflowchart LR\n    subgraph Input\n        Raw[\"'I swing my sword at the goblin'\"]\n    end\n\n    subgraph Detection\n        Parse[Parse Action]\n        Classify[Classify Intent]\n        Target[Identify Target]\n        Validate[Validate Against World]\n    end\n\n    subgraph Output\n        Intent[\"ActionIntent {\n            type: ATTACK,\n            target: goblin_1,\n            weapon: sword,\n            valid: true\n        }\"]\n    end\n\n    Raw --> Parse --> Classify --> Target --> Validate --> Intent\n```\n\n### Mechanics Extraction\n\n```mermaid\nflowchart TB\n    subgraph Input\n        Intent[Validated Intent]\n        Rules[Game Rules]\n        State[Current State]\n    end\n\n    subgraph Processing\n        Combat[Combat Resolution]\n        Damage[Damage Calculation]\n        Effects[Status Effects]\n        Transitions[Mode Transitions]\n    end\n\n    subgraph Result[\"Mechanics Result\"]\n        HP[\"hp_changes: [{\n            target: goblin_1,\n            delta: -8,\n            reason: 'sword attack'\n        }]\"]\n        Mode[\"mode_transition: {\n            from: EXPLORATION,\n            to: COMBAT\n        }\"]\n        Status[\"status_effects: [{\n            target: player_1,\n            effect: 'combat_ready'\n        }]\"]\n    end\n\n    Intent --> Combat\n    Rules --> Combat\n    State --> Combat\n    Combat --> Damage\n    Damage --> Effects\n    Effects --> Transitions\n    Transitions --> HP\n    Transitions --> Mode\n    Transitions --> Status\n```\n\n## Tier 2: Narrative Engine\n\nThe narrative tier transforms mechanics into compelling story.\n\n### Narrative Weaving\n\n```mermaid\nflowchart TB\n    subgraph Input\n        Mechanics[Mechanics Result]\n        Arc[Story Arc Context]\n        Memory[Session Memory]\n        Characters[Character Profiles]\n    end\n\n    subgraph Narrative\n        Scene[Scene Setting]\n        Action[Action Description]\n        Consequence[Consequences]\n        Hook[Story Hook]\n    end\n\n    subgraph Style\n        Realm[Realm Voice]\n        Tone[Appropriate Tone]\n        Length[SMS Constraints]\n    end\n\n    subgraph Output\n        Final[\"Thorin's blade flashes!\n        The goblin staggers back,\n        green blood staining\n        the ancient stones.\n        [Goblin: 12‚Üí4 HP]\"]\n    end\n\n    Mechanics --> Scene\n    Arc --> Scene\n    Memory --> Action\n    Characters --> Action\n    Scene --> Action\n    Action --> Consequence\n    Consequence --> Hook\n    Hook --> Realm\n    Realm --> Tone\n    Tone --> Length\n    Length --> Final\n```\n\n## Complete Flow Sequence\n\n```mermaid\nsequenceDiagram\n    participant P as Player\n    participant G as GameService\n    participant T1 as Tier1 LLM\n    participant M as MechanicsService\n    participant T2 as Tier2 LLM\n    participant D as Delivery\n\n    P->>G: \"I attack the goblin\"\n    G->>G: Build GameContext\n\n    Note over G,T1: Tier 1: Mechanics\n\n    G->>T1: Extract intent & mechanics\n    T1-->>G: ActionIntent + MechanicsResult\n    G->>M: Apply mechanics\n    M-->>G: Updated game state\n\n    Note over G,T2: Tier 2: Narrative\n\n    G->>T2: Generate narrative\n    Note right of T2: Receives:<br/>- Mechanics result<br/>- Updated state<br/>- Arc context<br/>- Memory\n    T2-->>G: Story narrative\n\n    G->>D: Deliver to players\n    D->>P: SMS narrative\n```\n\n## Key Files\n\n### TwoTierNarrativeService\nOrchestrates both tiers and manages context flow.\n\n**Location**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/TwoTierNarrativeService.java`\n\n### PlayerIntentDetector\nTier 1 intent classification and validation.\n\n**Location**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/PlayerIntentDetector.java`\n\n### GameModeDetector\nTier 1 mode detection and transition recommendations.\n\n**Location**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/GameModeDetector.java`\n\n### MechanicsApplicationService\nApplies mechanics results to game state.\n\n**Location**: `party-lore-game/src/main/java/com/partylore/game/mechanics/MechanicsApplicationService.java`\n\n## Why Two Tiers?\n\n| Concern | Tier 1 (Mechanics) | Tier 2 (Narrative) |\n|---------|-------------------|-------------------|\n| **Purpose** | Game rules accuracy | Storytelling quality |\n| **Model** | Groq Llama 3.1 8B | Groq Llama 3.3 70B |\n| **Output** | XML mechanics data | Prose narrative |\n| **Constraints** | Must be deterministic | Creative freedom |\n| **Validation** | Required | Optional |\n\n### Benefits\n1. **Separation of Concerns**: Mechanics bugs don't affect story, story bugs don't break mechanics\n2. **Validation Layer**: Mechanics can be validated before narrative generation\n3. **Faster Iteration**: Can tune each tier independently\n4. **Cost Optimization**: Use faster/cheaper model for mechanics, better model for narrative\n\n## LLM Model Configuration\n\nThe system uses Groq as the primary LLM provider with Claude as fallback.\n\n### Groq Models (Primary)\n\n| Model | Use Case | Speed | Config Key |\n|-------|----------|-------|------------|\n| `llama-3.1-8b-instant` | Tier 1 mechanics, quick tasks | ~500 tok/s | `groq.api.model` |\n| `llama-3.3-70b-versatile` | Tier 2 narrative, quality analysis | ~200 tok/s | `groq.api.review-model` |\n\n### Claude Models (Fallback)\n\n| Model | Use Case | When Used |\n|-------|----------|-----------|\n| `claude-3-5-haiku` | Low complexity, fast responses | Groq unavailable |\n| `claude-3-5-sonnet` | Medium/high complexity | Quality-critical paths |\n| `claude-3-opus` | Premium narratives | Opening scenes, arc generation |\n\n### Configuration\n\n```yaml\n# application.yml\ngroq:\n  api:\n    enabled: true\n    model: llama-3.1-8b-instant        # Tier 1 & quick tasks\n    quick-model: llama-3.1-8b-instant  # Same as primary\n    review-model: llama-3.3-70b-versatile  # Tier 2 narrative\n    default-temperature: 0.7\n    timeout: 60\n```\n\n### Temperature Settings\n\n| Task | Temperature | Reason |\n|------|-------------|--------|\n| Tier 1 Mechanics | 0.1-0.3 | Deterministic, structured output |\n| Tier 2 Narrative | 0.7-0.9 | Creative, varied storytelling |\n| Quality Analysis | 0.3 | Consistent scoring |\n\n### Fallback Chain\n\n```\nGroq (Primary) ‚Üí Claude (Fallback) ‚Üí Generic Template (Last Resort)\n```\n\nWhen Groq is unavailable or rate-limited, the system automatically falls back to Claude. If both fail, a generic template response maintains game state consistency.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/workflows/two-tier-narrative.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "graph",
        "llm",
        "md"
      ],
      "content_hash": "9531c021b86c9b7b",
      "size_bytes": 8082,
      "created_at": "2026-01-02T20:42:12.442355"
    },
    {
      "doc_id": "local_party-lore_docs_workflows_mode-transitions",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/workflows/mode-transitions.md",
      "content": "# Game Mode Transitions\n\nParty Lore uses a mode system to track the current gameplay context. Modes affect available actions, narrative tone, and mechanics processing.\n\n## Mode State Machine\n\n```mermaid\nstateDiagram-v2\n    [*] --> EXPLORATION: Game Start\n\n    EXPLORATION --> COMBAT: Attack/Threat Detected\n    EXPLORATION --> SOCIAL: Start Conversation\n    EXPLORATION --> STEALTH: Attempt Stealth\n\n    COMBAT --> EXPLORATION: All Enemies Defeated\n    COMBAT --> SOCIAL: Negotiate (Push)\n    COMBAT --> EXPLORATION: Flee Successfully\n\n    SOCIAL --> EXPLORATION: End Conversation\n    SOCIAL --> COMBAT: Negotiation Fails\n    SOCIAL --> COMBAT: Attack During Social\n\n    STEALTH --> EXPLORATION: Exit Stealth\n    STEALTH --> COMBAT: Detected!\n    STEALTH --> STEALTH: Continue Sneaking\n\n    note right of COMBAT: Stack can push SOCIAL\n    note right of SOCIAL: Can pop back to COMBAT\n```\n\n## Mode Stack\n\nModes can be \"pushed\" onto a stack, allowing temporary mode changes that return to the previous mode.\n\n```mermaid\nflowchart TB\n    subgraph Stack[\"Mode Stack Example\"]\n        direction TB\n        S1[\"Bottom: EXPLORATION\"]\n        S2[\"Middle: COMBAT\"]\n        S3[\"Top: SOCIAL\"]\n    end\n\n    subgraph Events[\"Event Flow\"]\n        E1[\"Player explores dungeon\"]\n        E2[\"Goblin attacks!\"]\n        E3[\"Player says 'I negotiate'\"]\n        E4[\"Negotiation fails\"]\n        E5[\"Combat resumes\"]\n        E6[\"Victory!\"]\n        E7[\"Back to exploration\"]\n    end\n\n    subgraph States[\"Stack States\"]\n        ST1[\"[EXPLORATION]\"]\n        ST2[\"[EXPLORATION, COMBAT]\"]\n        ST3[\"[EXPLORATION, COMBAT, SOCIAL]\"]\n        ST4[\"[EXPLORATION, COMBAT]\"]\n        ST5[\"[EXPLORATION]\"]\n    end\n\n    E1 --> ST1\n    E2 --> ST2\n    E3 --> ST3\n    E4 --> ST4\n    E5 --> ST4\n    E6 --> ST5\n    E7 --> ST5\n```\n\n## Transition Types\n\n```mermaid\nflowchart LR\n    subgraph Types[\"Transition Types\"]\n        ENTER[\"ENTER\n        Direct mode change\"]\n        PUSH[\"PUSH\n        Stack new mode\"]\n        POP[\"POP\n        Return to previous\"]\n        REPLACE[\"REPLACE\n        Swap current mode\"]\n        EXIT[\"EXIT\n        Leave current mode\"]\n    end\n\n    subgraph Examples\n        E1[\"Attack goblin\n        ENTER Combat\"]\n        E2[\"Mid-combat negotiate\n        PUSH Social\"]\n        E3[\"Negotiation ends\n        POP to Combat\"]\n        E4[\"Stealth detected\n        REPLACE with Combat\"]\n        E5[\"Victory\n        EXIT Combat\"]\n    end\n\n    ENTER --- E1\n    PUSH --- E2\n    POP --- E3\n    REPLACE --- E4\n    EXIT --- E5\n```\n\n## Mode Detection Flow\n\n```mermaid\nflowchart TB\n    subgraph Input\n        Action[Player Action]\n        Context[Game Context]\n        Current[Current Mode]\n    end\n\n    subgraph Detection[\"Mode Transition Detection\"]\n        Detector[GameModeDetector]\n        LLM[LLM Analysis]\n        Rules[Rule-Based Check]\n    end\n\n    subgraph Triggers[\"Common Triggers\"]\n        Attack[\"Attack action ‚Üí COMBAT\"]\n        Talk[\"Talk to NPC ‚Üí SOCIAL\"]\n        Sneak[\"Hide/Sneak ‚Üí STEALTH\"]\n        Victory[\"All enemies dead ‚Üí EXPLORATION\"]\n    end\n\n    subgraph Service\n        TransitionSvc[ModeTransitionService]\n        Stack[Mode Stack Manager]\n        Apply[Apply Transition]\n    end\n\n    Action --> Detector\n    Context --> Detector\n    Current --> Detector\n\n    Detector --> LLM\n    Detector --> Rules\n\n    LLM --> TransitionSvc\n    Rules --> TransitionSvc\n\n    TransitionSvc --> Stack\n    Stack --> Apply\n```\n\n## TransitionResult Structure\n\n```mermaid\nclassDiagram\n    class TransitionResult {\n        +boolean hasTransition\n        +GameMode fromMode\n        +GameMode toMode\n        +TransitionType type\n        +String reason\n        +String narrativeHint\n        +Map~String,Object~ transitionData\n        +getCombatOutcome()\n        +withToMode(GameMode)\n    }\n\n    class GameMode {\n        <<enumeration>>\n        EXPLORATION\n        COMBAT\n        SOCIAL\n        STEALTH\n        PUZZLE\n    }\n\n    class TransitionType {\n        <<enumeration>>\n        ENTER\n        EXIT\n        PUSH\n        POP\n        REPLACE\n    }\n\n    TransitionResult --> GameMode\n    TransitionResult --> TransitionType\n```\n\n## Combat End Detection\n\n```mermaid\nflowchart TB\n    subgraph Check[\"Combat End Conditions\"]\n        Enemies[Check Enemies]\n        AllDead{All Defeated?}\n        Fled{Player Fled?}\n        Negotiate{Negotiated Peace?}\n    end\n\n    subgraph Outcome[\"Combat Outcomes\"]\n        Victory[VICTORY]\n        Defeat[DEFEAT]\n        Escape[ESCAPE]\n        Surrender[SURRENDER]\n        Truce[TRUCE]\n    end\n\n    subgraph Result[\"Transition Result\"]\n        Exit[exitCombat(outcome)]\n        ToExplore[‚Üí EXPLORATION]\n        Hint[Narrative Hint]\n    end\n\n    Enemies --> AllDead\n    AllDead -->|Yes| Victory\n    AllDead -->|No| Fled\n    Fled -->|Yes| Escape\n    Fled -->|No| Negotiate\n    Negotiate -->|Yes| Truce\n    Negotiate -->|No| Continue[Continue Combat]\n\n    Victory --> Exit\n    Escape --> Exit\n    Truce --> Exit\n    Exit --> ToExplore\n    ToExplore --> Hint\n```\n\n## Mode-Specific Behaviors\n\n| Mode | Available Actions | Narrative Tone | Mechanics Focus |\n|------|------------------|----------------|-----------------|\n| **EXPLORATION** | Move, Search, Interact | Descriptive, Atmospheric | Discovery, Items |\n| **COMBAT** | Attack, Defend, Flee | Urgent, Action-oriented | HP, Damage, Initiative |\n| **SOCIAL** | Talk, Persuade, Intimidate | Conversational, Character-driven | Relationship, Info |\n| **STEALTH** | Sneak, Hide, Observe | Tense, Careful | Detection, Position |\n\n## Key Files\n\n### ModeTransitionService\nManages the mode stack and processes transitions.\n\n**Location**: `party-lore-game/src/main/java/com/partylore/game/mode/ModeTransitionService.java`\n\n### TransitionResult\nValue object representing a mode transition.\n\n**Location**: `party-lore-game/src/main/java/com/partylore/game/mode/TransitionResult.java`\n\n### GameModeDetector\nLLM-powered detection of mode changes from player actions.\n\n**Location**: `party-lore-ai/src/main/java/com/partylore/ai/narrative/GameModeDetector.java`\n\n### ModeStack\nManages the stack of active modes for nested state transitions.\n\n**Location**: `party-lore-game/src/main/java/com/partylore/game/mode/ModeStack.java`\n\n> **Note**: Combat end detection is handled within `ModeTransitionService.evaluateCombatEnd()`, not a separate detector class.\n\n## Integration Points\n\n```mermaid\nflowchart LR\n    subgraph Detection\n        Intent[IntentDetector]\n        Mode[ModeDetector]\n    end\n\n    subgraph Transition\n        Service[ModeTransitionService]\n        Result[TransitionResult]\n    end\n\n    subgraph Effects\n        Mechanics[MechanicsService]\n        Narrative[NarrativeService]\n        Context[GameContext]\n    end\n\n    Intent --> Mode\n    Mode --> Service\n    Service --> Result\n    Result --> Mechanics\n    Result --> Narrative\n    Result --> Context\n```\n\nMode transitions are detected during Tier 1 processing and applied before Tier 2 narrative generation. This ensures the narrative reflects the new mode context.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/workflows/mode-transitions.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "def",
        "md"
      ],
      "content_hash": "898d8d515dd9b59a",
      "size_bytes": 6983,
      "created_at": "2026-01-02T20:42:12.442470"
    },
    {
      "doc_id": "local_party-lore_docs_design_SPATIAL-SYSTEM-DESIGN",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/design/SPATIAL-SYSTEM-DESIGN.md",
      "content": "# Spatial System Design: Party Lore\n\n## Overview\n\nThis document describes the proposed spatial coherence system for Party Lore, combining 13th Age-style range bands with rich micro-positioning for narrative depth.\n\n## Design Goals\n\n1. **Realistic feel** - Players can't attack someone across the room without movement\n2. **Narrative first** - LLM describes movement fluidly, not \"move 1 zone\"\n3. **SMS friendly** - No step-by-step movement commands required\n4. **Rich tactical data** - Cover, elevation, concealment matter narratively\n5. **Consistent world** - Same places feel the same across sessions\n6. **Best AI RPG quality** - Grounded, validated, but not restrictive\n\n## Three-Layer Spatial Model\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  LAYER 1: WORLD MAP (Regions & Areas)                       ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Regions: \"The Shadowlands\", \"Kingdom of Aldoria\"       ‚îÇ\n‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ Travel time: hours/days between regions            ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Areas: \"Dark Forest\", \"Merchant District\"              ‚îÇ\n‚îÇ      ‚îî‚îÄ‚îÄ Travel time: minutes/hours between areas           ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  LAYER 2: LOCATIONS (Where scenes happen)                   ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ \"The Rusty Tankard Inn\", \"Forest Clearing\"             ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Connected to other locations via EXIT positions        ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  LAYER 3: MICRO-POSITIONS (Tactical within location)        ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ \"Behind the bar\", \"Near the fireplace\", \"By the door\"  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Each has: range to others, cover, elevation            ‚îÇ\n‚îÇ      ‚îî‚îÄ‚îÄ ENGAGED/NEARBY/FAR derived from position graph     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n## Range Band System (13th Age+)\n\n### Three Range Bands\n\n| Range Band | Meaning | Movement Cost | Combat Implications |\n|------------|---------|---------------|---------------------|\n| **ENGAGED** | Melee range, same micro-position or cost=0 connection | 0 moves | Melee attacks valid, ranged at disadvantage |\n| **NEARBY** | Same zone, cost=1 connection | 1 move | Ranged attacks valid, melee requires approach |\n| **FAR_AWAY** | Different zone, cost=2+ connection | 2+ moves | Only long-range, melee impossible without movement |\n\n### Range Calculation\n\nRange is **derived** from the position connection graph, not stored:\n\n```\nPosition A ‚îÄ‚îÄ(cost:0)‚îÄ‚îÄ> Position B    = ENGAGED\nPosition A ‚îÄ‚îÄ(cost:1)‚îÄ‚îÄ> Position C    = NEARBY\nPosition A ‚îÄ‚îÄ(cost:2)‚îÄ‚îÄ> Position D    = FAR_AWAY\nPosition A ‚îÄ‚îÄ(no path)‚îÄ> Position E    = UNREACHABLE (different location)\n```\n\n## Current Database Schema Assessment\n\n### Existing Tables (FR-199)\n\n**WorldPosition** - ‚úÖ Mostly complete\n- id, name, description\n- location_id (FK to WorldLocation)\n- combat_zone (FRONT_LINE, SUPPORT, BACKFIELD)\n- provides_cover, is_elevated, is_concealed\n- entity_status\n\n**PositionAdjacency** - ‚úÖ Mostly complete\n- from_position_id, to_position_id\n- movement_cost (1-2 typically)\n- requires_climb, requires_jump, is_difficult_terrain\n\n**WorldLocation** - ‚úÖ Complete\n- id, name, description\n- area_id (FK to WorldArea)\n- location_type, is_interior, lighting, danger_level\n\n### Schema Additions Needed\n\n**WorldPosition additions:**\n```sql\nALTER TABLE world_positions ADD COLUMN is_entry_point BOOLEAN DEFAULT false;\nALTER TABLE world_positions ADD COLUMN is_exit_point BOOLEAN DEFAULT false;\nALTER TABLE world_positions ADD COLUMN exits_to_location_id UUID REFERENCES world_locations(id);\nALTER TABLE world_positions ADD COLUMN exits_to_position_id UUID REFERENCES world_positions(id);\nALTER TABLE world_positions ADD COLUMN movement_description TEXT; -- \"Vault over the bar\"\n```\n\n**PositionAdjacency additions:**\n```sql\nALTER TABLE position_adjacencies ADD COLUMN movement_description TEXT; -- \"Sprint across the room\"\nALTER TABLE position_adjacencies ADD COLUMN is_blocked BOOLEAN DEFAULT false; -- Dynamic blocking\n```\n\n**New table: LocationConnection (cross-location travel)**\n```sql\nCREATE TABLE location_connections (\n    id UUID PRIMARY KEY,\n    from_location_id UUID NOT NULL REFERENCES world_locations(id),\n    to_location_id UUID NOT NULL REFERENCES world_locations(id),\n    from_exit_position_id UUID REFERENCES world_positions(id),\n    to_entry_position_id UUID REFERENCES world_positions(id),\n    travel_type VARCHAR(20) NOT NULL, -- INSTANT, QUICK, DISTANT, JOURNEY\n    travel_time_minutes INTEGER,\n    travel_description TEXT,\n    requires_key BOOLEAN DEFAULT false,\n    is_hidden BOOLEAN DEFAULT false,\n    is_dangerous BOOLEAN DEFAULT false,\n    created_at TIMESTAMPTZ DEFAULT NOW()\n);\n```\n\n## Micro-Position Generation\n\n### When to Generate\n\n1. **Arc Generation Time**: Key locations for the arc get full micro-position maps\n2. **First Visit**: Generic locations use templates + context\n3. **Template Library**: Common location types have predefined structures\n\n### Location Type Templates\n\n```yaml\nTAVERN:\n  positions:\n    - entrance: { entry: true, exit: true, zone: SUPPORT }\n    - common_room: { zone: FRONT_LINE }\n    - bar: { zone: SUPPORT, cover: true }\n    - behind_bar: { zone: BACKFIELD, cover: true }\n    - fireplace: { zone: SUPPORT }\n    - dark_corner: { zone: BACKFIELD, concealed: true }\n    - stairs: { exit: true, exits_to: \"upper_floor\" }\n  connections:\n    - entrance -> common_room: { cost: 1 }\n    - common_room -> bar: { cost: 0 }\n    - bar -> behind_bar: { cost: 1, requires_climb: true }\n    - common_room -> fireplace: { cost: 1 }\n    - fireplace -> dark_corner: { cost: 1 }\n    - common_room -> stairs: { cost: 1 }\n\nFOREST_CLEARING:\n  positions:\n    - clearing_center: { zone: FRONT_LINE }\n    - treeline_north: { zone: BACKFIELD, concealed: true }\n    - treeline_south: { zone: BACKFIELD, concealed: true }\n    - large_boulder: { zone: SUPPORT, cover: true, elevated: true }\n    - fallen_log: { zone: SUPPORT, cover: true }\n    - stream_bank: { zone: SUPPORT }\n    - path_east: { entry: true, exit: true }\n    - path_west: { entry: true, exit: true }\n  connections:\n    - path_east -> clearing_center: { cost: 1 }\n    - path_west -> clearing_center: { cost: 1 }\n    - clearing_center -> treeline_north: { cost: 1 }\n    - clearing_center -> treeline_south: { cost: 1 }\n    - clearing_center -> large_boulder: { cost: 1, requires_climb: true }\n    - clearing_center -> fallen_log: { cost: 0 }\n    - clearing_center -> stream_bank: { cost: 1 }\n```\n\n## Validation Approach\n\n### Soft Validation (Preferred)\n\nLLM handles most movement narratively. If player attacks from wrong range:\n\n**Player:** \"I stab the orc with my dagger\" (player is NEARBY, not ENGAGED)\n\n**LLM Response:** \"You surge forward, closing the gap in two quick strides, and drive your dagger toward the orc's side...\"\n\nThe LLM naturally incorporates the movement into the action.\n\n### Hard Validation (Guardrails)\n\nOnly for truly impossible actions:\n\n- Attack target in different location (UNREACHABLE)\n- Melee from FAR_AWAY without any movement possible\n- Attack dead/fled NPC\n- Use exit that doesn't exist\n\n**Response:** \"The orc fled into the forest - you'd need to pursue to catch up.\"\n\n## Opening Narrative Requirements\n\nOpening must establish:\n\n1. **Location name** - Where the scene takes place\n2. **Entity positions** - Where each NPC is relative to players\n3. **Range context** - Distance/positioning in narrative terms\n4. **Tactical features** - Cover, obstacles, terrain\n\n### Example Opening (Current - No Spatial Grounding)\n\n> \"Krazak the Blighted stands as a twisted and corrupted version of his former self...\"\n\n**Problem:** Where is Krazak? How far? Can players attack?\n\n### Example Opening (With Spatial Grounding)\n\n> \"The Silverleaf Grove opens before you, ancient oaks forming a natural amphitheater.\n> Krazak the Blighted blocks the path ahead, perhaps thirty paces distant, his corrupted\n> form writhing with dark energy. His pack of blighted wolves fan out through the treeline\n> to your left and right, keeping to the shadows.\n>\n> Behind you, the forest path offers retreat. A massive fallen oak to your right could\n> provide cover. The choice is yours.\"\n\n**Positions established:**\n- Players: at path entrance\n- Krazak: center, NEARBY (30 paces = 1 move to engage)\n- Wolves: treeline, FAR_AWAY (flanking)\n- Cover available: fallen oak\n\n## Cross-Location Travel\n\n### Travel Types\n\n| Type | Same Area? | Time | Encounter? | Example |\n|------|------------|------|------------|---------|\n| INSTANT | Yes, adjacent | None | No | Tavern ‚Üí Alley behind it |\n| QUICK | Yes | Minutes | 10% | Market ‚Üí Docks |\n| DISTANT | No, adjacent areas | Hours | 30% | City ‚Üí Nearby village |\n| JOURNEY | No, different regions | Days | 50%+ | Kingdom ‚Üí Foreign land |\n\n### SMS-Friendly Travel\n\n**Player:** \"I head to the docks to find Captain Marlowe\"\n\n**System:**\n1. Find path: Tavern ‚Üí Market Square ‚Üí Docks\n2. Travel type: QUICK (same area)\n3. Encounter check: No\n4. Transition with brief narrative\n\n**Response:**\n> You slip out the tavern's back door into the alley. The stench of fish grows stronger\n> as you navigate the narrow lanes toward the waterfront.\n>\n> [LOCATION: The Docks - Pier 7]\n>\n> Salt spray mists your face. Captain Marlowe's ship, the *Fickle Fortune*, rocks gently\n> at its moorings.\n\n## Phased Implementation\n\n### Phase 1: Prompt Prototyping (This Sprint)\n- Test spatial context in prompts without code changes\n- Validate LLM can generate and use position data\n- Find sweet spot for complexity\n\n### Phase 2: Opening Narrative Enhancement\n- Add spatial grounding to opening prompts\n- Generate position context at scene start\n- Store in existing microPosition fields\n\n### Phase 3: Schema Additions\n- Add exit point columns to WorldPosition\n- Add LocationConnection table\n- Migration scripts\n\n### Phase 4: Tier 1 Integration\n- Add position tracking to mechanics XML\n- Validate range for attacks\n- Soft handling for out-of-range actions\n\n### Phase 5: Arc-Time Generation\n- Generate micro-positions when arc is created\n- Template system for common locations\n- Persist to database\n\n## Success Metrics\n\n1. **Opening narratives** establish clear spatial context (100% of combats)\n2. **No impossible attacks** - melee from different location never succeeds\n3. **Narrative flow** - movement feels natural, not mechanical\n4. **Player understanding** - players know where they are and what's nearby\n5. **Consistent locations** - revisiting a place feels familiar\n\n## Open Questions\n\n1. Should players see a \"map\" of positions, or is it all narrative?\n2. How detailed should position generation prompts be?\n3. Should we track NPC positions with same granularity as players?\n4. How do we handle large battles with many combatants?\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/design/SPATIAL-SYSTEM-DESIGN.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "llm",
        "md"
      ],
      "content_hash": "5f0f6e092450bdf3",
      "size_bytes": 11301,
      "created_at": "2026-01-02T20:42:12.442607"
    },
    {
      "doc_id": "local_party-lore_docs_design_SPATIAL-PROMPT-TEMPLATES",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/design/SPATIAL-PROMPT-TEMPLATES.md",
      "content": "# Spatial System Prompt Templates\n\nBased on extensive prototyping and testing across multiple realms and scenarios.\n\n## Opening Narrative Template (Refined)\n\n```\nYou are the Game Master for a {REALM_TYPE} RPG.\n\nWrite 2-3 SHORT paragraphs (200-300 words total) to open the scene:\n- Establish atmosphere with sensory details (sight, sound, smell)\n- STATE THE OBJECTIVE clearly in the first or second paragraph\n- GROUND ALL ENTITIES spatially - where is each NPC relative to the party?\n- Weave tactical options (cover, exits, terrain) naturally into descriptions\n- End with a SINGLE provocative sentence that invites action\n\n[REALM]\n{realm_description}\nTone: {tone}\n\n[OBJECTIVE]\n{objective}\n\n[PARTY]\n{party_members}\n\n[NPCS IN SCENE]\n{npcs_with_roles_and_dispositions}\n\n[LOCATION]\n{location_name_and_type}\n\n[TACTICAL POSITIONS]\n{position_list_with_features}\n\n[STARTING POSITIONS]\n{entity_positions_with_range_bands}\n\nCRITICAL RULES:\n- Every NPC must have a clear position relative to players (distance in feet/paces)\n- Use NEARBY (within 30 feet) and FAR (beyond 30 feet) naturally in descriptions\n- DO NOT end with \"What do you do?\" or list multiple options\n- DO NOT write more than 3 paragraphs\n- Keep it immersive - storytelling, not a tactical briefing\n```\n\n## Key Changes from V1:\n1. Added word count guidance (200-300 words)\n2. \"SINGLE provocative sentence\" instead of \"contextual action prompt\"\n3. Explicit \"DO NOT list multiple options\"\n4. \"DO NOT write more than 3 paragraphs\"\n5. Simplified the IMPORTANT section to CRITICAL RULES\n\n---\n\n## Tier 1 Mechanics Template (Refined)\n\n```\nYou are the MECHANICS ENGINE for an RPG. Output ONLY valid XML. NO narrative text.\n\n[PLAYERS]\n{player_list_with_hp_and_positions}\n\n[ACTIONS]\n{player_actions}\n\n[NPCS]\n{npc_list_with_hp_and_positions}\n\n[SPATIAL CONTEXT]\n{range_calculations}\n- ENGAGED (0-5 feet): Melee attacks valid\n- NEARBY (5-30 feet): Ranged attacks valid, melee requires charge\n- FAR (30+ feet): Long-range only, melee requires 2 moves\n\n[RANGE RULES]\n- MELEE from NEARBY: Allow as CHARGE ATTACK (move + attack at -2 penalty) OR movement-only\n- MELEE from FAR: Movement only (cannot reach in one action)\n- RANGED beyond effective range: -4 penalty or auto-miss\n\n[OUTPUT FORMAT]\n<mechanics>\n  <consequence>1-sentence result description</consequence>\n  <valid_action>true|false</valid_action>\n  <action_type>ATTACK|CHARGE|MOVE|SKILL|OTHER</action_type>\n  <movement>\n    <move player=\"{name}\" from=\"{position}\" to=\"{position}\" />\n  </movement>\n  <hp_changes>\n    <change player=\"{name}\" delta=\"{-X}\">{reason}</change>\n  </hp_changes>\n  <npc_hp_changes>\n    <change npc=\"{name}\" delta=\"{-X}\">{reason}</change>\n  </npc_hp_changes>\n  <player_positions>\n    <position player=\"{name}\" at=\"{position}\" />\n  </player_positions>\n</mechanics>\n```\n\n## Key Changes from V1:\n1. Added CHARGE ATTACK option (move + attack at penalty) for melee from NEARBY\n2. Added `action_type` field to track what kind of action occurred\n3. Clearer range band definitions with feet\n4. Explicit penalty system for edge cases\n\n---\n\n## Tier 2 Narrative Template\n\n```\nYou are the Game Master for a {REALM_TYPE} RPG.\nWrite 2-3 SENTENCES describing the action outcome.\n\n[SCENE CONTEXT]\n{brief_scene_description}\n\n[PLAYER ACTION]\n{player}: \"{action_text}\"\n\n[MECHANICS RESULT]\n{what_happened_mechanically}\n\n[POSITION CONTEXT]\nBefore: {player} at {old_position} ({old_range} from {target})\nAfter: {player} at {new_position} ({new_range} from {target})\nMovement: {movement_description}\n\n[OTHER ENTITIES]\n{other_player_and_npc_positions}\n\nRULES:\n- Incorporate any movement naturally into the narrative\n- Reference positions/terrain when relevant\n- End with brief acknowledgment of tactical situation\n- DO NOT ask what player does next (other players may act)\n- Keep it to 2-3 sentences maximum\n```\n\n---\n\n## Position Generation Template (Refined)\n\n```\nGenerate tactical positions for this location.\n\n[LOCATION]\nName: {location_name}\nType: {location_type}\nDescription: {description}\nSize: {size_hint}\n\nOUTPUT FORMAT (strict YAML):\n```yaml\nlocation:\n  name: \"{location_name}\"\n  type: \"{LOCATION_TYPE}\"\n\n  positions:\n    - id: \"pos-{number}\"\n      name: \"{Position Name}\"\n      zone: \"FRONT_LINE|SUPPORT|BACKFIELD\"\n      cover: true|false\n      elevated: true|false\n      concealed: true|false\n      entry_point: true|false\n      exit_point: true|false\n      exits_to: \"{location/position}\"  # only if exit_point is true\n      description: \"{Brief tactical description}\"\n\n  connections:\n    - from: \"pos-{X}\"\n      to: \"pos-{Y}\"\n      cost: 0|1|2\n      requires: \"none|climb|jump\"\n      description: \"{Movement description}\"\n```\n\nRULES:\n- Generate {position_count} positions\n- cost: 0 = same zone (ENGAGED), 1 = one move (NEARBY), 2 = two moves (FAR)\n- Every position must connect to at least one other position\n- Include at least one entry/exit point\n- Use consistent ID format: pos-01, pos-02, etc.\n```\n\n---\n\n## Comparison Results Summary\n\n| Prompt Level | When to Use | Pros | Cons |\n|--------------|-------------|------|------|\n| **Minimal** (range only) | Simple encounters, chase scenes | Fast, less token usage | Less tactical depth |\n| **Medium** (positions + features) | Standard combat, most scenarios | Good balance, clear options | Slightly longer prompts |\n| **Detailed** (full connections) | Boss fights, complex setpieces | Maximum tactical depth | Longest prompts |\n\n**Recommendation:** Use MEDIUM level as default, DETAILED for important encounters.\n\n---\n\n## Test Results Summary\n\n### Opening Narratives (6 scenarios tested)\n- ‚úÖ Cyberpunk: Excellent spatial grounding, clear threat levels\n- ‚úÖ Horror: Great atmosphere, appropriate uncertainty for unseen threats\n- ‚úÖ Western: Perfect standoff tension, clear hostage situation\n- ‚úÖ Fantasy Underwater: Handled 3D space well\n- ‚úÖ Sci-Fi: Clear escape scenario with ally positioning\n- ‚úÖ Simple Outdoor: Works with minimal position data\n\n### Tier 1 Mechanics (3 scenarios tested)\n- ‚úÖ Ranged NEARBY: Correctly resolved attack\n- ‚úÖ Melee NEARBY: Correctly handled as movement-only (could allow charge)\n- ‚úÖ FAR with cover: Correctly failed action\n\n### Position Generation (3 locations tested)\n- ‚úÖ Ship cargo: Appropriate cramped positions with chokepoints\n- ‚úÖ Arena: Captured open danger and gate positions\n- ‚úÖ Clocktower: Handled vertical space with height values\n\n---\n\n## Implementation Recommendation\n\n### Phase 1: Opening Narrative Enhancement\nAdd spatial context to opening prompts using MEDIUM template level.\n\n### Phase 2: Tier 1 Range Validation\nAdd position tracking and range validation to mechanics.\n- Add CHARGE ATTACK option for melee from NEARBY\n- Track positions in mechanics output\n\n### Phase 3: Position Generation at Arc Time\nGenerate positions for key locations during arc creation.\nUse templates for common location types.\n\n### Phase 4: Tier 2 Position Context\nFeed position context to Tier 2 narrative generation.\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/design/SPATIAL-PROMPT-TEMPLATES.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "graph",
        "md",
        "test"
      ],
      "content_hash": "6f880fae1241102f",
      "size_bytes": 6922,
      "created_at": "2026-01-02T20:42:12.442647"
    },
    {
      "doc_id": "local_party-lore_docs_generated_diagrams_sms-flow",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/generated/diagrams/sms-flow.md",
      "content": "# SMS Message Flow\n\n> Complete flow from incoming SMS to response.\n\n## Incoming Message Processing\n\n```mermaid\nsequenceDiagram\n    autonumber\n    participant Player\n    participant Twilio\n    participant Webhook as SmsWebhookController\n    participant Queue as QueueOrchestrator\n    participant Handler as CommandHandler\n    participant Intent as PlayerIntentDetector\n    participant Game as SceneResolutionService\n    participant AI as NarrativeGenerationService\n    participant DB as PostgreSQL\n\n    Player->>Twilio: SMS \"I search the room\"\n    Twilio->>Webhook: POST /api/sms/webhook\n\n    Note over Webhook: Validate Twilio signature\n\n    Webhook->>DB: Log incoming message\n    Webhook->>Queue: Publish to processing queue\n    Webhook-->>Twilio: 200 OK (TwiML empty)\n\n    Note over Queue: Async processing begins\n\n    Queue->>Handler: Process message\n    Handler->>DB: Load GameSession, Player\n\n    alt System Command (START, INVITE, etc.)\n        Handler->>Handler: Execute command\n        Handler->>DB: Update game state\n    else Player Action\n        Handler->>Intent: Parse player intent\n        Intent-->>Handler: {action: SEARCH, target: room}\n\n        Handler->>Game: Resolve action\n        Game->>AI: Generate narrative\n        AI->>AI: Build prompt with context\n        AI->>AI: Call Claude API\n        AI-->>Game: Narrative response\n\n        Game->>DB: Update scene state\n        Game-->>Handler: Resolution result\n    end\n\n    Handler->>Queue: Queue outbound SMS\n    Queue->>Twilio: Send SMS via API\n    Twilio->>Player: SMS \"You find a hidden compartment...\"\n```\n\n## Message Queue System\n\n```mermaid\nflowchart LR\n    subgraph Inbound[\"Inbound Processing\"]\n        IN[Incoming SMS] --> VAL[Validate]\n        VAL --> LOG[Log Message]\n        LOG --> Q1[(\"Inbound Queue\")]\n    end\n\n    subgraph Processing[\"Async Processing\"]\n        Q1 --> PROC[Process Handler]\n        PROC --> RESOLVE[Resolve Action]\n        RESOLVE --> NARR[Generate Narrative]\n    end\n\n    subgraph Outbound[\"Outbound Delivery\"]\n        NARR --> Q2[(\"Outbound Queue\")]\n        Q2 --> SEND[Send via Twilio]\n        SEND --> RETRY{Success?}\n        RETRY -->|No| Q2\n        RETRY -->|Yes| DONE[Delivered]\n    end\n```\n\n## Dual Channel Routing\n\n```mermaid\nflowchart TD\n    MSG[Incoming Message] --> DETECT{Channel Detection}\n\n    DETECT -->|\"Starts with @group\"| GROUP[Group Channel]\n    DETECT -->|\"Starts with @private\"| PRIVATE[Private Channel]\n    DETECT -->|\"Default\"| AUTO[Auto-Detect]\n\n    AUTO --> ANALYZE{Content Analysis}\n    ANALYZE -->|\"Secret info\"| PRIVATE\n    ANALYZE -->|\"Group action\"| GROUP\n\n    GROUP --> BROADCAST[Broadcast to Party]\n    PRIVATE --> DM[Send to Player Only]\n```\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/generated/diagrams/sms-flow.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "dcb97f1c0a72be07",
      "size_bytes": 2678,
      "created_at": "2026-01-02T20:42:12.442697"
    },
    {
      "doc_id": "local_party-lore_docs_generated_diagrams_railway-pipeline",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/generated/diagrams/railway-pipeline.md",
      "content": "# Railway Deploy Pipeline\n\n> CI/CD pipeline for deploying Party Lore to Railway.app.\n\n## Deployment Pipeline\n\n```mermaid\nflowchart TB\n    subgraph Developer[\"Developer Workstation\"]\n        CODE[Code Changes] --> COMMIT[Git Commit]\n        COMMIT --> PUSH[Git Push]\n    end\n\n    subgraph GitHub[\"GitHub Repository\"]\n        PUSH --> REPO[Main Branch]\n        REPO --> HOOK[Webhook Trigger]\n    end\n\n    subgraph Railway[\"Railway.app\"]\n        HOOK --> BUILD[Build Phase]\n\n        subgraph BuildPhase[\"Build Phase\"]\n            BUILD --> CLONE[Clone Repository]\n            CLONE --> DETECT[Detect Dockerfile]\n            DETECT --> DOCKER[Docker Build]\n\n            subgraph DockerBuild[\"Multi-Stage Docker Build\"]\n                DOCKER --> STAGE1[Stage 1: Builder]\n                STAGE1 --> MVN[Maven Package]\n                MVN --> JAR[Build JAR]\n                JAR --> STAGE2[Stage 2: Runtime]\n                STAGE2 --> COPY[Copy JAR]\n                COPY --> IMAGE[Final Image]\n            end\n        end\n\n        IMAGE --> DEPLOY[Deploy Phase]\n\n        subgraph DeployPhase[\"Deploy Phase\"]\n            DEPLOY --> PROVISION[Provision Container]\n            PROVISION --> ENV[Inject Env Vars]\n            ENV --> START[Start Application]\n            START --> HEALTH[Health Check]\n        end\n\n        HEALTH --> READY{Healthy?}\n        READY -->|Yes| LIVE[Live Traffic]\n        READY -->|No| ROLLBACK[Rollback]\n\n        LIVE --> MONITOR[Monitoring]\n    end\n\n    subgraph External[\"External Services\"]\n        LIVE <--> PG[(PostgreSQL)]\n        LIVE <--> REDIS[(Redis)]\n        LIVE <--> TWILIO[Twilio]\n        LIVE <--> CLAUDE[Claude API]\n    end\n\n    style BUILD fill:#4a9eff\n    style DEPLOY fill:#22c55e\n    style LIVE fill:#22c55e\n    style ROLLBACK fill:#ef4444\n```\n\n## Build Details\n\n```mermaid\nflowchart LR\n    subgraph Dockerfile[\"Dockerfile Multi-Stage\"]\n        subgraph Stage1[\"Stage 1: eclipse-temurin:17-jdk-alpine\"]\n            S1A[Install Maven] --> S1B[Copy pom.xml files]\n            S1B --> S1C[Download Dependencies]\n            S1C --> S1D[Copy Source Code]\n            S1D --> S1E[mvn package -DskipTests]\n            S1E --> S1F[JAR in target/]\n        end\n\n        subgraph Stage2[\"Stage 2: eclipse-temurin:17-jre-alpine\"]\n            S2A[Create user 'partylore'] --> S2B[Copy JAR from Stage 1]\n            S2B --> S2C[Set permissions]\n            S2C --> S2D[EXPOSE 8080]\n            S2D --> S2E[ENTRYPOINT java -jar]\n        end\n\n        S1F -.->|COPY --from=builder| S2B\n    end\n```\n\n## Environment Configuration\n\n```mermaid\nflowchart TD\n    subgraph Railway[\"Railway Environment Variables\"]\n        direction LR\n        DB[DATABASE_URL<br/>DATABASE_USERNAME<br/>DATABASE_PASSWORD]\n        CACHE[REDIS_HOST<br/>REDIS_PORT]\n        SMS[TWILIO_ACCOUNT_SID<br/>TWILIO_AUTH_TOKEN<br/>TWILIO_PHONE_NUMBER_1]\n        AI[CLAUDE_API_KEY<br/>GROQ_API_KEY]\n        APP[SPRING_PROFILES_ACTIVE=prod<br/>SERVER_PORT=8080]\n    end\n\n    subgraph Secrets[\"Sensitive (Railway Secrets)\"]\n        S1[DATABASE_PASSWORD]\n        S2[TWILIO_AUTH_TOKEN]\n        S3[CLAUDE_API_KEY]\n    end\n\n    Railway --> INJECT[Injected at Runtime]\n    Secrets --> INJECT\n    INJECT --> CONTAINER[Docker Container]\n```\n\n## Health Check Flow\n\n```mermaid\nsequenceDiagram\n    participant Railway\n    participant App as Party Lore\n    participant DB as PostgreSQL\n    participant Redis\n\n    Railway->>App: GET /api/actuator/health\n\n    App->>DB: Check connection\n    DB-->>App: OK\n\n    App->>Redis: PING\n    Redis-->>App: PONG\n\n    App-->>Railway: {\"status\": \"UP\"}\n\n    alt Health OK\n        Railway->>Railway: Route traffic\n    else Health FAIL\n        Railway->>Railway: Rollback to previous\n        Railway->>Railway: Alert\n    end\n```\n\n## Rollback Strategy\n\n```mermaid\nflowchart LR\n    DEPLOY[New Deploy] --> CHECK{Health Check}\n\n    CHECK -->|Pass| PROMOTE[Promote to Live]\n    CHECK -->|Fail| KEEP[Keep Previous]\n\n    PROMOTE --> OLD[Previous Version]\n    OLD --> ARCHIVE[Archive]\n\n    KEEP --> ALERT[Alert Developer]\n    ALERT --> LOGS[Check Logs]\n    LOGS --> FIX[Fix & Redeploy]\n\n    style PROMOTE fill:#22c55e\n    style KEEP fill:#f59e0b\n    style ALERT fill:#ef4444\n```\n\n## Deployment Checklist\n\n| Step | Action | Verification |\n|------|--------|--------------|\n| 1 | Push to main | GitHub shows commit |\n| 2 | Railway detects | Build starts in dashboard |\n| 3 | Docker builds | No build errors |\n| 4 | Deploy starts | Container provisioned |\n| 5 | Health check | `/api/actuator/health` returns UP |\n| 6 | Traffic routes | SMS webhook receives messages |\n| 7 | Monitor | Check logs for errors |\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/generated/diagrams/railway-pipeline.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "graph",
        "md"
      ],
      "content_hash": "802060bed6f4a88f",
      "size_bytes": 4599,
      "created_at": "2026-01-02T20:42:12.442725"
    },
    {
      "doc_id": "local_party-lore_docs_generated_diagrams_ai-pipeline",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/generated/diagrams/ai-pipeline.md",
      "content": "# AI Processing Pipeline\n\n> How player actions are processed through the AI system.\n\n## Intent Detection Pipeline\n\n```mermaid\nflowchart TB\n    INPUT[\"Player Message:<br/>'I sneak behind the guard'\"] --> PARSE[Parse Input]\n\n    PARSE --> INTENT[Intent Detector]\n\n    subgraph IntentDetection[\"Intent Detection\"]\n        INTENT --> CLASSIFY{Classify Action}\n\n        CLASSIFY --> COMBAT[COMBAT_ACTION]\n        CLASSIFY --> SOCIAL[SOCIAL_ACTION]\n        CLASSIFY --> EXPLORE[EXPLORATION]\n        CLASSIFY --> SKILL[SKILL_CHECK]\n        CLASSIFY --> MAGIC[MAGIC_USE]\n        CLASSIFY --> ITEM[ITEM_USE]\n    end\n\n    SKILL --> EXTRACT[Extract Details]\n    EXTRACT --> STRUCT[\"Structured Intent:<br/>{type: SKILL_CHECK,<br/>skill: stealth,<br/>target: guard}\"]\n\n    STRUCT --> MODE[Mode Detector]\n\n    subgraph ModeDetection[\"Game Mode Detection\"]\n        MODE --> MCLASS{Current Mode?}\n        MCLASS --> M_COMBAT[COMBAT]\n        MCLASS --> M_SOCIAL[SOCIAL]\n        MCLASS --> M_EXPLORE[EXPLORATION]\n        MCLASS --> M_PUZZLE[PUZZLE]\n    end\n\n    M_EXPLORE --> RESOLVE[Scene Resolution]\n```\n\n## Narrative Generation Pipeline\n\n```mermaid\nflowchart TB\n    subgraph Input[\"Input Context\"]\n        SCENE[Current Scene]\n        PLAYER[Player State]\n        HISTORY[Recent History]\n        ARC[Story Arc]\n        ACTION[Resolved Action]\n    end\n\n    subgraph PromptBuilder[\"Prompt Engineering\"]\n        SCENE & PLAYER & HISTORY & ARC & ACTION --> BUILD[Build Prompt]\n\n        BUILD --> SYSTEM[System Prompt]\n        BUILD --> CONTEXT[Context Section]\n        BUILD --> INSTRUCTION[Instruction]\n\n        SYSTEM --> PROMPT[Complete Prompt]\n        CONTEXT --> PROMPT\n        INSTRUCTION --> PROMPT\n    end\n\n    subgraph LLMCall[\"LLM Call\"]\n        PROMPT --> CLAUDE[Claude API]\n        CLAUDE --> RAW[Raw Response]\n    end\n\n    subgraph PostProcess[\"Post-Processing\"]\n        RAW --> VALIDATE[Validate Response]\n        VALIDATE --> FORMAT[Format for SMS]\n        FORMAT --> SPLIT[Split if > 160 chars]\n        SPLIT --> FINAL[Final Messages]\n    end\n\n    FINAL --> QUEUE[Message Queue]\n```\n\n## MUCA Framework (Multi-User Coordination)\n\n```mermaid\nflowchart TB\n    subgraph Voting[\"Democratic Voting\"]\n        P1[Player 1 Vote] --> COLLECT[Collect Votes]\n        P2[Player 2 Vote] --> COLLECT\n        P3[Player 3 Vote] --> COLLECT\n\n        COLLECT --> TALLY[Tally Votes]\n        TALLY --> DECISION{Consensus?}\n\n        DECISION -->|Yes| EXECUTE[Execute Decision]\n        DECISION -->|No| RESOLVE[Conflict Resolution]\n    end\n\n    subgraph ConflictRes[\"Conflict Resolution\"]\n        RESOLVE --> WEIGHT[Weight by Character]\n        WEIGHT --> CONTEXT[Consider Context]\n        CONTEXT --> AI_DECIDE[AI Mediation]\n        AI_DECIDE --> COMPROMISE[Find Compromise]\n    end\n\n    subgraph VoiceBalance[\"Voice Balancing\"]\n        EXECUTE --> TRACK[Track Participation]\n        TRACK --> BALANCE{Balanced?}\n        BALANCE -->|No| ENCOURAGE[Encourage Quiet Players]\n        BALANCE -->|Yes| CONTINUE[Continue Play]\n    end\n\n    COMPROMISE --> EXECUTE\n    ENCOURAGE --> CONTINUE\n```\n\n## Two-Tier Response System\n\n```mermaid\nsequenceDiagram\n    participant Player\n    participant T1 as Tier 1 (Fast)\n    participant T2 as Tier 2 (Full)\n    participant Claude\n\n    Player->>T1: Action received\n\n    par Fast Response\n        T1->>T1: Template-based response\n        T1->>Player: \"You attempt to...\"<br/>(immediate)\n    and Full Generation\n        T2->>T2: Build full context\n        T2->>Claude: Generate narrative\n        Claude-->>T2: Full response\n        T2->>T2: Post-process\n    end\n\n    T2->>Player: Complete narrative<br/>(2-5 seconds)\n\n    Note over T1,T2: Tier 1 provides immediate feedback<br/>Tier 2 delivers full narrative\n```\n\n## LLM Fallback Strategy\n\n```mermaid\nflowchart LR\n    REQUEST[Narrative Request] --> PRIMARY[Claude API]\n\n    PRIMARY --> CHECK1{Success?}\n    CHECK1 -->|Yes| DONE[Return Response]\n    CHECK1 -->|No| FALLBACK[Groq API]\n\n    FALLBACK --> CHECK2{Success?}\n    CHECK2 -->|Yes| DONE\n    CHECK2 -->|No| CACHE[Use Cached Response]\n\n    CACHE --> CHECK3{Cache Hit?}\n    CHECK3 -->|Yes| DONE\n    CHECK3 -->|No| GENERIC[Generic Response]\n\n    GENERIC --> DONE\n\n    style PRIMARY fill:#8b5cf6\n    style FALLBACK fill:#f59e0b\n    style CACHE fill:#6b7280\n```\n\n## Context Window Management\n\n```mermaid\nflowchart TB\n    subgraph Memory[\"Narrative Memory\"]\n        FULL[Full History] --> SELECT[Memory Curation]\n\n        SELECT --> RECENT[Recent Events<br/>High Priority]\n        SELECT --> IMPORTANT[Key Plot Points<br/>Medium Priority]\n        SELECT --> BACKGROUND[Background<br/>Low Priority]\n    end\n\n    subgraph WindowBudget[\"Context Window Budget\"]\n        RECENT --> BUDGET[Token Budget]\n        IMPORTANT --> BUDGET\n        BACKGROUND --> BUDGET\n\n        BUDGET --> FIT{Fits in Window?}\n        FIT -->|Yes| USE[Include All]\n        FIT -->|No| TRIM[Trim Background]\n    end\n\n    USE --> PROMPT[Final Prompt]\n    TRIM --> PROMPT\n```\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/generated/diagrams/ai-pipeline.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "class",
        "graph",
        "md"
      ],
      "content_hash": "26fba3ed9cee073d",
      "size_bytes": 4948,
      "created_at": "2026-01-02T20:42:12.442754"
    },
    {
      "doc_id": "local_party-lore_docs_generated_diagrams_module-dependencies",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/generated/diagrams/module-dependencies.md",
      "content": "# Module Dependencies\n\n> Maven module dependency graph showing how Party Lore modules relate.\n\n## Module Dependency Graph\n\n```mermaid\nflowchart TD\n    subgraph Modules[\"Party Lore Modules\"]\n        APP[\"party-lore-app<br/><i>Spring Boot Main</i>\"]\n        WEB[\"party-lore-web<br/><i>HTTP Controllers</i>\"]\n        SMS[\"party-lore-sms<br/><i>Twilio Integration</i>\"]\n        AI[\"party-lore-ai<br/><i>Claude/Narrative</i>\"]\n        GAME[\"party-lore-game<br/><i>Game Logic</i>\"]\n        MEM[\"party-lore-memory<br/><i>Memory System</i>\"]\n        DOM[\"party-lore-domain<br/><i>JPA Entities</i>\"]\n    end\n\n    APP --> WEB\n    APP --> SMS\n    APP --> AI\n    APP --> GAME\n    APP --> MEM\n    APP --> DOM\n\n    WEB --> DOM\n    SMS --> DOM\n    SMS --> AI\n    AI --> DOM\n    AI --> MEM\n    GAME --> DOM\n    GAME --> AI\n    MEM --> DOM\n\n    style APP fill:#f9f,stroke:#333,stroke-width:2px\n    style DOM fill:#bbf,stroke:#333,stroke-width:2px\n```\n\n## Module Responsibilities\n\n| Module | Depends On | Provides |\n|--------|------------|----------|\n| **party-lore-app** | All modules | Spring Boot main, configuration, orchestration |\n| **party-lore-web** | domain | REST controllers, admin endpoints |\n| **party-lore-sms** | domain, ai | Twilio webhook, SMS services |\n| **party-lore-ai** | domain, memory | Narrative generation, intent detection, MUCA |\n| **party-lore-game** | domain, ai | Scene resolution, combat, game state |\n| **party-lore-memory** | domain | Narrative persistence, context fragments |\n| **party-lore-domain** | (none) | JPA entities, repositories, migrations |\n\n## Key Classes Per Module\n\n### party-lore-domain\n- `GameSession` - Main game entity\n- `Player` - Player characters\n- `Scene` - Current gameplay moment\n- `ActiveStoryArc` - Story progression\n- `NarrativeMemory` - AI context\n\n### party-lore-sms\n- `SmsWebhookController` - Twilio webhook\n- `TwilioSmsService` - Send SMS\n- `PhoneNumberPoolService` - Number routing\n\n### party-lore-ai\n- `NarrativeGenerationService` - Claude calls\n- `PlayerIntentDetector` - Parse actions\n- `GameModeDetector` - Combat/social/exploration\n- `TwoTierNarrativeService` - Fast + full narrative\n\n### party-lore-game\n- `SceneResolutionService` - Resolve actions\n- `TurnManagementService` - Turn tracking\n- `GameStateManager` - State transitions\n\n### party-lore-memory\n- `MemoryCurationService` - Memory selection\n- `MemoryFragmentService` - Context fragments\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/generated/diagrams/module-dependencies.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "graph",
        "http",
        "md"
      ],
      "content_hash": "ded17c6433389763",
      "size_bytes": 2402,
      "created_at": "2026-01-02T20:42:12.442779"
    },
    {
      "doc_id": "local_party-lore_docs_generated_diagrams_system-architecture",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/generated/diagrams/system-architecture.md",
      "content": "# System Architecture\n\n> Party Lore system components and their interactions.\n\n## High-Level Architecture\n\n```mermaid\nflowchart TB\n    subgraph External[\"External Services\"]\n        TWILIO[\"Twilio<br/>SMS Gateway\"]\n        CLAUDE[\"Claude API<br/>Anthropic\"]\n        GROQ[\"Groq API<br/>Fallback LLM\"]\n    end\n\n    subgraph Railway[\"Railway.app Production\"]\n        subgraph App[\"Party Lore Application\"]\n            WEB[\"party-lore-web<br/>Controllers\"]\n            SMS[\"party-lore-sms<br/>Twilio Webhook\"]\n            AI[\"party-lore-ai<br/>Narrative Engine\"]\n            GAME[\"party-lore-game<br/>Game Logic\"]\n            MEM[\"party-lore-memory<br/>Narrative Memory\"]\n            DOM[\"party-lore-domain<br/>JPA Entities\"]\n            MAIN[\"party-lore-app<br/>Spring Boot\"]\n        end\n\n        PG[(\"PostgreSQL<br/>Game Data\")]\n        REDIS[(\"Redis<br/>Cache/Sessions\")]\n    end\n\n    subgraph Players[\"Players\"]\n        P1[\"Player 1<br/>üì±\"]\n        P2[\"Player 2<br/>üì±\"]\n        P3[\"Player 3<br/>üì±\"]\n    end\n\n    P1 & P2 & P3 <-->|SMS| TWILIO\n    TWILIO <-->|Webhook| SMS\n    SMS --> MAIN\n    MAIN --> GAME\n    GAME --> AI\n    AI <-->|Narrative| CLAUDE\n    AI -.->|Fallback| GROQ\n    AI --> MEM\n    GAME --> DOM\n    MEM --> DOM\n    DOM <--> PG\n    MAIN <--> REDIS\n    WEB --> MAIN\n```\n\n## Component Descriptions\n\n| Component | Module | Purpose |\n|-----------|--------|---------|\n| **party-lore-app** | Main | Spring Boot orchestrator, dependency injection |\n| **party-lore-web** | Web | REST controllers, admin endpoints |\n| **party-lore-sms** | SMS | Twilio webhook, SMS send/receive |\n| **party-lore-ai** | AI | Claude integration, narrative generation, MUCA |\n| **party-lore-game** | Game | Scene resolution, combat, turns, game state |\n| **party-lore-memory** | Memory | Narrative persistence, context management |\n| **party-lore-domain** | Domain | JPA entities, repositories, migrations |\n\n## Tech Stack\n\n| Layer | Technology | Purpose |\n|-------|------------|---------|\n| **Runtime** | Java 17 | Language |\n| **Framework** | Spring Boot 3.2 | Application framework |\n| **Build** | Maven | Multi-module build |\n| **Database** | PostgreSQL 13+ | Persistent storage |\n| **Cache** | Redis 6+ | Session cache |\n| **SMS** | Twilio | SMS gateway |\n| **AI** | Claude (Anthropic) | Narrative generation |\n| **AI Fallback** | Groq | LLM failover |\n| **Deploy** | Railway.app | Production hosting |\n| **Container** | Docker | Packaging |\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/generated/diagrams/system-architecture.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "api",
        "graph",
        "llm",
        "md"
      ],
      "content_hash": "371e0880a778b324",
      "size_bytes": 2442,
      "created_at": "2026-01-02T20:42:12.442808"
    },
    {
      "doc_id": "local_party-lore_docs_generated_diagrams_game-lifecycle",
      "source": "local",
      "category": "narrative",
      "domain": "game_fiction",
      "file_path": "/home/doug/Development/party-lore/docs/generated/diagrams/game-lifecycle.md",
      "content": "# Game Lifecycle\n\n> State transitions for a Party Lore game session.\n\n## Game State Machine\n\n```mermaid\nstateDiagram-v2\n    [*] --> RECRUITING: Host creates game\n\n    RECRUITING --> RECRUITING: Player joins\n    RECRUITING --> ACTIVE: Host sends START\\n(min 2 players)\n    RECRUITING --> CANCELLED: Host cancels\\nor timeout\n\n    ACTIVE --> ACTIVE: Gameplay continues\n    ACTIVE --> PAUSED: All players inactive\\n(24hr timeout)\n    ACTIVE --> COMPLETED: Story concludes\\nor host ends\n\n    PAUSED --> ACTIVE: Player returns\n    PAUSED --> ABANDONED: Extended inactivity\\n(7 days)\n\n    COMPLETED --> [*]\n    CANCELLED --> [*]\n    ABANDONED --> [*]\n\n    note right of RECRUITING\n        Host invites players\n        Players accept/decline\n        Character creation\n    end note\n\n    note right of ACTIVE\n        Scenes, combat, exploration\n        Story arcs progress\n        Autopilot for absent players\n    end note\n```\n\n## Game Creation Flow\n\n```mermaid\nsequenceDiagram\n    autonumber\n    participant Host\n    participant System\n    participant DB\n    participant Invitee\n\n    Host->>System: SMS to game number\n    System->>System: Detect new conversation\n    System->>Host: \"Welcome! Create a game?\"\n\n    Host->>System: \"YES\"\n    System->>DB: Create GameSession (RECRUITING)\n    System->>Host: \"Name your character?\"\n\n    Host->>System: \"Aragorn\"\n    System->>DB: Create Player (host)\n    System->>Host: \"Choose realm: Fantasy/Cyberpunk/Horror?\"\n\n    Host->>System: \"Fantasy\"\n    System->>DB: Set realm\n    System->>Host: \"Invite players: INVITE +1234567890 Name\"\n\n    loop For each invite\n        Host->>System: \"INVITE +1555123456 Legolas\"\n        System->>DB: Create Invitation (PENDING)\n        System->>Invitee: \"You're invited to Party Lore!\"\n\n        Invitee->>System: \"YES\"\n        System->>DB: Update Invitation (ACCEPTED)\n        System->>System: Character onboarding\n        System->>DB: Create Player\n        System->>Host: \"Legolas joined!\"\n    end\n\n    Host->>System: \"START\"\n    System->>System: Validate (‚â•2 players)\n    System->>DB: Update status (ACTIVE)\n    System->>System: Generate opening scene\n    System-->>Host: Opening narrative\n    System-->>Invitee: Opening narrative\n```\n\n## Scene Lifecycle\n\n```mermaid\nstateDiagram-v2\n    [*] --> ACTIVE: Scene begins\n\n    ACTIVE --> WAITING_FOR_ACTIONS: Prompt sent\n    WAITING_FOR_ACTIONS --> RESOLVING: All actions received\\nor timeout\n\n    RESOLVING --> ACTIVE: Continue scene\n    RESOLVING --> TRANSITIONING: Scene complete\n\n    TRANSITIONING --> [*]: New scene begins\n\n    note right of WAITING_FOR_ACTIONS\n        8-hour timeout triggers autopilot\n        Quick actions allowed\n    end note\n\n    note right of RESOLVING\n        AI generates narrative\n        Combat resolved\n        State updated\n    end note\n```\n",
      "chunk_ids": [],
      "metadata": {
        "relative_path": "party-lore/docs/generated/diagrams/game-lifecycle.md",
        "extension": ".md"
      },
      "is_distractor": false,
      "semantic_tags": [
        "md"
      ],
      "content_hash": "56844afaa08a5cdb",
      "size_bytes": 2786,
      "created_at": "2026-01-02T20:42:12.442838"
    },
    {
      "doc_id": "online_docs_python_org_3_tutorial_index_html",
      "source": "online",
      "category": "technical",
      "domain": "python",
      "file_path": "https://docs.python.org/3/tutorial/index.html",
      "content": "The Python Tutorial &#8212; Python 3.14.2 documentation Theme Auto Light Dark Previous topic Changelog Next topic 1. Whetting Your Appetite This page Report a bug Show source Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Tutorial | Theme Auto Light Dark | The Python Tutorial ¬∂ Tip This tutorial is designed for programmers that are new to the Python language, not beginners who are new to programming. Python is an easy to learn, powerful programming language. It has efficient high-level data structures and a simple but effective approach to object-oriented programming. Python‚Äôs elegant syntax and dynamic typing, together with its interpreted nature, make it an ideal language for scripting and rapid application development in many areas on most platforms. The Python interpreter and the extensive standard library are freely available in source or binary form for all major platforms from the Python website, https://www.python.org/ , and may be freely distributed. The same site also contains distributions of and pointers to many free third party Python modules, programs and tools, and additional documentation. The Python interpreter is easily extended with new functions and data types implemented in C or C++ (or other languages callable from C). Python is also suitable as an extension language for customizable applications. This tutorial introduces the reader informally to the basic concepts and features of the Python language and system. Be aware that it expects you to have a basic understanding of programming in general. It helps to have a Python interpreter handy for hands-on experience, but all examples are self-contained, so the tutorial can be read off-line as well. For a description of standard objects and modules, see The Python Standard Library . The Python Language Reference gives a more formal definition of the language. To write extensions in C or C++, read Extending and Embedding the Python Interpreter and Python/C API Reference Manual . There are also several books covering Python in depth. This tutorial does not attempt to be comprehensive and cover every single feature, or even every commonly used feature. Instead, it introduces many of Python‚Äôs most noteworthy features, and will give you a good idea of the language‚Äôs flavor and style. After reading it, you will be able to read and write Python modules and programs, and you will be ready to learn more about the various Python library modules described in The Python Standard Library . The Glossary is also worth going through. 1. Whetting Your Appetite 2. Using the Python Interpreter 2.1. Invoking the Interpreter 2.1.1. Argument Passing 2.1.2. Interactive Mode 2.2. The Interpreter and Its Environment 2.2.1. Source Code Encoding 3. An Informal Introduction to Python 3.1. Using Python as a Calculator 3.1.1. Numbers 3.1.2. Text 3.1.3. Lists 3.2. First Steps Towards Programming 4. More Control Flow Tools 4.1. if Statements 4.2. for Statements 4.3. The range() Function 4.4. break and continue Statements 4.5. else Clauses on Loops 4.6. pass Statements 4.7. match Statements 4.8. Defining Functions 4.9. More on Defining Functions 4.9.1. Default Argument Values 4.9.2. Keyword Arguments 4.9.3. Special parameters 4.9.3.1. Positional-or-Keyword Arguments 4.9.3.2. Positional-Only Parameters 4.9.3.3. Keyword-Only Arguments 4.9.3.4. Function Examples 4.9.3.5. Recap 4.9.4. Arbitrary Argument Lists 4.9.5. Unpacking Argument Lists 4.9.6. Lambda Expressions 4.9.7. Documentation Strings 4.9.8. Function Annotations 4.10. Intermezzo: Coding Style 5. Data Structures 5.1. More on Lists 5.1.1. Using Lists as Stacks 5.1.2. Using Lists as Queues 5.1.3. List Comprehensions 5.1.4. Nested List Comprehensions 5.2. The del statement 5.3. Tuples and Sequences 5.4. Sets 5.5. Dictionaries 5.6. Looping Techniques 5.7. More on Conditions 5.8. Comparing Sequences and Other Types 6. Modules 6.1. More on Modules 6.1.1. Executing modules as scripts 6.1.2. The Module Search Path 6.1.3. ‚ÄúCompiled‚Äù Python files 6.2. Standard Modules 6.3. The dir() Function 6.4. Packages 6.4.1. Importing * From a Package 6.4.2. Intra-package References 6.4.3. Packages in Multiple Directories 7. Input and Output 7.1. Fancier Output Formatting 7.1.1. Formatted String Literals 7.1.2. The String format() Method 7.1.3. Manual String Formatting 7.1.4. Old string formatting 7.2. Reading and Writing Files 7.2.1. Methods of File Objects 7.2.2. Saving structured data with json 8. Errors and Exceptions 8.1. Syntax Errors 8.2. Exceptions 8.3. Handling Exceptions 8.4. Raising Exceptions 8.5. Exception Chaining 8.6. User-defined Exceptions 8.7. Defining Clean-up Actions 8.8. Predefined Clean-up Actions 8.9. Raising and Handling Multiple Unrelated Exceptions 8.10. Enriching Exceptions with Notes 9. Classes 9.1. A Word About Names and Objects 9.2. Python Scopes and Namespaces 9.2.1. Scopes and Namespaces Example 9.3. A First Look at Classes 9.3.1. Class Definition Syntax 9.3.2. Class Objects 9.3.3. Instance Objects 9.3.4. Method Objects 9.3.5. Class and Instance Variables 9.4. Random Remarks 9.5. Inheritance 9.5.1. Multiple Inheritance 9.6. Private Variables 9.7. Odds and Ends 9.8. Iterators 9.9. Generators 9.10. Generator Expressions 10. Brief Tour of the Standard Library 10.1. Operating System Interface 10.2. File Wildcards 10.3. Command Line Arguments 10.4. Error Output Redirection and Program Termination 10.5. String Pattern Matching 10.6. Mathematics 10.7. Internet Access 10.8. Dates and Times 10.9. Data Compression 10.10. Performance Measurement 10.11. Quality Control 10.12. Batteries Included 11. Brief Tour of the Standard Library ‚Äî Part II 11.1. Output Formatting 11.2. Templating 11.3. Working with Binary Data Record Layouts 11.4. Multi-threading 11.5. Logging 11.6. Weak References 11.7. Tools for Working with Lists 11.8. Decimal Floating-Point Arithmetic 12. Virtual Environments and Packages 12.1. Introduction 12.2. Creating Virtual Environments 12.3. Managing Packages with pip 13. What Now? 14. Interactive Input Editing and History Substitution 14.1. Tab Completion and History Editing 14.2. Alternatives to the Interactive Interpreter 15. Floating-Point Arithmetic: Issues and Limitations 15.1. Representation Error 16. Appendix 16.1. Interactive Mode 16.1.1. Error Handling 16.1.2. Executable Python Scripts 16.1.3. The Interactive Startup File 16.1.4. The Customization Modules Previous topic Changelog Next topic 1. Whetting Your Appetite This page Report a bug Show source ¬´ Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Tutorial | Theme Auto Light Dark | &copy; Copyright 2001 Python Software Foundation. This page is licensed under the Python Software Foundation License Version 2. Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License. See History and License for more information. The Python Software Foundation is a non-profit corporation. Please donate. Last updated on Jan 02, 2026 (19:26 UTC). Found a bug ? Created using Sphinx 8.2.3.",
      "chunk_ids": [],
      "metadata": {
        "url": "https://docs.python.org/3/tutorial/index.html",
        "title": "The Python Tutorial &#8212; Python 3.14.2 documentation"
      },
      "is_distractor": false,
      "semantic_tags": [
        "documentation",
        "python",
        "tutorial"
      ],
      "content_hash": "181d2f81a0006533",
      "size_bytes": 7132,
      "created_at": "2026-01-02T20:42:12.443027"
    },
    {
      "doc_id": "online_docs_python_org_3_tutorial_controlflow_html",
      "source": "online",
      "category": "technical",
      "domain": "python",
      "file_path": "https://docs.python.org/3/tutorial/controlflow.html",
      "content": "4. More Control Flow Tools &#8212; Python 3.14.2 documentation Theme Auto Light Dark Table of Contents 4. More Control Flow Tools 4.1. if Statements 4.2. for Statements 4.3. The range() Function 4.4. break and continue Statements 4.5. else Clauses on Loops 4.6. pass Statements 4.7. match Statements 4.8. Defining Functions 4.9. More on Defining Functions 4.9.1. Default Argument Values 4.9.2. Keyword Arguments 4.9.3. Special parameters 4.9.3.1. Positional-or-Keyword Arguments 4.9.3.2. Positional-Only Parameters 4.9.3.3. Keyword-Only Arguments 4.9.3.4. Function Examples 4.9.3.5. Recap 4.9.4. Arbitrary Argument Lists 4.9.5. Unpacking Argument Lists 4.9.6. Lambda Expressions 4.9.7. Documentation Strings 4.9.8. Function Annotations 4.10. Intermezzo: Coding Style Previous topic 3. An Informal Introduction to Python Next topic 5. Data Structures This page Report a bug Show source Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Tutorial &#187; 4. More Control Flow Tools | Theme Auto Light Dark | 4. More Control Flow Tools ¬∂ As well as the while statement just introduced, Python uses a few more that we will encounter in this chapter. 4.1. if Statements ¬∂ Perhaps the most well-known statement type is the if statement. For example: >>> x = int ( input ( \"Please enter an integer: \" )) Please enter an integer: 42 >>> if x < 0 : ... x = 0 ... print ( &#39;Negative changed to zero&#39; ) ... elif x == 0 : ... print ( &#39;Zero&#39; ) ... elif x == 1 : ... print ( &#39;Single&#39; ) ... else : ... print ( &#39;More&#39; ) ... More There can be zero or more elif parts, and the else part is optional. The keyword ‚Äò elif ‚Äô is short for ‚Äòelse if‚Äô, and is useful to avoid excessive indentation. An if ‚Ä¶ elif ‚Ä¶ elif ‚Ä¶ sequence is a substitute for the switch or case statements found in other languages. If you‚Äôre comparing the same value to several constants, or checking for specific types or attributes, you may also find the match statement useful. For more details see match Statements . 4.2. for Statements ¬∂ The for statement in Python differs a bit from what you may be used to in C or Pascal. Rather than always iterating over an arithmetic progression of numbers (like in Pascal), or giving the user the ability to define both the iteration step and halting condition (as C), Python‚Äôs for statement iterates over the items of any sequence (a list or a string), in the order that they appear in the sequence. For example (no pun intended): >>> # Measure some strings: >>> words = [ &#39;cat&#39; , &#39;window&#39; , &#39;defenestrate&#39; ] >>> for w in words : ... print ( w , len ( w )) ... cat 3 window 6 defenestrate 12 Code that modifies a collection while iterating over that same collection can be tricky to get right. Instead, it is usually more straight-forward to loop over a copy of the collection or to create a new collection: # Create a sample collection users = { &#39;Hans&#39; : &#39;active&#39; , &#39;√âl√©onore&#39; : &#39;inactive&#39; , &#39;ÊôØÂ§™ÈÉé&#39; : &#39;active&#39; } # Strategy: Iterate over a copy for user , status in users . copy () . items (): if status == &#39;inactive&#39; : del users [ user ] # Strategy: Create a new collection active_users = {} for user , status in users . items (): if status == &#39;active&#39; : active_users [ user ] = status 4.3. The range() Function ¬∂ If you do need to iterate over a sequence of numbers, the built-in function range() comes in handy. It generates arithmetic progressions: >>> for i in range ( 5 ): ... print ( i ) ... 0 1 2 3 4 The given end point is never part of the generated sequence; range(10) generates 10 values, the legal indices for items of a sequence of length 10. It is possible to let the range start at another number, or to specify a different increment (even negative; sometimes this is called the ‚Äòstep‚Äô): >>> list ( range ( 5 , 10 )) [5, 6, 7, 8, 9] >>> list ( range ( 0 , 10 , 3 )) [0, 3, 6, 9] >>> list ( range ( - 10 , - 100 , - 30 )) [-10, -40, -70] To iterate over the indices of a sequence, you can combine range() and len() as follows: >>> a = [ &#39;Mary&#39; , &#39;had&#39; , &#39;a&#39; , &#39;little&#39; , &#39;lamb&#39; ] >>> for i in range ( len ( a )): ... print ( i , a [ i ]) ... 0 Mary 1 had 2 a 3 little 4 lamb In most such cases, however, it is convenient to use the enumerate() function, see Looping Techniques . A strange thing happens if you just print a range: >>> range ( 10 ) range(0, 10) In many ways the object returned by range() behaves as if it is a list, but in fact it isn‚Äôt. It is an object which returns the successive items of the desired sequence when you iterate over it, but it doesn‚Äôt really make the list, thus saving space. We say such an object is iterable , that is, suitable as a target for functions and constructs that expect something from which they can obtain successive items until the supply is exhausted. We have seen that the for statement is such a construct, while an example of a function that takes an iterable is sum() : >>> sum ( range ( 4 )) # 0 + 1 + 2 + 3 6 Later we will see more functions that return iterables and take iterables as arguments. In chapter Data Structures , we will discuss in more detail about list() . 4.4. break and continue Statements ¬∂ The break statement breaks out of the innermost enclosing for or while loop: >>> for n in range ( 2 , 10 ): ... for x in range ( 2 , n ): ... if n % x == 0 : ... print ( f \" { n } equals { x } * { n // x } \" ) ... break ... 4 equals 2 * 2 6 equals 2 * 3 8 equals 2 * 4 9 equals 3 * 3 The continue statement continues with the next iteration of the loop: >>> for num in range ( 2 , 10 ): ... if num % 2 == 0 : ... print ( f \"Found an even number { num } \" ) ... continue ... print ( f \"Found an odd number { num } \" ) ... Found an even number 2 Found an odd number 3 Found an even number 4 Found an odd number 5 Found an even number 6 Found an odd number 7 Found an even number 8 Found an odd number 9 4.5. else Clauses on Loops ¬∂ In a for or while loop the break statement may be paired with an else clause. If the loop finishes without executing the break , the else clause executes. In a for loop, the else clause is executed after the loop finishes its final iteration, that is, if no break occurred. In a while loop, it‚Äôs executed after the loop‚Äôs condition becomes false. In either kind of loop, the else clause is not executed if the loop was terminated by a break . Of course, other ways of ending the loop early, such as a return or a raised exception, will also skip execution of the else clause. This is exemplified in the following for loop, which searches for prime numbers: >>> for n in range ( 2 , 10 ): ... for x in range ( 2 , n ): ... if n % x == 0 : ... print ( n , &#39;equals&#39; , x , &#39;*&#39; , n // x ) ... break ... else : ... # loop fell through without finding a factor ... print ( n , &#39;is a prime number&#39; ) ... 2 is a prime number 3 is a prime number 4 equals 2 * 2 5 is a prime number 6 equals 2 * 3 7 is a prime number 8 equals 2 * 4 9 equals 3 * 3 (Yes, this is the correct code. Look closely: the else clause belongs to the for loop, not the if statement.) One way to think of the else clause is to imagine it paired with the if inside the loop. As the loop executes, it will run a sequence like if/if/if/else. The if is inside the loop, encountered a number of times. If the condition is ever true, a break will happen. If the condition is never true, the else clause outside the loop will execute. When used with a loop, the else clause has more in common with the else clause of a try statement than it does with that of if statements: a try statement‚Äôs else clause runs when no exception occurs, and a loop‚Äôs else clause runs when no break occurs. For more on the try statement and exceptions, see Handling Exceptions . 4.6. pass Statements ¬∂ The pass statement does nothing. It can be used when a statement is required syntactically but the program requires no action. For example: >>> while True : ... pass # Busy-wait for keyboard interrupt (Ctrl+C) ... This is commonly used for creating minimal classes: >>> class MyEmptyClass : ... pass ... Another place pass can be used is as a place-holder for a function or conditional body when you are working on new code, allowing you to keep thinking at a more abstract level. The pass is silently ignored: >>> def initlog ( * args ): ... pass # Remember to implement this! ... For this last case, many people use the ellipsis literal ... instead of pass . This use has no special meaning to Python, and is not part of the language definition (you could use any constant expression here), but ... is used conventionally as a placeholder body as well. See The Ellipsis Object . 4.7. match Statements ¬∂ A match statement takes an expression and compares its value to successive patterns given as one or more case blocks. This is superficially similar to a switch statement in C, Java or JavaScript (and many other languages), but it‚Äôs more similar to pattern matching in languages like Rust or Haskell. Only the first pattern that matches gets executed and it can also extract components (sequence elements or object attributes) from the value into variables. If no case matches, none of the branches is executed. The simplest form compares a subject value against one or more literals: def http_error ( status ): match status : case 400 : return \"Bad request\" case 404 : return \"Not found\" case 418 : return \"I&#39;m a teapot\" case _ : return \"Something&#39;s wrong with the internet\" Note the last block: the ‚Äúvariable name‚Äù _ acts as a wildcard and never fails to match. You can combine several literals in a single pattern using | (‚Äúor‚Äù): case 401 | 403 | 404 : return \"Not allowed\" Patterns can look like unpacking assignments, and can be used to bind variables: # point is an (x, y) tuple match point : case ( 0 , 0 ): print ( \"Origin\" ) case ( 0 , y ): print ( f \"Y= { y } \" ) case ( x , 0 ): print ( f \"X= { x } \" ) case ( x , y ): print ( f \"X= { x } , Y= { y } \" ) case _ : raise ValueError ( \"Not a point\" ) Study that one carefully! The first pattern has two literals, and can be thought of as an extension of the literal pattern shown above. But the next two patterns combine a literal and a variable, and the variable binds a value from the subject ( point ). The fourth pattern captures two values, which makes it conceptually similar to the unpacking assignment (x, y) = point . If you are using classes to structure your data you can use the class name followed by an argument list resembling a constructor, but with the ability to capture attributes into variables: class Point : def __init__ ( self , x , y ): self . x = x self . y = y def where_is ( point ): match point : case Point ( x = 0 , y = 0 ): print ( \"Origin\" ) case Point ( x = 0 , y = y ): print ( f \"Y= { y } \" ) case Point ( x = x , y = 0 ): print ( f \"X= { x } \" ) case Point (): print ( \"Somewhere else\" ) case _ : print ( \"Not a point\" ) You can use positional parameters with some builtin classes that provide an ordering for their attributes (e.g. dataclasses). You can also define a specific position for attributes in patterns by setting the __match_args__ special attribute in your classes. If it‚Äôs set to (‚Äúx‚Äù, ‚Äúy‚Äù), the following patterns are all equivalent (and all bind the y attribute to the var variable): Point ( 1 , var ) Point ( 1 , y = var ) Point ( x = 1 , y = var ) Point ( y = var , x = 1 ) A recommended way to read patterns is to look at them as an extended form of what you would put on the left of an assignment, to understand which variables would be set to what. Only the standalone names (like var above) are assigned to by a match statement. Dotted names (like foo.bar ), attribute names (the x= and y= above) or class names (recognized by the ‚Äú(‚Ä¶)‚Äù next to them like Point above) are never assigned to. Patterns can be arbitrarily nested. For example, if we have a short list of Points, with __match_args__ added, we could match it like this: class Point : __match_args__ = ( &#39;x&#39; , &#39;y&#39; ) def __init__ ( self , x , y ): self . x = x self . y = y match points : case []: print ( \"No points\" ) case [ Point ( 0 , 0 )]: print ( \"The origin\" ) case [ Point ( x , y )]: print ( f \"Single point { x } , { y } \" ) case [ Point ( 0 , y1 ), Point ( 0 , y2 )]: print ( f \"Two on the Y axis at { y1 } , { y2 } \" ) case _ : print ( \"Something else\" ) We can add an if clause to a pattern, known as a ‚Äúguard‚Äù. If the guard is false, match goes on to try the next case block. Note that value capture happens before the guard is evaluated: match point : case Point ( x , y ) if x == y : print ( f \"Y=X at { x } \" ) case Point ( x , y ): print ( f \"Not on the diagonal\" ) Several other key features of this statement: Like unpacking assignments, tuple and list patterns have exactly the same meaning and actually match arbitrary sequences. An important exception is that they don‚Äôt match iterators or strings. Sequence patterns support extended unpacking: [x, y, *rest] and (x, y, *rest) work similar to unpacking assignments. The name after * may also be _ , so (x, y, *_) matches a sequence of at least two items without binding the remaining items. Mapping patterns: {\"bandwidth\": b, \"latency\": l} captures the \"bandwidth\" and \"latency\" values from a dictionary. Unlike sequence patterns, extra keys are ignored. An unpacking like **rest is also supported. (But **_ would be redundant, so it is not allowed.) Subpatterns may be captured using the as keyword: case ( Point ( x1 , y1 ), Point ( x2 , y2 ) as p2 ): ... will capture the second element of the input as p2 (as long as the input is a sequence of two points) Most literals are compared by equality, however the singletons True , False and None are compared by identity. Patterns may use named constants. These must be dotted names to prevent them from being interpreted as capture variable: from enum import Enum class Color ( Enum ): RED = &#39;red&#39; GREEN = &#39;green&#39; BLUE = &#39;blue&#39; color = Color ( input ( \"Enter your choice of &#39;red&#39;, &#39;blue&#39; or &#39;green&#39;: \" )) match color : case Color . RED : print ( \"I see red!\" ) case Color . GREEN : print ( \"Grass is green\" ) case Color . BLUE : print ( \"I&#39;m feeling the blues :(\" ) For a more detailed explanation and additional examples, you can look into PEP 636 which is written in a tutorial format. 4.8. Defining Functions ¬∂ We can create a function that writes the Fibonacci series to an arbitrary boundary: >>> def fib ( n ): # write Fibonacci series less than n ... \"\"\"Print a Fibonacci series less than n.\"\"\" ... a , b = 0 , 1 ... while a < n : ... print ( a , end = &#39; &#39; ) ... a , b = b , a + b ... print () ... >>> # Now call the function we just defined: >>> fib ( 2000 ) 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 The keyword def introduces a function definition . It must be followed by the function name and the parenthesized list of formal parameters. The statements that form the body of the function start at the next line, and must be indented. The first statement of the function body can optionally be a string literal; this string literal is the function‚Äôs documentation string, or docstring . (More about docstrings can be found in the section Documentation Strings .) There are tools which use docstrings to automatically produce online or printed documentation, or to let the user interactively browse through code; it‚Äôs good practice to include docstrings in code that you write, so make a habit of it. The execution of a function introduces a new symbol table used for the local variables of the function. More precisely, all variable assignments in a function store the value in the local symbol table; whereas variable references first look in the local symbol table, then in the local symbol tables of enclosing functions, then in the global symbol table, and finally in the table of built-in names. Thus, global variables and variables of enclosing functions cannot be directly assigned a value within a function (unless, for global variables, named in a global statement, or, for variables of enclosing functions, named in a nonlocal statement), although they may be referenced. The actual parameters (arguments) to a function call are introduced in the local symbol table of the called function when it is called; thus, arguments are passed using call by value (where the value is always an object reference , not the value of the object). [ 1 ] When a function calls another function, or calls itself recursively, a new local symbol table is created for that call. A function definition associates the function name with the function object in the current symbol table. The interpreter recognizes the object pointed to by that name as a user-defined function. Other names can also point to that same function object and can also be used to access the function: >>> fib <function fib at 10042ed0> >>> f = fib >>> f ( 100 ) 0 1 1 2 3 5 8 13 21 34 55 89 Coming from other languages, you might object that fib is not a function but a procedure since it doesn‚Äôt return a value. In fact, even functions without a return statement do return a value, albeit a rather boring one. This value is called None (it‚Äôs a built-in name). Writing the value None is normally suppressed by the interpreter if it would be the only value written. You can see it if you really want to using print() : >>> fib ( 0 ) >>> print ( fib ( 0 )) None It is simple to write a function that returns a list of the numbers of the Fibonacci series, instead of printing it: >>> def fib2 ( n ): # return Fibonacci series up to n ... \"\"\"Return a list containing the Fibonacci series up to n.\"\"\" ... result = [] ... a , b = 0 , 1 ... while a < n : ... result . append ( a ) # see below ... a , b = b , a + b ... return result ... >>> f100 = fib2 ( 100 ) # call it >>> f100 # write the result [0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89] This example, as usual, demonstrates some new Python features: The return statement returns with a value from a function. return without an expression argument returns None . Falling off the end of a function also returns None . The statement result.append(a) calls a method of the list object result . A method is a function that ‚Äòbelongs‚Äô to an object and is named obj.methodname , where obj is some object (this may be an expression), and methodname is the name of a method that is defined by the object‚Äôs type. Different types define different methods. Methods of different types may have the same name without causing ambiguity. (It is possible to define your own object types and methods, using classes , see Classes ) The method append() shown in the example is defined for list objects; it adds a new element at the end of the list. In this example it is equivalent to result = result + [a] , but more efficient. 4.9. More on Defining Functions ¬∂ It is also possible to define functions with a variable number of arguments. There are three forms, which can be combined. 4.9.1. Default Argument Values ¬∂ The most useful form is to specify a default value for one or more arguments. This creates a function that can be called with fewer arguments than it is defined to allow. For example: def ask_ok ( prompt , retries = 4 , reminder = &#39;Please try again!&#39; ): while True : reply = input ( prompt ) if reply in { &#39;y&#39; , &#39;ye&#39; , &#39;yes&#39; }: return True if reply in { &#39;n&#39; , &#39;no&#39; , &#39;nop&#39; , &#39;nope&#39; }: return False retries = retries - 1 if retries < 0 : raise ValueError ( &#39;invalid user response&#39; ) print ( reminder ) This function can be called in several ways: giving only the mandatory argument: ask_ok('Do you really want to quit?') giving one of the optional arguments: ask_ok('OK to overwrite the file?', 2) or even giving all arguments: ask_ok('OK to overwrite the file?', 2, 'Come on, only yes or no!') This example also introduces the in keyword. This tests whether or not a sequence contains a certain value. The default values are evaluated at the point of function definition in the defining scope, so that i = 5 def f ( arg = i ): print ( arg ) i = 6 f () will print 5 . Important warning: The default value is evaluated only once. This makes a difference when the default is a mutable object such as a list, dictionary, or instances of most classes. For example, the following function accumulates the arguments passed to it on subsequent calls: def f ( a , L = []): L . append ( a ) return L print ( f ( 1 )) print ( f ( 2 )) print ( f ( 3 )) This will print [ 1 ] [ 1 , 2 ] [ 1 , 2 , 3 ] If you don‚Äôt want the default to be shared between subsequent calls, you can write the function like this instead: def f ( a , L = None ): if L is None : L = [] L . append ( a ) return L 4.9.2. Keyword Arguments ¬∂ Functions can also be called using keyword arguments of the form kwarg=value . For instance, the following function: def parrot ( voltage , state = &#39;a stiff&#39; , action = &#39;voom&#39; , type = &#39;Norwegian Blue&#39; ): print ( \"-- This parrot wouldn&#39;t\" , action , end = &#39; &#39; ) print ( \"if you put\" , voltage , \"volts through it.\" ) print ( \"-- Lovely plumage, the\" , type ) print ( \"-- It&#39;s\" , state , \"!\" ) accepts one required argument ( voltage ) and three optional arguments ( state , action , and type ). This function can be called in any of the following ways: parrot ( 1000 ) # 1 positional argument parrot ( voltage = 1000 ) # 1 keyword argument parrot ( voltage = 1000000 , action = &#39;VOOOOOM&#39; ) # 2 keyword arguments parrot ( action = &#39;VOOOOOM&#39; , voltage = 1000000 ) # 2 keyword arguments parrot ( &#39;a million&#39; , &#39;bereft of life&#39; , &#39;jump&#39; ) # 3 positional arguments parrot ( &#39;a thousand&#39; , state = &#39;pushing up the daisies&#39; ) # 1 positional, 1 keyword but all the following calls would be invalid: parrot () # required argument missing parrot ( voltage = 5.0 , &#39;dead&#39; ) # non-keyword argument after a keyword argument parrot ( 110 , voltage = 220 ) # duplicate value for the same argument parrot ( actor = &#39;John Cleese&#39; ) # unknown keyword argument In a function call, keyword arguments must follow positional arguments. All the keyword arguments passed must match one of the arguments accepted by the function (e.g. actor is not a valid argument for the parrot function), and their order is not important. This also includes non-optional arguments (e.g. parrot(voltage=1000) is valid too). No argument may receive a value more than once. Here‚Äôs an example that fails due to this restriction: >>> def function ( a ): ... pass ... >>> function ( 0 , a = 0 ) Traceback (most recent call last): File \"<stdin>\" , line 1 , in <module> TypeError : function() got multiple values for argument &#39;a&#39; When a final formal parameter of the form **name is present, it receives a dictionary (see Mapping Types ‚Äî dict ) containing all keyword arguments except for those corresponding to a formal parameter. This may be combined with a formal parameter of the form *name (described in the next subsection) which receives a tuple containing the positional arguments beyond the formal parameter list. ( *name must occur before **name .) For example, if we define a function like this: def cheeseshop ( kind , * arguments , ** keywords ): print ( \"-- Do you have any\" , kind , \"?\" ) print ( \"-- I&#39;m sorry, we&#39;re all out of\" , kind ) for arg in arguments : print ( arg ) print ( \"-\" * 40 ) for kw in keywords : print ( kw , \":\" , keywords [ kw ]) It could be called like this: cheeseshop ( \"Limburger\" , \"It&#39;s very runny, sir.\" , \"It&#39;s really very, VERY runny, sir.\" , shopkeeper = \"Michael Palin\" , client = \"John Cleese\" , sketch = \"Cheese Shop Sketch\" ) and of course it would print: -- Do you have any Limburger ? -- I&#39;m sorry, we&#39;re all out of Limburger It&#39;s very runny, sir. It&#39;s really very, VERY runny, sir. ---------------------------------------- shopkeeper : Michael Palin client : John Cleese sketch : Cheese Shop Sketch Note that the order in which the keyword arguments are printed is guaranteed to match the order in which they were provided in the function call. 4.9.3. Special parameters ¬∂ By default, arguments may be passed to a Python function either by position or explicitly by keyword. For readability and performance, it makes sense to restrict the way arguments can be passed so that a developer need only look at the function definition to determine if items are passed by position, by position or keyword, or by keyword. A function definition may look like: def f(pos1, pos2, /, pos_or_kwd, *, kwd1, kwd2): ----------- ---------- ---------- | | | | Positional or keyword | | - Keyword only -- Positional only where / and * are optional. If used, these symbols indicate the kind of parameter by how the arguments may be passed to the function: positional-only, positional-or-keyword, and keyword-only. Keyword parameters are also referred to as named parameters. 4.9.3.1. Positional-or-Keyword Arguments ¬∂ If / and * are not present in the function definition, arguments may be passed to a function by position or by keyword. 4.9.3.2. Positional-Only Parameters ¬∂ Looking at this in a bit more detail, it is possible to mark certain parameters as positional-only . If positional-only , the parameters‚Äô order matters, and the parameters cannot be passed by keyword. Positional-only parameters are placed before a / (forward-slash). The / is used to logically separate the positional-only parameters from the rest of the parameters. If there is no / in the function definition, there are no positional-only parameters. Parameters following the / may be positional-or-keyword or keyword-only . 4.9.3.3. Keyword-Only Arguments ¬∂ To mark parameters as keyword-only , indicating the parameters must be passed by keyword argument, place an * in the arguments list just before the first keyword-only parameter. 4.9.3.4. Function Examples ¬∂ Consider the following example function definitions paying close attention to the markers / and * : >>> def standard_arg ( arg ): ... print ( arg ) ... >>> def pos_only_arg ( arg , / ): ... print ( arg ) ... >>> def kwd_only_arg ( * , arg ): ... print ( arg ) ... >>> def combined_example ( pos_only , / , standard , * , kwd_only ): ... print ( pos_only , standard , kwd_only ) The first function definition, standard_arg , the most familiar form, places no restrictions on the calling convention and arguments may be passed by position or keyword: >>> standard_arg ( 2 ) 2 >>> standard_arg ( arg = 2 ) 2 The second function pos_only_arg is restricted to only use positional parameters as there is a / in the function definition: >>> pos_only_arg ( 1 ) 1 >>> pos_only_arg ( arg = 1 ) Traceback (most recent call last): File \"<stdin>\" , line 1 , in <module> TypeError : pos_only_arg() got some positional-only arguments passed as keyword arguments: &#39;arg&#39; The third function kwd_only_arg only allows keyword arguments as indicated by a * in the function definition: >>> kwd_only_arg ( 3 ) Traceback (most recent call last): File \"<stdin>\" , line 1 , in <module> TypeError : kwd_only_arg() takes 0 positional arguments but 1 was given >>> kwd_only_arg ( arg = 3 ) 3 And the last uses all three calling conventions in the same function definition: >>> combined_example ( 1 , 2 , 3 ) Traceback (most recent call last): File \"<stdin>\" , line 1 , in <module> TypeError : combined_example() takes 2 positional arguments but 3 were given >>> combined_example ( 1 , 2 , kwd_only = 3 ) 1 2 3 >>> combined_example ( 1 , standard = 2 , kwd_only = 3 ) 1 2 3 >>> combined_example ( pos_only = 1 , standard = 2 , kwd_only = 3 ) Traceback (most recent call last): File \"<stdin>\" , line 1 , in <module> TypeError : combined_example() got some positional-only arguments passed as keyword arguments: &#39;pos_only&#39; Finally, consider this function definition which has a potential collision between the positional argument name and **kwds which has name as a key: def foo ( name , ** kwds ): return &#39;name&#39; in kwds There is no possible call that will make it return True as the keyword 'name' will always bind to the first parameter. For example: >>> foo ( 1 , ** { &#39;name&#39; : 2 }) Traceback (most recent call last): File \"<stdin>\" , line 1 , in <module> TypeError : foo() got multiple values for argument &#39;name&#39; >>> But using / (positional only arguments), it is possible since it allows name as a positional argument and 'name' as a key in the keyword arguments: >>> def foo ( name , / , ** kwds ): ... return &#39;name&#39; in kwds ... >>> foo ( 1 , ** { &#39;name&#39; : 2 }) True In other words, the names of positional-only parameters can be used in **kwds without ambiguity. 4.9.3.5. Recap ¬∂ The use case will determine which parameters to use in the function definition: def f ( pos1 , pos2 , / , pos_or_kwd , * , kwd1 , kwd2 ): As guidance: Use positional-only if you want the name of the parameters to not be available to the user. This is useful when parameter names have no real meaning, if you want to enforce the order of the arguments when the function is called or if you need to take some positional parameters and arbitrary keywords. Use keyword-only when names have meaning and the function definition is more understandable by being explicit with names or you want to prevent users relying on the position of the argument being passed. For an API, use positional-only to prevent breaking API changes if the parameter‚Äôs name is modified in the future. 4.9.4. Arbitrary Argument Lists ¬∂ Finally, the least frequently used option is to specify that a function can be called with an arbitrary number of arguments. These arguments will be wrapped up in a tuple (see Tuples and Sequences ). Before the variable number of arguments, zero or more normal arguments may occur. def write_multiple_items ( file , separator , * args ): file . write ( separator . join ( args )) Normally, these variadic arguments will be last in the list of formal parameters, because they scoop up all remaining input arguments that are passed to the function. Any formal parameters which occur after the *args parameter are ‚Äòkeyword-only‚Äô arguments, meaning that they can only be used as keywords rather than positional arguments. >>> def concat ( * args , sep = \"/\" ): ... return sep . join ( args ) ... >>> concat ( \"earth\" , \"mars\" , \"venus\" ) &#39;earth/mars/venus&#39; >>> concat ( \"earth\" , \"mars\" , \"venus\" , sep = \".\" ) &#39;earth.mars.venus&#39; 4.9.5. Unpacking Argument Lists ¬∂ The reverse situation occurs when the arguments are already in a list or tuple but need to be unpacked for a function call requiring separate positional arguments. For instance, the built-in range() function expects separate start and stop arguments. If they are not available separately, write the function call with the * -operator to unpack the arguments out of a list or tuple: >>> list ( range ( 3 , 6 )) # normal call with separate arguments [3, 4, 5] >>> args = [ 3 , 6 ] >>> list ( range ( * args )) # call with arguments unpacked from a list [3, 4, 5] In the same fashion, dictionaries can deliver keyword arguments with the ** -operator: >>> def parrot ( voltage , state = &#39;a stiff&#39; , action = &#39;voom&#39; ): ... print ( \"-- This parrot wouldn&#39;t\" , action , end = &#39; &#39; ) ... print ( \"if you put\" , voltage , \"volts through it.\" , end = &#39; &#39; ) ... print ( \"E&#39;s\" , state , \"!\" ) ... >>> d = { \"voltage\" : \"four million\" , \"state\" : \"bleedin&#39; demised\" , \"action\" : \"VOOM\" } >>> parrot ( ** d ) -- This parrot wouldn&#39;t VOOM if you put four million volts through it. E&#39;s bleedin&#39; demised ! 4.9.6. Lambda Expressions ¬∂ Small anonymous functions can be created with the lambda keyword. This function returns the sum of its two arguments: lambda a, b: a+b . Lambda functions can be used wherever function objects are required. They are syntactically restricted to a single expression. Semantically, they are just syntactic sugar for a normal function definition. Like nested function definitions, lambda functions can reference variables from the containing scope: >>> def make_incrementor ( n ): ... return lambda x : x + n ... >>> f = make_incrementor ( 42 ) >>> f ( 0 ) 42 >>> f ( 1 ) 43 The above example uses a lambda expression to return a function. Another use is to pass a small function as an argument. For instance, list.sort() takes a sorting key function key which can be a lambda function: >>> pairs = [( 1 , &#39;one&#39; ), ( 2 , &#39;two&#39; ), ( 3 , &#39;three&#39; ), ( 4 , &#39;four&#39; )] >>> pairs . sort ( key = lambda pair : pair [ 1 ]) >>> pairs [(4, &#39;four&#39;), (1, &#39;one&#39;), (3, &#39;three&#39;), (2, &#39;two&#39;)] 4.9.7. Documentation Strings ¬∂ Here are some conventions about the content and formatting of documentation strings. The first line should always be a short, concise summary of the object‚Äôs purpose. For brevity, it should not explicitly state the object‚Äôs name or type, since these are available by other means (except if the name happens to be a verb describing a function‚Äôs operation). This line should begin with a capital letter and end with a period. If there are more lines in the documentation string, the second line should be blank, visually separating the summary from the rest of the description. The following lines should be one or more paragraphs describing the object‚Äôs calling conventions, its side effects, etc. The Python parser strips indentation from multi-line string literals when they serve as module, class, or function docstrings. Here is an example of a multi-line docstring: >>> def my_function (): ... \"\"\"Do nothing, but document it. ... ... No, really, it doesn&#39;t do anything: ... ... >>> my_function() ... >>> ... \"\"\" ... pass ... >>> print ( my_function . __doc__ ) Do nothing, but document it. No, really, it doesn&#39;t do anything: >>> my_function() >>> 4.9.8. Function Annotations ¬∂ Function annotations are completely optional metadata information about the types used by user-defined functions (see PEP 3107 and PEP 484 for more information). Annotations are stored in the __annotations__ attribute of the function as a dictionary and have no effect on any other part of the function. Parameter annotations are defined by a colon after the parameter name, followed by an expression evaluating to the value of the annotation. Return annotations are defined by a literal -> , followed by an expression, between the parameter list and the colon denoting the end of the def statement. The following example has a required argument, an optional argument, and the return value annotated: >>> def f ( ham : str , eggs : str = &#39;eggs&#39; ) -> str : ... print ( \"Annotations:\" , f . __annotations__ ) ... print ( \"Arguments:\" , ham , eggs ) ... return ham + &#39; and &#39; + eggs ... >>> f ( &#39;spam&#39; ) Annotations: {&#39;ham&#39;: <class &#39;str&#39;>, &#39;return&#39;: <class &#39;str&#39;>, &#39;eggs&#39;: <class &#39;str&#39;>} Arguments: spam eggs &#39;spam and eggs&#39; 4.10. Intermezzo: Coding Style ¬∂ Now that you are about to write longer, more complex pieces of Python, it is a good time to talk about coding style . Most languages can be written (or more concise, formatted ) in different styles; some are more readable than others. Making it easy for others to read your code is always a good idea, and adopting a nice coding style helps tremendously for that. For Python, PEP 8 has emerged as the style guide that most projects adhere to; it promotes a very readable and eye-pleasing coding style. Every Python developer should read it at some point; here are the most important points extracted for you: Use 4-space indentation, and no tabs. 4 spaces are a good compromise between small indentation (allows greater nesting depth) and large indentation (easier to read). Tabs introduce confusion, and are best left out. Wrap lines so that they don‚Äôt exceed 79 characters. This helps users with small displays and makes it possible to have several code files side-by-side on larger displays. Use blank lines to separate functions and classes, and larger blocks of code inside functions. When possible, put comments on a line of their own. Use docstrings. Use spaces around operators and after commas, but not directly inside bracketing constructs: a = f(1, 2) + g(3, 4) . Name your classes and functions consistently; the convention is to use UpperCamelCase for classes and lowercase_with_underscores for functions and methods. Always use self as the name for the first method argument (see A First Look at Classes for more on classes and methods). Don‚Äôt use fancy encodings if your code is meant to be used in international environments. Python‚Äôs default, UTF-8, or even plain ASCII work best in any case. Likewise, don‚Äôt use non-ASCII characters in identifiers if there is only the slightest chance people speaking a different language will read or maintain the code. Footnotes [ 1 ] Actually, call by object reference would be a better description, since if a mutable object is passed, the caller will see any changes the callee makes to it (items inserted into a list). Table of Contents 4. More Control Flow Tools 4.1. if Statements 4.2. for Statements 4.3. The range() Function 4.4. break and continue Statements 4.5. else Clauses on Loops 4.6. pass Statements 4.7. match Statements 4.8. Defining Functions 4.9. More on Defining Functions 4.9.1. Default Argument Values 4.9.2. Keyword Arguments 4.9.3. Special parameters 4.9.3.1. Positional-or-Keyword Arguments 4.9.3.2. Positional-Only Parameters 4.9.3.3. Keyword-Only Arguments 4.9.3.4. Function Examples 4.9.3.5. Recap 4.9.4. Arbitrary Argument Lists 4.9.5. Unpacking Argument Lists 4.9.6. Lambda Expressions 4.9.7. Documentation Strings 4.9.8. Function Annotations 4.10. Intermezzo: Coding Style Previous topic 3. An Informal Introduction to Python Next topic 5. Data Structures This page Report a bug Show source ¬´ Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Tutorial &#187; 4. More Control Flow Tools | Theme Auto Light Dark | &copy; Copyright 2001 Python Software Foundation. This page is licensed under the Python Software Foundation License Version 2. Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License. See History and License for more information. The Python Software Foundation is a non-profit corporation. Please donate. Last updated on Jan 02, 2026 (19:26 UTC). Found a bug ? Created using Sphinx 8.2.3.",
      "chunk_ids": [],
      "metadata": {
        "url": "https://docs.python.org/3/tutorial/controlflow.html",
        "title": "4. More Control Flow Tools &#8212; Python 3.14.2 documentation"
      },
      "is_distractor": false,
      "semantic_tags": [
        "documentation",
        "function",
        "python"
      ],
      "content_hash": "371e5b89486673a6",
      "size_bytes": 38835,
      "created_at": "2026-01-02T20:42:12.443182"
    },
    {
      "doc_id": "online_docs_python_org_3_tutorial_datastructures_html",
      "source": "online",
      "category": "technical",
      "domain": "python",
      "file_path": "https://docs.python.org/3/tutorial/datastructures.html",
      "content": "5. Data Structures &#8212; Python 3.14.2 documentation Theme Auto Light Dark Table of Contents 5. Data Structures 5.1. More on Lists 5.1.1. Using Lists as Stacks 5.1.2. Using Lists as Queues 5.1.3. List Comprehensions 5.1.4. Nested List Comprehensions 5.2. The del statement 5.3. Tuples and Sequences 5.4. Sets 5.5. Dictionaries 5.6. Looping Techniques 5.7. More on Conditions 5.8. Comparing Sequences and Other Types Previous topic 4. More Control Flow Tools Next topic 6. Modules This page Report a bug Show source Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Tutorial &#187; 5. Data Structures | Theme Auto Light Dark | 5. Data Structures ¬∂ This chapter describes some things you‚Äôve learned about already in more detail, and adds some new things as well. 5.1. More on Lists ¬∂ The list data type has some more methods. Here are all of the methods of list objects: list. append ( x ) Add an item to the end of the list. Similar to a[len(a):] = [x] . list. extend ( iterable ) Extend the list by appending all the items from the iterable. Similar to a[len(a):] = iterable . list. insert ( i , x ) Insert an item at a given position. The first argument is the index of the element before which to insert, so a.insert(0, x) inserts at the front of the list, and a.insert(len(a), x) is equivalent to a.append(x) . list. remove ( x ) Remove the first item from the list whose value is equal to x . It raises a ValueError if there is no such item. list. pop ( [ i ] ) Remove the item at the given position in the list, and return it. If no index is specified, a.pop() removes and returns the last item in the list. It raises an IndexError if the list is empty or the index is outside the list range. list. clear ( ) Remove all items from the list. Similar to del a[:] . list. index ( x [ , start [ , end ] ] ) Return zero-based index of the first occurrence of x in the list. Raises a ValueError if there is no such item. The optional arguments start and end are interpreted as in the slice notation and are used to limit the search to a particular subsequence of the list. The returned index is computed relative to the beginning of the full sequence rather than the start argument. list. count ( x ) Return the number of times x appears in the list. list. sort ( * , key = None , reverse = False ) Sort the items of the list in place (the arguments can be used for sort customization, see sorted() for their explanation). list. reverse ( ) Reverse the elements of the list in place. list. copy ( ) Return a shallow copy of the list. Similar to a[:] . An example that uses most of the list methods: >>> fruits = [ &#39;orange&#39; , &#39;apple&#39; , &#39;pear&#39; , &#39;banana&#39; , &#39;kiwi&#39; , &#39;apple&#39; , &#39;banana&#39; ] >>> fruits . count ( &#39;apple&#39; ) 2 >>> fruits . count ( &#39;tangerine&#39; ) 0 >>> fruits . index ( &#39;banana&#39; ) 3 >>> fruits . index ( &#39;banana&#39; , 4 ) # Find next banana starting at position 4 6 >>> fruits . reverse () >>> fruits [&#39;banana&#39;, &#39;apple&#39;, &#39;kiwi&#39;, &#39;banana&#39;, &#39;pear&#39;, &#39;apple&#39;, &#39;orange&#39;] >>> fruits . append ( &#39;grape&#39; ) >>> fruits [&#39;banana&#39;, &#39;apple&#39;, &#39;kiwi&#39;, &#39;banana&#39;, &#39;pear&#39;, &#39;apple&#39;, &#39;orange&#39;, &#39;grape&#39;] >>> fruits . sort () >>> fruits [&#39;apple&#39;, &#39;apple&#39;, &#39;banana&#39;, &#39;banana&#39;, &#39;grape&#39;, &#39;kiwi&#39;, &#39;orange&#39;, &#39;pear&#39;] >>> fruits . pop () &#39;pear&#39; You might have noticed that methods like insert , remove or sort that only modify the list have no return value printed ‚Äì they return the default None . [ 1 ] This is a design principle for all mutable data structures in Python. Another thing you might notice is that not all data can be sorted or compared. For instance, [None, 'hello', 10] doesn‚Äôt sort because integers can‚Äôt be compared to strings and None can‚Äôt be compared to other types. Also, there are some types that don‚Äôt have a defined ordering relation. For example, 3+4j < 5+7j isn‚Äôt a valid comparison. 5.1.1. Using Lists as Stacks ¬∂ The list methods make it very easy to use a list as a stack, where the last element added is the first element retrieved (‚Äúlast-in, first-out‚Äù). To add an item to the top of the stack, use append() . To retrieve an item from the top of the stack, use pop() without an explicit index. For example: >>> stack = [ 3 , 4 , 5 ] >>> stack . append ( 6 ) >>> stack . append ( 7 ) >>> stack [3, 4, 5, 6, 7] >>> stack . pop () 7 >>> stack [3, 4, 5, 6] >>> stack . pop () 6 >>> stack . pop () 5 >>> stack [3, 4] 5.1.2. Using Lists as Queues ¬∂ It is also possible to use a list as a queue, where the first element added is the first element retrieved (‚Äúfirst-in, first-out‚Äù); however, lists are not efficient for this purpose. While appends and pops from the end of list are fast, doing inserts or pops from the beginning of a list is slow (because all of the other elements have to be shifted by one). To implement a queue, use collections.deque which was designed to have fast appends and pops from both ends. For example: >>> from collections import deque >>> queue = deque ([ \"Eric\" , \"John\" , \"Michael\" ]) >>> queue . append ( \"Terry\" ) # Terry arrives >>> queue . append ( \"Graham\" ) # Graham arrives >>> queue . popleft () # The first to arrive now leaves &#39;Eric&#39; >>> queue . popleft () # The second to arrive now leaves &#39;John&#39; >>> queue # Remaining queue in order of arrival deque([&#39;Michael&#39;, &#39;Terry&#39;, &#39;Graham&#39;]) 5.1.3. List Comprehensions ¬∂ List comprehensions provide a concise way to create lists. Common applications are to make new lists where each element is the result of some operations applied to each member of another sequence or iterable, or to create a subsequence of those elements that satisfy a certain condition. For example, assume we want to create a list of squares, like: >>> squares = [] >>> for x in range ( 10 ): ... squares . append ( x ** 2 ) ... >>> squares [0, 1, 4, 9, 16, 25, 36, 49, 64, 81] Note that this creates (or overwrites) a variable named x that still exists after the loop completes. We can calculate the list of squares without any side effects using: squares = list ( map ( lambda x : x ** 2 , range ( 10 ))) or, equivalently: squares = [ x ** 2 for x in range ( 10 )] which is more concise and readable. A list comprehension consists of brackets containing an expression followed by a for clause, then zero or more for or if clauses. The result will be a new list resulting from evaluating the expression in the context of the for and if clauses which follow it. For example, this listcomp combines the elements of two lists if they are not equal: >>> [( x , y ) for x in [ 1 , 2 , 3 ] for y in [ 3 , 1 , 4 ] if x != y ] [(1, 3), (1, 4), (2, 3), (2, 1), (2, 4), (3, 1), (3, 4)] and it‚Äôs equivalent to: >>> combs = [] >>> for x in [ 1 , 2 , 3 ]: ... for y in [ 3 , 1 , 4 ]: ... if x != y : ... combs . append (( x , y )) ... >>> combs [(1, 3), (1, 4), (2, 3), (2, 1), (2, 4), (3, 1), (3, 4)] Note how the order of the for and if statements is the same in both these snippets. If the expression is a tuple (e.g. the (x, y) in the previous example), it must be parenthesized. >>> vec = [ - 4 , - 2 , 0 , 2 , 4 ] >>> # create a new list with the values doubled >>> [ x * 2 for x in vec ] [-8, -4, 0, 4, 8] >>> # filter the list to exclude negative numbers >>> [ x for x in vec if x >= 0 ] [0, 2, 4] >>> # apply a function to all the elements >>> [ abs ( x ) for x in vec ] [4, 2, 0, 2, 4] >>> # call a method on each element >>> freshfruit = [ &#39; banana&#39; , &#39; loganberry &#39; , &#39;passion fruit &#39; ] >>> [ weapon . strip () for weapon in freshfruit ] [&#39;banana&#39;, &#39;loganberry&#39;, &#39;passion fruit&#39;] >>> # create a list of 2-tuples like (number, square) >>> [( x , x ** 2 ) for x in range ( 6 )] [(0, 0), (1, 1), (2, 4), (3, 9), (4, 16), (5, 25)] >>> # the tuple must be parenthesized, otherwise an error is raised >>> [ x , x ** 2 for x in range ( 6 )] File \"<stdin>\" , line 1 [ x , x ** 2 for x in range ( 6 )] ^^^^^^^ SyntaxError : did you forget parentheses around the comprehension target? >>> # flatten a list using a listcomp with two &#39;for&#39; >>> vec = [[ 1 , 2 , 3 ], [ 4 , 5 , 6 ], [ 7 , 8 , 9 ]] >>> [ num for elem in vec for num in elem ] [1, 2, 3, 4, 5, 6, 7, 8, 9] List comprehensions can contain complex expressions and nested functions: >>> from math import pi >>> [ str ( round ( pi , i )) for i in range ( 1 , 6 )] [&#39;3.1&#39;, &#39;3.14&#39;, &#39;3.142&#39;, &#39;3.1416&#39;, &#39;3.14159&#39;] 5.1.4. Nested List Comprehensions ¬∂ The initial expression in a list comprehension can be any arbitrary expression, including another list comprehension. Consider the following example of a 3x4 matrix implemented as a list of 3 lists of length 4: >>> matrix = [ ... [ 1 , 2 , 3 , 4 ], ... [ 5 , 6 , 7 , 8 ], ... [ 9 , 10 , 11 , 12 ], ... ] The following list comprehension will transpose rows and columns: >>> [[ row [ i ] for row in matrix ] for i in range ( 4 )] [[1, 5, 9], [2, 6, 10], [3, 7, 11], [4, 8, 12]] As we saw in the previous section, the inner list comprehension is evaluated in the context of the for that follows it, so this example is equivalent to: >>> transposed = [] >>> for i in range ( 4 ): ... transposed . append ([ row [ i ] for row in matrix ]) ... >>> transposed [[1, 5, 9], [2, 6, 10], [3, 7, 11], [4, 8, 12]] which, in turn, is the same as: >>> transposed = [] >>> for i in range ( 4 ): ... # the following 3 lines implement the nested listcomp ... transposed_row = [] ... for row in matrix : ... transposed_row . append ( row [ i ]) ... transposed . append ( transposed_row ) ... >>> transposed [[1, 5, 9], [2, 6, 10], [3, 7, 11], [4, 8, 12]] In the real world, you should prefer built-in functions to complex flow statements. The zip() function would do a great job for this use case: >>> list ( zip ( * matrix )) [(1, 5, 9), (2, 6, 10), (3, 7, 11), (4, 8, 12)] See Unpacking Argument Lists for details on the asterisk in this line. 5.2. The del statement ¬∂ There is a way to remove an item from a list given its index instead of its value: the del statement. This differs from the pop() method which returns a value. The del statement can also be used to remove slices from a list or clear the entire list (which we did earlier by assignment of an empty list to the slice). For example: >>> a = [ - 1 , 1 , 66.25 , 333 , 333 , 1234.5 ] >>> del a [ 0 ] >>> a [1, 66.25, 333, 333, 1234.5] >>> del a [ 2 : 4 ] >>> a [1, 66.25, 1234.5] >>> del a [:] >>> a [] del can also be used to delete entire variables: >>> del a Referencing the name a hereafter is an error (at least until another value is assigned to it). We‚Äôll find other uses for del later. 5.3. Tuples and Sequences ¬∂ We saw that lists and strings have many common properties, such as indexing and slicing operations. They are two examples of sequence data types (see Sequence Types ‚Äî list, tuple, range ). Since Python is an evolving language, other sequence data types may be added. There is also another standard sequence data type: the tuple . A tuple consists of a number of values separated by commas, for instance: >>> t = 12345 , 54321 , &#39;hello!&#39; >>> t [ 0 ] 12345 >>> t (12345, 54321, &#39;hello!&#39;) >>> # Tuples may be nested: >>> u = t , ( 1 , 2 , 3 , 4 , 5 ) >>> u ((12345, 54321, &#39;hello!&#39;), (1, 2, 3, 4, 5)) >>> # Tuples are immutable: >>> t [ 0 ] = 88888 Traceback (most recent call last): File \"<stdin>\" , line 1 , in <module> TypeError : &#39;tuple&#39; object does not support item assignment >>> # but they can contain mutable objects: >>> v = ([ 1 , 2 , 3 ], [ 3 , 2 , 1 ]) >>> v ([1, 2, 3], [3, 2, 1]) As you see, on output tuples are always enclosed in parentheses, so that nested tuples are interpreted correctly; they may be input with or without surrounding parentheses, although often parentheses are necessary anyway (if the tuple is part of a larger expression). It is not possible to assign to the individual items of a tuple, however it is possible to create tuples which contain mutable objects, such as lists. Though tuples may seem similar to lists, they are often used in different situations and for different purposes. Tuples are immutable , and usually contain a heterogeneous sequence of elements that are accessed via unpacking (see later in this section) or indexing (or even by attribute in the case of namedtuples ). Lists are mutable , and their elements are usually homogeneous and are accessed by iterating over the list. A special problem is the construction of tuples containing 0 or 1 items: the syntax has some extra quirks to accommodate these. Empty tuples are constructed by an empty pair of parentheses; a tuple with one item is constructed by following a value with a comma (it is not sufficient to enclose a single value in parentheses). Ugly, but effective. For example: >>> empty = () >>> singleton = &#39;hello&#39; , # <-- note trailing comma >>> len ( empty ) 0 >>> len ( singleton ) 1 >>> singleton (&#39;hello&#39;,) The statement t = 12345, 54321, 'hello!' is an example of tuple packing : the values 12345 , 54321 and 'hello!' are packed together in a tuple. The reverse operation is also possible: >>> x , y , z = t This is called, appropriately enough, sequence unpacking and works for any sequence on the right-hand side. Sequence unpacking requires that there are as many variables on the left side of the equals sign as there are elements in the sequence. Note that multiple assignment is really just a combination of tuple packing and sequence unpacking. 5.4. Sets ¬∂ Python also includes a data type for sets . A set is an unordered collection with no duplicate elements. Basic uses include membership testing and eliminating duplicate entries. Set objects also support mathematical operations like union, intersection, difference, and symmetric difference. Curly braces or the set() function can be used to create sets. Note: to create an empty set you have to use set() , not {} ; the latter creates an empty dictionary, a data structure that we discuss in the next section. Here is a brief demonstration: >>> basket = { &#39;apple&#39; , &#39;orange&#39; , &#39;apple&#39; , &#39;pear&#39; , &#39;orange&#39; , &#39;banana&#39; } >>> print ( basket ) # show that duplicates have been removed {&#39;orange&#39;, &#39;banana&#39;, &#39;pear&#39;, &#39;apple&#39;} >>> &#39;orange&#39; in basket # fast membership testing True >>> &#39;crabgrass&#39; in basket False >>> # Demonstrate set operations on unique letters from two words >>> >>> a = set ( &#39;abracadabra&#39; ) >>> b = set ( &#39;alacazam&#39; ) >>> a # unique letters in a {&#39;a&#39;, &#39;r&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;} >>> a - b # letters in a but not in b {&#39;r&#39;, &#39;d&#39;, &#39;b&#39;} >>> a | b # letters in a or b or both {&#39;a&#39;, &#39;c&#39;, &#39;r&#39;, &#39;d&#39;, &#39;b&#39;, &#39;m&#39;, &#39;z&#39;, &#39;l&#39;} >>> a & b # letters in both a and b {&#39;a&#39;, &#39;c&#39;} >>> a ^ b # letters in a or b but not both {&#39;r&#39;, &#39;d&#39;, &#39;b&#39;, &#39;m&#39;, &#39;z&#39;, &#39;l&#39;} Similarly to list comprehensions , set comprehensions are also supported: >>> a = { x for x in &#39;abracadabra&#39; if x not in &#39;abc&#39; } >>> a {&#39;r&#39;, &#39;d&#39;} 5.5. Dictionaries ¬∂ Another useful data type built into Python is the dictionary (see Mapping Types ‚Äî dict ). Dictionaries are sometimes found in other languages as ‚Äúassociative memories‚Äù or ‚Äúassociative arrays‚Äù. Unlike sequences, which are indexed by a range of numbers, dictionaries are indexed by keys , which can be any immutable type; strings and numbers can always be keys. Tuples can be used as keys if they contain only strings, numbers, or tuples; if a tuple contains any mutable object either directly or indirectly, it cannot be used as a key. You can‚Äôt use lists as keys, since lists can be modified in place using index assignments, slice assignments, or methods like append() and extend() . It is best to think of a dictionary as a set of key: value pairs, with the requirement that the keys are unique (within one dictionary). A pair of braces creates an empty dictionary: {} . Placing a comma-separated list of key:value pairs within the braces adds initial key:value pairs to the dictionary; this is also the way dictionaries are written on output. The main operations on a dictionary are storing a value with some key and extracting the value given the key. It is also possible to delete a key:value pair with del . If you store using a key that is already in use, the old value associated with that key is forgotten. Extracting a value for a non-existent key by subscripting ( d[key] ) raises a KeyError . To avoid getting this error when trying to access a possibly non-existent key, use the get() method instead, which returns None (or a specified default value) if the key is not in the dictionary. Performing list(d) on a dictionary returns a list of all the keys used in the dictionary, in insertion order (if you want it sorted, just use sorted(d) instead). To check whether a single key is in the dictionary, use the in keyword. Here is a small example using a dictionary: >>> tel = { &#39;jack&#39; : 4098 , &#39;sape&#39; : 4139 } >>> tel [ &#39;guido&#39; ] = 4127 >>> tel {&#39;jack&#39;: 4098, &#39;sape&#39;: 4139, &#39;guido&#39;: 4127} >>> tel [ &#39;jack&#39; ] 4098 >>> tel [ &#39;irv&#39; ] Traceback (most recent call last): File \"<stdin>\" , line 1 , in <module> KeyError : &#39;irv&#39; >>> print ( tel . get ( &#39;irv&#39; )) None >>> del tel [ &#39;sape&#39; ] >>> tel [ &#39;irv&#39; ] = 4127 >>> tel {&#39;jack&#39;: 4098, &#39;guido&#39;: 4127, &#39;irv&#39;: 4127} >>> list ( tel ) [&#39;jack&#39;, &#39;guido&#39;, &#39;irv&#39;] >>> sorted ( tel ) [&#39;guido&#39;, &#39;irv&#39;, &#39;jack&#39;] >>> &#39;guido&#39; in tel True >>> &#39;jack&#39; not in tel False The dict() constructor builds dictionaries directly from sequences of key-value pairs: >>> dict ([( &#39;sape&#39; , 4139 ), ( &#39;guido&#39; , 4127 ), ( &#39;jack&#39; , 4098 )]) {&#39;sape&#39;: 4139, &#39;guido&#39;: 4127, &#39;jack&#39;: 4098} In addition, dict comprehensions can be used to create dictionaries from arbitrary key and value expressions: >>> { x : x ** 2 for x in ( 2 , 4 , 6 )} {2: 4, 4: 16, 6: 36} When the keys are simple strings, it is sometimes easier to specify pairs using keyword arguments: >>> dict ( sape = 4139 , guido = 4127 , jack = 4098 ) {&#39;sape&#39;: 4139, &#39;guido&#39;: 4127, &#39;jack&#39;: 4098} 5.6. Looping Techniques ¬∂ When looping through dictionaries, the key and corresponding value can be retrieved at the same time using the items() method. >>> knights = { &#39;gallahad&#39; : &#39;the pure&#39; , &#39;robin&#39; : &#39;the brave&#39; } >>> for k , v in knights . items (): ... print ( k , v ) ... gallahad the pure robin the brave When looping through a sequence, the position index and corresponding value can be retrieved at the same time using the enumerate() function. >>> for i , v in enumerate ([ &#39;tic&#39; , &#39;tac&#39; , &#39;toe&#39; ]): ... print ( i , v ) ... 0 tic 1 tac 2 toe To loop over two or more sequences at the same time, the entries can be paired with the zip() function. >>> questions = [ &#39;name&#39; , &#39;quest&#39; , &#39;favorite color&#39; ] >>> answers = [ &#39;lancelot&#39; , &#39;the holy grail&#39; , &#39;blue&#39; ] >>> for q , a in zip ( questions , answers ): ... print ( &#39;What is your {0} ? It is {1} .&#39; . format ( q , a )) ... What is your name? It is lancelot. What is your quest? It is the holy grail. What is your favorite color? It is blue. To loop over a sequence in reverse, first specify the sequence in a forward direction and then call the reversed() function. >>> for i in reversed ( range ( 1 , 10 , 2 )): ... print ( i ) ... 9 7 5 3 1 To loop over a sequence in sorted order, use the sorted() function which returns a new sorted list while leaving the source unaltered. >>> basket = [ &#39;apple&#39; , &#39;orange&#39; , &#39;apple&#39; , &#39;pear&#39; , &#39;orange&#39; , &#39;banana&#39; ] >>> for i in sorted ( basket ): ... print ( i ) ... apple apple banana orange orange pear Using set() on a sequence eliminates duplicate elements. The use of sorted() in combination with set() over a sequence is an idiomatic way to loop over unique elements of the sequence in sorted order. >>> basket = [ &#39;apple&#39; , &#39;orange&#39; , &#39;apple&#39; , &#39;pear&#39; , &#39;orange&#39; , &#39;banana&#39; ] >>> for f in sorted ( set ( basket )): ... print ( f ) ... apple banana orange pear It is sometimes tempting to change a list while you are looping over it; however, it is often simpler and safer to create a new list instead. >>> import math >>> raw_data = [ 56.2 , float ( &#39;NaN&#39; ), 51.7 , 55.3 , 52.5 , float ( &#39;NaN&#39; ), 47.8 ] >>> filtered_data = [] >>> for value in raw_data : ... if not math . isnan ( value ): ... filtered_data . append ( value ) ... >>> filtered_data [56.2, 51.7, 55.3, 52.5, 47.8] 5.7. More on Conditions ¬∂ The conditions used in while and if statements can contain any operators, not just comparisons. The comparison operators in and not in are membership tests that determine whether a value is in (or not in) a container. The operators is and is not compare whether two objects are really the same object. All comparison operators have the same priority, which is lower than that of all numerical operators. Comparisons can be chained. For example, a < b == c tests whether a is less than b and moreover b equals c . Comparisons may be combined using the Boolean operators and and or , and the outcome of a comparison (or of any other Boolean expression) may be negated with not . These have lower priorities than comparison operators; between them, not has the highest priority and or the lowest, so that A and not B or C is equivalent to (A and (not B)) or C . As always, parentheses can be used to express the desired composition. The Boolean operators and and or are so-called short-circuit operators: their arguments are evaluated from left to right, and evaluation stops as soon as the outcome is determined. For example, if A and C are true but B is false, A and B and C does not evaluate the expression C . When used as a general value and not as a Boolean, the return value of a short-circuit operator is the last evaluated argument. It is possible to assign the result of a comparison or other Boolean expression to a variable. For example, >>> string1 , string2 , string3 = &#39;&#39; , &#39;Trondheim&#39; , &#39;Hammer Dance&#39; >>> non_null = string1 or string2 or string3 >>> non_null &#39;Trondheim&#39; Note that in Python, unlike C, assignment inside expressions must be done explicitly with the walrus operator := . This avoids a common class of problems encountered in C programs: typing = in an expression when == was intended. 5.8. Comparing Sequences and Other Types ¬∂ Sequence objects typically may be compared to other objects with the same sequence type. The comparison uses lexicographical ordering: first the first two items are compared, and if they differ this determines the outcome of the comparison; if they are equal, the next two items are compared, and so on, until either sequence is exhausted. If two items to be compared are themselves sequences of the same type, the lexicographical comparison is carried out recursively. If all items of two sequences compare equal, the sequences are considered equal. If one sequence is an initial sub-sequence of the other, the shorter sequence is the smaller (lesser) one. Lexicographical ordering for strings uses the Unicode code point number to order individual characters. Some examples of comparisons between sequences of the same type: ( 1 , 2 , 3 ) < ( 1 , 2 , 4 ) [ 1 , 2 , 3 ] < [ 1 , 2 , 4 ] &#39;ABC&#39; < &#39;C&#39; < &#39;Pascal&#39; < &#39;Python&#39; ( 1 , 2 , 3 , 4 ) < ( 1 , 2 , 4 ) ( 1 , 2 ) < ( 1 , 2 , - 1 ) ( 1 , 2 , 3 ) == ( 1.0 , 2.0 , 3.0 ) ( 1 , 2 , ( &#39;aa&#39; , &#39;ab&#39; )) < ( 1 , 2 , ( &#39;abc&#39; , &#39;a&#39; ), 4 ) Note that comparing objects of different types with < or > is legal provided that the objects have appropriate comparison methods. For example, mixed numeric types are compared according to their numeric value, so 0 equals 0.0, etc. Otherwise, rather than providing an arbitrary ordering, the interpreter will raise a TypeError exception. Footnotes [ 1 ] Other languages may return the mutated object, which allows method chaining, such as d->insert(\"a\")->remove(\"b\")->sort(); . Table of Contents 5. Data Structures 5.1. More on Lists 5.1.1. Using Lists as Stacks 5.1.2. Using Lists as Queues 5.1.3. List Comprehensions 5.1.4. Nested List Comprehensions 5.2. The del statement 5.3. Tuples and Sequences 5.4. Sets 5.5. Dictionaries 5.6. Looping Techniques 5.7. More on Conditions 5.8. Comparing Sequences and Other Types Previous topic 4. More Control Flow Tools Next topic 6. Modules This page Report a bug Show source ¬´ Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Tutorial &#187; 5. Data Structures | Theme Auto Light Dark | &copy; Copyright 2001 Python Software Foundation. This page is licensed under the Python Software Foundation License Version 2. Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License. See History and License for more information. The Python Software Foundation is a non-profit corporation. Please donate. Last updated on Jan 02, 2026 (19:26 UTC). Found a bug ? Created using Sphinx 8.2.3.",
      "chunk_ids": [],
      "metadata": {
        "url": "https://docs.python.org/3/tutorial/datastructures.html",
        "title": "5. Data Structures &#8212; Python 3.14.2 documentation"
      },
      "is_distractor": false,
      "semantic_tags": [
        "documentation",
        "python"
      ],
      "content_hash": "ff7f650a8568d264",
      "size_bytes": 25860,
      "created_at": "2026-01-02T20:42:12.443269"
    },
    {
      "doc_id": "online_docs_python_org_3_library_functions_html",
      "source": "online",
      "category": "technical",
      "domain": "python",
      "file_path": "https://docs.python.org/3/library/functions.html",
      "content": "Built-in Functions &#8212; Python 3.14.2 documentation Theme Auto Light Dark Previous topic Introduction Next topic Built-in Constants This page Report a bug Show source Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Standard Library &#187; Built-in Functions | Theme Auto Light Dark | Built-in Functions ¬∂ The Python interpreter has a number of functions and types built into it that are always available. They are listed here in alphabetical order. Built-in Functions A abs() aiter() all() anext() any() ascii() B bin() bool() breakpoint() bytearray() bytes() C callable() chr() classmethod() compile() complex() D delattr() dict() dir() divmod() E enumerate() eval() exec() F filter() float() format() frozenset() G getattr() globals() H hasattr() hash() help() hex() I id() input() int() isinstance() issubclass() iter() L len() list() locals() M map() max() memoryview() min() N next() O object() oct() open() ord() P pow() print() property() R range() repr() reversed() round() S set() setattr() slice() sorted() staticmethod() str() sum() super() T tuple() type() V vars() Z zip() _ __import__() abs ( number , / ) ¬∂ Return the absolute value of a number. The argument may be an integer, a floating-point number, or an object implementing __abs__() . If the argument is a complex number, its magnitude is returned. aiter ( async_iterable , / ) ¬∂ Return an asynchronous iterator for an asynchronous iterable . Equivalent to calling x.__aiter__() . Note: Unlike iter() , aiter() has no 2-argument variant. Added in version 3.10. all ( iterable , / ) ¬∂ Return True if all elements of the iterable are true (or if the iterable is empty). Equivalent to: def all ( iterable ): for element in iterable : if not element : return False return True awaitable anext ( async_iterator , / ) ¬∂ awaitable anext ( async_iterator , default , / ) When awaited, return the next item from the given asynchronous iterator , or default if given and the iterator is exhausted. This is the async variant of the next() builtin, and behaves similarly. This calls the __anext__() method of async_iterator , returning an awaitable . Awaiting this returns the next value of the iterator. If default is given, it is returned if the iterator is exhausted, otherwise StopAsyncIteration is raised. Added in version 3.10. any ( iterable , / ) ¬∂ Return True if any element of the iterable is true. If the iterable is empty, return False . Equivalent to: def any ( iterable ): for element in iterable : if element : return True return False ascii ( object , / ) ¬∂ As repr() , return a string containing a printable representation of an object, but escape the non-ASCII characters in the string returned by repr() using \\x , \\u , or \\U escapes. This generates a string similar to that returned by repr() in Python 2. bin ( integer , / ) ¬∂ Convert an integer number to a binary string prefixed with ‚Äú0b‚Äù. The result is a valid Python expression. If integer is not a Python int object, it has to define an __index__() method that returns an integer. Some examples: >>> bin ( 3 ) &#39;0b11&#39; >>> bin ( - 10 ) &#39;-0b1010&#39; If the prefix ‚Äú0b‚Äù is desired or not, you can use either of the following ways. >>> format ( 14 , &#39;#b&#39; ), format ( 14 , &#39;b&#39; ) (&#39;0b1110&#39;, &#39;1110&#39;) >>> f &#39; { 14 : #b } &#39; , f &#39; { 14 : b } &#39; (&#39;0b1110&#39;, &#39;1110&#39;) See also format() for more information. class bool ( object = False , / ) ¬∂ Return a Boolean value, i.e. one of True or False . The argument is converted using the standard truth testing procedure . If the argument is false or omitted, this returns False ; otherwise, it returns True . The bool class is a subclass of int (see Numeric Types ‚Äî int, float, complex ). It cannot be subclassed further. Its only instances are False and True (see Boolean Type - bool ). Changed in version 3.7: The parameter is now positional-only. breakpoint ( * args , ** kws ) ¬∂ This function drops you into the debugger at the call site. Specifically, it calls sys.breakpointhook() , passing args and kws straight through. By default, sys.breakpointhook() calls pdb.set_trace() expecting no arguments. In this case, it is purely a convenience function so you don‚Äôt have to explicitly import pdb or type as much code to enter the debugger. However, sys.breakpointhook() can be set to some other function and breakpoint() will automatically call that, allowing you to drop into the debugger of choice. If sys.breakpointhook() is not accessible, this function will raise RuntimeError . By default, the behavior of breakpoint() can be changed with the PYTHONBREAKPOINT environment variable. See sys.breakpointhook() for usage details. Note that this is not guaranteed if sys.breakpointhook() has been replaced. Raises an auditing event builtins.breakpoint with argument breakpointhook . Added in version 3.7. class bytearray ( source = b'' ) class bytearray ( source , encoding , errors = 'strict' ) Return a new array of bytes. The bytearray class is a mutable sequence of integers in the range 0 <= x < 256. It has most of the usual methods of mutable sequences, described in Mutable Sequence Types , as well as most methods that the bytes type has, see Bytes and Bytearray Operations . The optional source parameter can be used to initialize the array in a few different ways: If it is a string , you must also give the encoding (and optionally, errors ) parameters; bytearray() then converts the string to bytes using str.encode() . If it is an integer , the array will have that size and will be initialized with null bytes. If it is an object conforming to the buffer interface , a read-only buffer of the object will be used to initialize the bytes array. If it is an iterable , it must be an iterable of integers in the range 0 <= x < 256 , which are used as the initial contents of the array. Without an argument, an array of size 0 is created. See also Binary Sequence Types ‚Äî bytes, bytearray, memoryview and Bytearray Objects . class bytes ( source = b'' ) class bytes ( source , encoding , errors = 'strict' ) Return a new ‚Äúbytes‚Äù object which is an immutable sequence of integers in the range 0 <= x < 256 . bytes is an immutable version of bytearray ‚Äì it has the same non-mutating methods and the same indexing and slicing behavior. Accordingly, constructor arguments are interpreted as for bytearray() . Bytes objects can also be created with literals, see String and Bytes literals . See also Binary Sequence Types ‚Äî bytes, bytearray, memoryview , Bytes Objects , and Bytes and Bytearray Operations . callable ( object , / ) ¬∂ Return True if the object argument appears callable, False if not. If this returns True , it is still possible that a call fails, but if it is False , calling object will never succeed. Note that classes are callable (calling a class returns a new instance); instances are callable if their class has a __call__() method. Added in version 3.2: This function was first removed in Python 3.0 and then brought back in Python 3.2. chr ( codepoint , / ) ¬∂ Return the string representing a character with the specified Unicode code point. For example, chr(97) returns the string 'a' , while chr(8364) returns the string '‚Ç¨' . This is the inverse of ord() . The valid range for the argument is from 0 through 1,114,111 (0x10FFFF in base 16). ValueError will be raised if it is outside that range. &#64; classmethod ¬∂ Transform a method into a class method. A class method receives the class as an implicit first argument, just like an instance method receives the instance. To declare a class method, use this idiom: class C : @classmethod def f ( cls , arg1 , arg2 ): ... The &#64;classmethod form is a function decorator ‚Äì see Function definitions for details. A class method can be called either on the class (such as C.f() ) or on an instance (such as C().f() ). The instance is ignored except for its class. If a class method is called for a derived class, the derived class object is passed as the implied first argument. Class methods are different than C++ or Java static methods. If you want those, see staticmethod() in this section. For more information on class methods, see The standard type hierarchy . Changed in version 3.9: Class methods can now wrap other descriptors such as property() . Changed in version 3.10: Class methods now inherit the method attributes ( __module__ , __name__ , __qualname__ , __doc__ and __annotations__ ) and have a new __wrapped__ attribute. Deprecated since version 3.11, removed in version 3.13: Class methods can no longer wrap other descriptors such as property() . compile ( source , filename , mode , flags = 0 , dont_inherit = False , optimize = -1 ) ¬∂ Compile the source into a code or AST object. Code objects can be executed by exec() or eval() . source can either be a normal string, a byte string, or an AST object. Refer to the ast module documentation for information on how to work with AST objects. The filename argument should give the file from which the code was read; pass some recognizable value if it wasn‚Äôt read from a file ( '<string>' is commonly used). The mode argument specifies what kind of code must be compiled; it can be 'exec' if source consists of a sequence of statements, 'eval' if it consists of a single expression, or 'single' if it consists of a single interactive statement (in the latter case, expression statements that evaluate to something other than None will be printed). The optional arguments flags and dont_inherit control which compiler options should be activated and which future features should be allowed. If neither is present (or both are zero) the code is compiled with the same flags that affect the code that is calling compile() . If the flags argument is given and dont_inherit is not (or is zero) then the compiler options and the future statements specified by the flags argument are used in addition to those that would be used anyway. If dont_inherit is a non-zero integer then the flags argument is it ‚Äì the flags (future features and compiler options) in the surrounding code are ignored. Compiler options and future statements are specified by bits which can be bitwise ORed together to specify multiple options. The bitfield required to specify a given future feature can be found as the compiler_flag attribute on the _Feature instance in the __future__ module. Compiler flags can be found in ast module, with PyCF_ prefix. The argument optimize specifies the optimization level of the compiler; the default value of -1 selects the optimization level of the interpreter as given by -O options. Explicit levels are 0 (no optimization; __debug__ is true), 1 (asserts are removed, __debug__ is false) or 2 (docstrings are removed too). This function raises SyntaxError or ValueError if the compiled source is invalid. If you want to parse Python code into its AST representation, see ast.parse() . Raises an auditing event compile with arguments source and filename . This event may also be raised by implicit compilation. Note When compiling a string with multi-line code in 'single' or 'eval' mode, input must be terminated by at least one newline character. This is to facilitate detection of incomplete and complete statements in the code module. Warning It is possible to crash the Python interpreter with a sufficiently large/complex string when compiling to an AST object due to stack depth limitations in Python‚Äôs AST compiler. Changed in version 3.2: Allowed use of Windows and Mac newlines. Also, input in 'exec' mode does not have to end in a newline anymore. Added the optimize parameter. Changed in version 3.5: Previously, TypeError was raised when null bytes were encountered in source . Added in version 3.8: ast.PyCF_ALLOW_TOP_LEVEL_AWAIT can now be passed in flags to enable support for top-level await , async for , and async with . class complex ( number = 0 , / ) ¬∂ class complex ( string , / ) class complex ( real = 0 , imag = 0 ) Convert a single string or number to a complex number, or create a complex number from real and imaginary parts. Examples: >>> complex ( &#39;+1.23&#39; ) (1.23+0j) >>> complex ( &#39;-4.5j&#39; ) -4.5j >>> complex ( &#39;-1.23+4.5j&#39; ) (-1.23+4.5j) >>> complex ( &#39; \\t ( -1.23+4.5J ) \\n &#39; ) (-1.23+4.5j) >>> complex ( &#39;-Infinity+NaNj&#39; ) (-inf+nanj) >>> complex ( 1.23 ) (1.23+0j) >>> complex ( imag =- 4.5 ) -4.5j >>> complex ( - 1.23 , 4.5 ) (-1.23+4.5j) If the argument is a string, it must contain either a real part (in the same format as for float() ) or an imaginary part (in the same format but with a 'j' or 'J' suffix), or both real and imaginary parts (the sign of the imaginary part is mandatory in this case). The string can optionally be surrounded by whitespaces and the round parentheses '(' and ')' , which are ignored. The string must not contain whitespace between '+' , '-' , the 'j' or 'J' suffix, and the decimal number. For example, complex('1+2j') is fine, but complex('1 + 2j') raises ValueError . More precisely, the input must conform to the complexvalue production rule in the following grammar, after parentheses and leading and trailing whitespace characters are removed: complexvalue : floatvalue | floatvalue ( \"j\" | \"J\" ) | floatvalue sign absfloatvalue ( \"j\" | \"J\" ) If the argument is a number, the constructor serves as a numeric conversion like int and float . For a general Python object x , complex(x) delegates to x.__complex__() . If __complex__() is not defined then it falls back to __float__() . If __float__() is not defined then it falls back to __index__() . If two arguments are provided or keyword arguments are used, each argument may be any numeric type (including complex). If both arguments are real numbers, return a complex number with the real component real and the imaginary component imag . If both arguments are complex numbers, return a complex number with the real component real.real-imag.imag and the imaginary component real.imag+imag.real . If one of arguments is a real number, only its real component is used in the above expressions. See also complex.from_number() which only accepts a single numeric argument. If all arguments are omitted, returns 0j . The complex type is described in Numeric Types ‚Äî int, float, complex . Changed in version 3.6: Grouping digits with underscores as in code literals is allowed. Changed in version 3.8: Falls back to __index__() if __complex__() and __float__() are not defined. Deprecated since version 3.14: Passing a complex number as the real or imag argument is now deprecated; it should only be passed as a single positional argument. delattr ( object , name , / ) ¬∂ This is a relative of setattr() . The arguments are an object and a string. The string must be the name of one of the object‚Äôs attributes. The function deletes the named attribute, provided the object allows it. For example, delattr(x, 'foobar') is equivalent to del x.foobar . name need not be a Python identifier (see setattr() ). class dict ( ** kwargs ) class dict ( mapping , / , ** kwargs ) class dict ( iterable , / , ** kwargs ) Create a new dictionary. The dict object is the dictionary class. See dict and Mapping Types ‚Äî dict for documentation about this class. For other containers see the built-in list , set , and tuple classes, as well as the collections module. dir ( ) ¬∂ dir ( object , / ) Without arguments, return the list of names in the current local scope. With an argument, attempt to return a list of valid attributes for that object. If the object has a method named __dir__() , this method will be called and must return the list of attributes. This allows objects that implement a custom __getattr__() or __getattribute__() function to customize the way dir() reports their attributes. If the object does not provide __dir__() , the function tries its best to gather information from the object‚Äôs __dict__ attribute, if defined, and from its type object. The resulting list is not necessarily complete and may be inaccurate when the object has a custom __getattr__() . The default dir() mechanism behaves differently with different types of objects, as it attempts to produce the most relevant, rather than complete, information: If the object is a module object, the list contains the names of the module‚Äôs attributes. If the object is a type or class object, the list contains the names of its attributes, and recursively of the attributes of its bases. Otherwise, the list contains the object‚Äôs attributes‚Äô names, the names of its class‚Äôs attributes, and recursively of the attributes of its class‚Äôs base classes. The resulting list is sorted alphabetically. For example: >>> import struct >>> dir () # show the names in the module namespace [&#39;__builtins__&#39;, &#39;__name__&#39;, &#39;struct&#39;] >>> dir ( struct ) # show the names in the struct module [&#39;Struct&#39;, &#39;__all__&#39;, &#39;__builtins__&#39;, &#39;__cached__&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__initializing__&#39;, &#39;__loader__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;_clearcache&#39;, &#39;calcsize&#39;, &#39;error&#39;, &#39;pack&#39;, &#39;pack_into&#39;, &#39;unpack&#39;, &#39;unpack_from&#39;] >>> class Shape : ... def __dir__ ( self ): ... return [ &#39;area&#39; , &#39;perimeter&#39; , &#39;location&#39; ] ... >>> s = Shape () >>> dir ( s ) [&#39;area&#39;, &#39;location&#39;, &#39;perimeter&#39;] Note Because dir() is supplied primarily as a convenience for use at an interactive prompt, it tries to supply an interesting set of names more than it tries to supply a rigorously or consistently defined set of names, and its detailed behavior may change across releases. For example, metaclass attributes are not in the result list when the argument is a class. divmod ( a , b , / ) ¬∂ Take two (non-complex) numbers as arguments and return a pair of numbers consisting of their quotient and remainder when using integer division. With mixed operand types, the rules for binary arithmetic operators apply. For integers, the result is the same as (a // b, a % b) . For floating-point numbers the result is (q, a % b) , where q is usually math.floor(a / b) but may be 1 less than that. In any case q * b + a % b is very close to a , if a % b is non-zero it has the same sign as b , and 0 <= abs(a % b) < abs(b) . enumerate ( iterable , start = 0 ) ¬∂ Return an enumerate object. iterable must be a sequence, an iterator , or some other object which supports iteration. The __next__() method of the iterator returned by enumerate() returns a tuple containing a count (from start which defaults to 0) and the values obtained from iterating over iterable . >>> seasons = [ &#39;Spring&#39; , &#39;Summer&#39; , &#39;Fall&#39; , &#39;Winter&#39; ] >>> list ( enumerate ( seasons )) [(0, &#39;Spring&#39;), (1, &#39;Summer&#39;), (2, &#39;Fall&#39;), (3, &#39;Winter&#39;)] >>> list ( enumerate ( seasons , start = 1 )) [(1, &#39;Spring&#39;), (2, &#39;Summer&#39;), (3, &#39;Fall&#39;), (4, &#39;Winter&#39;)] Equivalent to: def enumerate ( iterable , start = 0 ): n = start for elem in iterable : yield n , elem n += 1 eval ( source , / , globals = None , locals = None ) ¬∂ Parameters : source ( str | code object ) ‚Äì A Python expression. globals ( dict | None ) ‚Äì The global namespace (default: None ). locals ( mapping | None ) ‚Äì The local namespace (default: None ). Returns : The result of the evaluated expression. Raises : Syntax errors are reported as exceptions. Warning This function executes arbitrary code. Calling it with user-supplied input may lead to security vulnerabilities. The source argument is parsed and evaluated as a Python expression (technically speaking, a condition list) using the globals and locals mappings as global and local namespace. If the globals dictionary is present and does not contain a value for the key __builtins__ , a reference to the dictionary of the built-in module builtins is inserted under that key before source is parsed. That way you can control what builtins are available to the executed code by inserting your own __builtins__ dictionary into globals before passing it to eval() . If the locals mapping is omitted it defaults to the globals dictionary. If both mappings are omitted, the source is executed with the globals and locals in the environment where eval() is called. Note, eval() will only have access to the nested scopes (non-locals) in the enclosing environment if they are already referenced in the scope that is calling eval() (e.g. via a nonlocal statement). Example: >>> x = 1 >>> eval ( &#39;x+1&#39; ) 2 This function can also be used to execute arbitrary code objects (such as those created by compile() ). In this case, pass a code object instead of a string. If the code object has been compiled with 'exec' as the mode argument, eval() 's return value will be None . Hints: dynamic execution of statements is supported by the exec() function. The globals() and locals() functions return the current global and local dictionary, respectively, which may be useful to pass around for use by eval() or exec() . If the given source is a string, then leading and trailing spaces and tabs are stripped. See ast.literal_eval() for a function that can safely evaluate strings with expressions containing only literals. Raises an auditing event exec with the code object as the argument. Code compilation events may also be raised. Changed in version 3.13: The globals and locals arguments can now be passed as keywords. Changed in version 3.13: The semantics of the default locals namespace have been adjusted as described for the locals() builtin. exec ( source , / , globals = None , locals = None , * , closure = None ) ¬∂ Warning This function executes arbitrary code. Calling it with user-supplied input may lead to security vulnerabilities. This function supports dynamic execution of Python code. source must be either a string or a code object. If it is a string, the string is parsed as a suite of Python statements which is then executed (unless a syntax error occurs). [ 1 ] If it is a code object, it is simply executed. In all cases, the code that‚Äôs executed is expected to be valid as file input (see the section File input in the Reference Manual). Be aware that the nonlocal , yield , and return statements may not be used outside of function definitions even within the context of code passed to the exec() function. The return value is None . In all cases, if the optional parts are omitted, the code is executed in the current scope. If only globals is provided, it must be a dictionary (and not a subclass of dictionary), which will be used for both the global and the local variables. If globals and locals are given, they are used for the global and local variables, respectively. If provided, locals can be any mapping object. Remember that at the module level, globals and locals are the same dictionary. Note When exec gets two separate objects as globals and locals , the code will be executed as if it were embedded in a class definition. This means functions and classes defined in the executed code will not be able to access variables assigned at the top level (as the ‚Äútop level‚Äù variables are treated as class variables in a class definition). If the globals dictionary does not contain a value for the key __builtins__ , a reference to the dictionary of the built-in module builtins is inserted under that key. That way you can control what builtins are available to the executed code by inserting your own __builtins__ dictionary into globals before passing it to exec() . The closure argument specifies a closure‚Äìa tuple of cellvars. It‚Äôs only valid when the object is a code object containing free (closure) variables . The length of the tuple must exactly match the length of the code object‚Äôs co_freevars attribute. Raises an auditing event exec with the code object as the argument. Code compilation events may also be raised. Note The built-in functions globals() and locals() return the current global and local namespace, respectively, which may be useful to pass around for use as the second and third argument to exec() . Note The default locals act as described for function locals() below. Pass an explicit locals dictionary if you need to see effects of the code on locals after function exec() returns. Changed in version 3.11: Added the closure parameter. Changed in version 3.13: The globals and locals arguments can now be passed as keywords. Changed in version 3.13: The semantics of the default locals namespace have been adjusted as described for the locals() builtin. filter ( function , iterable , / ) ¬∂ Construct an iterator from those elements of iterable for which function is true. iterable may be either a sequence, a container which supports iteration, or an iterator. If function is None , the identity function is assumed, that is, all elements of iterable that are false are removed. Note that filter(function, iterable) is equivalent to the generator expression (item for item in iterable if function(item)) if function is not None and (item for item in iterable if item) if function is None . See itertools.filterfalse() for the complementary function that returns elements of iterable for which function is false. class float ( number = 0.0 , / ) ¬∂ class float ( string , / ) Return a floating-point number constructed from a number or a string. Examples: >>> float ( &#39;+1.23&#39; ) 1.23 >>> float ( &#39; -12345 \\n &#39; ) -12345.0 >>> float ( &#39;1e-003&#39; ) 0.001 >>> float ( &#39;+1E6&#39; ) 1000000.0 >>> float ( &#39;-Infinity&#39; ) -inf If the argument is a string, it should contain a decimal number, optionally preceded by a sign, and optionally embedded in whitespace. The optional sign may be '+' or '-' ; a '+' sign has no effect on the value produced. The argument may also be a string representing a NaN (not-a-number), or positive or negative infinity. More precisely, the input must conform to the floatvalue production rule in the following grammar, after leading and trailing whitespace characters are removed: sign : \"+\" | \"-\" infinity : \"Infinity\" | \"inf\" nan : \"nan\" digit : <a Unicode decimal digit, i.e. characters in Unicode general category Nd> digitpart : digit ([ \"_\" ] digit )* number : [ digitpart ] \".\" digitpart | digitpart [ \".\" ] exponent : ( \"e\" | \"E\" ) [ sign ] digitpart floatnumber : number [ exponent ] absfloatvalue : floatnumber | infinity | nan floatvalue : [ sign ] absfloatvalue Case is not significant, so, for example, ‚Äúinf‚Äù, ‚ÄúInf‚Äù, ‚ÄúINFINITY‚Äù, and ‚ÄúiNfINity‚Äù are all acceptable spellings for positive infinity. Otherwise, if the argument is an integer or a floating-point number, a floating-point number with the same value (within Python‚Äôs floating-point precision) is returned. If the argument is outside the range of a Python float, an OverflowError will be raised. For a general Python object x , float(x) delegates to x.__float__() . If __float__() is not defined then it falls back to __index__() . See also float.from_number() which only accepts a numeric argument. If no argument is given, 0.0 is returned. The float type is described in Numeric Types ‚Äî int, float, complex . Changed in version 3.6: Grouping digits with underscores as in code literals is allowed. Changed in version 3.7: The parameter is now positional-only. Changed in version 3.8: Falls back to __index__() if __float__() is not defined. format ( value , format_spec = '' , / ) ¬∂ Convert a value to a ‚Äúformatted‚Äù representation, as controlled by format_spec . The interpretation of format_spec will depend on the type of the value argument; however, there is a standard formatting syntax that is used by most built-in types: Format Specification Mini-Language . The default format_spec is an empty string which usually gives the same effect as calling str(value) . A call to format(value, format_spec) is translated to type(value).__format__(value, format_spec) which bypasses the instance dictionary when searching for the value‚Äôs __format__() method. A TypeError exception is raised if the method search reaches object and the format_spec is non-empty, or if either the format_spec or the return value are not strings. Changed in version 3.4: object().__format__(format_spec) raises TypeError if format_spec is not an empty string. class frozenset ( iterable = () , / ) Return a new frozenset object, optionally with elements taken from iterable . frozenset is a built-in class. See frozenset and Set Types ‚Äî set, frozenset for documentation about this class. For other containers see the built-in set , list , tuple , and dict classes, as well as the collections module. getattr ( object , name , / ) ¬∂ getattr ( object , name , default , / ) Return the value of the named attribute of object . name must be a string. If the string is the name of one of the object‚Äôs attributes, the result is the value of that attribute. For example, getattr(x, 'foobar') is equivalent to x.foobar . If the named attribute does not exist, default is returned if provided, otherwise AttributeError is raised. name need not be a Python identifier (see setattr() ). Note Since private name mangling happens at compilation time, one must manually mangle a private attribute‚Äôs (attributes with two leading underscores) name in order to retrieve it with getattr() . globals ( ) ¬∂ Return the dictionary implementing the current module namespace. For code within functions, this is set when the function is defined and remains the same regardless of where the function is called. hasattr ( object , name , / ) ¬∂ The arguments are an object and a string. The result is True if the string is the name of one of the object‚Äôs attributes, False if not. (This is implemented by calling getattr(object, name) and seeing whether it raises an AttributeError or not.) hash ( object , / ) ¬∂ Return the hash value of the object (if it has one). Hash values are integers. They are used to quickly compare dictionary keys during a dictionary lookup. Numeric values that compare equal have the same hash value (even if they are of different types, as is the case for 1 and 1.0). Note For objects with custom __hash__() methods, note that hash() truncates the return value based on the bit width of the host machine. help ( ) ¬∂ help ( request ) Invoke the built-in help system. (This function is intended for interactive use.) If no argument is given, the interactive help system starts on the interpreter console. If the argument is a string, then the string is looked up as the name of a module, function, class, method, keyword, or documentation topic, and a help page is printed on the console. If the argument is any other kind of object, a help page on the object is generated. Note that if a slash(/) appears in the parameter list of a function when invoking help() , it means that the parameters prior to the slash are positional-only. For more info, see the FAQ entry on positional-only parameters . This function is added to the built-in namespace by the site module. Changed in version 3.4: Changes to pydoc and inspect mean that the reported signatures for callables are now more comprehensive and consistent. hex ( integer , / ) ¬∂ Convert an integer number to a lowercase hexadecimal string prefixed with ‚Äú0x‚Äù. If integer is not a Python int object, it has to define an __index__() method that returns an integer. Some examples: >>> hex ( 255 ) &#39;0xff&#39; >>> hex ( - 42 ) &#39;-0x2a&#39; If you want to convert an integer number to an uppercase or lower hexadecimal string with prefix or not, you can use either of the following ways: >>> &#39; %#x &#39; % 255 , &#39; %x &#39; % 255 , &#39; %X &#39; % 255 (&#39;0xff&#39;, &#39;ff&#39;, &#39;FF&#39;) >>> format ( 255 , &#39;#x&#39; ), format ( 255 , &#39;x&#39; ), format ( 255 , &#39;X&#39; ) (&#39;0xff&#39;, &#39;ff&#39;, &#39;FF&#39;) >>> f &#39; { 255 : #x } &#39; , f &#39; { 255 : x } &#39; , f &#39; { 255 : X } &#39; (&#39;0xff&#39;, &#39;ff&#39;, &#39;FF&#39;) See also format() for more information. See also int() for converting a hexadecimal string to an integer using a base of 16. Note To obtain a hexadecimal string representation for a float, use the float.hex() method. id ( object , / ) ¬∂ Return the ‚Äúidentity‚Äù of an object. This is an integer which is guaranteed to be unique and constant for this object during its lifetime. Two objects with non-overlapping lifetimes may have the same id() value. CPython implementation detail: This is the address of the object in memory. Raises an auditing event builtins.id with argument id . input ( ) ¬∂ input ( prompt , / ) If the prompt argument is present, it is written to standard output without a trailing newline. The function then reads a line from input, converts it to a string (stripping a trailing newline), and returns that. When EOF is read, EOFError is raised. Example: >>> s = input ( &#39;--> &#39; ) --> Monty Python&#39;s Flying Circus >>> s \"Monty Python&#39;s Flying Circus\" If the readline module was loaded, then input() will use it to provide elaborate line editing and history features. Raises an auditing event builtins.input with argument prompt before reading input Raises an auditing event builtins.input/result with the result after successfully reading input. class int ( number = 0 , / ) ¬∂ class int ( string , / , base = 10 ) Return an integer object constructed from a number or a string, or return 0 if no arguments are given. Examples: >>> int ( 123.45 ) 123 >>> int ( &#39;123&#39; ) 123 >>> int ( &#39; -12_345 \\n &#39; ) -12345 >>> int ( &#39;FACE&#39; , 16 ) 64206 >>> int ( &#39;0xface&#39; , 0 ) 64206 >>> int ( &#39;01110011&#39; , base = 2 ) 115 If the argument defines __int__() , int(x) returns x.__int__() . If the argument defines __index__() , it returns x.__index__() . For floating-point numbers, this truncates towards zero. If the argument is not a number or if base is given, then it must be a string, bytes , or bytearray instance representing an integer in radix base . Optionally, the string can be preceded by + or - (with no space in between), have leading zeros, be surrounded by whitespace, and have single underscores interspersed between digits. A base-n integer string contains digits, each representing a value from 0 to n-1. The values 0‚Äì9 can be represented by any Unicode decimal digit. The values 10‚Äì35 can be represented by a to z (or A to Z ). The default base is 10. The allowed bases are 0 and 2‚Äì36. Base-2, -8, and -16 strings can be optionally prefixed with 0b / 0B , 0o / 0O , or 0x / 0X , as with integer literals in code. For base 0, the string is interpreted in a similar way to an integer literal in code , in that the actual base is 2, 8, 10, or 16 as determined by the prefix. Base 0 also disallows leading zeros: int('010', 0) is not legal, while int('010') and int('010', 8) are. The integer type is described in Numeric Types ‚Äî int, float, complex . Changed in version 3.4: If base is not an instance of int and the base object has a base.__index__ method, that method is called to obtain an integer for the base. Previous versions used base.__int__ instead of base.__index__ . Changed in version 3.6: Grouping digits with underscores as in code literals is allowed. Changed in version 3.7: The first parameter is now positional-only. Changed in version 3.8: Falls back to __index__() if __int__() is not defined. Changed in version 3.11: int string inputs and string representations can be limited to help avoid denial of service attacks. A ValueError is raised when the limit is exceeded while converting a string to an int or when converting an int into a string would exceed the limit. See the integer string conversion length limitation documentation. Changed in version 3.14: int() no longer delegates to the __trunc__() method. isinstance ( object , classinfo , / ) ¬∂ Return True if the object argument is an instance of the classinfo argument, or of a (direct, indirect, or virtual ) subclass thereof. If object is not an object of the given type, the function always returns False . If classinfo is a tuple of type objects (or recursively, other such tuples) or a Union Type of multiple types, return True if object is an instance of any of the types. If classinfo is not a type or tuple of types and such tuples, a TypeError exception is raised. TypeError may not be raised for an invalid type if an earlier check succeeds. Changed in version 3.10: classinfo can be a Union Type . issubclass ( class , classinfo , / ) ¬∂ Return True if class is a subclass (direct, indirect, or virtual ) of classinfo . A class is considered a subclass of itself. classinfo may be a tuple of class objects (or recursively, other such tuples) or a Union Type , in which case return True if class is a subclass of any entry in classinfo . In any other case, a TypeError exception is raised. Changed in version 3.10: classinfo can be a Union Type . iter ( iterable , / ) ¬∂ iter ( callable , sentinel , / ) Return an iterator object. The first argument is interpreted very differently depending on the presence of the second argument. Without a second argument, the single argument must be a collection object which supports the iterable protocol (the __iter__() method), or it must support the sequence protocol (the __getitem__() method with integer arguments starting at 0 ). If it does not support either of those protocols, TypeError is raised. If the second argument, sentinel , is given, then the first argument must be a callable object. The iterator created in this case will call callable with no arguments for each call to its __next__() method; if the value returned is equal to sentinel , StopIteration will be raised, otherwise the value will be returned. See also Iterator Types . One useful application of the second form of iter() is to build a block-reader. For example, reading fixed-width blocks from a binary database file until the end of file is reached: from functools import partial with open ( &#39;mydata.db&#39; , &#39;rb&#39; ) as f : for block in iter ( partial ( f . read , 64 ), b &#39;&#39; ): process_block ( block ) len ( object , / ) ¬∂ Return the length (the number of items) of an object. The argument may be a sequence (such as a string, bytes, tuple, list, or range) or a collection (such as a dictionary, set, or frozen set). CPython implementation detail: len raises OverflowError on lengths larger than sys.maxsize , such as range(2 ** 100) . class list ( iterable = () , / ) Rather than being a function, list is actually a mutable sequence type, as documented in Lists and Sequence Types ‚Äî list, tuple, range . locals ( ) ¬∂ Return a mapping object representing the current local symbol table, with variable names as the keys, and their currently bound references as the values. At module scope, as well as when using exec() or eval() with a single namespace, this function returns the same namespace as globals() . At class scope, it returns the namespace that will be passed to the metaclass constructor. When using exec() or eval() with separate local and global arguments, it returns the local namespace passed in to the function call. In all of the above cases, each call to locals() in a given frame of execution will return the same mapping object. Changes made through the mapping object returned from locals() will be visible as assigned, reassigned, or deleted local variables, and assigning, reassigning, or deleting local variables will immediately affect the contents of the returned mapping object. In an optimized scope (including functions, generators, and coroutines), each call to locals() instead returns a fresh dictionary containing the current bindings of the function‚Äôs local variables and any nonlocal cell references. In this case, name binding changes made via the returned dict are not written back to the corresponding local variables or nonlocal cell references, and assigning, reassigning, or deleting local variables and nonlocal cell references does not affect the contents of previously returned dictionaries. Calling locals() as part of a comprehension in a function, generator, or coroutine is equivalent to calling it in the containing scope, except that the comprehension‚Äôs initialised iteration variables will be included. In other scopes, it behaves as if the comprehension were running as a nested function. Calling locals() as part of a generator expression is equivalent to calling it in a nested generator function. Changed in version 3.12: The behaviour of locals() in a comprehension has been updated as described in PEP 709 . Changed in version 3.13: As part of PEP 667 , the semantics of mutating the mapping objects returned from this function are now defined. The behavior in optimized scopes is now as described above. Aside from being defined, the behaviour in other scopes remains unchanged from previous versions. map ( function , iterable , / , * iterables , strict = False ) ¬∂ Return an iterator that applies function to every item of iterable , yielding the results. If additional iterables arguments are passed, function must take that many arguments and is applied to the items from all iterables in parallel. With multiple iterables, the iterator stops when the shortest iterable is exhausted. If strict is True and one of the iterables is exhausted before the others, a ValueError is raised. For cases where the function inputs are already arranged into argument tuples, see itertools.starmap() . Changed in version 3.14: Added the strict parameter. max ( iterable , / , * , key = None ) ¬∂ max ( iterable , / , * , default , key = None ) max ( arg1 , arg2 , / , * args , key = None ) Return the largest item in an iterable or the largest of two or more arguments. If one positional argument is provided, it should be an iterable . The largest item in the iterable is returned. If two or more positional arguments are provided, the largest of the positional arguments is returned. There are two optional keyword-only arguments. The key argument specifies a one-argument ordering function like that used for list.sort() . The default argument specifies an object to return if the provided iterable is empty. If the iterable is empty and default is not provided, a ValueError is raised. If multiple items are maximal, the function returns the first one encountered. This is consistent with other sort-stability preserving tools such as sorted(iterable, key=keyfunc, reverse=True)[0] and heapq.nlargest(1, iterable, key=keyfunc) . Changed in version 3.4: Added the default keyword-only parameter. Changed in version 3.8: The key can be None . class memoryview ( object ) Return a ‚Äúmemory view‚Äù object created from the given argument. See Memory Views for more information. min ( iterable , / , * , key = None ) ¬∂ min ( iterable , / , * , default , key = None ) min ( arg1 , arg2 , / , * args , key = None ) Return the smallest item in an iterable or the smallest of two or more arguments. If one positional argument is provided, it should be an iterable . The smallest item in the iterable is returned. If two or more positional arguments are provided, the smallest of the positional arguments is returned. There are two optional keyword-only arguments. The key argument specifies a one-argument ordering function like that used for list.sort() . The default argument specifies an object to return if the provided iterable is empty. If the iterable is empty and default is not provided, a ValueError is raised. If multiple items are minimal, the function returns the first one encountered. This is consistent with other sort-stability preserving tools such as sorted(iterable, key=keyfunc)[0] and heapq.nsmallest(1, iterable, key=keyfunc) . Changed in version 3.4: Added the default keyword-only parameter. Changed in version 3.8: The key can be None . next ( iterator , / ) ¬∂ next ( iterator , default , / ) Retrieve the next item from the iterator by calling its __next__() method. If default is given, it is returned if the iterator is exhausted, otherwise StopIteration is raised. class object ¬∂ This is the ultimate base class of all other classes. It has methods that are common to all instances of Python classes. When the constructor is called, it returns a new featureless object. The constructor does not accept any arguments. Note object instances do not have __dict__ attributes, so you can‚Äôt assign arbitrary attributes to an instance of object . oct ( integer , / ) ¬∂ Convert an integer number to an octal string prefixed with ‚Äú0o‚Äù. The result is a valid Python expression. If integer is not a Python int object, it has to define an __index__() method that returns an integer. For example: >>> oct ( 8 ) &#39;0o10&#39; >>> oct ( - 56 ) &#39;-0o70&#39; If you want to convert an integer number to an octal string either with the prefix ‚Äú0o‚Äù or not, you can use either of the following ways. >>> &#39; %#o &#39; % 10 , &#39; %o &#39; % 10 (&#39;0o12&#39;, &#39;12&#39;) >>> format ( 10 , &#39;#o&#39; ), format ( 10 , &#39;o&#39; ) (&#39;0o12&#39;, &#39;12&#39;) >>> f &#39; { 10 : #o } &#39; , f &#39; { 10 : o } &#39; (&#39;0o12&#39;, &#39;12&#39;) See also format() for more information. open ( file , mode = 'r' , buffering = -1 , encoding = None , errors = None , newline = None , closefd = True , opener = None ) ¬∂ Open file and return a corresponding file object . If the file cannot be opened, an OSError is raised. See Reading and Writing Files for more examples of how to use this function. file is a path-like object giving the pathname (absolute or relative to the current working directory) of the file to be opened or an integer file descriptor of the file to be wrapped. (If a file descriptor is given, it is closed when the returned I/O object is closed unless closefd is set to False .) mode is an optional string that specifies the mode in which the file is opened. It defaults to 'r' which means open for reading in text mode. Other common values are 'w' for writing (truncating the file if it already exists), 'x' for exclusive creation, and 'a' for appending (which on some Unix systems, means that all writes append to the end of the file regardless of the current seek position). In text mode, if encoding is not specified the encoding used is platform-dependent: locale.getencoding() is called to get the current locale encoding. (For reading and writing raw bytes use binary mode and leave encoding unspecified.) The available modes are: Character Meaning 'r' open for reading (default) 'w' open for writing, truncating the file first 'x' open for exclusive creation, failing if the file already exists 'a' open for writing, appending to the end of file if it exists 'b' binary mode 't' text mode (default) '+' open for updating (reading and writing) The default mode is 'r' (open for reading text, a synonym of 'rt' ). Modes 'w+' and 'w+b' open and truncate the file. Modes 'r+' and 'r+b' open the file with no truncation. As mentioned in the Overview , Python distinguishes between binary and text I/O. Files opened in binary mode (including 'b' in the mode argument) return contents as bytes objects without any decoding. In text mode (the default, or when 't' is included in the mode argument), the contents of the file are returned as str , the bytes having been first decoded using a platform-dependent encoding or using the specified encoding if given. Note Python doesn‚Äôt depend on the underlying operating system‚Äôs notion of text files; all the processing is done by Python itself, and is therefore platform-independent. buffering is an optional integer used to set the buffering policy. Pass 0 to switch buffering off (only allowed in binary mode), 1 to select line buffering (only usable when writing in text mode), and an integer > 1 to indicate the size in bytes of a fixed-size chunk buffer. Note that specifying a buffer size this way applies for binary buffered I/O, but TextIOWrapper (i.e., files opened with mode='r+' ) would have another buffering. To disable buffering in TextIOWrapper , consider using the write_through flag for io.TextIOWrapper.reconfigure() . When no buffering argument is given, the default buffering policy works as follows: Binary files are buffered in fixed-size chunks; the size of the buffer is max(min(blocksize, 8 MiB), DEFAULT_BUFFER_SIZE) when the device block size is available. On most systems, the buffer will typically be 128 kilobytes long. ‚ÄúInteractive‚Äù text files (files for which isatty() returns True ) use line buffering. Other text files use the policy described above for binary files. encoding is the name of the encoding used to decode or encode the file. This should only be used in text mode. The default encoding is platform dependent (whatever locale.getencoding() returns), but any text encoding supported by Python can be used. See the codecs module for the list of supported encodings. errors is an optional string that specifies how encoding and decoding errors are to be handled‚Äîthis cannot be used in binary mode. A variety of standard error handlers are available (listed under Error Handlers ), though any error handling name that has been registered with codecs.register_error() is also valid. The standard names include: 'strict' to raise a ValueError exception if there is an encoding error. The default value of None has the same effect. 'ignore' ignores errors. Note that ignoring encoding errors can lead to data loss. 'replace' causes a replacement marker (such as '?' ) to be inserted where there is malformed data. 'surrogateescape' will represent any incorrect bytes as low surrogate code units ranging from U+DC80 to U+DCFF. These surrogate code units will then be turned back into the same bytes when the surrogateescape error handler is used when writing data. This is useful for processing files in an unknown encoding. 'xmlcharrefreplace' is only supported when writing to a file. Characters not supported by the encoding are replaced with the appropriate XML character reference &# nnn ; . 'backslashreplace' replaces malformed data by Python‚Äôs backslashed escape sequences. 'namereplace' (also only supported when writing) replaces unsupported characters with \\N{...} escape sequences. newline determines how to parse newline characters from the stream. It can be None , '' , '\\n' , '\\r' , and '\\r\\n' . It works as follows: When reading input from the stream, if newline is None , universal newlines mode is enabled. Lines in the input can end in '\\n' , '\\r' , or '\\r\\n' , and these are translated into '\\n' before being returned to the caller. If it is '' , universal newlines mode is enabled, but line endings are returned to the caller untranslated. If it has any of the other legal values, input lines are only terminated by the given string, and the line ending is returned to the caller untranslated. When writing output to the stream, if newline is None , any '\\n' characters written are translated to the system default line separator, os.linesep . If newline is '' or '\\n' , no translation takes place. If newline is any of the other legal values, any '\\n' characters written are translated to the given string. If closefd is False and a file descriptor rather than a filename was given, the underlying file descriptor will be kept open when the file is closed. If a filename is given closefd must be True (the default); otherwise, an error will be raised. A custom opener can be used by passing a callable as opener . The underlying file descriptor for the file object is then obtained by calling opener with ( file , flags ). opener must return an open file descriptor (passing os.open as opener results in functionality similar to passing None ). The newly created file is non-inheritable . The following example uses the dir_fd parameter of the os.open() function to open a file relative to a given directory: >>> import os >>> dir_fd = os . open ( &#39;somedir&#39; , os . O_RDONLY ) >>> def opener ( path , flags ): ... return os . open ( path , flags , dir_fd = dir_fd ) ... >>> with open ( &#39;spamspam.txt&#39; , &#39;w&#39; , opener = opener ) as f : ... print ( &#39;This will be written to somedir/spamspam.txt&#39; , file = f ) ... >>> os . close ( dir_fd ) # don&#39;t leak a file descriptor The type of file object returned by the open() function depends on the mode. When open() is used to open a file in a text mode ( 'w' , 'r' , 'wt' , 'rt' , etc.), it returns a subclass of io.TextIOBase (specifically io.TextIOWrapper ). When used to open a file in a binary mode with buffering, the returned class is a subclass of io.BufferedIOBase . The exact class varies: in read binary mode, it returns an io.BufferedReader ; in write binary and append binary modes, it returns an io.BufferedWriter , and in read/write mode, it returns an io.BufferedRandom . When buffering is disabled, the raw stream, a subclass of io.RawIOBase , io.FileIO , is returned. See also the file handling modules, such as fileinput , io (where open() is declared), os , os.path , tempfile , and shutil . Raises an auditing event open with arguments path , mode , flags . The mode and flags arguments may have been modified or inferred from the original call. Changed in version 3.3: The opener parameter was added. The 'x' mode was added. IOError used to be raised, it is now an alias of OSError . FileExistsError is now raised if the file opened in exclusive creation mode ( 'x' ) already exists. Changed in version 3.4: The file is now non-inheritable. Changed in version 3.5: If the system call is interrupted and the signal handler does not raise an exception, the function now retries the system call instead of raising an InterruptedError exception (see PEP 475 for the rationale). The 'namereplace' error handler was added. Changed in version 3.6: Support added to accept objects implementing os.PathLike . On Windows, opening a console buffer may return a subclass of io.RawIOBase other than io.FileIO . Changed in version 3.11: The 'U' mode has been removed. ord ( character , / ) ¬∂ Return the ordinal value of a character. If the argument is a one-character string, return the Unicode code point of that character. For example, ord('a') returns the integer 97 and ord('‚Ç¨') (Euro sign) returns 8364 . This is the inverse of chr() . If the argument is a bytes or bytearray object of length 1, return its single byte value. For example, ord(b'a') returns the integer 97 . pow ( base , exp , mod = None ) ¬∂ Return base to the power exp ; if mod is present, return base to the power exp , modulo mod (computed more efficiently than pow(base, exp) % mod ). The two-argument form pow(base, exp) is equivalent to using the power operator: base**exp . When arguments are builtin numeric types with mixed operand types, the coercion rules for binary arithmetic operators apply. For int operands, the result has the same type as the operands (after coercion) unless the second argument is negative; in that case, all arguments are converted to float and a float result is delivered. For example, pow(10, 2) returns 100 , but pow(10, -2) returns 0.01 . For a negative base of type int or float and a non-integral exponent, a complex result is delivered. For example, pow(-9, 0.5) returns a value close to 3j . Whereas, for a negative base of type int or float with an integral exponent, a float result is delivered. For example, pow(-9, 2.0) returns 81.0 . For int operands base and exp , if mod is present, mod must also be of integer type and mod must be nonzero. If mod is present and exp is negative, base must be relatively prime to mod . In that case, pow(inv_base, -exp, mod) is returned, where inv_base is an inverse to base modulo mod . Here‚Äôs an example of computing an inverse for 38 modulo 97 : >>> pow ( 38 , - 1 , mod = 97 ) 23 >>> 23 * 38 % 97 == 1 True Changed in version 3.8: For int operands, the three-argument form of pow now allows the second argument to be negative, permitting computation of modular inverses. Changed in version 3.8: Allow keyword arguments. Formerly, only positional arguments were supported. print ( * objects , sep = ' ' , end = '\\n' , file = None , flush = False ) ¬∂ Print objects to the text stream file , separated by sep and followed by end . sep , end , file , and flush , if present, must be given as keyword arguments. All non-keyword arguments are converted to strings like str() does and written to the stream, separated by sep and followed by end . Both sep and end must be strings; they can also be None , which means to use the default values. If no objects are given, print() will just write end . The file argument must be an object with a write(string) method; if it is not present or None , sys.stdout will be used. Since printed arguments are converted to text strings, print() cannot be used with binary mode file objects. For these, use file.write(...) instead. Output buffering is usually determined by file . However, if flush is true, the stream is forcibly flushed. Changed in version 3.3: Added the flush keyword argument. class property ( fget = None , fset = None , fdel = None , doc = None ) ¬∂ Return a property attribute. fget is a function for getting an attribute value. fset is a function for setting an attribute value. fdel is a function for deleting an attribute value. And doc creates a docstring for the attribute. A typical use is to define a managed attribute x : class C : def __init__ ( self ): self . _x = None def getx ( self ): return self . _x def setx ( self , value ): self . _x = value def delx ( self ): del self . _x x = property ( getx , setx , delx , \"I&#39;m the &#39;x&#39; property.\" ) If c is an instance of C , c.x will invoke the getter, c.x = value will invoke the setter, and del c.x the deleter. If given, doc will be the docstring of the property attribute. Otherwise, the property will copy fget ‚Äôs docstring (if it exists). This makes it possible to create read-only properties easily using property() as a decorator : class Parrot : def __init__ ( self ): self . _voltage = 100000 @property def voltage ( self ): \"\"\"Get the current voltage.\"\"\" return self . _voltage The &#64;property decorator turns the voltage() method into a ‚Äúgetter‚Äù for a read-only attribute with the same name, and it sets the docstring for voltage to ‚ÄúGet the current voltage.‚Äù &#64; getter ¬∂ &#64; setter ¬∂ &#64; deleter ¬∂ A property object has getter , setter , and deleter methods usable as decorators that create a copy of the property with the corresponding accessor function set to the decorated function. This is best explained with an example: class C : def __init__ ( self ): self . _x = None @property def x ( self ): \"\"\"I&#39;m the &#39;x&#39; property.\"\"\" return self . _x @x . setter def x ( self , value ): self . _x = value @x . deleter def x ( self ): del self . _x This code is exactly equivalent to the first example. Be sure to give the additional functions the same name as the original property ( x in this case.) The returned property object also has the attributes fget , fset , and fdel corresponding to the constructor arguments. Changed in version 3.5: The docstrings of property objects are now writeable. __name__ ¬∂ Attribute holding the name of the property. The name of the property can be changed at runtime. Added in version 3.13. class range ( stop , / ) class range ( start , stop , step = 1 , / ) Rather than being a function, range is actually an immutable sequence type, as documented in Ranges and Sequence Types ‚Äî list, tuple, range . repr ( object , / ) ¬∂ Return a string containing a printable representation of an object. For many types, this function makes an attempt to return a string that would yield an object with the same value when passed to eval() ; otherwise, the representation is a string enclosed in angle brackets that contains the name of the type of the object together with additional information often including the name and address of the object. A class can control what this function returns for its instances by defining a __repr__() method. If sys.displayhook() is not accessible, this function will raise RuntimeError . This class has a custom representation that can be evaluated: class Person : def __init__ ( self , name , age ): self . name = name self . age = age def __repr__ ( self ): return f \"Person(&#39; { self . name } &#39;, { self . age } )\" reversed ( object , / ) ¬∂ Return a reverse iterator . The argument must be an object which has a __reversed__() method or supports the sequence protocol (the __len__() method and the __getitem__() method with integer arguments starting at 0 ). round ( number , ndigits = None ) ¬∂ Return number rounded to ndigits precision after the decimal point. If ndigits is omitted or is None , it returns the nearest integer to its input. For the built-in types supporting round() , values are rounded to the closest multiple of 10 to the power minus ndigits ; if two multiples are equally close, rounding is done toward the even choice (so, for example, both round(0.5) and round(-0.5) are 0 , and round(1.5) is 2 ). Any integer value is valid for ndigits (positive, zero, or negative). The return value is an integer if ndigits is omitted or None . Otherwise, the return value has the same type as number . For a general Python object number , round delegates to number.__round__ . Note The behavior of round() for floats can be surprising: for example, round(2.675, 2) gives 2.67 instead of the expected 2.68 . This is not a bug: it‚Äôs a result of the fact that most decimal fractions can‚Äôt be represented exactly as a float. See Floating-Point Arithmetic: Issues and Limitations for more information. class set ( iterable = () , / ) Return a new set object, optionally with elements taken from iterable . set is a built-in class. See set and Set Types ‚Äî set, frozenset for documentation about this class. For other containers see the built-in frozenset , list , tuple , and dict classes, as well as the collections module. setattr ( object , name , value , / ) ¬∂ This is the counterpart of getattr() . The arguments are an object, a string, and an arbitrary value. The string may name an existing attribute or a new attribute. The function assigns the value to the attribute, provided the object allows it. For example, setattr(x, 'foobar', 123) is equivalent to x.foobar = 123 . name need not be a Python identifier as defined in Names (identifiers and keywords) unless the object chooses to enforce that, for example in a custom __getattribute__() or via __slots__ . An attribute whose name is not an identifier will not be accessible using the dot notation, but is accessible through getattr() etc.. Note Since private name mangling happens at compilation time, one must manually mangle a private attribute‚Äôs (attributes with two leading underscores) name in order to set it with setattr() . class slice ( stop , / ) ¬∂ class slice ( start , stop , step = None , / ) Return a slice object representing the set of indices specified by range(start, stop, step) . The start and step arguments default to None . Slice objects have read-only data attributes start , stop , and step which merely return the argument values (or their default). They have no other explicit functionality; however, they are used by NumPy and other third-party packages. start ¬∂ stop ¬∂ step ¬∂ Slice objects are also generated when extended indexing syntax is used. For example: a[start:stop:step] or a[start:stop, i] . See itertools.islice() for an alternate version that returns an iterator . Changed in version 3.12: Slice objects are now hashable (provided start , stop , and step are hashable). sorted ( iterable , / , * , key = None , reverse = False ) ¬∂ Return a new sorted list from the items in iterable . Has two optional arguments which must be specified as keyword arguments. key specifies a function of one argument that is used to extract a comparison key from each element in iterable (for example, key=str.lower ). The default value is None (compare the elements directly). reverse is a boolean value. If set to True , then the list elements are sorted as if each comparison were reversed. Use functools.cmp_to_key() to convert an old-style cmp function to a key function. The built-in sorted() function is guaranteed to be stable. A sort is stable if it guarantees not to change the relative order of elements that compare equal ‚Äî this is helpful for sorting in multiple passes (for example, sort by department, then by salary grade). The sort algorithm uses only < comparisons between items. While defining an __lt__() method will suffice for sorting, PEP 8 recommends that all six rich comparisons be implemented. This will help avoid bugs when using the same data with other ordering tools such as max() that rely on a different underlying method. Implementing all six comparisons also helps avoid confusion for mixed type comparisons which can call the reflected __gt__() method. For sorting examples and a brief sorting tutorial, see Sorting Techniques . &#64; staticmethod ¬∂ Transform a method into a static method. A static method does not receive an implicit first argument. To declare a static method, use this idiom: class C : @staticmethod def f ( arg1 , arg2 , argN ): ... The &#64;staticmethod form is a function decorator ‚Äì see Function definitions for details. A static method can be called either on the class (such as C.f() ) or on an instance (such as C().f() ). Moreover, the static method descriptor is also callable, so it can be used in the class definition (such as f() ). Static methods in Python are similar to those found in Java or C++. Also, see classmethod() for a variant that is useful for creating alternate class constructors. Like all decorators, it is also possible to call staticmethod as a regular function and do something with its result. This is needed in some cases where you need a reference to a function from a class body and you want to avoid the automatic transformation to instance method. For these cases, use this idiom: def regular_function (): ... class C : method = staticmethod ( regular_function ) For more information on static methods, see The standard type hierarchy . Changed in version 3.10: Static methods now inherit the method attributes ( __module__ , __name__ , __qualname__ , __doc__ and __annotations__ ), have a new __wrapped__ attribute, and are now callable as regular functions. class str ( * , encoding = 'utf-8' , errors = 'strict' ) class str ( object ) class str ( object , encoding , errors = 'strict' ) class str ( object , * , errors ) Return a str version of object . See str() for details. str is the built-in string class . For general information about strings, see Text Sequence Type ‚Äî str . sum ( iterable , / , start = 0 ) ¬∂ Sums start and the items of an iterable from left to right and returns the total. The iterable ‚Äôs items are normally numbers, and the start value is not allowed to be a string. For some use cases, there are good alternatives to sum() . The preferred, fast way to concatenate a sequence of strings is by calling ''.join(sequence) . To add floating-point values with extended precision, see math.fsum() . To concatenate a series of iterables, consider using itertools.chain() . Changed in version 3.8: The start parameter can be specified as a keyword argument. Changed in version 3.12: Summation of floats switched to an algorithm that gives higher accuracy and better commutativity on most builds. Changed in version 3.14: Added specialization for summation of complexes, using same algorithm as for summation of floats. class super ¬∂ class super ( type , object_or_type = None , / ) Return a proxy object that delegates method calls to a parent or sibling class of type . This is useful for accessing inherited methods that have been overridden in a class. The object_or_type determines the method resolution order to be searched. The search starts from the class right after the type . For example, if __mro__ of object_or_type is D -> B -> C -> A -> object and the value of type is B , then super() searches C -> A -> object . The __mro__ attribute of the class corresponding to object_or_type lists the method resolution search order used by both getattr() and super() . The attribute is dynamic and can change whenever the inheritance hierarchy is updated. If the second argument is omitted, the super object returned is unbound. If the second argument is an object, isinstance(obj, type) must be true. If the second argument is a type, issubclass(type2, type) must be true (this is useful for classmethods). When called directly within an ordinary method of a class, both arguments may be omitted (‚Äúzero-argument super() ‚Äù). In this case, type will be the enclosing class, and obj will be the first argument of the immediately enclosing function (typically self ). (This means that zero-argument super() will not work as expected within nested functions, including generator expressions, which implicitly create nested functions.) There are two typical use cases for super . In a class hierarchy with single inheritance, super can be used to refer to parent classes without naming them explicitly, thus making the code more maintainable. This use closely parallels the use of super in other programming languages. The second use case is to support cooperative multiple inheritance in a dynamic execution environment. This use case is unique to Python and is not found in statically compiled languages or languages that only support single inheritance. This makes it possible to implement ‚Äúdiamond diagrams‚Äù where multiple base classes implement the same method. Good design dictates that such implementations have the same calling signature in every case (because the order of calls is determined at runtime, because that order adapts to changes in the class hierarchy, and because that order can include sibling classes that are unknown prior to runtime). For both use cases, a typical superclass call looks like this: class C ( B ): def method ( self , arg ): super () . method ( arg ) # This does the same thing as: # super(C, self).method(arg) In addition to method lookups, super() also works for attribute lookups. One possible use case for this is calling descriptors in a parent or sibling class. Note that super() is implemented as part of the binding process for explicit dotted attribute lookups such as super().__getitem__(name) . It does so by implementing its own __getattribute__() method for searching classes in a predictable order that supports cooperative multiple inheritance. Accordingly, super() is undefined for implicit lookups using statements or operators such as super()[name] . Also note that, aside from the zero argument form, super() is not limited to use inside methods. The two argument form specifies the arguments exactly and makes the appropriate references. The zero argument form only works inside a class definition, as the compiler fills in the necessary details to correctly retrieve the class being defined, as well as accessing the current instance for ordinary methods. For practical suggestions on how to design cooperative classes using super() , see guide to using super() . Changed in version 3.14: super objects are now pickleable and copyable . class tuple ( iterable = () , / ) Rather than being a function, tuple is actually an immutable sequence type, as documented in Tuples and Sequence Types ‚Äî list, tuple, range . class type ( object , / ) ¬∂ class type ( name , bases , dict , / , ** kwargs ) With one argument, return the type of an object . The return value is a type object and generally the same object as returned by object.__class__ . The isinstance() built-in function is recommended for testing the type of an object, because it takes subclasses into account. With three arguments, return a new type object. This is essentially a dynamic form of the class statement. The name string is the class name and becomes the __name__ attribute. The bases tuple contains the base classes and becomes the __bases__ attribute; if empty, object , the ultimate base of all classes, is added. The dict dictionary contains attribute and method definitions for the class body; it may be copied or wrapped before becoming the __dict__ attribute. The following two statements create identical type objects: >>> class X : ... a = 1 ... >>> X = type ( &#39;X&#39; , (), dict ( a = 1 )) See also: Documentation on attributes and methods on classes . Type Objects Keyword arguments provided to the three argument form are passed to the appropriate metaclass machinery (usually __init_subclass__() ) in the same way that keywords in a class definition (besides metaclass ) would. See also Customizing class creation . Changed in version 3.6: Subclasses of type which don‚Äôt override type.__new__ may no longer use the one-argument form to get the type of an object. vars ( ) ¬∂ vars ( object , / ) Return the __dict__ attribute for a module, class, instance, or any other object with a __dict__ attribute. Objects such as modules and instances have an updateable __dict__ attribute; however, other objects may have write restrictions on their __dict__ attributes (for example, classes use a types.MappingProxyType to prevent direct dictionary updates). Without an argument, vars() acts like locals() . A TypeError exception is raised if an object is specified but it doesn‚Äôt have a __dict__ attribute (for example, if its class defines the __slots__ attribute). Changed in version 3.13: The result of calling this function without an argument has been updated as described for the locals() builtin. zip ( * iterables , strict = False ) ¬∂ Iterate over several iterables in parallel, producing tuples with an item from each one. Example: >>> for item in zip ([ 1 , 2 , 3 ], [ &#39;sugar&#39; , &#39;spice&#39; , &#39;everything nice&#39; ]): ... print ( item ) ... (1, &#39;sugar&#39;) (2, &#39;spice&#39;) (3, &#39;everything nice&#39;) More formally: zip() returns an iterator of tuples, where the i -th tuple contains the i -th element from each of the argument iterables. Another way to think of zip() is that it turns rows into columns, and columns into rows. This is similar to transposing a matrix . zip() is lazy: The elements won‚Äôt be processed until the iterable is iterated on, e.g. by a for loop or by wrapping in a list . One thing to consider is that the iterables passed to zip() could have different lengths; sometimes by design, and sometimes because of a bug in the code that prepared these iterables. Python offers three different approaches to dealing with this issue: By default, zip() stops when the shortest iterable is exhausted. It will ignore the remaining items in the longer iterables, cutting off the result to the length of the shortest iterable: >>> list ( zip ( range ( 3 ), [ &#39;fee&#39; , &#39;fi&#39; , &#39;fo&#39; , &#39;fum&#39; ])) [(0, &#39;fee&#39;), (1, &#39;fi&#39;), (2, &#39;fo&#39;)] zip() is often used in cases where the iterables are assumed to be of equal length. In such cases, it‚Äôs recommended to use the strict=True option. Its output is the same as regular zip() : >>> list ( zip (( &#39;a&#39; , &#39;b&#39; , &#39;c&#39; ), ( 1 , 2 , 3 ), strict = True )) [(&#39;a&#39;, 1), (&#39;b&#39;, 2), (&#39;c&#39;, 3)] Unlike the default behavior, it raises a ValueError if one iterable is exhausted before the others: >>> for item in zip ( range ( 3 ), [ &#39;fee&#39; , &#39;fi&#39; , &#39;fo&#39; , &#39;fum&#39; ], strict = True ): ... print ( item ) ... (0, &#39;fee&#39;) (1, &#39;fi&#39;) (2, &#39;fo&#39;) Traceback (most recent call last): ... ValueError : zip() argument 2 is longer than argument 1 Without the strict=True argument, any bug that results in iterables of different lengths will be silenced, possibly manifesting as a hard-to-find bug in another part of the program. Shorter iterables can be padded with a constant value to make all the iterables have the same length. This is done by itertools.zip_longest() . Edge cases: With a single iterable argument, zip() returns an iterator of 1-tuples. With no arguments, it returns an empty iterator. Tips and tricks: The left-to-right evaluation order of the iterables is guaranteed. This makes possible an idiom for clustering a data series into n-length groups using zip(*[iter(s)]*n, strict=True) . This repeats the same iterator n times so that each output tuple has the result of n calls to the iterator. This has the effect of dividing the input into n-length chunks. zip() in conjunction with the * operator can be used to unzip a list: >>> x = [ 1 , 2 , 3 ] >>> y = [ 4 , 5 , 6 ] >>> list ( zip ( x , y )) [(1, 4), (2, 5), (3, 6)] >>> x2 , y2 = zip ( * zip ( x , y )) >>> x == list ( x2 ) and y == list ( y2 ) True Changed in version 3.10: Added the strict argument. __import__ ( name , globals = None , locals = None , fromlist = () , level = 0 ) ¬∂ Note This is an advanced function that is not needed in everyday Python programming, unlike importlib.import_module() . This function is invoked by the import statement. It can be replaced (by importing the builtins module and assigning to builtins.__import__ ) in order to change semantics of the import statement, but doing so is strongly discouraged as it is usually simpler to use import hooks (see PEP 302 ) to attain the same goals and does not cause issues with code which assumes the default import implementation is in use. Direct use of __import__() is also discouraged in favor of importlib.import_module() . The function imports the module name , potentially using the given globals and locals to determine how to interpret the name in a package context. The fromlist gives the names of objects or submodules that should be imported from the module given by name . The standard implementation does not use its locals argument at all and uses its globals only to determine the package context of the import statement. level specifies whether to use absolute or relative imports. 0 (the default) means only perform absolute imports. Positive values for level indicate the number of parent directories to search relative to the directory of the module calling __import__() (see PEP 328 for the details). When the name variable is of the form package.module , normally, the top-level package (the name up till the first dot) is returned, not the module named by name . However, when a non-empty fromlist argument is given, the module named by name is returned. For example, the statement import spam results in bytecode resembling the following code: spam = __import__ ( &#39;spam&#39; , globals (), locals (), [], 0 ) The statement import spam.ham results in this call: spam = __import__ ( &#39;spam.ham&#39; , globals (), locals (), [], 0 ) Note how __import__() returns the toplevel module here because this is the object that is bound to a name by the import statement. On the other hand, the statement from spam.ham import eggs, sausage as saus results in _temp = __import__ ( &#39;spam.ham&#39; , globals (), locals (), [ &#39;eggs&#39; , &#39;sausage&#39; ], 0 ) eggs = _temp . eggs saus = _temp . sausage Here, the spam.ham module is returned from __import__() . From this object, the names to import are retrieved and assigned to their respective names. If you simply want to import a module (potentially within a package) by name, use importlib.import_module() . Changed in version 3.3: Negative values for level are no longer supported (which also changes the default value to 0). Changed in version 3.9: When the command line options -E or -I are being used, the environment variable PYTHONCASEOK is now ignored. Footnotes [ 1 ] Note that the parser only accepts the Unix-style end of line convention. If you are reading the code from a file, make sure to use newline conversion mode to convert Windows or Mac-style newlines. Previous topic Introduction Next topic Built-in Constants This page Report a bug Show source ¬´ Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Standard Library &#187; Built-in Functions | Theme Auto Light Dark | &copy; Copyright 2001 Python Software Foundation. This page is licensed under the Python Software Foundation License Version 2. Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License. See History and License for more information. The Python Software Foundation is a non-profit corporation. Please donate. Last updated on Jan 02, 2026 (19:26 UTC). Found a bug ? Created using Sphinx 8.2.3.",
      "chunk_ids": [],
      "metadata": {
        "url": "https://docs.python.org/3/library/functions.html",
        "title": "Built-in Functions &#8212; Python 3.14.2 documentation"
      },
      "is_distractor": false,
      "semantic_tags": [
        "documentation",
        "function",
        "python"
      ],
      "content_hash": "d9855cd11af2c5e5",
      "size_bytes": 80747,
      "created_at": "2026-01-02T20:42:12.443547"
    },
    {
      "doc_id": "online_docs_python_org_3_library_collections_html",
      "source": "online",
      "category": "technical",
      "domain": "python",
      "file_path": "https://docs.python.org/3/library/collections.html",
      "content": "collections ‚Äî Container datatypes &#8212; Python 3.14.2 documentation Theme Auto Light Dark Table of Contents collections ‚Äî Container datatypes ChainMap objects ChainMap Examples and Recipes Counter objects deque objects deque Recipes defaultdict objects defaultdict Examples namedtuple() Factory Function for Tuples with Named Fields OrderedDict objects OrderedDict Examples and Recipes UserDict objects UserList objects UserString objects Previous topic calendar ‚Äî General calendar-related functions Next topic collections.abc ‚Äî Abstract Base Classes for Containers This page Report a bug Show source Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Standard Library &#187; Data Types &#187; collections ‚Äî Container datatypes | Theme Auto Light Dark | collections ‚Äî Container datatypes ¬∂ Source code: Lib/collections/__init__.py This module implements specialized container datatypes providing alternatives to Python‚Äôs general purpose built-in containers, dict , list , set , and tuple . namedtuple() factory function for creating tuple subclasses with named fields deque list-like container with fast appends and pops on either end ChainMap dict-like class for creating a single view of multiple mappings Counter dict subclass for counting hashable objects OrderedDict dict subclass that remembers the order entries were added defaultdict dict subclass that calls a factory function to supply missing values UserDict wrapper around dictionary objects for easier dict subclassing UserList wrapper around list objects for easier list subclassing UserString wrapper around string objects for easier string subclassing ChainMap objects ¬∂ Added in version 3.3. A ChainMap class is provided for quickly linking a number of mappings so they can be treated as a single unit. It is often much faster than creating a new dictionary and running multiple update() calls. The class can be used to simulate nested scopes and is useful in templating. class collections. ChainMap ( * maps ) ¬∂ A ChainMap groups multiple dicts or other mappings together to create a single, updateable view. If no maps are specified, a single empty dictionary is provided so that a new chain always has at least one mapping. The underlying mappings are stored in a list. That list is public and can be accessed or updated using the maps attribute. There is no other state. Lookups search the underlying mappings successively until a key is found. In contrast, writes, updates, and deletions only operate on the first mapping. A ChainMap incorporates the underlying mappings by reference. So, if one of the underlying mappings gets updated, those changes will be reflected in ChainMap . All of the usual dictionary methods are supported. In addition, there is a maps attribute, a method for creating new subcontexts, and a property for accessing all but the first mapping: maps ¬∂ A user updateable list of mappings. The list is ordered from first-searched to last-searched. It is the only stored state and can be modified to change which mappings are searched. The list should always contain at least one mapping. new_child ( m = None , ** kwargs ) ¬∂ Returns a new ChainMap containing a new map followed by all of the maps in the current instance. If m is specified, it becomes the new map at the front of the list of mappings; if not specified, an empty dict is used, so that a call to d.new_child() is equivalent to: ChainMap({}, *d.maps) . If any keyword arguments are specified, they update passed map or new empty dict. This method is used for creating subcontexts that can be updated without altering values in any of the parent mappings. Changed in version 3.4: The optional m parameter was added. Changed in version 3.10: Keyword arguments support was added. parents ¬∂ Property returning a new ChainMap containing all of the maps in the current instance except the first one. This is useful for skipping the first map in the search. Use cases are similar to those for the nonlocal keyword used in nested scopes . The use cases also parallel those for the built-in super() function. A reference to d.parents is equivalent to: ChainMap(*d.maps[1:]) . Note, the iteration order of a ChainMap is determined by scanning the mappings last to first: >>> baseline = { &#39;music&#39; : &#39;bach&#39; , &#39;art&#39; : &#39;rembrandt&#39; } >>> adjustments = { &#39;art&#39; : &#39;van gogh&#39; , &#39;opera&#39; : &#39;carmen&#39; } >>> list ( ChainMap ( adjustments , baseline )) [&#39;music&#39;, &#39;art&#39;, &#39;opera&#39;] This gives the same ordering as a series of dict.update() calls starting with the last mapping: >>> combined = baseline . copy () >>> combined . update ( adjustments ) >>> list ( combined ) [&#39;music&#39;, &#39;art&#39;, &#39;opera&#39;] Changed in version 3.9: Added support for | and |= operators, specified in PEP 584 . See also The MultiContext class in the Enthought CodeTools package has options to support writing to any mapping in the chain. Django‚Äôs Context class for templating is a read-only chain of mappings. It also features pushing and popping of contexts similar to the new_child() method and the parents property. The Nested Contexts recipe has options to control whether writes and other mutations apply only to the first mapping or to any mapping in the chain. A greatly simplified read-only version of Chainmap . ChainMap Examples and Recipes ¬∂ This section shows various approaches to working with chained maps. Example of simulating Python‚Äôs internal lookup chain: import builtins pylookup = ChainMap ( locals (), globals (), vars ( builtins )) Example of letting user specified command-line arguments take precedence over environment variables which in turn take precedence over default values: import os , argparse defaults = { &#39;color&#39; : &#39;red&#39; , &#39;user&#39; : &#39;guest&#39; } parser = argparse . ArgumentParser () parser . add_argument ( &#39;-u&#39; , &#39;--user&#39; ) parser . add_argument ( &#39;-c&#39; , &#39;--color&#39; ) namespace = parser . parse_args () command_line_args = { k : v for k , v in vars ( namespace ) . items () if v is not None } combined = ChainMap ( command_line_args , os . environ , defaults ) print ( combined [ &#39;color&#39; ]) print ( combined [ &#39;user&#39; ]) Example patterns for using the ChainMap class to simulate nested contexts: c = ChainMap () # Create root context d = c . new_child () # Create nested child context e = c . new_child () # Child of c, independent from d e . maps [ 0 ] # Current context dictionary -- like Python&#39;s locals() e . maps [ - 1 ] # Root context -- like Python&#39;s globals() e . parents # Enclosing context chain -- like Python&#39;s nonlocals d [ &#39;x&#39; ] = 1 # Set value in current context d [ &#39;x&#39; ] # Get first key in the chain of contexts del d [ &#39;x&#39; ] # Delete from current context list ( d ) # All nested values k in d # Check all nested values len ( d ) # Number of nested values d . items () # All nested items dict ( d ) # Flatten into a regular dictionary The ChainMap class only makes updates (writes and deletions) to the first mapping in the chain while lookups will search the full chain. However, if deep writes and deletions are desired, it is easy to make a subclass that updates keys found deeper in the chain: class DeepChainMap ( ChainMap ): &#39;Variant of ChainMap that allows direct updates to inner scopes&#39; def __setitem__ ( self , key , value ): for mapping in self . maps : if key in mapping : mapping [ key ] = value return self . maps [ 0 ][ key ] = value def __delitem__ ( self , key ): for mapping in self . maps : if key in mapping : del mapping [ key ] return raise KeyError ( key ) >>> d = DeepChainMap ({ &#39;zebra&#39; : &#39;black&#39; }, { &#39;elephant&#39; : &#39;blue&#39; }, { &#39;lion&#39; : &#39;yellow&#39; }) >>> d [ &#39;lion&#39; ] = &#39;orange&#39; # update an existing key two levels down >>> d [ &#39;snake&#39; ] = &#39;red&#39; # new keys get added to the topmost dict >>> del d [ &#39;elephant&#39; ] # remove an existing key one level down >>> d # display result DeepChainMap ({ &#39;zebra&#39; : &#39;black&#39; , &#39;snake&#39; : &#39;red&#39; }, {}, { &#39;lion&#39; : &#39;orange&#39; }) Counter objects ¬∂ A counter tool is provided to support convenient and rapid tallies. For example: >>> # Tally occurrences of words in a list >>> cnt = Counter () >>> for word in [ &#39;red&#39; , &#39;blue&#39; , &#39;red&#39; , &#39;green&#39; , &#39;blue&#39; , &#39;blue&#39; ]: ... cnt [ word ] += 1 ... >>> cnt Counter({&#39;blue&#39;: 3, &#39;red&#39;: 2, &#39;green&#39;: 1}) >>> # Find the ten most common words in Hamlet >>> import re >>> words = re . findall ( r &#39;\\w+&#39; , open ( &#39;hamlet.txt&#39; ) . read () . lower ()) >>> Counter ( words ) . most_common ( 10 ) [(&#39;the&#39;, 1143), (&#39;and&#39;, 966), (&#39;to&#39;, 762), (&#39;of&#39;, 669), (&#39;i&#39;, 631), (&#39;you&#39;, 554), (&#39;a&#39;, 546), (&#39;my&#39;, 514), (&#39;hamlet&#39;, 471), (&#39;in&#39;, 451)] class collections. Counter ( [ iterable-or-mapping ] ) ¬∂ A Counter is a dict subclass for counting hashable objects. It is a collection where elements are stored as dictionary keys and their counts are stored as dictionary values. Counts are allowed to be any integer value including zero or negative counts. The Counter class is similar to bags or multisets in other languages. Elements are counted from an iterable or initialized from another mapping (or counter): >>> c = Counter () # a new, empty counter >>> c = Counter ( &#39;gallahad&#39; ) # a new counter from an iterable >>> c = Counter ({ &#39;red&#39; : 4 , &#39;blue&#39; : 2 }) # a new counter from a mapping >>> c = Counter ( cats = 4 , dogs = 8 ) # a new counter from keyword args Counter objects have a dictionary interface except that they return a zero count for missing items instead of raising a KeyError : >>> c = Counter ([ &#39;eggs&#39; , &#39;ham&#39; ]) >>> c [ &#39;bacon&#39; ] # count of a missing element is zero 0 Setting a count to zero does not remove an element from a counter. Use del to remove it entirely: >>> c [ &#39;sausage&#39; ] = 0 # counter entry with a zero count >>> del c [ &#39;sausage&#39; ] # del actually removes the entry Added in version 3.1. Changed in version 3.7: As a dict subclass, Counter inherited the capability to remember insertion order. Math operations on Counter objects also preserve order. Results are ordered according to when an element is first encountered in the left operand and then by the order encountered in the right operand. Counter objects support additional methods beyond those available for all dictionaries: elements ( ) ¬∂ Return an iterator over elements repeating each as many times as its count. Elements are returned in the order first encountered. If an element‚Äôs count is less than one, elements() will ignore it. >>> c = Counter ( a = 4 , b = 2 , c = 0 , d =- 2 ) >>> sorted ( c . elements ()) [&#39;a&#39;, &#39;a&#39;, &#39;a&#39;, &#39;a&#39;, &#39;b&#39;, &#39;b&#39;] most_common ( [ n ] ) ¬∂ Return a list of the n most common elements and their counts from the most common to the least. If n is omitted or None , most_common() returns all elements in the counter. Elements with equal counts are ordered in the order first encountered: >>> Counter ( &#39;abracadabra&#39; ) . most_common ( 3 ) [(&#39;a&#39;, 5), (&#39;b&#39;, 2), (&#39;r&#39;, 2)] subtract ( [ iterable-or-mapping ] ) ¬∂ Elements are subtracted from an iterable or from another mapping (or counter). Like dict.update() but subtracts counts instead of replacing them. Both inputs and outputs may be zero or negative. >>> c = Counter ( a = 4 , b = 2 , c = 0 , d =- 2 ) >>> d = Counter ( a = 1 , b = 2 , c = 3 , d = 4 ) >>> c . subtract ( d ) >>> c Counter({&#39;a&#39;: 3, &#39;b&#39;: 0, &#39;c&#39;: -3, &#39;d&#39;: -6}) Added in version 3.2. total ( ) ¬∂ Compute the sum of the counts. >>> c = Counter ( a = 10 , b = 5 , c = 0 ) >>> c . total () 15 Added in version 3.10. The usual dictionary methods are available for Counter objects except for two which work differently for counters. fromkeys ( iterable ) ¬∂ This class method is not implemented for Counter objects. update ( [ iterable-or-mapping ] ) ¬∂ Elements are counted from an iterable or added-in from another mapping (or counter). Like dict.update() but adds counts instead of replacing them. Also, the iterable is expected to be a sequence of elements, not a sequence of (key, value) pairs. Counters support rich comparison operators for equality, subset, and superset relationships: == , != , < , <= , > , >= . All of those tests treat missing elements as having zero counts so that Counter(a=1) == Counter(a=1, b=0) returns true. Changed in version 3.10: Rich comparison operations were added. Changed in version 3.10: In equality tests, missing elements are treated as having zero counts. Formerly, Counter(a=3) and Counter(a=3, b=0) were considered distinct. Common patterns for working with Counter objects: c . total () # total of all counts c . clear () # reset all counts list ( c ) # list unique elements set ( c ) # convert to a set dict ( c ) # convert to a regular dictionary c . items () # access the (elem, cnt) pairs Counter ( dict ( list_of_pairs )) # convert from a list of (elem, cnt) pairs c . most_common ()[: - n - 1 : - 1 ] # n least common elements + c # remove zero and negative counts Several mathematical operations are provided for combining Counter objects to produce multisets (counters that have counts greater than zero). Addition and subtraction combine counters by adding or subtracting the counts of corresponding elements. Intersection and union return the minimum and maximum of corresponding counts. Equality and inclusion compare corresponding counts. Each operation can accept inputs with signed counts, but the output will exclude results with counts of zero or less. >>> c = Counter ( a = 3 , b = 1 ) >>> d = Counter ( a = 1 , b = 2 ) >>> c + d # add two counters together: c[x] + d[x] Counter({&#39;a&#39;: 4, &#39;b&#39;: 3}) >>> c - d # subtract (keeping only positive counts) Counter({&#39;a&#39;: 2}) >>> c & d # intersection: min(c[x], d[x]) Counter({&#39;a&#39;: 1, &#39;b&#39;: 1}) >>> c | d # union: max(c[x], d[x]) Counter({&#39;a&#39;: 3, &#39;b&#39;: 2}) >>> c == d # equality: c[x] == d[x] False >>> c <= d # inclusion: c[x] <= d[x] False Unary addition and subtraction are shortcuts for adding an empty counter or subtracting from an empty counter. >>> c = Counter ( a = 2 , b =- 4 ) >>> + c Counter({&#39;a&#39;: 2}) >>> - c Counter({&#39;b&#39;: 4}) Added in version 3.3: Added support for unary plus, unary minus, and in-place multiset operations. Note Counters were primarily designed to work with positive integers to represent running counts; however, care was taken to not unnecessarily preclude use cases needing other types or negative values. To help with those use cases, this section documents the minimum range and type restrictions. The Counter class itself is a dictionary subclass with no restrictions on its keys and values. The values are intended to be numbers representing counts, but you could store anything in the value field. The most_common() method requires only that the values be orderable. For in-place operations such as c[key] += 1 , the value type need only support addition and subtraction. So fractions, floats, and decimals would work and negative values are supported. The same is also true for update() and subtract() which allow negative and zero values for both inputs and outputs. The multiset methods are designed only for use cases with positive values. The inputs may be negative or zero, but only outputs with positive values are created. There are no type restrictions, but the value type needs to support addition, subtraction, and comparison. The elements() method requires integer counts. It ignores zero and negative counts. See also Bag class in Smalltalk. Wikipedia entry for Multisets . C++ multisets tutorial with examples. For mathematical operations on multisets and their use cases, see Knuth, Donald. The Art of Computer Programming Volume II, Section 4.6.3, Exercise 19 . To enumerate all distinct multisets of a given size over a given set of elements, see itertools.combinations_with_replacement() : map ( Counter , combinations_with_replacement ( &#39;ABC&#39; , 2 )) # --> AA AB AC BB BC CC deque objects ¬∂ class collections. deque ( [ iterable [ , maxlen ] ] ) ¬∂ Returns a new deque object initialized left-to-right (using append() ) with data from iterable . If iterable is not specified, the new deque is empty. Deques are a generalization of stacks and queues (the name is pronounced ‚Äúdeck‚Äù and is short for ‚Äúdouble-ended queue‚Äù). Deques support thread-safe, memory efficient appends and pops from either side of the deque with approximately the same O (1) performance in either direction. Though list objects support similar operations, they are optimized for fast fixed-length operations and incur O ( n ) memory movement costs for pop(0) and insert(0, v) operations which change both the size and position of the underlying data representation. If maxlen is not specified or is None , deques may grow to an arbitrary length. Otherwise, the deque is bounded to the specified maximum length. Once a bounded length deque is full, when new items are added, a corresponding number of items are discarded from the opposite end. Bounded length deques provide functionality similar to the tail filter in Unix. They are also useful for tracking transactions and other pools of data where only the most recent activity is of interest. Deque objects support the following methods: append ( x ) ¬∂ Add x to the right side of the deque. appendleft ( x ) ¬∂ Add x to the left side of the deque. clear ( ) ¬∂ Remove all elements from the deque leaving it with length 0. copy ( ) ¬∂ Create a shallow copy of the deque. Added in version 3.5. count ( x ) ¬∂ Count the number of deque elements equal to x . Added in version 3.2. extend ( iterable ) ¬∂ Extend the right side of the deque by appending elements from the iterable argument. extendleft ( iterable ) ¬∂ Extend the left side of the deque by appending elements from iterable . Note, the series of left appends results in reversing the order of elements in the iterable argument. index ( x [ , start [ , stop ] ] ) ¬∂ Return the position of x in the deque (at or after index start and before index stop ). Returns the first match or raises ValueError if not found. Added in version 3.5. insert ( i , x ) ¬∂ Insert x into the deque at position i . If the insertion would cause a bounded deque to grow beyond maxlen , an IndexError is raised. Added in version 3.5. pop ( ) ¬∂ Remove and return an element from the right side of the deque. If no elements are present, raises an IndexError . popleft ( ) ¬∂ Remove and return an element from the left side of the deque. If no elements are present, raises an IndexError . remove ( value ) ¬∂ Remove the first occurrence of value . If not found, raises a ValueError . reverse ( ) ¬∂ Reverse the elements of the deque in-place and then return None . Added in version 3.2. rotate ( n = 1 ) ¬∂ Rotate the deque n steps to the right. If n is negative, rotate to the left. When the deque is not empty, rotating one step to the right is equivalent to d.appendleft(d.pop()) , and rotating one step to the left is equivalent to d.append(d.popleft()) . Deque objects also provide one read-only attribute: maxlen ¬∂ Maximum size of a deque or None if unbounded. Added in version 3.1. In addition to the above, deques support iteration, pickling, len(d) , reversed(d) , copy.copy(d) , copy.deepcopy(d) , membership testing with the in operator, and subscript references such as d[0] to access the first element. Indexed access is O (1) at both ends but slows to O ( n ) in the middle. For fast random access, use lists instead. Starting in version 3.5, deques support __add__() , __mul__() , and __imul__() . Example: >>> from collections import deque >>> d = deque ( &#39;ghi&#39; ) # make a new deque with three items >>> for elem in d : # iterate over the deque&#39;s elements ... print ( elem . upper ()) G H I >>> d . append ( &#39;j&#39; ) # add a new entry to the right side >>> d . appendleft ( &#39;f&#39; ) # add a new entry to the left side >>> d # show the representation of the deque deque([&#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;]) >>> d . pop () # return and remove the rightmost item &#39;j&#39; >>> d . popleft () # return and remove the leftmost item &#39;f&#39; >>> list ( d ) # list the contents of the deque [&#39;g&#39;, &#39;h&#39;, &#39;i&#39;] >>> d [ 0 ] # peek at leftmost item &#39;g&#39; >>> d [ - 1 ] # peek at rightmost item &#39;i&#39; >>> list ( reversed ( d )) # list the contents of a deque in reverse [&#39;i&#39;, &#39;h&#39;, &#39;g&#39;] >>> &#39;h&#39; in d # search the deque True >>> d . extend ( &#39;jkl&#39; ) # add multiple elements at once >>> d deque([&#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;]) >>> d . rotate ( 1 ) # right rotation >>> d deque([&#39;l&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;]) >>> d . rotate ( - 1 ) # left rotation >>> d deque([&#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;]) >>> deque ( reversed ( d )) # make a new deque in reverse order deque([&#39;l&#39;, &#39;k&#39;, &#39;j&#39;, &#39;i&#39;, &#39;h&#39;, &#39;g&#39;]) >>> d . clear () # empty the deque >>> d . pop () # cannot pop from an empty deque Traceback (most recent call last): File \"<pyshell#6>\" , line 1 , in - toplevel - d . pop () IndexError : pop from an empty deque >>> d . extendleft ( &#39;abc&#39; ) # extendleft() reverses the input order >>> d deque([&#39;c&#39;, &#39;b&#39;, &#39;a&#39;]) deque Recipes ¬∂ This section shows various approaches to working with deques. Bounded length deques provide functionality similar to the tail filter in Unix: def tail ( filename , n = 10 ): &#39;Return the last n lines of a file&#39; with open ( filename ) as f : return deque ( f , n ) Another approach to using deques is to maintain a sequence of recently added elements by appending to the right and popping to the left: def moving_average ( iterable , n = 3 ): # moving_average([40, 30, 50, 46, 39, 44]) --> 40.0 42.0 45.0 43.0 # https://en.wikipedia.org/wiki/Moving_average it = iter ( iterable ) d = deque ( itertools . islice ( it , n - 1 )) d . appendleft ( 0 ) s = sum ( d ) for elem in it : s += elem - d . popleft () d . append ( elem ) yield s / n A round-robin scheduler can be implemented with input iterators stored in a deque . Values are yielded from the active iterator in position zero. If that iterator is exhausted, it can be removed with popleft() ; otherwise, it can be cycled back to the end with the rotate() method: def roundrobin ( * iterables ): \"roundrobin(&#39;ABC&#39;, &#39;D&#39;, &#39;EF&#39;) --> A D E B F C\" iterators = deque ( map ( iter , iterables )) while iterators : try : while True : yield next ( iterators [ 0 ]) iterators . rotate ( - 1 ) except StopIteration : # Remove an exhausted iterator. iterators . popleft () The rotate() method provides a way to implement deque slicing and deletion. For example, a pure Python implementation of del d[n] relies on the rotate() method to position elements to be popped: def delete_nth ( d , n ): d . rotate ( - n ) d . popleft () d . rotate ( n ) To implement deque slicing, use a similar approach applying rotate() to bring a target element to the left side of the deque. Remove old entries with popleft() , add new entries with extend() , and then reverse the rotation. With minor variations on that approach, it is easy to implement Forth style stack manipulations such as dup , drop , swap , over , pick , rot , and roll . defaultdict objects ¬∂ class collections. defaultdict ( default_factory=None , / [ , ... ] ) ¬∂ Return a new dictionary-like object. defaultdict is a subclass of the built-in dict class. It overrides one method and adds one writable instance variable. The remaining functionality is the same as for the dict class and is not documented here. The first argument provides the initial value for the default_factory attribute; it defaults to None . All remaining arguments are treated the same as if they were passed to the dict constructor, including keyword arguments. defaultdict objects support the following method in addition to the standard dict operations: __missing__ ( key ) ¬∂ If the default_factory attribute is None , this raises a KeyError exception with the key as argument. If default_factory is not None , it is called without arguments to provide a default value for the given key , this value is inserted in the dictionary for the key , and returned. If calling default_factory raises an exception this exception is propagated unchanged. This method is called by the __getitem__() method of the dict class when the requested key is not found; whatever it returns or raises is then returned or raised by __getitem__() . Note that __missing__() is not called for any operations besides __getitem__() . This means that get() will, like normal dictionaries, return None as a default rather than using default_factory . defaultdict objects support the following instance variable: default_factory ¬∂ This attribute is used by the __missing__() method; it is initialized from the first argument to the constructor, if present, or to None , if absent. Changed in version 3.9: Added merge ( | ) and update ( |= ) operators, specified in PEP 584 . defaultdict Examples ¬∂ Using list as the default_factory , it is easy to group a sequence of key-value pairs into a dictionary of lists: >>> s = [( &#39;yellow&#39; , 1 ), ( &#39;blue&#39; , 2 ), ( &#39;yellow&#39; , 3 ), ( &#39;blue&#39; , 4 ), ( &#39;red&#39; , 1 )] >>> d = defaultdict ( list ) >>> for k , v in s : ... d [ k ] . append ( v ) ... >>> sorted ( d . items ()) [(&#39;blue&#39;, [2, 4]), (&#39;red&#39;, [1]), (&#39;yellow&#39;, [1, 3])] When each key is encountered for the first time, it is not already in the mapping; so an entry is automatically created using the default_factory function which returns an empty list . The list.append() operation then attaches the value to the new list. When keys are encountered again, the look-up proceeds normally (returning the list for that key) and the list.append() operation adds another value to the list. This technique is simpler and faster than an equivalent technique using dict.setdefault() : >>> d = {} >>> for k , v in s : ... d . setdefault ( k , []) . append ( v ) ... >>> sorted ( d . items ()) [(&#39;blue&#39;, [2, 4]), (&#39;red&#39;, [1]), (&#39;yellow&#39;, [1, 3])] Setting the default_factory to int makes the defaultdict useful for counting (like a bag or multiset in other languages): >>> s = &#39;mississippi&#39; >>> d = defaultdict ( int ) >>> for k in s : ... d [ k ] += 1 ... >>> sorted ( d . items ()) [(&#39;i&#39;, 4), (&#39;m&#39;, 1), (&#39;p&#39;, 2), (&#39;s&#39;, 4)] When a letter is first encountered, it is missing from the mapping, so the default_factory function calls int() to supply a default count of zero. The increment operation then builds up the count for each letter. The function int() which always returns zero is just a special case of constant functions. A faster and more flexible way to create constant functions is to use a lambda function which can supply any constant value (not just zero): >>> def constant_factory ( value ): ... return lambda : value ... >>> d = defaultdict ( constant_factory ( &#39;<missing>&#39; )) >>> d . update ( name = &#39;John&#39; , action = &#39;ran&#39; ) >>> &#39; %(name)s %(action)s to %(object)s &#39; % d &#39;John ran to <missing>&#39; Setting the default_factory to set makes the defaultdict useful for building a dictionary of sets: >>> s = [( &#39;red&#39; , 1 ), ( &#39;blue&#39; , 2 ), ( &#39;red&#39; , 3 ), ( &#39;blue&#39; , 4 ), ( &#39;red&#39; , 1 ), ( &#39;blue&#39; , 4 )] >>> d = defaultdict ( set ) >>> for k , v in s : ... d [ k ] . add ( v ) ... >>> sorted ( d . items ()) [(&#39;blue&#39;, {2, 4}), (&#39;red&#39;, {1, 3})] namedtuple() Factory Function for Tuples with Named Fields ¬∂ Named tuples assign meaning to each position in a tuple and allow for more readable, self-documenting code. They can be used wherever regular tuples are used, and they add the ability to access fields by name instead of position index. collections. namedtuple ( typename , field_names , * , rename = False , defaults = None , module = None ) ¬∂ Returns a new tuple subclass named typename . The new subclass is used to create tuple-like objects that have fields accessible by attribute lookup as well as being indexable and iterable. Instances of the subclass also have a helpful docstring (with typename and field_names ) and a helpful __repr__() method which lists the tuple contents in a name=value format. The field_names are a sequence of strings such as ['x', 'y'] . Alternatively, field_names can be a single string with each fieldname separated by whitespace and/or commas, for example 'x y' or 'x, y' . Any valid Python identifier may be used for a fieldname except for names starting with an underscore. Valid identifiers consist of letters, digits, and underscores but do not start with a digit or underscore and cannot be a keyword such as class , for , return , global , pass , or raise . If rename is true, invalid fieldnames are automatically replaced with positional names. For example, ['abc', 'def', 'ghi', 'abc'] is converted to ['abc', '_1', 'ghi', '_3'] , eliminating the keyword def and the duplicate fieldname abc . defaults can be None or an iterable of default values. Since fields with a default value must come after any fields without a default, the defaults are applied to the rightmost parameters. For example, if the fieldnames are ['x', 'y', 'z'] and the defaults are (1, 2) , then x will be a required argument, y will default to 1 , and z will default to 2 . If module is defined, the __module__ attribute of the named tuple is set to that value. Named tuple instances do not have per-instance dictionaries, so they are lightweight and require no more memory than regular tuples. To support pickling, the named tuple class should be assigned to a variable that matches typename . Changed in version 3.1: Added support for rename . Changed in version 3.6: The verbose and rename parameters became keyword-only arguments . Changed in version 3.6: Added the module parameter. Changed in version 3.7: Removed the verbose parameter and the _source attribute. Changed in version 3.7: Added the defaults parameter and the _field_defaults attribute. >>> # Basic example >>> Point = namedtuple ( &#39;Point&#39; , [ &#39;x&#39; , &#39;y&#39; ]) >>> p = Point ( 11 , y = 22 ) # instantiate with positional or keyword arguments >>> p [ 0 ] + p [ 1 ] # indexable like the plain tuple (11, 22) 33 >>> x , y = p # unpack like a regular tuple >>> x , y (11, 22) >>> p . x + p . y # fields also accessible by name 33 >>> p # readable __repr__ with a name=value style Point(x=11, y=22) Named tuples are especially useful for assigning field names to result tuples returned by the csv or sqlite3 modules: EmployeeRecord = namedtuple ( &#39;EmployeeRecord&#39; , &#39;name, age, title, department, paygrade&#39; ) import csv for emp in map ( EmployeeRecord . _make , csv . reader ( open ( \"employees.csv\" , \"rb\" ))): print ( emp . name , emp . title ) import sqlite3 conn = sqlite3 . connect ( &#39;/companydata&#39; ) cursor = conn . cursor () cursor . execute ( &#39;SELECT name, age, title, department, paygrade FROM employees&#39; ) for emp in map ( EmployeeRecord . _make , cursor . fetchall ()): print ( emp . name , emp . title ) In addition to the methods inherited from tuples, named tuples support three additional methods and two attributes. To prevent conflicts with field names, the method and attribute names start with an underscore. classmethod somenamedtuple. _make ( iterable ) ¬∂ Class method that makes a new instance from an existing sequence or iterable. >>> t = [ 11 , 22 ] >>> Point . _make ( t ) Point(x=11, y=22) somenamedtuple. _asdict ( ) ¬∂ Return a new dict which maps field names to their corresponding values: >>> p = Point ( x = 11 , y = 22 ) >>> p . _asdict () {&#39;x&#39;: 11, &#39;y&#39;: 22} Changed in version 3.1: Returns an OrderedDict instead of a regular dict . Changed in version 3.8: Returns a regular dict instead of an OrderedDict . As of Python 3.7, regular dicts are guaranteed to be ordered. If the extra features of OrderedDict are required, the suggested remediation is to cast the result to the desired type: OrderedDict(nt._asdict()) . somenamedtuple. _replace ( ** kwargs ) ¬∂ Return a new instance of the named tuple replacing specified fields with new values: >>> p = Point ( x = 11 , y = 22 ) >>> p . _replace ( x = 33 ) Point(x=33, y=22) >>> for partnum , record in inventory . items (): ... inventory [ partnum ] = record . _replace ( price = newprices [ partnum ], timestamp = time . now ()) Named tuples are also supported by generic function copy.replace() . Changed in version 3.13: Raise TypeError instead of ValueError for invalid keyword arguments. somenamedtuple. _fields ¬∂ Tuple of strings listing the field names. Useful for introspection and for creating new named tuple types from existing named tuples. >>> p . _fields # view the field names (&#39;x&#39;, &#39;y&#39;) >>> Color = namedtuple ( &#39;Color&#39; , &#39;red green blue&#39; ) >>> Pixel = namedtuple ( &#39;Pixel&#39; , Point . _fields + Color . _fields ) >>> Pixel ( 11 , 22 , 128 , 255 , 0 ) Pixel(x=11, y=22, red=128, green=255, blue=0) somenamedtuple. _field_defaults ¬∂ Dictionary mapping field names to default values. >>> Account = namedtuple ( &#39;Account&#39; , [ &#39;type&#39; , &#39;balance&#39; ], defaults = [ 0 ]) >>> Account . _field_defaults {&#39;balance&#39;: 0} >>> Account ( &#39;premium&#39; ) Account(type=&#39;premium&#39;, balance=0) To retrieve a field whose name is stored in a string, use the getattr() function: >>> getattr ( p , &#39;x&#39; ) 11 To convert a dictionary to a named tuple, use the double-star-operator (as described in Unpacking Argument Lists ): >>> d = { &#39;x&#39; : 11 , &#39;y&#39; : 22 } >>> Point ( ** d ) Point(x=11, y=22) Since a named tuple is a regular Python class, it is easy to add or change functionality with a subclass. Here is how to add a calculated field and a fixed-width print format: >>> class Point ( namedtuple ( &#39;Point&#39; , [ &#39;x&#39; , &#39;y&#39; ])): ... __slots__ = () ... @property ... def hypot ( self ): ... return ( self . x ** 2 + self . y ** 2 ) ** 0.5 ... def __str__ ( self ): ... return &#39;Point: x= %6.3f y= %6.3f hypot= %6.3f &#39; % ( self . x , self . y , self . hypot ) >>> for p in Point ( 3 , 4 ), Point ( 14 , 5 / 7 ): ... print ( p ) Point: x= 3.000 y= 4.000 hypot= 5.000 Point: x=14.000 y= 0.714 hypot=14.018 The subclass shown above sets __slots__ to an empty tuple. This helps keep memory requirements low by preventing the creation of instance dictionaries. Subclassing is not useful for adding new, stored fields. Instead, simply create a new named tuple type from the _fields attribute: >>> Point3D = namedtuple ( &#39;Point3D&#39; , Point . _fields + ( &#39;z&#39; ,)) Docstrings can be customized by making direct assignments to the __doc__ fields: >>> Book = namedtuple ( &#39;Book&#39; , [ &#39;id&#39; , &#39;title&#39; , &#39;authors&#39; ]) >>> Book . __doc__ += &#39;: Hardcover book in active collection&#39; >>> Book . id . __doc__ = &#39;13-digit ISBN&#39; >>> Book . title . __doc__ = &#39;Title of first printing&#39; >>> Book . authors . __doc__ = &#39;List of authors sorted by last name&#39; Changed in version 3.5: Property docstrings became writeable. See also See typing.NamedTuple for a way to add type hints for named tuples. It also provides an elegant notation using the class keyword: class Component ( NamedTuple ): part_number : int weight : float description : Optional [ str ] = None See types.SimpleNamespace() for a mutable namespace based on an underlying dictionary instead of a tuple. The dataclasses module provides a decorator and functions for automatically adding generated special methods to user-defined classes. OrderedDict objects ¬∂ Ordered dictionaries are just like regular dictionaries but have some extra capabilities relating to ordering operations. They have become less important now that the built-in dict class gained the ability to remember insertion order (this new behavior became guaranteed in Python 3.7). Some differences from dict still remain: The regular dict was designed to be very good at mapping operations. Tracking insertion order was secondary. The OrderedDict was designed to be good at reordering operations. Space efficiency, iteration speed, and the performance of update operations were secondary. The OrderedDict algorithm can handle frequent reordering operations better than dict . As shown in the recipes below, this makes it suitable for implementing various kinds of LRU caches. The equality operation for OrderedDict checks for matching order. A regular dict can emulate the order sensitive equality test with p == q and all(k1 == k2 for k1, k2 in zip(p, q)) . The popitem() method of OrderedDict has a different signature. It accepts an optional argument to specify which item is popped. A regular dict can emulate OrderedDict‚Äôs od.popitem(last=True) with d.popitem() which is guaranteed to pop the rightmost (last) item. A regular dict can emulate OrderedDict‚Äôs od.popitem(last=False) with (k := next(iter(d)), d.pop(k)) which will return and remove the leftmost (first) item if it exists. OrderedDict has a move_to_end() method to efficiently reposition an element to an endpoint. A regular dict can emulate OrderedDict‚Äôs od.move_to_end(k, last=True) with d[k] = d.pop(k) which will move the key and its associated value to the rightmost (last) position. A regular dict does not have an efficient equivalent for OrderedDict‚Äôs od.move_to_end(k, last=False) which moves the key and its associated value to the leftmost (first) position. Until Python 3.8, dict lacked a __reversed__() method. class collections. OrderedDict ( [ items ] ) ¬∂ Return an instance of a dict subclass that has methods specialized for rearranging dictionary order. Added in version 3.1. popitem ( last = True ) ¬∂ The popitem() method for ordered dictionaries returns and removes a (key, value) pair. The pairs are returned in LIFO order if last is true or FIFO order if false. move_to_end ( key , last = True ) ¬∂ Move an existing key to either end of an ordered dictionary. The item is moved to the right end if last is true (the default) or to the beginning if last is false. Raises KeyError if the key does not exist: >>> d = OrderedDict . fromkeys ( &#39;abcde&#39; ) >>> d . move_to_end ( &#39;b&#39; ) >>> &#39;&#39; . join ( d ) &#39;acdeb&#39; >>> d . move_to_end ( &#39;b&#39; , last = False ) >>> &#39;&#39; . join ( d ) &#39;bacde&#39; Added in version 3.2. In addition to the usual mapping methods, ordered dictionaries also support reverse iteration using reversed() . Equality tests between OrderedDict objects are order-sensitive and are roughly equivalent to list(od1.items())==list(od2.items()) . Equality tests between OrderedDict objects and other Mapping objects are order-insensitive like regular dictionaries. This allows OrderedDict objects to be substituted anywhere a regular dictionary is used. Changed in version 3.5: The items, keys, and values views of OrderedDict now support reverse iteration using reversed() . Changed in version 3.6: With the acceptance of PEP 468 , order is retained for keyword arguments passed to the OrderedDict constructor and its update() method. Changed in version 3.9: Added merge ( | ) and update ( |= ) operators, specified in PEP 584 . OrderedDict Examples and Recipes ¬∂ It is straightforward to create an ordered dictionary variant that remembers the order the keys were last inserted. If a new entry overwrites an existing entry, the original insertion position is changed and moved to the end: class LastUpdatedOrderedDict ( OrderedDict ): &#39;Store items in the order the keys were last added&#39; def __setitem__ ( self , key , value ): super () . __setitem__ ( key , value ) self . move_to_end ( key ) An OrderedDict would also be useful for implementing variants of functools.lru_cache() : from collections import OrderedDict from time import time class TimeBoundedLRU : \"LRU Cache that invalidates and refreshes old entries.\" def __init__ ( self , func , maxsize = 128 , maxage = 30 ): self . cache = OrderedDict () # { args : (timestamp, result)} self . func = func self . maxsize = maxsize self . maxage = maxage def __call__ ( self , * args ): if args in self . cache : self . cache . move_to_end ( args ) timestamp , result = self . cache [ args ] if time () - timestamp <= self . maxage : return result result = self . func ( * args ) self . cache [ args ] = time (), result if len ( self . cache ) > self . maxsize : self . cache . popitem ( last = False ) return result class MultiHitLRUCache : \"\"\" LRU cache that defers caching a result until it has been requested multiple times. To avoid flushing the LRU cache with one-time requests, we don&#39;t cache until a request has been made more than once. \"\"\" def __init__ ( self , func , maxsize = 128 , maxrequests = 4096 , cache_after = 1 ): self . requests = OrderedDict () # { uncached_key : request_count } self . cache = OrderedDict () # { cached_key : function_result } self . func = func self . maxrequests = maxrequests # max number of uncached requests self . maxsize = maxsize # max number of stored return values self . cache_after = cache_after def __call__ ( self , * args ): if args in self . cache : self . cache . move_to_end ( args ) return self . cache [ args ] result = self . func ( * args ) self . requests [ args ] = self . requests . get ( args , 0 ) + 1 if self . requests [ args ] <= self . cache_after : self . requests . move_to_end ( args ) if len ( self . requests ) > self . maxrequests : self . requests . popitem ( last = False ) else : self . requests . pop ( args , None ) self . cache [ args ] = result if len ( self . cache ) > self . maxsize : self . cache . popitem ( last = False ) return result UserDict objects ¬∂ The class, UserDict acts as a wrapper around dictionary objects. The need for this class has been partially supplanted by the ability to subclass directly from dict ; however, this class can be easier to work with because the underlying dictionary is accessible as an attribute. class collections. UserDict ( [ initialdata ] ) ¬∂ Class that simulates a dictionary. The instance‚Äôs contents are kept in a regular dictionary, which is accessible via the data attribute of UserDict instances. If initialdata is provided, data is initialized with its contents; note that a reference to initialdata will not be kept, allowing it to be used for other purposes. In addition to supporting the methods and operations of mappings, UserDict instances provide the following attribute: data ¬∂ A real dictionary used to store the contents of the UserDict class. UserList objects ¬∂ This class acts as a wrapper around list objects. It is a useful base class for your own list-like classes which can inherit from them and override existing methods or add new ones. In this way, one can add new behaviors to lists. The need for this class has been partially supplanted by the ability to subclass directly from list ; however, this class can be easier to work with because the underlying list is accessible as an attribute. class collections. UserList ( [ list ] ) ¬∂ Class that simulates a list. The instance‚Äôs contents are kept in a regular list, which is accessible via the data attribute of UserList instances. The instance‚Äôs contents are initially set to a copy of list , defaulting to the empty list [] . list can be any iterable, for example a real Python list or a UserList object. In addition to supporting the methods and operations of mutable sequences, UserList instances provide the following attribute: data ¬∂ A real list object used to store the contents of the UserList class. Subclassing requirements: Subclasses of UserList are expected to offer a constructor which can be called with either no arguments or one argument. List operations which return a new sequence attempt to create an instance of the actual implementation class. To do so, it assumes that the constructor can be called with a single parameter, which is a sequence object used as a data source. If a derived class does not wish to comply with this requirement, all of the special methods supported by this class will need to be overridden; please consult the sources for information about the methods which need to be provided in that case. UserString objects ¬∂ The class, UserString acts as a wrapper around string objects. The need for this class has been partially supplanted by the ability to subclass directly from str ; however, this class can be easier to work with because the underlying string is accessible as an attribute. class collections. UserString ( seq ) ¬∂ Class that simulates a string object. The instance‚Äôs content is kept in a regular string object, which is accessible via the data attribute of UserString instances. The instance‚Äôs contents are initially set to a copy of seq . The seq argument can be any object which can be converted into a string using the built-in str() function. In addition to supporting the methods and operations of strings, UserString instances provide the following attribute: data ¬∂ A real str object used to store the contents of the UserString class. Changed in version 3.5: New methods __getnewargs__ , __rmod__ , casefold , format_map , isprintable , and maketrans . Table of Contents collections ‚Äî Container datatypes ChainMap objects ChainMap Examples and Recipes Counter objects deque objects deque Recipes defaultdict objects defaultdict Examples namedtuple() Factory Function for Tuples with Named Fields OrderedDict objects OrderedDict Examples and Recipes UserDict objects UserList objects UserString objects Previous topic calendar ‚Äî General calendar-related functions Next topic collections.abc ‚Äî Abstract Base Classes for Containers This page Report a bug Show source ¬´ Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Standard Library &#187; Data Types &#187; collections ‚Äî Container datatypes | Theme Auto Light Dark | &copy; Copyright 2001 Python Software Foundation. This page is licensed under the Python Software Foundation License Version 2. Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License. See History and License for more information. The Python Software Foundation is a non-profit corporation. Please donate. Last updated on Jan 02, 2026 (19:26 UTC). Found a bug ? Created using Sphinx 8.2.3.",
      "chunk_ids": [],
      "metadata": {
        "url": "https://docs.python.org/3/library/collections.html",
        "title": "collections ‚Äî Container datatypes &#8212; Python 3.14.2 documentation"
      },
      "is_distractor": false,
      "semantic_tags": [
        "documentation",
        "function",
        "python"
      ],
      "content_hash": "68a3bc266c8a3c77",
      "size_bytes": 47237,
      "created_at": "2026-01-02T20:42:12.444607"
    },
    {
      "doc_id": "online_docs_python_org_3_library_itertools_html",
      "source": "online",
      "category": "technical",
      "domain": "python",
      "file_path": "https://docs.python.org/3/library/itertools.html",
      "content": "itertools ‚Äî Functions creating iterators for efficient looping &#8212; Python 3.14.2 documentation Theme Auto Light Dark Table of Contents itertools ‚Äî Functions creating iterators for efficient looping Itertool Functions Itertools Recipes Previous topic Functional Programming Modules Next topic functools ‚Äî Higher-order functions and operations on callable objects This page Report a bug Show source Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Standard Library &#187; Functional Programming Modules &#187; itertools ‚Äî Functions creating iterators for efficient looping | Theme Auto Light Dark | itertools ‚Äî Functions creating iterators for efficient looping ¬∂ This module implements a number of iterator building blocks inspired by constructs from APL, Haskell, and SML. Each has been recast in a form suitable for Python. The module standardizes a core set of fast, memory efficient tools that are useful by themselves or in combination. Together, they form an ‚Äúiterator algebra‚Äù making it possible to construct specialized tools succinctly and efficiently in pure Python. For instance, SML provides a tabulation tool: tabulate(f) which produces a sequence f(0), f(1), ... . The same effect can be achieved in Python by combining map() and count() to form map(f, count()) . Infinite iterators: Iterator Arguments Results Example count() [start[, step]] start, start+step, start+2*step, ‚Ä¶ count(10) ‚Üí 10 11 12 13 14 ... cycle() p p0, p1, ‚Ä¶ plast, p0, p1, ‚Ä¶ cycle('ABCD') ‚Üí A B C D A B C D ... repeat() elem [,n] elem, elem, elem, ‚Ä¶ endlessly or up to n times repeat(10, 3) ‚Üí 10 10 10 Iterators terminating on the shortest input sequence: Iterator Arguments Results Example accumulate() p [,func] p0, p0+p1, p0+p1+p2, ‚Ä¶ accumulate([1,2,3,4,5]) ‚Üí 1 3 6 10 15 batched() p, n (p0, p1, ‚Ä¶, p_n-1), ‚Ä¶ batched('ABCDEFG', n=2) ‚Üí AB CD EF G chain() p, q, ‚Ä¶ p0, p1, ‚Ä¶ plast, q0, q1, ‚Ä¶ chain('ABC', 'DEF') ‚Üí A B C D E F chain.from_iterable() iterable p0, p1, ‚Ä¶ plast, q0, q1, ‚Ä¶ chain.from_iterable(['ABC', 'DEF']) ‚Üí A B C D E F compress() data, selectors (d[0] if s[0]), (d[1] if s[1]), ‚Ä¶ compress('ABCDEF', [1,0,1,0,1,1]) ‚Üí A C E F dropwhile() predicate, seq seq[n], seq[n+1], starting when predicate fails dropwhile(lambda x: x<5, [1,4,6,3,8]) ‚Üí 6 3 8 filterfalse() predicate, seq elements of seq where predicate(elem) fails filterfalse(lambda x: x<5, [1,4,6,3,8]) ‚Üí 6 8 groupby() iterable[, key] sub-iterators grouped by value of key(v) groupby(['A','B','DEF'], len) ‚Üí (1, A B) (3, DEF) islice() seq, [start,] stop [, step] elements from seq[start:stop:step] islice('ABCDEFG', 2, None) ‚Üí C D E F G pairwise() iterable (p[0], p[1]), (p[1], p[2]) pairwise('ABCDEFG') ‚Üí AB BC CD DE EF FG starmap() func, seq func(*seq[0]), func(*seq[1]), ‚Ä¶ starmap(pow, [(2,5), (3,2), (10,3)]) ‚Üí 32 9 1000 takewhile() predicate, seq seq[0], seq[1], until predicate fails takewhile(lambda x: x<5, [1,4,6,3,8]) ‚Üí 1 4 tee() it, n it1, it2, ‚Ä¶ itn splits one iterator into n tee('ABC', 2) ‚Üí A B C, A B C zip_longest() p, q, ‚Ä¶ (p[0], q[0]), (p[1], q[1]), ‚Ä¶ zip_longest('ABCD', 'xy', fillvalue='-') ‚Üí Ax By C- D- Combinatoric iterators: Iterator Arguments Results product() p, q, ‚Ä¶ [repeat=1] cartesian product, equivalent to a nested for-loop permutations() p[, r] r-length tuples, all possible orderings, no repeated elements combinations() p, r r-length tuples, in sorted order, no repeated elements combinations_with_replacement() p, r r-length tuples, in sorted order, with repeated elements Examples Results product('ABCD', repeat=2) AA AB AC AD BA BB BC BD CA CB CC CD DA DB DC DD permutations('ABCD', 2) AB AC AD BA BC BD CA CB CD DA DB DC combinations('ABCD', 2) AB AC AD BC BD CD combinations_with_replacement('ABCD', 2) AA AB AC AD BB BC BD CC CD DD Itertool Functions ¬∂ The following functions all construct and return iterators. Some provide streams of infinite length, so they should only be accessed by functions or loops that truncate the stream. itertools. accumulate ( iterable [ , function , * , initial=None ] ) ¬∂ Make an iterator that returns accumulated sums or accumulated results from other binary functions. The function defaults to addition. The function should accept two arguments, an accumulated total and a value from the iterable . If an initial value is provided, the accumulation will start with that value and the output will have one more element than the input iterable. Roughly equivalent to: def accumulate ( iterable , function = operator . add , * , initial = None ): &#39;Return running totals&#39; # accumulate([1,2,3,4,5]) ‚Üí 1 3 6 10 15 # accumulate([1,2,3,4,5], initial=100) ‚Üí 100 101 103 106 110 115 # accumulate([1,2,3,4,5], operator.mul) ‚Üí 1 2 6 24 120 iterator = iter ( iterable ) total = initial if initial is None : try : total = next ( iterator ) except StopIteration : return yield total for element in iterator : total = function ( total , element ) yield total To compute a running minimum, set function to min() . For a running maximum, set function to max() . Or for a running product, set function to operator.mul() . To build an amortization table , accumulate the interest and apply payments: >>> data = [ 3 , 4 , 6 , 2 , 1 , 9 , 0 , 7 , 5 , 8 ] >>> list ( accumulate ( data , max )) # running maximum [3, 4, 6, 6, 6, 9, 9, 9, 9, 9] >>> list ( accumulate ( data , operator . mul )) # running product [3, 12, 72, 144, 144, 1296, 0, 0, 0, 0] # Amortize a 5% loan of 1000 with 10 annual payments of 90 >>> update = lambda balance , payment : round ( balance * 1.05 ) - payment >>> list ( accumulate ( repeat ( 90 , 10 ), update , initial = 1_000 )) [1000, 960, 918, 874, 828, 779, 728, 674, 618, 559, 497] See functools.reduce() for a similar function that returns only the final accumulated value. Added in version 3.2. Changed in version 3.3: Added the optional function parameter. Changed in version 3.8: Added the optional initial parameter. itertools. batched ( iterable , n , * , strict = False ) ¬∂ Batch data from the iterable into tuples of length n . The last batch may be shorter than n . If strict is true, will raise a ValueError if the final batch is shorter than n . Loops over the input iterable and accumulates data into tuples up to size n . The input is consumed lazily, just enough to fill a batch. The result is yielded as soon as the batch is full or when the input iterable is exhausted: >>> flattened_data = [ &#39;roses&#39; , &#39;red&#39; , &#39;violets&#39; , &#39;blue&#39; , &#39;sugar&#39; , &#39;sweet&#39; ] >>> unflattened = list ( batched ( flattened_data , 2 )) >>> unflattened [(&#39;roses&#39;, &#39;red&#39;), (&#39;violets&#39;, &#39;blue&#39;), (&#39;sugar&#39;, &#39;sweet&#39;)] Roughly equivalent to: def batched ( iterable , n , * , strict = False ): # batched(&#39;ABCDEFG&#39;, 2) ‚Üí AB CD EF G if n < 1 : raise ValueError ( &#39;n must be at least one&#39; ) iterator = iter ( iterable ) while batch := tuple ( islice ( iterator , n )): if strict and len ( batch ) != n : raise ValueError ( &#39;batched(): incomplete batch&#39; ) yield batch Added in version 3.12. Changed in version 3.13: Added the strict option. itertools. chain ( * iterables ) ¬∂ Make an iterator that returns elements from the first iterable until it is exhausted, then proceeds to the next iterable, until all of the iterables are exhausted. This combines multiple data sources into a single iterator. Roughly equivalent to: def chain ( * iterables ): # chain(&#39;ABC&#39;, &#39;DEF&#39;) ‚Üí A B C D E F for iterable in iterables : yield from iterable classmethod chain. from_iterable ( iterable ) ¬∂ Alternate constructor for chain() . Gets chained inputs from a single iterable argument that is evaluated lazily. Roughly equivalent to: def from_iterable ( iterables ): # chain.from_iterable([&#39;ABC&#39;, &#39;DEF&#39;]) ‚Üí A B C D E F for iterable in iterables : yield from iterable itertools. combinations ( iterable , r ) ¬∂ Return r length subsequences of elements from the input iterable . The output is a subsequence of product() keeping only entries that are subsequences of the iterable . The length of the output is given by math.comb() which computes n! / r! / (n - r)! when 0 ‚â§ r ‚â§ n or zero when r > n . The combination tuples are emitted in lexicographic order according to the order of the input iterable . If the input iterable is sorted, the output tuples will be produced in sorted order. Elements are treated as unique based on their position, not on their value. If the input elements are unique, there will be no repeated values within each combination. Roughly equivalent to: def combinations ( iterable , r ): # combinations(&#39;ABCD&#39;, 2) ‚Üí AB AC AD BC BD CD # combinations(range(4), 3) ‚Üí 012 013 023 123 pool = tuple ( iterable ) n = len ( pool ) if r > n : return indices = list ( range ( r )) yield tuple ( pool [ i ] for i in indices ) while True : for i in reversed ( range ( r )): if indices [ i ] != i + n - r : break else : return indices [ i ] += 1 for j in range ( i + 1 , r ): indices [ j ] = indices [ j - 1 ] + 1 yield tuple ( pool [ i ] for i in indices ) itertools. combinations_with_replacement ( iterable , r ) ¬∂ Return r length subsequences of elements from the input iterable allowing individual elements to be repeated more than once. The output is a subsequence of product() that keeps only entries that are subsequences (with possible repeated elements) of the iterable . The number of subsequence returned is (n + r - 1)! / r! / (n - 1)! when n > 0 . The combination tuples are emitted in lexicographic order according to the order of the input iterable . if the input iterable is sorted, the output tuples will be produced in sorted order. Elements are treated as unique based on their position, not on their value. If the input elements are unique, the generated combinations will also be unique. Roughly equivalent to: def combinations_with_replacement ( iterable , r ): # combinations_with_replacement(&#39;ABC&#39;, 2) ‚Üí AA AB AC BB BC CC pool = tuple ( iterable ) n = len ( pool ) if not n and r : return indices = [ 0 ] * r yield tuple ( pool [ i ] for i in indices ) while True : for i in reversed ( range ( r )): if indices [ i ] != n - 1 : break else : return indices [ i :] = [ indices [ i ] + 1 ] * ( r - i ) yield tuple ( pool [ i ] for i in indices ) Added in version 3.1. itertools. compress ( data , selectors ) ¬∂ Make an iterator that returns elements from data where the corresponding element in selectors is true. Stops when either the data or selectors iterables have been exhausted. Roughly equivalent to: def compress ( data , selectors ): # compress(&#39;ABCDEF&#39;, [1,0,1,0,1,1]) ‚Üí A C E F return ( datum for datum , selector in zip ( data , selectors ) if selector ) Added in version 3.1. itertools. count ( start = 0 , step = 1 ) ¬∂ Make an iterator that returns evenly spaced values beginning with start . Can be used with map() to generate consecutive data points or with zip() to add sequence numbers. Roughly equivalent to: def count ( start = 0 , step = 1 ): # count(10) ‚Üí 10 11 12 13 14 ... # count(2.5, 0.5) ‚Üí 2.5 3.0 3.5 ... n = start while True : yield n n += step When counting with floating-point numbers, better accuracy can sometimes be achieved by substituting multiplicative code such as: (start + step * i for i in count()) . Changed in version 3.1: Added step argument and allowed non-integer arguments. itertools. cycle ( iterable ) ¬∂ Make an iterator returning elements from the iterable and saving a copy of each. When the iterable is exhausted, return elements from the saved copy. Repeats indefinitely. Roughly equivalent to: def cycle ( iterable ): # cycle(&#39;ABCD&#39;) ‚Üí A B C D A B C D A B C D ... saved = [] for element in iterable : yield element saved . append ( element ) while saved : for element in saved : yield element This itertool may require significant auxiliary storage (depending on the length of the iterable). itertools. dropwhile ( predicate , iterable ) ¬∂ Make an iterator that drops elements from the iterable while the predicate is true and afterwards returns every element. Roughly equivalent to: def dropwhile ( predicate , iterable ): # dropwhile(lambda x: x<5, [1,4,6,3,8]) ‚Üí 6 3 8 iterator = iter ( iterable ) for x in iterator : if not predicate ( x ): yield x break for x in iterator : yield x Note this does not produce any output until the predicate first becomes false, so this itertool may have a lengthy start-up time. itertools. filterfalse ( predicate , iterable ) ¬∂ Make an iterator that filters elements from the iterable returning only those for which the predicate returns a false value. If predicate is None , returns the items that are false. Roughly equivalent to: def filterfalse ( predicate , iterable ): # filterfalse(lambda x: x<5, [1,4,6,3,8]) ‚Üí 6 8 if predicate is None : predicate = bool for x in iterable : if not predicate ( x ): yield x itertools. groupby ( iterable , key = None ) ¬∂ Make an iterator that returns consecutive keys and groups from the iterable . The key is a function computing a key value for each element. If not specified or is None , key defaults to an identity function and returns the element unchanged. Generally, the iterable needs to already be sorted on the same key function. The operation of groupby() is similar to the uniq filter in Unix. It generates a break or new group every time the value of the key function changes (which is why it is usually necessary to have sorted the data using the same key function). That behavior differs from SQL‚Äôs GROUP BY which aggregates common elements regardless of their input order. The returned group is itself an iterator that shares the underlying iterable with groupby() . Because the source is shared, when the groupby() object is advanced, the previous group is no longer visible. So, if that data is needed later, it should be stored as a list: groups = [] uniquekeys = [] data = sorted ( data , key = keyfunc ) for k , g in groupby ( data , keyfunc ): groups . append ( list ( g )) # Store group iterator as a list uniquekeys . append ( k ) groupby() is roughly equivalent to: def groupby ( iterable , key = None ): # [k for k, g in groupby(&#39;AAAABBBCCDAABBB&#39;)] ‚Üí A B C D A B # [list(g) for k, g in groupby(&#39;AAAABBBCCD&#39;)] ‚Üí AAAA BBB CC D keyfunc = ( lambda x : x ) if key is None else key iterator = iter ( iterable ) exhausted = False def _grouper ( target_key ): nonlocal curr_value , curr_key , exhausted yield curr_value for curr_value in iterator : curr_key = keyfunc ( curr_value ) if curr_key != target_key : return yield curr_value exhausted = True try : curr_value = next ( iterator ) except StopIteration : return curr_key = keyfunc ( curr_value ) while not exhausted : target_key = curr_key curr_group = _grouper ( target_key ) yield curr_key , curr_group if curr_key == target_key : for _ in curr_group : pass itertools. islice ( iterable , stop ) ¬∂ itertools. islice ( iterable , start , stop [ , step ] ) Make an iterator that returns selected elements from the iterable. Works like sequence slicing but does not support negative values for start , stop , or step . If start is zero or None , iteration starts at zero. Otherwise, elements from the iterable are skipped until start is reached. If stop is None , iteration continues until the input is exhausted, if at all. Otherwise, it stops at the specified position. If step is None , the step defaults to one. Elements are returned consecutively unless step is set higher than one which results in items being skipped. Roughly equivalent to: def islice ( iterable , * args ): # islice(&#39;ABCDEFG&#39;, 2) ‚Üí A B # islice(&#39;ABCDEFG&#39;, 2, 4) ‚Üí C D # islice(&#39;ABCDEFG&#39;, 2, None) ‚Üí C D E F G # islice(&#39;ABCDEFG&#39;, 0, None, 2) ‚Üí A C E G s = slice ( * args ) start = 0 if s . start is None else s . start stop = s . stop step = 1 if s . step is None else s . step if start < 0 or ( stop is not None and stop < 0 ) or step <= 0 : raise ValueError indices = count () if stop is None else range ( max ( start , stop )) next_i = start for i , element in zip ( indices , iterable ): if i == next_i : yield element next_i += step If the input is an iterator, then fully consuming the islice advances the input iterator by max(start, stop) steps regardless of the step value. itertools. pairwise ( iterable ) ¬∂ Return successive overlapping pairs taken from the input iterable . The number of 2-tuples in the output iterator will be one fewer than the number of inputs. It will be empty if the input iterable has fewer than two values. Roughly equivalent to: def pairwise ( iterable ): # pairwise(&#39;ABCDEFG&#39;) ‚Üí AB BC CD DE EF FG iterator = iter ( iterable ) a = next ( iterator , None ) for b in iterator : yield a , b a = b Added in version 3.10. itertools. permutations ( iterable , r = None ) ¬∂ Return successive r length permutations of elements from the iterable . If r is not specified or is None , then r defaults to the length of the iterable and all possible full-length permutations are generated. The output is a subsequence of product() where entries with repeated elements have been filtered out. The length of the output is given by math.perm() which computes n! / (n - r)! when 0 ‚â§ r ‚â§ n or zero when r > n . The permutation tuples are emitted in lexicographic order according to the order of the input iterable . If the input iterable is sorted, the output tuples will be produced in sorted order. Elements are treated as unique based on their position, not on their value. If the input elements are unique, there will be no repeated values within a permutation. Roughly equivalent to: def permutations ( iterable , r = None ): # permutations(&#39;ABCD&#39;, 2) ‚Üí AB AC AD BA BC BD CA CB CD DA DB DC # permutations(range(3)) ‚Üí 012 021 102 120 201 210 pool = tuple ( iterable ) n = len ( pool ) r = n if r is None else r if r > n : return indices = list ( range ( n )) cycles = list ( range ( n , n - r , - 1 )) yield tuple ( pool [ i ] for i in indices [: r ]) while n : for i in reversed ( range ( r )): cycles [ i ] -= 1 if cycles [ i ] == 0 : indices [ i :] = indices [ i + 1 :] + indices [ i : i + 1 ] cycles [ i ] = n - i else : j = cycles [ i ] indices [ i ], indices [ - j ] = indices [ - j ], indices [ i ] yield tuple ( pool [ i ] for i in indices [: r ]) break else : return itertools. product ( * iterables , repeat = 1 ) ¬∂ Cartesian product of the input iterables. Roughly equivalent to nested for-loops in a generator expression. For example, product(A, B) returns the same as ((x,y) for x in A for y in B) . The nested loops cycle like an odometer with the rightmost element advancing on every iteration. This pattern creates a lexicographic ordering so that if the input‚Äôs iterables are sorted, the product tuples are emitted in sorted order. To compute the product of an iterable with itself, specify the number of repetitions with the optional repeat keyword argument. For example, product(A, repeat=4) means the same as product(A, A, A, A) . This function is roughly equivalent to the following code, except that the actual implementation does not build up intermediate results in memory: def product ( * iterables , repeat = 1 ): # product(&#39;ABCD&#39;, &#39;xy&#39;) ‚Üí Ax Ay Bx By Cx Cy Dx Dy # product(range(2), repeat=3) ‚Üí 000 001 010 011 100 101 110 111 if repeat < 0 : raise ValueError ( &#39;repeat argument cannot be negative&#39; ) pools = [ tuple ( pool ) for pool in iterables ] * repeat result = [[]] for pool in pools : result = [ x + [ y ] for x in result for y in pool ] for prod in result : yield tuple ( prod ) Before product() runs, it completely consumes the input iterables, keeping pools of values in memory to generate the products. Accordingly, it is only useful with finite inputs. itertools. repeat ( object [ , times ] ) ¬∂ Make an iterator that returns object over and over again. Runs indefinitely unless the times argument is specified. Roughly equivalent to: def repeat ( object , times = None ): # repeat(10, 3) ‚Üí 10 10 10 if times is None : while True : yield object else : for i in range ( times ): yield object A common use for repeat is to supply a stream of constant values to map or zip : >>> list ( map ( pow , range ( 10 ), repeat ( 2 ))) [0, 1, 4, 9, 16, 25, 36, 49, 64, 81] itertools. starmap ( function , iterable ) ¬∂ Make an iterator that computes the function using arguments obtained from the iterable . Used instead of map() when argument parameters have already been ‚Äúpre-zipped‚Äù into tuples. The difference between map() and starmap() parallels the distinction between function(a,b) and function(*c) . Roughly equivalent to: def starmap ( function , iterable ): # starmap(pow, [(2,5), (3,2), (10,3)]) ‚Üí 32 9 1000 for args in iterable : yield function ( * args ) itertools. takewhile ( predicate , iterable ) ¬∂ Make an iterator that returns elements from the iterable as long as the predicate is true. Roughly equivalent to: def takewhile ( predicate , iterable ): # takewhile(lambda x: x<5, [1,4,6,3,8]) ‚Üí 1 4 for x in iterable : if not predicate ( x ): break yield x Note, the element that first fails the predicate condition is consumed from the input iterator and there is no way to access it. This could be an issue if an application wants to further consume the input iterator after takewhile has been run to exhaustion. To work around this problem, consider using more-itertools before_and_after() instead. itertools. tee ( iterable , n = 2 ) ¬∂ Return n independent iterators from a single iterable. Roughly equivalent to: def tee ( iterable , n = 2 ): if n < 0 : raise ValueError if n == 0 : return () iterator = _tee ( iterable ) result = [ iterator ] for _ in range ( n - 1 ): result . append ( _tee ( iterator )) return tuple ( result ) class _tee : def __init__ ( self , iterable ): it = iter ( iterable ) if isinstance ( it , _tee ): self . iterator = it . iterator self . link = it . link else : self . iterator = it self . link = [ None , None ] def __iter__ ( self ): return self def __next__ ( self ): link = self . link if link [ 1 ] is None : link [ 0 ] = next ( self . iterator ) link [ 1 ] = [ None , None ] value , self . link = link return value When the input iterable is already a tee iterator object, all members of the return tuple are constructed as if they had been produced by the upstream tee() call. This ‚Äúflattening step‚Äù allows nested tee() calls to share the same underlying data chain and to have a single update step rather than a chain of calls. The flattening property makes tee iterators efficiently peekable: def lookahead ( tee_iterator ): \"Return the next value without moving the input forward\" [ forked_iterator ] = tee ( tee_iterator , 1 ) return next ( forked_iterator ) >>> iterator = iter ( &#39;abcdef&#39; ) >>> [ iterator ] = tee ( iterator , 1 ) # Make the input peekable >>> next ( iterator ) # Move the iterator forward &#39;a&#39; >>> lookahead ( iterator ) # Check next value &#39;b&#39; >>> next ( iterator ) # Continue moving forward &#39;b&#39; tee iterators are not threadsafe. A RuntimeError may be raised when simultaneously using iterators returned by the same tee() call, even if the original iterable is threadsafe. This itertool may require significant auxiliary storage (depending on how much temporary data needs to be stored). In general, if one iterator uses most or all of the data before another iterator starts, it is faster to use list() instead of tee() . itertools. zip_longest ( * iterables , fillvalue = None ) ¬∂ Make an iterator that aggregates elements from each of the iterables . If the iterables are of uneven length, missing values are filled-in with fillvalue . If not specified, fillvalue defaults to None . Iteration continues until the longest iterable is exhausted. Roughly equivalent to: def zip_longest ( * iterables , fillvalue = None ): # zip_longest(&#39;ABCD&#39;, &#39;xy&#39;, fillvalue=&#39;-&#39;) ‚Üí Ax By C- D- iterators = list ( map ( iter , iterables )) num_active = len ( iterators ) if not num_active : return while True : values = [] for i , iterator in enumerate ( iterators ): try : value = next ( iterator ) except StopIteration : num_active -= 1 if not num_active : return iterators [ i ] = repeat ( fillvalue ) value = fillvalue values . append ( value ) yield tuple ( values ) If one of the iterables is potentially infinite, then the zip_longest() function should be wrapped with something that limits the number of calls (for example islice() or takewhile() ). Itertools Recipes ¬∂ This section shows recipes for creating an extended toolset using the existing itertools as building blocks. The primary purpose of the itertools recipes is educational. The recipes show various ways of thinking about individual tools ‚Äî for example, that chain.from_iterable is related to the concept of flattening. The recipes also give ideas about ways that the tools can be combined ‚Äî for example, how starmap() and repeat() can work together. The recipes also show patterns for using itertools with the operator and collections modules as well as with the built-in itertools such as map() , filter() , reversed() , and enumerate() . A secondary purpose of the recipes is to serve as an incubator. The accumulate() , compress() , and pairwise() itertools started out as recipes. Currently, the sliding_window() , iter_index() , and sieve() recipes are being tested to see whether they prove their worth. Substantially all of these recipes and many, many others can be installed from the more-itertools project found on the Python Package Index: python - m pip install more - itertools Many of the recipes offer the same high performance as the underlying toolset. Superior memory performance is kept by processing elements one at a time rather than bringing the whole iterable into memory all at once. Code volume is kept small by linking the tools together in a functional style . High speed is retained by preferring ‚Äúvectorized‚Äù building blocks over the use of for-loops and generators which incur interpreter overhead. from collections import Counter , deque from contextlib import suppress from functools import reduce from math import comb , prod , sumprod , isqrt from operator import itemgetter , getitem , mul , neg def take ( n , iterable ): \"Return first n items of the iterable as a list.\" return list ( islice ( iterable , n )) def prepend ( value , iterable ): \"Prepend a single value in front of an iterable.\" # prepend(1, [2, 3, 4]) ‚Üí 1 2 3 4 return chain ([ value ], iterable ) def tabulate ( function , start = 0 ): \"Return function(0), function(1), ...\" return map ( function , count ( start )) def repeatfunc ( function , times = None , * args ): \"Repeat calls to a function with specified arguments.\" if times is None : return starmap ( function , repeat ( args )) return starmap ( function , repeat ( args , times )) def flatten ( list_of_lists ): \"Flatten one level of nesting.\" return chain . from_iterable ( list_of_lists ) def ncycles ( iterable , n ): \"Returns the sequence elements n times.\" return chain . from_iterable ( repeat ( tuple ( iterable ), n )) def loops ( n ): \"Loop n times. Like range(n) but without creating integers.\" # for _ in loops(100): ... return repeat ( None , n ) def tail ( n , iterable ): \"Return an iterator over the last n items.\" # tail(3, &#39;ABCDEFG&#39;) ‚Üí E F G return iter ( deque ( iterable , maxlen = n )) def consume ( iterator , n = None ): \"Advance the iterator n-steps ahead. If n is None, consume entirely.\" # Use functions that consume iterators at C speed. if n is None : deque ( iterator , maxlen = 0 ) else : next ( islice ( iterator , n , n ), None ) def nth ( iterable , n , default = None ): \"Returns the nth item or a default value.\" return next ( islice ( iterable , n , None ), default ) def quantify ( iterable , predicate = bool ): \"Given a predicate that returns True or False, count the True results.\" return sum ( map ( predicate , iterable )) def first_true ( iterable , default = False , predicate = None ): \"Returns the first true value or the *default* if there is no true value.\" # first_true([a,b,c], x) ‚Üí a or b or c or x # first_true([a,b], x, f) ‚Üí a if f(a) else b if f(b) else x return next ( filter ( predicate , iterable ), default ) def all_equal ( iterable , key = None ): \"Returns True if all the elements are equal to each other.\" # all_equal(&#39;4Ÿ§‡Ø™‡±™‡ªî&#39;, key=int) ‚Üí True return len ( take ( 2 , groupby ( iterable , key ))) <= 1 def unique_justseen ( iterable , key = None ): \"Yield unique elements, preserving order. Remember only the element just seen.\" # unique_justseen(&#39;AAAABBBCCDAABBB&#39;) ‚Üí A B C D A B # unique_justseen(&#39;ABBcCAD&#39;, str.casefold) ‚Üí A B c A D if key is None : return map ( itemgetter ( 0 ), groupby ( iterable )) return map ( next , map ( itemgetter ( 1 ), groupby ( iterable , key ))) def unique_everseen ( iterable , key = None ): \"Yield unique elements, preserving order. Remember all elements ever seen.\" # unique_everseen(&#39;AAAABBBCCDAABBB&#39;) ‚Üí A B C D # unique_everseen(&#39;ABBcCAD&#39;, str.casefold) ‚Üí A B c D seen = set () if key is None : for element in filterfalse ( seen . __contains__ , iterable ): seen . add ( element ) yield element else : for element in iterable : k = key ( element ) if k not in seen : seen . add ( k ) yield element def unique ( iterable , key = None , reverse = False ): \"Yield unique elements in sorted order. Supports unhashable inputs.\" # unique([[1, 2], [3, 4], [1, 2]]) ‚Üí [1, 2] [3, 4] sequenced = sorted ( iterable , key = key , reverse = reverse ) return unique_justseen ( sequenced , key = key ) def sliding_window ( iterable , n ): \"Collect data into overlapping fixed-length chunks or blocks.\" # sliding_window(&#39;ABCDEFG&#39;, 4) ‚Üí ABCD BCDE CDEF DEFG iterator = iter ( iterable ) window = deque ( islice ( iterator , n - 1 ), maxlen = n ) for x in iterator : window . append ( x ) yield tuple ( window ) def grouper ( iterable , n , * , incomplete = &#39;fill&#39; , fillvalue = None ): \"Collect data into non-overlapping fixed-length chunks or blocks.\" # grouper(&#39;ABCDEFG&#39;, 3, fillvalue=&#39;x&#39;) ‚Üí ABC DEF Gxx # grouper(&#39;ABCDEFG&#39;, 3, incomplete=&#39;strict&#39;) ‚Üí ABC DEF ValueError # grouper(&#39;ABCDEFG&#39;, 3, incomplete=&#39;ignore&#39;) ‚Üí ABC DEF iterators = [ iter ( iterable )] * n match incomplete : case &#39;fill&#39; : return zip_longest ( * iterators , fillvalue = fillvalue ) case &#39;strict&#39; : return zip ( * iterators , strict = True ) case &#39;ignore&#39; : return zip ( * iterators ) case _ : raise ValueError ( &#39;Expected fill, strict, or ignore&#39; ) def roundrobin ( * iterables ): \"Visit input iterables in a cycle until each is exhausted.\" # roundrobin(&#39;ABC&#39;, &#39;D&#39;, &#39;EF&#39;) ‚Üí A D E B F C # Algorithm credited to George Sakkis iterators = map ( iter , iterables ) for num_active in range ( len ( iterables ), 0 , - 1 ): iterators = cycle ( islice ( iterators , num_active )) yield from map ( next , iterators ) def subslices ( seq ): \"Return all contiguous non-empty subslices of a sequence.\" # subslices(&#39;ABCD&#39;) ‚Üí A AB ABC ABCD B BC BCD C CD D slices = starmap ( slice , combinations ( range ( len ( seq ) + 1 ), 2 )) return map ( getitem , repeat ( seq ), slices ) def iter_index ( iterable , value , start = 0 , stop = None ): \"Return indices where a value occurs in a sequence or iterable.\" # iter_index(&#39;AABCADEAF&#39;, &#39;A&#39;) ‚Üí 0 1 4 7 seq_index = getattr ( iterable , &#39;index&#39; , None ) if seq_index is None : iterator = islice ( iterable , start , stop ) for i , element in enumerate ( iterator , start ): if element is value or element == value : yield i else : stop = len ( iterable ) if stop is None else stop i = start with suppress ( ValueError ): while True : yield ( i := seq_index ( value , i , stop )) i += 1 def iter_except ( function , exception , first = None ): \"Convert a call-until-exception interface to an iterator interface.\" # iter_except(d.popitem, KeyError) ‚Üí non-blocking dictionary iterator with suppress ( exception ): if first is not None : yield first () while True : yield function () The following recipes have a more mathematical flavor: def multinomial ( * counts ): \"Number of distinct arrangements of a multiset.\" # Counter(&#39;abracadabra&#39;).values() ‚Üí 5 2 2 1 1 # multinomial(5, 2, 2, 1, 1) ‚Üí 83160 return prod ( map ( comb , accumulate ( counts ), counts )) def powerset ( iterable ): \"Subsequences of the iterable from shortest to longest.\" # powerset([1,2,3]) ‚Üí () (1,) (2,) (3,) (1,2) (1,3) (2,3) (1,2,3) s = list ( iterable ) return chain . from_iterable ( combinations ( s , r ) for r in range ( len ( s ) + 1 )) def sum_of_squares ( iterable ): \"Add up the squares of the input values.\" # sum_of_squares([10, 20, 30]) ‚Üí 1400 return sumprod ( * tee ( iterable )) def reshape ( matrix , columns ): \"Reshape a 2-D matrix to have a given number of columns.\" # reshape([(0, 1), (2, 3), (4, 5)], 3) ‚Üí (0, 1, 2), (3, 4, 5) return batched ( chain . from_iterable ( matrix ), columns , strict = True ) def transpose ( matrix ): \"Swap the rows and columns of a 2-D matrix.\" # transpose([(1, 2, 3), (11, 22, 33)]) ‚Üí (1, 11) (2, 22) (3, 33) return zip ( * matrix , strict = True ) def matmul ( m1 , m2 ): \"Multiply two matrices.\" # matmul([(7, 5), (3, 5)], [(2, 5), (7, 9)]) ‚Üí (49, 80), (41, 60) n = len ( m2 [ 0 ]) return batched ( starmap ( sumprod , product ( m1 , transpose ( m2 ))), n ) def convolve ( signal , kernel ): \"\"\"Discrete linear convolution of two iterables. Equivalent to polynomial multiplication. Convolutions are mathematically commutative; however, the inputs are evaluated differently. The signal is consumed lazily and can be infinite. The kernel is fully consumed before the calculations begin. Article: https://betterexplained.com/articles/intuitive-convolution/ Video: https://www.youtube.com/watch?v=KuXjwB4LzSA \"\"\" # convolve([1, -1, -20], [1, -3]) ‚Üí 1 -4 -17 60 # convolve(data, [0.25, 0.25, 0.25, 0.25]) ‚Üí Moving average (blur) # convolve(data, [1/2, 0, -1/2]) ‚Üí 1st derivative estimate # convolve(data, [1, -2, 1]) ‚Üí 2nd derivative estimate kernel = tuple ( kernel )[:: - 1 ] n = len ( kernel ) padded_signal = chain ( repeat ( 0 , n - 1 ), signal , repeat ( 0 , n - 1 )) windowed_signal = sliding_window ( padded_signal , n ) return map ( sumprod , repeat ( kernel ), windowed_signal ) def polynomial_from_roots ( roots ): \"\"\"Compute a polynomial&#39;s coefficients from its roots. (x - 5) (x + 4) (x - 3) expands to: x¬≥ -4x¬≤ -17x + 60 \"\"\" # polynomial_from_roots([5, -4, 3]) ‚Üí [1, -4, -17, 60] factors = zip ( repeat ( 1 ), map ( neg , roots )) return list ( reduce ( convolve , factors , [ 1 ])) def polynomial_eval ( coefficients , x ): \"\"\"Evaluate a polynomial at a specific value. Computes with better numeric stability than Horner&#39;s method. \"\"\" # Evaluate x¬≥ -4x¬≤ -17x + 60 at x = 5 # polynomial_eval([1, -4, -17, 60], x=5) ‚Üí 0 n = len ( coefficients ) if not n : return type ( x )( 0 ) powers = map ( pow , repeat ( x ), reversed ( range ( n ))) return sumprod ( coefficients , powers ) def polynomial_derivative ( coefficients ): \"\"\"Compute the first derivative of a polynomial. f(x) = x¬≥ -4x¬≤ -17x + 60 f&#39;(x) = 3x¬≤ -8x -17 \"\"\" # polynomial_derivative([1, -4, -17, 60]) ‚Üí [3, -8, -17] n = len ( coefficients ) powers = reversed ( range ( 1 , n )) return list ( map ( mul , coefficients , powers )) def sieve ( n ): \"Primes less than n.\" # sieve(30) ‚Üí 2 3 5 7 11 13 17 19 23 29 if n > 2 : yield 2 data = bytearray (( 0 , 1 )) * ( n // 2 ) for p in iter_index ( data , 1 , start = 3 , stop = isqrt ( n ) + 1 ): data [ p * p : n : p + p ] = bytes ( len ( range ( p * p , n , p + p ))) yield from iter_index ( data , 1 , start = 3 ) def factor ( n ): \"Prime factors of n.\" # factor(99) ‚Üí 3 3 11 # factor(1_000_000_000_000_007) ‚Üí 47 59 360620266859 # factor(1_000_000_000_000_403) ‚Üí 1000000000000403 for prime in sieve ( isqrt ( n ) + 1 ): while not n % prime : yield prime n //= prime if n == 1 : return if n > 1 : yield n def is_prime ( n ): \"Return True if n is prime.\" # is_prime(1_000_000_000_000_403) ‚Üí True return n > 1 and next ( factor ( n )) == n def totient ( n ): \"Count of natural numbers up to n that are coprime to n.\" # https://mathworld.wolfram.com/TotientFunction.html # totient(12) ‚Üí 4 because len([1, 5, 7, 11]) == 4 for prime in set ( factor ( n )): n -= n // prime return n Table of Contents itertools ‚Äî Functions creating iterators for efficient looping Itertool Functions Itertools Recipes Previous topic Functional Programming Modules Next topic functools ‚Äî Higher-order functions and operations on callable objects This page Report a bug Show source ¬´ Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Standard Library &#187; Functional Programming Modules &#187; itertools ‚Äî Functions creating iterators for efficient looping | Theme Auto Light Dark | &copy; Copyright 2001 Python Software Foundation. This page is licensed under the Python Software Foundation License Version 2. Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License. See History and License for more information. The Python Software Foundation is a non-profit corporation. Please donate. Last updated on Jan 02, 2026 (19:26 UTC). Found a bug ? Created using Sphinx 8.2.3.",
      "chunk_ids": [],
      "metadata": {
        "url": "https://docs.python.org/3/library/itertools.html",
        "title": "itertools ‚Äî Functions creating iterators for efficient looping &#8212; Python 3.14.2 documentation"
      },
      "is_distractor": false,
      "semantic_tags": [
        "documentation",
        "function",
        "python"
      ],
      "content_hash": "b8d6baa2a6ba1324",
      "size_bytes": 37656,
      "created_at": "2026-01-02T20:42:12.444719"
    },
    {
      "doc_id": "online_docs_python_org_3_library_asyncio_html",
      "source": "online",
      "category": "technical",
      "domain": "python",
      "file_path": "https://docs.python.org/3/library/asyncio.html",
      "content": "asyncio ‚Äî Asynchronous I/O &#8212; Python 3.14.2 documentation Theme Auto Light Dark Previous topic Networking and Interprocess Communication Next topic Runners This page Report a bug Show source Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Standard Library &#187; Networking and Interprocess Communication &#187; asyncio ‚Äî Asynchronous I/O | Theme Auto Light Dark | asyncio ‚Äî Asynchronous I/O ¬∂ Hello World! import asyncio async def main (): print ( &#39;Hello ...&#39; ) await asyncio . sleep ( 1 ) print ( &#39;... World!&#39; ) asyncio . run ( main ()) asyncio is a library to write concurrent code using the async/await syntax. asyncio is used as a foundation for multiple Python asynchronous frameworks that provide high-performance network and web-servers, database connection libraries, distributed task queues, etc. asyncio is often a perfect fit for IO-bound and high-level structured network code. See also A Conceptual Overview of asyncio Explanation of the fundamentals of asyncio. asyncio provides a set of high-level APIs to: run Python coroutines concurrently and have full control over their execution; perform network IO and IPC ; control subprocesses ; distribute tasks via queues ; synchronize concurrent code; Additionally, there are low-level APIs for library and framework developers to: create and manage event loops , which provide asynchronous APIs for networking , running subprocesses , handling OS signals , etc; implement efficient protocols using transports ; bridge callback-based libraries and code with async/await syntax. Availability : not WASI. This module does not work or is not available on WebAssembly. See WebAssembly platforms for more information. asyncio REPL You can experiment with an asyncio concurrent context in the REPL : $ python -m asyncio asyncio REPL ... Use \"await\" directly instead of \"asyncio.run()\". Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> import asyncio >>> await asyncio . sleep ( 10 , result = &#39;hello&#39; ) &#39;hello&#39; This REPL provides limited compatibility with PYTHON_BASIC_REPL . It is recommended that the default REPL is used for full functionality and the latest features. Raises an auditing event cpython.run_stdin with no arguments. Changed in version 3.12.5: (also 3.11.10, 3.10.15, 3.9.20, and 3.8.20) Emits audit events. Changed in version 3.13: Uses PyREPL if possible, in which case PYTHONSTARTUP is also executed. Emits audit events. Reference High-level APIs Runners Coroutines and Tasks Streams Synchronization Primitives Subprocesses Queues Exceptions Call Graph Introspection Low-level APIs Event Loop Futures Transports and Protocols Policies Platform Support Extending Guides and Tutorials High-level API Index Low-level API Index Developing with asyncio Note The source code for asyncio can be found in Lib/asyncio/ . Previous topic Networking and Interprocess Communication Next topic Runners This page Report a bug Show source ¬´ Navigation index modules | next | previous | Python &#187; 3.14.2 Documentation &#187; The Python Standard Library &#187; Networking and Interprocess Communication &#187; asyncio ‚Äî Asynchronous I/O | Theme Auto Light Dark | &copy; Copyright 2001 Python Software Foundation. This page is licensed under the Python Software Foundation License Version 2. Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License. See History and License for more information. The Python Software Foundation is a non-profit corporation. Please donate. Last updated on Jan 02, 2026 (19:26 UTC). Found a bug ? Created using Sphinx 8.2.3.",
      "chunk_ids": [],
      "metadata": {
        "url": "https://docs.python.org/3/library/asyncio.html",
        "title": "asyncio ‚Äî Asynchronous I/O &#8212; Python 3.14.2 documentation"
      },
      "is_distractor": false,
      "semantic_tags": [
        "async",
        "documentation",
        "python"
      ],
      "content_hash": "cb17046a4dcf019b",
      "size_bytes": 3695,
      "created_at": "2026-01-02T20:42:12.444782"
    },
    {
      "doc_id": "online_fastapi_tiangolo_com_tutorial_first-steps",
      "source": "online",
      "category": "technical",
      "domain": "python_web",
      "file_path": "https://fastapi.tiangolo.com/tutorial/first-steps/",
      "content": "First Steps - FastAPI Skip to content Join the FastAPI Cloud waiting list üöÄ Follow @fastapi on X (Twitter) to stay updated Follow FastAPI on LinkedIn to stay updated Subscribe to the FastAPI and friends newsletter üéâ sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor FastAPI First Steps en - English de - Deutsch es - espa√±ol pt - portugu√™s ru - —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ Initializing search fastapi/fastapi FastAPI Features Learn Reference FastAPI People Resources About Release Notes FastAPI fastapi/fastapi FastAPI Features Learn Learn Python Types Intro Concurrency and async / await Environment Variables Virtual Environments Tutorial - User Guide Tutorial - User Guide First Steps First Steps Table of contents Check it Interactive API docs Alternative API docs OpenAPI \"Schema\" API \"schema\" Data \"schema\" OpenAPI and JSON Schema Check the openapi.json What is OpenAPI for Deploy your app (optional) Recap, step by step Step 1: import FastAPI Step 2: create a FastAPI \"instance\" Step 3: create a path operation Path Operation Define a path operation decorator Step 4: define the path operation function Step 5: return the content Step 6: Deploy it About FastAPI Cloud Deploy to other cloud providers Recap Path Parameters Query Parameters Request Body Query Parameters and String Validations Path Parameters and Numeric Validations Query Parameter Models Body - Multiple Parameters Body - Fields Body - Nested Models Declare Request Example Data Extra Data Types Cookie Parameters Header Parameters Cookie Parameter Models Header Parameter Models Response Model - Return Type Extra Models Response Status Code Form Data Form Models Request Files Request Forms and Files Handling Errors Path Operation Configuration JSON Compatible Encoder Body - Updates Dependencies Dependencies Classes as Dependencies Sub-dependencies Dependencies in path operation decorators Global Dependencies Dependencies with yield Security Security Security - First Steps Get Current User Simple OAuth2 with Password and Bearer OAuth2 with Password (and hashing), Bearer with JWT tokens Middleware CORS (Cross-Origin Resource Sharing) SQL (Relational) Databases Bigger Applications - Multiple Files Background Tasks Metadata and Docs URLs Static Files Testing Debugging Advanced User Guide Advanced User Guide Path Operation Advanced Configuration Additional Status Codes Return a Response Directly Custom Response - HTML, Stream, File, others Additional Responses in OpenAPI Response Cookies Response Headers Response - Change Status Code Advanced Dependencies Advanced Security Advanced Security OAuth2 scopes HTTP Basic Auth Using the Request Directly Using Dataclasses Advanced Middleware Sub Applications - Mounts Behind a Proxy Templates WebSockets Lifespan Events Testing WebSockets Testing Events: lifespan and startup - shutdown Testing Dependencies with Overrides Async Tests Settings and Environment Variables OpenAPI Callbacks OpenAPI Webhooks Including WSGI - Flask, Django, others Generating SDKs FastAPI CLI Deployment Deployment About FastAPI versions FastAPI Cloud About HTTPS Run a Server Manually Deployments Concepts Deploy FastAPI on Cloud Providers Server Workers - Uvicorn with Workers FastAPI in Containers - Docker How To - Recipes How To - Recipes General - How To - Recipes Migrate from Pydantic v1 to Pydantic v2 GraphQL Custom Request and APIRoute class Conditional OpenAPI Extending OpenAPI Separate OpenAPI Schemas for Input and Output or Not Custom Docs UI Static Assets (Self-Hosting) Configure Swagger UI Testing a Database Use Old 403 Authentication Error Status Codes Reference Reference FastAPI class Request Parameters Status Codes UploadFile class Exceptions - HTTPException and WebSocketException Dependencies - Depends() and Security() APIRouter class Background Tasks - BackgroundTasks Request class WebSockets HTTPConnection class Response class Custom Response Classes - File, HTML, Redirect, Streaming, etc. Middleware OpenAPI OpenAPI OpenAPI docs OpenAPI models Security Tools Encoders - jsonable_encoder Static Files - StaticFiles Templating - Jinja2Templates Test Client - TestClient FastAPI People Resources Resources Help FastAPI - Get Help Development - Contributing Full Stack FastAPI Template External Links FastAPI and friends newsletter Repository Management Tasks About About Alternatives, Inspiration and Comparisons History, Design and Future Benchmarks Repository Management Release Notes Table of contents Check it Interactive API docs Alternative API docs OpenAPI \"Schema\" API \"schema\" Data \"schema\" OpenAPI and JSON Schema Check the openapi.json What is OpenAPI for Deploy your app (optional) Recap, step by step Step 1: import FastAPI Step 2: create a FastAPI \"instance\" Step 3: create a path operation Path Operation Define a path operation decorator Step 4: define the path operation function Step 5: return the content Step 6: Deploy it About FastAPI Cloud Deploy to other cloud providers Recap FastAPI Learn Tutorial - User Guide First Steps &para; The simplest FastAPI file could look like this: Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/\" ) async def root (): return { \"message\" : \"Hello World\" } Copy that to a file main.py . Run the live server: $ <font color = \"#4E9A06\" >fastapi</font> dev <u style = \"text-decoration-style:solid\" >main.py</u> <span style=\"background-color:#009485\"><font color=\"#D3D7CF\"> FastAPI </font></span> Starting development server üöÄ Searching for package file structure from directories with <font color=\"#3465A4\">__init__.py</font> files Importing from <font color=\"#75507B\">/home/user/code/</font><font color=\"#AD7FA8\">awesomeapp</font> <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> module </font></span> üêç main.py <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> code </font></span> Importing the FastAPI app object from the module with the following code: <u style=\"text-decoration-style:solid\">from </u><u style=\"text-decoration-style:solid\"><b>main</b></u><u style=\"text-decoration-style:solid\"> import </u><u style=\"text-decoration-style:solid\"><b>app</b></u> <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> app </font></span> Using import string: <font color=\"#3465A4\">main:app</font> <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> server </font></span> Server started at <font color=\"#729FCF\"><u style=\"text-decoration-style:solid\">http://127.0.0.1:8000</u></font> <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> server </font></span> Documentation at <font color=\"#729FCF\"><u style=\"text-decoration-style:solid\">http://127.0.0.1:8000/docs</u></font> <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> tip </font></span> Running in development mode, for production use: <b>fastapi run</b> Logs: <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> INFO </font></span> Will watch for changes in these directories: <b>[</b><font color=\"#4E9A06\">&apos;/home/user/code/awesomeapp&apos;</font><b>]</b> <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> INFO </font></span> Uvicorn running on <font color=\"#729FCF\"><u style=\"text-decoration-style:solid\">http://127.0.0.1:8000</u></font> <b>(</b>Press CTRL+C to quit<b>)</b> <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> INFO </font></span> Started reloader process <b>[</b><font color=\"#34E2E2\"><b>383138</b></font><b>]</b> using WatchFiles <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> INFO </font></span> Started server process <b>[</b><font color=\"#34E2E2\"><b>383153</b></font><b>]</b> <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> INFO </font></span> Waiting for application startup. <span style=\"background-color:#007166\"><font color=\"#D3D7CF\"> INFO </font></span> Application startup complete. In the output, there's a line with something like: INFO: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit) That line shows the URL where your app is being served, in your local machine. Check it &para; Open your browser at http://127.0.0.1:8000 . You will see the JSON response as: { \"message\" : \"Hello World\" } Interactive API docs &para; Now go to http://127.0.0.1:8000/docs . You will see the automatic interactive API documentation (provided by Swagger UI ): Alternative API docs &para; And now, go to http://127.0.0.1:8000/redoc . You will see the alternative automatic documentation (provided by ReDoc ): OpenAPI &para; FastAPI generates a \"schema\" with all your API using the OpenAPI standard for defining APIs. \"Schema\" &para; A \"schema\" is a definition or description of something. Not the code that implements it, but just an abstract description. API \"schema\" &para; In this case, OpenAPI is a specification that dictates how to define a schema of your API. This schema definition includes your API paths, the possible parameters they take, etc. Data \"schema\" &para; The term \"schema\" might also refer to the shape of some data, like a JSON content. In that case, it would mean the JSON attributes, and data types they have, etc. OpenAPI and JSON Schema &para; OpenAPI defines an API schema for your API. And that schema includes definitions (or \"schemas\") of the data sent and received by your API using JSON Schema , the standard for JSON data schemas. Check the openapi.json &para; If you are curious about how the raw OpenAPI schema looks like, FastAPI automatically generates a JSON (schema) with the descriptions of all your API. You can see it directly at: http://127.0.0.1:8000/openapi.json . It will show a JSON starting with something like: { \"openapi\" : \"3.1.0\" , \"info\" : { \"title\" : \"FastAPI\" , \"version\" : \"0.1.0\" }, \"paths\" : { \"/items/\" : { \"get\" : { \"responses\" : { \"200\" : { \"description\" : \"Successful Response\" , \"content\" : { \"application/json\" : { ... What is OpenAPI for &para; The OpenAPI schema is what powers the two interactive documentation systems included. And there are dozens of alternatives, all based on OpenAPI. You could easily add any of those alternatives to your application built with FastAPI . You could also use it to generate code automatically, for clients that communicate with your API. For example, frontend, mobile or IoT applications. Deploy your app (optional) &para; You can optionally deploy your FastAPI app to FastAPI Cloud , go and join the waiting list if you haven't. üöÄ If you already have a FastAPI Cloud account (we invited you from the waiting list üòâ), you can deploy your application with one command. Before deploying, make sure you are logged in: $ fastapi login You are logged in to FastAPI Cloud üöÄ Then deploy your app: $ fastapi deploy Deploying to FastAPI Cloud... ‚úÖ Deployment successful! üêî Ready the chicken! Your app is ready at https://myapp.fastapicloud.dev That's it! Now you can access your app at that URL. ‚ú® Recap, step by step &para; Step 1: import FastAPI &para; Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/\" ) async def root (): return { \"message\" : \"Hello World\" } FastAPI is a Python class that provides all the functionality for your API. Technical Details FastAPI is a class that inherits directly from Starlette . You can use all the Starlette functionality with FastAPI too. Step 2: create a FastAPI \"instance\" &para; Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/\" ) async def root (): return { \"message\" : \"Hello World\" } Here the app variable will be an \"instance\" of the class FastAPI . This will be the main point of interaction to create all your API. Step 3: create a path operation &para; Path &para; \"Path\" here refers to the last part of the URL starting from the first / . So, in a URL like: https://example.com/items/foo ...the path would be: /items/foo Info A \"path\" is also commonly called an \"endpoint\" or a \"route\". While building an API, the \"path\" is the main way to separate \"concerns\" and \"resources\". Operation &para; \"Operation\" here refers to one of the HTTP \"methods\". One of: POST GET PUT DELETE ...and the more exotic ones: OPTIONS HEAD PATCH TRACE In the HTTP protocol, you can communicate to each path using one (or more) of these \"methods\". When building APIs, you normally use these specific HTTP methods to perform a specific action. Normally you use: POST : to create data. GET : to read data. PUT : to update data. DELETE : to delete data. So, in OpenAPI, each of the HTTP methods is called an \"operation\". We are going to call them \" operations \" too. Define a path operation decorator &para; Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/\" ) async def root (): return { \"message\" : \"Hello World\" } The @app.get(\"/\") tells FastAPI that the function right below is in charge of handling requests that go to: the path / using a get operation @decorator Info That @something syntax in Python is called a \"decorator\". You put it on top of a function. Like a pretty decorative hat (I guess that's where the term came from). A \"decorator\" takes the function below and does something with it. In our case, this decorator tells FastAPI that the function below corresponds to the path / with an operation get . It is the \" path operation decorator \". You can also use the other operations: @app.post() @app.put() @app.delete() And the more exotic ones: @app.options() @app.head() @app.patch() @app.trace() Tip You are free to use each operation (HTTP method) as you wish. FastAPI doesn't enforce any specific meaning. The information here is presented as a guideline, not a requirement. For example, when using GraphQL you normally perform all the actions using only POST operations. Step 4: define the path operation function &para; This is our \" path operation function \": path : is / . operation : is get . function : is the function below the \"decorator\" (below @app.get(\"/\") ). Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/\" ) async def root (): return { \"message\" : \"Hello World\" } This is a Python function. It will be called by FastAPI whenever it receives a request to the URL \" / \" using a GET operation. In this case, it is an async function. You could also define it as a normal function instead of async def : Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/\" ) def root (): return { \"message\" : \"Hello World\" } Note If you don't know the difference, check the Async: \"In a hurry?\" . Step 5: return the content &para; Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/\" ) async def root (): return { \"message\" : \"Hello World\" } You can return a dict , list , singular values as str , int , etc. You can also return Pydantic models (you'll see more about that later). There are many other objects and models that will be automatically converted to JSON (including ORMs, etc). Try using your favorite ones, it's highly probable that they are already supported. Step 6: Deploy it &para; Deploy your app to FastAPI Cloud with one command: fastapi deploy . üéâ About FastAPI Cloud &para; FastAPI Cloud is built by the same author and team behind FastAPI . It streamlines the process of building , deploying , and accessing an API with minimal effort. It brings the same developer experience of building apps with FastAPI to deploying them to the cloud. üéâ FastAPI Cloud is the primary sponsor and funding provider for the FastAPI and friends open source projects. ‚ú® Deploy to other cloud providers &para; FastAPI is open source and based on standards. You can deploy FastAPI apps to any cloud provider you choose. Follow your cloud provider's guides to deploy FastAPI apps with them. ü§ì Recap &para; Import FastAPI . Create an app instance. Write a path operation decorator using decorators like @app.get(\"/\") . Define a path operation function ; for example, def root(): ... . Run the development server using the command fastapi dev . Optionally deploy your app with fastapi deploy . Back to top Previous Tutorial - User Guide Next Path Parameters The FastAPI trademark is owned by @tiangolo and is registered in the US and across other regions Made with Material for MkDocs",
      "chunk_ids": [],
      "metadata": {
        "url": "https://fastapi.tiangolo.com/tutorial/first-steps/",
        "title": "First Steps - FastAPI"
      },
      "is_distractor": false,
      "semantic_tags": [
        "api",
        "fastapi"
      ],
      "content_hash": "b075d678c6d9237f",
      "size_bytes": 16159,
      "created_at": "2026-01-02T20:42:12.444889"
    },
    {
      "doc_id": "online_fastapi_tiangolo_com_tutorial_path-params",
      "source": "online",
      "category": "technical",
      "domain": "python_web",
      "file_path": "https://fastapi.tiangolo.com/tutorial/path-params/",
      "content": "Path Parameters - FastAPI Skip to content Join the FastAPI Cloud waiting list üöÄ Follow @fastapi on X (Twitter) to stay updated Follow FastAPI on LinkedIn to stay updated Subscribe to the FastAPI and friends newsletter üéâ sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor FastAPI Path Parameters en - English de - Deutsch es - espa√±ol pt - portugu√™s ru - —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ Initializing search fastapi/fastapi FastAPI Features Learn Reference FastAPI People Resources About Release Notes FastAPI fastapi/fastapi FastAPI Features Learn Learn Python Types Intro Concurrency and async / await Environment Variables Virtual Environments Tutorial - User Guide Tutorial - User Guide First Steps Path Parameters Path Parameters Table of contents Path parameters with types Data conversion Data validation Documentation Standards-based benefits, alternative documentation Pydantic Order matters Predefined values Create an Enum class Declare a path parameter Check the docs Working with Python enumerations Compare enumeration members Get the enumeration value Return enumeration members Path parameters containing paths OpenAPI support Path convertor Recap Query Parameters Request Body Query Parameters and String Validations Path Parameters and Numeric Validations Query Parameter Models Body - Multiple Parameters Body - Fields Body - Nested Models Declare Request Example Data Extra Data Types Cookie Parameters Header Parameters Cookie Parameter Models Header Parameter Models Response Model - Return Type Extra Models Response Status Code Form Data Form Models Request Files Request Forms and Files Handling Errors Path Operation Configuration JSON Compatible Encoder Body - Updates Dependencies Dependencies Classes as Dependencies Sub-dependencies Dependencies in path operation decorators Global Dependencies Dependencies with yield Security Security Security - First Steps Get Current User Simple OAuth2 with Password and Bearer OAuth2 with Password (and hashing), Bearer with JWT tokens Middleware CORS (Cross-Origin Resource Sharing) SQL (Relational) Databases Bigger Applications - Multiple Files Background Tasks Metadata and Docs URLs Static Files Testing Debugging Advanced User Guide Advanced User Guide Path Operation Advanced Configuration Additional Status Codes Return a Response Directly Custom Response - HTML, Stream, File, others Additional Responses in OpenAPI Response Cookies Response Headers Response - Change Status Code Advanced Dependencies Advanced Security Advanced Security OAuth2 scopes HTTP Basic Auth Using the Request Directly Using Dataclasses Advanced Middleware Sub Applications - Mounts Behind a Proxy Templates WebSockets Lifespan Events Testing WebSockets Testing Events: lifespan and startup - shutdown Testing Dependencies with Overrides Async Tests Settings and Environment Variables OpenAPI Callbacks OpenAPI Webhooks Including WSGI - Flask, Django, others Generating SDKs FastAPI CLI Deployment Deployment About FastAPI versions FastAPI Cloud About HTTPS Run a Server Manually Deployments Concepts Deploy FastAPI on Cloud Providers Server Workers - Uvicorn with Workers FastAPI in Containers - Docker How To - Recipes How To - Recipes General - How To - Recipes Migrate from Pydantic v1 to Pydantic v2 GraphQL Custom Request and APIRoute class Conditional OpenAPI Extending OpenAPI Separate OpenAPI Schemas for Input and Output or Not Custom Docs UI Static Assets (Self-Hosting) Configure Swagger UI Testing a Database Use Old 403 Authentication Error Status Codes Reference Reference FastAPI class Request Parameters Status Codes UploadFile class Exceptions - HTTPException and WebSocketException Dependencies - Depends() and Security() APIRouter class Background Tasks - BackgroundTasks Request class WebSockets HTTPConnection class Response class Custom Response Classes - File, HTML, Redirect, Streaming, etc. Middleware OpenAPI OpenAPI OpenAPI docs OpenAPI models Security Tools Encoders - jsonable_encoder Static Files - StaticFiles Templating - Jinja2Templates Test Client - TestClient FastAPI People Resources Resources Help FastAPI - Get Help Development - Contributing Full Stack FastAPI Template External Links FastAPI and friends newsletter Repository Management Tasks About About Alternatives, Inspiration and Comparisons History, Design and Future Benchmarks Repository Management Release Notes Table of contents Path parameters with types Data conversion Data validation Documentation Standards-based benefits, alternative documentation Pydantic Order matters Predefined values Create an Enum class Declare a path parameter Check the docs Working with Python enumerations Compare enumeration members Get the enumeration value Return enumeration members Path parameters containing paths OpenAPI support Path convertor Recap FastAPI Learn Tutorial - User Guide Path Parameters &para; You can declare path \"parameters\" or \"variables\" with the same syntax used by Python format strings: Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/items/ {item_id} \" ) async def read_item ( item_id ): return { \"item_id\" : item_id } The value of the path parameter item_id will be passed to your function as the argument item_id . So, if you run this example and go to http://127.0.0.1:8000/items/foo , you will see a response of: { \"item_id\" : \"foo\" } Path parameters with types &para; You can declare the type of a path parameter in the function, using standard Python type annotations: Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/items/ {item_id} \" ) async def read_item ( item_id : int ): return { \"item_id\" : item_id } In this case, item_id is declared to be an int . Check This will give you editor support inside of your function, with error checks, completion, etc. Data conversion &para; If you run this example and open your browser at http://127.0.0.1:8000/items/3 , you will see a response of: { \"item_id\" : 3 } Check Notice that the value your function received (and returned) is 3 , as a Python int , not a string \"3\" . So, with that type declaration, FastAPI gives you automatic request \"parsing\" . Data validation &para; But if you go to the browser at http://127.0.0.1:8000/items/foo , you will see a nice HTTP error of: { \"detail\" : [ { \"type\" : \"int_parsing\" , \"loc\" : [ \"path\" , \"item_id\" ], \"msg\" : \"Input should be a valid integer, unable to parse string as an integer\" , \"input\" : \"foo\" } ] } because the path parameter item_id had a value of \"foo\" , which is not an int . The same error would appear if you provided a float instead of an int , as in: http://127.0.0.1:8000/items/4.2 Check So, with the same Python type declaration, FastAPI gives you data validation. Notice that the error also clearly states exactly the point where the validation didn't pass. This is incredibly helpful while developing and debugging code that interacts with your API. Documentation &para; And when you open your browser at http://127.0.0.1:8000/docs , you will see an automatic, interactive, API documentation like: Check Again, just with that same Python type declaration, FastAPI gives you automatic, interactive documentation (integrating Swagger UI). Notice that the path parameter is declared to be an integer. Standards-based benefits, alternative documentation &para; And because the generated schema is from the OpenAPI standard, there are many compatible tools. Because of this, FastAPI itself provides an alternative API documentation (using ReDoc), which you can access at http://127.0.0.1:8000/redoc : The same way, there are many compatible tools. Including code generation tools for many languages. Pydantic &para; All the data validation is performed under the hood by Pydantic , so you get all the benefits from it. And you know you are in good hands. You can use the same type declarations with str , float , bool and many other complex data types. Several of these are explored in the next chapters of the tutorial. Order matters &para; When creating path operations , you can find situations where you have a fixed path. Like /users/me , let's say that it's to get data about the current user. And then you can also have a path /users/{user_id} to get data about a specific user by some user ID. Because path operations are evaluated in order, you need to make sure that the path for /users/me is declared before the one for /users/{user_id} : Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/users/me\" ) async def read_user_me (): return { \"user_id\" : \"the current user\" } @app . get ( \"/users/ {user_id} \" ) async def read_user ( user_id : str ): return { \"user_id\" : user_id } Otherwise, the path for /users/{user_id} would match also for /users/me , \"thinking\" that it's receiving a parameter user_id with a value of \"me\" . Similarly, you cannot redefine a path operation: Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/users\" ) async def read_users (): return [ \"Rick\" , \"Morty\" ] @app . get ( \"/users\" ) async def read_users2 (): return [ \"Bean\" , \"Elfo\" ] The first one will always be used since the path matches first. Predefined values &para; If you have a path operation that receives a path parameter , but you want the possible valid path parameter values to be predefined, you can use a standard Python Enum . Create an Enum class &para; Import Enum and create a sub-class that inherits from str and from Enum . By inheriting from str the API docs will be able to know that the values must be of type string and will be able to render correctly. Then create class attributes with fixed values, which will be the available valid values: Python 3.9+ from enum import Enum from fastapi import FastAPI class ModelName ( str , Enum ): alexnet = \"alexnet\" resnet = \"resnet\" lenet = \"lenet\" app = FastAPI () @app . get ( \"/models/ {model_name} \" ) async def get_model ( model_name : ModelName ): if model_name is ModelName . alexnet : return { \"model_name\" : model_name , \"message\" : \"Deep Learning FTW!\" } if model_name . value == \"lenet\" : return { \"model_name\" : model_name , \"message\" : \"LeCNN all the images\" } return { \"model_name\" : model_name , \"message\" : \"Have some residuals\" } Tip If you are wondering, \"AlexNet\", \"ResNet\", and \"LeNet\" are just names of Machine Learning models . Declare a path parameter &para; Then create a path parameter with a type annotation using the enum class you created ( ModelName ): Python 3.9+ from enum import Enum from fastapi import FastAPI class ModelName ( str , Enum ): alexnet = \"alexnet\" resnet = \"resnet\" lenet = \"lenet\" app = FastAPI () @app . get ( \"/models/ {model_name} \" ) async def get_model ( model_name : ModelName ): if model_name is ModelName . alexnet : return { \"model_name\" : model_name , \"message\" : \"Deep Learning FTW!\" } if model_name . value == \"lenet\" : return { \"model_name\" : model_name , \"message\" : \"LeCNN all the images\" } return { \"model_name\" : model_name , \"message\" : \"Have some residuals\" } Check the docs &para; Because the available values for the path parameter are predefined, the interactive docs can show them nicely: Working with Python enumerations &para; The value of the path parameter will be an enumeration member . Compare enumeration members &para; You can compare it with the enumeration member in your created enum ModelName : Python 3.9+ from enum import Enum from fastapi import FastAPI class ModelName ( str , Enum ): alexnet = \"alexnet\" resnet = \"resnet\" lenet = \"lenet\" app = FastAPI () @app . get ( \"/models/ {model_name} \" ) async def get_model ( model_name : ModelName ): if model_name is ModelName . alexnet : return { \"model_name\" : model_name , \"message\" : \"Deep Learning FTW!\" } if model_name . value == \"lenet\" : return { \"model_name\" : model_name , \"message\" : \"LeCNN all the images\" } return { \"model_name\" : model_name , \"message\" : \"Have some residuals\" } Get the enumeration value &para; You can get the actual value (a str in this case) using model_name.value , or in general, your_enum_member.value : Python 3.9+ from enum import Enum from fastapi import FastAPI class ModelName ( str , Enum ): alexnet = \"alexnet\" resnet = \"resnet\" lenet = \"lenet\" app = FastAPI () @app . get ( \"/models/ {model_name} \" ) async def get_model ( model_name : ModelName ): if model_name is ModelName . alexnet : return { \"model_name\" : model_name , \"message\" : \"Deep Learning FTW!\" } if model_name . value == \"lenet\" : return { \"model_name\" : model_name , \"message\" : \"LeCNN all the images\" } return { \"model_name\" : model_name , \"message\" : \"Have some residuals\" } Tip You could also access the value \"lenet\" with ModelName.lenet.value . Return enumeration members &para; You can return enum members from your path operation , even nested in a JSON body (e.g. a dict ). They will be converted to their corresponding values (strings in this case) before returning them to the client: Python 3.9+ from enum import Enum from fastapi import FastAPI class ModelName ( str , Enum ): alexnet = \"alexnet\" resnet = \"resnet\" lenet = \"lenet\" app = FastAPI () @app . get ( \"/models/ {model_name} \" ) async def get_model ( model_name : ModelName ): if model_name is ModelName . alexnet : return { \"model_name\" : model_name , \"message\" : \"Deep Learning FTW!\" } if model_name . value == \"lenet\" : return { \"model_name\" : model_name , \"message\" : \"LeCNN all the images\" } return { \"model_name\" : model_name , \"message\" : \"Have some residuals\" } In your client you will get a JSON response like: { \"model_name\" : \"alexnet\" , \"message\" : \"Deep Learning FTW!\" } Path parameters containing paths &para; Let's say you have a path operation with a path /files/{file_path} . But you need file_path itself to contain a path , like home/johndoe/myfile.txt . So, the URL for that file would be something like: /files/home/johndoe/myfile.txt . OpenAPI support &para; OpenAPI doesn't support a way to declare a path parameter to contain a path inside, as that could lead to scenarios that are difficult to test and define. Nevertheless, you can still do it in FastAPI , using one of the internal tools from Starlette. And the docs would still work, although not adding any documentation telling that the parameter should contain a path. Path convertor &para; Using an option directly from Starlette you can declare a path parameter containing a path using a URL like: /files/{file_path:path} In this case, the name of the parameter is file_path , and the last part, :path , tells it that the parameter should match any path . So, you can use it with: Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/files/{file_path:path}\" ) async def read_file ( file_path : str ): return { \"file_path\" : file_path } Tip You might need the parameter to contain /home/johndoe/myfile.txt , with a leading slash ( / ). In that case, the URL would be: /files//home/johndoe/myfile.txt , with a double slash ( // ) between files and home . Recap &para; With FastAPI , by using short, intuitive and standard Python type declarations, you get: Editor support: error checks, autocompletion, etc. Data \" parsing \" Data validation API annotation and automatic documentation And you only have to declare them once. That's probably the main visible advantage of FastAPI compared to alternative frameworks (apart from the raw performance). Back to top Previous First Steps Next Query Parameters The FastAPI trademark is owned by @tiangolo and is registered in the US and across other regions Made with Material for MkDocs",
      "chunk_ids": [],
      "metadata": {
        "url": "https://fastapi.tiangolo.com/tutorial/path-params/",
        "title": "Path Parameters - FastAPI"
      },
      "is_distractor": false,
      "semantic_tags": [
        "api",
        "fastapi"
      ],
      "content_hash": "be2c4e9d1d506918",
      "size_bytes": 15509,
      "created_at": "2026-01-02T20:42:12.444949"
    },
    {
      "doc_id": "online_fastapi_tiangolo_com_tutorial_query-params",
      "source": "online",
      "category": "technical",
      "domain": "python_web",
      "file_path": "https://fastapi.tiangolo.com/tutorial/query-params/",
      "content": "Query Parameters - FastAPI Skip to content Join the FastAPI Cloud waiting list üöÄ Follow @fastapi on X (Twitter) to stay updated Follow FastAPI on LinkedIn to stay updated Subscribe to the FastAPI and friends newsletter üéâ sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor sponsor FastAPI Query Parameters en - English de - Deutsch es - espa√±ol pt - portugu√™s ru - —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ Initializing search fastapi/fastapi FastAPI Features Learn Reference FastAPI People Resources About Release Notes FastAPI fastapi/fastapi FastAPI Features Learn Learn Python Types Intro Concurrency and async / await Environment Variables Virtual Environments Tutorial - User Guide Tutorial - User Guide First Steps Path Parameters Query Parameters Query Parameters Table of contents Defaults Optional parameters Query parameter type conversion Multiple path and query parameters Required query parameters Request Body Query Parameters and String Validations Path Parameters and Numeric Validations Query Parameter Models Body - Multiple Parameters Body - Fields Body - Nested Models Declare Request Example Data Extra Data Types Cookie Parameters Header Parameters Cookie Parameter Models Header Parameter Models Response Model - Return Type Extra Models Response Status Code Form Data Form Models Request Files Request Forms and Files Handling Errors Path Operation Configuration JSON Compatible Encoder Body - Updates Dependencies Dependencies Classes as Dependencies Sub-dependencies Dependencies in path operation decorators Global Dependencies Dependencies with yield Security Security Security - First Steps Get Current User Simple OAuth2 with Password and Bearer OAuth2 with Password (and hashing), Bearer with JWT tokens Middleware CORS (Cross-Origin Resource Sharing) SQL (Relational) Databases Bigger Applications - Multiple Files Background Tasks Metadata and Docs URLs Static Files Testing Debugging Advanced User Guide Advanced User Guide Path Operation Advanced Configuration Additional Status Codes Return a Response Directly Custom Response - HTML, Stream, File, others Additional Responses in OpenAPI Response Cookies Response Headers Response - Change Status Code Advanced Dependencies Advanced Security Advanced Security OAuth2 scopes HTTP Basic Auth Using the Request Directly Using Dataclasses Advanced Middleware Sub Applications - Mounts Behind a Proxy Templates WebSockets Lifespan Events Testing WebSockets Testing Events: lifespan and startup - shutdown Testing Dependencies with Overrides Async Tests Settings and Environment Variables OpenAPI Callbacks OpenAPI Webhooks Including WSGI - Flask, Django, others Generating SDKs FastAPI CLI Deployment Deployment About FastAPI versions FastAPI Cloud About HTTPS Run a Server Manually Deployments Concepts Deploy FastAPI on Cloud Providers Server Workers - Uvicorn with Workers FastAPI in Containers - Docker How To - Recipes How To - Recipes General - How To - Recipes Migrate from Pydantic v1 to Pydantic v2 GraphQL Custom Request and APIRoute class Conditional OpenAPI Extending OpenAPI Separate OpenAPI Schemas for Input and Output or Not Custom Docs UI Static Assets (Self-Hosting) Configure Swagger UI Testing a Database Use Old 403 Authentication Error Status Codes Reference Reference FastAPI class Request Parameters Status Codes UploadFile class Exceptions - HTTPException and WebSocketException Dependencies - Depends() and Security() APIRouter class Background Tasks - BackgroundTasks Request class WebSockets HTTPConnection class Response class Custom Response Classes - File, HTML, Redirect, Streaming, etc. Middleware OpenAPI OpenAPI OpenAPI docs OpenAPI models Security Tools Encoders - jsonable_encoder Static Files - StaticFiles Templating - Jinja2Templates Test Client - TestClient FastAPI People Resources Resources Help FastAPI - Get Help Development - Contributing Full Stack FastAPI Template External Links FastAPI and friends newsletter Repository Management Tasks About About Alternatives, Inspiration and Comparisons History, Design and Future Benchmarks Repository Management Release Notes Table of contents Defaults Optional parameters Query parameter type conversion Multiple path and query parameters Required query parameters FastAPI Learn Tutorial - User Guide Query Parameters &para; When you declare other function parameters that are not part of the path parameters, they are automatically interpreted as \"query\" parameters. Python 3.9+ from fastapi import FastAPI app = FastAPI () fake_items_db = [{ \"item_name\" : \"Foo\" }, { \"item_name\" : \"Bar\" }, { \"item_name\" : \"Baz\" }] @app . get ( \"/items/\" ) async def read_item ( skip : int = 0 , limit : int = 10 ): return fake_items_db [ skip : skip + limit ] The query is the set of key-value pairs that go after the ? in a URL, separated by & characters. For example, in the URL: http://127.0.0.1:8000/items/?skip=0&limit=10 ...the query parameters are: skip : with a value of 0 limit : with a value of 10 As they are part of the URL, they are \"naturally\" strings. But when you declare them with Python types (in the example above, as int ), they are converted to that type and validated against it. All the same process that applied for path parameters also applies for query parameters: Editor support (obviously) Data \"parsing\" Data validation Automatic documentation Defaults &para; As query parameters are not a fixed part of a path, they can be optional and can have default values. In the example above they have default values of skip=0 and limit=10 . So, going to the URL: http://127.0.0.1:8000/items/ would be the same as going to: http://127.0.0.1:8000/items/?skip=0&limit=10 But if you go to, for example: http://127.0.0.1:8000/items/?skip=20 The parameter values in your function will be: skip=20 : because you set it in the URL limit=10 : because that was the default value Optional parameters &para; The same way, you can declare optional query parameters, by setting their default to None : Python 3.10+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/items/ {item_id} \" ) async def read_item ( item_id : str , q : str | None = None ): if q : return { \"item_id\" : item_id , \"q\" : q } return { \"item_id\" : item_id } ü§ì Other versions and variants Python 3.9+ from typing import Union from fastapi import FastAPI app = FastAPI () @app . get ( \"/items/ {item_id} \" ) async def read_item ( item_id : str , q : Union [ str , None ] = None ): if q : return { \"item_id\" : item_id , \"q\" : q } return { \"item_id\" : item_id } In this case, the function parameter q will be optional, and will be None by default. Check Also notice that FastAPI is smart enough to notice that the path parameter item_id is a path parameter and q is not, so, it's a query parameter. Query parameter type conversion &para; You can also declare bool types, and they will be converted: Python 3.10+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/items/ {item_id} \" ) async def read_item ( item_id : str , q : str | None = None , short : bool = False ): item = { \"item_id\" : item_id } if q : item . update ({ \"q\" : q }) if not short : item . update ( { \"description\" : \"This is an amazing item that has a long description\" } ) return item ü§ì Other versions and variants Python 3.9+ from typing import Union from fastapi import FastAPI app = FastAPI () @app . get ( \"/items/ {item_id} \" ) async def read_item ( item_id : str , q : Union [ str , None ] = None , short : bool = False ): item = { \"item_id\" : item_id } if q : item . update ({ \"q\" : q }) if not short : item . update ( { \"description\" : \"This is an amazing item that has a long description\" } ) return item In this case, if you go to: http://127.0.0.1:8000/items/foo?short=1 or http://127.0.0.1:8000/items/foo?short=True or http://127.0.0.1:8000/items/foo?short=true or http://127.0.0.1:8000/items/foo?short=on or http://127.0.0.1:8000/items/foo?short=yes or any other case variation (uppercase, first letter in uppercase, etc), your function will see the parameter short with a bool value of True . Otherwise as False . Multiple path and query parameters &para; You can declare multiple path parameters and query parameters at the same time, FastAPI knows which is which. And you don't have to declare them in any specific order. They will be detected by name: Python 3.10+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/users/ {user_id} /items/ {item_id} \" ) async def read_user_item ( user_id : int , item_id : str , q : str | None = None , short : bool = False ): item = { \"item_id\" : item_id , \"owner_id\" : user_id } if q : item . update ({ \"q\" : q }) if not short : item . update ( { \"description\" : \"This is an amazing item that has a long description\" } ) return item ü§ì Other versions and variants Python 3.9+ from typing import Union from fastapi import FastAPI app = FastAPI () @app . get ( \"/users/ {user_id} /items/ {item_id} \" ) async def read_user_item ( user_id : int , item_id : str , q : Union [ str , None ] = None , short : bool = False ): item = { \"item_id\" : item_id , \"owner_id\" : user_id } if q : item . update ({ \"q\" : q }) if not short : item . update ( { \"description\" : \"This is an amazing item that has a long description\" } ) return item Required query parameters &para; When you declare a default value for non-path parameters (for now, we have only seen query parameters), then it is not required. If you don't want to add a specific value but just make it optional, set the default as None . But when you want to make a query parameter required, you can just not declare any default value: Python 3.9+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/items/ {item_id} \" ) async def read_user_item ( item_id : str , needy : str ): item = { \"item_id\" : item_id , \"needy\" : needy } return item Here the query parameter needy is a required query parameter of type str . If you open in your browser a URL like: http://127.0.0.1:8000/items/foo-item ...without adding the required parameter needy , you will see an error like: { \"detail\" : [ { \"type\" : \"missing\" , \"loc\" : [ \"query\" , \"needy\" ], \"msg\" : \"Field required\" , \"input\" : null } ] } As needy is a required parameter, you would need to set it in the URL: http://127.0.0.1:8000/items/foo-item?needy=sooooneedy ...this would work: { \"item_id\" : \"foo-item\" , \"needy\" : \"sooooneedy\" } And of course, you can define some parameters as required, some as having a default value, and some entirely optional: Python 3.10+ from fastapi import FastAPI app = FastAPI () @app . get ( \"/items/ {item_id} \" ) async def read_user_item ( item_id : str , needy : str , skip : int = 0 , limit : int | None = None ): item = { \"item_id\" : item_id , \"needy\" : needy , \"skip\" : skip , \"limit\" : limit } return item ü§ì Other versions and variants Python 3.9+ from typing import Union from fastapi import FastAPI app = FastAPI () @app . get ( \"/items/ {item_id} \" ) async def read_user_item ( item_id : str , needy : str , skip : int = 0 , limit : Union [ int , None ] = None ): item = { \"item_id\" : item_id , \"needy\" : needy , \"skip\" : skip , \"limit\" : limit } return item In this case, there are 3 query parameters: needy , a required str . skip , an int with a default value of 0 . limit , an optional int . Tip You could also use Enum s the same way as with Path Parameters . Back to top Previous Path Parameters Next Request Body The FastAPI trademark is owned by @tiangolo and is registered in the US and across other regions Made with Material for MkDocs",
      "chunk_ids": [],
      "metadata": {
        "url": "https://fastapi.tiangolo.com/tutorial/query-params/",
        "title": "Query Parameters - FastAPI"
      },
      "is_distractor": false,
      "semantic_tags": [
        "api",
        "fastapi"
      ],
      "content_hash": "e448456edcebc04b",
      "size_bytes": 11501,
      "created_at": "2026-01-02T20:42:12.445007"
    },
    {
      "doc_id": "online_www_typescriptlang_org_docs_handbook_2_basic-types_html",
      "source": "online",
      "category": "technical",
      "domain": "typescript",
      "file_path": "https://www.typescriptlang.org/docs/handbook/2/basic-types.html",
      "content": "TypeScript: Documentation - The Basics Skip to main content TypeScript Download Docs Handbook Community Playground Tools in En Was this page helpful? Get Started TS for the New Programmer TypeScript for JS Programmers TS for Java/C# Programmers TS for Functional Programmers TypeScript Tooling in 5 minutes Handbook The TypeScript Handbook The Basics Everyday Types Narrowing More on Functions Object Types Type Manipulation Creating Types from Types Generics Keyof Type Operator Typeof Type Operator Indexed Access Types Conditional Types Mapped Types Template Literal Types Classes Modules Reference Utility Types Cheat Sheets Decorators Declaration Merging Enums Iterators and Generators JSX Mixins Namespaces Namespaces and Modules Symbols Triple-Slash Directives Type Compatibility Type Inference Variable Declaration Modules Reference Introduction Theory Guides Choosing Compiler Options Reference Appendices ESM/CJS Interoperability Tutorials ASP.NET Core Gulp DOM Manipulation Migrating from JavaScript Using Babel with TypeScript What&#x27;s New TypeScript 5.9 TypeScript 5.8 TypeScript 5.7 TypeScript 5.6 TypeScript 5.5 TypeScript 5.4 TypeScript 5.3 TypeScript 5.2 TypeScript 5.1 TypeScript 5.0 TypeScript 4.9 TypeScript 4.8 TypeScript 4.7 TypeScript 4.6 TypeScript 4.5 TypeScript 4.4 TypeScript 4.3 TypeScript 4.2 TypeScript 4.1 TypeScript 4.0 TypeScript 3.9 TypeScript 3.8 TypeScript 3.7 TypeScript 3.6 TypeScript 3.5 TypeScript 3.4 TypeScript 3.3 TypeScript 3.2 TypeScript 3.1 TypeScript 3.0 TypeScript 2.9 TypeScript 2.8 TypeScript 2.7 TypeScript 2.6 TypeScript 2.5 TypeScript 2.4 TypeScript 2.3 TypeScript 2.2 TypeScript 2.1 TypeScript 2.0 TypeScript 1.8 TypeScript 1.7 TypeScript 1.6 TypeScript 1.5 TypeScript 1.4 TypeScript 1.3 TypeScript 1.1 Declaration Files Introduction Declaration Reference Library Structures .d.ts Templates Modules .d.ts Module: Plugin Module: Class Module: Function Global .d.ts Global: Modifying Module Do&#x27;s and Don&#x27;ts Deep Dive Publishing Consumption JavaScript JS Projects Utilizing TypeScript Type Checking JavaScript Files JSDoc Reference Creating .d.ts Files from .js files Project Configuration What is a tsconfig.json Compiler Options in MSBuild TSConfig Reference tsc CLI Options Project References Integrating with Build Tools Configuring Watch Nightly Builds The Basics Welcome to the first page of the handbook. If this is your first experience with TypeScript - you may want to start at one of the ' Getting Started ' guides Each and every value in JavaScript has a set of behaviors you can observe from running different operations. That sounds abstract, but as a quick example, consider some operations we might run on a variable named message . js // Accessing the property 'toLowerCase' // on 'message' and then calling it message . toLowerCase (); // Calling 'message' message (); If we break this down, the first runnable line of code accesses a property called toLowerCase and then calls it. The second one tries to call message directly. But assuming we don‚Äôt know the value of message - and that‚Äôs pretty common - we can‚Äôt reliably say what results we‚Äôll get from trying to run any of this code. The behavior of each operation depends entirely on what value we had in the first place. Is message callable? Does it have a property called toLowerCase on it? If it does, is toLowerCase even callable? If both of these values are callable, what do they return? The answers to these questions are usually things we keep in our heads when we write JavaScript, and we have to hope we got all the details right. Let‚Äôs say message was defined in the following way. js const message = \"Hello World!\" ; As you can probably guess, if we try to run message.toLowerCase() , we‚Äôll get the same string only in lower-case. What about that second line of code? If you‚Äôre familiar with JavaScript, you‚Äôll know this fails with an exception: txt TypeError: message is not a function It‚Äôd be great if we could avoid mistakes like this. When we run our code, the way that our JavaScript runtime chooses what to do is by figuring out the type of the value - what sorts of behaviors and capabilities it has. That‚Äôs part of what that TypeError is alluding to - it‚Äôs saying that the string \"Hello World!\" cannot be called as a function. For some values, such as the primitives string and number , we can identify their type at runtime using the typeof operator. But for other things like functions, there‚Äôs no corresponding runtime mechanism to identify their types. For example, consider this function: js function fn ( x ) { return x . flip (); } We can observe by reading the code that this function will only work if given an object with a callable flip property, but JavaScript doesn‚Äôt surface this information in a way that we can check while the code is running. The only way in pure JavaScript to tell what fn does with a particular value is to call it and see what happens. This kind of behavior makes it hard to predict what the code will do before it runs, which means it‚Äôs harder to know what your code is going to do while you‚Äôre writing it. Seen in this way, a type is the concept of describing which values can be passed to fn and which will crash. JavaScript only truly provides dynamic typing - running the code to see what happens. The alternative is to use a static type system to make predictions about what the code is expected to do before it runs. Static type-checking Think back to that TypeError we got earlier from trying to call a string as a function. Most people don‚Äôt like to get any sorts of errors when running their code - those are considered bugs! And when we write new code, we try our best to avoid introducing new bugs. If we add just a bit of code, save our file, re-run the code, and immediately see the error, we might be able to isolate the problem quickly; but that‚Äôs not always the case. We might not have tested the feature thoroughly enough, so we might never actually run into a potential error that would be thrown! Or if we were lucky enough to witness the error, we might have ended up doing large refactorings and adding a lot of different code that we‚Äôre forced to dig through. Ideally, we could have a tool that helps us find these bugs before our code runs. That‚Äôs what a static type-checker like TypeScript does. Static type systems describe the shapes and behaviors of what our values will be when we run our programs. A type-checker like TypeScript uses that information and tells us when things might be going off the rails. ts const message = \"hello!\" ; message (); This expression is not callable. Type 'String' has no call signatures. 2349 This expression is not callable. Type 'String' has no call signatures. Try Running that last sample with TypeScript will give us an error message before we run the code in the first place. Non-exception Failures So far we‚Äôve been discussing certain things like runtime errors - cases where the JavaScript runtime tells us that it thinks something is nonsensical. Those cases come up because the ECMAScript specification has explicit instructions on how the language should behave when it runs into something unexpected. For example, the specification says that trying to call something that isn‚Äôt callable should throw an error. Maybe that sounds like ‚Äúobvious behavior‚Äù, but you could imagine that accessing a property that doesn‚Äôt exist on an object should throw an error too. Instead, JavaScript gives us different behavior and returns the value undefined : js const user = { name: \"Daniel\" , age: 26 , }; user . location ; // returns undefined Ultimately, a static type system has to make the call over what code should be flagged as an error in its system, even if it‚Äôs ‚Äúvalid‚Äù JavaScript that won‚Äôt immediately throw an error. In TypeScript, the following code produces an error about location not being defined: ts const user = { name : \"Daniel\" , age : 26 , }; user . location ; Property 'location' does not exist on type '{ name: string; age: number; }'. 2339 Property 'location' does not exist on type '{ name: string; age: number; }'. Try While sometimes that implies a trade-off in what you can express, the intent is to catch legitimate bugs in our programs. And TypeScript catches a lot of legitimate bugs. For example: typos, ts const announcement = \"Hello World!\" ; // How quickly can you spot the typos? announcement . toLocaleLowercase (); announcement . toLocalLowerCase (); // We probably meant to write this... announcement . toLocaleLowerCase (); Try uncalled functions, ts function flipCoin () { // Meant to be Math.random() return Math . random < 0.5 ; Operator '<' cannot be applied to types '() => number' and 'number'. 2365 Operator '<' cannot be applied to types '() => number' and 'number'. } Try or basic logic errors. ts const value = Math . random () < 0.5 ? \"a\" : \"b\" ; if ( value !== \"a\" ) { // ... } else if ( value === \"b\" ) { This comparison appears to be unintentional because the types '\"a\"' and '\"b\"' have no overlap. 2367 This comparison appears to be unintentional because the types '\"a\"' and '\"b\"' have no overlap. // Oops, unreachable } Try Types for Tooling TypeScript can catch bugs when we make mistakes in our code. That‚Äôs great, but TypeScript can also prevent us from making those mistakes in the first place. The type-checker has information to check things like whether we‚Äôre accessing the right properties on variables and other properties. Once it has that information, it can also start suggesting which properties you might want to use. That means TypeScript can be leveraged for editing code too, and the core type-checker can provide error messages and code completion as you type in the editor. That‚Äôs part of what people often refer to when they talk about tooling in TypeScript. ts import express from \"express\" ; const app = express (); app . >.get: <\"/\", {}, any, any, QueryString.ParsedQs, Record<string, any>>(path: \"/\", ...handlers: RequestHandler<{}, any, any, QueryString.ParsedQs, Record<string, any>>[]) => Express (+5 overloads)' >get ( \"/\" , function ( >' >req , , number>' >res ) { , number>' >res . sen sen d sen dDate sen dfile sen dFile sen dStatus }); app . >.listen(port: number, callback?: () => void): Server (+5 overloads)' >listen ( 3000 ); Try TypeScript takes tooling seriously, and that goes beyond completions and errors as you type. An editor that supports TypeScript can deliver ‚Äúquick fixes‚Äù to automatically fix errors, refactorings to easily re-organize code, and useful navigation features for jumping to definitions of a variable, or finding all references to a given variable. All of this is built on top of the type-checker and is fully cross-platform, so it‚Äôs likely that your favorite editor has TypeScript support available . tsc , the TypeScript compiler We‚Äôve been talking about type-checking, but we haven‚Äôt yet used our type- checker . Let‚Äôs get acquainted with our new friend tsc , the TypeScript compiler. First we‚Äôll need to grab it via npm. sh npm install -g typescript This installs the TypeScript Compiler tsc globally. You can use npx or similar tools if you‚Äôd prefer to run tsc from a local node_modules package instead. Now let‚Äôs move to an empty folder and try writing our first TypeScript program: hello.ts : ts // Greets the world. console . log ( \"Hello world!\" ); Try Notice there are no frills here; this ‚Äúhello world‚Äù program looks identical to what you‚Äôd write for a ‚Äúhello world‚Äù program in JavaScript. And now let‚Äôs type-check it by running the command tsc which was installed for us by the typescript package. sh tsc hello.ts Tada! Wait, ‚Äútada‚Äù what exactly? We ran tsc and nothing happened! Well, there were no type errors, so we didn‚Äôt get any output in our console since there was nothing to report. But check again - we got some file output instead. If we look in our current directory, we‚Äôll see a hello.js file next to hello.ts . That‚Äôs the output from our hello.ts file after tsc compiles or transforms it into a plain JavaScript file. And if we check the contents, we‚Äôll see what TypeScript spits out after it processes a .ts file: js // Greets the world. console . log ( \"Hello world!\" ); In this case, there was very little for TypeScript to transform, so it looks identical to what we wrote. The compiler tries to emit clean readable code that looks like something a person would write. While that‚Äôs not always so easy, TypeScript indents consistently, is mindful of when our code spans across different lines of code, and tries to keep comments around. What about if we did introduce a type-checking error? Let‚Äôs rewrite hello.ts : ts // This is an industrial-grade general-purpose greeter function: function greet ( person , date ) { console . log ( `Hello ${ person } , today is ${ date } !` ); } greet ( \"Brendan\" ); Try If we run tsc hello.ts again, notice that we get an error on the command line! txt Expected 2 arguments, but got 1. TypeScript is telling us we forgot to pass an argument to the greet function, and rightfully so. So far we‚Äôve only written standard JavaScript, and yet type-checking was still able to find problems with our code. Thanks TypeScript! Emitting with Errors One thing you might not have noticed from the last example was that our hello.js file changed again. If we open that file up then we‚Äôll see that the contents still basically look the same as our input file. That might be a bit surprising given the fact that tsc reported an error about our code, but this is based on one of TypeScript‚Äôs core values: much of the time, you will know better than TypeScript. To reiterate from earlier, type-checking code limits the sorts of programs you can run, and so there‚Äôs a tradeoff on what sorts of things a type-checker finds acceptable. Most of the time that‚Äôs okay, but there are scenarios where those checks get in the way. For example, imagine yourself migrating JavaScript code over to TypeScript and introducing type-checking errors. Eventually you‚Äôll get around to cleaning things up for the type-checker, but that original JavaScript code was already working! Why should converting it over to TypeScript stop you from running it? So TypeScript doesn‚Äôt get in your way. Of course, over time, you may want to be a bit more defensive against mistakes, and make TypeScript act a bit more strictly. In that case, you can use the noEmitOnError compiler option. Try changing your hello.ts file and running tsc with that flag: sh tsc --noEmitOnError hello.ts You‚Äôll notice that hello.js never gets updated. Explicit Types Up until now, we haven‚Äôt told TypeScript what person or date are. Let‚Äôs edit the code to tell TypeScript that person is a string , and that date should be a Date object. We‚Äôll also use the toDateString() method on date . ts function greet ( person : string , date : Date ) { console . log ( `Hello ${ person } , today is ${ date . toDateString () } !` ); } Try What we did was add type annotations on person and date to describe what types of values greet can be called with. You can read that signature as ‚Äù greet takes a person of type string , and a date of type Date ‚Äú. With this, TypeScript can tell us about other cases where greet might have been called incorrectly. For example‚Ä¶ ts function greet ( person : string , date : Date ) { console . log ( `Hello ${ person } , today is ${ date . toDateString () } !` ); } greet ( \"Maddison\" , string' >Date ()); Argument of type 'string' is not assignable to parameter of type 'Date'. 2345 Argument of type 'string' is not assignable to parameter of type 'Date'. Try Huh? TypeScript reported an error on our second argument, but why? Perhaps surprisingly, calling Date() in JavaScript returns a string . On the other hand, constructing a Date with new Date() actually gives us what we were expecting. Anyway, we can quickly fix up the error: ts function greet ( person : string , date : Date ) { console . log ( `Hello ${ person } , today is ${ date . toDateString () } !` ); } greet ( \"Maddison\" , new Date (+4 overloads)' >Date ()); Try Keep in mind, we don‚Äôt always have to write explicit type annotations. In many cases, TypeScript can even just infer (or ‚Äúfigure out‚Äù) the types for us even if we omit them. ts let msg = \"hello there!\" ; let msg: string Try Even though we didn‚Äôt tell TypeScript that msg had the type string it was able to figure that out. That‚Äôs a feature, and it‚Äôs best not to add annotations when the type system would end up inferring the same type anyway. Note: The message bubble inside the previous code sample is what your editor would show if you had hovered over the word. Erased Types Let‚Äôs take a look at what happens when we compile the above function greet with tsc to output JavaScript: ts \"use strict\" ; function greet ( person , date ) { console . log ( \"Hello \" . concat ( person , \", today is \" ). concat ( date . toDateString (), \"!\" )); } greet ( \"Maddison\" , new Date ()); Try Notice two things here: Our person and date parameters no longer have type annotations. Our ‚Äútemplate string‚Äù - that string that used backticks (the ` character) - was converted to plain strings with concatenations. More on that second point later, but let‚Äôs now focus on that first point. Type annotations aren‚Äôt part of JavaScript (or ECMAScript to be pedantic), so there really aren‚Äôt any browsers or other runtimes that can just run TypeScript unmodified. That‚Äôs why TypeScript needs a compiler in the first place - it needs some way to strip out or transform any TypeScript-specific code so that you can run it. Most TypeScript-specific code gets erased away, and likewise, here our type annotations were completely erased. Remember : Type annotations never change the runtime behavior of your program. Downleveling One other difference from the above was that our template string was rewritten from js `Hello ${ person } , today is ${ date . toDateString () } !` ; to js \"Hello \" . concat ( person , \", today is \" ). concat ( date . toDateString (), \"!\" ); Why did this happen? Template strings are a feature from a version of ECMAScript called ECMAScript 2015 (a.k.a. ECMAScript 6, ES2015, ES6, etc. - don‚Äôt ask ). TypeScript has the ability to rewrite code from newer versions of ECMAScript to older ones such as ECMAScript 3 or ECMAScript 5 (a.k.a. ES5). This process of moving from a newer or ‚Äúhigher‚Äù version of ECMAScript down to an older or ‚Äúlower‚Äù one is sometimes called downleveling . By default TypeScript targets ES5, an extremely old version of ECMAScript. We could have chosen something a little bit more recent by using the target option. Running with --target es2015 changes TypeScript to target ECMAScript 2015, meaning code should be able to run wherever ECMAScript 2015 is supported. So running tsc --target es2015 hello.ts gives us the following output: js function greet ( person , date ) { console . log ( `Hello ${ person } , today is ${ date . toDateString () } !` ); } greet ( \"Maddison\" , new Date ()); While the default target is ES5, the great majority of current browsers support ES2015. Most developers can therefore safely specify ES2015 or above as a target, unless compatibility with certain ancient browsers is important. Strictness Different users come to TypeScript looking for different things in a type-checker. Some people are looking for a more loose opt-in experience which can help validate only some parts of their program, and still have decent tooling. This is the default experience with TypeScript, where types are optional, inference takes the most lenient types, and there‚Äôs no checking for potentially null / undefined values. Much like how tsc emits in the face of errors, these defaults are put in place to stay out of your way. If you‚Äôre migrating existing JavaScript, that might be a desirable first step. In contrast, a lot of users prefer to have TypeScript validate as much as it can straight away, and that‚Äôs why the language provides strictness settings as well. These strictness settings turn static type-checking from a switch (either your code is checked or not) into something closer to a dial. The further you turn this dial up, the more TypeScript will check for you. This can require a little extra work, but generally speaking it pays for itself in the long run, and enables more thorough checks and more accurate tooling. When possible, a new codebase should always turn these strictness checks on. TypeScript has several type-checking strictness flags that can be turned on or off, and all of our examples will be written with all of them enabled unless otherwise stated. The strict flag in the CLI, or \"strict\": true in a tsconfig.json toggles them all on simultaneously, but we can opt out of them individually. The two biggest ones you should know about are noImplicitAny and strictNullChecks . noImplicitAny Recall that in some places, TypeScript doesn‚Äôt try to infer types for us and instead falls back to the most lenient type: any . This isn‚Äôt the worst thing that can happen - after all, falling back to any is just the plain JavaScript experience anyway. However, using any often defeats the purpose of using TypeScript in the first place. The more typed your program is, the more validation and tooling you‚Äôll get, meaning you‚Äôll run into fewer bugs as you code. Turning on the noImplicitAny flag will issue an error on any variables whose type is implicitly inferred as any . strictNullChecks By default, values like null and undefined are assignable to any other type. This can make writing some code easier, but forgetting to handle null and undefined is the cause of countless bugs in the world - some consider it a billion dollar mistake ! The strictNullChecks flag makes handling null and undefined more explicit, and spares us from worrying about whether we forgot to handle null and undefined . On this page Static type-checking Non-exception Failures Types for Tooling tsc, the TypeScript compiler Emitting with Errors Explicit Types Erased Types Downleveling Strictness noImplicitAny strictNullChecks Is this page helpful? Yes No Previous The TypeScript Handbook Your first step to learn TypeScript Next Everyday Types The language primitives. The TypeScript docs are an open source project. Help us improve these pages by sending a Pull Request ‚ù§ Contributors to this page: RC OT RT DR EB 19 + Last updated: Dec 29, 2025 Customize Site Colours : System Always Light Always Dark Code Font : Cascadia Cascadia (ligatures) Consolas Dank Mono Fira Code JetBrains Mono OpenDyslexic SF Mono Source Code Pro Popular Documentation Pages Everyday Types All of the common types in TypeScript Creating Types from Types Techniques to make more elegant types More on Functions How to provide types to functions in JavaScript More on Objects How to provide a type shape to JavaScript objects Narrowing How TypeScript infers types based on runtime behavior Variable Declarations How to create and type JavaScript variables TypeScript in 5 minutes An overview of building a TypeScript web app TSConfig Options All the configuration options for a project Classes How to provide types to JavaScript ES6 classes Made with ‚ô• in Redmond, Boston, SF & Dublin ¬© 2012- 2025 Microsoft Privacy Terms of Use Using TypeScript Get Started Download Community Playground TSConfig Ref Code Samples Why TypeScript Design Community Get Help Blog GitHub Repo Community Chat @TypeScript Mastodon Stack Overflow Web Repo MSG",
      "chunk_ids": [],
      "metadata": {
        "url": "https://www.typescriptlang.org/docs/handbook/2/basic-types.html",
        "title": "TypeScript: Documentation - The Basics"
      },
      "is_distractor": false,
      "semantic_tags": [
        "documentation",
        "function",
        "typescript"
      ],
      "content_hash": "602bb55063c5c7ee",
      "size_bytes": 23582,
      "created_at": "2026-01-02T20:42:12.445099"
    },
    {
      "doc_id": "online_www_typescriptlang_org_docs_handbook_2_everyday-types_html",
      "source": "online",
      "category": "technical",
      "domain": "typescript",
      "file_path": "https://www.typescriptlang.org/docs/handbook/2/everyday-types.html",
      "content": "TypeScript: Documentation - Everyday Types Skip to main content TypeScript Download Docs Handbook Community Playground Tools in En Was this page helpful? Get Started TS for the New Programmer TypeScript for JS Programmers TS for Java/C# Programmers TS for Functional Programmers TypeScript Tooling in 5 minutes Handbook The TypeScript Handbook The Basics Everyday Types Narrowing More on Functions Object Types Type Manipulation Creating Types from Types Generics Keyof Type Operator Typeof Type Operator Indexed Access Types Conditional Types Mapped Types Template Literal Types Classes Modules Reference Utility Types Cheat Sheets Decorators Declaration Merging Enums Iterators and Generators JSX Mixins Namespaces Namespaces and Modules Symbols Triple-Slash Directives Type Compatibility Type Inference Variable Declaration Modules Reference Introduction Theory Guides Choosing Compiler Options Reference Appendices ESM/CJS Interoperability Tutorials ASP.NET Core Gulp DOM Manipulation Migrating from JavaScript Using Babel with TypeScript What&#x27;s New TypeScript 5.9 TypeScript 5.8 TypeScript 5.7 TypeScript 5.6 TypeScript 5.5 TypeScript 5.4 TypeScript 5.3 TypeScript 5.2 TypeScript 5.1 TypeScript 5.0 TypeScript 4.9 TypeScript 4.8 TypeScript 4.7 TypeScript 4.6 TypeScript 4.5 TypeScript 4.4 TypeScript 4.3 TypeScript 4.2 TypeScript 4.1 TypeScript 4.0 TypeScript 3.9 TypeScript 3.8 TypeScript 3.7 TypeScript 3.6 TypeScript 3.5 TypeScript 3.4 TypeScript 3.3 TypeScript 3.2 TypeScript 3.1 TypeScript 3.0 TypeScript 2.9 TypeScript 2.8 TypeScript 2.7 TypeScript 2.6 TypeScript 2.5 TypeScript 2.4 TypeScript 2.3 TypeScript 2.2 TypeScript 2.1 TypeScript 2.0 TypeScript 1.8 TypeScript 1.7 TypeScript 1.6 TypeScript 1.5 TypeScript 1.4 TypeScript 1.3 TypeScript 1.1 Declaration Files Introduction Declaration Reference Library Structures .d.ts Templates Modules .d.ts Module: Plugin Module: Class Module: Function Global .d.ts Global: Modifying Module Do&#x27;s and Don&#x27;ts Deep Dive Publishing Consumption JavaScript JS Projects Utilizing TypeScript Type Checking JavaScript Files JSDoc Reference Creating .d.ts Files from .js files Project Configuration What is a tsconfig.json Compiler Options in MSBuild TSConfig Reference tsc CLI Options Project References Integrating with Build Tools Configuring Watch Nightly Builds Everyday Types In this chapter, we‚Äôll cover some of the most common types of values you‚Äôll find in JavaScript code, and explain the corresponding ways to describe those types in TypeScript. This isn‚Äôt an exhaustive list, and future chapters will describe more ways to name and use other types. Types can also appear in many more places than just type annotations. As we learn about the types themselves, we‚Äôll also learn about the places where we can refer to these types to form new constructs. We‚Äôll start by reviewing the most basic and common types you might encounter when writing JavaScript or TypeScript code. These will later form the core building blocks of more complex types. The primitives: string , number , and boolean JavaScript has three very commonly used primitives : string , number , and boolean . Each has a corresponding type in TypeScript. As you might expect, these are the same names you‚Äôd see if you used the JavaScript typeof operator on a value of those types: string represents string values like \"Hello, world\" number is for numbers like 42 . JavaScript does not have a special runtime value for integers, so there‚Äôs no equivalent to int or float - everything is simply number boolean is for the two values true and false The type names String , Number , and Boolean (starting with capital letters) are legal, but refer to some special built-in types that will very rarely appear in your code. Always use string , number , or boolean for types. Arrays To specify the type of an array like [1, 2, 3] , you can use the syntax number[] ; this syntax works for any type (e.g. string[] is an array of strings, and so on). You may also see this written as Array&#x3C;number> , which means the same thing. We‚Äôll learn more about the syntax T&#x3C;U> when we cover generics . Note that [number] is a different thing; refer to the section on Tuples . any TypeScript also has a special type, any , that you can use whenever you don‚Äôt want a particular value to cause typechecking errors. When a value is of type any , you can access any properties of it (which will in turn be of type any ), call it like a function, assign it to (or from) a value of any type, or pretty much anything else that‚Äôs syntactically legal: ts let obj : any = { x : 0 }; // None of the following lines of code will throw compiler errors. // Using `any` disables all further type checking, and it is assumed // you know the environment better than TypeScript. obj . foo (); obj (); obj . bar = 100 ; obj = \"hello\" ; const n : number = obj ; Try The any type is useful when you don‚Äôt want to write out a long type just to convince TypeScript that a particular line of code is okay. noImplicitAny When you don‚Äôt specify a type, and TypeScript can‚Äôt infer it from context, the compiler will typically default to any . You usually want to avoid this, though, because any isn‚Äôt type-checked. Use the compiler flag noImplicitAny to flag any implicit any as an error. Type Annotations on Variables When you declare a variable using const , var , or let , you can optionally add a type annotation to explicitly specify the type of the variable: ts let myName : string = \"Alice\" ; Try TypeScript doesn‚Äôt use ‚Äútypes on the left‚Äù-style declarations like int x = 0; Type annotations will always go after the thing being typed. In most cases, though, this isn‚Äôt needed. Wherever possible, TypeScript tries to automatically infer the types in your code. For example, the type of a variable is inferred based on the type of its initializer: ts // No type annotation needed -- &apos;myName&apos; inferred as type &apos;string&apos; let myName = \"Alice\" ; Try For the most part you don‚Äôt need to explicitly learn the rules of inference. If you‚Äôre starting out, try using fewer type annotations than you think - you might be surprised how few you need for TypeScript to fully understand what‚Äôs going on. Functions Functions are the primary means of passing data around in JavaScript. TypeScript allows you to specify the types of both the input and output values of functions. Parameter Type Annotations When you declare a function, you can add type annotations after each parameter to declare what types of parameters the function accepts. Parameter type annotations go after the parameter name: ts // Parameter type annotation function greet ( name : string ) { console . log ( \"Hello, \" + name . toUpperCase () + \"!!\" ); } Try When a parameter has a type annotation, arguments to that function will be checked: ts // Would be a runtime error if executed! greet ( 42 ); Argument of type 'number' is not assignable to parameter of type 'string'. 2345 Argument of type 'number' is not assignable to parameter of type 'string'. Try Even if you don‚Äôt have type annotations on your parameters, TypeScript will still check that you passed the right number of arguments. Return Type Annotations You can also add return type annotations. Return type annotations appear after the parameter list: ts function getFavoriteNumber (): number { return 26 ; } Try Much like variable type annotations, you usually don‚Äôt need a return type annotation because TypeScript will infer the function‚Äôs return type based on its return statements. The type annotation in the above example doesn‚Äôt change anything. Some codebases will explicitly specify a return type for documentation purposes, to prevent accidental changes, or just for personal preference. Functions Which Return Promises If you want to annotate the return type of a function which returns a promise, you should use the Promise type: ts async function ' >getFavoriteNumber (): ' >Promise < number > { return 26 ; } Try Anonymous Functions Anonymous functions are a little bit different from function declarations. When a function appears in a place where TypeScript can determine how it‚Äôs going to be called, the parameters of that function are automatically given types. Here‚Äôs an example: ts const names = [ \"Alice\" , \"Bob\" , \"Eve\" ]; // Contextual typing for function - parameter s inferred to have type string names . .forEach(callbackfn: (value: string, index: number, array: string[]) => void, thisArg?: any): void' >forEach ( function ( s ) { console . log ( s . toUpperCase ()); }); // Contextual typing also applies to arrow functions names . .forEach(callbackfn: (value: string, index: number, array: string[]) => void, thisArg?: any): void' >forEach (( s ) => { console . log ( s . toUpperCase ()); }); Try Even though the parameter s didn‚Äôt have a type annotation, TypeScript used the types of the forEach function, along with the inferred type of the array, to determine the type s will have. This process is called contextual typing because the context that the function occurred within informs what type it should have. Similar to the inference rules, you don‚Äôt need to explicitly learn how this happens, but understanding that it does happen can help you notice when type annotations aren‚Äôt needed. Later, we‚Äôll see more examples of how the context that a value occurs in can affect its type. Object Types Apart from primitives, the most common sort of type you‚Äôll encounter is an object type . This refers to any JavaScript value with properties, which is almost all of them! To define an object type, we simply list its properties and their types. For example, here‚Äôs a function that takes a point-like object: ts // The parameter&apos;s type annotation is an object type function printCoord ( pt : { x : number ; y : number }) { console . log ( \"The coordinate&apos;s x value is \" + pt . x ); console . log ( \"The coordinate&apos;s y value is \" + pt . y ); } printCoord ({ x : 3 , y : 7 }); Try Here, we annotated the parameter with a type with two properties - x and y - which are both of type number . You can use , or ; to separate the properties, and the last separator is optional either way. The type part of each property is also optional. If you don‚Äôt specify a type, it will be assumed to be any . Optional Properties Object types can also specify that some or all of their properties are optional . To do this, add a ? after the property name: ts function printName ( obj : { first : string ; last ?: string }) { // ... } // Both OK printName ({ first : \"Bob\" }); printName ({ first : \"Alice\" , last : \"Alisson\" }); Try In JavaScript, if you access a property that doesn‚Äôt exist, you‚Äôll get the value undefined rather than a runtime error. Because of this, when you read from an optional property, you‚Äôll have to check for undefined before using it. ts function printName ( obj : { first : string ; last ?: string }) { // Error - might crash if &apos;obj.last&apos; wasn&apos;t provided! console . log ( obj . last . toUpperCase ()); 'obj.last' is possibly 'undefined'. 18048 'obj.last' is possibly 'undefined'. if ( obj . last !== undefined ) { // OK console . log ( obj . last . toUpperCase ()); } // A safe alternative using modern JavaScript syntax: console . log ( obj . last ?. toUpperCase ()); } Try Union Types TypeScript‚Äôs type system allows you to build new types out of existing ones using a large variety of operators. Now that we know how to write a few types, it‚Äôs time to start combining them in interesting ways. Defining a Union Type The first way to combine types you might see is a union type. A union type is a type formed from two or more other types, representing values that may be any one of those types. We refer to each of these types as the union‚Äôs members . Let‚Äôs write a function that can operate on strings or numbers: ts function printId ( id : number | string ) { console . log ( \"Your ID is: \" + id ); } // OK printId ( 101 ); // OK printId ( \"202\" ); // Error printId ({ myID : 22342 }); Argument of type '{ myID: number; }' is not assignable to parameter of type 'string | number'. 2345 Argument of type '{ myID: number; }' is not assignable to parameter of type 'string | number'. Try The separator of the union members is allowed before the first element, so you could also write this: ts function printTextOrNumberOrBool ( textOrNumberOrBool : | string | number | boolean ) { console . log ( textOrNumberOrBool ); } Try Working with Union Types It‚Äôs easy to provide a value matching a union type - simply provide a type matching any of the union‚Äôs members. If you have a value of a union type, how do you work with it? TypeScript will only allow an operation if it is valid for every member of the union. For example, if you have the union string | number , you can‚Äôt use methods that are only available on string : ts function printId ( id : number | string ) { console . log ( id . toUpperCase ()); Property 'toUpperCase' does not exist on type 'string | number'. Property 'toUpperCase' does not exist on type 'number'. 2339 Property 'toUpperCase' does not exist on type 'string | number'. Property 'toUpperCase' does not exist on type 'number'. } Try The solution is to narrow the union with code, the same as you would in JavaScript without type annotations. Narrowing occurs when TypeScript can deduce a more specific type for a value based on the structure of the code. For example, TypeScript knows that only a string value will have a typeof value \"string\" : ts function printId ( id : number | string ) { if ( typeof id === \"string\" ) { // In this branch, id is of type &apos;string&apos; console . log ( id . toUpperCase ()); } else { // Here, id is of type &apos;number&apos; console . log ( id ); } } Try Another example is to use a function like Array.isArray : ts function welcomePeople ( x : string [] | string ) { if ( Array . isArray ( x )) { // Here: &apos;x&apos; is &apos;string[]&apos; console . log ( \"Hello, \" + x . .join(separator?: string): string' >join ( \" and \" )); } else { // Here: &apos;x&apos; is &apos;string&apos; console . log ( \"Welcome lone traveler \" + x ); } } Try Notice that in the else branch, we don‚Äôt need to do anything special - if x wasn‚Äôt a string[] , then it must have been a string . Sometimes you‚Äôll have a union where all the members have something in common. For example, both arrays and strings have a slice method. If every member in a union has a property in common, you can use that property without narrowing: ts // Return type is inferred as number[] | string function getFirstThree ( x : number [] | string ) { return x . slice ( 0 , 3 ); } Try It might be confusing that a union of types appears to have the intersection of those types‚Äô properties. This is not an accident - the name union comes from type theory. The union number | string is composed by taking the union of the values from each type. Notice that given two sets with corresponding facts about each set, only the intersection of those facts applies to the union of the sets themselves. For example, if we had a room of tall people wearing hats, and another room of Spanish speakers wearing hats, after combining those rooms, the only thing we know about every person is that they must be wearing a hat. Type Aliases We‚Äôve been using object types and union types by writing them directly in type annotations. This is convenient, but it‚Äôs common to want to use the same type more than once and refer to it by a single name. A type alias is exactly that - a name for any type . The syntax for a type alias is: ts type Point = { x : number ; y : number ; }; // Exactly the same as the earlier example function printCoord ( pt : Point ) { console . log ( \"The coordinate&apos;s x value is \" + pt . x ); console . log ( \"The coordinate&apos;s y value is \" + pt . y ); } printCoord ({ x : 100 , y : 100 }); Try You can actually use a type alias to give a name to any type at all, not just an object type. For example, a type alias can name a union type: ts type ID = number | string ; Try Note that aliases are only aliases - you cannot use type aliases to create different/distinct ‚Äúversions‚Äù of the same type. When you use the alias, it‚Äôs exactly as if you had written the aliased type. In other words, this code might look illegal, but is OK according to TypeScript because both types are aliases for the same type: ts type UserInputSanitizedString = string ; function sanitizeInput ( str : string ): UserInputSanitizedString { return sanitize ( str ); } // Create a sanitized input let userInput = sanitizeInput ( getInput ()); // Can still be re-assigned with a string though userInput = \"new input\" ; Try Interfaces An interface declaration is another way to name an object type: ts interface Point { x : number ; y : number ; } function printCoord ( pt : Point ) { console . log ( \"The coordinate&apos;s x value is \" + pt . x ); console . log ( \"The coordinate&apos;s y value is \" + pt . y ); } printCoord ({ x : 100 , y : 100 }); Try Just like when we used a type alias above, the example works just as if we had used an anonymous object type. TypeScript is only concerned with the structure of the value we passed to printCoord - it only cares that it has the expected properties. Being concerned only with the structure and capabilities of types is why we call TypeScript a structurally typed type system. Differences Between Type Aliases and Interfaces Type aliases and interfaces are very similar, and in many cases you can choose between them freely. Almost all features of an interface are available in type , the key distinction is that a type cannot be re-opened to add new properties vs an interface which is always extendable. Interface Type Extending an interface interface Animal { name: string; } interface Bear extends Animal { honey: boolean; } const bear = getBear(); bear.name; bear.honey; Extending a type via intersections type Animal = { name: string; } type Bear = Animal & { honey: boolean; } const bear = getBear(); bear.name; bear.honey; Adding new fields to an existing interface interface Window { title: string; } interface Window { ts: TypeScriptAPI; } const src = 'const a = \"Hello World\"'; window.ts.transpileModule(src, {}); A type cannot be changed after being created type Window = { title: string; } type Window = { ts: TypeScriptAPI; } // Error: Duplicate identifier 'Window'. You‚Äôll learn more about these concepts in later chapters, so don‚Äôt worry if you don‚Äôt understand all of these right away. Prior to TypeScript version 4.2, type alias names may appear in error messages , sometimes in place of the equivalent anonymous type (which may or may not be desirable). Interfaces will always be named in error messages. Type aliases may not participate in declaration merging, but interfaces can . Interfaces may only be used to declare the shapes of objects, not rename primitives . Interface names will always appear in their original form in error messages, but only when they are used by name. Using interfaces with extends can often be more performant for the compiler than type aliases with intersections For the most part, you can choose based on personal preference, and TypeScript will tell you if it needs something to be the other kind of declaration. If you would like a heuristic, use interface until you need to use features from type . Type Assertions Sometimes you will have information about the type of a value that TypeScript can‚Äôt know about. For example, if you‚Äôre using document.getElementById , TypeScript only knows that this will return some kind of HTMLElement , but you might know that your page will always have an HTMLCanvasElement with a given ID. In this situation, you can use a type assertion to specify a more specific type: ts const myCanvas = document . getElementById ( \"main_canvas\" ) as HTMLCanvasElement ; Try Like a type annotation, type assertions are removed by the compiler and won‚Äôt affect the runtime behavior of your code. You can also use the angle-bracket syntax (except if the code is in a .tsx file), which is equivalent: ts const myCanvas = < HTMLCanvasElement > document . getElementById ( \"main_canvas\" ); Try Reminder: Because type assertions are removed at compile-time, there is no runtime checking associated with a type assertion. There won‚Äôt be an exception or null generated if the type assertion is wrong. TypeScript only allows type assertions which convert to a more specific or less specific version of a type. This rule prevents ‚Äúimpossible‚Äù coercions like: ts const x = \"hello\" as number ; Conversion of type 'string' to type 'number' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first. 2352 Conversion of type 'string' to type 'number' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first. Try Sometimes this rule can be too conservative and will disallow more complex coercions that might be valid. If this happens, you can use two assertions, first to any (or unknown , which we‚Äôll introduce later), then to the desired type: ts const a = expr as any as T ; Try Literal Types In addition to the general types string and number , we can refer to specific strings and numbers in type positions. One way to think about this is to consider how JavaScript comes with different ways to declare a variable. Both var and let allow for changing what is held inside the variable, and const does not. This is reflected in how TypeScript creates types for literals. ts let changingString = \"Hello World\" ; changingString = \"Ol√° Mundo\" ; // Because `changingString` can represent any possible string, that // is how TypeScript describes it in the type system changingString ; let changingString: string const constantString = \"Hello World\" ; // Because `constantString` can only represent 1 possible string, it // has a literal type representation constantString ; const constantString: \"Hello World\" Try By themselves, literal types aren‚Äôt very valuable: ts let x : \"hello\" = \"hello\" ; // OK x = \"hello\" ; // ... x = \"howdy\" ; Type '\"howdy\"' is not assignable to type '\"hello\"'. 2322 Type '\"howdy\"' is not assignable to type '\"hello\"'. Try It‚Äôs not much use to have a variable that can only have one value! But by combining literals into unions, you can express a much more useful concept - for example, functions that only accept a certain set of known values: ts function printText ( s : string , alignment : \"left\" | \"right\" | \"center\" ) { // ... } printText ( \"Hello, world\" , \"left\" ); printText ( \"G&apos;day, mate\" , \"centre\" ); Argument of type '\"centre\"' is not assignable to parameter of type '\"left\" | \"right\" | \"center\"'. 2345 Argument of type '\"centre\"' is not assignable to parameter of type '\"left\" | \"right\" | \"center\"'. Try Numeric literal types work the same way: ts function compare ( a : string , b : string ): - 1 | 0 | 1 { return a === b ? 0 : a > b ? 1 : - 1 ; } Try Of course, you can combine these with non-literal types: ts interface Options { width : number ; } function configure ( x : Options | \"auto\" ) { // ... } configure ({ width : 100 }); configure ( \"auto\" ); configure ( \"automatic\" ); Argument of type '\"automatic\"' is not assignable to parameter of type 'Options | \"auto\"'. 2345 Argument of type '\"automatic\"' is not assignable to parameter of type 'Options | \"auto\"'. Try There‚Äôs one more kind of literal type: boolean literals. There are only two boolean literal types, and as you might guess, they are the types true and false . The type boolean itself is actually just an alias for the union true | false . Literal Inference When you initialize a variable with an object, TypeScript assumes that the properties of that object might change values later. For example, if you wrote code like this: ts const obj = { counter : 0 }; if ( someCondition ) { obj . counter = 1 ; } Try TypeScript doesn‚Äôt assume the assignment of 1 to a field which previously had 0 is an error. Another way of saying this is that obj.counter must have the type number , not 0 , because types are used to determine both reading and writing behavior. The same applies to strings: ts declare function handleRequest ( url : string , method : \"GET\" | \"POST\" ): void ; const req = { url : \"https://example.com\" , method : \"GET\" }; handleRequest ( req . url , req . method ); Argument of type 'string' is not assignable to parameter of type '\"GET\" | \"POST\"'. 2345 Argument of type 'string' is not assignable to parameter of type '\"GET\" | \"POST\"'. Try In the above example req.method is inferred to be string , not \"GET\" . Because code can be evaluated between the creation of req and the call of handleRequest which could assign a new string like \"GUESS\" to req.method , TypeScript considers this code to have an error. There are two ways to work around this. You can change the inference by adding a type assertion in either location: ts // Change 1: const req = { url : \"https://example.com\" , method : \"GET\" as \"GET\" }; // Change 2 handleRequest ( req . url , req . method as \"GET\" ); Try Change 1 means ‚ÄúI intend for req.method to always have the literal type \"GET\" ‚Äù, preventing the possible assignment of \"GUESS\" to that field after. Change 2 means ‚ÄúI know for other reasons that req.method has the value \"GET\" ‚Äú. You can use as const to convert the entire object to be type literals: ts const req = { url : \"https://example.com\" , method : \"GET\" } as const ; handleRequest ( req . url , req . method ); Try The as const suffix acts like const but for the type system, ensuring that all properties are assigned the literal type instead of a more general version like string or number . null and undefined JavaScript has two primitive values used to signal absent or uninitialized value: null and undefined . TypeScript has two corresponding types by the same names. How these types behave depends on whether you have the strictNullChecks option on. strictNullChecks off With strictNullChecks off , values that might be null or undefined can still be accessed normally, and the values null and undefined can be assigned to a property of any type. This is similar to how languages without null checks (e.g. C#, Java) behave. The lack of checking for these values tends to be a major source of bugs; we always recommend people turn strictNullChecks on if it‚Äôs practical to do so in their codebase. strictNullChecks on With strictNullChecks on , when a value is null or undefined , you will need to test for those values before using methods or properties on that value. Just like checking for undefined before using an optional property, we can use narrowing to check for values that might be null : ts function doSomething ( x : string | null ) { if ( x === null ) { // do nothing } else { console . log ( \"Hello, \" + x . toUpperCase ()); } } Try Non-null Assertion Operator (Postfix ! ) TypeScript also has a special syntax for removing null and undefined from a type without doing any explicit checking. Writing ! after any expression is effectively a type assertion that the value isn‚Äôt null or undefined : ts function liveDangerously ( x ?: number | null ) { // No error console . log ( x !. toFixed ()); } Try Just like other type assertions, this doesn‚Äôt change the runtime behavior of your code, so it‚Äôs important to only use ! when you know that the value can‚Äôt be null or undefined . Enums Enums are a feature added to JavaScript by TypeScript which allows for describing a value which could be one of a set of possible named constants. Unlike most TypeScript features, this is not a type-level addition to JavaScript but something added to the language and runtime. Because of this, it‚Äôs a feature which you should know exists, but maybe hold off on using unless you are sure. You can read more about enums in the Enum reference page . Less Common Primitives It‚Äôs worth mentioning the rest of the primitives in JavaScript which are represented in the type system. Though we will not go into depth here. bigint From ES2020 onwards, there is a primitive in JavaScript used for very large integers, BigInt : ts // Creating a bigint via the BigInt function const oneHundred : bigint = bigint' >BigInt ( 100 ); // Creating a BigInt via the literal syntax const anotherHundred : bigint = 100 n ; Try You can learn more about BigInt in the TypeScript 3.2 release notes . symbol There is a primitive in JavaScript used to create a globally unique reference via the function Symbol() : ts const firstName = symbol' >Symbol ( \"name\" ); const secondName = symbol' >Symbol ( \"name\" ); if ( firstName === secondName ) { This comparison appears to be unintentional because the types 'typeof firstName' and 'typeof secondName' have no overlap. 2367 This comparison appears to be unintentional because the types 'typeof firstName' and 'typeof secondName' have no overlap. // Can&apos;t ever happen } Try You can learn more about them in Symbols reference page . On this page The primitives: string, number, and boolean Arrays any noImplicitAny Type Annotations on Variables Functions Parameter Type Annotations Return Type Annotations Anonymous Functions Object Types Optional Properties Union Types Defining a Union Type Working with Union Types Type Aliases Interfaces Differences Between Type Aliases and Interfaces Type Assertions Literal Types Literal Inference null and undefined strictNullChecks off strictNullChecks on Non-null Assertion Operator (Postfix !) Enums Less Common Primitives Is this page helpful? Yes No Previous The Basics Step one in learning TypeScript: The basic types. Next Narrowing Understand how TypeScript uses JavaScript knowledge to reduce the amount of type syntax in your projects. The TypeScript docs are an open source project. Help us improve these pages by sending a Pull Request ‚ù§ Contributors to this page: RC OT UG AB DR 31 + Last updated: Dec 29, 2025 Customize Site Colours : System Always Light Always Dark Code Font : Cascadia Cascadia (ligatures) Consolas Dank Mono Fira Code JetBrains Mono OpenDyslexic SF Mono Source Code Pro Popular Documentation Pages Everyday Types All of the common types in TypeScript Creating Types from Types Techniques to make more elegant types More on Functions How to provide types to functions in JavaScript More on Objects How to provide a type shape to JavaScript objects Narrowing How TypeScript infers types based on runtime behavior Variable Declarations How to create and type JavaScript variables TypeScript in 5 minutes An overview of building a TypeScript web app TSConfig Options All the configuration options for a project Classes How to provide types to JavaScript ES6 classes Made with ‚ô• in Redmond, Boston, SF & Dublin ¬© 2012- 2025 Microsoft Privacy Terms of Use Using TypeScript Get Started Download Community Playground TSConfig Ref Code Samples Why TypeScript Design Community Get Help Blog GitHub Repo Community Chat @TypeScript Mastodon Stack Overflow Web Repo MSG",
      "chunk_ids": [],
      "metadata": {
        "url": "https://www.typescriptlang.org/docs/handbook/2/everyday-types.html",
        "title": "TypeScript: Documentation - Everyday Types"
      },
      "is_distractor": false,
      "semantic_tags": [
        "documentation",
        "function",
        "typescript"
      ],
      "content_hash": "3f5b2cecd45f8e00",
      "size_bytes": 31148,
      "created_at": "2026-01-02T20:42:12.445176"
    },
    {
      "doc_id": "online_www_typescriptlang_org_docs_handbook_2_functions_html",
      "source": "online",
      "category": "technical",
      "domain": "typescript",
      "file_path": "https://www.typescriptlang.org/docs/handbook/2/functions.html",
      "content": "TypeScript: Documentation - More on Functions Skip to main content TypeScript Download Docs Handbook Community Playground Tools in En Was this page helpful? Get Started TS for the New Programmer TypeScript for JS Programmers TS for Java/C# Programmers TS for Functional Programmers TypeScript Tooling in 5 minutes Handbook The TypeScript Handbook The Basics Everyday Types Narrowing More on Functions Object Types Type Manipulation Creating Types from Types Generics Keyof Type Operator Typeof Type Operator Indexed Access Types Conditional Types Mapped Types Template Literal Types Classes Modules Reference Utility Types Cheat Sheets Decorators Declaration Merging Enums Iterators and Generators JSX Mixins Namespaces Namespaces and Modules Symbols Triple-Slash Directives Type Compatibility Type Inference Variable Declaration Modules Reference Introduction Theory Guides Choosing Compiler Options Reference Appendices ESM/CJS Interoperability Tutorials ASP.NET Core Gulp DOM Manipulation Migrating from JavaScript Using Babel with TypeScript What&#x27;s New TypeScript 5.9 TypeScript 5.8 TypeScript 5.7 TypeScript 5.6 TypeScript 5.5 TypeScript 5.4 TypeScript 5.3 TypeScript 5.2 TypeScript 5.1 TypeScript 5.0 TypeScript 4.9 TypeScript 4.8 TypeScript 4.7 TypeScript 4.6 TypeScript 4.5 TypeScript 4.4 TypeScript 4.3 TypeScript 4.2 TypeScript 4.1 TypeScript 4.0 TypeScript 3.9 TypeScript 3.8 TypeScript 3.7 TypeScript 3.6 TypeScript 3.5 TypeScript 3.4 TypeScript 3.3 TypeScript 3.2 TypeScript 3.1 TypeScript 3.0 TypeScript 2.9 TypeScript 2.8 TypeScript 2.7 TypeScript 2.6 TypeScript 2.5 TypeScript 2.4 TypeScript 2.3 TypeScript 2.2 TypeScript 2.1 TypeScript 2.0 TypeScript 1.8 TypeScript 1.7 TypeScript 1.6 TypeScript 1.5 TypeScript 1.4 TypeScript 1.3 TypeScript 1.1 Declaration Files Introduction Declaration Reference Library Structures .d.ts Templates Modules .d.ts Module: Plugin Module: Class Module: Function Global .d.ts Global: Modifying Module Do&#x27;s and Don&#x27;ts Deep Dive Publishing Consumption JavaScript JS Projects Utilizing TypeScript Type Checking JavaScript Files JSDoc Reference Creating .d.ts Files from .js files Project Configuration What is a tsconfig.json Compiler Options in MSBuild TSConfig Reference tsc CLI Options Project References Integrating with Build Tools Configuring Watch Nightly Builds More on Functions Functions are the basic building block of any application, whether they‚Äôre local functions, imported from another module, or methods on a class. They‚Äôre also values, and just like other values, TypeScript has many ways to describe how functions can be called. Let‚Äôs learn about how to write types that describe functions. Function Type Expressions The simplest way to describe a function is with a function type expression . These types are syntactically similar to arrow functions: ts function void): void' >greeter ( void' >fn : ( a : string ) => void ) { void' >fn ( \"Hello, World\" ); } function printToConsole ( s : string ) { console . log ( s ); } void): void' >greeter ( printToConsole ); Try The syntax (a: string) => void means ‚Äúa function with one parameter, named a , of type string , that doesn‚Äôt have a return value‚Äù. Just like with function declarations, if a parameter type isn‚Äôt specified, it‚Äôs implicitly any . Note that the parameter name is required . The function type (string) => void means ‚Äúa function with a parameter named string of type any ‚Äú! Of course, we can use a type alias to name a function type: ts type void' >GreetFunction = ( a : string ) => void ; function greeter ( fn : void' >GreetFunction ) { // ... } Try Call Signatures In JavaScript, functions can have properties in addition to being callable. However, the function type expression syntax doesn‚Äôt allow for declaring properties. If we want to describe something callable with properties, we can write a call signature in an object type: ts type DescribableFunction = { description : string ; ( someArg : number ): boolean ; }; function doSomething ( fn : DescribableFunction ) { console . log ( fn . description + \" returned \" + boolean' >fn ( 6 )); } function myFunc ( someArg : number ) { return someArg > 3 ; } myFunc . description = \"default description\" ; doSomething ( myFunc ); Try Note that the syntax is slightly different compared to a function type expression - use : between the parameter list and the return type rather than => . Construct Signatures JavaScript functions can also be invoked with the new operator. TypeScript refers to these as constructors because they usually create a new object. You can write a construct signature by adding the new keyword in front of a call signature: ts type SomeObject' >SomeConstructor = { new ( s : string ): SomeObject ; }; function fn ( ctor : SomeObject' >SomeConstructor ) { return new SomeObject' >ctor ( \"hello\" ); } Try Some objects, like JavaScript‚Äôs Date object, can be called with or without new . You can combine call and construct signatures in the same type arbitrarily: ts interface CallOrConstruct { ( n ?: number ): string ; new ( s : string ): Date ; } function fn ( ctor : CallOrConstruct ) { // Passing an argument of type `number` to `ctor` matches it against // the first definition in the `CallOrConstruct` interface. console . log ( string' style='border-bottom: solid 2px lightgrey;'>ctor ( 10 )); (parameter) ctor: CallOrConstruct (n?: number) => string // Similarly, passing an argument of type `string` to `ctor` matches it // against the second definition in the `CallOrConstruct` interface. console . log ( new Date' style='border-bottom: solid 2px lightgrey;'>ctor ( \"10\" )); (parameter) ctor: CallOrConstruct new (s: string) => Date } fn ( Date ); Try Generic Functions It‚Äôs common to write a function where the types of the input relate to the type of the output, or where the types of two inputs are related in some way. Let‚Äôs consider for a moment a function that returns the first element of an array: ts function firstElement ( arr : any []) { return arr [ 0 ]; } Try This function does its job, but unfortunately has the return type any . It‚Äôd be better if the function returned the type of the array element. In TypeScript, generics are used when we want to describe a correspondence between two values. We do this by declaring a type parameter in the function signature: ts function (arr: Type[]): Type | undefined' >firstElement < (arr: Type[]): Type | undefined' >Type >( arr : (arr: Type[]): Type | undefined' >Type []): (arr: Type[]): Type | undefined' >Type | undefined { return arr [ 0 ]; } Try By adding a type parameter Type to this function and using it in two places, we‚Äôve created a link between the input of the function (the array) and the output (the return value). Now when we call it, a more specific type comes out: ts // s is of type &apos;string&apos; const s = (arr: string[]): string | undefined' >firstElement ([ \"a\" , \"b\" , \"c\" ]); // n is of type &apos;number&apos; const n = (arr: number[]): number | undefined' >firstElement ([ 1 , 2 , 3 ]); // u is of type undefined const u = (arr: never[]): undefined' >firstElement ([]); Try Inference Note that we didn‚Äôt have to specify Type in this sample. The type was inferred - chosen automatically - by TypeScript. We can use multiple type parameters as well. For example, a standalone version of map would look like this: ts function (arr: Input[], func: (arg: Input) => Output): Output[]' >map < (arr: Input[], func: (arg: Input) => Output): Output[]' >Input , (arr: Input[], func: (arg: Input) => Output): Output[]' >Output >( arr : (arr: Input[], func: (arg: Input) => Output): Output[]' >Input [], Output' >func : ( arg : (arr: Input[], func: (arg: Input) => Output): Output[]' >Input ) => (arr: Input[], func: (arg: Input) => Output): Output[]' >Output ): (arr: Input[], func: (arg: Input) => Output): Output[]' >Output [] { return arr . .map<Output>(callbackfn: (value: Input, index: number, array: Input[]) => Output, thisArg?: any): Output[]' >map ( Output' >func ); } // Parameter &apos;n&apos; is of type &apos;string&apos; // &apos;parsed&apos; is of type &apos;number[]&apos; const parsed = (arr: string[], func: (arg: string) => number): number[]' >map ([ \"1\" , \"2\" , \"3\" ], ( n ) => parseInt ( n )); Try Note that in this example, TypeScript could infer both the type of the Input type parameter (from the given string array), as well as the Output type parameter based on the return value of the function expression ( number ). Constraints We‚Äôve written some generic functions that can work on any kind of value. Sometimes we want to relate two values, but can only operate on a certain subset of values. In this case, we can use a constraint to limit the kinds of types that a type parameter can accept. Let‚Äôs write a function that returns the longer of two values. To do this, we need a length property that‚Äôs a number. We constrain the type parameter to that type by writing an extends clause: ts function (a: Type, b: Type): Type' >longest < (a: Type, b: Type): Type' >Type extends { length : number }>( a : (a: Type, b: Type): Type' >Type , b : (a: Type, b: Type): Type' >Type ) { if ( a . length >= b . length ) { return a ; } else { return b ; } } // longerArray is of type &apos;number[]&apos; const longerArray = (a: number[], b: number[]): number[]' >longest ([ 1 , 2 ], [ 1 , 2 , 3 ]); // longerString is of type &apos;alice&apos; | &apos;bob&apos; const longerString = (a: \"alice\" | \"bob\", b: \"alice\" | \"bob\"): \"alice\" | \"bob\"' >longest ( \"alice\" , \"bob\" ); // Error! Numbers don&apos;t have a &apos;length&apos; property const notOK = (a: {&#10; length: number;&#10;}, b: {&#10; length: number;&#10;}): {&#10; length: number;&#10;}' >longest ( 10 , 100 ); Argument of type 'number' is not assignable to parameter of type '{ length: number; }'. 2345 Argument of type 'number' is not assignable to parameter of type '{ length: number; }'. Try There are a few interesting things to note in this example. We allowed TypeScript to infer the return type of longest . Return type inference also works on generic functions. Because we constrained Type to { length: number } , we were allowed to access the .length property of the a and b parameters. Without the type constraint, we wouldn‚Äôt be able to access those properties because the values might have been some other type without a length property. The types of longerArray and longerString were inferred based on the arguments. Remember, generics are all about relating two or more values with the same type! Finally, just as we‚Äôd like, the call to longest(10, 100) is rejected because the number type doesn‚Äôt have a .length property. Working with Constrained Values Here‚Äôs a common error when working with generic constraints: ts function (obj: Type, minimum: number): Type' >minimumLength < (obj: Type, minimum: number): Type' >Type extends { length : number }>( obj : (obj: Type, minimum: number): Type' >Type , minimum : number ): (obj: Type, minimum: number): Type' >Type { if ( obj . length >= minimum ) { return obj ; } else { return { length : minimum }; Type '{ length: number; }' is not assignable to type 'Type'. '{ length: number; }' is assignable to the constraint of type 'Type', but 'Type' could be instantiated with a different subtype of constraint '{ length: number; }'. 2322 Type '{ length: number; }' is not assignable to type 'Type'. '{ length: number; }' is assignable to the constraint of type 'Type', but 'Type' could be instantiated with a different subtype of constraint '{ length: number; }'. } } Try It might look like this function is OK - Type is constrained to { length: number } , and the function either returns Type or a value matching that constraint. The problem is that the function promises to return the same kind of object as was passed in, not just some object matching the constraint. If this code were legal, you could write code that definitely wouldn‚Äôt work: ts // &apos;arr&apos; gets value { length: 6 } const arr = (obj: number[], minimum: number): number[]' >minimumLength ([ 1 , 2 , 3 ], 6 ); // and crashes here because arrays have // a &apos;slice&apos; method, but not the returned object! console . log ( arr . .slice(start?: number, end?: number): number[]' >slice ( 0 )); Try Specifying Type Arguments TypeScript can usually infer the intended type arguments in a generic call, but not always. For example, let‚Äôs say you wrote a function to combine two arrays: ts function (arr1: Type[], arr2: Type[]): Type[]' >combine < (arr1: Type[], arr2: Type[]): Type[]' >Type >( arr1 : (arr1: Type[], arr2: Type[]): Type[]' >Type [], arr2 : (arr1: Type[], arr2: Type[]): Type[]' >Type []): (arr1: Type[], arr2: Type[]): Type[]' >Type [] { return arr1 . .concat(...items: ConcatArray<Type>[]): Type[] (+1 overload)' >concat ( arr2 ); } Try Normally it would be an error to call this function with mismatched arrays: ts const arr = (arr1: number[], arr2: number[]): number[]' >combine ([ 1 , 2 , 3 ], [ \"hello\" ]); Type 'string' is not assignable to type 'number'. 2322 Type 'string' is not assignable to type 'number'. Try If you intended to do this, however, you could manually specify Type : ts const arr = (arr1: (string | number)[], arr2: (string | number)[]): (string | number)[]' >combine < string | number >([ 1 , 2 , 3 ], [ \"hello\" ]); Try Guidelines for Writing Good Generic Functions Writing generic functions is fun, and it can be easy to get carried away with type parameters. Having too many type parameters or using constraints where they aren‚Äôt needed can make inference less successful, frustrating callers of your function. Push Type Parameters Down Here are two ways of writing a function that appear similar: ts function (arr: Type[]): Type' >firstElement1 < (arr: Type[]): Type' >Type >( arr : (arr: Type[]): Type' >Type []) { return arr [ 0 ]; } function (arr: Type): any' >firstElement2 < (arr: Type): any' >Type extends any []>( arr : (arr: Type): any' >Type ) { return arr [ 0 ]; } // a: number (good) const a = (arr: number[]): number' >firstElement1 ([ 1 , 2 , 3 ]); // b: any (bad) const b = (arr: number[]): any' >firstElement2 ([ 1 , 2 , 3 ]); Try These might seem identical at first glance, but firstElement1 is a much better way to write this function. Its inferred return type is Type , but firstElement2 ‚Äôs inferred return type is any because TypeScript has to resolve the arr[0] expression using the constraint type, rather than ‚Äúwaiting‚Äù to resolve the element during a call. Rule : When possible, use the type parameter itself rather than constraining it Use Fewer Type Parameters Here‚Äôs another pair of similar functions: ts function (arr: Type[], func: (arg: Type) => boolean): Type[]' >filter1 < (arr: Type[], func: (arg: Type) => boolean): Type[]' >Type >( arr : (arr: Type[], func: (arg: Type) => boolean): Type[]' >Type [], boolean' >func : ( arg : (arr: Type[], func: (arg: Type) => boolean): Type[]' >Type ) => boolean ): (arr: Type[], func: (arg: Type) => boolean): Type[]' >Type [] { return arr . .filter(predicate: (value: Type, index: number, array: Type[]) => unknown, thisArg?: any): Type[] (+1 overload)' >filter ( boolean' >func ); } function boolean>(arr: Type[], func: Func): Type[]' >filter2 < boolean>(arr: Type[], func: Func): Type[]' >Type , boolean>(arr: Type[], func: Func): Type[]' >Func extends ( arg : boolean>(arr: Type[], func: Func): Type[]' >Type ) => boolean >( arr : boolean>(arr: Type[], func: Func): Type[]' >Type [], boolean' >func : boolean>(arr: Type[], func: Func): Type[]' >Func ): boolean>(arr: Type[], func: Func): Type[]' >Type [] { return arr . .filter(predicate: (value: Type, index: number, array: Type[]) => unknown, thisArg?: any): Type[] (+1 overload)' >filter ( boolean' >func ); } Try We‚Äôve created a type parameter Func that doesn‚Äôt relate two values . That‚Äôs always a red flag, because it means callers wanting to specify type arguments have to manually specify an extra type argument for no reason. Func doesn‚Äôt do anything but make the function harder to read and reason about! Rule : Always use as few type parameters as possible Type Parameters Should Appear Twice Sometimes we forget that a function might not need to be generic: ts function (s: Str): void' >greet < (s: Str): void' >Str extends string >( s : (s: Str): void' >Str ) { console . log ( \"Hello, \" + s ); } (s: \"world\"): void' >greet ( \"world\" ); Try We could just as easily have written a simpler version: ts function greet ( s : string ) { console . log ( \"Hello, \" + s ); } Try Remember, type parameters are for relating the types of multiple values . If a type parameter is only used once in the function signature, it‚Äôs not relating anything. This includes the inferred return type; for example, if Str was part of the inferred return type of greet , it would be relating the argument and return types, so would be used twice despite appearing only once in the written code. Rule : If a type parameter only appears in one location, strongly reconsider if you actually need it Optional Parameters Functions in JavaScript often take a variable number of arguments. For example, the toFixed method of number takes an optional digit count: ts function f ( n : number ) { console . log ( n . toFixed ()); // 0 arguments console . log ( n . toFixed ( 3 )); // 1 argument } Try We can model this in TypeScript by marking the parameter as optional with ? : ts function f ( x ?: number ) { // ... } f (); // OK f ( 10 ); // OK Try Although the parameter is specified as type number , the x parameter will actually have the type number | undefined because unspecified parameters in JavaScript get the value undefined . You can also provide a parameter default : ts function f ( x = 10 ) { // ... } Try Now in the body of f , x will have type number because any undefined argument will be replaced with 10 . Note that when a parameter is optional, callers can always pass undefined , as this simply simulates a ‚Äúmissing‚Äù argument: ts // All OK f (); f ( 10 ); f ( undefined ); Try Optional Parameters in Callbacks Once you‚Äôve learned about optional parameters and function type expressions, it‚Äôs very easy to make the following mistakes when writing functions that invoke callbacks: ts function void): void' >myForEach ( arr : any [], void' >callback : ( arg : any , index ?: number ) => void ) { for ( let i = 0 ; i < arr . .length: number' >length ; i ++) { void' >callback ( arr [ i ], i ); } } Try What people usually intend when writing index? as an optional parameter is that they want both of these calls to be legal: ts void): void' >myForEach ([ 1 , 2 , 3 ], ( a ) => console . log ( a )); void): void' >myForEach ([ 1 , 2 , 3 ], ( a , i ) => console . log ( a , i )); Try What this actually means is that callback might get invoked with one argument . In other words, the function definition says that the implementation might look like this: ts function void): void' >myForEach ( arr : any [], void' >callback : ( arg : any , index ?: number ) => void ) { for ( let i = 0 ; i < arr . .length: number' >length ; i ++) { // I don&apos;t feel like providing the index today void' >callback ( arr [ i ]); } } Try In turn, TypeScript will enforce this meaning and issue errors that aren‚Äôt really possible: ts void): void' >myForEach ([ 1 , 2 , 3 ], ( a , i ) => { console . log ( i . toFixed ()); 'i' is possibly 'undefined'. 18048 'i' is possibly 'undefined'. }); Try In JavaScript, if you call a function with more arguments than there are parameters, the extra arguments are simply ignored. TypeScript behaves the same way. Functions with fewer parameters (of the same types) can always take the place of functions with more parameters. Rule : When writing a function type for a callback, never write an optional parameter unless you intend to call the function without passing that argument Function Overloads Some JavaScript functions can be called in a variety of argument counts and types. For example, you might write a function to produce a Date that takes either a timestamp (one argument) or a month/day/year specification (three arguments). In TypeScript, we can specify a function that can be called in different ways by writing overload signatures . To do this, write some number of function signatures (usually two or more), followed by the body of the function: ts function makeDate ( timestamp : number ): Date ; function makeDate ( m : number , d : number , y : number ): Date ; function makeDate ( mOrTimestamp : number , d ?: number , y ?: number ): Date { if ( d !== undefined && y !== undefined ) { return new Date (+4 overloads)' >Date ( y , mOrTimestamp , d ); } else { return new Date (+4 overloads)' >Date ( mOrTimestamp ); } } const d1 = makeDate ( 12345678 ); const d2 = makeDate ( 5 , 5 , 5 ); const d3 = makeDate ( 1 , 3 ); No overload expects 2 arguments, but overloads do exist that expect either 1 or 3 arguments. 2575 No overload expects 2 arguments, but overloads do exist that expect either 1 or 3 arguments. Try In this example, we wrote two overloads: one accepting one argument, and another accepting three arguments. These first two signatures are called the overload signatures . Then, we wrote a function implementation with a compatible signature. Functions have an implementation signature, but this signature can‚Äôt be called directly. Even though we wrote a function with two optional parameters after the required one, it can‚Äôt be called with two parameters! Overload Signatures and the Implementation Signature This is a common source of confusion. Often people will write code like this and not understand why there is an error: ts function fn ( x : string ): void ; function fn () { // ... } // Expected to be able to call with zero arguments fn (); Expected 1 arguments, but got 0. 2554 Expected 1 arguments, but got 0. Try Again, the signature used to write the function body can‚Äôt be ‚Äúseen‚Äù from the outside. The signature of the implementation is not visible from the outside. When writing an overloaded function, you should always have two or more signatures above the implementation of the function. The implementation signature must also be compatible with the overload signatures. For example, these functions have errors because the implementation signature doesn‚Äôt match the overloads in a correct way: ts function fn ( x : boolean ): void ; // Argument type isn&apos;t right function fn ( x : string ): void ; This overload signature is not compatible with its implementation signature. 2394 This overload signature is not compatible with its implementation signature. function fn ( x : boolean ) {} Try ts function fn ( x : string ): string ; // Return type isn&apos;t right function fn ( x : number ): boolean ; This overload signature is not compatible with its implementation signature. 2394 This overload signature is not compatible with its implementation signature. function fn ( x : string | number ) { return \"oops\" ; } Try Writing Good Overloads Like generics, there are a few guidelines you should follow when using function overloads. Following these principles will make your function easier to call, easier to understand, and easier to implement. Let‚Äôs consider a function that returns the length of a string or an array: ts function len ( s : string ): number ; function len ( arr : any []): number ; function len ( x : any ) { return x . length ; } Try This function is fine; we can invoke it with strings or arrays. However, we can‚Äôt invoke it with a value that might be a string or an array, because TypeScript can only resolve a function call to a single overload: ts len ( \"\" ); // OK len ([ 0 ]); // OK len ( Math . random () > 0.5 ? \"hello\" : [ 0 ]); No overload matches this call. Overload 1 of 2, '(s: string): number', gave the following error. Argument of type 'number[] | \"hello\"' is not assignable to parameter of type 'string'. Type 'number[]' is not assignable to type 'string'. Overload 2 of 2, '(arr: any[]): number', gave the following error. Argument of type 'number[] | \"hello\"' is not assignable to parameter of type 'any[]'. Type 'string' is not assignable to type 'any[]'. 2769 No overload matches this call. Overload 1 of 2, '(s: string): number', gave the following error. Argument of type 'number[] | \"hello\"' is not assignable to parameter of type 'string'. Type 'number[]' is not assignable to type 'string'. Overload 2 of 2, '(arr: any[]): number', gave the following error. Argument of type 'number[] | \"hello\"' is not assignable to parameter of type 'any[]'. Type 'string' is not assignable to type 'any[]'. Try Because both overloads have the same argument count and same return type, we can instead write a non-overloaded version of the function: ts function len ( x : any [] | string ) { return x . length ; } Try This is much better! Callers can invoke this with either sort of value, and as an added bonus, we don‚Äôt have to figure out a correct implementation signature. Always prefer parameters with union types instead of overloads when possible Declaring this in a Function TypeScript will infer what the this should be in a function via code flow analysis, for example in the following: ts const void;&#10;}' >user = { id : 123 , admin : false , void' >becomeAdmin : function () { this . admin = true ; }, }; Try TypeScript understands that the function user.becomeAdmin has a corresponding this which is the outer object user . this , heh , can be enough for a lot of cases, but there are a lot of cases where you need more control over what object this represents. The JavaScript specification states that you cannot have a parameter called this , and so TypeScript uses that syntax space to let you declare the type for this in the function body. ts interface DB { boolean): User[]' >filterUsers ( boolean' >filter : ( this : User ) => boolean ): User []; } const db = DB' >getDB (); const admins = db . boolean): User[]' >filterUsers ( function ( this : User ) { return this . admin ; }); Try This pattern is common with callback-style APIs, where another object typically controls when your function is called. Note that you need to use function and not arrow functions to get this behavior: ts interface DB { boolean): User[]' >filterUsers ( boolean' >filter : ( this : User ) => boolean ): User []; } const db = DB' >getDB (); const admins = db . boolean): User[]' >filterUsers (() => this . admin ); The containing arrow function captures the global value of 'this'. Element implicitly has an 'any' type because type 'typeof globalThis' has no index signature. 7041 7017 The containing arrow function captures the global value of 'this'. Element implicitly has an 'any' type because type 'typeof globalThis' has no index signature. Try Other Types to Know About There are some additional types you‚Äôll want to recognize that appear often when working with function types. Like all types, you can use them everywhere, but these are especially relevant in the context of functions. void void represents the return value of functions which don‚Äôt return a value. It‚Äôs the inferred type any time a function doesn‚Äôt have any return statements, or doesn‚Äôt return any explicit value from those return statements: ts // The inferred return type is void function noop () { return ; } Try In JavaScript, a function that doesn‚Äôt return any value will implicitly return the value undefined . However, void and undefined are not the same thing in TypeScript. There are further details at the end of this chapter. void is not the same as undefined . object The special type object refers to any value that isn‚Äôt a primitive ( string , number , bigint , boolean , symbol , null , or undefined ). This is different from the empty object type { } , and also different from the global type Object . It‚Äôs very likely you will never use Object . object is not Object . Always use object ! Note that in JavaScript, function values are objects: They have properties, have Object.prototype in their prototype chain, are instanceof Object , you can call Object.keys on them, and so on. For this reason, function types are considered to be object s in TypeScript. unknown The unknown type represents any value. This is similar to the any type, but is safer because it‚Äôs not legal to do anything with an unknown value: ts function f1 ( a : any ) { a . b (); // OK } function f2 ( a : unknown ) { a . b (); 'a' is of type 'unknown'. 18046 'a' is of type 'unknown'. } Try This is useful when describing function types because you can describe functions that accept any value without having any values in your function body. Conversely, you can describe a function that returns a value of unknown type: ts function safeParse ( s : string ): unknown { return JSON . any): any' >parse ( s ); } // Need to be careful with &apos;obj&apos;! const obj = safeParse ( someRandomString ); Try never Some functions never return a value: ts function fail ( msg : string ): never { throw new Error' >Error ( msg ); } Try The never type represents values which are never observed. In a return type, this means that the function throws an exception or terminates execution of the program. never also appears when TypeScript determines there‚Äôs nothing left in a union. ts function fn ( x : string | number ) { if ( typeof x === \"string\" ) { // do something } else if ( typeof x === \"number\" ) { // do something else } else { x ; // has type &apos;never&apos;! } } Try Function The global type Function describes properties like bind , call , apply , and others present on all function values in JavaScript. It also has the special property that values of type Function can always be called; these calls return any : ts function doSomething ( f : Function ) { return f ( 1 , 2 , 3 ); } Try This is an untyped function call and is generally best avoided because of the unsafe any return type. If you need to accept an arbitrary function but don‚Äôt intend to call it, the type () => void is generally safer. Rest Parameters and Arguments Background Reading: Rest Parameters Spread Syntax Rest Parameters In addition to using optional parameters or overloads to make functions that can accept a variety of fixed argument counts, we can also define functions that take an unbounded number of arguments using rest parameters . A rest parameter appears after all other parameters, and uses the ... syntax: ts function multiply ( n : number , ... m : number []) { return m . .map<number>(callbackfn: (value: number, index: number, array: number[]) => number, thisArg?: any): number[]' >map (( x ) => n * x ); } // &apos;a&apos; gets value [10, 20, 30, 40] const a = multiply ( 10 , 1 , 2 , 3 , 4 ); Try In TypeScript, the type annotation on these parameters is implicitly any[] instead of any , and any type annotation given must be of the form Array&#x3C;T> or T[] , or a tuple type (which we‚Äôll learn about later). Rest Arguments Conversely, we can provide a variable number of arguments from an iterable object (for example, an array) using the spread syntax. For example, the push method of arrays takes any number of arguments: ts const arr1 = [ 1 , 2 , 3 ]; const arr2 = [ 4 , 5 , 6 ]; arr1 . .push(...items: number[]): number' >push (... arr2 ); Try Note that in general, TypeScript does not assume that arrays are immutable. This can lead to some surprising behavior: ts // Inferred type is number[] -- \"an array with zero or more numbers\", // not specifically two numbers const args = [ 8 , 5 ]; const angle = Math . atan2 (... args ); A spread argument must either have a tuple type or be passed to a rest parameter. 2556 A spread argument must either have a tuple type or be passed to a rest parameter. Try The best fix for this situation depends a bit on your code, but in general a const context is the most straightforward solution: ts // Inferred as 2-length tuple const args = [ 8 , 5 ] as const ; // OK const angle = Math . atan2 (... args ); Try Using rest arguments may require turning on downlevelIteration when targeting older runtimes. Parameter Destructuring Background Reading: Destructuring Assignment You can use parameter destructuring to conveniently unpack objects provided as an argument into one or more local variables in the function body. In JavaScript, it looks like this: js function sum ({ a , b , c }) { console . log ( a + b + c ); } sum ({ a: 10 , b: 3 , c: 9 }); The type annotation for the object goes after the destructuring syntax: ts function sum ({ a , b , c }: { a : number ; b : number ; c : number }) { console . log ( a + b + c ); } Try This can look a bit verbose, but you can use a named type here as well: ts // Same as prior example type ABC = { a : number ; b : number ; c : number }; function sum ({ a , b , c }: ABC ) { console . log ( a + b + c ); } Try Assignability of Functions Return type void The void return type for functions can produce some unusual, but expected behavior. Contextual typing with a return type of void does not force functions to not return something. Another way to say this is a contextual function type with a void return type ( type voidFunc = () => void ), when implemented, can return any other value, but it will be ignored. Thus, the following implementations of the type () => void are valid: ts type void' >voidFunc = () => void ; const f1 : void' >voidFunc = () => { return true ; }; const f2 : void' >voidFunc = () => true ; const f3 : void' >voidFunc = function () { return true ; }; Try And when the return value of one of these functions is assigned to another variable, it will retain the type of void : ts const v1 = void' >f1 (); const v2 = void' >f2 (); const v3 = void' >f3 (); Try This behavior exists so that the following code is valid even though Array.prototype.push returns a number and the Array.prototype.forEach method expects a function with a return type of void . ts const src = [ 1 , 2 , 3 ]; const dst = [ 0 ]; src . .forEach(callbackfn: (value: number, index: number, array: number[]) => void, thisArg?: any): void' >forEach (( el ) => dst . .push(...items: number[]): number' >push ( el )); Try There is one other special case to be aware of, when a literal function definition has a void return type, that function must not return anything. ts function f2 (): void { // @ts-expect-error return true ; } const void' >f3 = function (): void { // @ts-expect-error return true ; }; Try For more on void please refer to these other documentation entries: FAQ - ‚ÄúWhy are functions returning non-void assignable to function returning void?‚Äù On this page Function Type Expressions Call Signatures Construct Signatures Generic Functions Inference Constraints Working with Constrained Values Specifying Type Arguments Guidelines for Writing Good Generic Functions Optional Parameters Optional Parameters in Callbacks Function Overloads Overload Signatures and the Implementation Signature Writing Good Overloads Declaring this in a Function Other Types to Know About void object unknown never Function Rest Parameters and Arguments Rest Parameters Rest Arguments Parameter Destructuring Assignability of Functions Return type void Is this page helpful? Yes No Previous Narrowing Understand how TypeScript uses JavaScript knowledge to reduce the amount of type syntax in your projects. Next Object Types How TypeScript describes the shapes of JavaScript objects. The TypeScript docs are an open source project. Help us improve these pages by sending a Pull Request ‚ù§ Contributors to this page: RC OT HA JW SB 38 + Last updated: Dec 29, 2025 Customize Site Colours : System Always Light Always Dark Code Font : Cascadia Cascadia (ligatures) Consolas Dank Mono Fira Code JetBrains Mono OpenDyslexic SF Mono Source Code Pro Popular Documentation Pages Everyday Types All of the common types in TypeScript Creating Types from Types Techniques to make more elegant types More on Functions How to provide types to functions in JavaScript More on Objects How to provide a type shape to JavaScript objects Narrowing How TypeScript infers types based on runtime behavior Variable Declarations How to create and type JavaScript variables TypeScript in 5 minutes An overview of building a TypeScript web app TSConfig Options All the configuration options for a project Classes How to provide types to JavaScript ES6 classes Made with ‚ô• in Redmond, Boston, SF & Dublin ¬© 2012- 2025 Microsoft Privacy Terms of Use Using TypeScript Get Started Download Community Playground TSConfig Ref Code Samples Why TypeScript Design Community Get Help Blog GitHub Repo Community Chat @TypeScript Mastodon Stack Overflow Web Repo MSG",
      "chunk_ids": [],
      "metadata": {
        "url": "https://www.typescriptlang.org/docs/handbook/2/functions.html",
        "title": "TypeScript: Documentation - More on Functions"
      },
      "is_distractor": false,
      "semantic_tags": [
        "documentation",
        "function",
        "typescript"
      ],
      "content_hash": "f3c5c48c667d08a9",
      "size_bytes": 36603,
      "created_at": "2026-01-02T20:42:12.445257"
    },
    {
      "doc_id": "online_arxiv_org_abs_2301_00774",
      "source": "online",
      "category": "academic",
      "domain": "arxiv_ai",
      "file_path": "https://arxiv.org/abs/2301.00774",
      "content": "[2301.00774] SparseGPT: Massive Language Models Can Be Accurately Pruned in One-Shot Skip to main content We gratefully acknowledge support from the Simons Foundation, member institutions , and all contributors. Donate > cs > arXiv:2301.00774 Help | Advanced Search All fields Title Author Abstract Comments Journal reference ACM classification MSC classification Report number arXiv identifier DOI ORCID arXiv author ID Help pages Full text Search open search GO open navigation menu quick links Login Help Pages About --> Computer Science > Machine Learning arXiv:2301.00774 (cs) [Submitted on 2 Jan 2023 ( v1 ), last revised 22 Mar 2023 (this version, v3)] Title: SparseGPT: Massive Language Models Can Be Accurately Pruned in One-Shot Authors: Elias Frantar , Dan Alistarh View a PDF of the paper titled SparseGPT: Massive Language Models Can Be Accurately Pruned in One-Shot, by Elias Frantar and 1 other authors View PDF Abstract: We show for the first time that large-scale generative pretrained transformer (GPT) family models can be pruned to at least 50% sparsity in one-shot, without any retraining, at minimal loss of accuracy. This is achieved via a new pruning method called SparseGPT, specifically designed to work efficiently and accurately on massive GPT-family models. We can execute SparseGPT on the largest available open-source models, OPT-175B and BLOOM-176B, in under 4.5 hours, and can reach 60% unstructured sparsity with negligible increase in perplexity: remarkably, more than 100 billion weights from these models can be ignored at inference time. SparseGPT generalizes to semi-structured (2:4 and 4:8) patterns, and is compatible with weight quantization approaches. The code is available at: this https URL . Subjects: Machine Learning (cs.LG) Cite as: arXiv:2301.00774 [cs.LG] (or arXiv:2301.00774v3 [cs.LG] for this version) https://doi.org/10.48550/arXiv.2301.00774 Focus to learn more arXiv-issued DOI via DataCite Submission history From: Elias Frantar [ view email ] [v1] Mon, 2 Jan 2023 17:48:56 UTC (183 KB) [v2] Wed, 18 Jan 2023 17:13:49 UTC (183 KB) [v3] Wed, 22 Mar 2023 12:33:46 UTC (242 KB) Full-text links: Access Paper: View a PDF of the paper titled SparseGPT: Massive Language Models Can Be Accurately Pruned in One-Shot, by Elias Frantar and 1 other authors View PDF TeX Source view license Current browse context: cs.LG < prev | next > new | recent | 2023-01 Change to browse by: cs References & Citations NASA ADS Google Scholar Semantic Scholar 1 blog link ( what is this? ) export BibTeX citation Loading... BibTeX formatted citation &times; loading... Data provided by: Bookmark Bibliographic Tools Bibliographic and Citation Tools Bibliographic Explorer Toggle Bibliographic Explorer ( What is the Explorer? ) Connected Papers Toggle Connected Papers ( What is Connected Papers? ) Litmaps Toggle Litmaps ( What is Litmaps? ) scite.ai Toggle scite Smart Citations ( What are Smart Citations? ) Code, Data, Media Code, Data and Media Associated with this Article alphaXiv Toggle alphaXiv ( What is alphaXiv? ) Links to Code Toggle CatalyzeX Code Finder for Papers ( What is CatalyzeX? ) DagsHub Toggle DagsHub ( What is DagsHub? ) GotitPub Toggle Gotit.pub ( What is GotitPub? ) Huggingface Toggle Hugging Face ( What is Huggingface? ) Links to Code Toggle Papers with Code ( What is Papers with Code? ) ScienceCast Toggle ScienceCast ( What is ScienceCast? ) Demos Demos Replicate Toggle Replicate ( What is Replicate? ) Spaces Toggle Hugging Face Spaces ( What is Spaces? ) Spaces Toggle TXYZ.AI ( What is TXYZ.AI? ) Related Papers Recommenders and Search Tools Link to Influence Flower Influence Flower ( What are Influence Flowers? ) Core recommender toggle CORE Recommender ( What is CORE? ) IArxiv recommender toggle IArxiv Recommender ( What is IArxiv? ) Author Venue Institution Topic About arXivLabs arXivLabs: experimental projects with community collaborators arXivLabs is a framework that allows collaborators to develop and share new arXiv features directly on our website. Both individuals and organizations that work with arXivLabs have embraced and accepted our values of openness, community, excellence, and user data privacy. arXiv is committed to these values and only works with partners that adhere to them. Have an idea for a project that will add value for arXiv's community? Learn more about arXivLabs . Which authors of this paper are endorsers? | Disable MathJax ( What is MathJax? ) About Help contact arXiv Click here to contact arXiv Contact subscribe to arXiv mailings Click here to subscribe Subscribe Copyright Privacy Policy Web Accessibility Assistance arXiv Operational Status",
      "chunk_ids": [],
      "metadata": {
        "url": "https://arxiv.org/abs/2301.00774",
        "title": "[2301.00774] SparseGPT: Massive Language Models Can Be Accurately Pruned in One-Shot"
      },
      "is_distractor": false,
      "semantic_tags": [
        "arxiv",
        "class"
      ],
      "content_hash": "db3f96298b7db016",
      "size_bytes": 4663,
      "created_at": "2026-01-02T20:42:23.531875"
    },
    {
      "doc_id": "online_arxiv_org_abs_2303_08774",
      "source": "online",
      "category": "academic",
      "domain": "arxiv_ai",
      "file_path": "https://arxiv.org/abs/2303.08774",
      "content": "[2303.08774] GPT-4 Technical Report Skip to main content We gratefully acknowledge support from the Simons Foundation, member institutions , and all contributors. Donate > cs > arXiv:2303.08774 Help | Advanced Search All fields Title Author Abstract Comments Journal reference ACM classification MSC classification Report number arXiv identifier DOI ORCID arXiv author ID Help pages Full text Search open search GO open navigation menu quick links Login Help Pages About --> Computer Science > Computation and Language arXiv:2303.08774 (cs) [Submitted on 15 Mar 2023 ( v1 ), last revised 4 Mar 2024 (this version, v6)] Title: GPT-4 Technical Report Authors: OpenAI , Josh Achiam , Steven Adler , Sandhini Agarwal , Lama Ahmad , Ilge Akkaya , Florencia Leoni Aleman , Diogo Almeida , Janko Altenschmidt , Sam Altman , Shyamal Anadkat , Red Avila , Igor Babuschkin , Suchir Balaji , Valerie Balcom , Paul Baltescu , Haiming Bao , Mohammad Bavarian , Jeff Belgum , Irwan Bello , Jake Berdine , Gabriel Bernadett-Shapiro , Christopher Berner , Lenny Bogdonoff , Oleg Boiko , Madelaine Boyd , Anna-Luisa Brakman , Greg Brockman , Tim Brooks , Miles Brundage , Kevin Button , Trevor Cai , Rosie Campbell , Andrew Cann , Brittany Carey , Chelsea Carlson , Rory Carmichael , Brooke Chan , Che Chang , Fotis Chantzis , Derek Chen , Sully Chen , Ruby Chen , Jason Chen , Mark Chen , Ben Chess , Chester Cho , Casey Chu , Hyung Won Chung , Dave Cummings , Jeremiah Currier , Yunxing Dai , Cory Decareaux , Thomas Degry , Noah Deutsch , Damien Deville , Arka Dhar , David Dohan , Steve Dowling , Sheila Dunning , Adrien Ecoffet , Atty Eleti , Tyna Eloundou , David Farhi , Liam Fedus , Niko Felix , Sim√≥n Posada Fishman , Juston Forte , Isabella Fulford , Leo Gao , Elie Georges , Christian Gibson , Vik Goel , Tarun Gogineni , Gabriel Goh , Rapha Gontijo-Lopes , Jonathan Gordon , Morgan Grafstein , Scott Gray , Ryan Greene , Joshua Gross , Shixiang Shane Gu , Yufei Guo , Chris Hallacy , Jesse Han , Jeff Harris , Yuchen He , Mike Heaton , Johannes Heidecke , Chris Hesse , Alan Hickey , Wade Hickey , Peter Hoeschele , Brandon Houghton , Kenny Hsu , Shengli Hu , Xin Hu , Joost Huizinga , Shantanu Jain , Shawn Jain , Joanne Jang , Angela Jiang , Roger Jiang , Haozhun Jin , Denny Jin , Shino Jomoto , Billie Jonn , Heewoo Jun , Tomer Kaftan , ≈Åukasz Kaiser , Ali Kamali , Ingmar Kanitscheider , Nitish Shirish Keskar , Tabarak Khan , Logan Kilpatrick , Jong Wook Kim , Christina Kim , Yongjik Kim , Jan Hendrik Kirchner , Jamie Kiros , Matt Knight , Daniel Kokotajlo , ≈Åukasz Kondraciuk , Andrew Kondrich , Aris Konstantinidis , Kyle Kosic , Gretchen Krueger , Vishal Kuo , Michael Lampe , Ikai Lan , Teddy Lee , Jan Leike , Jade Leung , Daniel Levy , Chak Ming Li , Rachel Lim , Molly Lin , Stephanie Lin , Mateusz Litwin , Theresa Lopez , Ryan Lowe , Patricia Lue , Anna Makanju , Kim Malfacini , Sam Manning , Todor Markov , Yaniv Markovski , Bianca Martin , Katie Mayer , Andrew Mayne , Bob McGrew , Scott Mayer McKinney , Christine McLeavey , Paul McMillan , Jake McNeil , David Medina , Aalok Mehta , Jacob Menick , Luke Metz , Andrey Mishchenko , Pamela Mishkin , Vinnie Monaco , Evan Morikawa , Daniel Mossing , Tong Mu , Mira Murati , Oleg Murk , David M√©ly , Ashvin Nair , Reiichiro Nakano , Rajeev Nayak , Arvind Neelakantan , Richard Ngo , Hyeonwoo Noh , Long Ouyang , Cullen O&#39;Keefe , Jakub Pachocki , Alex Paino , Joe Palermo , Ashley Pantuliano , Giambattista Parascandolo , Joel Parish , Emy Parparita , Alex Passos , Mikhail Pavlov , Andrew Peng , Adam Perelman , Filipe de Avila Belbute Peres , Michael Petrov , Henrique Ponde de Oliveira Pinto , Michael (Rai) Pokorny , Michelle Pokrass , Vitchyr H. Pong , Tolly Powell , Alethea Power , Boris Power , Elizabeth Proehl , Raul Puri , Alec Radford , Jack Rae , Aditya Ramesh , Cameron Raymond , Francis Real , Kendra Rimbach , Carl Ross , Bob Rotsted , Henri Roussez , Nick Ryder , Mario Saltarelli , Ted Sanders , Shibani Santurkar , Girish Sastry , Heather Schmidt , David Schnurr , John Schulman , Daniel Selsam , Kyla Sheppard , Toki Sherbakov , Jessica Shieh , Sarah Shoker , Pranav Shyam , Szymon Sidor , Eric Sigler , Maddie Simens , Jordan Sitkin , Katarina Slama , Ian Sohl , Benjamin Sokolowsky , Yang Song , Natalie Staudacher , Felipe Petroski Such , Natalie Summers , Ilya Sutskever , Jie Tang , Nikolas Tezak , Madeleine B. Thompson , Phil Tillet , Amin Tootoonchian , Elizabeth Tseng , Preston Tuggle , Nick Turley , Jerry Tworek , Juan Felipe Cer√≥n Uribe , Andrea Vallone , Arun Vijayvergiya , Chelsea Voss , Carroll Wainwright , Justin Jay Wang , Alvin Wang , Ben Wang , Jonathan Ward , Jason Wei , CJ Weinmann , Akila Welihinda , Peter Welinder , Jiayi Weng , Lilian Weng , Matt Wiethoff , Dave Willner , Clemens Winter , Samuel Wolrich , Hannah Wong , Lauren Workman , Sherwin Wu , Jeff Wu , Michael Wu , Kai Xiao , Tao Xu , Sarah Yoo , Kevin Yu , Qiming Yuan , Wojciech Zaremba , Rowan Zellers , Chong Zhang , Marvin Zhang , Shengjia Zhao , Tianhao Zheng , Juntang Zhuang , William Zhuk , Barret Zoph et al. (181 additional authors not shown) You must enable JavaScript to view entire author list. View a PDF of the paper titled GPT-4 Technical Report, by OpenAI and 279 other authors View PDF HTML (experimental) Abstract: We report the development of GPT-4, a large-scale, multimodal model which can accept image and text inputs and produce text outputs. While less capable than humans in many real-world scenarios, GPT-4 exhibits human-level performance on various professional and academic benchmarks, including passing a simulated bar exam with a score around the top 10% of test takers. GPT-4 is a Transformer-based model pre-trained to predict the next token in a document. The post-training alignment process results in improved performance on measures of factuality and adherence to desired behavior. A core component of this project was developing infrastructure and optimization methods that behave predictably across a wide range of scales. This allowed us to accurately predict some aspects of GPT-4&#39;s performance based on models trained with no more than 1/1,000th the compute of GPT-4. Comments: 100 pages; updated authors list; fixed author names and added citation Subjects: Computation and Language (cs.CL) ; Artificial Intelligence (cs.AI) Cite as: arXiv:2303.08774 [cs.CL] (or arXiv:2303.08774v6 [cs.CL] for this version) https://doi.org/10.48550/arXiv.2303.08774 Focus to learn more arXiv-issued DOI via DataCite Submission history From: Adrien Ecoffet [ view email ] [v1] Wed, 15 Mar 2023 17:15:04 UTC (3,853 KB) [v2] Thu, 16 Mar 2023 04:59:24 UTC (3,855 KB) [v3] Mon, 27 Mar 2023 17:46:54 UTC (4,016 KB) [v4] Tue, 19 Dec 2023 00:34:40 UTC (3,850 KB) [v5] Fri, 1 Mar 2024 16:30:27 UTC (3,849 KB) [v6] Mon, 4 Mar 2024 06:01:33 UTC (3,849 KB) Full-text links: Access Paper: View a PDF of the paper titled GPT-4 Technical Report, by OpenAI and 279 other authors View PDF HTML (experimental) TeX Source view license Current browse context: cs.CL < prev | next > new | recent | 2023-03 Change to browse by: cs cs.AI References & Citations NASA ADS Google Scholar Semantic Scholar 9 blog links ( what is this? ) export BibTeX citation Loading... BibTeX formatted citation &times; loading... Data provided by: Bookmark Bibliographic Tools Bibliographic and Citation Tools Bibliographic Explorer Toggle Bibliographic Explorer ( What is the Explorer? ) Connected Papers Toggle Connected Papers ( What is Connected Papers? ) Litmaps Toggle Litmaps ( What is Litmaps? ) scite.ai Toggle scite Smart Citations ( What are Smart Citations? ) Code, Data, Media Code, Data and Media Associated with this Article alphaXiv Toggle alphaXiv ( What is alphaXiv? ) Links to Code Toggle CatalyzeX Code Finder for Papers ( What is CatalyzeX? ) DagsHub Toggle DagsHub ( What is DagsHub? ) GotitPub Toggle Gotit.pub ( What is GotitPub? ) Huggingface Toggle Hugging Face ( What is Huggingface? ) Links to Code Toggle Papers with Code ( What is Papers with Code? ) ScienceCast Toggle ScienceCast ( What is ScienceCast? ) Demos Demos Replicate Toggle Replicate ( What is Replicate? ) Spaces Toggle Hugging Face Spaces ( What is Spaces? ) Spaces Toggle TXYZ.AI ( What is TXYZ.AI? ) Related Papers Recommenders and Search Tools Link to Influence Flower Influence Flower ( What are Influence Flowers? ) Core recommender toggle CORE Recommender ( What is CORE? ) Author Venue Institution Topic About arXivLabs arXivLabs: experimental projects with community collaborators arXivLabs is a framework that allows collaborators to develop and share new arXiv features directly on our website. Both individuals and organizations that work with arXivLabs have embraced and accepted our values of openness, community, excellence, and user data privacy. arXiv is committed to these values and only works with partners that adhere to them. Have an idea for a project that will add value for arXiv's community? Learn more about arXivLabs . Which authors of this paper are endorsers? | Disable MathJax ( What is MathJax? ) About Help contact arXiv Click here to contact arXiv Contact subscribe to arXiv mailings Click here to subscribe Subscribe Copyright Privacy Policy Web Accessibility Assistance arXiv Operational Status",
      "chunk_ids": [],
      "metadata": {
        "url": "https://arxiv.org/abs/2303.08774",
        "title": "[2303.08774] GPT-4 Technical Report"
      },
      "is_distractor": false,
      "semantic_tags": [
        "arxiv",
        "class"
      ],
      "content_hash": "be81d1994796af0c",
      "size_bytes": 9293,
      "created_at": "2026-01-02T20:42:23.531932"
    },
    {
      "doc_id": "online_arxiv_org_abs_2302_13971",
      "source": "online",
      "category": "academic",
      "domain": "arxiv_ai",
      "file_path": "https://arxiv.org/abs/2302.13971",
      "content": "[2302.13971] LLaMA: Open and Efficient Foundation Language Models Skip to main content We gratefully acknowledge support from the Simons Foundation, member institutions , and all contributors. Donate > cs > arXiv:2302.13971 Help | Advanced Search All fields Title Author Abstract Comments Journal reference ACM classification MSC classification Report number arXiv identifier DOI ORCID arXiv author ID Help pages Full text Search open search GO open navigation menu quick links Login Help Pages About --> Computer Science > Computation and Language arXiv:2302.13971 (cs) [Submitted on 27 Feb 2023] Title: LLaMA: Open and Efficient Foundation Language Models Authors: Hugo Touvron , Thibaut Lavril , Gautier Izacard , Xavier Martinet , Marie-Anne Lachaux , Timoth√©e Lacroix , Baptiste Rozi√®re , Naman Goyal , Eric Hambro , Faisal Azhar , Aurelien Rodriguez , Armand Joulin , Edouard Grave , Guillaume Lample View a PDF of the paper titled LLaMA: Open and Efficient Foundation Language Models, by Hugo Touvron and 13 other authors View PDF Abstract: We introduce LLaMA, a collection of foundation language models ranging from 7B to 65B parameters. We train our models on trillions of tokens, and show that it is possible to train state-of-the-art models using publicly available datasets exclusively, without resorting to proprietary and inaccessible datasets. In particular, LLaMA-13B outperforms GPT-3 (175B) on most benchmarks, and LLaMA-65B is competitive with the best models, Chinchilla-70B and PaLM-540B. We release all our models to the research community. Subjects: Computation and Language (cs.CL) Cite as: arXiv:2302.13971 [cs.CL] (or arXiv:2302.13971v1 [cs.CL] for this version) https://doi.org/10.48550/arXiv.2302.13971 Focus to learn more arXiv-issued DOI via DataCite Submission history From: Gautier Izacard [ view email ] [v1] Mon, 27 Feb 2023 17:11:15 UTC (364 KB) Full-text links: Access Paper: View a PDF of the paper titled LLaMA: Open and Efficient Foundation Language Models, by Hugo Touvron and 13 other authors View PDF TeX Source view license Current browse context: cs.CL < prev | next > new | recent | 2023-02 Change to browse by: cs References & Citations NASA ADS Google Scholar Semantic Scholar 5 blog links ( what is this? ) export BibTeX citation Loading... BibTeX formatted citation &times; loading... Data provided by: Bookmark Bibliographic Tools Bibliographic and Citation Tools Bibliographic Explorer Toggle Bibliographic Explorer ( What is the Explorer? ) Connected Papers Toggle Connected Papers ( What is Connected Papers? ) Litmaps Toggle Litmaps ( What is Litmaps? ) scite.ai Toggle scite Smart Citations ( What are Smart Citations? ) Code, Data, Media Code, Data and Media Associated with this Article alphaXiv Toggle alphaXiv ( What is alphaXiv? ) Links to Code Toggle CatalyzeX Code Finder for Papers ( What is CatalyzeX? ) DagsHub Toggle DagsHub ( What is DagsHub? ) GotitPub Toggle Gotit.pub ( What is GotitPub? ) Huggingface Toggle Hugging Face ( What is Huggingface? ) Links to Code Toggle Papers with Code ( What is Papers with Code? ) ScienceCast Toggle ScienceCast ( What is ScienceCast? ) Demos Demos Replicate Toggle Replicate ( What is Replicate? ) Spaces Toggle Hugging Face Spaces ( What is Spaces? ) Spaces Toggle TXYZ.AI ( What is TXYZ.AI? ) Related Papers Recommenders and Search Tools Link to Influence Flower Influence Flower ( What are Influence Flowers? ) Core recommender toggle CORE Recommender ( What is CORE? ) Author Venue Institution Topic About arXivLabs arXivLabs: experimental projects with community collaborators arXivLabs is a framework that allows collaborators to develop and share new arXiv features directly on our website. Both individuals and organizations that work with arXivLabs have embraced and accepted our values of openness, community, excellence, and user data privacy. arXiv is committed to these values and only works with partners that adhere to them. Have an idea for a project that will add value for arXiv's community? Learn more about arXivLabs . Which authors of this paper are endorsers? | Disable MathJax ( What is MathJax? ) About Help contact arXiv Click here to contact arXiv Contact subscribe to arXiv mailings Click here to subscribe Subscribe Copyright Privacy Policy Web Accessibility Assistance arXiv Operational Status",
      "chunk_ids": [],
      "metadata": {
        "url": "https://arxiv.org/abs/2302.13971",
        "title": "[2302.13971] LLaMA: Open and Efficient Foundation Language Models"
      },
      "is_distractor": false,
      "semantic_tags": [
        "arxiv",
        "class"
      ],
      "content_hash": "0796083eee62ded5",
      "size_bytes": 4329,
      "created_at": "2026-01-02T20:42:23.531980"
    },
    {
      "doc_id": "legal_license_mit_inline",
      "source": "synthetic",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "inline://license/MIT_inline",
      "content": "MIT License\n\nCopyright (c) [year] [fullname]\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "MIT_inline",
        "url": "inline://license/MIT_inline"
      },
      "is_distractor": false,
      "semantic_tags": [
        "legal",
        "liability",
        "license",
        "mit_inline",
        "warranty"
      ],
      "content_hash": "a406579cd136771c",
      "size_bytes": 1068,
      "created_at": "2026-01-02T20:42:23.532037"
    },
    {
      "doc_id": "legal_license_apache_2_inline",
      "source": "synthetic",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "inline://license/Apache_2_inline",
      "content": "Apache License\nVersion 2.0, January 2004\nhttp://www.apache.org/licenses/\n\nTERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION\n\n1. Definitions.\n\n\"License\" shall mean the terms and conditions for use, reproduction, and\ndistribution as defined by Sections 1 through 9 of this document.\n\n\"Licensor\" shall mean the copyright owner or entity authorized by the copyright\nowner that is granting the License.\n\n\"Legal Entity\" shall mean the union of the acting entity and all other entities\nthat control, are controlled by, or are under common control with that entity.\n\n\"You\" (or \"Your\") shall mean an individual or Legal Entity exercising permissions\ngranted by this License.\n\n\"Source\" form shall mean the preferred form for making modifications.\n\n\"Object\" form shall mean any form resulting from mechanical transformation or\ntranslation of a Source form.\n\n\"Work\" shall mean the work of authorship made available under the License.\n\n\"Derivative Works\" shall mean any work that is based on the Work.\n\n\"Contribution\" shall mean any work of authorship submitted for inclusion.\n\n\"Contributor\" shall mean Licensor and any Legal Entity on behalf of whom a\nContribution has been received by Licensor.\n\n2. Grant of Copyright License. Subject to the terms and conditions of this\nLicense, each Contributor hereby grants to You a perpetual, worldwide,\nnon-exclusive, no-charge, royalty-free, irrevocable copyright license to\nreproduce, prepare Derivative Works of, publicly display, publicly perform,\nsublicense, and distribute the Work and such Derivative Works in Source or\nObject form.\n\n3. Grant of Patent License. Subject to the terms and conditions of this License,\neach Contributor hereby grants to You a perpetual, worldwide, non-exclusive,\nno-charge, royalty-free, irrevocable patent license to make, have made, use,\noffer to sell, sell, import, and otherwise transfer the Work.\n\n4. Redistribution. You may reproduce and distribute copies of the Work or\nDerivative Works thereof in any medium, with or without modifications, and in\nSource or Object form, provided that You meet the following conditions:\n(a) You must give any other recipients of the Work or Derivative Works a copy of\nthis License; and (b) You must cause any modified files to carry prominent\nnotices stating that You changed the files; and (c) You must retain, in the\nSource form of any Derivative Works that You distribute, all copyright, patent,\ntrademark, and attribution notices.\n\n5. Submission of Contributions. Unless You explicitly state otherwise, any\nContribution intentionally submitted for inclusion in the Work by You shall be\nunder the terms and conditions of this License, without any additional terms.\n\n6. Trademarks. This License does not grant permission to use the trade names,\ntrademarks, service marks, or product names of the Licensor.\n\n7. Disclaimer of Warranty. Unless required by applicable law or agreed to in\nwriting, Licensor provides the Work on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\nCONDITIONS OF ANY KIND.\n\n8. Limitation of Liability. In no event shall any Contributor be liable to You\nfor any damages, including direct, indirect, special, incidental, or\nconsequential damages.\n\n9. Accepting Warranty or Additional Liability. While redistributing the Work,\nYou may choose to offer, and charge a fee for, acceptance of support, warranty,\nindemnity, or other liability obligations.",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "Apache_2_inline",
        "url": "inline://license/Apache_2_inline"
      },
      "is_distractor": false,
      "semantic_tags": [
        "apache_2_inline",
        "legal",
        "liability",
        "license",
        "warranty"
      ],
      "content_hash": "e95fcd733d5a061f",
      "size_bytes": 3377,
      "created_at": "2026-01-02T20:42:23.532053"
    },
    {
      "doc_id": "legal_license_bsd_3_inline",
      "source": "synthetic",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "inline://license/BSD_3_inline",
      "content": "BSD 3-Clause License\n\nCopyright (c) [year], [fullname]\n\nRedistribution and use in source and binary forms, with or without modification,\nare permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this\n   list of conditions and the following disclaimer.\n\n2. Redistributions in binary form must reproduce the above copyright notice,\n   this list of conditions and the following disclaimer in the documentation\n   and/or other materials provided with the distribution.\n\n3. Neither the name of the copyright holder nor the names of its contributors\n   may be used to endorse or promote products derived from this software without\n   specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR\nANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\nANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "BSD_3_inline",
        "url": "inline://license/BSD_3_inline"
      },
      "is_distractor": false,
      "semantic_tags": [
        "bsd_3_inline",
        "legal",
        "liability",
        "license",
        "warranty"
      ],
      "content_hash": "66fcfb1ae17d9822",
      "size_bytes": 1498,
      "created_at": "2026-01-02T20:42:23.532063"
    },
    {
      "doc_id": "legal_license_mit",
      "source": "online",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "https://opensource.org/license/mit/",
      "content": "‚Ä¢ \n\n The MIT License &#8211; Open Source Initiative \n \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n \n \n \n \n \n \n \n \n \n\n‚Ä¢ \n\n \n \n \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n \n \n \n\n \n \n \n\n \n\n \n \n \n \n \n \n\n \n \n \n Copyright <YEAR> <COPYRIGHT HOLDER> \n \n \n Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &#8220;Software&#8221;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: \n The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. \n THE SOFTWARE IS PROVIDED &#8220;AS IS&#8221;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. \n \n \n \n \n \n \n \n \n \n \n \n\n \n \n \n\n \n \n\n \n\n \n\n \n \n \n \n \n \n \n \n \n Manage Cookie Consent \n \n \n \n \n\n \n \n To provide the best experiences, we use technologies like cookies to store and/or access device information. Consenting to these technologies will allow us to process data such as browsing behavior or unique IDs on this site. Not consenting or withdrawing consent, may adversely affect certain features and functions. \n \n \n \n \n \n Functional \n \n \n \n Functional \n \n Always active \n \n \n \n \n \n \n The technical storage or access is strictly necessary for the legitimate purpose of enabling the use of a specific service explicitly requested by the subscriber or user, or for the sole purpose of carrying out the transmission of a communication over an electronic communications network. \n \n \n\n \n \n \n Preferences \n \n \n Preferences \n \n \n \n \n \n \n \n The technical storage or access is necessary for the legitimate purpose of storing preferences that are not requested by the subscriber or user. \n \n \n\n \n \n \n Statistics \n \n \n Statistics \n \n \n \n \n \n \n \n The technical storage or access that is used exclusively for statistical purposes. \n The technical storage or access that is used exclusively for anonymous statistical purposes. Without a subpoena, voluntary compliance on the part of your Internet Service Provider, or additional records from a third party, information stored or retrieved for this purpose alone cannot usually be used to identify you. \n \n \n \n \n \n Marketing \n \n \n Marketing \n \n \n \n \n \n \n \n The technical storage or access is required to create user profiles to send advertising, or to track the user on a website or across several websites for similar marketing purposes. \n \n \n \n \n\n \n \n \n‚Ä¢ Manage options \n \n‚Ä¢ Manage services \n \n‚Ä¢ Manage {vendor_count} vendors \n \n‚Ä¢ Read more about these purposes \n \n \n\n \n\n \n Accept \n Deny \n View preferences \n Save preferences \n View preferences \n \n\n \n \n \n \n‚Ä¢ {title} \n \n‚Ä¢ {title} \n \n‚Ä¢ {title} \n \n \n \n \n Manage consent",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "MIT",
        "url": "https://opensource.org/license/mit/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "legal",
        "liability",
        "license",
        "mit",
        "warranty"
      ],
      "content_hash": "ad711b3946a84639",
      "size_bytes": 3441,
      "created_at": "2026-01-02T20:42:23.532134"
    },
    {
      "doc_id": "legal_license_apache_2.0",
      "source": "online",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "https://www.apache.org/licenses/LICENSE-2.0.txt",
      "content": "Apache License\n Version 2.0, January 2004\n http://www.apache.org/licenses/\n\n TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION\n\n 1. Definitions.\n\n \"License\" shall mean the terms and conditions for use, reproduction,\n and distribution as defined by Sections 1 through 9 of this document.\n\n \"Licensor\" shall mean the copyright owner or entity authorized by\n the copyright owner that is granting the License.\n\n \"Legal Entity\" shall mean the union of the acting entity and all\n other entities that control, are controlled by, or are under common\n control with that entity. For the purposes of this definition,\n \"control\" means (i) the power, direct or indirect, to cause the\n direction or management of such entity, whether by contract or\n otherwise, or (ii) ownership of fifty percent (50%) or more of the\n outstanding shares, or (iii) beneficial ownership of such entity.\n\n \"You\" (or \"Your\") shall mean an individual or Legal Entity\n exercising permissions granted by this License.\n\n \"Source\" form shall mean the preferred form for making modifications,\n including but not limited to software source code, documentation\n source, and configuration files.\n\n \"Object\" form shall mean any form resulting from mechanical\n transformation or translation of a Source form, including but\n not limited to compiled object code, generated documentation,\n and conversions to other media types.\n\n \"Work\" shall mean the work of authorship, whether in Source or\n Object form, made available under the License, as indicated by a\n copyright notice that is included in or attached to the work\n (an example is provided in the Appendix below).\n\n \"Derivative Works\" shall mean any work, whether in Source or Object\n form, that is based on (or derived from) the Work and for which the\n editorial revisions, annotations, elaborations, or other modifications\n represent, as a whole, an original work of authorship. For the purposes\n of this License, Derivative Works shall not include works that remain\n separable from, or merely link (or bind by name) to the interfaces of,\n the Work and Derivative Works thereof.\n\n \"Contribution\" shall mean any work of authorship, including\n the original version of the Work and any modifications or additions\n to that Work or Derivative Works thereof, that is intentionally\n submitted to Licensor for inclusion in the Work by the copyright owner\n or by an individual or Legal Entity authorized to submit on behalf of\n the copyright owner. For the purposes of this definition, \"submitted\"\n means any form of electronic, verbal, or written communication sent\n to the Licensor or its representatives, including but not limited to\n communication on electronic mailing lists, source code control systems,\n and issue tracking systems that are managed by, or on behalf of, the\n Licensor for the purpose of discussing and improving the Work, but\n excluding communication that is conspicuously marked or otherwise\n designated in writing by the copyright owner as \"Not a Contribution.\"\n\n \"Contributor\" shall mean Licensor and any individual or Legal Entity\n on behalf of whom a Contribution has been received by Licensor and\n subsequently incorporated within the Work.\n\n 2. Grant of Copyright License. Subject to the terms and conditions of\n this License, each Contributor hereby grants to You a perpetual,\n worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n copyright license to reproduce, prepare Derivative Works of,\n publicly display, publicly perform, sublicense, and distribute the\n Work and such Derivative Works in Source or Object form.\n\n 3. Grant of Patent License. Subject to the terms and conditions of\n this License, each Contributor hereby grants to You a perpetual,\n worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n (except as stated in this section) patent license to make, have made,\n use, offer to sell, sell, import, and otherwise transfer the Work,\n where such license applies only to those patent claims licensable\n by such Contributor that are necessarily infringed by their\n Contribution(s) alone or by combination of their Contribution(s)\n with the Work to which such Contribution(s) was submitted. If You\n institute patent litigation against any entity (including a\n cross-claim or counterclaim in a lawsuit) alleging that the Work\n or a Contribution incorporated within the Work constitutes direct\n or contributory patent infringement, then any patent licenses\n granted to You under this License for that Work shall terminate\n as of the date such litigation is filed.\n\n 4. Redistribution. You may reproduce and distribute copies of the\n Work or Derivative Works thereof in any medium, with or without\n modifications, and in Source or Object form, provided that You\n meet the following conditions:\n\n (a) You must give any other recipients of the Work or\n Derivative Works a copy of this License; and\n\n (b) You must cause any modified files to carry prominent notices\n stating that You changed the files; and\n\n (c) You must retain, in the Source form of any Derivative Works\n that You distribute, all copyright, patent, trademark, and\n attribution notices from the Source form of the Work,\n excluding those notices that do not pertain to any part of\n the Derivative Works; and\n\n (d) If the Work includes a \"NOTICE\" text file as part of its\n distribution, then any Derivative Works that You distribute must\n include a readable copy of the attribution notices contained\n within such NOTICE file, excluding those notices that do not\n pertain to any part of the Derivative Works, in at least one\n of the following places: within a NOTICE text file distributed\n as part of the Derivative Works; within the Source form or\n documentation, if provided along with the Derivative Works; or,\n within a display generated by the Derivative Works, if and\n wherever such third-party notices normally appear. The contents\n of the NOTICE file are for informational purposes only and\n do not modify the License. You may add Your own attribution\n notices within Derivative Works that You distribute, alongside\n or as an addendum to the NOTICE text from the Work, provided\n that such additional attribution notices cannot be construed\n as modifying the License.\n\n You may add Your own copyright statement to Your modifications and\n may provide additional or different license terms and conditions\n for use, reproduction, or distribution of Your modifications, or\n for any such Derivative Works as a whole, provided Your use,\n reproduction, and distribution of the Work otherwise complies with\n the conditions stated in this License.\n\n 5. Submission of Contributions. Unless You explicitly state otherwise,\n any Contribution intentionally submitted for inclusion in the Work\n by You to the Licensor shall be under the terms and conditions of\n this License, without any additional terms or conditions.\n Notwithstanding the above, nothing herein shall supersede or modify\n the terms of any separate license agreement you may have executed\n with Licensor regarding such Contributions.\n\n 6. Trademarks. This License does not grant permission to use the trade\n names, trademarks, service marks, or product names of the Licensor,\n except as required for reasonable and customary use in describing the\n origin of the Work and reproducing the content of the NOTICE file.\n\n 7. Disclaimer of Warranty. Unless required by applicable law or\n agreed to in writing, Licensor provides the Work (and each\n Contributor provides its Contributions) on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n implied, including, without limitation, any warranties or conditions\n of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A\n PARTICULAR PURPOSE. You are solely responsible for determining the\n appropriateness of using or redistributing the Work and assume any\n risks associated with Your exercise of permissions under this License.\n\n 8. Limitation of Liability. In no event and under no legal theory,\n whether in tort (including negligence), contract, or otherwise,\n unless required by applicable law (such as deliberate and grossly\n negligent acts) or agreed to in writing, shall any Contributor be\n liable to You for damages, including any direct, indirect, special,\n incidental, or consequential damages of any character arising as a\n result of this License or out of the use or inability to use the\n Work (including but not limited to damages for loss of goodwill,\n work stoppage, computer failure or malfunction, or any and all\n other commercial damages or losses), even if such Contributor\n has been advised of the possibility of such damages.\n\n 9. Accepting Warranty or Additional Liability. While redistributing\n the Work or Derivative Works thereof, You may choose to offer,\n and charge a fee for, acceptance of support, warranty, indemnity,\n or other liability obligations and/or rights consistent with this\n License. However, in accepting such obligations, You may act only\n on Your own behalf and on Your sole responsibility, not on behalf\n of any other Contributor, and only if You agree to indemnify,\n defend, and hold each Contributor harmless for any liability\n incurred by, or claims asserted against, such Contributor by reason\n of your accepting any such warranty or additional liability.\n\n END OF TERMS AND CONDITIONS\n\n APPENDIX: How to apply the Apache License to your work.\n\n To apply the Apache License to your work, attach the following\n boilerplate notice, with the fields enclosed by brackets \"[]\"\n replaced with your own identifying information. (Don't include\n the brackets!) The text should be enclosed in the appropriate\n comment syntax for the file format. We also recommend that a\n file or class name and description of purpose be included on the\n same \"printed page\" as the copyright notice for easier\n identification within third-party archives.\n\n Copyright [yyyy] [name of copyright owner]\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "Apache-2.0",
        "url": "https://www.apache.org/licenses/LICENSE-2.0.txt"
      },
      "is_distractor": false,
      "semantic_tags": [
        "apache-2.0",
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "license",
        "termination",
        "warranty"
      ],
      "content_hash": "c7c5c81295bc9942",
      "size_bytes": 10421,
      "created_at": "2026-01-02T20:42:23.532227"
    },
    {
      "doc_id": "legal_license_gpl_3.0",
      "source": "online",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "https://www.gnu.org/licenses/gpl-3.0.txt",
      "content": "GNU GENERAL PUBLIC LICENSE\n Version 3, 29 June 2007\n\n Copyright (C) 2007 Free Software Foundation, Inc. \n Everyone is permitted to copy and distribute verbatim copies\n of this license document, but changing it is not allowed.\n\n Preamble\n\n The GNU General Public License is a free, copyleft license for\nsoftware and other kinds of works.\n\n The licenses for most software and other practical works are designed\nto take away your freedom to share and change the works. By contrast,\nthe GNU General Public License is intended to guarantee your freedom to\nshare and change all versions of a program--to make sure it remains free\nsoftware for all its users. We, the Free Software Foundation, use the\nGNU General Public License for most of our software; it applies also to\nany other work released this way by its authors. You can apply it to\nyour programs, too.\n\n When we speak of free software, we are referring to freedom, not\nprice. Our General Public Licenses are designed to make sure that you\nhave the freedom to distribute copies of free software (and charge for\nthem if you wish), that you receive source code or can get it if you\nwant it, that you can change the software or use pieces of it in new\nfree programs, and that you know you can do these things.\n\n To protect your rights, we need to prevent others from denying you\nthese rights or asking you to surrender the rights. Therefore, you have\ncertain responsibilities if you distribute copies of the software, or if\nyou modify it: responsibilities to respect the freedom of others.\n\n For example, if you distribute copies of such a program, whether\ngratis or for a fee, you must pass on to the recipients the same\nfreedoms that you received. You must make sure that they, too, receive\nor can get the source code. And you must show them these terms so they\nknow their rights.\n\n Developers that use the GNU GPL protect your rights with two steps:\n(1) assert copyright on the software, and (2) offer you this License\ngiving you legal permission to copy, distribute and/or modify it.\n\n For the developers' and authors' protection, the GPL clearly explains\nthat there is no warranty for this free software. For both users' and\nauthors' sake, the GPL requires that modified versions be marked as\nchanged, so that their problems will not be attributed erroneously to\nauthors of previous versions.\n\n Some devices are designed to deny users access to install or run\nmodified versions of the software inside them, although the manufacturer\ncan do so. This is fundamentally incompatible with the aim of\nprotecting users' freedom to change the software. The systematic\npattern of such abuse occurs in the area of products for individuals to\nuse, which is precisely where it is most unacceptable. Therefore, we\nhave designed this version of the GPL to prohibit the practice for those\nproducts. If such problems arise substantially in other domains, we\nstand ready to extend this provision to those domains in future versions\nof the GPL, as needed to protect the freedom of users.\n\n Finally, every program is threatened constantly by software patents.\nStates should not allow patents to restrict development and use of\nsoftware on general-purpose computers, but in those that do, we wish to\navoid the special danger that patents applied to a free program could\nmake it effectively proprietary. To prevent this, the GPL assures that\npatents cannot be used to render the program non-free.\n\n The precise terms and conditions for copying, distribution and\nmodification follow.\n\n TERMS AND CONDITIONS\n\n 0. Definitions.\n\n \"This License\" refers to version 3 of the GNU General Public License.\n\n \"Copyright\" also means copyright-like laws that apply to other kinds of\nworks, such as semiconductor masks.\n\n \"The Program\" refers to any copyrightable work licensed under this\nLicense. Each licensee is addressed as \"you\". \"Licensees\" and\n\"recipients\" may be individuals or organizations.\n\n To \"modify\" a work means to copy from or adapt all or part of the work\nin a fashion requiring copyright permission, other than the making of an\nexact copy. The resulting work is called a \"modified version\" of the\nearlier work or a work \"based on\" the earlier work.\n\n A \"covered work\" means either the unmodified Program or a work based\non the Program.\n\n To \"propagate\" a work means to do anything with it that, without\npermission, would make you directly or secondarily liable for\ninfringement under applicable copyright law, except executing it on a\ncomputer or modifying a private copy. Propagation includes copying,\ndistribution (with or without modification), making available to the\npublic, and in some countries other activities as well.\n\n To \"convey\" a work means any kind of propagation that enables other\nparties to make or receive copies. Mere interaction with a user through\na computer network, with no transfer of a copy, is not conveying.\n\n An interactive user interface displays \"Appropriate Legal Notices\"\nto the extent that it includes a convenient and prominently visible\nfeature that (1) displays an appropriate copyright notice, and (2)\ntells the user that there is no warranty for the work (except to the\nextent that warranties are provided), that licensees may convey the\nwork under this License, and how to view a copy of this License. If\nthe interface presents a list of user commands or options, such as a\nmenu, a prominent item in the list meets this criterion.\n\n 1. Source Code.\n\n The \"source code\" for a work means the preferred form of the work\nfor making modifications to it. \"Object code\" means any non-source\nform of a work.\n\n A \"Standard Interface\" means an interface that either is an official\nstandard defined by a recognized standards body, or, in the case of\ninterfaces specified for a particular programming language, one that\nis widely used among developers working in that language.\n\n The \"System Libraries\" of an executable work include anything, other\nthan the work as a whole, that (a) is included in the normal form of\npackaging a Major Component, but which is not part of that Major\nComponent, and (b) serves only to enable use of the work with that\nMajor Component, or to implement a Standard Interface for which an\nimplementation is available to the public in source code form. A\n\"Major Component\", in this context, means a major essential component\n(kernel, window system, and so on) of the specific operating system\n(if any) on which the executable work runs, or a compiler used to\nproduce the work, or an object code interpreter used to run it.\n\n The \"Corresponding Source\" for a work in object code form means all\nthe source code needed to generate, install, and (for an executable\nwork) run the object code and to modify the work, including scripts to\ncontrol those activities. However, it does not include the work's\nSystem Libraries, or general-purpose tools or generally available free\nprograms which are used unmodified in performing those activities but\nwhich are not part of the work. For example, Corresponding Source\nincludes interface definition files associated with source files for\nthe work, and the source code for shared libraries and dynamically\nlinked subprograms that the work is specifically designed to require,\nsuch as by intimate data communication or control flow between those\nsubprograms and other parts of the work.\n\n The Corresponding Source need not include anything that users\ncan regenerate automatically from other parts of the Corresponding\nSource.\n\n The Corresponding Source for a work in source code form is that\nsame work.\n\n 2. Basic Permissions.\n\n All rights granted under this License are granted for the term of\ncopyright on the Program, and are irrevocable provided the stated\nconditions are met. This License explicitly affirms your unlimited\npermission to run the unmodified Program. The output from running a\ncovered work is covered by this License only if the output, given its\ncontent, constitutes a covered work. This License acknowledges your\nrights of fair use or other equivalent, as provided by copyright law.\n\n You may make, run and propagate covered works that you do not\nconvey, without conditions so long as your license otherwise remains\nin force. You may convey covered works to others for the sole purpose\nof having them make modifications exclusively for you, or provide you\nwith facilities for running those works, provided that you comply with\nthe terms of this License in conveying all material for which you do\nnot control copyright. Those thus making or running the covered works\nfor you must do so exclusively on your behalf, under your direction\nand control, on terms that prohibit them from making any copies of\nyour copyrighted material outside their relationship with you.\n\n Conveying under any other circumstances is permitted solely under\nthe conditions stated below. Sublicensing is not allowed; section 10\nmakes it unnecessary.\n\n 3. Protecting Users' Legal Rights From Anti-Circumvention Law.\n\n No covered work shall be deemed part of an effective technological\nmeasure under any applicable law fulfilling obligations under article\n11 of the WIPO copyright treaty adopted on 20 December 1996, or\nsimilar laws prohibiting or restricting circumvention of such\nmeasures.\n\n When you convey a covered work, you waive any legal power to forbid\ncircumvention of technological measures to the extent such circumvention\nis effected by exercising rights under this License with respect to\nthe covered work, and you disclaim any intention to limit operation or\nmodification of the work as a means of enforcing, against the work's\nusers, your or third parties' legal rights to forbid circumvention of\ntechnological measures.\n\n 4. Conveying Verbatim Copies.\n\n You may convey verbatim copies of the Program's source code as you\nreceive it, in any medium, provided that you conspicuously and\nappropriately publish on each copy an appropriate copyright notice;\nkeep intact all notices stating that this License and any\nnon-permissive terms added in accord with section 7 apply to the code;\nkeep intact all notices of the absence of any warranty; and give all\nrecipients a copy of this License along with the Program.\n\n You may charge any price or no price for each copy that you convey,\nand you may offer support or warranty protection for a fee.\n\n 5. Conveying Modified Source Versions.\n\n You may convey a work based on the Program, or the modifications to\nproduce it from the Program, in the form of source code under the\nterms of section 4, provided that you also meet all of these conditions:\n\n a) The work must carry prominent notices stating that you modified\n it, and giving a relevant date.\n\n b) The work must carry prominent notices stating that it is\n released under this License and any conditions added under section\n 7. This requirement modifies the requirement in section 4 to\n \"keep intact all notices\".\n\n c) You must license the entire work, as a whole, under this\n License to anyone who comes into possession of a copy. This\n License will therefore apply, along with any applicable section 7\n additional terms, to the whole of the work, and all its parts,\n regardless of how they are packaged. This License gives no\n permission to license the work in any other way, but it does not\n invalidate such permission if you have separately received it.\n\n d) If the work has interactive user interfaces, each must display\n Appropriate Legal Notices; however, if the Program has interactive\n interfaces that do not display Appropriate Legal Notices, your\n work need not make them do so.\n\n A compilation of a covered work with other separate and independent\nworks, which are not by their nature extensions of the covered work,\nand which are not combined with it such as to form a larger program,\nin or on a volume of a storage or distribution medium, is called an\n\"aggregate\" if the compilation and its resulting copyright are not\nused to limit the access or legal rights of the compilation's users\nbeyond what the individual works permit. Inclusion of a covered work\nin an aggregate does not cause this License to apply to the other\nparts of the aggregate.\n\n 6. Conveying Non-Source Forms.\n\n You may convey a covered work in object code form under the terms\nof sections 4 and 5, provided that you also convey the\nmachine-readable Corresponding Source under the terms of this License,\nin one of these ways:\n\n a) Convey the object code in, or embodied in, a physical product\n (including a physical distribution medium), accompanied by the\n Corresponding Source fixed on a durable physical medium\n customarily used for software interchange.\n\n b) Convey the object code in, or embodied in, a physical product\n (including a physical distribution medium), accompanied by a\n written offer, valid for at least three years and valid for as\n long as you offer spare parts or customer support for that product\n model, to give anyone who possesses the object code either (1) a\n copy of the Corresponding Source for all the software in the\n product that is covered by this License, on a durable physical\n medium customarily used for software interchange, for a price no\n more than your reasonable cost of physically performing this\n conveying of source, or (2) access to copy the\n Corresponding Source from a network server at no charge.\n\n c) Convey individual copies of the object code with a copy of the\n written offer to provide the Corresponding Source. This\n alternative is allowed only occasionally and noncommercially, and\n only if you received the object code with such an offer, in accord\n with subsection 6b.\n\n d) Convey the object code by offering access from a designated\n place (gratis or for a charge), and offer equivalent access to the\n Corresponding Source in the same way through the same place at no\n further charge. You need not require recipients to copy the\n Corresponding Source along with the object code. If the place to\n copy the object code is a network server, the Corresponding Source\n may be on a different server (operated by you or a third party)\n that supports equivalent copying facilities, provided you maintain\n clear directions next to the object code saying where to find the\n Corresponding Source. Regardless of what server hosts the\n Corresponding Source, you remain obligated to ensure that it is\n available for as long as needed to satisfy these requirements.\n\n e) Convey the object code using peer-to-peer transmission, provided\n you inform other peers where the object code and Corresponding\n Source of the work are being offered to the general public at no\n charge under subsection 6d.\n\n A separable portion of the object code, whose source code is excluded\nfrom the Corresponding Source as a System Library, need not be\nincluded in conveying the object code work.\n\n A \"User Product\" is either (1) a \"consumer product\", which means any\ntangible personal property which is normally used for personal, family,\nor household purposes, or (2) anything designed or sold for incorporation\ninto a dwelling. In determining whether a product is a consumer product,\ndoubtful cases shall be resolved in favor of coverage. For a particular\nproduct received by a particular user, \"normally used\" refers to a\ntypical or common use of that class of product, regardless of the status\nof the particular user or of the way in which the particular user\nactually uses, or expects or is expected to use, the product. A product\nis a consumer product regardless of whether the product has substantial\ncommercial, industrial or non-consumer uses, unless such uses represent\nthe only significant mode of use of the product.\n\n \"Installation Information\" for a User Product means any methods,\nprocedures, authorization keys, or other information required to install\nand execute modified versions of a covered work in that User Product from\na modified version of its Corresponding Source. The information must\nsuffice to ensure that the continued functioning of the modified object\ncode is in no case prevented or interfered with solely because\nmodification has been made.\n\n If you convey an object code work under this section in, or with, or\nspecifically for use in, a User Product, and the conveying occurs as\npart of a transaction in which the right of possession and use of the\nUser Product is transferred to the recipient in perpetuity or for a\nfixed term (regardless of how the transaction is characterized), the\nCorresponding Source conveyed under this section must be accompanied\nby the Installation Information. But this requirement does not apply\nif neither you nor any third party retains the ability to install\nmodified object code on the User Product (for example, the work has\nbeen installed in ROM).\n\n The requirement to provide Installation Information does not include a\nrequirement to continue to provide support service, warranty, or updates\nfor a work that has been modified or installed by the recipient, or for\nthe User Product in which it has been modified or installed. Access to a\nnetwork may be denied when the modification itself materially and\nadversely affects the operation of the network or violates the rules and\nprotocols for communication across the network.\n\n Corresponding Source conveyed, and Installation Information provided,\nin accord with this section must be in a format that is publicly\ndocumented (and with an implementation available to the public in\nsource code form), and must require no special password or key for\nunpacking, reading or copying.\n\n 7. Additional Terms.\n\n \"Additional permissions\" are terms that supplement the terms of this\nLicense by making exceptions from one or more of its conditions.\nAdditional permissions that are applicable to the entire Program shall\nbe treated as though they were included in this License, to the extent\nthat they are valid under applicable law. If additional permissions\napply only to part of the Program, that part may be used separately\nunder those permissions, but the entire Program remains governed by\nthis License without regard to the additional permissions.\n\n When you convey a copy of a covered work, you may at your option\nremove any additional permissions from that copy, or from any part of\nit. (Additional permissions may be written to require their own\nremoval in certain cases when you modify the work.) You may place\nadditional permissions on material, added by you to a covered work,\nfor which you have or can give appropriate copyright permission.\n\n Notwithstanding any other provision of this License, for material you\nadd to a covered work, you may (if authorized by the copyright holders of\nthat material) supplement the terms of this License with terms:\n\n a) Disclaiming warranty or limiting liability differently from the\n terms of sections 15 and 16 of this License; or\n\n b) Requiring preservation of specified reasonable legal notices or\n author attributions in that material or in the Appropriate Legal\n Notices displayed by works containing it; or\n\n c) Prohibiting misrepresentation of the origin of that material, or\n requiring that modified versions of such material be marked in\n reasonable ways as different from the original version; or\n\n d) Limiting the use for publicity purposes of names of licensors or\n authors of the material; or\n\n e) Declining to grant rights under trademark law for use of some\n trade names, trademarks, or service marks; or\n\n f) Requiring indemnification of licensors and authors of that\n material by anyone who conveys the material (or modified versions of\n it) with contractual assumptions of liability to the recipient, for\n any liability that these contractual assumptions directly impose on\n those licensors and authors.\n\n All other non-permissive additional terms are considered \"further\nrestrictions\" within the meaning of section 10. If the Program as you\nreceived it, or any part of it, contains a notice stating that it is\ngoverned by this License along with a term that is a further\nrestriction, you may remove that term. If a license document contains\na further restriction but permits relicensing or conveying under this\nLicense, you may add to a covered work material governed by the terms\nof that license document, provided that the further restriction does\nnot survive such relicensing or conveying.\n\n If you add terms to a covered work in accord with this section, you\nmust place, in the relevant source files, a statement of the\nadditional terms that apply to those files, or a notice indicating\nwhere to find the applicable terms.\n\n Additional terms, permissive or non-permissive, may be stated in the\nform of a separately written license, or stated as exceptions;\nthe above requirements apply either way.\n\n 8. Termination.\n\n You may not propagate or modify a covered work except as expressly\nprovided under this License. Any attempt otherwise to propagate or\nmodify it is void, and will automatically terminate your rights under\nthis License (including any patent licenses granted under the third\nparagraph of section 11).\n\n However, if you cease all violation of this License, then your\nlicense from a particular copyright holder is reinstated (a)\nprovisionally, unless and until the copyright holder explicitly and\nfinally terminates your license, and (b) permanently, if the copyright\nholder fails to notify you of the violation by some reasonable means\nprior to 60 days after the cessation.\n\n Moreover, your license from a particular copyright holder is\nreinstated permanently if the copyright holder notifies you of the\nviolation by some reasonable means, this is the first time you have\nreceived notice of violation of this License (for any work) from that\ncopyright holder, and you cure the violation prior to 30 days after\nyour receipt of the notice.\n\n Termination of your rights under this section does not terminate the\nlicenses of parties who have received copies or rights from you under\nthis License. If your rights have been terminated and not permanently\nreinstated, you do not qualify to receive new licenses for the same\nmaterial under section 10.\n\n 9. Acceptance Not Required for Having Copies.\n\n You are not required to accept this License in order to receive or\nrun a copy of the Program. Ancillary propagation of a covered work\noccurring solely as a consequence of using peer-to-peer transmission\nto receive a copy likewise does not require acceptance. However,\nnothing other than this License grants you permission to propagate or\nmodify any covered work. These actions infringe copyright if you do\nnot accept this License. Therefore, by modifying or propagating a\ncovered work, you indicate your acceptance of this License to do so.\n\n 10. Automatic Licensing of Downstream Recipients.\n\n Each time you convey a covered work, the recipient automatically\nreceives a license from the original licensors, to run, modify and\npropagate that work, subject to this License. You are not responsible\nfor enforcing compliance by third parties with this License.\n\n An \"entity transaction\" is a transaction transferring control of an\norganization, or substantially all assets of one, or subdividing an\norganization, or merging organizations. If propagation of a covered\nwork results from an entity transaction, each party to that\ntransaction who receives a copy of the work also receives whatever\nlicenses to the work the party's predecessor in interest had or could\ngive under the previous paragraph, plus a right to possession of the\nCorresponding Source of the work from the predecessor in interest, if\nthe predecessor has it or can get it with reasonable efforts.\n\n You may not impose any further restrictions on the exercise of the\nrights granted or affirmed under this License. For example, you may\nnot impose a license fee, royalty, or other charge for exercise of\nrights granted under this License, and you may not initiate litigation\n(including a cross-claim or counterclaim in a lawsuit) alleging that\nany patent claim is infringed by making, using, selling, offering for\nsale, or importing the Program or any portion of it.\n\n 11. Patents.\n\n A \"contributor\" is a copyright holder who authorizes use under this\nLicense of the Program or a work on which the Program is based. The\nwork thus licensed is called the contributor's \"contributor version\".\n\n A contributor's \"essential patent claims\" are all patent claims\nowned or controlled by the contributor, whether already acquired or\nhereafter acquired, that would be infringed by some manner, permitted\nby this License, of making, using, or selling its contributor version,\nbut do not include claims that would be infringed only as a\nconsequence of further modification of the contributor version. For\npurposes of this definition, \"control\" includes the right to grant\npatent sublicenses in a manner consistent with the requirements of\nthis License.\n\n Each contributor grants you a non-exclusive, worldwide, royalty-free\npatent license under the contributor's essential patent claims, to\nmake, use, sell, offer for sale, import and otherwise run, modify and\npropagate the contents of its contributor version.\n\n In the following three paragraphs, a \"patent license\" is any express\nagreement or commitment, however denominated, not to enforce a patent\n(such as an express permission to practice a patent or covenant not to\nsue for patent infringement). To \"grant\" such a patent license to a\nparty means to make such an agreement or commitment not to enforce a\npatent against the party.\n\n If you convey a covered work, knowingly relying on a patent license,\nand the Corresponding Source of the work is not available for anyone\nto copy, free of charge and under the terms of this License, through a\npublicly available network server or other readily accessible means,\nthen you must either (1) cause the Corresponding Source to be so\navailable, or (2) arrange to deprive yourself of the benefit of the\npatent license for this particular work, or (3) arrange, in a manner\nconsistent with the requirements of this License, to extend the patent\nlicense to downstream recipients. \"Knowingly relying\" means you have\nactual knowledge that, but for the patent license, your conveying the\ncovered work in a country, or your recipient's use of the covered work\nin a country, would infringe one or more identifiable patents in that\ncountry that you have reason to believe are valid.\n\n If, pursuant to or in connection with a single transaction or\narrangement, you convey, or propagate by procuring conveyance of, a\ncovered work, and grant a patent license to some of the parties\nreceiving the covered work authorizing them to use, propagate, modify\nor convey a specific copy of the covered work, then the patent license\nyou grant is automatically extended to all recipients of the covered\nwork and works based on it.\n\n A patent license is \"discriminatory\" if it does not include within\nthe scope of its coverage, prohibits the exercise of, or is\nconditioned on the non-exercise of one or more of the rights that are\nspecifically granted under this License. You may not convey a covered\nwork if you are a party to an arrangement with a third party that is\nin the business of distributing software, under which you make payment\nto the third party based on the extent of your activity of conveying\nthe work, and under which the third party grants, to any of the\nparties who would receive the covered work from you, a discriminatory\npatent license (a) in connection with copies of the covered work\nconveyed by you (or copies made from those copies), or (b) primarily\nfor and in connection with specific products or compilations that\ncontain the covered work, unless you entered into that arrangement,\nor that patent license was granted, prior to 28 March 2007.\n\n Nothing in this License shall be construed as excluding or limiting\nany implied license or other defenses to infringement that may\notherwise be available to you under applicable patent law.\n\n 12. No Surrender of Others' Freedom.\n\n If conditions are imposed on you (whether by court order, agreement or\notherwise) that contradict the conditions of this License, they do not\nexcuse you from the conditions of this License. If you cannot convey a\ncovered work so as to satisfy simultaneously your obligations under this\nLicense and any other pertinent obligations, then as a consequence you may\nnot convey it at all. For example, if you agree to terms that obligate you\nto collect a royalty for further conveying from those to whom you convey\nthe Program, the only way you could satisfy both those terms and this\nLicense would be to refrain entirely from conveying the Program.\n\n 13. Use with the GNU Affero General Public License.\n\n Notwithstanding any other provision of this License, you have\npermission to link or combine any covered work with a work licensed\nunder version 3 of the GNU Affero General Public License into a single\ncombined work, and to convey the resulting work. The terms of this\nLicense will continue to apply to the part which is the covered work,\nbut the special requirements of the GNU Affero General Public License,\nsection 13, concerning interaction through a network will apply to the\ncombination as such.\n\n 14. Revised Versions of this License.\n\n The Free Software Foundation may publish revised and/or new versions of\nthe GNU General Public License from time to time. Such new versions will\nbe similar in spirit to the present version, but may differ in detail to\naddress new problems or concerns.\n\n Each version is given a distinguishing version number. If the\nProgram specifies that a certain numbered version of the GNU General\nPublic License \"or any later version\" applies to it, you have the\noption of following the terms and conditions either of that numbered\nversion or of any later version published by the Free Software\nFoundation. If the Program does not specify a version number of the\nGNU General Public License, you may choose any version ever published\nby the Free Software Foundation.\n\n If the Program specifies that a proxy can decide which future\nversions of the GNU General Public License can be used, that proxy's\npublic statement of acceptance of a version permanently authorizes you\nto choose that version for the Program.\n\n Later license versions may give you additional or different\npermissions. However, no additional obligations are imposed on any\nauthor or copyright holder as a result of your choosing to follow a\nlater version.\n\n 15. Disclaimer of Warranty.\n\n THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY\nAPPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT\nHOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM \"AS IS\" WITHOUT WARRANTY\nOF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,\nTHE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\nPURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM\nIS WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF\nALL NECESSARY SERVICING, REPAIR OR CORRECTION.\n\n 16. Limitation of Liability.\n\n IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING\nWILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS\nTHE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY\nGENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE\nUSE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF\nDATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD\nPARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),\nEVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF\nSUCH DAMAGES.\n\n 17. Interpretation of Sections 15 and 16.\n\n If the disclaimer of warranty and limitation of liability provided\nabove cannot be given local legal effect according to their terms,\nreviewing courts shall apply local law that most closely approximates\nan absolute waiver of all civil liability in connection with the\nProgram, unless a warranty or assumption of liability accompanies a\ncopy of the Program in return for a fee.\n\n END OF TERMS AND CONDITIONS\n\n How to Apply These Terms to Your New Programs\n\n If you develop a new program, and you want it to be of the greatest\npossible use to the public, the best way to achieve this is to make it\nfree software which everyone can redistribute and change under these terms.\n\n To do so, attach the following notices to the program. It is safest\nto attach them to the start of each source file to most effectively\nstate the exclusion of warranty; and each file should have at least\nthe \"copyright\" line and a pointer to where the full notice is found.\n\n \n Copyright (C) \n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU General Public License as published by\n the Free Software Foundation, either version 3 of the License, or\n (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n GNU General Public License for more details.\n\n You should have received a copy of the GNU General Public License\n along with this program. If not, see .\n\nAlso add information on how to contact you by electronic and paper mail.\n\n If the program does terminal interaction, make it output a short\nnotice like this when it starts in an interactive mode:\n\n Copyright (C) \n This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.\n This is free software, and you are welcome to redistribute it\n under certain conditions; type `show c' for details.\n\nThe hypothetical commands `show w' and `show c' should show the appropriate\nparts of the General Public License. Of course, your program's commands\nmight be different; for a GUI interface, you would use an \"about box\".\n\n You should also get your employer (if you work as a programmer) or school,\nif any, to sign a \"copyright disclaimer\" for the program, if necessary.\nFor more information on this, and how to apply and follow the GNU GPL, see\n .\n\n The GNU General Public License does not permit incorporating your program\ninto proprietary programs. If your program is a subroutine library, you\nmay consider it more useful to permit linking proprietary applications with\nthe library. If this is what you want to do, use the GNU Lesser General\nPublic License instead of this License. But first, please read\n .",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "GPL-3.0",
        "url": "https://www.gnu.org/licenses/gpl-3.0.txt"
      },
      "is_distractor": false,
      "semantic_tags": [
        "governing_law",
        "gpl-3.0",
        "indemnification",
        "legal",
        "liability",
        "license",
        "termination",
        "warranty"
      ],
      "content_hash": "8c59d4ff7ac18759",
      "size_bytes": 34339,
      "created_at": "2026-01-02T20:42:23.532352"
    },
    {
      "doc_id": "legal_license_bsd_3_clause",
      "source": "online",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "https://opensource.org/license/bsd-3-clause/",
      "content": "‚Ä¢ \n\n The 3-Clause BSD License &#8211; Open Source Initiative \n \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n \n \n \n \n \n \n \n \n \n\n‚Ä¢ \n\n \n \n \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n \n \n \n\n \n \n \n\n \n\n \n \n \n \n \n \n\n \n \n \n \n\n Note: This license has also been called the &#8220;New BSD License&#8221; or &#8220;Modified BSD License&#8221;. See also the 2-clause BSD License . \n\n Copyright <YEAR> <COPYRIGHT HOLDER> \n\n Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met: \n\n 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer. \n\n 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution. \n\n 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission. \n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &#8220;AS IS&#8221; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. \n \n \n \n \n \n \n \n \n \n \n\n \n \n \n\n \n \n\n \n\n \n\n \n \n \n \n \n \n \n \n \n Manage Cookie Consent \n \n \n \n \n\n \n \n To provide the best experiences, we use technologies like cookies to store and/or access device information. Consenting to these technologies will allow us to process data such as browsing behavior or unique IDs on this site. Not consenting or withdrawing consent, may adversely affect certain features and functions. \n \n \n \n \n \n Functional \n \n \n \n Functional \n \n Always active \n \n \n \n \n \n \n The technical storage or access is strictly necessary for the legitimate purpose of enabling the use of a specific service explicitly requested by the subscriber or user, or for the sole purpose of carrying out the transmission of a communication over an electronic communications network. \n \n \n\n \n \n \n Preferences \n \n \n Preferences \n \n \n \n \n \n \n \n The technical storage or access is necessary for the legitimate purpose of storing preferences that are not requested by the subscriber or user. \n \n \n\n \n \n \n Statistics \n \n \n Statistics \n \n \n \n \n \n \n \n The technical storage or access that is used exclusively for statistical purposes. \n The technical storage or access that is used exclusively for anonymous statistical purposes. Without a subpoena, voluntary compliance on the part of your Internet Service Provider, or additional records from a third party, information stored or retrieved for this purpose alone cannot usually be used to identify you. \n \n \n \n \n \n Marketing \n \n \n Marketing \n \n \n \n \n \n \n \n The technical storage or access is required to create user profiles to send advertising, or to track the user on a website or across several websites for similar marketing purposes. \n \n \n \n \n\n \n \n \n‚Ä¢ Manage options \n \n‚Ä¢ Manage services \n \n‚Ä¢ Manage {vendor_count} vendors \n \n‚Ä¢ Read more about these purposes \n \n \n\n \n\n \n Accept \n Deny \n View preferences \n Save preferences \n View preferences \n \n\n \n \n \n \n‚Ä¢ {title} \n \n‚Ä¢ {title} \n \n‚Ä¢ {title} \n \n \n \n \n Manage consent",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "BSD-3-Clause",
        "url": "https://opensource.org/license/bsd-3-clause/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "bsd-3-clause",
        "legal",
        "liability",
        "license",
        "warranty"
      ],
      "content_hash": "2beef1336acef4c1",
      "size_bytes": 3993,
      "created_at": "2026-01-02T20:42:23.532438"
    },
    {
      "doc_id": "legal_license_mpl_2.0",
      "source": "online",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "https://www.mozilla.org/en-US/MPL/2.0/",
      "content": "Mozilla Public License, version 2.0 \n \n \n \n\n \n \n‚Ä¢ \n \n \n \n\n## Mozilla Public License Version 2.0\n\n## 1. Definitions\n\n \n 1.1. ‚ÄúContributor‚Äù \n means each individual or legal entity that creates, contributes to the creation of, or owns Covered Software. \n \n 1.2. ‚ÄúContributor Version‚Äù \n means the combination of the Contributions of others (if any) used by a Contributor and that particular Contributor‚Äôs Contribution. \n \n 1.3. ‚ÄúContribution‚Äù \n means Covered Software of a particular Contributor. \n \n 1.4. ‚ÄúCovered Software‚Äù \n means Source Code Form to which the initial Contributor has attached the notice in Exhibit A, the Executable Form of such Source Code Form, and Modifications of such Source Code Form, in each case including portions thereof. \n \n 1.5. ‚ÄúIncompatible With Secondary Licenses‚Äù \n means \n \n\n‚Ä¢ that the initial Contributor has attached the notice described in Exhibit B to the Covered Software; or \n\n‚Ä¢ that the Covered Software was made available under the terms of version 1.1 or earlier of the License, but not also under the terms of a Secondary License. \n \n \n 1.6. ‚ÄúExecutable Form‚Äù \n means any form of the work other than Source Code Form. \n \n 1.7. ‚ÄúLarger Work‚Äù \n means a work that combines Covered Software with other material, in a separate file or files, that is not Covered Software. \n \n 1.8. ‚ÄúLicense‚Äù \n means this document. \n \n 1.9. ‚ÄúLicensable‚Äù \n means having the right to grant, to the maximum extent possible, whether at the time of the initial grant or subsequently, any and all of the rights conveyed by this License. \n \n 1.10. ‚ÄúModifications‚Äù \n means any of the following: \n \n\n‚Ä¢ any file in Source Code Form that results from an addition to, deletion from, or modification of the contents of Covered Software; or \n\n‚Ä¢ any new file in Source Code Form that contains any Covered Software. \n \n \n 1.11. ‚ÄúPatent Claims‚Äù of a Contributor \n means any patent claim(s), including without limitation, method, process, and apparatus claims, in any patent Licensable by such Contributor that would be infringed, but for the grant of the License, by the making, using, selling, offering for sale, having made, import, or transfer of either its Contributions or its Contributor Version. \n \n 1.12. ‚ÄúSecondary License‚Äù \n means either the GNU General Public License, Version 2.0, the GNU Lesser General Public License, Version 2.1, the GNU Affero General Public License, Version 3.0, or any later versions of those licenses. \n \n 1.13. ‚ÄúSource Code Form‚Äù \n means the form of the work preferred for making modifications. \n \n 1.14. ‚ÄúYou‚Äù (or ‚ÄúYour‚Äù) \n means an individual or a legal entity exercising rights under this License. For legal entities, ‚ÄúYou‚Äù includes any entity that controls, is controlled by, or is under common control with You. For purposes of this definition, ‚Äúcontrol‚Äù means (a) the power, direct or indirect, to cause the direction or management of such entity, whether by contract or otherwise, or (b) ownership of more than fifty percent (50%) of the outstanding shares or beneficial ownership of such entity. \n \n \n\n## 2. License Grants and Conditions\n\n## 2.1. Grants\n\n Each Contributor hereby grants You a world-wide, royalty-free, non-exclusive license: \n \n\n‚Ä¢ under intellectual property rights (other than patent or trademark) Licensable by such Contributor to use, reproduce, make available, modify, display, perform, distribute, and otherwise exploit its Contributions, either on an unmodified basis, with Modifications, or as part of a Larger Work; and \n\n‚Ä¢ under Patent Claims of such Contributor to make, use, sell, offer for sale, have made, import, and otherwise transfer either its Contributions or its Contributor Version. \n \n\n## 2.2. Effective Date\n\n The licenses granted in Section 2.1 with respect to any Contribution become effective for each Contribution on the date the Contributor first distributes such Contribution. \n\n## 2.3. Limitations on Grant Scope\n\n The licenses granted in this Section 2 are the only rights granted under this License. No additional rights or licenses will be implied from the distribution or licensing of Covered Software under this License. Notwithstanding Section 2.1(b) above, no patent license is granted by a Contributor: \n \n\n‚Ä¢ for any code that a Contributor has removed from Covered Software; or \n\n‚Ä¢ for infringements caused by: (i) Your and any other third party‚Äôs modifications of Covered Software, or (ii) the combination of its Contributions with other software (except as part of its Contributor Version); or \n\n‚Ä¢ under Patent Claims infringed by Covered Software in the absence of its Contributions. \n \n This License does not grant any rights in the trademarks, service marks, or logos of any Contributor (except as may be necessary to comply with the notice requirements in Section 3.4). \n\n## 2.4. Subsequent Licenses\n\n No Contributor makes additional grants as a result of Your choice to distribute the Covered Software under a subsequent version of this License (see Section 10.2) or under the terms of a Secondary License (if permitted under the terms of Section 3.3). \n\n## 2.5. Representation\n\n Each Contributor represents that the Contributor believes its Contributions are its original creation(s) or it has sufficient rights to grant the rights to its Contributions conveyed by this License. \n\n## 2.6. Fair Use\n\n This License is not intended to limit any rights You have under applicable copyright doctrines of fair use, fair dealing, or other equivalents. \n\n## 2.7. Conditions\n\n Sections 3.1, 3.2, 3.3, and 3.4 are conditions of the licenses granted in Section 2.1. \n\n## 3. Responsibilities\n\n## 3.1. Distribution of Source Form\n\n All distribution of Covered Software in Source Code Form, including any Modifications that You create or to which You contribute, must be under the terms of this License. You must inform recipients that the Source Code Form of the Covered Software is governed by the terms of this License, and how they can obtain a copy of this License. You may not attempt to alter or restrict the recipients‚Äô rights in the Source Code Form. \n\n## 3.2. Distribution of Executable Form\n\n If You distribute Covered Software in Executable Form then: \n \n\n‚Ä¢ such Covered Software must also be made available in Source Code Form, as described in Section 3.1, and You must inform recipients of the Executable Form how they can obtain a copy of such Source Code Form by reasonable means in a timely manner, at a charge no more than the cost of distribution to the recipient; and \n\n‚Ä¢ You may distribute such Executable Form under the terms of this License, or sublicense it under different terms, provided that the license for the Executable Form does not attempt to limit or alter the recipients‚Äô rights in the Source Code Form under this License. \n \n\n## 3.3. Distribution of a Larger Work\n\n You may create and distribute a Larger Work under terms of Your choice, provided that You also comply with the requirements of this License for the Covered Software. If the Larger Work is a combination of Covered Software with a work governed by one or more Secondary Licenses, and the Covered Software is not Incompatible With Secondary Licenses, this License permits You to additionally distribute such Covered Software under the terms of such Secondary License(s), so that the recipient of the Larger Work may, at their option, further distribute the Covered Software under the terms of either this License or such Secondary License(s). \n\n## 3.4. Notices\n\n You may not remove or alter the substance of any license notices (including copyright notices, patent notices, disclaimers of warranty, or limitations of liability) contained within the Source Code Form of the Covered Software, except that You may alter any license notices to the extent required to remedy known factual inaccuracies. \n\n## 3.5. Application of Additional Terms\n\n You may choose to offer, and to charge a fee for, warranty, support, indemnity or liability obligations to one or more recipients of Covered Software. However, You may do so only on Your own behalf, and not on behalf of any Contributor. You must make it absolutely clear that any such warranty, support, indemnity, or liability obligation is offered by You alone, and You hereby agree to indemnify every Contributor for any liability incurred by such Contributor as a result of warranty, support, indemnity or liability terms You offer. You may include additional disclaimers of warranty and limitations of liability specific to any jurisdiction. \n\n## 4. Inability to Comply Due to Statute or Regulation\n\n If it is impossible for You to comply with any of the terms of this License with respect to some or all of the Covered Software due to statute, judicial order, or regulation then You must: (a) comply with the terms of this License to the maximum extent possible; and (b) describe the limitations and the code they affect. Such description must be placed in a text file included with all distributions of the Covered Software under this License. Except to the extent prohibited by statute or regulation, such description must be sufficiently detailed for a recipient of ordinary skill to be able to understand it. \n\n## 5. Termination\n\n 5.1. The rights granted under this License will terminate automatically if You fail to comply with any of its terms. However, if You become compliant, then the rights granted under this License from a particular Contributor are reinstated (a) provisionally, unless and until such Contributor explicitly and finally terminates Your grants, and (b) on an ongoing basis, if such Contributor fails to notify You of the non-compliance by some reasonable means prior to 60 days after You have come back into compliance. Moreover, Your grants from a particular Contributor are reinstated on an ongoing basis if such Contributor notifies You of the non-compliance by some reasonable means, this is the first time You have received notice of non-compliance with this License from such Contributor, and You become compliant prior to 30 days after Your receipt of the notice. \n 5.2. If You initiate litigation against any entity by asserting a patent infringement claim (excluding declaratory judgment actions, counter-claims, and cross-claims) alleging that a Contributor Version directly or indirectly infringes any patent, then the rights granted to You by any and all Contributors for the Covered Software under Section 2.1 of this License shall terminate. \n 5.3. In the event of termination under Sections 5.1 or 5.2 above, all end user license agreements (excluding distributors and resellers) which have been validly granted by You or Your distributors under this License prior to termination shall survive termination. \n\n## 6. Disclaimer of Warranty\n\n Covered Software is provided under this License on an ‚Äúas is‚Äù basis, without warranty of any kind, either expressed, implied, or statutory, including, without limitation, warranties that the Covered Software is free of defects, merchantable, fit for a particular purpose or non-infringing. The entire risk as to the quality and performance of the Covered Software is with You. Should any Covered Software prove defective in any respect, You (not any Contributor) assume the cost of any necessary servicing, repair, or correction. This disclaimer of warranty constitutes an essential part of this License. No use of any Covered Software is authorized under this License except under this disclaimer. \n\n## 7. Limitation of Liability\n\n Under no circumstances and under no legal theory, whether tort (including negligence), contract, or otherwise, shall any Contributor, or anyone who distributes Covered Software as permitted above, be liable to You for any direct, indirect, special, incidental, or consequential damages of any character including, without limitation, damages for lost profits, loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses, even if such party shall have been informed of the possibility of such damages. This limitation of liability shall not apply to liability for death or personal injury resulting from such party‚Äôs negligence to the extent applicable law prohibits such limitation. Some jurisdictions do not allow the exclusion or limitation of incidental or consequential damages, so this exclusion and limitation may not apply to You. \n\n## 8. Litigation\n\n Any litigation relating to this License may be brought only in the courts of a jurisdiction where the defendant maintains its principal place of business and such litigation shall be governed by laws of that jurisdiction, without reference to its conflict-of-law provisions. Nothing in this Section shall prevent a party‚Äôs ability to bring cross-claims or counter-claims. \n\n## 9. Miscellaneous\n\n This License represents the complete agreement concerning the subject matter hereof. If any provision of this License is held to be unenforceable, such provision shall be reformed only to the extent necessary to make it enforceable. Any law or regulation which provides that the language of a contract shall be construed against the drafter shall not be used to construe this License against a Contributor. \n\n## 10. Versions of the License\n\n## 10.1. New Versions\n\n Mozilla Foundation is the license steward. Except as provided in Section 10.3, no one other than the license steward has the right to modify or publish new versions of this License. Each version will be given a distinguishing version number. \n\n## 10.2. Effect of New Versions\n\n You may distribute the Covered Software under the terms of the version of the License under which You originally received the Covered Software, or under the terms of any subsequent version published by the license steward. \n\n## 10.3. Modified Versions\n\n If you create software not governed by this License, and you want to create a new license for such software, you may create and use a modified version of this License if you rename the license and remove any references to the name of the license steward (except to note that such modified license differs from this License). \n\n## 10.4. Distributing Source Code Form that is Incompatible With Secondary Licenses\n\n If You choose to distribute Source Code Form that is Incompatible With Secondary Licenses under the terms of this version of the License, the notice described in Exhibit B of this License must be attached. \n\n## Exhibit A - Source Code Form License Notice\n\n \n This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/. \n \n If it is not possible or desirable to put the notice in a particular file, then You may include the notice in a location (such as a LICENSE file in a relevant directory) where a recipient would be likely to look for such a notice. \n You may add additional accurate notices of copyright ownership. \n\n## Exhibit B - ‚ÄúIncompatible With Secondary Licenses‚Äù Notice\n\n \n This Source Code Form is ‚ÄúIncompatible With Secondary Licenses‚Äù, as defined by the Mozilla Public License, v. 2.0.",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "MPL-2.0",
        "url": "https://www.mozilla.org/en-US/MPL/2.0/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "license",
        "mpl-2.0",
        "termination",
        "warranty"
      ],
      "content_hash": "55f38365811ac6cd",
      "size_bytes": 15231,
      "created_at": "2026-01-02T20:42:23.532564"
    },
    {
      "doc_id": "legal_license_lgpl_3.0",
      "source": "online",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "https://www.gnu.org/licenses/lgpl-3.0.txt",
      "content": "GNU LESSER GENERAL PUBLIC LICENSE\n Version 3, 29 June 2007\n\n Copyright (C) 2007 Free Software Foundation, Inc. \n Everyone is permitted to copy and distribute verbatim copies\n of this license document, but changing it is not allowed.\n\n This version of the GNU Lesser General Public License incorporates\nthe terms and conditions of version 3 of the GNU General Public\nLicense, supplemented by the additional permissions listed below.\n\n 0. Additional Definitions.\n\n As used herein, \"this License\" refers to version 3 of the GNU Lesser\nGeneral Public License, and the \"GNU GPL\" refers to version 3 of the GNU\nGeneral Public License.\n\n \"The Library\" refers to a covered work governed by this License,\nother than an Application or a Combined Work as defined below.\n\n An \"Application\" is any work that makes use of an interface provided\nby the Library, but which is not otherwise based on the Library.\nDefining a subclass of a class defined by the Library is deemed a mode\nof using an interface provided by the Library.\n\n A \"Combined Work\" is a work produced by combining or linking an\nApplication with the Library. The particular version of the Library\nwith which the Combined Work was made is also called the \"Linked\nVersion\".\n\n The \"Minimal Corresponding Source\" for a Combined Work means the\nCorresponding Source for the Combined Work, excluding any source code\nfor portions of the Combined Work that, considered in isolation, are\nbased on the Application, and not on the Linked Version.\n\n The \"Corresponding Application Code\" for a Combined Work means the\nobject code and/or source code for the Application, including any data\nand utility programs needed for reproducing the Combined Work from the\nApplication, but excluding the System Libraries of the Combined Work.\n\n 1. Exception to Section 3 of the GNU GPL.\n\n You may convey a covered work under sections 3 and 4 of this License\nwithout being bound by section 3 of the GNU GPL.\n\n 2. Conveying Modified Versions.\n\n If you modify a copy of the Library, and, in your modifications, a\nfacility refers to a function or data to be supplied by an Application\nthat uses the facility (other than as an argument passed when the\nfacility is invoked), then you may convey a copy of the modified\nversion:\n\n a) under this License, provided that you make a good faith effort to\n ensure that, in the event an Application does not supply the\n function or data, the facility still operates, and performs\n whatever part of its purpose remains meaningful, or\n\n b) under the GNU GPL, with none of the additional permissions of\n this License applicable to that copy.\n\n 3. Object Code Incorporating Material from Library Header Files.\n\n The object code form of an Application may incorporate material from\na header file that is part of the Library. You may convey such object\ncode under terms of your choice, provided that, if the incorporated\nmaterial is not limited to numerical parameters, data structure\nlayouts and accessors, or small macros, inline functions and templates\n(ten or fewer lines in length), you do both of the following:\n\n a) Give prominent notice with each copy of the object code that the\n Library is used in it and that the Library and its use are\n covered by this License.\n\n b) Accompany the object code with a copy of the GNU GPL and this license\n document.\n\n 4. Combined Works.\n\n You may convey a Combined Work under terms of your choice that,\ntaken together, effectively do not restrict modification of the\nportions of the Library contained in the Combined Work and reverse\nengineering for debugging such modifications, if you also do each of\nthe following:\n\n a) Give prominent notice with each copy of the Combined Work that\n the Library is used in it and that the Library and its use are\n covered by this License.\n\n b) Accompany the Combined Work with a copy of the GNU GPL and this license\n document.\n\n c) For a Combined Work that displays copyright notices during\n execution, include the copyright notice for the Library among\n these notices, as well as a reference directing the user to the\n copies of the GNU GPL and this license document.\n\n d) Do one of the following:\n\n 0) Convey the Minimal Corresponding Source under the terms of this\n License, and the Corresponding Application Code in a form\n suitable for, and under terms that permit, the user to\n recombine or relink the Application with a modified version of\n the Linked Version to produce a modified Combined Work, in the\n manner specified by section 6 of the GNU GPL for conveying\n Corresponding Source.\n\n 1) Use a suitable shared library mechanism for linking with the\n Library. A suitable mechanism is one that (a) uses at run time\n a copy of the Library already present on the user's computer\n system, and (b) will operate properly with a modified version\n of the Library that is interface-compatible with the Linked\n Version.\n\n e) Provide Installation Information, but only if you would otherwise\n be required to provide such information under section 6 of the\n GNU GPL, and only to the extent that such information is\n necessary to install and execute a modified version of the\n Combined Work produced by recombining or relinking the\n Application with a modified version of the Linked Version. (If\n you use option 4d0, the Installation Information must accompany\n the Minimal Corresponding Source and Corresponding Application\n Code. If you use option 4d1, you must provide the Installation\n Information in the manner specified by section 6 of the GNU GPL\n for conveying Corresponding Source.)\n\n 5. Combined Libraries.\n\n You may place library facilities that are a work based on the\nLibrary side by side in a single library together with other library\nfacilities that are not Applications and are not covered by this\nLicense, and convey such a combined library under terms of your\nchoice, if you do both of the following:\n\n a) Accompany the combined library with a copy of the same work based\n on the Library, uncombined with any other library facilities,\n conveyed under the terms of this License.\n\n b) Give prominent notice with the combined library that part of it\n is a work based on the Library, and explaining where to find the\n accompanying uncombined form of the same work.\n\n 6. Revised Versions of the GNU Lesser General Public License.\n\n The Free Software Foundation may publish revised and/or new versions\nof the GNU Lesser General Public License from time to time. Such new\nversions will be similar in spirit to the present version, but may\ndiffer in detail to address new problems or concerns.\n\n Each version is given a distinguishing version number. If the\nLibrary as you received it specifies that a certain numbered version\nof the GNU Lesser General Public License \"or any later version\"\napplies to it, you have the option of following the terms and\nconditions either of that published version or of any later version\npublished by the Free Software Foundation. If the Library as you\nreceived it does not specify a version number of the GNU Lesser\nGeneral Public License, you may choose any version of the GNU Lesser\nGeneral Public License ever published by the Free Software Foundation.\n\n If the Library as you received it specifies that a proxy can decide\nwhether future versions of the GNU Lesser General Public License shall\napply, that proxy's public statement of acceptance of any version is\npermanent authorization for you to choose that version for the\nLibrary.",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "LGPL-3.0",
        "url": "https://www.gnu.org/licenses/lgpl-3.0.txt"
      },
      "is_distractor": false,
      "semantic_tags": [
        "legal",
        "lgpl-3.0",
        "license"
      ],
      "content_hash": "099d0999b2ce055c",
      "size_bytes": 7412,
      "created_at": "2026-01-02T20:42:23.532638"
    },
    {
      "doc_id": "legal_license_agpl_3.0",
      "source": "online",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "https://www.gnu.org/licenses/agpl-3.0.txt",
      "content": "GNU AFFERO GENERAL PUBLIC LICENSE\n Version 3, 19 November 2007\n\n Copyright (C) 2007 Free Software Foundation, Inc. \n Everyone is permitted to copy and distribute verbatim copies\n of this license document, but changing it is not allowed.\n\n Preamble\n\n The GNU Affero General Public License is a free, copyleft license for\nsoftware and other kinds of works, specifically designed to ensure\ncooperation with the community in the case of network server software.\n\n The licenses for most software and other practical works are designed\nto take away your freedom to share and change the works. By contrast,\nour General Public Licenses are intended to guarantee your freedom to\nshare and change all versions of a program--to make sure it remains free\nsoftware for all its users.\n\n When we speak of free software, we are referring to freedom, not\nprice. Our General Public Licenses are designed to make sure that you\nhave the freedom to distribute copies of free software (and charge for\nthem if you wish), that you receive source code or can get it if you\nwant it, that you can change the software or use pieces of it in new\nfree programs, and that you know you can do these things.\n\n Developers that use our General Public Licenses protect your rights\nwith two steps: (1) assert copyright on the software, and (2) offer\nyou this License which gives you legal permission to copy, distribute\nand/or modify the software.\n\n A secondary benefit of defending all users' freedom is that\nimprovements made in alternate versions of the program, if they\nreceive widespread use, become available for other developers to\nincorporate. Many developers of free software are heartened and\nencouraged by the resulting cooperation. However, in the case of\nsoftware used on network servers, this result may fail to come about.\nThe GNU General Public License permits making a modified version and\nletting the public access it on a server without ever releasing its\nsource code to the public.\n\n The GNU Affero General Public License is designed specifically to\nensure that, in such cases, the modified source code becomes available\nto the community. It requires the operator of a network server to\nprovide the source code of the modified version running there to the\nusers of that server. Therefore, public use of a modified version, on\na publicly accessible server, gives the public access to the source\ncode of the modified version.\n\n An older license, called the Affero General Public License and\npublished by Affero, was designed to accomplish similar goals. This is\na different license, not a version of the Affero GPL, but Affero has\nreleased a new version of the Affero GPL which permits relicensing under\nthis license.\n\n The precise terms and conditions for copying, distribution and\nmodification follow.\n\n TERMS AND CONDITIONS\n\n 0. Definitions.\n\n \"This License\" refers to version 3 of the GNU Affero General Public License.\n\n \"Copyright\" also means copyright-like laws that apply to other kinds of\nworks, such as semiconductor masks.\n\n \"The Program\" refers to any copyrightable work licensed under this\nLicense. Each licensee is addressed as \"you\". \"Licensees\" and\n\"recipients\" may be individuals or organizations.\n\n To \"modify\" a work means to copy from or adapt all or part of the work\nin a fashion requiring copyright permission, other than the making of an\nexact copy. The resulting work is called a \"modified version\" of the\nearlier work or a work \"based on\" the earlier work.\n\n A \"covered work\" means either the unmodified Program or a work based\non the Program.\n\n To \"propagate\" a work means to do anything with it that, without\npermission, would make you directly or secondarily liable for\ninfringement under applicable copyright law, except executing it on a\ncomputer or modifying a private copy. Propagation includes copying,\ndistribution (with or without modification), making available to the\npublic, and in some countries other activities as well.\n\n To \"convey\" a work means any kind of propagation that enables other\nparties to make or receive copies. Mere interaction with a user through\na computer network, with no transfer of a copy, is not conveying.\n\n An interactive user interface displays \"Appropriate Legal Notices\"\nto the extent that it includes a convenient and prominently visible\nfeature that (1) displays an appropriate copyright notice, and (2)\ntells the user that there is no warranty for the work (except to the\nextent that warranties are provided), that licensees may convey the\nwork under this License, and how to view a copy of this License. If\nthe interface presents a list of user commands or options, such as a\nmenu, a prominent item in the list meets this criterion.\n\n 1. Source Code.\n\n The \"source code\" for a work means the preferred form of the work\nfor making modifications to it. \"Object code\" means any non-source\nform of a work.\n\n A \"Standard Interface\" means an interface that either is an official\nstandard defined by a recognized standards body, or, in the case of\ninterfaces specified for a particular programming language, one that\nis widely used among developers working in that language.\n\n The \"System Libraries\" of an executable work include anything, other\nthan the work as a whole, that (a) is included in the normal form of\npackaging a Major Component, but which is not part of that Major\nComponent, and (b) serves only to enable use of the work with that\nMajor Component, or to implement a Standard Interface for which an\nimplementation is available to the public in source code form. A\n\"Major Component\", in this context, means a major essential component\n(kernel, window system, and so on) of the specific operating system\n(if any) on which the executable work runs, or a compiler used to\nproduce the work, or an object code interpreter used to run it.\n\n The \"Corresponding Source\" for a work in object code form means all\nthe source code needed to generate, install, and (for an executable\nwork) run the object code and to modify the work, including scripts to\ncontrol those activities. However, it does not include the work's\nSystem Libraries, or general-purpose tools or generally available free\nprograms which are used unmodified in performing those activities but\nwhich are not part of the work. For example, Corresponding Source\nincludes interface definition files associated with source files for\nthe work, and the source code for shared libraries and dynamically\nlinked subprograms that the work is specifically designed to require,\nsuch as by intimate data communication or control flow between those\nsubprograms and other parts of the work.\n\n The Corresponding Source need not include anything that users\ncan regenerate automatically from other parts of the Corresponding\nSource.\n\n The Corresponding Source for a work in source code form is that\nsame work.\n\n 2. Basic Permissions.\n\n All rights granted under this License are granted for the term of\ncopyright on the Program, and are irrevocable provided the stated\nconditions are met. This License explicitly affirms your unlimited\npermission to run the unmodified Program. The output from running a\ncovered work is covered by this License only if the output, given its\ncontent, constitutes a covered work. This License acknowledges your\nrights of fair use or other equivalent, as provided by copyright law.\n\n You may make, run and propagate covered works that you do not\nconvey, without conditions so long as your license otherwise remains\nin force. You may convey covered works to others for the sole purpose\nof having them make modifications exclusively for you, or provide you\nwith facilities for running those works, provided that you comply with\nthe terms of this License in conveying all material for which you do\nnot control copyright. Those thus making or running the covered works\nfor you must do so exclusively on your behalf, under your direction\nand control, on terms that prohibit them from making any copies of\nyour copyrighted material outside their relationship with you.\n\n Conveying under any other circumstances is permitted solely under\nthe conditions stated below. Sublicensing is not allowed; section 10\nmakes it unnecessary.\n\n 3. Protecting Users' Legal Rights From Anti-Circumvention Law.\n\n No covered work shall be deemed part of an effective technological\nmeasure under any applicable law fulfilling obligations under article\n11 of the WIPO copyright treaty adopted on 20 December 1996, or\nsimilar laws prohibiting or restricting circumvention of such\nmeasures.\n\n When you convey a covered work, you waive any legal power to forbid\ncircumvention of technological measures to the extent such circumvention\nis effected by exercising rights under this License with respect to\nthe covered work, and you disclaim any intention to limit operation or\nmodification of the work as a means of enforcing, against the work's\nusers, your or third parties' legal rights to forbid circumvention of\ntechnological measures.\n\n 4. Conveying Verbatim Copies.\n\n You may convey verbatim copies of the Program's source code as you\nreceive it, in any medium, provided that you conspicuously and\nappropriately publish on each copy an appropriate copyright notice;\nkeep intact all notices stating that this License and any\nnon-permissive terms added in accord with section 7 apply to the code;\nkeep intact all notices of the absence of any warranty; and give all\nrecipients a copy of this License along with the Program.\n\n You may charge any price or no price for each copy that you convey,\nand you may offer support or warranty protection for a fee.\n\n 5. Conveying Modified Source Versions.\n\n You may convey a work based on the Program, or the modifications to\nproduce it from the Program, in the form of source code under the\nterms of section 4, provided that you also meet all of these conditions:\n\n a) The work must carry prominent notices stating that you modified\n it, and giving a relevant date.\n\n b) The work must carry prominent notices stating that it is\n released under this License and any conditions added under section\n 7. This requirement modifies the requirement in section 4 to\n \"keep intact all notices\".\n\n c) You must license the entire work, as a whole, under this\n License to anyone who comes into possession of a copy. This\n License will therefore apply, along with any applicable section 7\n additional terms, to the whole of the work, and all its parts,\n regardless of how they are packaged. This License gives no\n permission to license the work in any other way, but it does not\n invalidate such permission if you have separately received it.\n\n d) If the work has interactive user interfaces, each must display\n Appropriate Legal Notices; however, if the Program has interactive\n interfaces that do not display Appropriate Legal Notices, your\n work need not make them do so.\n\n A compilation of a covered work with other separate and independent\nworks, which are not by their nature extensions of the covered work,\nand which are not combined with it such as to form a larger program,\nin or on a volume of a storage or distribution medium, is called an\n\"aggregate\" if the compilation and its resulting copyright are not\nused to limit the access or legal rights of the compilation's users\nbeyond what the individual works permit. Inclusion of a covered work\nin an aggregate does not cause this License to apply to the other\nparts of the aggregate.\n\n 6. Conveying Non-Source Forms.\n\n You may convey a covered work in object code form under the terms\nof sections 4 and 5, provided that you also convey the\nmachine-readable Corresponding Source under the terms of this License,\nin one of these ways:\n\n a) Convey the object code in, or embodied in, a physical product\n (including a physical distribution medium), accompanied by the\n Corresponding Source fixed on a durable physical medium\n customarily used for software interchange.\n\n b) Convey the object code in, or embodied in, a physical product\n (including a physical distribution medium), accompanied by a\n written offer, valid for at least three years and valid for as\n long as you offer spare parts or customer support for that product\n model, to give anyone who possesses the object code either (1) a\n copy of the Corresponding Source for all the software in the\n product that is covered by this License, on a durable physical\n medium customarily used for software interchange, for a price no\n more than your reasonable cost of physically performing this\n conveying of source, or (2) access to copy the\n Corresponding Source from a network server at no charge.\n\n c) Convey individual copies of the object code with a copy of the\n written offer to provide the Corresponding Source. This\n alternative is allowed only occasionally and noncommercially, and\n only if you received the object code with such an offer, in accord\n with subsection 6b.\n\n d) Convey the object code by offering access from a designated\n place (gratis or for a charge), and offer equivalent access to the\n Corresponding Source in the same way through the same place at no\n further charge. You need not require recipients to copy the\n Corresponding Source along with the object code. If the place to\n copy the object code is a network server, the Corresponding Source\n may be on a different server (operated by you or a third party)\n that supports equivalent copying facilities, provided you maintain\n clear directions next to the object code saying where to find the\n Corresponding Source. Regardless of what server hosts the\n Corresponding Source, you remain obligated to ensure that it is\n available for as long as needed to satisfy these requirements.\n\n e) Convey the object code using peer-to-peer transmission, provided\n you inform other peers where the object code and Corresponding\n Source of the work are being offered to the general public at no\n charge under subsection 6d.\n\n A separable portion of the object code, whose source code is excluded\nfrom the Corresponding Source as a System Library, need not be\nincluded in conveying the object code work.\n\n A \"User Product\" is either (1) a \"consumer product\", which means any\ntangible personal property which is normally used for personal, family,\nor household purposes, or (2) anything designed or sold for incorporation\ninto a dwelling. In determining whether a product is a consumer product,\ndoubtful cases shall be resolved in favor of coverage. For a particular\nproduct received by a particular user, \"normally used\" refers to a\ntypical or common use of that class of product, regardless of the status\nof the particular user or of the way in which the particular user\nactually uses, or expects or is expected to use, the product. A product\nis a consumer product regardless of whether the product has substantial\ncommercial, industrial or non-consumer uses, unless such uses represent\nthe only significant mode of use of the product.\n\n \"Installation Information\" for a User Product means any methods,\nprocedures, authorization keys, or other information required to install\nand execute modified versions of a covered work in that User Product from\na modified version of its Corresponding Source. The information must\nsuffice to ensure that the continued functioning of the modified object\ncode is in no case prevented or interfered with solely because\nmodification has been made.\n\n If you convey an object code work under this section in, or with, or\nspecifically for use in, a User Product, and the conveying occurs as\npart of a transaction in which the right of possession and use of the\nUser Product is transferred to the recipient in perpetuity or for a\nfixed term (regardless of how the transaction is characterized), the\nCorresponding Source conveyed under this section must be accompanied\nby the Installation Information. But this requirement does not apply\nif neither you nor any third party retains the ability to install\nmodified object code on the User Product (for example, the work has\nbeen installed in ROM).\n\n The requirement to provide Installation Information does not include a\nrequirement to continue to provide support service, warranty, or updates\nfor a work that has been modified or installed by the recipient, or for\nthe User Product in which it has been modified or installed. Access to a\nnetwork may be denied when the modification itself materially and\nadversely affects the operation of the network or violates the rules and\nprotocols for communication across the network.\n\n Corresponding Source conveyed, and Installation Information provided,\nin accord with this section must be in a format that is publicly\ndocumented (and with an implementation available to the public in\nsource code form), and must require no special password or key for\nunpacking, reading or copying.\n\n 7. Additional Terms.\n\n \"Additional permissions\" are terms that supplement the terms of this\nLicense by making exceptions from one or more of its conditions.\nAdditional permissions that are applicable to the entire Program shall\nbe treated as though they were included in this License, to the extent\nthat they are valid under applicable law. If additional permissions\napply only to part of the Program, that part may be used separately\nunder those permissions, but the entire Program remains governed by\nthis License without regard to the additional permissions.\n\n When you convey a copy of a covered work, you may at your option\nremove any additional permissions from that copy, or from any part of\nit. (Additional permissions may be written to require their own\nremoval in certain cases when you modify the work.) You may place\nadditional permissions on material, added by you to a covered work,\nfor which you have or can give appropriate copyright permission.\n\n Notwithstanding any other provision of this License, for material you\nadd to a covered work, you may (if authorized by the copyright holders of\nthat material) supplement the terms of this License with terms:\n\n a) Disclaiming warranty or limiting liability differently from the\n terms of sections 15 and 16 of this License; or\n\n b) Requiring preservation of specified reasonable legal notices or\n author attributions in that material or in the Appropriate Legal\n Notices displayed by works containing it; or\n\n c) Prohibiting misrepresentation of the origin of that material, or\n requiring that modified versions of such material be marked in\n reasonable ways as different from the original version; or\n\n d) Limiting the use for publicity purposes of names of licensors or\n authors of the material; or\n\n e) Declining to grant rights under trademark law for use of some\n trade names, trademarks, or service marks; or\n\n f) Requiring indemnification of licensors and authors of that\n material by anyone who conveys the material (or modified versions of\n it) with contractual assumptions of liability to the recipient, for\n any liability that these contractual assumptions directly impose on\n those licensors and authors.\n\n All other non-permissive additional terms are considered \"further\nrestrictions\" within the meaning of section 10. If the Program as you\nreceived it, or any part of it, contains a notice stating that it is\ngoverned by this License along with a term that is a further\nrestriction, you may remove that term. If a license document contains\na further restriction but permits relicensing or conveying under this\nLicense, you may add to a covered work material governed by the terms\nof that license document, provided that the further restriction does\nnot survive such relicensing or conveying.\n\n If you add terms to a covered work in accord with this section, you\nmust place, in the relevant source files, a statement of the\nadditional terms that apply to those files, or a notice indicating\nwhere to find the applicable terms.\n\n Additional terms, permissive or non-permissive, may be stated in the\nform of a separately written license, or stated as exceptions;\nthe above requirements apply either way.\n\n 8. Termination.\n\n You may not propagate or modify a covered work except as expressly\nprovided under this License. Any attempt otherwise to propagate or\nmodify it is void, and will automatically terminate your rights under\nthis License (including any patent licenses granted under the third\nparagraph of section 11).\n\n However, if you cease all violation of this License, then your\nlicense from a particular copyright holder is reinstated (a)\nprovisionally, unless and until the copyright holder explicitly and\nfinally terminates your license, and (b) permanently, if the copyright\nholder fails to notify you of the violation by some reasonable means\nprior to 60 days after the cessation.\n\n Moreover, your license from a particular copyright holder is\nreinstated permanently if the copyright holder notifies you of the\nviolation by some reasonable means, this is the first time you have\nreceived notice of violation of this License (for any work) from that\ncopyright holder, and you cure the violation prior to 30 days after\nyour receipt of the notice.\n\n Termination of your rights under this section does not terminate the\nlicenses of parties who have received copies or rights from you under\nthis License. If your rights have been terminated and not permanently\nreinstated, you do not qualify to receive new licenses for the same\nmaterial under section 10.\n\n 9. Acceptance Not Required for Having Copies.\n\n You are not required to accept this License in order to receive or\nrun a copy of the Program. Ancillary propagation of a covered work\noccurring solely as a consequence of using peer-to-peer transmission\nto receive a copy likewise does not require acceptance. However,\nnothing other than this License grants you permission to propagate or\nmodify any covered work. These actions infringe copyright if you do\nnot accept this License. Therefore, by modifying or propagating a\ncovered work, you indicate your acceptance of this License to do so.\n\n 10. Automatic Licensing of Downstream Recipients.\n\n Each time you convey a covered work, the recipient automatically\nreceives a license from the original licensors, to run, modify and\npropagate that work, subject to this License. You are not responsible\nfor enforcing compliance by third parties with this License.\n\n An \"entity transaction\" is a transaction transferring control of an\norganization, or substantially all assets of one, or subdividing an\norganization, or merging organizations. If propagation of a covered\nwork results from an entity transaction, each party to that\ntransaction who receives a copy of the work also receives whatever\nlicenses to the work the party's predecessor in interest had or could\ngive under the previous paragraph, plus a right to possession of the\nCorresponding Source of the work from the predecessor in interest, if\nthe predecessor has it or can get it with reasonable efforts.\n\n You may not impose any further restrictions on the exercise of the\nrights granted or affirmed under this License. For example, you may\nnot impose a license fee, royalty, or other charge for exercise of\nrights granted under this License, and you may not initiate litigation\n(including a cross-claim or counterclaim in a lawsuit) alleging that\nany patent claim is infringed by making, using, selling, offering for\nsale, or importing the Program or any portion of it.\n\n 11. Patents.\n\n A \"contributor\" is a copyright holder who authorizes use under this\nLicense of the Program or a work on which the Program is based. The\nwork thus licensed is called the contributor's \"contributor version\".\n\n A contributor's \"essential patent claims\" are all patent claims\nowned or controlled by the contributor, whether already acquired or\nhereafter acquired, that would be infringed by some manner, permitted\nby this License, of making, using, or selling its contributor version,\nbut do not include claims that would be infringed only as a\nconsequence of further modification of the contributor version. For\npurposes of this definition, \"control\" includes the right to grant\npatent sublicenses in a manner consistent with the requirements of\nthis License.\n\n Each contributor grants you a non-exclusive, worldwide, royalty-free\npatent license under the contributor's essential patent claims, to\nmake, use, sell, offer for sale, import and otherwise run, modify and\npropagate the contents of its contributor version.\n\n In the following three paragraphs, a \"patent license\" is any express\nagreement or commitment, however denominated, not to enforce a patent\n(such as an express permission to practice a patent or covenant not to\nsue for patent infringement). To \"grant\" such a patent license to a\nparty means to make such an agreement or commitment not to enforce a\npatent against the party.\n\n If you convey a covered work, knowingly relying on a patent license,\nand the Corresponding Source of the work is not available for anyone\nto copy, free of charge and under the terms of this License, through a\npublicly available network server or other readily accessible means,\nthen you must either (1) cause the Corresponding Source to be so\navailable, or (2) arrange to deprive yourself of the benefit of the\npatent license for this particular work, or (3) arrange, in a manner\nconsistent with the requirements of this License, to extend the patent\nlicense to downstream recipients. \"Knowingly relying\" means you have\nactual knowledge that, but for the patent license, your conveying the\ncovered work in a country, or your recipient's use of the covered work\nin a country, would infringe one or more identifiable patents in that\ncountry that you have reason to believe are valid.\n\n If, pursuant to or in connection with a single transaction or\narrangement, you convey, or propagate by procuring conveyance of, a\ncovered work, and grant a patent license to some of the parties\nreceiving the covered work authorizing them to use, propagate, modify\nor convey a specific copy of the covered work, then the patent license\nyou grant is automatically extended to all recipients of the covered\nwork and works based on it.\n\n A patent license is \"discriminatory\" if it does not include within\nthe scope of its coverage, prohibits the exercise of, or is\nconditioned on the non-exercise of one or more of the rights that are\nspecifically granted under this License. You may not convey a covered\nwork if you are a party to an arrangement with a third party that is\nin the business of distributing software, under which you make payment\nto the third party based on the extent of your activity of conveying\nthe work, and under which the third party grants, to any of the\nparties who would receive the covered work from you, a discriminatory\npatent license (a) in connection with copies of the covered work\nconveyed by you (or copies made from those copies), or (b) primarily\nfor and in connection with specific products or compilations that\ncontain the covered work, unless you entered into that arrangement,\nor that patent license was granted, prior to 28 March 2007.\n\n Nothing in this License shall be construed as excluding or limiting\nany implied license or other defenses to infringement that may\notherwise be available to you under applicable patent law.\n\n 12. No Surrender of Others' Freedom.\n\n If conditions are imposed on you (whether by court order, agreement or\notherwise) that contradict the conditions of this License, they do not\nexcuse you from the conditions of this License. If you cannot convey a\ncovered work so as to satisfy simultaneously your obligations under this\nLicense and any other pertinent obligations, then as a consequence you may\nnot convey it at all. For example, if you agree to terms that obligate you\nto collect a royalty for further conveying from those to whom you convey\nthe Program, the only way you could satisfy both those terms and this\nLicense would be to refrain entirely from conveying the Program.\n\n 13. Remote Network Interaction; Use with the GNU General Public License.\n\n Notwithstanding any other provision of this License, if you modify the\nProgram, your modified version must prominently offer all users\ninteracting with it remotely through a computer network (if your version\nsupports such interaction) an opportunity to receive the Corresponding\nSource of your version by providing access to the Corresponding Source\nfrom a network server at no charge, through some standard or customary\nmeans of facilitating copying of software. This Corresponding Source\nshall include the Corresponding Source for any work covered by version 3\nof the GNU General Public License that is incorporated pursuant to the\nfollowing paragraph.\n\n Notwithstanding any other provision of this License, you have\npermission to link or combine any covered work with a work licensed\nunder version 3 of the GNU General Public License into a single\ncombined work, and to convey the resulting work. The terms of this\nLicense will continue to apply to the part which is the covered work,\nbut the work with which it is combined will remain governed by version\n3 of the GNU General Public License.\n\n 14. Revised Versions of this License.\n\n The Free Software Foundation may publish revised and/or new versions of\nthe GNU Affero General Public License from time to time. Such new versions\nwill be similar in spirit to the present version, but may differ in detail to\naddress new problems or concerns.\n\n Each version is given a distinguishing version number. If the\nProgram specifies that a certain numbered version of the GNU Affero General\nPublic License \"or any later version\" applies to it, you have the\noption of following the terms and conditions either of that numbered\nversion or of any later version published by the Free Software\nFoundation. If the Program does not specify a version number of the\nGNU Affero General Public License, you may choose any version ever published\nby the Free Software Foundation.\n\n If the Program specifies that a proxy can decide which future\nversions of the GNU Affero General Public License can be used, that proxy's\npublic statement of acceptance of a version permanently authorizes you\nto choose that version for the Program.\n\n Later license versions may give you additional or different\npermissions. However, no additional obligations are imposed on any\nauthor or copyright holder as a result of your choosing to follow a\nlater version.\n\n 15. Disclaimer of Warranty.\n\n THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY\nAPPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT\nHOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM \"AS IS\" WITHOUT WARRANTY\nOF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,\nTHE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\nPURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM\nIS WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF\nALL NECESSARY SERVICING, REPAIR OR CORRECTION.\n\n 16. Limitation of Liability.\n\n IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING\nWILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS\nTHE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY\nGENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE\nUSE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF\nDATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD\nPARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),\nEVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF\nSUCH DAMAGES.\n\n 17. Interpretation of Sections 15 and 16.\n\n If the disclaimer of warranty and limitation of liability provided\nabove cannot be given local legal effect according to their terms,\nreviewing courts shall apply local law that most closely approximates\nan absolute waiver of all civil liability in connection with the\nProgram, unless a warranty or assumption of liability accompanies a\ncopy of the Program in return for a fee.\n\n END OF TERMS AND CONDITIONS\n\n How to Apply These Terms to Your New Programs\n\n If you develop a new program, and you want it to be of the greatest\npossible use to the public, the best way to achieve this is to make it\nfree software which everyone can redistribute and change under these terms.\n\n To do so, attach the following notices to the program. It is safest\nto attach them to the start of each source file to most effectively\nstate the exclusion of warranty; and each file should have at least\nthe \"copyright\" line and a pointer to where the full notice is found.\n\n \n Copyright (C) \n\n This program is free software: you can redistribute it and/or modify\n it under the terms of the GNU Affero General Public License as published by\n the Free Software Foundation, either version 3 of the License, or\n (at your option) any later version.\n\n This program is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n GNU Affero General Public License for more details.\n\n You should have received a copy of the GNU Affero General Public License\n along with this program. If not, see .\n\nAlso add information on how to contact you by electronic and paper mail.\n\n If your software can interact with users remotely through a computer\nnetwork, you should also make sure that it provides a way for users to\nget its source. For example, if your program is a web application, its\ninterface could display a \"Source\" link that leads users to an archive\nof the code. There are many ways you could offer source, and different\nsolutions will be better for different programs; see section 13 for the\nspecific requirements.\n\n You should also get your employer (if you work as a programmer) or school,\nif any, to sign a \"copyright disclaimer\" for the program, if necessary.\nFor more information on this, and how to apply and follow the GNU AGPL, see\n .",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "AGPL-3.0",
        "url": "https://www.gnu.org/licenses/agpl-3.0.txt"
      },
      "is_distractor": false,
      "semantic_tags": [
        "agpl-3.0",
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "license",
        "termination",
        "warranty"
      ],
      "content_hash": "cf6d39b941431e44",
      "size_bytes": 33816,
      "created_at": "2026-01-02T20:42:23.532728"
    },
    {
      "doc_id": "legal_license_isc",
      "source": "online",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "https://opensource.org/license/isc-license-txt/",
      "content": "‚Ä¢ \n\n ISC License &#8211; Open Source Initiative \n \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n \n \n \n \n \n \n \n \n \n\n‚Ä¢ \n\n \n \n \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n \n \n \n\n \n \n \n\n \n\n \n \n \n \n \n \n\n \n \n Copyright <YEAR> <OWNER> \n Permission to use, copy, modify, and/or distribute this software for any purpose with or without fee is hereby granted, provided that the above copyright notice and this permission notice appear in all copies. \n THE SOFTWARE IS PROVIDED &#8220;AS IS&#8221; AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE. \n \n \n \n \n \n \n \n \n \n \n\n \n \n \n\n \n \n\n \n\n \n\n \n \n \n \n \n \n \n \n \n Manage Cookie Consent \n \n \n \n \n\n \n \n To provide the best experiences, we use technologies like cookies to store and/or access device information. Consenting to these technologies will allow us to process data such as browsing behavior or unique IDs on this site. Not consenting or withdrawing consent, may adversely affect certain features and functions. \n \n \n \n \n \n Functional \n \n \n \n Functional \n \n Always active \n \n \n \n \n \n \n The technical storage or access is strictly necessary for the legitimate purpose of enabling the use of a specific service explicitly requested by the subscriber or user, or for the sole purpose of carrying out the transmission of a communication over an electronic communications network. \n \n \n\n \n \n \n Preferences \n \n \n Preferences \n \n \n \n \n \n \n \n The technical storage or access is necessary for the legitimate purpose of storing preferences that are not requested by the subscriber or user. \n \n \n\n \n \n \n Statistics \n \n \n Statistics \n \n \n \n \n \n \n \n The technical storage or access that is used exclusively for statistical purposes. \n The technical storage or access that is used exclusively for anonymous statistical purposes. Without a subpoena, voluntary compliance on the part of your Internet Service Provider, or additional records from a third party, information stored or retrieved for this purpose alone cannot usually be used to identify you. \n \n \n \n \n \n Marketing \n \n \n Marketing \n \n \n \n \n \n \n \n The technical storage or access is required to create user profiles to send advertising, or to track the user on a website or across several websites for similar marketing purposes. \n \n \n \n \n\n \n \n \n‚Ä¢ Manage options \n \n‚Ä¢ Manage services \n \n‚Ä¢ Manage {vendor_count} vendors \n \n‚Ä¢ Read more about these purposes \n \n \n\n \n\n \n Accept \n Deny \n View preferences \n Save preferences \n View preferences \n \n\n \n \n \n \n‚Ä¢ {title} \n \n‚Ä¢ {title} \n \n‚Ä¢ {title} \n \n \n \n \n Manage consent",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "ISC",
        "url": "https://opensource.org/license/isc-license-txt/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "isc",
        "legal",
        "license",
        "warranty"
      ],
      "content_hash": "30c73a24d5b319d1",
      "size_bytes": 3079,
      "created_at": "2026-01-02T20:42:23.532783"
    },
    {
      "doc_id": "legal_license_unlicense",
      "source": "online",
      "category": "legal",
      "domain": "legal_license",
      "file_path": "https://unlicense.org/",
      "content": "Unlicense Yourself: Set Your Code Free \n \n \n \n‚Ä¢ \n \n‚Ä¢ \n \n \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n \n \n \n‚Ä¢ \n \n \n \n \n \n Skip to content \n\n## Unlicense Yourself Set Your Code Free \n \n\n## What is the Unlicense? ‚Äã \n The Unlicense is a template for disclaiming copyright monopoly interest in software you've written; in other words, it is a template for dedicating your software to the public domain . It combines a copyright waiver patterned after the very successful public domain SQLite project with the no-warranty statement from the widely-used MIT/X11 license . \n\n## Why Use the Unlicense? ‚Äã \n Because you have more important things to do than enriching lawyers or imposing petty restrictions on users of your code. How often have you passed up on utilizing and contributing to a great software library just because its open source license was not compatible with your own preferred flavor of open source? How many precious hours of your life have you spent deliberating how to license your software or worrying about licensing compatibility with other software? You will never get those hours back, but here's your chance to start cutting your losses. Life's too short, let's get back to coding. \n\n## The Unlicense ‚Äã \n To opt out of the copyright industry's game altogether and set your code free, put your next software project into the public domain using the following (un)licensing statement: This is free and unencumbered software released into the public domain.\n\nAnyone is free to copy, modify, publish, use, compile, sell, or\ndistribute this software, either in source code form or as a compiled\nbinary, for any purpose, commercial or non-commercial, and by any\nmeans.\n\nIn jurisdictions that recognize copyright laws, the author or authors\nof this software dedicate any and all copyright interest in the\nsoftware to the public domain. We make this dedication for the benefit\nof the public at large and to the detriment of our heirs and\nsuccessors. We intend this dedication to be an overt act of\nrelinquishment in perpetuity of all present and future rights to this\nsoftware under copyright law.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\nIN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR\nOTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\nARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n\nFor more information, please refer to <https://unlicense.org/>\n TIP In a saner world, you would only need the first one or two paragraphs. For the time being you'll probably want to retain the whole shebang. (You should feel free, though, to leave out the last line containing the link to this site, if that's your preference.) You would traditionally put the above statement into a file named COPYING or LICENSE . However, to explicitly distance yourself from the whole concept of copyright licensing, we recommend that you put your unlicensing statement in a file named UNLICENSE . Doing so also means that your project can more easily be found on e.g. GitHub or Bitbucket , enabling others to reuse your code in their own unencumbered public domain projects. When publishing your code to registries such as NPM or PyPI, set the license field to Unlicense to mark the usage of this license. For a comprehensive listing of software using the Unlicense, google for the first line of the Unlicense . It was purposely worded uniquely, which means that all the returned search results are likely to relate to the Unlicense in some way. \n\n## Unlicensing Contributions ‚Äã \n In order to ensure your project remains completely free and unencumbered by anyone's copyright monopoly, it is advisable that you ask any major contributors to explicitly dedicate their code-base contributions to the public domain. This removes any possible ambiguity as to what terms somebody might have thought they were contributing under, in case of a future dispute. These concerns are not unique to public domain software. Most large, established open-source projects have a Contributor License Agreement ( CLA ) process, of varying degrees of formality. At minimum, you might ask your contributors to accompany any non-trivial patches with a simple statement like the following: I dedicate any and all copyright interest in this software to the\npublic domain. I make this dedication for the benefit of the public at\nlarge and to the detriment of my heirs and successors. I intend this\ndedication to be an overt act of relinquishment in perpetuity of all\npresent and future rights to this software under copyright law.\n Better yet is to ask the major contributors to digitally sign a more explicit copyright release (see an example WAIVER file), and then to keep a record of such signatures in an AUTHORS file accompanying your software. Using GnuPG , contributors can sign a copyright waiver file as follows: $ gpg --no-version --armor --sign WAIVER\n Note that if a contributor makes significant changes or enhancements in their capacity as an employee of some formal organization, then the above may be insufficient and you would additionally need to ask for a copyright disclaimer signed by a company officer. For more information, have a look at how the SQLite project handles this . The Free Software Foundation (FSF) also provides an example of a simple copyright disclaimer to be signed by an employer. TIP For a concrete example of this contributor process, see how the unlicensed RDF.rb project has handled this . \n\n## Unlicensed Free Software wip ‚Äã \n Here follows a sampling of some excellent software projects that have already adopted the Unlicense or a derivative thereof: Project Summary Links ASIMOV A polyglot development platform for trustworthy, neurosymbolic AI. üîó ‚¨áÔ∏è furl URL parsing and manipulation made easy. üîó ‚¨áÔ∏è gl3w Simple OpenGL core profile loader. üîó ‚¨áÔ∏è jslint The JavaScript code quality and coverage tool. üîó ‚¨áÔ∏è Kakoune An experimental text editor heavily inspired by Vim. üîó ‚¨áÔ∏è Libegpu Libegpu is a library for enumerating eGPU devices & enclosures. üîó ‚¨áÔ∏è Miniz A single-source-file, high-performance deflate/inflate compression library with a zlib-compatible API. üîó ‚¨áÔ∏è NearDrop A partial implementation of Google's Nearby Share/Quick Share for macOS. üîó ‚¨áÔ∏è node-rdf An ECMAScript/Node.js library for handling RDF data. üîó ‚¨áÔ∏è Poolboy A hunky Erlang worker pool factory. üîó ‚¨áÔ∏è Postgres.js The fastest full-featured PostgreSQL client for Node.js, Deno, Bun, and Cloudflare. üîó ‚¨áÔ∏è Protoflow Protoflow implements flow-based programming (FBP) for Rust using Protocol Buffers messages. üîó ‚¨áÔ∏è pytube A lightweight, dependency-free Python library (and command-line utility) for downloading YouTube videos. üîó ‚¨áÔ∏è RDF.rb A Ruby library for working with Resource Description Framework (RDF) data. üîó ‚¨áÔ∏è RDF.rs A Rust library for working with Resource Description Framework (RDF) data. üîó ‚¨áÔ∏è ripgrep A line-oriented search tool that recursively searches the current directory for a regex pattern. üîó ‚¨áÔ∏è RSS-Bridge A PHP web application that generates RSS feeds for websites that don't have one. üîó ‚¨áÔ∏è stb A set of single-file public domain libraries for C/C++. üîó ‚¨áÔ∏è Tor.rb A Ruby library for interacting with the Tor anonymity network. üîó ‚¨áÔ∏è Translate Shell A command-line translator powered by Google Translate, Bing Translator, Yandex.Translate, and Apertium. üîó ‚¨áÔ∏è Tween-o-Matic A macOS application for designing CAMediaTimingFunction animation curves. üîó ‚¨áÔ∏è UN Aiming to write a public domain all-purpose standard library for Java. üîó ‚¨áÔ∏è WjCryptLib A collection of cryptographic functions written in C. üîó ‚¨áÔ∏è xsv A command-line program for indexing, slicing, analyzing, splitting, and joining CSV files. üîó ‚¨áÔ∏è youtube-dl A command-line program to download videos from YouTube.com and a few more sites. üîó ‚¨áÔ∏è yt-dlp A feature-rich command-line audio/video downloader. üîó ‚¨áÔ∏è For more projects, search GitHub for repositories using the Unlicense. (As of November 2024, this search returned 358,000+ distinct repositories.) For the most comprehensive listing of software using the Unlicense, google for the first line of the Unlicense . TIP If you would like your own project to be potentially added to this list, please create a pull request on the Registry of Unencumbered Software Projects or tweet an addition suggestion to @bendiken on X. \n\n## Public Domain Software ‚Äã \n Some examples of well-known public domain or license-free software libraries and applications: \n‚Ä¢ CERN httpd , the original World Wide Web daemon developed by Tim Berners-Lee, was in the public domain . \n‚Ä¢ SQLite , the most widely-deployed SQL database in the world, is in the public domain . \n‚Ä¢ qmail , the second-most popular MTA on the Internet, is in the public domain . \n‚Ä¢ djbdns , the second-most popular DNS server software on the Internet, is in the public domain. \n‚Ä¢ libdjb , a project aiming to make the excellent libraries from Dan Bernstein available to a wider public by extracting them from his packages and providing a minimal Makefile for each library. \n‚Ä¢ NaCl , an easy-to-use high-speed software library for network communication, encryption, decryption, signatures, etc., is in the public domain . \n‚Ä¢ BLAST , one of the most widely used bioinformatics programs, is in the public domain. \n‚Ä¢ dlmalloc , a widely-used memory allocator implementation for C, is in the public domain. \n‚Ä¢ I2P , an anonymous overlay network implementation, is largely in the public domain . \n‚Ä¢ HLA , a high-level assembler for the x86 architecture, is in the public domain. \n‚Ä¢ CMUCL , a popular implementation of the Common Lisp programming language, is mostly in the public domain. \n‚Ä¢ SBCL , another popular Common Lisp implementation, is likewise mostly in the public domain . \n‚Ä¢ CLIPS , a widely-used forward-chaining, rule-based inference engine, is in the public domain. \n‚Ä¢ byacc , the Berkeley Yacc parser generator, is in the public domain. \n‚Ä¢ Lemon , a thread-safe LALR(1) parser generator, is in the public domain. \n‚Ä¢ re2c , a high-performance lexer generator, is in the public domain. \n‚Ä¢ Docutils , the Python text-processing system, is mostly in the public domain. \n‚Ä¢ LibTomCrypt , a portable cryptographic toolkit for C, is in the public domain. \n‚Ä¢ LibTomMath , a portable number theoretic multiple-precision integer library for C, is in the public domain. \n‚Ä¢ C++ Big Integer Library , a library for integer arithmetic, is in the public domain. \n‚Ä¢ PyCrypto , the Python cryptography toolkit, is largely in the public domain. \n‚Ä¢ Crypto++ , a cryptographic library for C++, is mostly in the public domain. \n‚Ä¢ MPICH2 , a high-performance implementation of the MPI standard, is largely in the public domain. \n‚Ä¢ MinGW 's runtime, which provides POSIX compatibility for Windows, is in the public domain . \n‚Ä¢ Phyz , a soft body dynamics physics engine for Windows, is in the public domain. \n‚Ä¢ NBDS , a C library for various lock-free algorithms (including a lock-free hash table), is in the public domain. \n‚Ä¢ Djehuty , a fully-verifiable operating system written in the D programming language, is in the public domain. \n‚Ä¢ XOS , a multitasking operating system for the x86 architecture, is in the public domain. \n‚Ä¢ snafu , a small operating system written in assembly language, is in the public domain. \n‚Ä¢ PDCLib , a minimal C standard library implementation, is in the public domain. \n‚Ä¢ PDPCLIB , another C standard library implementation, is in the public domain. \n‚Ä¢ PDOS , a DOS-compatible operating system, is in the public domain. \n‚Ä¢ SubC , a fast and simple compiler for a clean subset of the C programming language, is in the public domain. \n‚Ä¢ WPDCC , a C preprocessor and compiler implementation, is in the public domain. \n‚Ä¢ c11threads.h , a simple C11 threads implementation based on POSIX threads, is in the public domain. \n‚Ä¢ mpkg , a minimalist package manager for *nix systems, is in the public domain. For other listings of public domain software, see Whoow , Wikipedia , SourceForge , Freecode , Ohloh , Google Code Hosting , Alioth , Savannah , Launchpad , CodePlex , RubyForge and the Python Cheeseshop . \n\n## Other Popular Unlicenses ‚Äã \n Some other ways to set your code free: \n‚Ä¢ BOLA - Buena Onda License Agreement is similar to the Unlicense in intent. \n‚Ä¢ CC0 - Creative Commons Zero is not intended for software per se. \n‚Ä¢ WTFPL - Do What The Fuck You Want To Public License can't be beat for blunt directness. \n\n## Unlicensing Resources ‚Äã \n If setting your code entirely free still seems a somewhat daunting prospect, try these perspectives on for size: \n‚Ä¢ Who's Afraid of the Public Domain? \n‚Ä¢ The Surprising History of Copyright and The Promise of a Post-Copyright World \n‚Ä¢ What is Copyright? \n‚Ä¢ Placing Documents into the Public Domain \n‚Ä¢ The Unlicense: The First Year in Review \n‚Ä¢ Licensed, License-Free, and Unlicensed Code \n‚Ä¢ Set Your Code Free \n‚Ä¢ Dissecting the Unlicense: Software Freedom in Four Clauses and a Link \n‚Ä¢ Why I'm Going Public \n‚Ä¢ I Just Unlicensed My Software \n‚Ä¢ The Promising Future of the Unlicense \n‚Ä¢ To License or to Unlicense? \n‚Ä¢ Language Matters: Framing The Copyright Monopoly So We Can Keep Our Liberties Find and follow us on Twitter , Facebook , Reddit , and Tumblr .",
      "chunk_ids": [],
      "metadata": {
        "source_type": "license",
        "source_name": "Unlicense",
        "url": "https://unlicense.org/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "legal",
        "liability",
        "license",
        "unlicense",
        "warranty"
      ],
      "content_hash": "f1799621345d08ec",
      "size_bytes": 13611,
      "created_at": "2026-01-02T20:42:23.532890"
    },
    {
      "doc_id": "legal_tos_techcorp_template",
      "source": "synthetic",
      "category": "legal",
      "domain": "legal_tos",
      "file_path": "template://tos/techcorp",
      "content": "TERMS OF SERVICE\n\nLast Updated: January 1, 2025\n\n1. ACCEPTANCE OF TERMS\nBy accessing or using TechCorp services (\"Services\"), you agree to be bound by\nthese Terms of Service (\"Terms\"). If you do not agree to these Terms, you may\nnot access or use the Services.\n\n2. DESCRIPTION OF SERVICES\nTechCorp provides cloud-based software services. We reserve the right to modify, suspend, or\ndiscontinue the Services at any time without notice.\n\n3. USER ACCOUNTS\n3.1 Registration. You must register for an account to access certain features.\n3.2 Account Security. You are responsible for maintaining the confidentiality\nof your account credentials.\n3.3 Accuracy. You agree to provide accurate and complete information.\n\n4. USER CONDUCT\nYou agree not to:\n(a) Violate any applicable laws or regulations;\n(b) Infringe the rights of any third party;\n(c) Interfere with or disrupt the Services;\n(d) Attempt to gain unauthorized access to any systems;\n(e) Use the Services for any illegal or unauthorized purpose.\n\n5. INTELLECTUAL PROPERTY\n5.1 Ownership. TechCorp retains all rights to the Services and its content.\n5.2 License. Subject to these Terms, we grant you a limited, non-exclusive,\nnon-transferable license to use the Services.\n5.3 Restrictions. You may not copy, modify, distribute, sell, or lease any\npart of the Services without our prior written consent.\n\n6. PRIVACY\nYour use of the Services is subject to our Privacy Policy, which is\nincorporated by reference into these Terms.\n\n7. DISCLAIMERS\nTHE SERVICES ARE PROVIDED \"AS IS\" WITHOUT WARRANTY OF ANY KIND. WE DISCLAIM ALL\nWARRANTIES, EXPRESS OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR A\nPARTICULAR PURPOSE.\n\n8. LIMITATION OF LIABILITY\nTO THE MAXIMUM EXTENT PERMITTED BY LAW, TechCorp SHALL NOT BE LIABLE FOR ANY\nINDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, OR PUNITIVE DAMAGES ARISING FROM\nYOUR USE OF THE SERVICES.\n\n9. INDEMNIFICATION\nYou agree to indemnify and hold harmless TechCorp, its affiliates, officers,\ndirectors, employees, and agents from any claims arising from your use of the\nServices or violation of these Terms.\n\n10. TERMINATION\nWe may terminate or suspend your access to the Services at any time, without\nprior notice or liability, for any reason.\n\n11. GOVERNING LAW\nThese Terms shall be governed by the laws of Delaware, USA, without regard to\nits conflict of law provisions.\n\n12. CHANGES TO TERMS\nWe reserve the right to modify these Terms at any time. Your continued use of\nthe Services after any changes constitutes acceptance of the new Terms.\n\n13. CONTACT\nFor questions about these Terms, please contact us at legal@techcorp.example.com.\n",
      "chunk_ids": [],
      "metadata": {
        "source_type": "tos",
        "source_name": "TechCorp (Template)",
        "url": "template://tos/techcorp"
      },
      "is_distractor": false,
      "semantic_tags": [
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "techcorp_(template)",
        "termination",
        "tos",
        "warranty"
      ],
      "content_hash": "9225ca5b8531bca1",
      "size_bytes": 2625,
      "created_at": "2026-01-02T20:42:23.532940"
    },
    {
      "doc_id": "legal_tos_cloudservice_template",
      "source": "synthetic",
      "category": "legal",
      "domain": "legal_tos",
      "file_path": "template://tos/cloudservice",
      "content": "TERMS OF SERVICE\n\nLast Updated: January 1, 2025\n\n1. ACCEPTANCE OF TERMS\nBy accessing or using CloudService services (\"Services\"), you agree to be bound by\nthese Terms of Service (\"Terms\"). If you do not agree to these Terms, you may\nnot access or use the Services.\n\n2. DESCRIPTION OF SERVICES\nCloudService provides cloud-based software services. We reserve the right to modify, suspend, or\ndiscontinue the Services at any time without notice.\n\n3. USER ACCOUNTS\n3.1 Registration. You must register for an account to access certain features.\n3.2 Account Security. You are responsible for maintaining the confidentiality\nof your account credentials.\n3.3 Accuracy. You agree to provide accurate and complete information.\n\n4. USER CONDUCT\nYou agree not to:\n(a) Violate any applicable laws or regulations;\n(b) Infringe the rights of any third party;\n(c) Interfere with or disrupt the Services;\n(d) Attempt to gain unauthorized access to any systems;\n(e) Use the Services for any illegal or unauthorized purpose.\n\n5. INTELLECTUAL PROPERTY\n5.1 Ownership. CloudService retains all rights to the Services and its content.\n5.2 License. Subject to these Terms, we grant you a limited, non-exclusive,\nnon-transferable license to use the Services.\n5.3 Restrictions. You may not copy, modify, distribute, sell, or lease any\npart of the Services without our prior written consent.\n\n6. PRIVACY\nYour use of the Services is subject to our Privacy Policy, which is\nincorporated by reference into these Terms.\n\n7. DISCLAIMERS\nTHE SERVICES ARE PROVIDED \"AS IS\" WITHOUT WARRANTY OF ANY KIND. WE DISCLAIM ALL\nWARRANTIES, EXPRESS OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR A\nPARTICULAR PURPOSE.\n\n8. LIMITATION OF LIABILITY\nTO THE MAXIMUM EXTENT PERMITTED BY LAW, CloudService SHALL NOT BE LIABLE FOR ANY\nINDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, OR PUNITIVE DAMAGES ARISING FROM\nYOUR USE OF THE SERVICES.\n\n9. INDEMNIFICATION\nYou agree to indemnify and hold harmless CloudService, its affiliates, officers,\ndirectors, employees, and agents from any claims arising from your use of the\nServices or violation of these Terms.\n\n10. TERMINATION\nWe may terminate or suspend your access to the Services at any time, without\nprior notice or liability, for any reason.\n\n11. GOVERNING LAW\nThese Terms shall be governed by the laws of Delaware, USA, without regard to\nits conflict of law provisions.\n\n12. CHANGES TO TERMS\nWe reserve the right to modify these Terms at any time. Your continued use of\nthe Services after any changes constitutes acceptance of the new Terms.\n\n13. CONTACT\nFor questions about these Terms, please contact us at legal@cloudservice.example.com.\n",
      "chunk_ids": [],
      "metadata": {
        "source_type": "tos",
        "source_name": "CloudService (Template)",
        "url": "template://tos/cloudservice"
      },
      "is_distractor": false,
      "semantic_tags": [
        "cloudservice_(template)",
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "termination",
        "tos",
        "warranty"
      ],
      "content_hash": "53b2ce1eab3b7cc8",
      "size_bytes": 2649,
      "created_at": "2026-01-02T20:42:23.532950"
    },
    {
      "doc_id": "legal_tos_devplatform_template",
      "source": "synthetic",
      "category": "legal",
      "domain": "legal_tos",
      "file_path": "template://tos/devplatform",
      "content": "TERMS OF SERVICE\n\nLast Updated: January 1, 2025\n\n1. ACCEPTANCE OF TERMS\nBy accessing or using DevPlatform services (\"Services\"), you agree to be bound by\nthese Terms of Service (\"Terms\"). If you do not agree to these Terms, you may\nnot access or use the Services.\n\n2. DESCRIPTION OF SERVICES\nDevPlatform provides cloud-based software services. We reserve the right to modify, suspend, or\ndiscontinue the Services at any time without notice.\n\n3. USER ACCOUNTS\n3.1 Registration. You must register for an account to access certain features.\n3.2 Account Security. You are responsible for maintaining the confidentiality\nof your account credentials.\n3.3 Accuracy. You agree to provide accurate and complete information.\n\n4. USER CONDUCT\nYou agree not to:\n(a) Violate any applicable laws or regulations;\n(b) Infringe the rights of any third party;\n(c) Interfere with or disrupt the Services;\n(d) Attempt to gain unauthorized access to any systems;\n(e) Use the Services for any illegal or unauthorized purpose.\n\n5. INTELLECTUAL PROPERTY\n5.1 Ownership. DevPlatform retains all rights to the Services and its content.\n5.2 License. Subject to these Terms, we grant you a limited, non-exclusive,\nnon-transferable license to use the Services.\n5.3 Restrictions. You may not copy, modify, distribute, sell, or lease any\npart of the Services without our prior written consent.\n\n6. PRIVACY\nYour use of the Services is subject to our Privacy Policy, which is\nincorporated by reference into these Terms.\n\n7. DISCLAIMERS\nTHE SERVICES ARE PROVIDED \"AS IS\" WITHOUT WARRANTY OF ANY KIND. WE DISCLAIM ALL\nWARRANTIES, EXPRESS OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR A\nPARTICULAR PURPOSE.\n\n8. LIMITATION OF LIABILITY\nTO THE MAXIMUM EXTENT PERMITTED BY LAW, DevPlatform SHALL NOT BE LIABLE FOR ANY\nINDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, OR PUNITIVE DAMAGES ARISING FROM\nYOUR USE OF THE SERVICES.\n\n9. INDEMNIFICATION\nYou agree to indemnify and hold harmless DevPlatform, its affiliates, officers,\ndirectors, employees, and agents from any claims arising from your use of the\nServices or violation of these Terms.\n\n10. TERMINATION\nWe may terminate or suspend your access to the Services at any time, without\nprior notice or liability, for any reason.\n\n11. GOVERNING LAW\nThese Terms shall be governed by the laws of Delaware, USA, without regard to\nits conflict of law provisions.\n\n12. CHANGES TO TERMS\nWe reserve the right to modify these Terms at any time. Your continued use of\nthe Services after any changes constitutes acceptance of the new Terms.\n\n13. CONTACT\nFor questions about these Terms, please contact us at legal@devplatform.example.com.\n",
      "chunk_ids": [],
      "metadata": {
        "source_type": "tos",
        "source_name": "DevPlatform (Template)",
        "url": "template://tos/devplatform"
      },
      "is_distractor": false,
      "semantic_tags": [
        "devplatform_(template)",
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "termination",
        "tos",
        "warranty"
      ],
      "content_hash": "88cb8c8d4f184355",
      "size_bytes": 2643,
      "created_at": "2026-01-02T20:42:23.532959"
    },
    {
      "doc_id": "legal_tos_github",
      "source": "online",
      "category": "legal",
      "domain": "legal_tos",
      "file_path": "https://docs.github.com/en/site-policy/github-terms/github-terms-of-service",
      "content": "‚Ä¢ \n‚Ä¢ GitHub Terms of Service - GitHub Docs \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ Skip to main content \n\n## GitHub Terms of Service\n \n\n## In this article\n Thank you for using GitHub! We're happy you're here. Please read this Terms of Service agreement carefully before accessing or using GitHub. Because it is such an important contract between us and our users, we have tried to make it as clear as possible. For your convenience, we have presented these terms in a short non-binding summary followed by the full legal terms. \n\n## Summary \n\n Section What can you find there? A. Definitions Some basic terms, defined in a way that will help you understand this agreement. Refer back up to this section for clarification. B. Account Terms These are the basic requirements of having an Account on GitHub. C. Acceptable Use These are the basic rules you must follow when using your GitHub Account. D. User-Generated Content You own the content you post on GitHub. However, you have some responsibilities regarding it, and we ask you to grant us some rights so we can provide services to you. E. Private Repositories This section talks about how GitHub will treat content you post in private repositories. F. Copyright &#x26; DMCA Policy This section talks about how GitHub will respond if you believe someone is infringing your copyrights on GitHub. G. Intellectual Property Notice This describes GitHub's rights in the website and service. H. API Terms These are the rules for using GitHub's APIs, whether you are using the API for development or data collection. I. Additional Product Terms We have a few specific rules for GitHub's features and products. J. Beta Previews These are some of the additional terms that apply to GitHub's features that are still in development. K. Payment You are responsible for payment. We are responsible for billing you accurately. L. Cancellation and Termination You may cancel this agreement and close your Account at any time. M. Communications with GitHub We only use email and other electronic means to stay in touch with our users. We do not provide phone support. N. Disclaimer of Warranties We provide our service as is, and we make no promises or guarantees about this service. Please read this section carefully; you should understand what to expect. O. Limitation of Liability We will not be liable for damages or losses arising from your use or inability to use the service or otherwise arising under this agreement. Please read this section carefully; it limits our obligations to you. P. Release and Indemnification You are fully responsible for your use of the service. Q. Changes to these Terms of Service We may modify this agreement, but we will give you 30 days' notice of material changes. R. Miscellaneous Please see this section for legal details including our choice of law. \n\n## The GitHub Terms of Service \n\n Effective date: November 16, 2020 \n\n## A. Definitions \n\n Short version: We use these basic terms throughout the agreement, and they have specific meanings. You should know what we mean when we use each of the terms. There's not going to be a test on it, but it's still useful information. \n \n\n‚Ä¢ An \"Account\" represents your legal relationship with GitHub. A ‚ÄúPersonal Account‚Äù represents an individual User‚Äôs authorization to log in to and use the Service and serves as a User‚Äôs identity on GitHub. ‚ÄúOrganizations‚Äù are shared workspaces that may be associated with a single entity or with one or more Users where multiple Users can collaborate across many projects at once. A Personal Account can be a member of any number of Organizations. \n\n‚Ä¢ The ‚ÄúAgreement‚Äù refers, collectively, to all the terms, conditions, notices contained or referenced in this document (the ‚ÄúTerms of Service‚Äù or the \"Terms\") and all other operating rules, policies (including the GitHub Privacy Statement, available at github.com/site/privacy ) and procedures that we may publish from time to time on the Website. Most of our site policies are available at docs.github.com/categories/site-policy . \n\n‚Ä¢ \"Beta Previews\" mean software, services, or features identified as alpha, beta, preview, early access, or evaluation, or words or phrases with similar meanings. \n\n‚Ä¢ ‚ÄúContent‚Äù refers to content featured or displayed through the Website, including without limitation code, text, data, articles, images, photographs, graphics, software, applications, packages, designs, features, and other materials that are available on the Website or otherwise available through the Service. \"Content\" also includes Services. ‚ÄúUser-Generated Content‚Äù is Content, written or otherwise, created or uploaded by our Users. \"Your Content\" is Content that you create or own. \n\n‚Ä¢ ‚ÄúGitHub,‚Äù ‚ÄúWe,‚Äù and ‚ÄúUs‚Äù refer to GitHub, Inc., as well as our affiliates, directors, subsidiaries, contractors, licensors, officers, agents, and employees. \n\n‚Ä¢ The ‚ÄúService‚Äù refers to the applications, software, products, and services provided by GitHub, including any Beta Previews. \n\n‚Ä¢ ‚ÄúThe User,‚Äù ‚ÄúYou,‚Äù and ‚ÄúYour‚Äù refer to the individual person, company, or organization that has visited or is using the Website or Service; that accesses or uses any part of the Account; or that directs the use of the Account in the performance of its functions. A User must be at least 13 years of age. Special terms may apply for business or government Accounts (See Section B(5): Additional Terms ). \n\n‚Ä¢ The ‚ÄúWebsite‚Äù refers to GitHub‚Äôs website located at github.com , and all content, services, and products provided by GitHub at or through the Website. It also refers to GitHub-owned subdomains of github.com, such as education.github.com and pages.github.com . These Terms also govern GitHub‚Äôs conference websites, such as githubuniverse.com , and product websites, such as electronjs.org . Occasionally, websites owned by GitHub may provide different or additional terms of service. If those additional terms conflict with this Agreement, the more specific terms apply to the relevant page or service. \n \n\n## B. Account Terms \n\n Short version: Personal Accounts and Organizations have different administrative controls; a human must create your Account; you must be 13 or over; you must provide a valid email address; and you may not have more than one free Account. You alone are responsible for your Account and anything that happens while you are signed in to or using your Account. You are responsible for keeping your Account secure. \n\n## 1. Account Controls \n\n \n\n‚Ä¢ \n Users. Subject to these Terms, you retain ultimate administrative control over your Personal Account and the Content within it. \n \n\n‚Ä¢ \n Organizations. The \"owner\" of an Organization that was created under these Terms has ultimate administrative control over that Organization and the Content within it. Within the Service, an owner can manage User access to the Organization‚Äôs data and projects. An Organization may have multiple owners, but there must be at least one Personal Account designated as an owner of an Organization. If you are the owner of an Organization under these Terms, we consider you responsible for the actions that are performed on or through that Organization. \n \n \n\n## 2. Required Information \n\n You must provide a valid email address in order to complete the signup process. Any other information requested, such as your real name, is optional, unless you are accepting these terms on behalf of a legal entity (in which case we need more information about the legal entity) or if you opt for a paid Account , in which case additional information will be necessary for billing purposes. \n\n## 3. Account Requirements \n\n We have a few simple rules for Personal Accounts on GitHub's Service. \n \n\n‚Ä¢ You must be a human to create an Account. Accounts registered by \"bots\" or other automated methods are not permitted. We do permit machine accounts: \n\n‚Ä¢ A machine account is an Account set up by an individual human who accepts the Terms on behalf of the Account, provides a valid email address, and is responsible for its actions. A machine account is used exclusively for performing automated tasks. Multiple users may direct the actions of a machine account, but the owner of the Account is ultimately responsible for the machine's actions. You may maintain no more than one free machine account in addition to your free Personal Account. \n\n‚Ä¢ One person or legal entity may maintain no more than one free Account (if you choose to control a machine account as well, that's fine, but it can only be used for running a machine). \n\n‚Ä¢ You must be age 13 or older. While we are thrilled to see brilliant young coders get excited by learning to program, we must comply with United States law. GitHub does not target our Service to children under 13, and we do not permit any Users under 13 on our Service. If we learn of any User under the age of 13, we will terminate that User‚Äôs Account immediately . If you are a resident of a country outside the United States, your country‚Äôs minimum age may be older; in such a case, you are responsible for complying with your country‚Äôs laws. \n\n‚Ä¢ Your login may only be used by one person ‚Äî i.e., a single login may not be shared by multiple people. A paid Organization may only provide access to as many Personal Accounts as your subscription allows. \n\n‚Ä¢ You may not use GitHub in violation of export control or sanctions laws of the United States or any other applicable jurisdiction. You may not use GitHub if you are or are working on behalf of a Specially Designated National (SDN) or a person subject to similar blocking or denied party prohibitions administered by a U.S. government agency. GitHub may allow persons in certain sanctioned countries or territories to access certain GitHub services pursuant to U.S. government authorizations. For more information, please see our Export Controls policy . \n \n\n## 4. Account Security \n\n You are responsible for keeping your Account secure while you use our Service. We offer tools such as two-factor authentication to help you maintain your Account's security, but the content of your Account and its security are up to you. \n \n\n‚Ä¢ You are responsible for all content posted and activity that occurs under your Account (even when content is posted by others who have Accounts under your Account). \n\n‚Ä¢ You are responsible for maintaining the security of your Account and password. GitHub cannot and will not be liable for any loss or damage from your failure to comply with this security obligation. \n\n‚Ä¢ You will promptly notify GitHub by contacting us through the GitHub Support portal if you become aware of any unauthorized use of, or access to, our Service through your Account, including any unauthorized use of your password or Account. \n \n\n## 5. Additional Terms \n\n In some situations, third parties' terms may apply to your use of GitHub. For example, you may be a member of an organization on GitHub with its own terms or license agreements; you may download an application that integrates with GitHub; or you may use GitHub to authenticate to another service. Please be aware that while these Terms are our full agreement with you, other parties' terms govern their relationships with you. \n If you are a government User or otherwise accessing or using any GitHub Service in a government capacity, this Government Amendment to GitHub Terms of Service applies to you, and you agree to its provisions. \n If you have signed up for GitHub Enterprise Cloud, the Enterprise Cloud Addendum applies to you, and you agree to its provisions. \n\n## C. Acceptable Use \n\n Short version: GitHub hosts a wide variety of collaborative projects from all over the world, and that collaboration only works when our users are able to work together in good faith. While using the service, you must follow the terms of this section, which include some restrictions on content you can post, conduct on the service, and other limitations. In short, be excellent to each other. \n Your use of the Website and Service must not violate any applicable laws, including copyright or trademark laws, export control or sanctions laws, or other laws in your jurisdiction. You are responsible for making sure that your use of the Service is in compliance with laws and any applicable regulations. \n You agree that you will not under any circumstances violate our Acceptable Use Policies or Community Guidelines . \n\n## D. User-Generated Content \n\n Short version: You own content you create, but you allow us certain rights to it, so that we can display and share the content you post. You still have control over your content, and responsibility for it, and the rights you grant us are limited to those we need to provide the service. We have the right to remove content or close Accounts if we need to. \n\n## 1. Responsibility for User-Generated Content \n\n You may create or upload User-Generated Content while using the Service. You are solely responsible for the content of, and for any harm resulting from, any User-Generated Content that you post, upload, link to or otherwise make available via the Service, regardless of the form of that Content. We are not responsible for any public display or misuse of your User-Generated Content. \n\n## 2. GitHub May Remove Content \n\n We have the right to refuse or remove any User-Generated Content that, in our sole discretion, violates any laws or GitHub terms or policies . User-Generated Content displayed on GitHub Mobile may be subject to mobile app stores' additional terms. \n\n## 3. Ownership of Content, Right to Post, and License Grants \n\n You retain ownership of and responsibility for Your Content. If you're posting anything you did not create yourself or do not own the rights to, you agree that you are responsible for any Content you post; that you will only submit Content that you have the right to post; and that you will fully comply with any third party licenses relating to Content you post. \n Because you retain ownership of and responsibility for Your Content, we need you to grant us ‚Äî and other GitHub Users ‚Äî certain legal permissions, listed in Sections D.4 ‚Äî D.7. These license grants apply to Your Content. If you upload Content that already comes with a license granting GitHub the permissions we need to run our Service, no additional license is required. You understand that you will not receive any payment for any of the rights granted in Sections D.4 ‚Äî D.7. The licenses you grant to us will end when you remove Your Content from our servers, unless other Users have forked it. \n\n## 4. License Grant to Us \n\n We need the legal right to do things like host Your Content, publish it, and share it. You grant us and our legal successors the right to store, archive, parse, and display Your Content, and make incidental copies, as necessary to provide the Service, including improving the Service over time. This license includes the right to do things like copy it to our database and make backups; show it to you and other users; parse it into a search index or otherwise analyze it on our servers; share it with other users; and perform it, in case Your Content is something like music or video. \n This license does not grant GitHub the right to sell Your Content. It also does not grant GitHub the right to otherwise distribute or use Your Content outside of our provision of the Service, except that as part of the right to archive Your Content, GitHub may permit our partners to store and archive Your Content in public repositories in connection with the GitHub Arctic Code Vault and GitHub Archive Program . \n\n## 5. License Grant to Other Users \n\n Any User-Generated Content you post publicly, including issues, comments, and contributions to other Users' repositories, may be viewed by others. By setting your repositories to be viewed publicly, you agree to allow others to view and \"fork\" your repositories (this means that others may make their own copies of Content from your repositories in repositories they control). \n If you set your pages and repositories to be viewed publicly, you grant each User of GitHub a nonexclusive, worldwide license to use, display, and perform Your Content through the GitHub Service and to reproduce Your Content solely on GitHub as permitted through GitHub's functionality (for example, through forking). You may grant further rights if you adopt a license . If you are uploading Content you did not create or own, you are responsible for ensuring that the Content you upload is licensed under terms that grant these permissions to other GitHub Users. \n\n## 6. Contributions Under Repository License \n\n Whenever you add Content to a repository containing notice of a license, you license that Content under the same terms, and you agree that you have the right to license that Content under those terms. If you have a separate agreement to license that Content under different terms, such as a contributor license agreement, that agreement will supersede. \n Isn't this just how it works already? Yep. This is widely accepted as the norm in the open-source community; it's commonly referred to by the shorthand \"inbound=outbound\". We're just making it explicit. \n\n## 7. Moral Rights \n\n You retain all moral rights to Your Content that you upload, publish, or submit to any part of the Service, including the rights of integrity and attribution. However, you waive these rights and agree not to assert them against us, to enable us to reasonably exercise the rights granted in Section D.4, but not otherwise. \n To the extent this agreement is not enforceable by applicable law, you grant GitHub the rights we need to use Your Content without attribution and to make reasonable adaptations of Your Content as necessary to render the Website and provide the Service. \n\n## 8. Access Reciprocity \n\n By using automated means to access, collect, or otherwise use (‚ÄúAccess‚Äù) any publicly accessible Content from the Service for the purpose of developing or training any commercially available artificial intelligence model, machine learning system, or similar technology (a \"Commercial AI System\"), you hereby waive any and all policies, terms, conditions, or contractual provisions governing products, services, websites or datasets you own or operate that would otherwise prohibit, restrict, or place conditions upon GitHub's Access to any publicly accessible data, information or content associated with your products or services, including for the purpose of developing or training any Commercial AI System. You further agree not to impose technical or other targeted measures to restrict or retaliate against such Access. \n This Section D.8 does not apply to Access solely for the purpose of academic research or if, on the date you Access the Content, the number of monthly active users of the products or services made available by you is less than 700 million in the preceding calendar month. For the purposes of this Section, \"you\" shall refer to you and any entity that directly or indirectly controls, is controlled by, or is under common control with you (affiliates). \n\n## E. Private Repositories \n\n Short version: We treat the content of private repositories as confidential, and we only access it as described in our Privacy Statement‚Äîfor security purposes, to assist the repository owner with a support matter, to maintain the integrity of the Service, to comply with our legal obligations, if we have reason to believe the contents are in violation of the law, or with your consent. \n\n## 1. Control of Private Repositories \n\n Some Accounts may have private repositories, which allow the User to control access to Content. \n\n## 2. Confidentiality of Private Repositories \n\n GitHub considers the contents of private repositories to be confidential to you. GitHub will protect the contents of private repositories from unauthorized use, access, or disclosure in the same manner that we would use to protect our own confidential information of a similar nature and in no event with less than a reasonable degree of care. \n\n## 3. Access \n\n GitHub personnel may only access the content of your private repositories in the situations described in our Privacy Statement . \n You may choose to enable additional access to your private repositories. For example: \n \n\n‚Ä¢ You may enable various GitHub services or features that require additional rights to Your Content in private repositories. These rights may vary depending on the service or feature, but GitHub will continue to treat your private repository Content as confidential. If those services or features require rights in addition to those we need to provide the GitHub Service, we will provide an explanation of those rights. \n \n Additionally, we may be compelled by law to disclose the contents of your private repositories. \n GitHub will provide notice regarding our access to private repository content, unless for legal disclosure , to comply with our legal obligations, or where otherwise bound by requirements under law, for automated scanning, or if in response to a security threat or other risk to security. \n\n## F. Copyright Infringement and DMCA Policy \n\n If you believe that content on our website violates your copyright, please contact us in accordance with our Digital Millennium Copyright Act Policy . If you are a copyright owner and you believe that content on GitHub violates your rights, please contact us via our convenient DMCA form or by emailing copyright@github.com . There may be legal consequences for sending a false or frivolous takedown notice. Before sending a takedown request, you must consider legal uses such as fair use and licensed uses. \n We will terminate the Accounts of repeat infringers of this policy. \n\n## G. Intellectual Property Notice \n\n Short version: We own the service and all of our content. In order for you to use our content, we give you certain rights to it, but you may only use our content in the way we have allowed. \n\n## 1. GitHub's Rights to Content \n\n GitHub and our licensors, vendors, agents, and/or our content providers retain ownership of all intellectual property rights of any kind related to the Website and Service. We reserve all rights that are not expressly granted to you under this Agreement or by law. The look and feel of the Website and Service is copyright ¬© GitHub, Inc. All rights reserved. You may not duplicate, copy, or reuse any portion of the HTML/CSS, JavaScript, or visual design elements or concepts without express written permission from GitHub. \n\n## 2. GitHub Trademarks and Logos \n\n If you‚Äôd like to use GitHub‚Äôs trademarks, you must follow all of our trademark guidelines, including those on our logos page: https://github.com/logos . \n\n## 3. License to GitHub Policies \n\n This Agreement is licensed under this Creative Commons Zero license . For details, see our site-policy repository . \n\n## H. API Terms \n\n Short version: You agree to these Terms of Service, plus this Section H, when using any of GitHub's APIs (Application Provider Interface), including use of the API through a third party product that accesses GitHub. \n Abuse or excessively frequent requests to GitHub via the API may result in the temporary or permanent suspension of your Account's access to the API. GitHub, in our sole discretion, will determine abuse or excessive usage of the API. We will make a reasonable attempt to warn you via email prior to suspension. \n You may not share API tokens to exceed GitHub's rate limitations. \n You may not use the API to download data or Content from GitHub for spamming purposes, including for the purposes of selling GitHub users' personal information, such as to recruiters, headhunters, and job boards. \n All use of the GitHub API is subject to these Terms of Service and the GitHub Privacy Statement . \n GitHub may offer subscription-based access to our API for those Users who require high-throughput access or access that would result in resale of GitHub's Service. \n\n## I. GitHub Additional Product Terms \n\n Short version: You need to follow certain specific terms and conditions for GitHub's various features and products, and you agree to the Supplemental Terms and Conditions when you agree to this Agreement. \n Some Service features may be subject to additional terms specific to that feature or product as set forth in the GitHub Additional Product Terms. By accessing or using the Services, you also agree to the GitHub Additional Product Terms . \n\n## J. Beta Previews \n\n Short version: Beta Previews may not be supported or may change at any time. You may receive confidential information through those programs that must remain confidential while the program is private. We'd love your feedback to make our Beta Previews better. \n\n## 1. Subject to Change \n\n Beta Previews may not be supported and may be changed at any time without notice. In addition, Beta Previews are not subject to the same security measures and auditing to which the Service has been and is subject. By using a Beta Preview, you use it at your own risk. \n\n## 2. Confidentiality \n\n As a user of Beta Previews, you may get access to special information that isn‚Äôt available to the rest of the world. Due to the sensitive nature of this information, it‚Äôs important for us to make sure that you keep that information secret. \n Confidentiality Obligations. You agree that any non-public Beta Preview information we give you, such as information about a private Beta Preview, will be considered GitHub‚Äôs confidential information (collectively, ‚ÄúConfidential Information‚Äù), regardless of whether it is marked or identified as such. You agree to only use such Confidential Information for the express purpose of testing and evaluating the Beta Preview (the ‚ÄúPurpose‚Äù), and not for any other purpose. You should use the same degree of care as you would with your own confidential information, but no less than reasonable precautions to prevent any unauthorized use, disclosure, publication, or dissemination of our Confidential Information. You promise not to disclose, publish, or disseminate any Confidential Information to any third party, unless we don‚Äôt otherwise prohibit or restrict such disclosure (for example, you might be part of a GitHub-organized group discussion about a private Beta Preview feature). \n Exceptions. Confidential Information will not include information that is: (a) or becomes publicly available without breach of this Agreement through no act or inaction on your part (such as when a private Beta Preview becomes a public Beta Preview); (b) known to you before we disclose it to you; (c) independently developed by you without breach of any confidentiality obligation to us or any third party; or (d) disclosed with permission from GitHub. You will not violate the terms of this Agreement if you are required to disclose Confidential Information pursuant to operation of law, provided GitHub has been given reasonable advance written notice to object, unless prohibited by law. \n\n## 3. Feedback \n\n We‚Äôre always trying to improve of products and services, and your feedback as a Beta Preview user will help us do that. If you choose to give us any ideas, know-how, algorithms, code contributions, suggestions, enhancement requests, recommendations or any other feedback for our products or services (collectively, ‚ÄúFeedback‚Äù), you acknowledge and agree that GitHub will have a royalty-free, fully paid-up, worldwide, transferable, sub-licensable, irrevocable and perpetual license to implement, use, modify, commercially exploit and/or incorporate the Feedback into our products, services, and documentation. \n\n## K. Payment \n\n Short version: You are responsible for any fees associated with your use of GitHub. We are responsible for communicating those fees to you clearly and accurately, and letting you know well in advance if those prices change. \n\n## 1. Pricing \n\n Our pricing and payment terms are available at github.com/pricing . If you agree to a subscription price, that will remain your price for the duration of the payment term; however, prices are subject to change at the end of a payment term. \n\n## 2. Upgrades, Downgrades, and Changes \n\n \n\n‚Ä¢ We will immediately bill you when you upgrade from the free plan to any paying plan. \n\n‚Ä¢ If you change from a monthly billing plan to a yearly billing plan, GitHub will bill you for a full year at the next monthly billing date. \n\n‚Ä¢ If you upgrade to a higher level of service, we will bill you for the upgraded plan immediately. \n\n‚Ä¢ You may change your level of service at any time by choosing a plan option or going into your Billing settings . If you choose to downgrade your Account, you may lose access to Content, features, or capacity of your Account. Please see our section on Cancellation for information on getting a copy of that Content. \n \n\n## 3. Billing Schedule; No Refunds \n\n Payment Based on Plan For monthly or yearly payment plans, the Service is billed in advance on a monthly or yearly basis respectively and is non-refundable. There will be no refunds or credits for partial months of service, downgrade refunds, or refunds for months unused with an open Account; however, the service will remain active for the length of the paid billing period. In order to treat everyone equally, no exceptions will be made. \n Payment Based on Usage Some Service features are billed based on your usage. A limited quantity of these Service features may be included in your plan for a limited term without additional charge. If you choose to use paid Service features beyond the quantity included in your plan, you pay for those Service features based on your actual usage in the preceding month. Monthly payment for these purchases will be charged on a periodic basis in arrears. See GitHub Additional Product Terms for Details . \n Invoicing For invoiced Users, User agrees to pay the fees in full, up front without deduction or setoff of any kind, in U.S. Dollars. User must pay the fees within thirty (30) days of the GitHub invoice date. Amounts payable under this Agreement are non-refundable, except as otherwise provided in this Agreement. If User fails to pay any fees on time, GitHub reserves the right, in addition to taking any other action at law or equity, to (i) charge interest on past due amounts at 1.0% per month or the highest interest rate allowed by law, whichever is less, and to charge all expenses of recovery, and (ii) terminate the applicable order form. User is solely responsible for all taxes, fees, duties and governmental assessments (except for taxes based on GitHub's net income) that are imposed or become due in connection with this Agreement. \n\n## 4. Authorization \n\n By agreeing to these Terms, you are giving us permission to charge your on-file credit card, PayPal account, or other approved methods of payment for fees that you authorize for GitHub. \n\n## 5. Responsibility for Payment \n\n You are responsible for all fees, including taxes, associated with your use of the Service. By using the Service, you agree to pay GitHub any charge incurred in connection with your use of the Service. If you dispute the matter, contact us through the GitHub Support portal . You are responsible for providing us with a valid means of payment for paid Accounts. Free Accounts are not required to provide payment information. \n\n## L. Cancellation and Termination \n\n Short version: You may close your Account at any time. If you do, we'll treat your information responsibly. \n\n## 1. Account Cancellation \n\n It is your responsibility to properly cancel your Account with GitHub. You can cancel your Account at any time by going into your Settings in the global navigation bar at the top of the screen. The Account screen provides a simple, no questions asked cancellation link. We are not able to cancel Accounts in response to an email or phone request. \n\n## 2. Upon Cancellation \n\n We will retain and use your information as necessary to comply with our legal obligations, resolve disputes, and enforce our agreements, but barring legal requirements, we will delete your full profile and the Content of your repositories within 90 days of cancellation or termination (though some information may remain in encrypted backups). This information cannot be recovered once your Account is canceled. \n We will not delete Content that you have contributed to other Users' repositories or that other Users have forked. \n Upon request, we will make a reasonable effort to provide an Account owner with a copy of your lawful, non-infringing Account contents after Account cancellation, termination, or downgrade. You must make this request within 90 days of cancellation, termination, or downgrade. \n\n## 3. GitHub May Terminate \n\n GitHub has the right to suspend or terminate your access to all or any part of the Website at any time, with or without cause, with or without notice, effective immediately. GitHub reserves the right to refuse service to anyone for any reason at any time. \n\n## 4. Survival \n\n All provisions of this Agreement which, by their nature, should survive termination will survive termination ‚Äî including, without limitation: ownership provisions, warranty disclaimers, indemnity, and limitations of liability. \n\n## M. Communications with GitHub \n\n Short version: We use email and other electronic means to stay in touch with our users. \n\n## 1. Electronic Communication Required \n\n For contractual purposes, you (1) consent to receive communications from us in an electronic form via the email address you have submitted or via the Service; and (2) agree that all Terms of Service, agreements, notices, disclosures, and other communications that we provide to you electronically satisfy any legal requirement that those communications would satisfy if they were on paper. This section does not affect your non-waivable rights. \n\n## 2. Legal Notice to GitHub Must Be in Writing \n\n Communications made through email or GitHub Support's messaging system will not constitute legal notice to GitHub or any of its officers, employees, agents or representatives in any situation where notice to GitHub is required by contract or any law or regulation. Legal notice to GitHub must be in writing and served on GitHub's legal agent . \n\n## 3. No Phone Support \n\n GitHub only offers support via email, in-Service communications, and electronic messages. We do not offer telephone support. \n\n## N. Disclaimer of Warranties \n\n Short version: We provide our service as is, and we make no promises or guarantees about this service. Please read this section carefully; you should understand what to expect. \n GitHub provides the Website and the Service ‚Äúas is‚Äù and ‚Äúas available,‚Äù without warranty of any kind. Without limiting this, we expressly disclaim all warranties, whether express, implied or statutory, regarding the Website and the Service including without limitation any warranty of merchantability, fitness for a particular purpose, title, security, accuracy and non-infringement. \n GitHub does not warrant that the Service will meet your requirements; that the Service will be uninterrupted, timely, secure, or error-free; that the information provided through the Service is accurate, reliable or correct; that any defects or errors will be corrected; that the Service will be available at any particular time or location; or that the Service is free of viruses or other harmful components. You assume full responsibility and risk of loss resulting from your downloading and/or use of files, information, content or other material obtained from the Service. \n\n## O. Limitation of Liability \n\n Short version: We will not be liable for damages or losses arising from your use or inability to use the service or otherwise arising under this agreement. Please read this section carefully; it limits our obligations to you. \n You understand and agree that we will not be liable to you or any third party for any loss of profits, use, goodwill, or data, or for any incidental, indirect, special, consequential or exemplary damages, however arising, that result from \n \n\n‚Ä¢ the use, disclosure, or display of your User-Generated Content; \n\n‚Ä¢ your use or inability to use the Service; \n\n‚Ä¢ any modification, price change, suspension or discontinuance of the Service; \n\n‚Ä¢ the Service generally or the software or systems that make the Service available; \n\n‚Ä¢ unauthorized access to or alterations of your transmissions or data; \n\n‚Ä¢ statements or conduct of any third party on the Service; \n\n‚Ä¢ any other user interactions that you input or receive through your use of the Service; or \n\n‚Ä¢ any other matter relating to the Service. \n \n Our liability is limited whether or not we have been informed of the possibility of such damages, and even if a remedy set forth in this Agreement is found to have failed of its essential purpose. We will have no liability for any failure or delay due to matters beyond our reasonable control. \n\n## P. Release and Indemnification \n\n Short version: You are responsible for your use of the service. If you harm someone else or get into a dispute with someone else, we will not be involved. \n If you have a dispute with one or more Users, you agree to release GitHub from any and all claims, demands and damages (actual and consequential) of every kind and nature, known and unknown, arising out of or in any way connected with such disputes. \n You agree to indemnify us, defend us, and hold us harmless from and against any and all claims, liabilities, and expenses, including attorneys‚Äô fees, arising out of your use of the Website and the Service, including but not limited to your violation of this Agreement, provided that GitHub (1) promptly gives you written notice of the claim, demand, suit or proceeding; (2) gives you sole control of the defense and settlement of the claim, demand, suit or proceeding (provided that you may not settle any claim, demand, suit or proceeding unless the settlement unconditionally releases GitHub of all liability); and (3) provides to you all reasonable assistance, at your expense. \n\n## Q. Changes to These Terms \n\n Short version: We want our users to be informed of important changes to our terms, but some changes aren't that important ‚Äî we don't want to bother you every time we fix a typo. So while we may modify this agreement at any time, we will notify users of any material changes and give you time to adjust to them. \n We reserve the right, at our sole discretion, to amend these Terms of Service at any time and will update these Terms of Service in the event of any such amendments. We will notify our Users of material changes to this Agreement, such as price increases, at least 30 days prior to the change taking effect by posting a notice on our Website or sending email to the primary email address specified in your GitHub account. Customer's continued use of the Service after those 30 days constitutes agreement to those revisions of this Agreement. For any other modifications, your continued use of the Website constitutes agreement to our revisions of these Terms of Service. You can view all changes to these Terms in our Site Policy repository. \n We reserve the right at any time and from time to time to modify or discontinue, temporarily or permanently, the Website (or any part of it) with or without notice. \n\n## R. Miscellaneous \n\n## 1. Governing Law \n\n Except to the extent applicable law provides otherwise, this Agreement between you and GitHub and any access to or use of the Website or the Service are governed by the federal laws of the United States of America and the laws of the State of California, without regard to conflict of law provisions. You and GitHub agree to submit to the exclusive jurisdiction and venue of the courts located in the City and County of San Francisco, California. However, any claim for injunctive relief with respect to a violation of section D.8 may be brought in any jurisdiction. \n\n## 2. Non-Assignability \n\n GitHub may assign or delegate these Terms of Service and/or the GitHub Privacy Statement , in whole or in part, to any person or entity at any time with or without your consent, including the license grant in Section D.4. You may not assign or delegate any rights or obligations under the Terms of Service or Privacy Statement without our prior written consent, and any unauthorized assignment and delegation by you is void. \n\n## 3. Section Headings and Summaries \n\n Throughout this Agreement, each section includes titles and brief summaries of the following terms and conditions. These section titles and brief summaries are not legally binding. \n\n## 4. Severability, No Waiver, and Survival \n\n If any part of this Agreement is held invalid or unenforceable, that portion of the Agreement will be construed to reflect the parties‚Äô original intent. The remaining portions will remain in full force and effect. Any failure on the part of GitHub to enforce any provision of this Agreement will not be considered a waiver of our right to enforce such provision. Our rights under this Agreement will survive any termination of this Agreement. \n\n## 5. Amendments; Complete Agreement \n\n This Agreement may only be modified by a written amendment signed by an authorized representative of GitHub, or by the posting by GitHub of a revised version in accordance with Section Q. Changes to These Terms . These Terms of Service, together with the GitHub Privacy Statement, represent the complete and exclusive statement of the agreement between you and us. This Agreement supersedes any proposal or prior agreement oral or written, and any other communications between you and GitHub relating to the subject matter of these terms including any confidentiality or nondisclosure agreements. \n\n## 6. Questions \n\n Questions about the Terms of Service? Contact us through the GitHub Support portal .",
      "chunk_ids": [],
      "metadata": {
        "source_type": "tos",
        "source_name": "Github",
        "url": "https://docs.github.com/en/site-policy/github-terms/github-terms-of-service"
      },
      "is_distractor": false,
      "semantic_tags": [
        "github",
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "termination",
        "tos",
        "warranty"
      ],
      "content_hash": "3c2b7d2962c8345e",
      "size_bytes": 42031,
      "created_at": "2026-01-02T20:42:23.533130"
    },
    {
      "doc_id": "legal_tos_gitlab",
      "source": "online",
      "category": "legal",
      "domain": "legal_tos",
      "file_path": "https://about.gitlab.com/terms/",
      "content": "GitLab Terms of Use \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n\n## GitLab Terms of Use \n The CURRENT TERMS OF USE (unless otherwise stated in the Table below) shall apply to net-new and renewal purchases made on, or after, November 13, 2025. If you received an Order Form / Quote, or purchased, prior to November 13, 2025, please see the Agreement History below for the terms applicable to your purchase and/or use of GitLab software. Any GitLab Subscription purchased prior to November 13, 2025 including upgrades and additional Users purchased for that Subscription, will be governed by the Agreement in effect as of the Subscription purchase date. \n\n## Current Terms of Use \n Type of Use / Activity Applicable Agreement Use of any GitLab Software Offering , including Free tier Subscription Agreement Additional Terms: Use of any GitLab Professional Services Use of any AI Functionality Use of any experimental or beta feature Agile Planning Terms EU Data Act Supplemental Terms Professional Services Terms GitLab Duo AI Terms (formerly known as AI Functionality Terms) Testing Agreement Agile Planning Terms EU Data Act Supplemental Terms Privacy Statement GitLab Privacy Statement GitLab Processing Personal Data from an Enterprise GitLab Data Processing Addendum and Standard Contractual Clauses Request Removal of Content / Data DMCA Notice and Take Down Use of GitLab's Website(s) Website Terms of Use Cookies & Visiting the Website GitLab Cookie Policy External Contributions to the GitLab Blog External Blog Submissions Terms Use of any GitLab services, including Software, AI Functionality, Website(s), etc. Acceptable Use Policy Using GitLab's publicly-available APIs GitLab API Terms of Use Partner Program To enroll please visit the GitLab Partner Program Portal GitLab Reseller / Referral Partner Master Partner Agreement GitLab Integration Agreement Technology Partner Agreement GitLab for Education Program* GitLab for Education Program Agreement GitLab for Open Source Program** GitLab for Open Source Program Agreement *Only applicable for Educational Institutions using GitLab Software for Instructional Use, or, Non-Commercial Academic Research. Please visit Program Guidelines for more information. **Only applicable for Open Source Organizations using GitLab Software for Open Source Software. Please visit Program Guidelines for more information. \n\n## Agreement History \n GitLab, including GitLab Legal, is committed to transparency as part of its‚Äô values, as such we provide previous versions of our Agreements. Legacy Agreement and Applicable Dates Agreement Location Privacy Statement (June 10, 2022 - March 18, 2024) Legacy Privacy Statement V1 Subscription Agreement (August 30, 2024 - November 12, 2025) Legacy Subscription Agreement V6 Subscription Agreement (August 14, 2023 - August 29, 2024) Legacy Subscription Agreement V5 Subscription Agreement (September 07, 2022 - August 13, 2023) Legacy Subscription Agreement V4 Subscription Agreement (August 1, 2021 - September 06, 2022) Legacy Subscription Agreement V3 Subscription Agreement (February 1, 2021 - July 31, 2021) Legacy Subscription Agreement V2 Subscription Agreement (January 1, 2015 - January 31, 2021) Legacy Subscription Agreement V1 Professional Services Agreement (August 30, 2024 - March 5, 2025) Legacy Professional Services Agreement V3 Professional Services Agreement (November 1, 2021 - August 29, 2024) Legacy Professional Services Agreement V2 Professional Services Agreement (January 1, 2015 - October 31, 2021) Legacy Professional Services Agreement V1 GitLab for Open Source Program Agreement (February 24, 2021 - August 19, 2022) Legacy GitLab for Open Source Program Agreement V1 Testing Agreement (August 30, 2024 - February 28, 2025) Legacy GitLab Testing Agreement V4 Testing Agreement (June 30, 2023 - August 29, 2024) Legacy GitLab Testing Agreement V3 Testing Agreement (May 19, 2023 - June 29, 2023) Legacy GitLab Testing Agreement V2 Testing Agreement (April 10, 2023 - May 18, 2023) Legacy GitLab Testing Agreement V1 AI Functionality Terms (April 1, 2025 - November 12, 2025) Legacy AI Functionality Terms V4 AI Functionality Terms (August 30, 2024 - March 31, 2025) Legacy AI Functionality Terms V3 AI Functionality Terms (November 1, 2023 - August 29, 2024) Legacy AI Functionality Terms V2 AI Functionality Terms (August 14, 2023 - October 31, 2023) Legacy AI Functionality Terms V1 Agile Planning Terms (October 17, 2023 - August 29, 2024) Legacy Agile Planning Terms V1 Master Partner Agreement (May 16, 2023 - August 28, 2025) Legacy Master Partner Agreement V1",
      "chunk_ids": [],
      "metadata": {
        "source_type": "tos",
        "source_name": "Gitlab",
        "url": "https://about.gitlab.com/terms/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "gitlab",
        "legal",
        "tos"
      ],
      "content_hash": "86848bdbb5a9724e",
      "size_bytes": 4764,
      "created_at": "2026-01-02T20:42:23.533219"
    },
    {
      "doc_id": "legal_tos_cloudflare",
      "source": "online",
      "category": "legal",
      "domain": "legal_tos",
      "file_path": "https://www.cloudflare.com/terms/",
      "content": "‚Ä¢ Self-Serve Subscription Agreement | Cloudflare \n‚Ä¢ \n‚Ä¢ \n\n## Cloudflare Self-Serve Subscription Agreement\n Last Updated September 12, 2025 PLEASE READ THE FOLLOWING CAREFULLY AS IT AFFECTS YOUR LEGAL RIGHTS. THIS AGREEMENT CONTAINS PROVISIONS REQUIRING THAT YOU AGREE TO THE USE OF ARBITRATION TO RESOLVE ANY DISPUTES ARISING UNDER THIS AGREEMENT RATHER THAN A JURY TRIAL OR ANY OTHER COURT PROCEEDINGS, AND TO WAIVE YOUR PARTICIPATION IN CLASS ACTION OF ANY KIND AGAINST CLOUDFLARE. This Self-Serve Subscription Agreement (‚Äú Agreement ‚Äù) is an agreement between Cloudflare (also referred to as ‚Äú we ,‚Äù ‚Äú us ,‚Äù or ‚Äú our ‚Äù) and you, or the Entity you represent, (‚Äú you ‚Äù or ‚Äú your ‚Äù) and governs your use of our Services (as defined below). This Agreement is effective when you click to accept it, use or access the Services, or otherwise indicate your acceptance of the Agreement. If you are entering into this Agreement on behalf of a company, organization, or another legal entity (an ‚Äú Entity ‚Äù), you are agreeing to this Agreement for that Entity and representing to Cloudflare that you have the authority to bind such Entity to this Agreement. \n\n## 1. Overview; Service Terms \n This Agreement governs the use of Cloudflare‚Äôs cloud-based solutions that are provided as part of a subscription or require a Cloudflare account, along with any software made available by Cloudflare in connection with such services, including software development kits and Cloudflare‚Äôs application programming interfaces (‚Äú APIs ‚Äù) made available in connection with such cloud-based solutions (collectively, the ‚Äú Services ‚Äù). Your use of the Services is subject to the applicable provisions in the Service-Specific Terms , the Domain Registration Agreement (for Registrar customers), and any applicable plan or product limits, disclaimers, or other terms presented to you on our website or documentation , each of which are incorporated by reference into the Agreement. \n\n## 2. Services \n\n## 2.1 Access to Services \n Subject to your compliance with this Agreement (including, without limitation, all payment obligations), Cloudflare hereby grants to you a limited, revocable, non-exclusive, non-transferable, and non-sublicensable (except to Affiliates) right, to access and use the Services. If you are agreeing to this Agreement on behalf of an Entity, such Entity‚Äôs Affiliates may also access and use the Services provided that such Affiliates agree to be bound by the terms of this Agreement, and the Entity remain fully liable for such Affiliates‚Äô actions and omissions in connection with this Agreement as if the Entity had performed such acts and omissions itself. ‚ÄúAffiliate‚Äù means any means an entity which, directly or indirectly, owns or controls, is owned or is controlled by or is under common ownership or control with a party, where ‚Äúcontrol‚Äù means the power to direct the management or affairs of an entity, and ‚Äúownership‚Äù means the beneficial ownership of 50% (or, if the applicable jurisdiction does not allow majority ownership, the maximum amount permitted under such law) or more of the voting equity securities or other equivalent voting interests of the entity. \n\n## 2.2 Use of Services \n\n## 2.2.1 Restrictions \n Unless otherwise expressly permitted in writing by Cloudflare, you will not and you have no right to: (a) rent, lease, loan, export, or sell access to the Services to any third party, or sign up for the Services on behalf of a third party; (b) interfere with, disrupt, alter, or modify the Services or any part thereof, or create an undue burden on the Services or the networks (including Cloudflare‚Äôs peering partners‚Äô networks) or services connected to the Services, including, but not limited to, causing (whether directly or indirectly) traffic for your Cloudflare-proxied domain to be sent to an IP address that was not assigned by Cloudflare for the domain; (c) access or use the Services in a manner that violates or is intended to circumvent Service-specific usage limits, quotas, or other restrictions set forth in the Agreement; (d) utilize any framing techniques to enclose any Cloudflare trademark, logo, service mark, or other trade dress (‚Äú Cloudflare Marks ‚Äù) or Materials (defined below) or use any meta tags or other ‚Äúhidden text‚Äù utilizing the Cloudflare Marks or Materials without Cloudflare‚Äôs written consent (e) introduce software or automated agents or scripts into the Services so as to produce multiple accounts, generate automated searches, requests or queries, or to strip or mine data from the Services; (f) cover or obscure any page or part of the Services via HTML/CSS, scripting, or any other means; (g) reverse engineer the Services; (h) process or collect personal or business credit card information on any web property that is receiving Free Services (as defined below); (i) use the Services to store or transmit any ‚Äúprotected health information‚Äù as that term is defined in 45 C.F.R. 160.103 without Cloudflare‚Äôs written consent; or (j) use the Services to provide a virtual private network or other similar proxy services. \n\n## 2.2.2 Benchmarking \n You are permitted to perform benchmark tests of our Services. If you disclose results of any benchmark tests of our Services performed by you or a third party under your direction, you (i) will include in any disclosure or otherwise make available all information necessary to replicate such benchmark tests, and (ii) agree that we may perform and disclose the results of benchmark tests of your services, irrespective of any restrictions on benchmarks in the terms governing your services. \n\n## 2.3 Credentials \n You are responsible for maintaining the confidentiality of all usernames, passwords, and other access credentials (such as API tokens and OAuth credentials) created by or assigned to you (‚Äú Credentials ‚Äù) and are solely responsible for all activities that occur with such Credentials. If you permit third parties to access your Cloudflare account (e.g., by providing your API token or using OAuth), you do so at your sole risk and Cloudflare will not be directly or indirectly responsible or liable to you in any manner, for any harms, damages, loss, lost profits, special or consequential damages, or claims, arising out of or in connection with such permission. You acknowledge that by permitting a third party to access your Cloudflare account, the third party may obtain, modify, or delete your account data and settings. You agree to notify Cloudflare promptly of any actual or suspected unauthorized use of any Credentials. Cloudflare reserves the right to terminate any Credentials that Cloudflare reasonably determines may have been accessed or used by an unauthorized third party and will provide immediate notice of such to you. For your added security, we strongly encourage you to enable two-factor authentication in conjunction with your Credentials. \n\n## 2.4 Subscription Terms, Renewals, and Cancellations \n Services that are provided to you as Paid Services may be provided to you on a subscription basis for the length of term that you specified during the initial sign-up process or your first use (‚Äú Subscription Term ‚Äù). All of your subscriptions to Paid Services with a Subscription Term will automatically renew for periods equal to your initial Subscription Term, and you will be charged at our then-current rates unless you cancel your subscription through the Services‚Äô account dashboard prior to your next scheduled billing date. \n\n## 2.5 Customer Content and Network Data \n\n## 2.5.1 \n You and your End Users (as such term is defined in the Privacy Policy) will retain all right, title and interest in and to any data, content, code, video, images or other materials of any type that you or your End Users transmit to or through the Services (collectively, ‚Äú Customer Content ‚Äù) in the form provided to Cloudflare. Subject to the terms of this Agreement, you hereby grant us a non-exclusive, fully sublicensable, worldwide, royalty-free right to collect, use, copy, store, transmit, modify and create derivative works of Customer Content, in each case to the extent necessary to provide the Services. \n\n## 2.5.2 \n You must obtain all necessary rights, releases and permissions to provide Customer Content to Cloudflare, and Customer Content and its transfer must not violate any applicable local, state, federal and international laws and regulations (‚Äú Laws ‚Äù) (including without limitation those relating to export control or electronic communications). Other than our security obligations under Section 6.2 (Security) , we assume no responsibility or liability for Customer Content, and you will be solely responsible for the consequences of using, disclosing, storing, transferring or transmitting Customer Content. \n\n## 2.5.3 \n Cloudflare may modify certain components of Customer Content on or transmitted to or from your Internet Properties or scan your infrastructure and related configurations to enhance your website‚Äôs performance or security or the functionality of the Services. For example, depending on the Services you select or the Apps that you enable, Cloudflare may: (i) intercept requests determined to be threats and take actions, such as, presenting them with a challenge page, dropping the request, presenting alternative content, redirecting and other similar measures; (ii) add cookies to your domain to track visitors, such as those who have successfully passed the CAPTCHA on a challenge page; (iii) add scripts to your pages to perform additional performance tracking; (iv) add firewall rules to your website; (v) scan your infrastructure to identify supported protocols in order to enhance your Internet Properties‚Äô security; and (vi) make other changes to increase the performance, security, or analytic capabilities of your website. Cloudflare will make it clear whenever a feature will materially modify Customer Content and, whenever possible, provide you a mechanism to allow you to disable the feature. \n\n## 2.5.4 \n By transmitting Customer Content to or through the Services, you represent and warrant that Customer Content does not infringe, violate, or misappropriate any third-party right, including any copyright, trademark, patent, trade secret, moral right, privacy right, right of publicity, or any other intellectual property or proprietary right. \n\n## 2.5.5 \n Cloudflare retains all right, title, and interest in all models, observations, reports, analyses, statistics, databases and other information created, compiled, analyzed, generated or derived by Cloudflare from server, network or traffic data generated by Cloudflare in the course of providing the Service (‚Äú Network Data ‚Äù), and shall have the right to use Network Data for purposes of providing, maintaining, developing, and improving its Services. Cloudflare may monitor and inspect the traffic on the Cloudflare network, including any related logs, as necessary to perform the Services or protect the security or integrity of Cloudflare‚Äôs network. To the extent the Network Data includes any Personal Data (as defined below), Cloudflare will handle such Personal Data in compliance with applicable data protection laws. \n\n## 2.6 Free & Trial Services \n We may offer free or trial versions of the Services (‚Äú Free Services ‚Äù) from time to time. With respect to each such Free Service, we will make each such Free Service available to you free of charge until the earlier of (a) the end of the free trial period (if applicable) for which you registered to use the Free Service; (b) the start date of your Subscription Term for the Paid Services version of such Free Service; or (c) termination of the Free Service by Cloudflare in our sole discretion. We will have no liability for any harm or damage arising out of or in connection with any Free Services. \n\n## 2.7 Acceptable Use \n You agree not to, and not to allow third parties to use the Services to: (a) falsely imply any sponsorship or association with Cloudflare; (b) post, transmit, store or link to any files, materials, data, text, audio, video, images or other content that infringe on any person‚Äôs intellectual property rights or that are otherwise unlawful; (c) distribute viruses, worms, time bombs, Trojan horses, or other malicious code, files, scripts, software agents and programs; (d) facilitate phishing, spamming, or other technical abuse; or (e) engage in any activities that are illegal, including disseminating, promoting or facilitating child sexual exploitation and abuse or human trafficking. You can find more information on our approach to abuse and reporting practices here . \n\n## 3. Third-Party Products and Services \n You may access or use, at your sole discretion, certain third-party products and services that interoperate with the Services ( ‚ÄúThird-Party Products‚Äù ), including, but not limited to, third-party apps provided on Cloudflare Apps, third-party service integrations made available through the Cloudflare dashboard or APIs, and third-party products or services that you authorize to access your Cloudflare account using OAuth or other Credentials. Cloudflare does not make any representations, warranties, or guarantees regarding the Third-Party Products and the providers thereof, including, but not limited to, as to their continued availability, security, and integrity. If Cloudflare makes a Third-Party Product available to you, it is on an ‚ÄúAS IS‚Äù and ‚ÄúAS AVAILABLE‚Äù basis, and Cloudflare may cease providing it without entitling you to any refund, credit, or other compensation. Each Third-Party Product is governed by the terms of service, end user license agreement, privacy policies, and/or any other applicable terms and policies of the third party provider. Your access or use of a Third-Party Product is solely between you and the applicable Third-Party Product provider. Cloudflare will not be directly or indirectly responsible or liable to you in any manner, for any harms, damages, loss, lost profits, special or consequential damages, or claims, arising out of or in connection with the installation of, use of, or reliance on the performance of any of the Third-Party Products. Further information related to the apps available via Cloudflare Apps is available on the Cloudflare Apps page located here . \n\n## 4. Billing \n\n## 4.1 Recurring Billing \n In order to access those Services for which we require a fee (‚Äú Paid Services ‚Äù) you will be required to provide Cloudflare with your credit card information (‚Äú Payment Method ‚Äù). By providing a Payment Method you are authorizing us to charge your Payment Method on a monthly, annual, or pay-as-you-go basis, or as otherwise applicable for the fees associated with the Paid Services that you use. Any Payment Method that you provide us must be valid, and kept current by you during the Subscription Term. By providing us with a Payment Method, you represent and warrant that you are authorized to use such Payment Method. Cloudflare will begin billing your Payment Method for the Paid Services on the day that you begin using such Paid Services, regardless of whether you have fully configured the Paid Services as of that date. For Services subject to usage-based billing, we may initiate a pre-authorization on your credit card for the accrued fees at any point during a billing period. This hold will be removed when the time limit for the hold is up. To guard against fraud, you also authorize us to charge a nominal sum to your Payment Method, which we will reverse after 3-7 business days. \n\n## 4.2 Price Changes \n We reserve the right to change the fees that we charge for the Service, at any time in our sole discretion, provided that we give you at least thirty (30) days‚Äô prior notice of such changes. Unless otherwise specified in such notice to you, any changes to the subscription fees will take effect in the billing period immediately following our notice to you. \n\n## 4.3 No Refunds \n FEES ARE NONREFUNDABLE. YOU WILL BE BILLED IN FULL FOR THE SUBSCRIPTION TERM IN WHICH YOU CANCEL AND NO REFUNDS WILL BE PROVIDED FOR THE UNUSED PORTION OF SUCH SUBSCRIPTION TERM. Following any cancellation, however, you will continue to have access to the Paid Services through the end of your current Subscription Term (except with respect to Services subject to usage-based billing). We may, in our sole discretion, provide a refund, discount, or credit (‚Äú Credits ‚Äù) to you in a specific instance, however the provision of Credits in a specific instance does not entitle you to Credits in the future for similar instances or obligate us to provide additional Credits. \n\n## 4.4 Taxes \n Unless otherwise stated, our charges do not include any taxes, levies, duties or similar governmental assessments, including value-added, sales, use or withholding taxes accessible by any local, state, provincial or foreign jurisdiction (collectively ‚Äú Taxes ‚Äù). You are responsible for paying Taxes, except those assessable against Cloudflare as measured by our net income. Unless you provide us with evidence of an exemption, we will invoice you for such Taxes if we believe we have a legal obligation to do so and you agree to pay such Taxes if so invoiced. \n\n## 5. Beta Services \n From time to time, we may make non-production Services (‚Äú Beta Services ‚Äù) that are under development available to you. You may access these Beta Services at your sole discretion. Beta Services are intended for testing purposes only, and may be subject to additional terms that will be presented to you at the time of sign-up or first use. Cloudflare is not obligated to provide you with support for the Beta Services or correct any bugs, defects, or errors in the Beta Services. Unless otherwise stated, any Beta Services testing period will expire upon the earlier of one year from the testing start date or the date that a version of the Beta Services becomes generally available without the applicable Beta Services designation. We may discontinue, suspend, or remove Beta Services (including any of Customer Content stored as part of the Beta Services) or your access thereto at any time in our sole discretion and may never make them generally available. In the event that a version of a Beta Service becomes generally available without the applicable Beta Service designation, you may be permitted to continue using the generally available Services subject to additional terms as provided in the Agreement. You understand that any information you obtain regarding Beta Services is Cloudflare confidential information, and you agree not to disclose such information until a Beta Service becomes generally available, except as required by law, and to only use such information in connection with your use of the Beta Services. Notwithstanding Section 12 , we will have no liability for any harm or damage arising out of or in connection with any Beta Services. \n\n## 6. Data Processing and Security \n\n## 6.1 Data Processing \n If Customer Content includes the personal data of European data subjects as those terms are defined by EU and UK Data Protection Laws and all data defined as ‚Äòpersonal information‚Äô under the California Consumer Privacy Act (‚Äú CCPA ‚Äù) (collectively, ‚Äú Personal Data ‚Äù), then Cloudflare is a data processor or sub-processor, as applicable, and Cloudflare will handle such Personal Data in compliance with Cloudflare‚Äôs Data Processing Addendum (‚Äú Data Processing Addendum ‚Äù), which is hereby incorporated by reference into this Agreement. ‚ÄúEU and UK Data Protection Laws‚Äù means all Laws and regulations of the European Union, the European Economic Area, their member states, Switzerland, and the United Kingdom, applicable to the processing of Personal Data including (where applicable), the Swiss Federal Act on Data Protection, the UK Data Protection Act and the General Data Protection Regulation (Regulation (EU) 2016/679 of the European Parliament and of the Council of 27 April 2016 on the protection of natural persons with regard to the processing of personal data and on the free movement of such data). \n\n## 6.2 Security \n We implement security procedures to help protect Customer Content from security threats. However, you understand that your use of the Service necessarily involves transmission of Customer Content over networks that are not owned, operated or controlled by us, and we are not responsible for any of Customer Content that is lost, altered, intercepted or stored across such networks. We cannot guarantee that our security procedures will be error-free, that transmissions of Customer Content will always be secure or that unauthorized third parties will never be able to defeat our security measures or those of our third party service providers. \n\n## 7. Compliance \n\n## 7.1 Compliance with Laws \n You will comply with all Laws. You agree that you are responsible for determining whether use of the Service will satisfy your individual compliance obligations. You will not use the Service for any reason if you or any party that owns or controls you (if you are a legal entity), are subject to sanctions or otherwise designated on any list of prohibited or restricted parties, including but not limited to the lists maintained by the U.S. Government (e.g., the Specially Designated Nationals List and Foreign Sanctions Evaders List of the U.S. Department of Treasury, and the Entity List of the U.S. Department of Commerce), the European Union or its Member States, the United Kingdom, or other applicable government authority. You will not use the Service to export or re-export any information or technology to any country, individual, or entity to which such export or re-export is restricted or prohibited. You further acknowledge that performance of the Agreement may be subject to U.S. and non-U.S. anti-corruption and anti-bribery Laws, rules, and regulations. You therefore covenants that you will make no payments, including charitable donations, of money or anything of value, nor will such be offered, promised or paid, directly or indirectly, to any person or entity (a) to improperly influence the acts of such person or entity, (b) to induce such person or entity to use its influence with a government to obtain or retain business, or (c) to gain an improper advantage in connection with any business venture or contract in which Cloudflare is a participant. \n\n## 7.2 Government Restrictions \n If you are an agency, department or entity of the United States Government (‚Äú Government ‚Äù), you understands and agrees, that (a) your rights to use, reproduce, release, modify or disclose the Services, or any part thereof, is restricted in accordance with Federal Acquisition Regulation (‚Äú FAR ‚Äù) 12.212 for civilian agencies and Defense Federal Acquisition Regulation Supplement (‚Äú DFARS ‚Äù) 227.7202 for military agencies, (b) the Services consists of ‚Äúcommercial computer software‚Äù and ‚Äúcommercial computer software documentation,‚Äù respectively, as defined in FAR Section 12.212 and DFARS Section 227.7202, or their successor provisions, as applicable and (c) use of the Services by any Government agency, department or other agency of the Government may further restricted as set forth in the Agreement. \n\n## 8. Termination of Use; Discontinuation and Modification of the Service \n You will lose your license to use the Service if you violate any provision of this Agreement. Cloudflare reserves the right to investigate violations of this Agreement. We reserve the right to disable or limit your access to or use of the Service (\" Suspend \") or terminate your user account upon receiving any number of DMCA notifications from content owners regarding your website(s), or upon learning through other means that you are a repeat infringer. We may at our sole discretion terminate your user account or Suspend or terminate your use or access to the Service at any time, with or without notice for any reason or no reason at all. If we determine you have breached Section 2.2 or 2.7 , we may immediately Suspend or terminate all or part of your use of the Services, or limit End User access to certain of your resources through the Services. We also reserve the right to modify or discontinue the Service at any time (including, without limitation, by limiting or discontinuing certain features of the Service) without notice to you. We will have no liability whatsoever on account of any change to the Service or any suspension or termination of your access to or use of the Service. You may terminate your account at any time through the Service‚Äôs account dashboard. \n\n## 9. Ownership; Proprietary Rights \n The visual interfaces, graphics, design, compilation, information, data, computer code (including source code or object code), products, software, services, and all other elements of the Service (the ‚Äú Materials ‚Äù) provided by Cloudflare are protected by all relevant intellectual property and proprietary rights and applicable laws. All Materials contained in the Service are the property of Cloudflare or our third-party licensors. Except as expressly authorized by Cloudflare you may not make use of the Materials. Cloudflare reserves all rights to the Materials not granted expressly in this Agreement. You hereby grant Cloudflare a non-exclusive, royalty-free, worldwide, transferable, irrevocable, sublicensable, and perpetual license to use or incorporate into the Services any suggestions, enhancement requests, recommendations, corrections, or other feedback ( ‚ÄúFeedback‚Äù ) you provide to Cloudflare relating to the Services. \n\n## 10. Indemnification \n\n## 10.1 By Cloudflare \n Cloudflare will defend you against any third party claim brought against you, to the extent that such claim is based on an allegation that a Paid Service, when used as authorized under this Agreement, infringes a United States or European Union patent or registered copyright (a \" Claim \"), and we will indemnify you against any damages and costs (including reasonable legal fees) finally awarded by a court of competent jurisdiction attributable to such a Claim or agreed to settlement by Cloudflare. If any portion of a Paid Service becomes, or in Cloudflare‚Äôs opinion is likely to become, the subject of an infringement claim, Cloudflare may, at Cloudflare‚Äôs option: (a) procure the right for you to continue using the Paid Service; (b) replace the Paid Service with non-infringing services which do not materially impair the functionality of the Paid Service; (c) modify the Paid Service so that it becomes non-infringing; or (d) terminate the Paid Service and refund any pre-paid subscription fees covering the remainder of the Subscription Term, and upon such termination, you will immediately cease all use of the Paid Service. Cloudflare will have no obligation under this Section 10 or otherwise with respect to any infringement claim based upon: (w) any use of a Paid Service not in accordance with this Agreement or the applicable Cloudflare documentation; any use of a Paid Service in combination with third party products or services not supplied by Cloudflare; or (z) any modification of a Paid Service by any person other than Cloudflare or its authorized agents. THIS SUBSECTION SETS FORTH CLOUDFLARE‚ÄôS SOLE AND EXCLUSIVE OBLIGATIONS, AND YOUR SOLE AND EXCLUSIVE REMEDIES, WITH RESPECT TO CLAIMS OF INFRINGEMENT OF THIRD PARTY INTELLECTUAL PROPERTY RIGHTS. \n\n## 10.2 By You \n You agree that you will be responsible for your use of the Service, and you agree to defend, indemnify, and hold harmless Cloudflare and its officers, directors, employees, consultants, Affiliates (as defined above), subsidiaries and agents (collectively, the \" Cloudflare Entities \") from and against any and all claims, liabilities, damages, losses, and expenses, including reasonable attorneys&#x27; fees and costs, arising out of or in any way connected with your access to, use of, or alleged use of the Service; (ii) your violation of this Agreement or any representation, warranty, or agreements referenced herein, or any applicable law or regulation; (iii) your violation of any third-party right, including without limitation any intellectual property right, publicity, confidentiality, property or privacy right; or (iv) any disputes or issues between you and any third party. We reserve the right, at our own expense, to assume the exclusive defense and control of any matter otherwise subject to indemnification by you (and without limiting your indemnification obligations with respect to such matter), and in such case, you agree to cooperate with our defense of such claim. \n\n## 11. Disclaimers; No Warranties \n THE SERVICE ARE MADE AVAILABLE TO YOU ON AN \"AS IS\" AND \"AS AVAILABLE\" BASIS, WITH THE EXPRESS UNDERSTANDING THAT THE CLOUDFLARE ENTITIES HAVE NO OBLIGATION TO MONITOR, CONTROL, OR VET USER CONTENT OR DATA. AS SUCH, YOUR USE OF THE SERVICES IS AT YOUR OWN DISCRETION AND RISK. THE CLOUDFLARE ENTITIES MAKE NO CLAIMS OR PROMISES ABOUT THE QUALITY, ACCURACY, OR RELIABILITY OF THE SERVICES, ITS SAFETY OR SECURITY, OR THE SERVICES CONTENT. ACCORDINGLY, THE CLOUDFLARE ENTITIES ARE NOT LIABLE TO YOU FOR ANY LOSS OR DAMAGE THAT MIGHT ARISE, FOR EXAMPLE, FROM THE SERVICE&#x27;S INOPERABILITY, UNAVAILABILITY OR SECURITY VULNERABILITIES. THE CLOUDFLARE ENTITIES EXPRESSLY DISCLAIM ALL WARRANTIES, WHETHER EXPRESS OR IMPLIED, INCLUDING IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT. SOME JURISDICTIONS MAY PROHIBIT A DISCLAIMER OF WARRANTIES AND YOU MAY HAVE OTHER RIGHTS THAT VARY FROM JURISDICTION TO JURISDICTION. \n\n## 12. Limitation of Liability \n IN NO EVENT WILL THE CLOUDFLARE ENTITIES BE LIABLE TO YOU OR ANY THIRD PARTY FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL OR PUNITIVE DAMAGES ARISING OUT OF OR RELATING TO YOUR ACCESS TO OR USE OF, OR YOUR INABILITY TO ACCESS OR USE, THE SERVICES OR ANY MATERIALS OR CONTENT ON THE SERVICES, WHETHER BASED ON WARRANTY, CONTRACT, TORT (INCLUDING NEGLIGENCE), STATUTE OR ANY OTHER LEGAL THEORY, WHETHER OR NOT THE CLOUDFLARE ENTITIES HAVE BEEN INFORMED OF THE POSSIBILITY OF SUCH DAMAGE. YOU AGREE THAT THE AGGREGATE LIABILITY OF THE CLOUDFLARE ENTITIES TO YOU FOR ANY AND ALL CLAIMS ARISING OUT OF RELATING TO THE USE OF OR ANY INABILITY TO USE THE SERVICES (INCLUDING ANY MATERIALS OR CONTENT AVAILABLE THROUGH THE SERVICES) OR OTHERWISE UNDER THIS AGREEMENT, WHETHER IN CONTRACT, TORT, OR OTHERWISE, IS LIMITED TO THE AMOUNTS YOU HAVE PAID TO CLOUDFLARE TO ACCESS AND USE THE SERVICE IN THE 12 MONTHS PRIOR TO THE CLAIM. SOME JURISDICTIONS DO NOT ALLOW THE EXCLUSION OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES. ACCORDINGLY, THE ABOVE LIMITATION MAY NOT APPLY TO YOU. \n\n## 13. Governing Law \n This Agreement will be governed by the laws of the State of California without regard to conflict of law principles. To the extent that any lawsuit or court proceeding is permitted hereunder, you and Cloudflare agree to submit to the personal and exclusive jurisdiction of the state and federal courts located within San Francisco County, California for the purpose of litigating all such disputes. \n\n## 14. Changes to this Agreement \n Cloudflare reserves the right to make modifications to this Agreement at any time. If a revision materially alters your rights we will use reasonable efforts to contact you, including sending a notification to the e-mail address(es) associated with your account. In some instances, such as with Free Services, you may be required to indicate your consent to the revised terms in order to continue accessing the Service. Unless otherwise specified, any modifications to this Agreement will take effect at the start of Subscription Term following the notice. If you do not agree with the revised terms, your sole and exclusive remedy will be not to renew your Subscription. \n\n## 15. Versions \n The authoritative version of this document is available at: www.cloudflare.com/terms . While translations of this document may be provided in multiple languages for your convenience, the English language version hosted at the link above is binding for all users of the Service. \n\n## 16. General \n This Agreement constitutes the entire and exclusive understanding and agreement between you and Cloudflare regarding your use of and access to the Service. You may not assign or transfer this Agreement or your rights hereunder, in whole or in part, by operation of law or otherwise, without our prior written consent. We may assign this Agreement at any time without notice. The failure to require performance of any provision will not affect our right to require performance at any time thereafter, nor will a waiver of any breach or default of this Agreement or any provision of this Agreement constitute a waiver of any subsequent breach or default or a waiver of the provision itself. Use of section headers in this Subscription Agreement is for convenience only and will not have any impact on the interpretation of particular provisions. In the event that any part of this Agreement is held to be invalid or unenforceable, the unenforceable part will be given effect to the greatest extent possible and the remaining parts will remain in full force and effect. Upon termination of this Agreement, any provision that by its nature or express terms should survive will survive such termination or expiration, including, but not limited to, Sections 2.5.1 and Sections 9 through 20 . \n\n## 17. Dispute Resolution and Arbitration \n\n## 17.1 Generally \n In the interest of resolving disputes between you and Cloudflare in the most expedient and cost effective manner, you and Cloudflare agree that any and all disputes arising in connection with this Agreement will be resolved by binding arbitration. Arbitration is more informal than a lawsuit in court. Arbitration uses a neutral arbitrator instead of a judge or jury, may allow for more limited discovery than in court, and can be subject to very limited review by courts. Arbitrators can award the same damages and relief that a court can award. Our agreement to arbitrate disputes includes, but is not limited to all claims arising out of or relating to any aspect of this Agreement, whether based in contract, tort, statute, fraud, misrepresentation or any other legal theory, and regardless of whether the claims arise during or after the termination of this Agreement. YOU UNDERSTAND AND AGREE THAT, BY ENTERING INTO THESE TERMS, YOU AND CLOUDFLARE ARE EACH WAIVING THE RIGHT TO A TRIAL BY JURY OR TO PARTICIPATE IN A CLASS ACTION. \n\n## 17.2 Exceptions \n Notwithstanding Subsection 17.1 , we both agree that nothing herein will be deemed to waive, preclude, or otherwise limit either of our right to (i) bring an individual action in small claims court, (ii) pursue enforcement actions through applicable federal, state, or local agencies where such actions are available, (iii) seek injunctive relief in a court of law, or (iv) to file suit in a court of law to address intellectual property infringement claims. \n\n## 17.3 Arbitrator \n Any arbitration between you and Cloudflare will be governed by the Commercial Arbitration Rules and Mediation Procedures (\" AAA Rules \") of the American Arbitration Association (\" AAA \"), as modified by this Agreement, and will be administered by the AAA. The AAA Rules and filing forms are available online at www.adr.org, by calling the AAA at 1-800-778-7879. \n\n## 17.4 Notice; Process \n A party who intends to seek arbitration must first send a written notice of the dispute to the other, by certified mail or Federal Express (signature required), or in the event that we do not have a physical address on file for you, by electronic mail (\" Notice \"). Cloudflare&#x27;s address for Notice is: Cloudflare, Inc., 101 Townsend St., San Francisco, CA 94107. The Notice must (i) describe the nature and basis of the claim or dispute; and (ii) set forth the specific relief sought (\" Demand \"). We agree to use good faith efforts to resolve the claim directly, but if we do not reach an agreement to do so within 30 days after the Notice is received, you or Cloudflare may commence an arbitration proceeding. \n\n## 17.5 Fees \n Any arbitration hearings will take place at a location to be agreed upon in San Francisco, CA provided that if the claim is for $10,000 or less, you may choose whether the arbitration will be conducted (i) solely on the basis of documents submitted to the arbitrator; (ii) through a non-appearance based telephonic hearing; or (iii) by an in-person hearing as established by the AAA Rules in the county (or parish) of your billing address. If the arbitrator finds that either the substance of your claim or the relief sought in the Demand is frivolous or brought for an improper purpose (as measured by the standards set forth in Federal Rule of Civil Procedure 11(b)), then the payment of all fees will be governed by the AAA Rules. In such case, you agree to reimburse Cloudflare for all monies previously disbursed by it that are otherwise your obligation to pay under the AAA Rules. Regardless of the manner in which the arbitration is conducted, the arbitrator will issue a reasoned written decision sufficient to explain the essential findings and conclusions on which the decision and award, if any, are based. The arbitrator may make rulings and resolve disputes as to the payment and reimbursement of fees or expenses at any time during the proceeding and upon request from either party made within 14 days of the arbitrator‚Äôs ruling on the merits. \n\n## 17.6 No Class Actions \n YOU AND CLOUDFLARE AGREE THAT EACH MAY BRING CLAIMS AGAINST THE OTHER ONLY IN YOUR OR ITS INDIVIDUAL CAPACITY AND NOT AS A PLAINTIFF OR CLASS MEMBER IN ANY PURPORTED CLASS OR REPRESENTATIVE PROCEEDING. Further, unless both you and Cloudflare agree otherwise, the arbitrator may not consolidate more than one person‚Äôs claims, and may not otherwise preside over any form of a representative or class proceeding. \n\n## 17.7 Modifications \n In the event that Cloudflare makes any future change to this arbitration provision (other than a change to Cloudflare&#x27;s address for Notice), you may reject any such change by sending us written notice within 30 days of the change to Cloudflare&#x27;s address for Notice, in which case your account with Cloudflare will be immediately terminated and this arbitration provision, as in effect immediately prior to the amendments you reject will survive. \n\n## 17.8 Enforceability \n Notwithstanding Section 16 , if Subsection 17.1 is found to be unenforceable or if the entirety of this Section 17 is found to be unenforceable, then the entirety of this Section 17 will be null and void and, in such case, the parties agree that the exclusive jurisdiction and venue described in Section 13 will govern any action arising out of or related to this Agreement. \n\n## 18. Regional Terms \n\n## 18.1 European Union \n If you (1) are an individual living in the European Union or are a corporation headquartered in the European Union and (2) have a billing address in the European Union, then the Data Act Addendum, available at https://www.cloudflare.com/legal/data-act-addendum/ forms a part of this Agreement. \n\n## 19. Consent to Electronic Communications \n By using the Service, you consent to receiving certain electronic communications from us as further described in our Privacy Policy. Please read our Privacy Policy to learn more about your choices regarding our electronic communications practices. You agree that any notices, agreements, disclosures, or other communications that we send to you electronically will satisfy any legal communication requirements, including that such communications be in writing. \n\n## 20. Contact Information \n The Service is offered by Cloudflare, Inc., located at 101 Townsend St., San Francisco, California 94107. You may contact us by sending correspondence to the foregoing address or by logging into your account at https://dash.cloudflare.com/?to=/:account/support . If you are a California resident, you may have this Agreement mailed to you electronically by sending a letter to the foregoing address with your electronic mail address and a request for this Agreement. \n\n## Legal\n Website Terms of Use Self-Serve Subscription Agreement Service-Specific Terms Privacy Policy Cookie Policy Trust & Safety Transparency Report Domain Registration Agreement Modern Slavery Act Statement Third Party Code of Conduct Candidate Privacy Policy \n\n## Have Questions?\n If you have questions about these terms or anything else about Cloudflare, please don&#x27;t hesitate to contact us: +1 (650) 319-8930 Cloudflare, Inc. 101 Townsend St, San Francisco, CA 94107 USA GETTING STARTED \n‚Ä¢ Free plans \n‚Ä¢ Small business plans \n‚Ä¢ For enterprises \n‚Ä¢ Get a recommendation \n‚Ä¢ Request a demo \n‚Ä¢ Contact sales SOLUTIONS \n‚Ä¢ Connectivity cloud \n‚Ä¢ Application services \n‚Ä¢ SASE and workspace security \n‚Ä¢ Network services \n‚Ä¢ Developer platform SUPPORT \n‚Ä¢ Help center \n‚Ä¢ Customer support \n‚Ä¢ Community forum \n‚Ä¢ Developers Discord \n‚Ä¢ Lost account access? \n‚Ä¢ Cloudflare status COMPLIANCE \n‚Ä¢ Compliance resources \n‚Ä¢ Trust \n‚Ä¢ GDPR \n‚Ä¢ Responsible AI \n‚Ä¢ Transparency report \n‚Ä¢ Report abuse PUBLIC INTEREST \n‚Ä¢ Project Galileo \n‚Ä¢ Athenian Project \n‚Ä¢ Cloudflare for Campaigns \n‚Ä¢ Project Fairshot COMPANY \n‚Ä¢ About Cloudflare \n‚Ä¢ Network map \n‚Ä¢ Our team \n‚Ä¢ Logos & press kit \n‚Ä¢ Diversity, equity, & inclusion \n‚Ä¢ Impact/ESG ¬© 2026 Cloudflare, Inc. Privacy Policy Terms of Use Report Security Issues Cookie Preferences Trademark",
      "chunk_ids": [],
      "metadata": {
        "source_type": "tos",
        "source_name": "Cloudflare",
        "url": "https://www.cloudflare.com/terms/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "cloudflare",
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "termination",
        "tos",
        "warranty"
      ],
      "content_hash": "ce13ba7b641ac4fa",
      "size_bytes": 41764,
      "created_at": "2026-01-02T20:42:23.533411"
    },
    {
      "doc_id": "legal_tos_digitalocean",
      "source": "online",
      "category": "legal",
      "domain": "legal_tos",
      "file_path": "https://www.digitalocean.com/legal/terms-of-service-agreement",
      "content": "‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ Legal - Terms of Service Agreement \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n\n## Terms of Service Agreement\n Last Updated on November 25, 2025 \n\n## Introduction \n\n Welcome to DigitalOcean‚Äôs Terms of Service! The first portion of our Terms of Service is an introduction, which is structured like an FAQ and lays out some high-level concepts before diving into other terms. \n\n## What documents make up the TOS?\n\n We refer to the Terms of Service as the ‚ÄúTOS‚Äù \n This page lays out the core of our TOS, but we also have other contractual documents that you can think of as additional terms for specific topics. Legally speaking, these other documents are incorporated by reference as if they were written here and form part of the overall TOS. Therefore, you should also review these other documents, which can be found at the links below: \n \n\n‚Ä¢ Data Processing Agreement , which outlines the terms of data processing on your behalf through our Services \n\n‚Ä¢ Acceptable Use Policy (the ‚Äú AUP ‚Äù), which outlines prohibited uses of our Services \n\n‚Ä¢ Privacy Policy , which outlines how we collect, use, and share data in our Websites and Services \n\n‚Ä¢ Marketplace Terms of Service , which outlines the terms for vendors in the DigitalOcean Marketplace \n\n‚Ä¢ Promotional Credit Terms , which outline the terms of any credits we may offer or provide \n \n\n## Whom does this TOS apply to?\n\n When we refer to ‚ÄúDigitalOcean‚Äù or we use pronouns like ‚Äúwe‚Äù , ‚Äúus‚Äù or ‚Äúour‚Äù , we are referring to DigitalOcean, LLC as well as its parents, affiliates and subsidiaries. \n When we refer to the ‚ÄúUser‚Äù , we are talking about you , and we will also use words like ‚Äúyou‚Äù and ‚Äúyour‚Äù to refer to you. Who ‚Äúyou‚Äù are can get more complicated if you are using our services on behalf of a company, organization, or other entity. In that case, you are representing to us that you have the authority to bind your company, organization, other entity to this TOS and that you agree to be legally bound by this TOS on behalf of such entity (and ‚Äú User ‚Äù, ‚Äú you ‚Äù, and ‚Äú your ‚Äù then refer to such entity). If you aren‚Äôt sure what this means or whether you are authorized to bind your company, organization, or entity to this contract, you should ask others in your organization to get clarification about authority.** \n\n## What is the TOS?\n\n This TOS is a binding contract between you and DigitalOcean, and covers all of the offerings, websites, products, services, features, content, applications and other things we offer to users like you. \n We will periodically differentiate between our websites such as digitalocean.com and cloudways.com (which we will refer to collectively as the ‚ÄúWebsites‚Äù ) and all of our other services, such as our cloud infrastructure and other paid services (which we will refer to collectively as the ‚ÄúServices‚Äù ). \n As you will see later in the TOS, Section 3 (Website Terms) is specific to your use of the Websites and Section 4 is specific to your use of the Services. \n\n## When does this TOS apply to me?\n\n Now that we have some common language, we want to ensure you understand when and how the TOS applies. \n First and foremost, you must understand that this is a binding legal contract that is required to use our Websites and Services. As such, you may only use our Websites and Services if you agree that you have read, understood, and consent to be bound by this TOS. \n If you sign up for Services or create an account through our Websites, this TOS takes effect when you click ‚ÄúI accept‚Äù or other functionality indicating your acceptance of its terms. If you purchase Services through a separate written contract, this TOS is incorporated into that contract, whether it is called out or not. Regardless of these other methods, when you access or use our Websites and Services, this TOS applies and is legally binding on you and to your access and use. These are common examples, and this paragraph does not necessarily include all the other ways you can become bound to this TOS. \n\n## What happens with disputes under this TOS?\n\n One requirement of our TOS is that you must agree to resolve disputes arising under this TOS through binding arbitration directly between you and DigitalOcean. In arbitration, a neutral arbitrator or panel of arbitrators will hear the arguments of both sides and decide on disputes in an expedient and cost-effective manner. You will still be able to pursue cases in court when those cases are for small claims, but all other claims will be subject to arbitration. \n You should understand that this means neither you nor DigitalOcean will have the opportunity to resolve some disputes in court before a judge or jury. You will be unable to pursue claims in a conventional trial and will not be able to participate in a court-based class action or similar proceeding. \n\n## Terms & Conditions of the TOS \n\n## 1. Eligibility & Registration \n\n 1.1 Before you use our Websites and Services, you must ensure that such use is in compliance with all laws, rules and regulations applicable to you. Your right to access the Websites and Services is revoked to the extent your use thereof is prohibited or to the extent our provision thereof conflicts with any applicable law, rule, or regulation. You are responsible for making these determinations before using the Websites and Services. \n 1.2 The Websites and Services are not targeted towards, nor intended for use by, anyone under the age of 18. By using the Websites and Services, you represent and warrant to us that: (a) you are 18 years of age or older; or (b) you otherwise have sufficient legal consent, permission and capacity to use the Websites and Services in applicable jurisdiction(s) as determined by you. \n 1.3 To access the Services and some features of the Websites, you must register for an account ( ‚ÄúAccount‚Äù ). When you register for your Account, you may be required to provide us with some information about yourself, such as your name, email address, and a valid form of payment, and you may also provide optional information about yourself on a voluntary basis. Account information, and our use and disclosure thereof, is subject to the Privacy Policy and Data Processing Agreement . \n 1.4 Changes to the Services and Websites. We may change or discontinue any of the Services or the Websites at any time at our sole discretion. We will endeavor to provide as much prior notice as is reasonably practicable under the circumstances, but in no event will DigitalOcean be obligated to provide notice under this Section if the discontinuation is necessary to (a) address an emergency, or risk of harm to the Services, Websites, or DigitalOcean, (b) respond to claims, litigation, or loss of license rights related to third party intellectual property rights, or (c) comply with law. \n\n## 2. DigitalOcean‚Äôs Proprietary Rights \n\n 2.1 As between you and DigitalOcean, the Websites and Services are owned and/or provided by DigitalOcean. The names, logos, trademarks, trade dress, arrangements, visual interfaces, graphics, design, compilation, information, data, computer code (including source code or object code), products, software, services, and all other elements of the Websites and Services ( ‚ÄúMaterials‚Äù ) that we provide are protected by intellectual property and other laws. All Materials included in the Websites and Services are the property of DigitalOcean or its third party licensors. You may only use the Websites and Services as expressly authorized by us and as set forth in this TOS, including the Service Terms applicable to select Services which are specified further below, or in product documentation and other materials we provide to you. You shall abide by and maintain all intellectual property notices, information, and restrictions contained in the Websites and Services. We reserve all rights to the Websites and Services not granted expressly in this TOS. \n 2.2 If you choose to provide input and suggestions regarding problems with or proposed modifications or improvements to the Websites and Services ( ‚ÄúFeedback‚Äù ) then you hereby grant to us an unrestricted, perpetual, irrevocable, non-exclusive, fully-paid, royalty-free right to exploit the Feedback in any manner and for any purpose, including to improve the Websites and Services and create other products and services. \n 2.3 You grant us permission to include your name, logos, and trademarks in our promotional and marketing materials and communications. \n 2.4 Some of the Materials provided by DigitalOcean are licensed under one or more open source, Creative Commons, or similar licenses (collectively, ‚ÄúOpen Source Licenses‚Äù ). Nothing in this TOS prevents, restricts, or is intended to prevent or restrict you from obtaining such materials under the applicable Open Source Licenses or to limit your use of such materials under those Open Source Licenses. \n 2.5 Subject to your complete and ongoing compliance with this TOS and our rights therein, DigitalOcean grants you a limited, non-exclusive, non-transferable, non-sublicensable, revocable license to access and use the Websites and/or Services as described in and subject to this TOS. \n\n## 3. DO Community & User Content \n\n 3.1 Certain features of the Websites (such as DigitalOcean Community ) permit you to submit or upload content, including messages, reviews, media, images, folders, data, text, and other types of works (your ‚ÄúUser Content‚Äù ) and to publish your User Content on our Websites. \n 3.2 By providing your User Content to or via the Websites, you grant DigitalOcean a worldwide, non-exclusive, royalty-free, fully paid right and license (with the right to sublicense) to host, store, transfer, display, perform, reproduce, modify for the purpose of formatting for display, and distribute your User Content, in whole or in part, in any media formats and through any media channels. \n 3.3 By providing your User Content via the Websites, you grant to our other users a non-exclusive license to access and use your User Content as permitted by this TOS and the functionality of the Websites. \n 3.4 You are solely responsible for your User Content, and you agree DigitalOcean is not and will not be in any way liable for your User Content. By providing your User Content via the Websites, you affirm, represent, and warrant that: \n \n\n‚Ä¢ \n you are the creator and owner of your User Content, or have the necessary licenses, rights, consents, and permissions to authorize DigitalOcean and users of the Websites to use and distribute your User Content as necessary to exercise the licenses granted by you in this TOS or otherwise required of you under this TOS; \n \n\n‚Ä¢ \n your User Content, and use of your User Content as contemplated by this TOS, does not and will not: (i) infringe, violate, or misappropriate any third party right, including any copyright, trademark, patent, trade secret, moral right, privacy right, right of publicity, or any other intellectual property or proprietary right; (ii) slander, defame, libel, or invade a right of privacy, publicity or other property right of any other person; or (iii) cause us to violate any law or regulation; and \n \n\n‚Ä¢ \n you will indemnify us for any third party claims arising from your User Content. \n \n \n 3.5 We are under no obligation to edit or control your User Content or the User Content of others, and will not be in any way responsible or liable for User Content. We may, however, at any time and without prior notice, screen, remove, edit, or block any of your User Content at our discretion. \n 3.6 By submitting or uploading your User Content, you also agree to abide by the terms of any Open Source Licenses that may apply to your User Content. \n\n## 4. Services Content \n\n 4.1 As part of our Services, we will process source code, files, software, processes, interfaces, data, text, settings, media, or other information for storage, hosting, or processing (your ‚ÄúServices Content‚Äù ). Services Content includes Listing Information and Vendor Offerings (as defined in the DigitalOcean Marketplace Terms and Conditions ). \n 4.2 Subject to this TOS, by providing your Services Content to or via the Services, you grant DigitalOcean a license to host, store, transfer, display, perform, reproduce, modify for the purpose of formatting for display, and distribute your Services Content solely for the purpose of providing the Services to you and for no other reason. For the avoidance of doubt, information included in resource identifiers, metadata, access controls, rules, usage policies, permissions, system logs, metrics, configurations, and similar items related to the management of DigitalOcean Services (‚ÄúUsage Data‚Äù) does not constitute your Services Content. DigitalOcean recommends that you do not include personally identifying, confidential, or sensitive information in these items. We may use Usage Data and other information about how you use and interact with the Services to provide, maintain, and improve our Services. \n 4.3 As between you and DigitalOcean, you retain any copyright and other ownership rights that you may hold in your Services Content. \n 4.4 Some of our Services allow third parties to access, use, or contribute to your Services Content, including via resale, your own products and services, or public-facing websites, applications, interfaces, and other manifestations of your Services Content. Such other users are collectively defined as your ‚ÄúEnd Users‚Äù for purposes of this TOS. For clarity, ‚ÄúEnd Users‚Äù in this context includes all such other users, regardless of whether they are intermediary parties, End Users of other End Users, or the like. You are responsible for your End Users‚Äô compliance with this TOS. \n 4.5 You are solely responsible for your Services Content, End Users and any activity by your End Users, and you agree DigitalOcean is not and will not be in any way liable for your Services Content, End Users and/or activity by your End Users. By providing your Services Content via the Services, you affirm, represent, and warrant that: \n \n\n‚Ä¢ \n Your Services Content, and your or your End Users‚Äô use of your Services Content, will not violate this TOS (including the AUP) or any applicable law, regulation, rule, or third party rights; \n \n\n‚Ä¢ \n You are solely responsible for the development, moderation, operation, maintenance, support and use of your Services Content, including when your Services Content is contributed by your End Users; \n \n\n‚Ä¢ \n Your Services Content, and your or your End Users‚Äô use of your Services Content, does not and will not: (i) infringe, violate, or misappropriate any third party right, including any copyright, trademark, patent, trade secret, moral right, privacy right, right of publicity, or any other intellectual property or proprietary right; (ii) slander, defame, libel, or invade a right of privacy, publicity or other property rights of any other person; or (iii) cause us to violate any law, regulation, rule, or rights of third parties; and \n \n\n‚Ä¢ \n Except for the specific Services provided to you under this TOS or other express contract, you are solely responsible for the technical operation of your Services Content, including on behalf of your End Users. \n \n \n 4.6 You are responsible for properly configuring and using the Services and taking your own steps to maintain appropriate security, protection, and backup of your Services Content, which may include the use of encryption technology to protect your Services Content from unauthorized access and routine archiving your Services Content. DigitalOcean does not promise to retain any preservations or backups of your Services Content. You are solely responsible for the integrity, preservation, and backup of your Services Content, regardless of whether your use of Services includes a DigitalOcean backup feature or functionality, and to the fullest extent permitted by law, DigitalOcean shall have no liability for any data loss, unavailability, or other consequences related to the foregoing. \n 4.7 When purchasing Services, you may specify the geographic region and jurisdiction in which your Services Content will be stored. You consent to the storage of your Services Content in, and transfer of your Services Content into, the geographic region and jurisdiction you select. Unless otherwise agreed in writing between you and DigitalOcean, you agree that DigitalOcean may transfer and store your Services Content in other geographic regions or jurisdictions at its sole discretion. You represent and warrant that such storage and transfer are adequately consented to by you and permissible pursuant to applicable laws, regulations, rules, and third party rights. \n 4.8 Service Terms. As used herein, ‚ÄúService Terms‚Äù mean the rights and restrictions for particular Services as may be updated by us from time to time. \n \n\n‚Ä¢ Universal Service Terms. The Service Terms below govern your access and use of all DigitalOcean Services: \n \n a. You may not transfer outside of the Services any software (or related documentation) you obtain from us or a third party licensor in connection with the Services without specific, written permission to do so. \n b. You must comply with current technical product documentation applicable to the Services available at https://docs.digitalocean.com/ (and any successor or related locations designated by us). \n c. You will ensure all information you provide to us is accurate, complete, and not misleading. \n d. From time to time, we may apply upgrades, patches, bug fixes, or other maintenance of the Services. We may provide you notice of such scheduled maintenance (except for emergency maintenance), and you agree to use reasonable efforts to comply with any maintenance requirements we notify you about. \n e. If you process the personal data of any third parties, including your End Users or other identifiable individuals in your use of a Service, you are responsible for providing legally adequate privacy notices and obtaining necessary consents for processing, storage, use, and transfer of such data, including providing any required notices and obtaining any required parental consent under the Children‚Äôs Online Privacy Protection Act (‚ÄúCOPPA‚Äù) or any other similar or different laws. You represent to us that you have provided all necessary privacy notices and obtained all necessary consents. You are responsible for processing such data in accordance with applicable law. \n f. Certain Services may incorporate generative AI features, some of which may be powered by the DigitalOcean GenAI Platform Service, that enable you to use prompts or inputs to generate outputs. The output you generate is considered your Services Content. Due to the nature of machine learning, output may not be unique across customers and the Services may generate the same or similar results across customers. Outputs constitute draft text or images, created based on probabilistic methods, which may not be accurate and should not be relied upon without confirmation that they meet your specific needs. Services incorporating generative AI features are not intended for use in, or in association with, the operation of any hazardous environments or critical systems that may lead to serious bodily injury or death or cause environmental or property damage, automated decision-making, or to make legal, tax, or financial decisions. Services used in support of healthcare services are not medical devices and are not intended to be used by themselves for any clinical decision-making or other clinical use. We have no obligation or liability to you with respect to any claim arising from your use of generative AI features of select Services that: (i) arises from output you generate through use of the generative AI features of Services that either alone or as combined by you infringe or misappropriate any third party‚Äôs intellectual property rights; (ii) if you interfere with or fail to enable available filters, guardrails, or other tools, or disregard instructions on how to properly use the Services provided in the TOS and product documentation or in other materials we may make available to you; (iii) if your use of the Services breaches this TOS; (iv) if you have fine-tuned, refined, customized or modified the output or the generative AI feature of select Services and the alleged infringement or misappropriation would not have occurred but for this fine-tuning, refinement, customization, or modification; (v) arising after you receive notice to stop using the Service or feature of the Service; (vi) arising from output that you know or reasonably should know may infringe or misappropriate any third party‚Äôs intellectual property rights; and (vii) alleging that your use of the output infringes on a third party‚Äôs trademark or related rights. To the fullest extent possible under applicable law, you are responsible for your use of generative AI outputs generated by the Services. \n \n\n‚Ä¢ DigitalOcean GenAI Platform Service and Playground Feature \n \n a. Third-party models accessible through the DigitalOcean GenAI Platform Service are made available to you as Third Party Services and are subject to additional third-party license terms specified in the DigitalOcean GenAI Platform Service, Playground, and related documentation. Your access to and use of third-party models on the DigitalOcean GenAI Platform Service and Playground may require you to review and accept the Third Party Services‚Äô terms and conditions to proceed. \n b. As part of providing the DigitalOcean GenAI Platform Service and Playground, we may use manual and automated abuse detection mechanisms designed to detect harmful content, including related to potential violations of our or third-party model providers‚Äô terms of service or acceptable use policies. Further, if these mechanisms detect apparent child sexual abuse material, you agree and instruct that we may report the incident to the National Center for Missing and Exploited Children or other authority. In addition, we may share information, that does not include your Services Content, about your use of a third-party model on DigitalOcean GenAI Platform Service with the provider of that third-party model. \n c. DigitalOcean GenAI Platform Service and Playground feature may allow you to customize models with data you provide (for example, by fine-tuning). You will have exclusive use of your customized model. Third-party model providers cannot access your customized model. We will not access or use your customized model except as necessary to maintain or provide the DigitalOcean GenAI Platform Service and the Playground feature, or as necessary to comply with law or a binding order of a governmental body. \n d. Meta Llama Models. Meta Llama models are licensed under the Meta Llama 3 Community License, Copyright ¬© Meta Platforms, Inc. All Rights Reserved: A copy of that license is available here: https://llama.meta.com/llama3/license/ . \n e. Attribution. For information about the DigitalOcean GenAI Platform Service and Playground open source attribution notice, please click here: Gen AI Platform Service - Attribution Notice File . \n f. DigitalOcean GenAI Platform Service‚Äôs Playground feature is intended for experimentation purposes only, and any outputs or agents that may be created using the feature should not be used with production data or put into production. \n g. Output generated by models accessed through DigitalOcean GenAI Platform Service or through the Playground feature may include information such as metadata, digital signatures, or watermarks to identify it is generated using a generative artificial intelligence model (‚ÄúProvenance Data‚Äù). Neither you nor any End User may modify, tamper with, remove, obscure, or otherwise alter such Provenance Data. \n h. Guardrails. We may provide Guardrails as part of the GenAI Platform Service. ‚ÄúGuardrails‚Äù are provided as an approach to help you implement safeguards on outputs generated from foundation models. Although they are industry standard, this technology is nascent and may not always work as intended. Please review outputs to ensure they meet your needs. DigitalOcean is not responsible if Guardrails do not perform as intended or expected. \n \n\n‚Ä¢ Cloudways Services. ‚ÄúCloudways Services‚Äù mean any services offered by DigitalOcean under the brand name Cloudways on its Website including but not limited to cloud application deployment, management and infrastructure management ‚Äì commonly referred to as the ‚ÄúCloudways Platform.‚Äù The following Service Terms apply to your use of Cloudways Services inclusive of the Cloudways Platform: \n \n a. We charge in arrears for Cloudways Services, meaning that you will receive an invoice during the first week of each month for the Cloudways Services that you used in the previous month. \n b. Cloudways Services are a ‚Äúpay as you go‚Äù service, meaning you will only pay for the resources that you have actually used and for the time that you have actually used them (minimum time fraction for billing related purposes is one hour increments). \n c. Notwithstanding anything to the contrary in the TOS, we will refund your unused prepaid account funds for Cloudways Services if a valid refund request is submitted within three months of funds addition. However, the refund will not include the amount already deducted for Cloudways Services consumed prior to the date such refund is issued. For the avoidance of doubt, this refund provision only applies to Cloudways Services. \n d. Some of the Cloudways Services may require that you establish your own account with one or more third-party cloud providers (‚ÄúCloud Provider‚Äù). You will be solely responsible for paying for and establishing an account (‚ÄúCustomer Cloud Provider Account‚Äù) with each third-party Cloud Provider you select, and for compliance with the third-party Cloud Provider‚Äôs terms. You must provide us with your Customer Cloud Provider Account credentials (the ‚ÄúCP Key‚Äù) that are necessary for us to access and manage your use of the third-party Cloud Provider‚Äôs servers, including, without limitation, accessing servers as necessary to identify or resolve technical problems or to respond to any issues related to or connected with the Cloudways Services. We will use reasonable efforts to maintain the confidentiality and security of your CP Keys. \n e. Solely in connection with the Cloudways Services, we have also established our own accounts (‚ÄúCloudways Provider Accounts‚Äù) with one or more third-party Cloud Providers, which we may use to provide you with the Cloudways Services. We will be responsible for paying for and establishing Cloudways Provider Accounts, provided that you will be responsible for paying us the portion of the Cloud Provider fees allocated to you (of which you will be notified in advance), and for compliance with applicable Cloud Provider terms. \n f. PLEASE KEEP IN MIND THAT SOME OF THE CONTENT THAT WE MAKE AVAILABLE TO YOU THROUGH CLOUDWAYS SERVICES MAY ORIGINATE FROM THIRD PARTY CLOUD PROVIDERS AND APPLICATIONS. ALL SUCH THIRD PARTY CONTENT IS PROVIDED TO YOU ‚ÄúAS IS‚Äù AND YOUR USE THEREOF MAY BE SUBJECT TO CHANGE AND/OR REMOVAL AT ANY TIME. WE SHALL, UNDER NO CIRCUMSTANCES WHATSOEVER, ACCEPT LIABILITY RESULTING FROM YOUR USE OF ANY SUCH THIRD-PARTY SERVICES AND/OR CONTENT. WE ARE NOT LIABLE OR RESPONSIBLE FOR SERVICE UNAVAILABILITY CAUSED BY THE ACTIONS OF THE OTHER CLOUD PROVIDERS. \n g. You may neither share nor re-sell your Cloudways Services account to any third parties. Unless you have been specifically permitted to do so in a separate agreement with us, you agree that you will not reproduce, duplicate, copy, sell, trade or resell the Cloudways Services for any purpose. \n h. We may offer (or act as intermediary in the offering of) certain application trials including the ability for you to install the application on a temporary basis for trial purposes. YOU ACKNOWLEDGE THAT SUCH TRIALS ARE INTENDED TO BE TEMPORARY INSTALLATIONS AND THAT WE MAY DELETE APPLICATIONS AND SHUT DOWN RELEVANT SERVERS AT ANY TIME. \n i. We may automatically shut down applications and servers at various times, including without limitation, when you log out of the Cloudways Service, if you do not respond to a prompt after a certain period of time, or if you explicitly request us to do so, or if we detect that your application or server is malfunctioning. The data and software may be backed up during this process and may be restored, but such restoration is not guaranteed to reproduce the exact state of the application or server at the time the backup was created by us, particularly if you have used the ‚Äúterminal‚Äù capability or otherwise directly accessed the server. \n j. We do not promise to retain any preservations or backups on your behalf, and do not guarantee the completeness of any backup. You are solely responsible for the integrity, preservation, and backup of your Cloudways Services and content, regardless of whether your use of Cloudways Services includes a backup feature or functionality. Without limiting the foregoing, to the fullest extent permitted by law, we shall have no liability for any data loss, unavailability, or other consequences related to the foregoing. \n\n## 5. Rules of Conduct \n\n 5.1 You must use the Websites and Services in accordance with our AUP, which is incorporated by reference. Accordingly, any use of the Websites and Services in violation of the AUP shall constitute a breach of this TOS. \n 5.2 You are solely responsible for the activity that occurs on your Account, regardless of whether the activities are undertaken by you, your employees, any third party (including your contractors or agents), your End Users, your licensees, or your customers. \n 5.3 You are responsible for notifying your employees, agents, and others related to your use of the Websites and Services of the provisions of this TOS, including where the terms of the TOS are binding on them. \n 5.4 You shall not (directly or indirectly): (i) decipher, decompile, disassemble, reverse engineer or otherwise attempt to derive any source code or underlying ideas or algorithms of any part of the Websites or Services (including without limitation any application), except to the limited extent applicable laws specifically prohibit such restriction; (ii) modify, translate, or otherwise create derivative works of any part of the Websites or Services; or (iii) copy, rent, lease, distribute, or otherwise transfer any of the rights that you receive hereunder. You shall abide by all applicable local, state, national and international laws and regulations. To the extent any portions of the Websites or Services are subject to Open Source Licenses, such Open Source Licenses apply regardless of this section. \n 5.5 We reserve the right to access, read, preserve, and disclose any information as we reasonably believe is necessary to (i) respond to any applicable law, regulation, legal process or governmental request; (ii) enforce this TOS, including investigation of potential violations hereof; (iii) detect, prevent, or otherwise address fraud, security, or technical issues; (iv) respond to user support requests; or (v) protect the rights, property or safety of us, our users, and the public. More information is available in our Law Enforcement Guidelines . \n 5.6 As a reward for being early adopters of the Services, some Users with older Accounts received free bandwidth promotions contingent on their Accounts remaining operative, in good standing, and in compliance with this TOS (‚Äú Free Bandwidth Accounts ‚Äù). Free Bandwidth Accounts will no longer receive free bandwidth if: (a) such Accounts are transferred in ownership to third party; (b) such Free Bandwidth Accounts are used in violation of this TOS (including the AUP); or (c) such Free Bandwidth Accounts are used in connection with any of the following activities: (i) run Torrents for download or Seed Servers, TOR, or services that include content of an adult or pornographic nature; (ii) resell or otherwise offer as a service such free bandwidth to third parties; or (iii) otherwise circumvent or attempt to circumvent the intended use of Free Bandwidth Accounts by redistributing the benefits of free bandwidth to third parties. \n 5.7 The Services are subject to the trade and economic sanctions maintained by the Office of Foreign Assets Control (‚Äú OFAC ‚Äù). By accessing the Services, you agree to comply with these laws and regulations. Specifically, you represent and warrant that you are not: (a) located in any country that is subject to OFAC‚Äôs trade and economic sanctions, currently Cuba, Iran, North Korea, Syria, and the Crimea region of Ukraine; or (b) an individual or entity included on any U.S. lists of prohibited parties including: the Treasury Department‚Äôs List of Specially Designated Nationals List (‚Äú SDN List ‚Äù) and Sectoral Sanctions List (‚Äú SSI List ‚Äù). Additionally, you agree not to ‚Äì directly or indirectly ‚Äì sell, export, reexport, transfer, divert, or otherwise dispose of any service received from DigitalOcean in contradiction with these laws and regulations. Failure to comply with these laws and regulations may result in the suspension or termination of your Account. \n 5.8 You agree to comply with all applicable export and import control laws and regulations in your use of the Services, and, in particular, you will not utilize the Services to export or re-export data or software without all required United States and foreign government licenses. You assume full legal responsibility for any access and use of the Services from outside the United States, with full understanding that such access or use may constitute export of technology and technical data that may implicate export regulations and/or require export license. \n 5.9 You shall utilize proper security protocols, such as setting strong passwords and access control mechanisms, safeguarding access to all logins and passwords, and verifying the trustworthiness of persons who are entrusted with account access information. You are solely responsible for any unauthorized access to your Account, and must notify DigitalOcean immediately of any such unauthorized access upon becoming aware of it. \n 5.10 You shall notify DigitalOcean if and when you learn of any security incidents or breaches affecting the Websites or Services, including unauthorized access to your Account or Account credentials, and shall aid in any investigation or legal action that is taken by authorities and/or DigitalOcean to investigate and cure the security incident or breach to the extent caused by your Account or your use of the Websites and Services. Our Data Processing Agreement includes more information about security incidents as they pertain to certain personal data. \n\n## 6. Payments and Billing \n\n 6.1 We use third-party payment processors (the ‚ÄúPayment Processors‚Äù) to bill you through the payment account(s) linked to your Account (your ‚ÄúBilling Information‚Äù). The processing of payments may be subject to the terms, conditions and policies of the Payment Processors in addition to this TOS. We are not responsible for acts or omissions of the Payment Processors. You agree to pay us, through the Payment Processors or as otherwise agreed to by DigitalOcean, all sums for Services you select or use at applicable prices in accordance with our pricing and billing policies (e.g., DigitalOcean Cloud Dashboard ( https://cloud.digitalocean.com/ ) when logged into your DigitalOcean account) and you hereby authorize us and applicable Payment Processors to charge all such sums (including all applicable taxes) to the payment method(s) specified in or linked to your Account (your ‚Äú Payment Method ‚Äù). If you have added stablecoin as a Payment Method (to the extent the option is made available to you), the Stablecoin Payment Addendum terms additionally apply. \n 6.2 You must provide current, complete and accurate information for your Account and Billing Information, and must promptly update all such information in the event of changes (such as a change in billing address, credit card number, or credit card expiration date). You must promptly notify us or our Payment Processors if your payment method is canceled (e.g., for loss or theft) or otherwise inoperable. Changes to such information can be made in your account settings . \n 6.3 By entering into this TOS and using the Services, you agree to be billed on a recurring basis and to be automatically charged by us or our Payment Processors using your Payment Methods upon invoicing. If your Payment Method or payment of fees is subject to other terms and conditions, as set forth in order forms, invoices or otherwise, then those other terms and conditions apply in addition to this TOS. You may also be billed an amount up to your current balance at any time to verify the accuracy of your account information. We reserve the right to deactivate, terminate, prevent access to, disable services for, and/or delete any Accounts or access to the Websites and Services at any time at our sole discretion, including for nonpayment, late payment, or failure to charge your Payment Methods upon invoicing. \n 6.4 You are responsible for any duties, customs fees, taxes, and related penalties, fines, audits, interest, and back-payments relating to your purchase of the Services, including but not limited to national, state or local sales taxes, use taxes, value-added taxes (VAT) and goods and services taxes (GST) (collectively, ‚Äú Taxes ‚Äù). Unless otherwise stated, our pricing policies do not include and are not discounted or enhanced for any such Taxes. If we become obligated to collect or pay Taxes in connection with your purchase of the Services, those Taxes will be invoiced to you as part of a billing process or collected at the time of purchase. In certain states, countries and territories, we may determine if your purchase of Services is subject to certain Taxes, and if so, may collect such Taxes and remit them to the appropriate taxing authority. If you believe that a given Tax does not apply or that some amount must be withheld from payments to us, you must promptly provide us with a tax certificate, withholding receipt, tax identifier (e.g., VAT ID) or other adequate proof, provided such information is valid and sufficiently authorized by all appropriate taxing authorities. You must also provide us with any tax identification information that is necessary for us to comply with our tax obligations, as we determine from time to time. You will be solely responsible for any misrepresentations made or non-compliance caused by you regarding Taxes, whether with respect to us or other parties, including any penalties, fines, audits, interest, back-payments or further taxes associated with such misrepresentations or non-compliance. \n 6.5 We may offer Service credits from time to time, and any provision of such credits is governed by the disclosures, terms and policies concerning the credits. You acknowledge and agree that all credits, whether previously offered or otherwise, are revocable or subject to early expiration at any time and for any reason or no reason by us, including for abuse, misrepresentation of Account information, unauthorized transfer, or illegal conduct by you. \n\n## 7. Third Party Services \n\n The Websites and Services may include links to third party websites, services or other resources on the Internet (‚Äú Third Party Services ‚Äù), and third party websites, services or other resources may include links to our Websites and Services as well. When you access Third Party Services on the Internet, you do so at your own risk. These Third Party Services are not under our control, and, to the fullest extent permitted by law, we are not responsible or liable for the content, functions, accuracy, legality, appropriateness or any other aspect of such resources. The inclusion of any such link does not imply our endorsement or any association between us and any third party. To the fullest extent permitted by law, we shall not be responsible or liable, directly or indirectly, for any damage or loss caused or alleged to be caused by or in connection with the use of or reliance on any such Third Party Services. We also permit certain Vendors to make available Vendor Offerings available on the DigitalOcean Marketplace (‚Äú Vendors ‚Äù and ‚Äú Vendor Offerings ‚Äù being defined in the DigitalOcean Marketplace Terms and Conditions ). Use of any Vendor Offerings may require you to agree to certain terms and conditions directly with the Vendor, and DigitalOcean is not a party to such agreement. It is your responsibility to protect your system from risks such as viruses, worms, Trojan horses and other security risks that may be presented by the Third Party Services or Vendor Offerings described in this section. \n\n## 8. Confidentiality & Beta Services \n\n 8.1 To the extent you receive or possess any nonpublic information from us that is designated confidential or, given the nature of the information or circumstances surrounding its disclosure, reasonably should be understood to be confidential, such information is our ‚Äú Confidential Information ‚Äù and must be handled in accordance with this TOS. Confidential Information includes but is not limited to: (a) nonpublic information about our technology, customers, business plans, marketing and sales activities, finances, operations and other business information; and (b) the existence and content of our discussions or negotiations with you regarding your Account and/or use of the Services. Confidential Information does not include any information that: (i) is or becomes publicly available without breach of this TOS; (ii) can be shown by documentation to have been known to you at the time of your receipt from us; (iii) is received from a third party who did not acquire or disclose the information by a wrongful or tortious act or by violating the rights of us or third parties; or (iv) can be shown by documentation to have been independently developed by you without reference to the Confidential Information. \n 8.2 You may not use Confidential Information except in connection with your use of the Service as permitted under this TOS or as separately authorized in a signed writing by us. You agree to not disclose Confidential Information during the term of this TOS, after you cease using the Services, and after this TOS otherwise no longer applies. You will take all reasonable measures to avoid disclosure or unauthorized use of Confidential Information, including at least the measures you take to protect your own confidential information of a similar nature. \n 8.3 We may offer access to or use of certain features, technologies, data centers regions, and services that are not yet generally available, including, but not limited to, any products, services, or features labeled ‚Äúbeta‚Äù, ‚Äúpreview‚Äù, ‚Äúpre-release‚Äù, or ‚Äúexperimental‚Äù (each, a ‚ÄúBeta Service‚Äù ). You must comply with all terms related to any Beta Service as posted on the Website or otherwise made available to you. We may add or modify terms, including lowering or raising any usage limits, related to access to or use of any Beta Services at any time. Service Level Agreements do not apply to Beta Services. \n 8.4. You may provide us with information relating to your access, use, testing, or evaluation of Beta Services, including observations or information regarding the performance, features, and functionality of Beta Services (‚ÄúTest Observations‚Äù). We will own and may use and evaluate all Test Observations for its own purposes. You will not use any Test Observations except for your internal evaluation purposes of any Beta Service. Suggestions concerning a Beta Service, and any other information about or involving (including the existence of) any Beta Service are considered Confidential Information. \n 8.5. We may suspend or terminate your access to or use of any Beta Service at any time. Your access to and use of each Beta Service will automatically terminate upon the release of a generally available version of the applicable Beta Service or upon notice of termination by us. Notwithstanding anything to the contrary in the TOS, after suspension or termination of your access to or use of any Beta Service for any reason: (a) you will not have any further right to access or use the applicable Beta Service, and (b) your Services Content used in the applicable Beta Service may be deleted or inaccessible. \n 8.6. WITHOUT LIMITING ANY DISCLAIMERS IN THIS TOS, BETA SERVICES ARE NOT READY FOR GENERAL PRODUCTION RELEASE AND MAY CONTAIN BUGS, ERRORS, DEFECTS, OR HARMFUL COMPONENTS. ACCORDINGLY, AND NOTWITHSTANDING ANYTHING TO THE CONTRARY IN THIS TOS, WE ARE PROVIDING BETA SERVICES AND BETA REGIONS TO YOU ‚ÄúAS IS.‚Äù DIGITALOCEAN AND ITS AFFILIATES AND LICENSORS MAKE NO REPRESENTATIONS OR WARRANTIES OF ANY KIND, WHETHER EXPRESS, IMPLIED, STATUTORY, OR OTHERWISE REGARDING BETA SERVICES, INCLUDING ANY WARRANTY THAT THE BETA SERVICES WILL BECOME GENERALLY AVAILABLE, BE UNINTERRUPTED, ERROR FREE, OR FREE OF HARMFUL COMPONENTS, OR THAT ANY CONTENT, INCLUDING YOUR SERVICES CONTENT, WILL BE SECURE OR NOT OTHERWISE LOST OR DAMAGED. EXCEPT TO THE EXTENT PROHIBITED BY LAW, DIGITALOCEAN AND ITS AFFILIATES AND LICENSORS DISCLAIM ALL WARRANTIES, INCLUDING ANY IMPLIED WARRANTIES OF MERCHANTABILITY, SATISFACTORY QUALITY, FITNESS FOR A PARTICULAR PURPOSE, NON-INFRINGEMENT, OR QUIET ENJOYMENT, AND ANY WARRANTIES ARISING OUT OF ANY COURSE OF DEALING OR USAGE OF TRADE. DIGITALOCEAN‚ÄôS AND ITS AFFILIATES‚Äô AND LICENSORS‚Äô AGGREGATE LIABILITY FOR ANY BETA SERVICES WILL BE LIMITED TO THE AMOUNT YOU ACTUALLY PAY US UNDER THIS TOS FOR THE SERVICES THAT GAVE RISE TO THE CLAIM DURING THE MONTH PRECEDING THE CLAIM. \n\n## 9. No Warranty \n\n 9.1 The Websites and Services, including without limitation any content delivered as a part thereof, are provided ‚Äúas is‚Äù and on an ‚Äúas available‚Äù basis. DigitalOcean disclaims all warranties of any kind, whether express or implied, relating to the Websites and Services and all content delivered in connection thereto, including but not limited to: (a) any implied warranty of merchantability, fitness for a particular purpose, title, quiet enjoyment, or non-infringement; (b) any warranty arising out of course of dealing, usage, or trade; or (c) any warranty or guaranty relating to availability, accuracy, error rate, system integrity, or uninterrupted access. We do not warrant that: (i) the Websites or Services will be secure or available at any particular time or location; (ii) any defects or errors will be corrected; (iii) any content or software available at or through the Websites or Services is free of viruses or other harmful components; or (iv) the results of using the Websites or Services will meet your requirements. Your use of the Websites and Services is solely at your own risk. \n To the fullest extent permitted by law, we have no liability for Vendor Offerings. Rather, if applicable, all limited warranties, warranty disclaimer, limitations of liability and other specific provisions regarding the Vendor Offerings can be found in the DigitalOcean Marketplace Terms and Conditions or, if applicable, the agreement between you and the Vendor. \n 9.2 DigitalOcean is not responsible for the content that you access through your use of the Websites, Services, or content of other users of DigitalOcean or other third parties. To the extent permitted by applicable law, you release us from all liability relating to such content. You acknowledge and agree that we make no representations concerning any content contained in or accessed through the Websites or content of other users of DigitalOcean or other third parties, and that we are not responsible or liable for the accuracy, quality, legality, or other attributes of such content. \n 9.3 The limitations, exclusions, and disclaimers in this Section 9 apply to the fullest extent permitted by law. DigitalOcean does not disclaim any warranty or other right that DigitalOcean is prohibited from disclaiming under applicable law. \n\n## 10. Limitation of Liability \n\n 10.1 To the fullest extent permitted by law, in no event will we be liable to you for any indirect, incidental, special, consequential, or punitive damages (including damages for loss of profits, goodwill, or any other intangible loss) arising out of or relating to your access to or use of, or your inability to access or use, the Websites and Services or any materials or content on the Websites and Services, whether based on warranty, contract, tort (including negligence), statute, or any other legal theory, and whether or not we have been informed of the possibility of damage. To the fullest extent permitted by law, you agree we will have no liability for any data that may be destroyed, lost or otherwise rendered inaccessible, whether because you failed to backup your data or for any other reason. \n 10.2 Except as provided in Section 13 and to the fullest extent permitted by law, our aggregate liability to you for all claims arising out of or relating to this TOS or the Websites and Services, whether in contract, tort, or otherwise, is limited to the amount you have paid to us for the Services at issue in the month prior to the event or circumstance giving rise to claim. \n 10.3 Notwithstanding any other clause herein, except for actions related to the protection of the proprietary rights of DigitalOcean and its suppliers, no action, regardless of form, arising out of or in connection with this TOS, or the Websites and Services may be brought by either party more than two (2) years after the event giving rise to such action or claim accrued. \n 10.4 Each provision of this TOS that provides for a limitation of liability, disclaimer of warranties, or exclusion of damages is intended to and does allocate the risks between the parties under this TOS. This allocation is an essential element of the basis of the bargain between you and us. Each of these provisions is severable and independent of all other provisions of this TOS. The limitations in this section will apply even if any limited remedy fails of its essential purpose. \n\n## 11. Indemnification \n\n To the fullest extent permitted by law, you are responsible for your use of the Websites and Services, and you shall defend, indemnify, and hold harmless us and our employees, officers, directors, agents, contractors, and representatives from all liabilities, claims, and expenses, including reasonable attorneys‚Äô fees and costs, that arise from or relate to your Services Content, User Content, your End Users, or your access to or use of the Websites and Services, including your breach of this TOS or applicable law, willful misconduct, negligence, illegal activity, breach of security or data, unauthorized access to or use of your Account, or infringement of a third party‚Äôs right, including any intellectual property, confidentiality, property, or privacy right. We reserve the right to assume the exclusive defense and control of any matter otherwise subject to indemnification by you, without limiting your indemnification obligations with respect to that matter, in which event you will make best efforts to assist and cooperate with us in defending the matter at your expense. \n\n## 12. Termination \n\n While we prefer to give advance notice of termination, we reserve the right, in our sole discretion, to terminate your access to all or any part of the Websites and/or Services at any time, with or without notice, effective immediately. Any such termination may result in the immediate forfeiture and destruction of data associated with your Account. Except as otherwise set forth herein or expressly agreed between the parties, any and all fees paid to us are non-refundable and any and all fees still owed to us at the time of such termination shall be immediately due and payable. Upon termination, any and all rights granted to you by this TOS will immediately be terminated, and you must also promptly discontinue all use of the Websites and/or Services. All provisions of this TOS which by their nature should reasonably be expected to survive termination shall survive termination, including Sections 2.1-2.4, 3, 4, 6, 8, 9, 10, 11, 12, 13, and 14. \n\n## 13. Dispute Resolution and Arbitration \n\n 13.1 In the interest of resolving disputes between you and DigitalOcean in the most expedient and cost-effective manner, and except as described in Section 13.2, you and DigitalOcean agree that every dispute arising in connection with this TOS will be resolved by binding arbitration. Arbitration is less formal than a lawsuit in court. Arbitration uses a neutral arbitrator instead of a judge or jury, may allow for more limited discovery than in court, and can be subject to limited review by courts. Arbitrators can award the same damages and relief that a court can award. This agreement to arbitrate disputes includes all claims arising out of or relating to any aspect of this TOS, whether based in contract, tort, statute, fraud, misrepresentation, or any other legal theory, and regardless of whether a claim arises during or after the termination of this TOS, if applicable. You understand and agree that, by entering into this TOS, you and DigitalOcean are each waiving the right to a trial by jury or to participate in a class action. \n 13.2 Despite the other provisions of Section 13, but subject to Section 10.3, nothing in this TOS will waive, preclude, or otherwise limit the right of either party to bring an individual action in small claims court. \n 13.3 Any arbitration between you and DigitalOcean will be settled under the Federal Arbitration Act and administered by the American Arbitration Association (‚Äú AAA ‚Äù) under its Consumer Arbitration Rules (collectively, ‚Äú AAA Rules ‚Äù) as modified by this TOS. The AAA Rules and filing forms are available online at www.adr.org , by calling the AAA at 1-800-778-7879. The arbitrator has exclusive authority to resolve any dispute relating to the interpretation, applicability, or enforceability of this binding arbitration agreement. \n 13.4 A party who intends to seek arbitration must first send a written notice of the dispute to the other party in accordance with Section 14.5. (‚Äú Notice of Arbitration ‚Äù). The Notice of Arbitration must: (a) describe the nature and basis of the claim or dispute; and (b) set forth the specific relief sought (‚Äú Demand ‚Äù). The parties will make good faith efforts to resolve the claim directly, but if the parties do not reach an agreement to do so within 30 days after the Notice of Arbitration is received, you or DigitalOcean may commence an arbitration proceeding. All arbitration proceedings between the parties will be confidential unless otherwise agreed by the parties in writing. During the arbitration, the amount of any settlement offer made by you or DigitalOcean must not be disclosed to the arbitrator until after the arbitrator makes a final decision and award, if any. \n 13.5 Any arbitration hearing will take place at a location to be agreed upon in Denver, Colorado but if the claim is for $10,000 or less, you may choose whether the arbitration will be conducted: (a) solely on the basis of documents submitted to the arbitrator; or (b) through a non-appearance based telephone hearing. If the arbitrator finds that either the substance of your claim or the relief sought in the Demand is frivolous or brought for an improper purpose (as measured by the standards set forth in Federal Rule of Civil Procedure 11(b)), then the payment of all fees will be governed by the AAA Rules. In that case, you agree to reimburse DigitalOcean for all monies previously disbursed by it, including any reasonable attorneys‚Äô fees, and/or other fees or charges that are otherwise your obligation to pay under the AAA Rules. Regardless of the manner in which the arbitration is conducted, the arbitrator must issue a reasoned written decision sufficient to explain the essential findings and conclusions on which the decision and award, if any, are based. The arbitrator may make rulings and resolve disputes as to the payment and reimbursement of fees or expenses at any time during the proceeding and upon request from either party made within 14 days of the arbitrator‚Äôs ruling on the merits. \n 13.6 You and DigitalOcean agree that each may bring claims against the other only in an individual capacity and not as a plaintiff or class member in any purported class or representative proceeding. Further, unless both you and DigitalOcean agree otherwise, the arbitrator may not consolidate more than one person‚Äôs claims, and may not otherwise preside over any form of a representative or class proceeding. \n 13.7 If any portion of this Section 13 is found to be unenforceable, then that portion will be null and void and the remainder of this Section 13 will reasonably remain in effect. In such event, if Section 13 cannot reasonably remain in effect as a whole, you and DigitalOcean agree that the exclusive jurisdiction and venue described in Section 14.4 will govern any action arising out of or related to this TOS. \n\n## 14. Miscellaneous Provisions \n\n 14.1 Updates and Modifications. DigitalOcean reserves the right to update, change or otherwise modify this TOS on a going-forward basis at any time and in DigitalOcean‚Äôs sole discretion. If DigitalOcean updates this TOS, DigitalOcean may provide notice of such updates, such as by sending an email notification to the email address listed in your Account, and/or updating the ‚ÄúLast Updated‚Äù date at the beginning of this TOS. Updates will be effective on the date specified in the notice. By continuing to access or use the Websites or Services after the date specified in the notice or updated TOS, you are agreeing to accept and be bound by the updated TOS and all of the terms incorporated therein. If you do not agree to the updated TOS, then you may not continue to use the Websites or Services, and your sole and exclusive remedy is to deactivate your Account and otherwise discontinue use of the Websites and/or Services. \n 14.2 General. This TOS, including all documents expressly incorporated by reference herein, constitutes the entire agreement between the parties and supersedes all prior and contemporaneous agreements, proposals or representations, written or oral, concerning its subject matter. No provision of any purchase order, agreement, or business form employed by a User, including any electronic invoicing portals and vendor registration processes, will supersede the terms and conditions of this TOS, and any such document relating to this TOS shall be for administrative purposes only and shall have no legal effect. Use of section headers in this TOS is for convenience only and will not have any impact on the interpretation of any provision. Any use of the singular shall be reasonably construed as if it also includes the plural, and vice versa. If not already specified, any use of ‚Äúincluding‚Äù or ‚Äúsuch as‚Äù shall be construed to mean ‚Äúincluding but not limited to.‚Äù If any part of this TOS is held to be invalid or unenforceable, the unenforceable part will be given effect to the greatest extent possible, and the remaining parts will remain in full force and effect. The failure to require performance of any provision will not affect our right to require performance at any other time after that, nor will a waiver by us of any breach or default of this TOS, or any provision of this TOS, be a waiver of any subsequent breach or default or a waiver of the provision itself. \n 14.3 Assignment. You may not assign, transfer or delegate this TOS or any of your rights and obligations under the TOS, in whole or in part, by operation of law or otherwise, without our prior written consent. We may assign, transfer or delegate this TOS or our rights and obligations under this TOS without notice or consent. Subject to this section, this TOS will be binding upon and inure to the benefit of the parties and their respective permitted successors and assigns, and any assignment or transfer in violation of this section will be void. \n 14.4 Governing Law. This TOS and any dispute related thereto (including under Section 13) is governed by the laws of the State of Colorado without regard to conflict of law principles. Subject to Section 13, you and DigitalOcean submit to the personal and exclusive jurisdiction of the state courts and federal courts located within Denver County, Colorado for resolution of any lawsuit or court proceeding permitted under this TOS. \n 14.5 Notice. You must send notices by certified U.S. Mail or by Federal Express (signature required and return receipt requested) to: DigitalOcean, LLC, 105 Edgeview Drive, Ste. 425, Broomfield, CO 80021. You agree to receive electronic notices from us, which will be sent by email to the email address then associated with your Account. Notices are effective on the date on the return receipt or, for email, when sent. You are responsible for ensuring that the email address associated with your Account is accurate and current. Any email notice that we send to that email address will be effective when sent, whether or not you actually receive the email. \n 14.6 Consent to Electronic Communications. By using the Websites and/or Services, you consent to receiving certain electronic communications from us as further described in our Privacy Policy. Please read our Privacy Policy to learn more about our electronic communications practices. You agree that any notices, agreements, disclosures, or other communications that we send to you electronically will satisfy any legal communication requirements, including that those communications be in writing. \n 14.7 Notice to California Residents. If you are a California resident, under California Civil Code Section 1789.3, you may contact the Complaint Assistance Unit of the Division of Consumer Services of the California Department of Consumer Affairs in writing at: 1625 N. Market Blvd., Suite N 112, Sacramento, California 95834, or by telephone at (800) 952-5210 in order to resolve a complaint or to receive further information regarding use of the Websites or Services. \n 14.8 Relationship of the Parties. The parties are independent contractors. This TOS does not create a partnership, franchise, joint venture, agency, fiduciary, or employment relationship between the parties. Neither party, nor any of their respective affiliates, is an agent of the other for any purpose or has the authority to bind the other. \n 14.9 Force Majeure. DigitalOcean shall not be liable for nonperformance of the terms herein to the extent that DigitalOcean is prevented from performing as a result of any act or event which occurs and is beyond DigitalOcean‚Äôs reasonable control, including, without limitation, acts of God, war, unrest or riot, strikes, any action of a governmental entity, weather, quarantine, fire, flood, earthquake, explosion, utility or telecommunications outages, Internet disturbance, epidemic, pandemic or any unforeseen change in circumstances, or any other causes beyond our reasonable control. \n 14.10 No Third-Party Beneficiaries. This TOS does not create any third party beneficiary rights in any individual or entity that is not a party to this TOS. \n 14.11 Government Use. DigitalOcean provides the Websites and Services, including related software and technology, for ultimate federal government end use solely in accordance with the following: Government technical data and software rights related to the Websites and Services include only those rights customarily provided to the public as defined in this TOS. This customary commercial license is provided in accordance with FAR 12.211 (Technical Data) and FAR 12.212 (Software) and, for Department of Defense transactions, DFAR 252.227-7015 (Technical Data ‚Äì Commercial Items) and DFAR 227.7202-3 (Rights in Commercial Computer Software or Computer Software Documentation). If a government agency has a need for rights not conveyed under this TOS, then it must negotiate with DigitalOcean to determine if there are acceptable terms for transferring such rights, and a mutually acceptable written addendum specifically conveying such rights must be included in any applicable contract or agreement. \n Copyright 2025 DigitalOcean, LLC. All rights reserved. No part of DigitalOcean‚Äôs Website may be reproduced, modified, or distributed in any form or manner without the prior written permission of DigitalOcean. \n\n## Prior Versions of our Terms of Service \n\n \n\n‚Ä¢ Effective on November 24, 2025\nPrior TOS available here . \n\n‚Ä¢ Effective on October 31, 2025\nPrior TOS available here . \n\n‚Ä¢ Effective on June 26, 2025\nPrior TOS available here . \n\n‚Ä¢ Effective on April 6, 2025\nPrior TOS available here . \n\n‚Ä¢ Effective on January 1, 2025\nPrior TOS available here . \n\n‚Ä¢ Effective on May 11, 2023\nPrior TOS available here . \n\n‚Ä¢ Effective on February 5, 2022\nPrior TOS available here . \n\n‚Ä¢ Effective on October 22, 2020\nPrior TOS available here . \n \n ¬© 2026 DigitalOcean, LLC. Sitemap . \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢",
      "chunk_ids": [],
      "metadata": {
        "source_type": "tos",
        "source_name": "Digitalocean",
        "url": "https://www.digitalocean.com/legal/terms-of-service-agreement"
      },
      "is_distractor": false,
      "semantic_tags": [
        "digitalocean",
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "termination",
        "tos",
        "warranty"
      ],
      "content_hash": "eccb14c3a1edc0ae",
      "size_bytes": 65523,
      "created_at": "2026-01-02T20:42:23.533684"
    },
    {
      "doc_id": "legal_tos_heroku",
      "source": "online",
      "category": "legal",
      "domain": "legal_tos",
      "file_path": "https://www.salesforce.com/company/legal/agreements/",
      "content": "‚Ä¢ Legal | Salesforce \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n‚Ä¢ \n\n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n\n‚Ä¢ \n‚Ä¢ \n\n \n\n \n\n \n\n \n\n \n\n \n\n \n\n \n \n Skip to content \n \n \n \n \n \n \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n\n \n \n\n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n\n \n \n \n \n \n\n \n \n \n \n \n \n \n \n \n\n \n\n \n \n \n\n \n\n \n \n \n\n \n \n\n \n\n \n\n \n \n \n \n \n \n \n\n \n \n \n \n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n \n \n\n \n\n \n \n \n \n \n\n \n \n\n \n \n\n \n\n \n \n \n \n\n \n \n\n \n \n \n \n\n## \n \n For Customers\n \n\n \n \n \n \n Learn more about the terms associated with the purchasing of Salesforce products. \n\n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n See more \n \n \n \n \n \n \n \n \n \n\n \n \n\n \n\n \n \n\n \n \n \n \n\n \n \n \n\n \n \n \n \n \n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n \n \n\n \n\n \n \n \n \n \n\n \n \n\n \n \n\n \n\n \n \n \n \n\n \n \n\n \n \n \n \n\n## \n \n For Partners and Alliances \n \n\n \n \n \n \n Find documentation and information regarding partner and alliances agreements. \n\n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n See more \n \n \n \n \n \n \n \n \n \n\n \n \n\n \n\n \n \n\n \n \n \n \n\n \n \n \n\n \n \n \n \n \n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n \n \n\n \n\n \n \n \n \n \n\n \n \n\n \n \n\n \n\n \n \n \n \n\n \n \n\n \n \n \n \n\n## \n \n For Suppliers \n \n\n \n \n \n \n Get information and documentation around Salesforce's relationships and agreements with Suppliers. \n\n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n See more\n \n \n \n \n \n \n \n \n \n\n \n \n\n \n\n \n \n\n \n \n \n \n\n \n \n \n\n \n \n \n \n\n \n \n \n \n \n \n\n \n\n \n\n \n \n \n \n \n \n \n\n \n \n \n \n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n \n \n\n \n\n \n \n \n \n \n\n \n \n\n \n \n\n \n\n \n \n \n \n\n \n \n\n \n \n \n \n\n## \n \n Privacy Information\n \n\n \n \n \n \n Find resources and documentation on how Salesforce protects you and your information. \n\n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n See more \n \n \n \n \n \n \n \n \n \n\n \n \n\n \n\n \n \n\n \n \n \n \n\n \n \n \n\n \n \n \n \n \n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n \n \n\n \n\n \n \n \n \n \n\n \n \n\n \n \n\n \n\n \n \n \n \n\n \n \n\n \n \n \n \n\n## \n \n Intellectual Property \n \n\n \n \n \n \n See how Salesforce protects its intellectual property on trademark and copyright usage or learn how to submit i nfringement claims. \n\n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n See DMCA Policy\n \n \n \n \n \n \n \n \n \n\n \n \n\n \n\n \n \n\n \n \n \n \n\n \n \n \n\n \n \n \n \n \n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n \n \n\n \n\n \n \n \n \n \n\n \n \n\n \n \n\n \n\n \n \n \n \n\n \n \n\n \n \n \n \n\n## \n \n Compliance \n \n\n \n \n \n \n Get information and documentation around how Salesforce maintains compliance with local and international laws, as well as accessibility . Learn about how Salesforce ensures innovation is balanced with ethical use here . \n\n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n See more\n \n \n \n \n \n \n \n \n \n\n \n \n\n \n\n \n \n\n \n \n \n \n\n \n \n \n\n \n \n \n \n\n \n \n \n \n \n \n\n \n\n \n\n \n\n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n## \n \n At Salesforce, Trust has always been our #1 value and the cornerstone of our business. From ensuring data privacy and protection to responsible and ethical product innovation, trust underscores everything we do.\n \n\n \n \n Sabastian Niles \n \n \n President and Chief Legal Officer , Salesforce\n \n \n \n \n \n \n\n \n \n \n \n \n \n \n \n \n\n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n\n \n \n \n \n\n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n \n \n\n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n \n \n \n\n \n \n\n \n \n \n Article \n \n \n\n## \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n \n \n How Salesforce Builds Trust in Our AI Products\n \n \n\n \n\n \n \n \n \n\n \n\n \n \n \n Salesforce is taking steps to ensure AI is trusted and reliable by empowering humans at the helm through product design AI holds incredible promise for. \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n Learn more\n \n \n \n \n \n \n \n \n \n\n \n \n\n \n\n \n \n\n \n \n \n \n\n \n \n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n \n \n\n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n \n \n \n\n \n \n\n \n \n \n Article \n \n \n\n## \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n \n \n Autonomous AI Agents Are Coming: Why Trust and Training Hold the Keys to Their Success\n \n \n\n \n\n \n \n \n \n\n \n\n \n \n \n Autonomous AI agents are coming to workplaces sooner than you might think. Count on them automating routine and complex tasks. \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n Learn more\n \n \n \n \n \n \n \n \n \n\n \n \n\n \n\n \n \n\n \n \n \n \n\n \n \n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n \n \n\n \n\n \n\n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n \n \n \n\n \n \n\n \n \n \n Article \n \n \n\n## \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n \n \n What Salesforce Customers Need to Know About the EU Data Act\n \n \n\n \n\n \n \n \n \n\n \n\n \n \n \n On September 12, 2025, the EU Data Act went into effect, giving customers more control over their data. This includes the right to access, transfer, or delete their data, providing greater flexibility and interoperability. \n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n Learn more\n \n \n \n \n \n \n \n \n \n\n \n \n\n \n\n \n \n\n \n \n \n \n\n \n \n \n\n \n\n \n \n \n \n \n \n \n \n \n\n \n \n \n \n \n \n\n \n\n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n \n \n \n\n \n \n \n \n \n \n \n\n \n \n \n \n \n \n\n \n \n \n \n \n \n \n \n \n \n \n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n Contact us",
      "chunk_ids": [],
      "metadata": {
        "source_type": "tos",
        "source_name": "Heroku",
        "url": "https://www.salesforce.com/company/legal/agreements/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "heroku",
        "legal",
        "tos"
      ],
      "content_hash": "8f7fe22ff5b772f9",
      "size_bytes": 5152,
      "created_at": "2026-01-02T20:42:23.533788"
    },
    {
      "doc_id": "legal_tos_vercel",
      "source": "online",
      "category": "legal",
      "domain": "legal_tos",
      "file_path": "https://vercel.com/legal/terms",
      "content": "‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ Terms of Service \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n\n## Terms of Service\n Last Updated August 19, 2025 On this page \n‚Ä¢ Introduction \n‚Ä¢ Age and Eligibility \n‚Ä¢ Temporary Use License \n‚Ä¢ Your Content \n‚Ä¢ Hobby Plan \n‚Ä¢ Acceptable Use \n‚Ä¢ Etiquette \n‚Ä¢ Security and Compliance \n‚Ä¢ General \n‚Ä¢ PCI Compliance \n‚Ä¢ HIPAA Compliance \n‚Ä¢ Data Protection \n‚Ä¢ International Transfers of Data \n‚Ä¢ Use of Your Data \n‚Ä¢ Aggregate Data \n‚Ä¢ Usage Restrictions \n‚Ä¢ Support \n‚Ä¢ Electronic Communications \n‚Ä¢ Representation and Warranties \n‚Ä¢ Representations \n‚Ä¢ Mutual Warranty \n‚Ä¢ Indemnification \n‚Ä¢ Confidentiality; Proprietary Rights \n‚Ä¢ Confidentiality \n‚Ä¢ Company Ownership \n‚Ä¢ Feedback \n‚Ä¢ Customer Name \n‚Ä¢ Payment of Fees \n‚Ä¢ Plans \n‚Ä¢ Payments \n‚Ä¢ Term and Termination \n‚Ä¢ Term \n‚Ä¢ Survival \n‚Ä¢ Effect of Termination \n‚Ä¢ Disclaimer \n‚Ä¢ Limitation of Liability \n‚Ä¢ Limit of Liability and Waiver of Consequential Damages \n‚Ä¢ Limits \n‚Ä¢ Miscellaneous \n‚Ä¢ Governing Law; Disputes; Arbitration \n‚Ä¢ Law \n‚Ä¢ Binding Contract \n‚Ä¢ Exclusive Jurisdiction and Venue; Arbitration \n‚Ä¢ Disputes with a Domestic Customer \n‚Ä¢ Disputes with a Foreign Customer \n‚Ä¢ Opt-Out \n‚Ä¢ Previews \n‚Ä¢ Schedule I \n‚Ä¢ Domain Name Registration \n‚Ä¢ Marketplace \n‚Ä¢ Non-Vercel Services \n‚Ä¢ AI Products and Services \n‚Ä¢ DORA Subject to these Terms of Service (this \"Agreement\"), Vercel Inc. (\"Vercel\", \"we\", \"us\" and/or \"our\") provides access to Vercel&#x27;s Services. \"Services\" means, collectively, any products or services made available by Vercel or its affiliates; provided that, your use of certain Services requires acceptance of additional terms as set forth in Schedule I hereto; and provided further, that, for the avoidance of doubt, any software that we provide exclusively under open source licenses (including, without limitation, Next.js) are not covered by this Agreement. By using or accessing the Services, you acknowledge that you have read, understand, and agree to be bound by this Agreement. \n If you are entering into this Agreement on behalf of a company, business or other legal entity, you represent that you have the authority to bind such entity to this Agreement, in which case the term \"you\" shall refer to such entity. If you do not have such authority, or if you do not agree with this Agreement, you must not accept this Agreement and may not use the Services. \n IMPORTANT: PLEASE REVIEW THE MUTUAL ARBITRATION CLAUSE SET FORTH BELOW CAREFULLY, AS IT WILL REQUIRE YOU TO RESOLVE DISPUTES WITH VERCEL THROUGH FINAL AND BINDING ARBITRATION. BY ENTERING THIS AGREEMENT , YOU EXPRESSLY ACKNOWLEDGE THAT YOU HAVE READ AND UNDERSTAND ALL OF THE TERMS OF THIS MUTUAL ARBITRATION CLAUSE. \n\n## 1. Age and Eligibility\n\n You certify that you are a person at least 16 years of age. Services may only be used or accessed through an electronic device controlled by you at all times. A valid Vercel account may only be created and maintained if you provide valid information in the signup process, and you regularly update such information to assure its accuracy. You shall be responsible for maintaining the confidentiality of login information associated with your account. Each user must have unique login credentials that must not be shared by multiple users. You are responsible for all activities that occur under your account. \n\n## 2. Temporary Use License\n\n During the period for which you are authorized to use the Services, and subject to your compliance with the terms of this Agreement, you are granted a personal, non-sublicensable, non-exclusive, non-transferable, limited license, to use the Services for your internal business or personal purposes according to the service capacity of your account. Any rights not expressly granted herein are reserved and no license or right to use any trademark of Vercel or any third-party is granted to you in connection with the Services. \n\n## 3. Your Content\n\n You are solely responsible for all software, code, data, information, feedback, suggestions, text, content and other materials that you upload, post, deliver, provide or otherwise transmit or store (hereafter \"post(ing)\") in connection with or relating to the Services (\"Your Content\"). You are responsible for maintaining the confidentiality of usernames and passwords associated with your account and for all activities that occur under your account. Vercel reserves the right to access your account in order to respond to your requests for technical support. By posting Your Content on or through the Services, you grant Vercel a worldwide, non-exclusive, royalty-free, fully paid, sublicensable and transferable license to use, copy, modify, reproduce, distribute, display, publish, store and perform Your Content as necessary to provide the Services and for security to protect the Services and third parties from fraud, malware, malicious files or content, viruses and the like. You further agree that Vercel may remove or disable any of Your Content at any time for any reason (including, but not limited to, upon receipt of claims or allegations from third-parties or authorities relating to Your Content), or for no reason at all; provided, that if you are a user of our Services in the European Economic Area (i) we will remove or disable Your Content or impose restrictions on your use of the Services in accordance with applicable laws including if it is illegal content, infringes the rights of third parties, or breaches this Agreement; (ii) if we remove, block or restrict your use of the Services or Your Content, you, and any third party that may have informed us about your use of the Services or Your Content, may contact us about our decision at https://vercel.com/help and we will review and consider your message with a view to promptly resolving any complaint and, if appropriate, we will explain any options you have to request another review. \n\n## 4. Hobby Plan\n\n We offer a free hobby plan at our sole discretion. You shall only use the Services under a hobby plan for your personal or non-commercial use. We may change the terms and conditions applicable to the hobby plan or discontinue offering the hobby plan at any time. We reserve the right to disable or remove any project or website deployment on the hobby plan with or without notice at our sole discretion. We may shut down and terminate projects or deployments using the hobby plan without notice for any reason or no reason. We may shut down affected projects or deployments on the hobby plan in case of any delays or performance problems including, without limitation, those caused by a malicious attack on a project or deployment. \n\n## 5. Acceptable Use\n\n Your use of the Services (which include, for the purposes of this Section 5, participation in the Vercel Community or similar discussion forums, if applicable) must comply with Vercel‚Äôs Acceptable Use Policy , which is incorporated by reference. \n\n## 6. Etiquette\n\n Although Vercel has no obligation to monitor your use of the Services, Vercel may do so by using tools that detect patterns of abuse of Services, and investigating thereafter. Based on the outcome of these investigations, Vercel may prohibit any use of the Services it believes may be (or is alleged to be) in violation of the foregoing. \n\n## 7. Security and Compliance\n\n \n\n## 7.1 General\n You shall configure Your Content, including any of your projects or deployments, such that the transmission, storage, or use in any way will not expose personal data or personal information without proper consent from individuals as determined by applicable law. You shall configure the Services in accordance with the Documentation and properly implement encryption as set forth in the Documentation. Vercel implements regular backups of Your Content and you shall also maintain its own backups of Your Content. Vercel will have no liability to you for any unauthorized access or use of any of Your Content or any corruption, deletion, destruction or loss of any Your Content to the extent that is attributable, in whole or in part, to your misconfigurations or an insecurity in your website or project, malware or malicious content in your website, Your Content or project. If any actual or suspected security incident, vulnerabilities, violations of this Section 7, or issue related to the Services are identified, you shall immediately report it to security@vercel.com . \n \n \n\n## 7.2 PCI Compliance\n Vercel is not a payment processor. To the extent that Your Content or Your Data (as defined below) is subject to the Payment Card Industry Data Security Standards (PCI DSS), you acknowledge that you are responsible for maintaining and monitoring compliance with PCI DSS requirements as prescribed by the PCI Security Standards Council as may be amended from time to time. You agree to comply with Vercel&#x27;s Documentation on appropriate implementation of the Services for processing payments. \n \n \n\n## 7.3 HIPAA Compliance\n You shall not use the Services to host any Protected Health Information or information that is subject to the Health Insurance Portability and Accountability Act (HIPAA), unless you first obtain Vercel&#x27;s prior written approval. \n\n## 8. Data Protection\n\n \n\n## 8.1 International Transfers of Data\n To the extent that Your Content or Your Data (as defined below) is subject to any applicable data protection or privacy law, as defined in Vercel&#x27;s Data Processing Addendum (\"DPA\"), and is processed and/or stored by Vercel on your behalf in connection with the Services, you agree to the terms of the DPA . \n \n \n\n## 8.2 Use of Your Data\n You shall own and retain all right, title and interest in and to Your Data. Vercel may use and disclose Your Data solely to the extent necessary to provide the Services to you and for security to protect the Services and third parties from fraud, illegal activities, abuse, malware, malicious files or content, viruses and the like and for no other purpose. Otherwise, Vercel will not sell, disclose, or share any Your Data (or any part or product thereof) with anyone else. Vercel will implement and maintain reasonable information security policies and processes (including technical, administrative and physical safeguards) that are designed to prevent unauthorized access to or use or disclosure of the Services or any Your Data. \n \n \n\n## 8.3 Aggregate Data\n Vercel shall have the right to collect and analyze data and other information relating to the provision, use and performance of various aspects of the Services and related systems and technologies (excluding Your Data and data derived therefrom), and Vercel will be free (during and after the term hereof) to (i) use such information and data to improve and enhance the Services and for other development, diagnostic and corrective purposes in connection with the Services and other Vercel offerings, and (ii) disclose such data solely in aggregate or other de-identified form in connection with its business. \n \n\n## 9. Usage Restrictions\n\n You will not, directly or indirectly: (i) sublicense, resell, rent, lease, transfer, assign, or otherwise commercially exploit or make the Services available to any third party; (ii) reverse engineer, decompile, disassemble or otherwise attempt to discover the source code, object code or underlying structure, ideas, know-how or algorithms relevant to the Services or any software, documentation or data related to the Services (where reverse engineering is permitted by applicable law obtaining such information as is necessary to achieve interoperability with Vercel&#x27;s services, you must first request such information from Vercel); (iii) modify, translate, or create derivative works based on the Services (except to the extent expressly permitted by Vercel or authorized within the Services) or otherwise attempt to gain unauthorized access to the Services or its related systems or networks; (iii) use the Services for timesharing or service bureau purposes or otherwise for the benefit of a third-party; (iv) remove, alter or obscure in any way any proprietary rights notices (including copyright notices) of Vercel or its suppliers on or within the Services or documentation; (v) violate any applicable laws or regulations (including without limitation in violation of any data, privacy or export control laws) or infringe the rights of any third-party in connection with the use or access of the Services. You shall comply with any codes of conduct, policies or other notices, Vercel provides you or publishes in connection with the Services, and you shall promptly notify Vercel if you learn of a security breach or issue related to the Services. Without limiting the foregoing, you acknowledge that Vercel may establish general practices and limits concerning use of the Services, including without limitation the maximum period of time that data, code or other content will be retained by the Services, the maximum storage space that will be allotted on Vercel&#x27;s servers on your behalf, and the maximum compute capacity provided for the execution of builds and functions and the maximum network data transferred by the Services. You further acknowledge that Vercel reserves the right to change these general practices and limits at any time, in its sole discretion. \n\n## 10. Support\n\n Subject to the terms hereof, Vercel may, but is not required to, provide you with commercially reasonable remote technical support services during Vercel&#x27;s normal business hours (\"Support Services\") in accordance with Vercel&#x27;s current Support Terms and Conditions . \n\n## 11. Electronic Communications\n\n By using the Services, you consent to receiving electronic communications from Vercel. These electronic communications may include notices about applicable Services fees and charges related to the Services and transactional or other information concerning or related to the Services. They may also include notices that require responses and or action to avoid service interruptions. These electronic communications are part of your relationship with Vercel and you receive them as part of your use of the Services. Your account email address must be kept current and maintain a responsive user at all times. You agree that any notices, agreements, disclosures or other communications that Vercel sends you electronically will satisfy any legal communication requirements, including that such communications be in writing. \n\n## 12. Representation and Warranties\n\n \n\n## 12.1. Representations\n You represent and warrant that (i) you own all Your Content or have obtained all permissions, releases, rights or licenses required to engage in posting and other activities (and allow Vercel to perform its obligations) in connection with the Services without obtaining any further releases or consents; (ii) Your Content and other activities in connection with the Services, and Vercel&#x27;s exercise of all rights and license granted by you herein, do not and will not violate, infringe, or misappropriate any third party&#x27;s copyright, trademark, right of privacy, or publicity, or other personal or proprietary right and Your Content is not defamatory, obscene, unlawful, threatening, abusive, tortious, offensive or harassing; and (iii) you will use the Services only in compliance with Vercel&#x27;s standard published policies and documentation then in effect and all applicable laws and regulations. \n \n \n\n## 12.2. Mutual Warranty\n Each party represents and warrants to the other that it has full right and power to enter into and perform under this Agreement, without any third-party consents or conflicts with any other agreement. \n \n\n## 13. Indemnification\n\n You will indemnify and hold harmless Vercel against any claims, actions or demands, including without limitation reasonable legal and accounting fees, arising or resulting from your breach of this Agreement, any claim of infringement or misappropriation arising out of your websites or any of Your Content, or your other access, contribution to, use or misuse of the Services. Vercel shall promptly notify you of any and all threats, claims and proceedings related thereto and give you reasonable assistance and the opportunity to assume sole control over defense and settlement; you will not be responsible for any settlement you do not approve, such approval not to be unreasonably withheld or delayed. \n\n## 14. Confidentiality; Proprietary Rights\n\n \n\n## 14.1. Confidentiality\n Each party (the \"Receiving Party\") understands that the other party (the \"Disclosing Party\") has disclosed or may disclose business, technical, product or financial information or data relating to the Disclosing Party&#x27;s business (hereinafter referred to as \"Proprietary Information\" of the Disclosing Party). Proprietary Information of Vercel includes non-public information regarding features, functionality and performance of the Services. Your Proprietary Information includes non-public personal data provided by you to Vercel to enable the provision of the Services and that you upload to the Services (collectively, \"Your Data\"). The Receiving Party agrees: (i) to take reasonable precautions to protect such Proprietary Information, and (ii) not to use (except in performance of the Services or as otherwise permitted herein) or divulge to any third person any such Proprietary Information. The Disclosing Party agrees that the foregoing shall not apply with respect to any information after five (5) years following the disclosure thereof or any information that the Receiving Party can document (a) is or becomes generally available to the public, or (b) was rightfully in its possession or known by it prior to receipt from the Disclosing Party, or (c) was rightfully disclosed to it without confidentiality restrictions by a third party, or (d) was independently developed without use of any Proprietary Information of the Disclosing Party as evidenced by its internal files. If a Receiving Party is required by law or a governmental agency to disclose the Disclosing Party&#x27;s Proprietary Information, the Receiving Party must provide reasonable notice to the Disclosing Party of such required disclosure so as to permit the Disclosing Party a reasonable period of time to seek a protective order or limit the amount of Proprietary Information to be disclosed. \n \n \n\n## 14.2. Company Ownership\n Vercel shall own and retain all right, title and interest in and to (a) the Services, all improvements, enhancements or modifications thereto and (b) all intellectual property rights related to any of the foregoing. \n \n \n\n## 14.3. Feedback\n To the extent you or any of your users provide any suggestions to Vercel regarding the functioning, features, and other characteristics of the Services, documentation, or other material or services provided or made available by Vercel (\"Feedback\"), you hereby grant Vercel a perpetual, irrevocable, non-exclusive, royalty-free, fully-paid-up, fully transferable, worldwide license (with rights to sublicense through multiple tiers of sublicenses) under all of your intellectual property rights, for Vercel to use and exploit in any manner and for any purpose. \n \n \n\n## 14.4. Customer Name\n During the term of this Agreement, you grant Vercel a non-exclusive, royalty-free, fully-paid up license to use and reproduce your trademarks, tradenames and logos in Vercel&#x27;s marketing materials and website(s) and to indicate that you are a Vercel customer. Vercel will abide by any written trademark usage guidelines provided by you. All goodwill arising out of the use of your trademarks, tradenames and logos shall inure to your benefit. \n\n## 15. Payment of Fees\n\n \n\n## 15.1. Plans\n The Services will be provided according to the plan level you select. There is a free hobby plan and there are paid self-service subscription plans (\"self-service subscriptions\"). For an enterprise license, you may contact Vercel separately. You may opt to upgrade or downgrade to any other plan level that Vercel offers at any time during the period of your plan; provided that a downgrade will not be effective until the next renewal date. For self-service subscriptions, additional Services added to your self-service subscription, and domain registrations, you will be charged a fee and any applicable tax. Fees will be billed to the credit card or other payment account you provide in accordance with the billing terms in effect at the time a fee or charge is due and payable. You acknowledge and agree that Vercel will automatically charge your credit card or other payment account on record with Vercel in connection with your use of the Services: (i) in advance of each self-service subscription term, for the self-service subscription you have selected and any additional Services added to your self-service subscription; (ii) in arrears for any additional Services you have used or added to your self-service subscription during the prior self-service subscription term; and (iii) on purchase of any domain registration and up to thirty (30) days prior to each annual anniversary of your purchase. The self-service subscription and any additional Services added to your self-service subscription will automatically-renew for the same term as the initial term . You represent and warrant to Vercel that all of your payment information is true and that you are authorized to use the payment instrument. You will promptly update your account information with any changes (for example, a change in your billing address or credit card expiration date) that may occur. If payment is not received or cannot be charged to your credit card or other payment account for any reason in advance, Vercel reserves the right to either suspend or terminate your access to the Services and terminate this Agreement and for domain registrations, Vercel may not register the domain or may allow the domain registration to expire. All fees are non-refundable, except as expressly stated otherwise in this Agreement. \n \n \n\n## 15.2. Payments\n All payments shall be made in the currency of, and within the borders of the United States. You will pay all applicable taxes, duties, withholdings, backup withholding and the like; when Vercel has the legal obligation to pay or collect such taxes, the appropriate amount shall be paid by you directly to Vercel. If all or any part of any payment owed to Vercel under this Agreement is withheld, based upon a claim that such withholding is required pursuant to the tax laws of any country or its political subdivisions and/or any tax treaty between the U.S. and any such country, such payment shall be increased by the amount necessary to result in a net payment to Vercel of the amounts otherwise payable under this Agreement. You will reimburse Vercel any pre-approved and agreed upon costs. Vercel may change its fees and payment terms at its discretion; provided however, that such changes will not take effect for you until the start of the next payment period. Vercel will provide written notice to you for any changes to the fees that affect the Services purchased by you. Your continued use of the Services after the price change becomes effective constitutes your agreement to pay the changed amount. \n\n## 16. Term and Termination\n\n \n\n## 16.1. Term\n Subject to earlier termination as provided below, the term of this Agreement will commence on your acceptance of this Agreement and will continue for as long as the Services are being provided to you under this Agreement. The term of your hobby plan, self-service subscription, and any Services purchased or added to your self-service subscription, shall automatically renew for successive terms equal in duration to the initial term unless you cancel your hobby plan or self-service subscription in advance of the renewal date. You have the right to terminate your account (or downgrade your Pro account to a hobby account) at any time by sending a cancellation request to Vercel Support via the Help page provided that such termination will be effective at the start of the next renewal period. Subject to earlier termination as provided below, Vercel may terminate your account and this Agreement at any time by providing thirty (30) days prior notice to the administrative email address associated with your account. In addition to any other remedies Vercel may have, Vercel may also terminate this Agreement upon ten (10) days&#x27; notice (or two (2) days in the case of nonpayment), if you breach any of the terms or conditions of this Agreement. Vercel may terminate your account and this Agreement immediately if you exceed any Vercel limits concerning use of the Services, including without limitation, the maximum period of time that data, code or other content will be retained by the Services, the maximum storage space that will be allotted on Vercel&#x27;s servers on your behalf, and the maximum compute capacity provided for the execution of builds and functions and the maximum network data transferred by the Services. You acknowledge that Vercel reserves the right to terminate accounts that are inactive for an extended period of time and the right to modify or discontinue, temporarily or permanently, the Services (or any part thereof). All of Your Content on the Services (if any) may be permanently deleted by Vercel upon any termination of your account. If Vercel terminates your account without cause and you have signed up for a self-service subscription, Vercel will refund the pro-rated, unearned portion of any amount that you have prepaid to Vercel for such Services. \n \n \n\n## 16.2. Survival\n All sections of this Agreement which by their nature should survive termination will survive termination, including, without limitation, Sections 15.1 and 15.2 , and accrued rights to payment, confidentiality obligations, warranty disclaimers, and limitations of liability. \n \n \n\n## 16.3. Effect of Termination\n Upon the termination of this Agreement for any reason: (i) the licenses granted under this Agreement in respect of the Services shall immediately terminate and you and your users shall cease use of the Services; (ii) Vercel will cease providing any Support Services; (iii) you shall pay to Vercel the full amount of any outstanding fees due hereunder; and (iv) within fourteen (14) calendar days of such termination, each party shall destroy or return all Proprietary Information of the other party in its possession or control, and will not make or retain any copies of such information in any form, except that the receiving party may retain one (1) archival copy of such information solely for purposes of ensuring compliance with this Agreement \n\n## 17. Disclaimer\n\n THE SERVICES AND SUPPORT SERVICES ARE PROVIDED \"AS IS\" AND VERCEL DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. VERCEL DOES NOT WARRANT THAT THE SERVICES OR DELIVERABLES WILL BE UNINTERRUPTED OR ERROR FREE; NOR DOES IT MAKE ANY WARRANTY AS TO THE RESULTS THAT MAY BE OBTAINED FROM USE OF THE SERVICES OR DELIVERABLES. \n\n## 18. Limitation of Liability\n\n \n\n## 18.1. Limit of Liability and Waiver of Consequential Damages\n EXCEPT FOR YOUR BREACH OF SECTIONS 9 , 14 , AND 15 , OR YOUR BREACH OF ANY REPRESENTATIONS OR WARRANTIES OR YOUR INDEMNITY OBLIGATIONS, NEITHER PARTY NOR ITS SUPPLIERS (INCLUDING BUT NOT LIMITED TO ALL EQUIPMENT AND TECHNOLOGY SUPPLIERS), OFFICERS, AFFILIATES, REPRESENTATIVES, CONTRACTORS AND EMPLOYEES SHALL BE RESPONSIBLE OR LIABLE WITH RESPECT TO ANY SUBJECT MATTER OF THIS AGREEMENT OR TERMS AND CONDITIONS RELATED THERETO UNDER ANY CONTRACT, NEGLIGENCE, STRICT LIABILITY OR OTHER THEORY: (A) FOR ERROR OR INTERRUPTION OF USE OR FOR LOSS OR INACCURACY OR CORRUPTION OF DATA OR COST OF PROCUREMENT OF SUBSTITUTE GOODS, SERVICES OR TECHNOLOGY OR LOSS OF BUSINESS; (B) FOR ANY INDIRECT, SPECIAL, EXEMPLARY, INCIDENTAL, CONSEQUENTIAL OR PUNITIVE DAMAGES; OR (C) FOR ANY DIRECT DAMAGES, COSTS, LOSSES, OF LIABILITIES IN AMOUNTS THAT, TOGETHER WITH AMOUNTS ASSOCIATED WITH ALL OTHER CLAIMS, EXCEED THE GREATER OF ONE HUNDRED DOLLARS AND THE FEES PAID BY YOU TO VERCEL FOR THE SERVICES UNDER THIS AGREEMENT IN THE 6 MONTHS PRIOR TO THE ACT THAT GAVE RISE TO THE LIABILITY, IN EACH CASE, WHETHER OR NOT SUCH PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. THE PROVISIONS OF THIS SECTION ALLOCATE THE RISKS UNDER THIS AGREEMENT BETWEEN THE PARTIES, AND THE PARTIES HAVE RELIED ON THESE LIMITATIONS IN DETERMINING WHETHER TO ENTER THIS AGREEMENT. \n \n \n\n## 18.2. Limits\n Some states do not allow the exclusion of implied warranties or limitation of liability for incidental or consequential damages, which means that some of the above limitations may not apply to you. IN THESE STATES, VERCEL&#x27;S LIABILITY WILL BE LIMITED TO THE GREATEST EXTENT PERMITTED BY LAW. \n\n## 19. Miscellaneous\n\n Vercel may change this Agreement from time to time by providing notice either by emailing the email address associated with your account or by posting a notice at https://vercel.com . You can review the most current version of this Agreement at any time at https://vercel.com/legal/terms . The revised Agreement will become effective immediately after Vercel posts or sends you notice of such changes, and if you use the Services after that date, your use will constitute acceptance of the revised Agreement. If any change to this Agreement is not acceptable to you, your only remedy is to stop using the Services and send a cancellation email to Vercel Support via the Help page . If any provision of this Agreement is found to be unenforceable or invalid, that provision will be limited or eliminated to the minimum extent necessary so that this Agreement will otherwise remain in full force and effect and enforceable. You may not assign, transfer or sublicense without the prior written consent of Vercel, but Vercel may assign or transfer this Agreement, in whole or in part, without restriction. Any attempted assignment or transfer of this Agreement by the parties in contravention of the foregoing shall be null and void. This Agreement is the complete and exclusive statement of the mutual understanding of the parties and supersedes and cancels all previous written and oral agreements, communications and other understandings relating to the subject matter of this Agreement, and that all amendments must be in writing signed by both parties, except as otherwise provided herein. Vercel&#x27;s failure to exercise or enforce any right or provision of this Agreement shall not be a waiver of that right. No agency, partnership, joint venture, or employment is created as a result of this Agreement and neither party has any authority of any kind to bind the other party in any respect whatsoever. In any action or proceeding to enforce rights under this Agreement, the prevailing party will be entitled to recover costs and attorneys&#x27; fees. All notices under this Agreement will be in writing and will be deemed to have been duly given when received, if personally delivered; when receipt is electronically confirmed, if transmitted by email; the day after it is sent, if sent for next day delivery by recognized overnight delivery service; and upon receipt, if sent by certified or registered mail, return receipt requested.Any delays in or failure of performance of Vercel shall not constitute a default hereunder or give rise to any claims for damages if, to the extent that, and for such period that, such delays or failures of performance are caused by any events beyond the reasonable control of Vercel including, without limitation, any of the following specific occurrences: acts of God or the public enemy, acts of terrorism, pandemics, epidemics, labor strikes, expropriation or confiscation of facilities, compliance with any unanticipated duly promulgated governmental order, acts of war, rebellion or sabotage or damage resulting therefrom, fires, floods, explosion, or riots. \n\n## 20. Governing Law; Disputes; Arbitration\n\n \n\n## 20.1. Law\n This Agreement shall be governed by the laws of the State of California without regard to its conflict of laws provisions. \n \n \n\n## 20.2. Binding Contract\n You acknowledge that this Agreement is a contract between you and Vercel, even though it may be electronic and may not be physically signed by you and Vercel, and it governs your use of the Services. \n \n \n\n## 20.3 Exclusive Jurisdiction and Venue; Arbitration.\n \n\n## 20.3.1 Disputes with a Domestic Customer\n If you are located and headquartered in the United States of America, you and Vercel each irrevocably and unconditionally consent to the exclusive jurisdiction of the federal and state courts located in the San Francisco County, California for all proceedings arising out of this contract or related to the parties&#x27; relationship, and you and Vercel agree to only institute such proceedings in those courts. You and Vercel also waive any objection to venue in those courts based on improper venue. You and Vercel agree that a final judgment (subject to appeals) in any such proceeding is conclusive and may be enforced in other jurisdictions by suit on the judgment or in another lawful manner. \n\n## 20.3.2. Disputes with a Foreign Customer\n If you are located and headquartered outside of the United States of America, then any action related to this Agreement will be governed by California law. Any dispute between you and Vercel that is not resolved through negotiation will be resolved exclusively by final and binding arbitration conducted in accordance with the then-current Comprehensive Arbitration Rules and Procedures of the Judicial Arbitration and Mediation Services (\" JAMS \"). The arbitration will be conducted by a single arbitrator selected by agreement of you and Vercel or, if you and Vercel cannot agree, an arbitrator appointed in accordance with the JAMS rules who shall be experienced in the type of dispute at issue. You and Vercel, their representatives, the arbitrator, and other participants shall keep confidential the existence, content, and result of the arbitration. Any demand for arbitration and any counterclaim must specify in reasonable detail the facts and legal grounds forming the basis for the claimant&#x27;s claims and include a statement of the total amount of damages claimed, if any, and any other remedy sought by the claimant. The arbitration will be conducted in the English language; the location of such arbitration shall be in San Francisco, California. Each party will bear its own costs in the arbitration. The arbitrator will have full power and authority to determine issues of arbitrability and to interpret or construe the provisions of the agreement documents and to fashion appropriate remedies (including temporary, preliminary, interim, or permanent injunctive relief); provided that the arbitrator will not have any right or authority: (i) in excess of the authority that a court having jurisdiction over the parties and the dispute would have absent this arbitration agreement; or (ii) to award damages in excess of the types and limitation of damages found in the Agreement. Judgment upon the award may be entered in any court of competent jurisdiction. Notwithstanding the agreement to arbitrate, each party may apply at any time to a court of competent jurisdiction for appropriate injunctive relief or for other interim or conservatory measures, and by doing so will not breach or waive the agreement to arbitrate or impair the powers of the arbitrator. \n\n## 20.3.3. Opt-Out\n You have the right to opt-out and not be bound by the arbitration provisions set forth above by sending written notice of your decision to opt-out to: legalnotices@vercel.com with the subject line \"COMPANY ARBITRATION OPT-OUT\". The notice must be sent within thirty (30) days of your first use of the Services, otherwise you shall be bound to arbitrate any disputes in accordance with this Agreement providing for binding arbitration. If you opt-out of these arbitration provisions, Vercel also will not be bound by them. \n\n## 21. Previews\n\n Vercel may elect to provide certain Previews from time to time. Previews are provided \"AS-IS\", \"WITH ALL FAULTS\", and \"AS AVAILABLE\". Vercel&#x27;s warranties, indemnities and SLA terms do not apply to Previews and Support Services are not provided for Previews. Vercel may change, discontinue or terminate your use of Previews at any time without notice. \"Previews\" means Services, releases, features, or functionality provided for preview, pre-release, evaluation, demonstration, beta, or similar uses and purposes. \n\n## Schedule I\n\n Your use of the following Services are subject to the additional terms set forth below, as applicable: \n \n \n\n## 1. Domain Name Registration\n By using or accessing the domain name reservation services, you further acknowledge that you have read, understand, and agree to be bound by the Domain Name Registration and Services Terms which is hereby incorporated into this Agreement. \n \n \n\n## 2. Marketplace\n By using or accessing Vercel‚Äôs Marketplace, you further acknowledge and agree that you have read, understand, and agree to be bound by Vercel‚Äôs Integration Marketplace End User Addendum . \n \n\n## 3. Non-Vercel Services\n Vercel or third parties may distribute Non-Vercel Services. ‚ÄúNon-Vercel Services‚Äù means products, services, tools, or software functionality that interoperates with a Service, that is provided by you, other Vercel users, or any third party, including but not limited to, integrations or connectable accounts available through Marketplace, third-party AI providers available through AI Gateway, community templates, and content, products or software that are otherwise obtained or provided by a person or entity other than Vercel. Your use or purchase of any Non-Vercel Services, and any data exchanged in connection with Non-Vercel Services, is solely between you and the applicable third-party provider, and governed by the terms of service, end user license agreement, privacy notice, and/or any other terms or policies between you and that third party as disclosed or made available within the Services or the Notices and License Information . Vercel does not make any representations, warranties, or guarantees regarding Non-Vercel Services, their providers, their availability, or their conformity to your security or compliance requirements. Vercel‚Äôs support terms do not apply to Non-Vercel Services. Vercel is not responsible for any disclosure, modification, or deletion of Your Content resulting from access by any Non-Vercel Services, or other, direct or indirect, losses, special or consequential damages, or claims arising out of or in connection with Non-Vercel Services. While the Services may contain features designed to interoperate with non-Vercel Services, Vercel cannot guarantee the continued availability of such features of the Services and may cease providing them without entitling you to any refund, credit or other compensation, if, for example, a Non-Vercel Services provider ceases to make the Non-Vercel Services available for interoperation with the Services under circumstances acceptable to Vercel. \n \n\n## 4. AI Products and Services\n By using or accessing Vercel&#x27;s AI Products and Services, you further acknowledge and agree that you have read, understand, and agree to be bound by Vercel&#x27;s AI Product Terms , which are incorporated into this agreement. \n \n\n## 5. DORA\n To the extent that your use of the Services is subject to the Digital Operational Resilience Act, you agree to the terms of the DORA Addendum . Products v0 Build applications with AI AI SDK The AI Toolkit for TypeScript \n \n AI Gateway One endpoint, all your models Vercel Agent An agent that knows your stack Sandbox AI workflows in live environments CI/CD Helping teams ship 6√ó faster Content Delivery Fast, scalable, and reliable Fluid Compute Servers, in serverless form Observability Trace every step Bot Management Scalable bot protection BotID Invisible CAPTCHA Platform Security DDoS Protection, Firewall \n \n \n \n \n \n \n \n \n \n Web Application Firewall Granular, custom protection Resources Customers Trusted by the best teams Blog The latest posts and changes Changelog See what shipped Press Read the latest news Events Join us at an event Docs Vercel documentation Academy Linear courses to level up Knowledge Base Find help quickly Community Join the conversation \n \n \n \n \n \n \n‚Ä¢ \n \n \n \n \n \n \n‚Ä¢ \n \n \n \n \n \n \n \n \n \n \n \n \n \n‚Ä¢ \n \n \n \n \n \n \n‚Ä¢ \n \n \n \n \n \n \n Next.js The native Next.js platform Nuxt The progressive web framework \n \n \n \n \n \n \n \n Svelte The web‚Äôs efficient UI framework \n \n \n \n \n \n‚Ä¢ \n \n \n \n \n \n \n \n \n \n \n \n \n‚Ä¢ \n \n \n \n \n \n \n Turborepo Speed with Enterprise scale Solutions \n \n AI Apps Deploy at the speed of AI Composable Commerce Power storefronts that convert Marketing Sites Launch campaigns fast Multi-tenant Platforms Scale apps with one codebase Web Apps Ship features, not infrastructure Marketplace Extend and automate workflows Templates Jumpstart app development Partner Finder Get help from solution partners Platform Engineers Automate away repetition \n \n \n \n Design Engineers Deploy for every idea",
      "chunk_ids": [],
      "metadata": {
        "source_type": "tos",
        "source_name": "Vercel",
        "url": "https://vercel.com/legal/terms"
      },
      "is_distractor": false,
      "semantic_tags": [
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "termination",
        "tos",
        "vercel",
        "warranty"
      ],
      "content_hash": "3ba64dc6f68536a1",
      "size_bytes": 41425,
      "created_at": "2026-01-02T20:42:23.533940"
    },
    {
      "doc_id": "legal_tos_netlify",
      "source": "online",
      "category": "legal",
      "domain": "legal_tos",
      "file_path": "https://www.netlify.com/legal/terms-of-use/",
      "content": "Netlify Website Terms of Use | Netlify \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n\n‚Ä¢ \n \n\n## Netlify Website Terms of Use\n\n Last Updated: November 1st, 2023 \n By using or accessing the Netlify website (the ‚Äú Website ‚Äù), You agree to be bound and abide by the terms and conditions of these Terms of Use (‚Äú Terms ‚Äù). If you do not agree to these Terms, you should not access or use the Website. \n Netlify‚Äôs software, solutions and services (‚Äú Services ‚Äù) offered on the Website are governed by the the Self-Serve Subscription Agreement or the Enterprise Master Subscription Agreement , as applicable. \n All information provided by you in connection with the Website shall be subject to the Netlify Privacy Policy \n\n## 1. Age and Eligibility\n\n You certify that you are a person at least 13 years of age. If you are a resident of a country outside the United States, your country‚Äôs minimum age may be older; in such a case, you are responsible for complying with your country‚Äôs laws. \n The Website may only be used or accessed through an electronic device controlled of you at all times. \n\n## 2. Temporary Use License\n\n While you are authorised to use the Services, or if no term is stated on a one-time temporary basis, you are granted a limited, revocable, non-exclusive, non-transferable license, without the right to sublicense, subject to your compliance with these Terms, to access and use the Website. You are not granted a license or any other right to copy or store any of the Website (including any portion of the software or documentation) on any computer or other device. \n Netlify shall own and retain all right, title and interest in and to its Website(s) and related software, all improvements, enhancements or modifications thereto, and all intellectual property rights associated with the foregoing. Except for the limited access rights expressly granted in this paragraph, You obtain no rights to the Website or Netlify‚Äôs intellectual property rights by implication, estoppel or otherwise. \n\n## 3. Your Content\n\n By submitting, posting or publishing your content, suggestions, enhancement requests, recommendations, feedback, information, comments or transmitting your data (‚Äú Content ‚Äù) through this Website, you are granting Netlify a perpetual, irrevocable, worldwide, non-exclusive, royalty-free right and license (with the right to sub-license) to use, incorporate, exploit, display, perform, reproduce, distribute, and prepare derivative works of your Content. By posting and publishing your Content, you represent and warrant that your Content does not infringe, violate or misappropriate any third-party right, including any copyright, trademark, patent, trade secret, moral right, privacy right, right of publicity, or any other intellectual property or proprietary right or slander, defame or libel any third party. \n Netlify does not allow any of the following Content, or links to such Content, to be published on the Website: \n \n\n‚Ä¢ \n Content of an illegal nature (including stolen copyrighted material). \n \n\n‚Ä¢ \n Pirated software sites, including cracking programs or cracking program archives. \n \n\n‚Ä¢ \n Content with the purpose of causing harm or inciting hate, or content that could be reasonably considered as slanderous or libelous. \n \n \n Your posting any of the above Content on the Website will result in a notice to your current email address on file. Normally a grace period of 48 hours to take corrective actions will be given, but you risk immediate account termination if Netlify deems this necessary. A violation of these Terms can lead to termination and removal of your website project without notice. \n Netlify shall have the right to collect and analyze data and other information relating to the provision, use and performance of various aspects of the Website and related systems. Netlify will use such data to administer, improve and develop its products and services, including the Services; and Netlify may share aggregated information and non-identifying information with third parties. You acknowledge that Netlify may also share any Content and Your information if the disclosure is necessary to comply with a valid court order or subpoena. \n\n## 4. Acceptable Use\n\n When you access and use the Website you shall comply with Netlify‚Äôs Acceptable Use Policy, available here: https://www.netlify.com/legal/acceptable-use-policy \n\n## 5. Netlify Etiquette\n\n You are prohibited from using Netlify for the propagation, distribution, housing, processing, storing, or otherwise handling any material in any way which Netlify deems, in its sole discretion, to be objectionable. This also includes links or any connection to such materials. The designation of any materials as objectionable is left entirely to the sole discretion of the Netlify management. Although Netlify has no obligation to monitor your use of the Website, Netlify may do so and may prohibit any use it reasonably believes may be in violation of these Terms. \n\n## 6. Third-Party Websites.\n\n The Website may contain links to third-party websites. Such linked websites are not under Netlify‚Äôs control, and Netlify is not responsible for their content. \n\n## 7. Warranty Disclaimer\n\n THE WEBSITE AND ALL ITS CONTENT ARE MADE AVAILABLE TO YOU ON AN ‚ÄúAS IS‚Äù AND ‚ÄúAS AVAILABLE‚Äù BASIS, AND NETLIFY EXPRESSLY DISCLAIMS ALL WARRANTIES, WHETHER EXPRESS OR IMPLIED, INCLUDING IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT. NETLIFY DOES NOT WARRANT THAT THE WEBSITE WILL BE UNINTERRUPTED OR ERROR FREE; NOR DOES NETLIFY MAKE ANY WARRANTY AS TO THE RESULTS THAT MAY BE OBTAINED FROM USE OF THE WEBSITE OR ITS CONTENT. NETLIFY HAS NO OBLIGATION TO MONITOR, CONTROL, OR VET USER CONTENT OR DATA, AND NETLIFY MAKES NO CLAIMS OR WARRANTIES ABOUT THE QUALITY, ACCURACY, OR RELIABILITY OF THE WEBSITE CONTENT, SOFTWARE AND SOLUTIONS OFFERED THROUGH THE WEBSITE, ITS SAFETY OR SECURITY, OR THE WEBSITE‚ÄôS INTEROPERABILITY, UNAVAILABILITY OR SECURITY VULNERABILITIES. SOME JURISDICTIONS MAY PROHIBIT A DISCLAIMER OF WARRANTIES AND YOU MAY HAVE OTHER RIGHTS THAT VARY FROM JURISDICTION TO JURISDICTION. \n\n## 8. Indemnity\n\n You shall indemnify, defend and hold harmless Netlify and its officers, directors and employees, from and against all third party claims, losses, damages, costs and liabilities, including reasonable attorneys‚Äô fees, arising out of or relating to your use of the Website, your Content, or any products or services offered by you to a third party, or obtained by you from a third party, via the Website. \n\n## 9. Limited Liability\n\n IN NO EVENT WILL NETLIFY BE LIABLE TO YOU FOR LOST PROFITS, LOST REVENUES, LOSS OF GOODWILL, WORK STOPPAGE, COMPUTER AND/OR DEVICE OR TECHNOLOGY FAILURE OR MALFUNCTION OR FOR ANY FORM OF DIRECT OR INDIRECT, SPECIAL, INCIDENTAL, CONSEQUENTIAL, EXEMPLARY OR PUNITIVE DAMAGES BASED ON ANY CAUSES OF ACTION ARISING OUT OF OR RELATING TO YOUR ACCESS TO OR USE OF, OR YOUR INABILITY TO ACCESS OR USE, THE WEBSITE OR ANY MATERIALS OR CONTENT ON THE WEBSITE, WHETHER BASED ON WARRANTY, CONTRACT, TORT (INCLUDING NEGLIGENCE) STATUTE, OR ANY OTHER LEGAL THEORY, WHETHER OR NOT NETLIFY HAS BEEN INFORMED OF THE POSSIBILITY OF SUCH DAMAGE. NETLIFY‚ÄôS AGGREGATE LIABILITY FOR ALL CLAIMS, LOSSES, LIABILITIES OR DAMAGES IN CONNECTION WITH THIS AGREEMENT, YOUR ACCESS TO OR USE OF, OR YOUR INABILITY TO ACCESS OR USE, THE WEBSITE OR CONTENT ON THE WEBSITE, WHETHER AS A RESULT OF BREACH OF CONTRACT, TORT (INCLUDING NEGLIGENCE) OR OTHERWISE, REGARDLESS OF THE THEORY OF LIABILITY, IS LIMITED TO NO MORE THAN THE LESSER OF (A) THE TOTAL FEES PAID BY YOU IN THE THEN-CURRENT MONTH OR (B) ONE HUNDRED DOLLARS (US $100). \n IF APPLICABLE LAW DOES NOT ALLOW ALL OR ANY PART OF THE ABOVE LIMITATION OF LIABILITY TO APPLY TO YOU, THE LIMITATIONS WILL APPLY TO YOU ONLY TO THE EXTENT PERMITTED BY APPLICABLE LAW. \n\n## 10. Governing Law\n\n These terms shall be governed and construed in accordance with the laws of the State of California without giving effect to conflict of law principles. You and Netlify agree to submit to the personal and exclusive jurisdiction of the state and federal courts located within San Francisco County, California for the purpose of litigating all disputes. \n\n## 11. Policies\n\n You shall use the Website only in compliance with Netlify‚Äôs published policies then in effect (including Netlify‚Äôs Privacy Policy found at https://www.netlify.com/privacy/ ) and all applicable laws and regulations. \n\n## 12. General\n\n These Terms constitute the entire and exclusive agreement between you and Netlify regarding use of and access to the Website. You may not assign or transfer these Terms or your rights hereunder, in whole or in part, by operation of law or otherwise, without Netlify‚Äôs prior written consent. Netlify may assign these Terms at any time without notice. The failure to require performance of any provision will not affect Netlify‚Äôs right to require performance at any time thereafter, nor will a waiver of any breach or default of these Terms or any provision of these Terms constitute a waiver of any subsequent breach or default or a waiver of the provision itself. In the event that any part of these Terms is held to be invalid or unenforceable, the unenforceable part will be given effect to the greatest extent possible and the remaining parts will remain in full force and effect. Neither Netlify nor you will be in violation of these Terms if a failure to perform any obligation (other than failure to pay) is due to an event beyond such party‚Äôs control, such as significant failure of a part of the power grid, significant failure of the Internet, natural disaster, war, riot, insurrection, epidemic, strikes or other organized labor action, terrorism, or other similar events. Upon termination or expiration of these Terms, any provision that by its nature or express terms should survive will survive such termination or expiration. \n\n## 13. Contract Revisions\n\n Netlify may revise these Terms from time to time. The revised Terms will supersede prior versions. Unless stated otherwise, revisions will be effective upon the effective date indicated at the top of these Terms. We encourage you to check the effective date of these Terms whenever you visit Netlify‚Äôs website or log in to your Netlify account. Your continued access or use of the Website constitutes your acceptance of any revisions. If you do not agree to the revisions, you should stop using the Website. \n\n## 14. Contact Information\n\n The Website is offered by Netlify, Inc., located at 101 2nd Street, San Francisco, CA 94105. You may contact us by sending correspondence to 101 2nd Street, San Francisco, CA 94105-2239, Attn: Netlify Legal dept, or by emailing us at support@netlify.com . Report misuse of the Services or Website at fraud@netlify.com . If you are a California resident, you may have these Terms mailed to you electronically by sending a letter to the foregoing address with your electronic mail address and a request for these Terms. Ask Netlify",
      "chunk_ids": [],
      "metadata": {
        "source_type": "tos",
        "source_name": "Netlify",
        "url": "https://www.netlify.com/legal/terms-of-use/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "governing_law",
        "indemnification",
        "legal",
        "liability",
        "netlify",
        "termination",
        "tos",
        "warranty"
      ],
      "content_hash": "14e91d4b058a9f5b",
      "size_bytes": 11114,
      "created_at": "2026-01-02T20:42:23.534039"
    },
    {
      "doc_id": "legal_privacy_datacorp_template",
      "source": "synthetic",
      "category": "legal",
      "domain": "legal_privacy",
      "file_path": "template://privacy/datacorp",
      "content": "PRIVACY POLICY\n\nEffective Date: January 1, 2025\n\n1. INTRODUCTION\nDataCorp (\"we,\" \"us,\" or \"our\") is committed to protecting your privacy. This\nPrivacy Policy explains how we collect, use, disclose, and safeguard your\ninformation when you use our services.\n\n2. INFORMATION WE COLLECT\n2.1 Personal Information\nWe may collect personal information that you voluntarily provide, including:\n- Name and contact information\n- Account credentials\n- Payment information\n- Communication preferences\n\n2.2 Automatically Collected Information\nWhen you use our services, we automatically collect:\n- Device information (IP address, browser type, operating system)\n- Usage data (pages visited, features used, timestamps)\n- Cookies and similar technologies\n\n3. HOW WE USE YOUR INFORMATION\nWe use the collected information to:\n- Provide and maintain our services\n- Process transactions and send related information\n- Send promotional communications (with your consent)\n- Respond to inquiries and provide customer support\n- Improve our services and develop new features\n- Comply with legal obligations\n\n4. INFORMATION SHARING\nWe may share your information with:\n- Service providers who assist in our operations\n- Business partners for joint offerings\n- Legal authorities when required by law\n- Successors in the event of a merger or acquisition\n\n5. DATA RETENTION\nWe retain your personal information for as long as necessary to fulfill the\npurposes outlined in this Privacy Policy, unless a longer retention period is\nrequired by law.\n\n6. YOUR RIGHTS\nDepending on your jurisdiction, you may have rights to:\n- Access your personal information\n- Correct inaccurate data\n- Delete your information\n- Object to processing\n- Data portability\n- Withdraw consent\n\n7. SECURITY\nWe implement appropriate technical and organizational measures to protect your\npersonal information against unauthorized access, alteration, disclosure, or\ndestruction.\n\n8. CHILDREN'S PRIVACY\nOur services are not intended for children under 13. We do not knowingly\ncollect personal information from children under 13.\n\n9. INTERNATIONAL TRANSFERS\nYour information may be transferred to and processed in countries other than\nyour country of residence. We ensure appropriate safeguards are in place.\n\n10. CHANGES TO THIS POLICY\nWe may update this Privacy Policy from time to time. We will notify you of\nmaterial changes by posting the new policy on our website.\n\n11. CONTACT US\nIf you have questions about this Privacy Policy, please contact us at privacy@datacorp.example.com.\n",
      "chunk_ids": [],
      "metadata": {
        "source_type": "privacy",
        "source_name": "DataCorp (Template)",
        "url": "template://privacy/datacorp"
      },
      "is_distractor": false,
      "semantic_tags": [
        "datacorp_(template)",
        "legal",
        "privacy"
      ],
      "content_hash": "3b6c04529f915994",
      "size_bytes": 2523,
      "created_at": "2026-01-02T20:42:23.534078"
    },
    {
      "doc_id": "legal_privacy_privacyfirst_template",
      "source": "synthetic",
      "category": "legal",
      "domain": "legal_privacy",
      "file_path": "template://privacy/privacyfirst",
      "content": "PRIVACY POLICY\n\nEffective Date: January 1, 2025\n\n1. INTRODUCTION\nPrivacyFirst (\"we,\" \"us,\" or \"our\") is committed to protecting your privacy. This\nPrivacy Policy explains how we collect, use, disclose, and safeguard your\ninformation when you use our services.\n\n2. INFORMATION WE COLLECT\n2.1 Personal Information\nWe may collect personal information that you voluntarily provide, including:\n- Name and contact information\n- Account credentials\n- Payment information\n- Communication preferences\n\n2.2 Automatically Collected Information\nWhen you use our services, we automatically collect:\n- Device information (IP address, browser type, operating system)\n- Usage data (pages visited, features used, timestamps)\n- Cookies and similar technologies\n\n3. HOW WE USE YOUR INFORMATION\nWe use the collected information to:\n- Provide and maintain our services\n- Process transactions and send related information\n- Send promotional communications (with your consent)\n- Respond to inquiries and provide customer support\n- Improve our services and develop new features\n- Comply with legal obligations\n\n4. INFORMATION SHARING\nWe may share your information with:\n- Service providers who assist in our operations\n- Business partners for joint offerings\n- Legal authorities when required by law\n- Successors in the event of a merger or acquisition\n\n5. DATA RETENTION\nWe retain your personal information for as long as necessary to fulfill the\npurposes outlined in this Privacy Policy, unless a longer retention period is\nrequired by law.\n\n6. YOUR RIGHTS\nDepending on your jurisdiction, you may have rights to:\n- Access your personal information\n- Correct inaccurate data\n- Delete your information\n- Object to processing\n- Data portability\n- Withdraw consent\n\n7. SECURITY\nWe implement appropriate technical and organizational measures to protect your\npersonal information against unauthorized access, alteration, disclosure, or\ndestruction.\n\n8. CHILDREN'S PRIVACY\nOur services are not intended for children under 13. We do not knowingly\ncollect personal information from children under 13.\n\n9. INTERNATIONAL TRANSFERS\nYour information may be transferred to and processed in countries other than\nyour country of residence. We ensure appropriate safeguards are in place.\n\n10. CHANGES TO THIS POLICY\nWe may update this Privacy Policy from time to time. We will notify you of\nmaterial changes by posting the new policy on our website.\n\n11. CONTACT US\nIf you have questions about this Privacy Policy, please contact us at privacy@privacyfirst.example.com.\n",
      "chunk_ids": [],
      "metadata": {
        "source_type": "privacy",
        "source_name": "PrivacyFirst (Template)",
        "url": "template://privacy/privacyfirst"
      },
      "is_distractor": false,
      "semantic_tags": [
        "legal",
        "privacy",
        "privacyfirst_(template)"
      ],
      "content_hash": "e070110e2bd3c6db",
      "size_bytes": 2531,
      "created_at": "2026-01-02T20:42:23.534087"
    },
    {
      "doc_id": "legal_privacy_securecloud_template",
      "source": "synthetic",
      "category": "legal",
      "domain": "legal_privacy",
      "file_path": "template://privacy/securecloud",
      "content": "PRIVACY POLICY\n\nEffective Date: January 1, 2025\n\n1. INTRODUCTION\nSecureCloud (\"we,\" \"us,\" or \"our\") is committed to protecting your privacy. This\nPrivacy Policy explains how we collect, use, disclose, and safeguard your\ninformation when you use our services.\n\n2. INFORMATION WE COLLECT\n2.1 Personal Information\nWe may collect personal information that you voluntarily provide, including:\n- Name and contact information\n- Account credentials\n- Payment information\n- Communication preferences\n\n2.2 Automatically Collected Information\nWhen you use our services, we automatically collect:\n- Device information (IP address, browser type, operating system)\n- Usage data (pages visited, features used, timestamps)\n- Cookies and similar technologies\n\n3. HOW WE USE YOUR INFORMATION\nWe use the collected information to:\n- Provide and maintain our services\n- Process transactions and send related information\n- Send promotional communications (with your consent)\n- Respond to inquiries and provide customer support\n- Improve our services and develop new features\n- Comply with legal obligations\n\n4. INFORMATION SHARING\nWe may share your information with:\n- Service providers who assist in our operations\n- Business partners for joint offerings\n- Legal authorities when required by law\n- Successors in the event of a merger or acquisition\n\n5. DATA RETENTION\nWe retain your personal information for as long as necessary to fulfill the\npurposes outlined in this Privacy Policy, unless a longer retention period is\nrequired by law.\n\n6. YOUR RIGHTS\nDepending on your jurisdiction, you may have rights to:\n- Access your personal information\n- Correct inaccurate data\n- Delete your information\n- Object to processing\n- Data portability\n- Withdraw consent\n\n7. SECURITY\nWe implement appropriate technical and organizational measures to protect your\npersonal information against unauthorized access, alteration, disclosure, or\ndestruction.\n\n8. CHILDREN'S PRIVACY\nOur services are not intended for children under 13. We do not knowingly\ncollect personal information from children under 13.\n\n9. INTERNATIONAL TRANSFERS\nYour information may be transferred to and processed in countries other than\nyour country of residence. We ensure appropriate safeguards are in place.\n\n10. CHANGES TO THIS POLICY\nWe may update this Privacy Policy from time to time. We will notify you of\nmaterial changes by posting the new policy on our website.\n\n11. CONTACT US\nIf you have questions about this Privacy Policy, please contact us at privacy@securecloud.example.com.\n",
      "chunk_ids": [],
      "metadata": {
        "source_type": "privacy",
        "source_name": "SecureCloud (Template)",
        "url": "template://privacy/securecloud"
      },
      "is_distractor": false,
      "semantic_tags": [
        "legal",
        "privacy",
        "securecloud_(template)"
      ],
      "content_hash": "a28c8276fd4ebaee",
      "size_bytes": 2529,
      "created_at": "2026-01-02T20:42:23.534094"
    },
    {
      "doc_id": "legal_privacy_github_privacy",
      "source": "online",
      "category": "legal",
      "domain": "legal_privacy",
      "file_path": "https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement",
      "content": "‚Ä¢ \n‚Ä¢ GitHub General Privacy Statement - GitHub Docs \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ \n‚Ä¢ Skip to main content \n\n## GitHub General Privacy Statement\n \n\n## In this article\n \n\n## GitHub Privacy Statement \n\n Effective date: February 1, 2024 \n Welcome to the GitHub Privacy Statement. This is where we describe how we handle your ‚ÄúPersonal Data‚Äù, which is information that is directly linked or can be linked to you. It applies to the Personal Data that GitHub, Inc. or GitHub B.V., processes as the ‚ÄúData Controller‚Äù when you interact with websites, applications, and services that display this Statement (collectively, ‚ÄúServices‚Äù). This Statement does not apply to services or products that do not display this Statement, such as Previews, where relevant. \n\n## End User Notice: Organization-Provided GitHub Accounts \n\n When a school or employer supplies your GitHub account, they assume the role of Data Controller for most Personal Data used in our Services. This enables them to: \n \n\n‚Ä¢ Manage and administer your GitHub account, including adjusting privacy settings. \n\n‚Ä¢ Access and utilize your Personal Data, which includes details on how you use the Services, as well as your content and files. \n \n Should you access a GitHub Service through an account provided by an organization, such as your employer or school, the organization becomes the Data Controller, and this Privacy Statement's direct applicability to you changes. Even so, GitHub remains dedicated to preserving your privacy rights. In such circumstances, GitHub functions as a Data Processor, adhering to the Data Controller's instructions regarding your Personal Data's processing. A Data Protection Agreement governs the relationship between GitHub and the Data Controller. For further details regarding their privacy practices, please refer to the privacy statement of the organization providing your account. \n In cases where your organization grants access to GitHub products, GitHub acts as the Data Controller solely for specific processing activities. These activities are clearly defined in a contractual agreement with your organization, known as a Data Protection Agreement. You can review our standard Data Protection Agreement at GitHub Data Protection Agreement . For those limited purposes, this Statement governs the handling of your Personal Data. For all other aspects of GitHub product usage, your organization's policies apply. \n\n## Third Party Access and Data Protection \n\n When you use third-party extensions, integrations, or follow references and links within our Services, the privacy policies of these third parties apply to any Personal Data you provide or consent to share with them. Their privacy statements will govern how this data is processed. \n\n## Personal Data We Collect \n\n Personal Data is collected from you directly, automatically from your device, and also from third parties. The Personal Data GitHub processes when you use the Services depends on variables like how you interact with our Services (such as through web interfaces, desktop or mobile applications), the features you use (such as pull requests, Codespaces, or GitHub Copilot) and your method of accessing the Services (your preferred IDE). Below, we detail the information we collect through each of these channels: \n\n## From You \n\n \n\n‚Ä¢ Account Data: We collect certain information when you open an account such as your GitHub handle, name, email address, password, payment information and transaction information. \n\n‚Ä¢ User Content and Files: When you use our Services, we collect Personal Data included as part of the information you provide such as code, inputs, text, documents, images, or feedback. \n\n‚Ä¢ Demographic information: In some cases, you provide us with ethnicity, gender, or similar demographic details. \n\n‚Ä¢ Feedback Data: This consists of information you submit through surveys, reviews, or interactive features. \n\n‚Ä¢ Payment Information: For paid subscriptions, we collect details like name, billing address, and payment specifics. \n\n‚Ä¢ Profile Information: We collect information to create a user profile, which may include a photo, additional email addresses, job title, or biography. \n\n‚Ä¢ Sales and Marketing Data: This includes information provided for promotional communications, such as name, email address, and company name. \n\n‚Ä¢ Support Data: When you seek customer support, we collect details like code, text, or multimedia files. \n \n\n## Automatically \n\n \n\n‚Ä¢ Buttons, Tools, and Content from Other Companies: Our Services may contain links or buttons that lead to third-party services like Twitter or LinkedIn. Use of these features may result in data collection. Engaging with these buttons, tools, or content may automatically send certain browser information to these companies. Please review the privacy statements of these companies for more information. \n\n‚Ä¢ Essential Cookies and Similar Tracking Technologies: We use cookies and similar technologies to provide essential functionality like storing settings and recognizing you while using our Services. \n\n‚Ä¢ Non-essential Cookies: Depending on your jurisdiction, we may use online analytics products that use cookies to help us analyze how de-identified users use our Services and to enhance your experience when you use the Services. We may also employ third-party Cookies to gather data for interest-based advertising. In some jurisdictions, we only use non-essential cookies after obtaining your consent. See this section for more details and control options. \n\n‚Ä¢ Email Marketing Interactions: Our emails may have web beacons that offer information on your device type, email client, email reception, opens, and link clicks. \n\n‚Ä¢ Geolocation Information: Depending on the Service's functionality, we collect regional geolocation data. \n\n‚Ä¢ Service Usage Information: We collect data about your interactions with the Services, such as IP address, device information, session details, date and time of requests, device type and ID, operating system and application version, information related to your contributions to repositories, and performance of specific features or Services. \n\n‚Ä¢ Website Usage Data: We automatically log data about your Website interactions, including the referring site, date and time of visit, pages viewed, and links clicked. \n \n\n## From Third Parties \n\n \n\n‚Ä¢ Information from Other Users of the Services: Other users may share information about you when they submit issues and comments. We may also receive information about you if you are identified as a representative or administrator on your company's account. \n\n‚Ä¢ Publicly Available Sources: We may acquire information about you from publicly available sources like public GitHub repositories. \n\n‚Ä¢ Services you linked to your GitHub account: When you or your administrator integrate third-party apps or services with our Services, we receive information based on your settings with those services. This can include details like your name and email from services like Google for authentication. The information we receive depends on the third-party's settings and privacy policies. Always review these to understand what data is shared with our Services. \n\n‚Ä¢ Vendors, Partners, and Affiliates: We may receive information about you from third parties, like vendors, resellers, partners, or affiliates for the purposes outlined in this statement. \n \n\n## Processing Purposes: How We Use Your Personal Data \n\n The Personal Data we process depends on your interaction and access methods with our Services, including the interfaces (web, desktop, mobile apps), features used (pull requests, Codespaces, GitHub Copilot), and your preferred access tools (like your IDE). This section details all the potential ways GitHub may process your Personal Data: \n \n\n‚Ä¢ Business Operations: We use Personal Data for activities like billing, accounting, and compensation. This includes creating aggregated statistical data for internal reporting, financial reporting, revenue planning, capacity planning, and forecast modeling (including product strategy). \n\n‚Ä¢ Communication: We use Personal Data to inform you about new Services, features, offers, promotions, and other pertinent information. This also includes sending confirmations, invoices, technical notices, updates, security alerts, and administrative messages. \n\n‚Ä¢ Inference: We generate new information from other data we collect to derive likely preferences or other characteristics. For instance, we infer your general geographic location based on your IP address. \n\n‚Ä¢ Personalization: We use Personal Data to customize the Service to your preferences, to evaluate the effectiveness of enterprise business ads and promotional communications, and to ensure a seamless and consistent user experience. \n\n‚Ä¢ Safety and Security: To promote safety, integrity, and security across our Services, we process Personal Data, using both automated and, at times, manual techniques for abuse detection, prevention, and violations of terms of service. \n\n‚Ä¢ Service Provision: We use Personal Data to deliver and update our Services as configured and used by You, and to make ongoing personalized experiences and recommendations. \n\n‚Ä¢ Troubleshooting: We use Personal Data to identify and resolve technical issues. \n\n‚Ä¢ Ongoing Service Performance: Personal Data helps us keep the Services up to date and performant, and meet user productivity, reliability, efficacy, quality, privacy, accessibility and security needs. \n\n‚Ä¢ Complying with and resolving legal obligations: including responding to Data Subject Requests for Personal Data processed by GitHub as Controller (for example website data), tax requirements, agreements and disputes. \n\n‚Ä¢ Delivering Professional Services: We use Personal Data to deliver training, consulting or implementation (‚ÄúProfessional Services‚Äù). This includes providing technical support, professional planning, advice, guidance, data migration, deployment, and solution/software development services. \n\n‚Ä¢ Improving Professional Services: Enhancing delivery, efficacy, quality, and security of Professional Services and the underlying product(s) based on issues identified while providing Professional Services, including fixing software defects, and otherwise keeping the Professional Services up to date and performant. \n \n When carrying out these activities, GitHub practices data minimization and uses the minimum amount of Personal Information required. \n\n## Sharing of Personal Data \n\n We may share Personal Data with the following recipients: \n \n\n‚Ä¢ Abuse and Fraud Prevention Entities: We may disclose Personal Data based on a good faith belief it is needed to prevent fraud, abuse, or attacks on our Services, or to protect the safety of GitHub and our users. \n\n‚Ä¢ Affiliates: Personal Data may be shared with GitHub affiliates, including Microsoft, to facilitate customer service, marketing and advertising, order fulfillment, billing, technical support, and legal and compliance obligations. Our affiliates may only use the Personal Data in a manner consistent with this Privacy Statement. \n\n‚Ä¢ GitHub Organization Accounts: If an organization adds you to their GitHub account, we might share Personal Data with that organization to fulfill the commercial relationship. In such a case, your use of the Services is protected by a data protection agreement and terms between your organization and GitHub \n\n‚Ä¢ Competent Authorities: We may disclose Personal Data to authorized law enforcement, regulators, courts, or other public authorities in response to lawful requests or to protect our rights and safety. Please refer to our Guidelines for Legal Requests of User Data for more information. \n\n‚Ä¢ Corporate Transaction Entities: we might disclose Personal Data within the limits of the law and in accordance with this Privacy Statement for strategic business transactions such as sales or a merger. \n\n‚Ä¢ Partners and Resellers: We cooperate with third-parties that offer sales, consulting, support, and technical services for our Services. We may share your data with these partners and resellers where allowed, and with your consent when required. \n\n‚Ä¢ Subprocessors and Service Providers: We may use vendors to provide services on our behalf, including hosting, marketing, advertising, social, analytics, support ticketing, credit card processing, or security services. They are bound by contractual obligations to ensure the security, privacy, and confidentiality of your information. Please visit https://docs.github.com/en/site-policy/privacy-policies/github-subprocessors to see our list of Subprocessors. \n\n‚Ä¢ Visual Studio Code (GitHub Codespaces): GitHub Codespaces and github.dev offer Visual Studio Code in a web browser, where some telemetry is collected by default. Details on telemetry collection are on the VS Code website . To opt out, go to File > Preferences > Settings in the top left menu of VS Code. Opting out will sync this preference across all future web sessions in GitHub Codespaces and github.dev. \n\n‚Ä¢ Other Third-party Applications: Upon your instruction, we may share Personal Data with third-party applications available on our Marketplace. You are responsible for the data you instruct us to share with these applications. \n\n‚Ä¢ Other Users and the Public: Depending on your account settings, we may share Personal Data with other users of the Services and the public. You control what information is made public. To adjust your settings, visit User Settings in your profile. Please be aware that any information you share in a collaborative context may become publicly accessible. \n \n\n## Private repositories: GitHub Access \n\n If your GitHub account has private repositories, you control the access to that information. GitHub personnel does not access private repository information without your consent except as provided in this Privacy Statement and for: \n \n\n‚Ä¢ security purposes \n\n‚Ä¢ automated scanning or manual review for known vulnerabilities, active malware, or other content known to violate our Terms of Service \n\n‚Ä¢ to assist the repository owner with a support matter \n\n‚Ä¢ to maintain the integrity of the Services, or \n\n‚Ä¢ to comply with our legal obligations if we have reason to believe the contents are in violation of the law. \n \n GitHub will provide you with notice regarding private repository access unless doing so is prohibited by law or if GitHub acted in response to a security threat or other risk to security. \n\n## Lawful Bases for Processing Personal Data (Applicable to EEA and UK End Users) \n\n GitHub processes Personal Data in compliance with the GDPR, ensuring a lawful basis for each processing activity. The basis varies depending on the data type and the context, including how you access the services. Our processing activities typically fall under these lawful bases: \n \n\n‚Ä¢ Contractual Necessity: Processing is required to fulfill our contractual duties to you, in accordance with the GitHub Terms of Service. \n\n‚Ä¢ Legal Obligation: We process data when it's necessary to comply with applicable laws or to protect the rights, safety, and property of GitHub, our affiliates, users, or third parties. \n\n‚Ä¢ Legitimate Interests: We process data for purposes that are in our legitimate interests, such as securing our Services, communicating with you, and improving our Services. This is done only when these interests are not overridden by your data protection rights or your fundamental rights and freedoms. \n\n‚Ä¢ Consent: We process data when you have explicitly consented to such processing. When we rely on consent as the legal basis, you have the right to withdraw your consent for data processing at any time. The procedures for withdrawal are detailed in this Statement and available on our website. \n \n\n## Your Privacy Rights \n\n Depending on your residence location, you may have specific legal rights regarding your Personal Data: \n \n\n‚Ä¢ The right to access the data collected about you \n\n‚Ä¢ The right to request detailed information about the specific types of Personal Data we've collected over the past 12 months, including data disclosed for business purposes \n\n‚Ä¢ The right to rectify or update inaccurate or incomplete Personal Data under certain circumstances \n\n‚Ä¢ The right to erase or limit the processing of your Personal Data under specific conditions \n\n‚Ä¢ The right to object to the processing of your Personal Data, as allowed by applicable law \n\n‚Ä¢ The right to withdraw consent, where processing is based on your consent \n\n‚Ä¢ The right to receive your collected Personal Data in a structured, commonly used, and machine-readable format to facilitate its transfer to another company, where technically feasible \n \n To exercise these rights, please send an email to privacy[at]github[dot]com and follow the instructions provided. To verify your identity for security, we may request extra information before addressing your data-related request. Please contact our Data Protection Officer at dpo[at]github[dot]com for any feedback or concerns. Depending on your region, you have the right to complain to your local Data Protection Authority. European users can find authority contacts on the European Data Protection Board website, and UK users on the Information Commissioner‚Äôs Office website. \n We aim to promptly respond to requests in compliance with legal requirements. Please note that we may retain certain data as necessary for legal obligations or for establishing, exercising, or defending legal claims. \n\n## International data transfers \n\n GitHub stores and processes Personal Data in a variety of locations, including your local region, the United States, and other countries where GitHub, its affiliates, subsidiaries, or subprocessors have operations. We transfer Personal Data from the European Union, the United Kingdom, and Switzerland to countries that the European Commission has not recognized as having an adequate level of data protection. When we engage in such transfers, we generally rely on the standard contractual clauses published by the European Commission under Commission Implementing Decision 2021/914 , to help protect your rights and enable these protections to travel with your data. To learn more about the European Commission‚Äôs decisions on the adequacy of the protection of personal data in the countries where GitHub processes personal data, see this article on the European Commission website . \n\n## Data Privacy Framework (DPF) \n\n GitHub also complies with the EU-U.S. Data Privacy Framework (EU-U.S. DPF), the UK Extension to the EU-U.S. DPF, and the Swiss-U.S. Data Privacy Framework (Swiss-U.S. DPF) as set forth by the U.S. Department of Commerce. GitHub has certified to the U.S. Department of Commerce that it adheres to the EU-U.S. Data Privacy Framework Principles (EU-U.S. DPF Principles) with regard to the processing of personal data received from the European Union in reliance on the EU-U.S. DPF and from the United Kingdom (and Gibraltar) in reliance on the UK Extension to the EU-U.S. DPF. GitHub has certified to the U.S. Department of Commerce that it adheres to the Swiss-U.S. Data Privacy Framework Principles (Swiss-U.S. DPF Principles) with regard to the processing of personal data received from Switzerland in reliance on the Swiss-U.S. DPF. If there is any conflict between the terms in this privacy statement and the EU-U.S. DPF Principles and/or the Swiss-U.S. DPF Principles, the Principles shall govern. To learn more about the Data Privacy Framework (DPF) program, and to view our certification, please visit https://www.dataprivacyframework.gov/ . \n GitHub has the responsibility for the processing of Personal Data it receives under the Data Privacy Framework (DPF) Principles and subsequently transfers to a third party acting as an agent on GitHub‚Äôs behalf. GitHub shall remain liable under the DPF Principles if its agent processes such Personal Data in a manner inconsistent with the DPF Principles, unless the organization proves that it is not responsible for the event giving rise to the damage. \n\n## Dispute resolution process \n\n In compliance with the EU-U.S. DPF, the UK Extension to the EU-U.S. DPF, and the Swiss-U.S. DPF, GitHub commits to resolve DPF Principles-related complaints about our collection and use of your personal information. EU, UK, and Swiss individuals with inquiries or complaints regarding our handling of personal data received in reliance on the EU-U.S. DPF, the UK Extension, and the Swiss-U.S. DPF should first contact GitHub at: dpo[at]github[dot]com. \n If you do not receive timely acknowledgment of your DPF Principles-related complaint from us, or if we have not addressed your DPF Principles-related complaint to your satisfaction, please visit https://go.adr.org/dpf_irm.html for more information or to file a complaint. The services of the International Centre for Dispute Resolution are provided at no cost to you. \n An individual has the possibility, under certain conditions, to invoke binding arbitration for complaints regarding DPF compliance not resolved by any of the other DPF mechanisms. For additional information visit https://www.dataprivacyframework.gov/framework-article/ANNEX-I-introduction . \n\n## Government Enforcement \n\n GitHub is subject to the investigatory and enforcement powers of the Federal Trade Commission (FTC). Under Section 5 of the Federal Trade Commission Act (15 U.S.C. ¬ß 45), an organization's failure to abide by commitments to implement the DPF Principles may be challenged as deceptive by the FTC. The FTC has the power to prohibit such misrepresentations through administrative orders or by seeking court orders. \n\n## Security and Retention \n\n GitHub uses appropriate administrative, technical, and physical security controls to protect your Personal Data. We‚Äôll retain your Personal Data as long as your account is active and as needed to fulfill contractual obligations, comply with legal requirements, resolve disputes, and enforce agreements. The retention duration depends on the purpose of data collection and any legal obligations. \n\n## Security \n\n GitHub uses administrative, technical, and physical security controls where appropriate to protect your Personal Data. \n\n## Contact Us \n\n Contact us via our contact form or by emailing our Data Protection Officer at dpo[at]github[dot]com.\nOur addresses are: \n GitHub B.V.\nPrins Bernhardplein 200, Amsterdam\n1097JB\nThe Netherlands \n GitHub, Inc.\n88 Colin P. Kelly Jr. St.\nSan Francisco, CA 94107\nUnited States \n\n## Information for Minors \n\n Our Services are not intended for individuals under the age of 13. We do not intentionally gather Personal Data from such individuals. If you become aware that a minor has provided us with Personal Data, please notify us . \n\n## Changes to Our Privacy Statement \n\n GitHub may periodically revise this Privacy Statement. If there are material changes to the statement, we will provide at least 30 days prior notice by updating our website or sending an email to your primary email address associated with your GitHub account. \n\n## Translations \n\n Below are translations of this document into other languages. In the event of any conflict, uncertainty, or apparent inconsistency between any of those versions and the English version, this English version is the controlling version. \n\n## French \n\n Cliquez ici pour obtenir la version fran√ßaise: D√©claration de confidentialit√© de GitHub (PDF) . \n\n## Other translations \n\n For translations of this statement into other languages, please visit https://docs.github.com/ and select a language from the drop-down menu under ‚ÄúEnglish.‚Äù \n\n## Our use of cookies and tracking technologies \n\n## Cookies and tracking technologies \n\n GitHub uses cookies to provide, secure and improve our Service or to develop new features and functionality of our Service. For example, we use them to (i) keep you logged in, (ii) remember your preferences, (iii) identify your device for security and fraud purposes, including as needed to maintain the integrity of our Service, (iv) compile statistical reports, and (v) provide information and insight for future development of GitHub. We provide more information about cookies on GitHub that describes the cookies we set, the needs we have for those cookies, and the expiration of such cookies. \n For Enterprise Marketing Pages, we may also use non-essential cookies to (i) gather information about enterprise users‚Äô interests and online activities to personalize their experiences, including by making the ads, content, recommendations, and marketing seen or received more relevant and (ii) serve and measure the effectiveness of targeted advertising and other marketing efforts. If you disable the non-essential cookies on the Enterprise Marketing Pages, the ads, content, and marketing you see may be less relevant. \n Our emails to users may contain a pixel tag, which is a small, clear image that can tell us whether or not you have opened an email and what your IP address is. We use this pixel tag to make our email communications more effective and to make sure we are not sending you unwanted email. \n The length of time a cookie will stay on your browser or device depends on whether it is a ‚Äúpersistent‚Äù or ‚Äúsession‚Äù cookie. Session cookies will only stay on your device until you stop browsing. Persistent cookies stay until they expire or are deleted. The expiration time or retention period applicable to persistent cookies depends on the purpose of the cookie collection and tool used. You may be able to delete cookie data. For more information, see GitHub General Privacy Statement . \n\n## What are cookies and similar technologies? \n\n We use cookies and similar technologies, such as web beacons, local storage, and mobile analytics, to operate and provide our Services. When visiting Enterprise Marketing Pages, like resources.github.com, these and additional cookies, like advertising IDs, may be used for sales and marketing purposes. \n Cookies are small text files stored by your browser on your device. A cookie can later be read when your browser connects to a web server in the same domain that placed the cookie. The text in a cookie contains a string of numbers and letters that may uniquely identify your device and can contain other information as well. This allows the web server to recognize your browser over time, each time it connects to that web server. \n Web beacons are electronic images (also called ‚Äúsingle-pixel‚Äù or ‚Äúclear GIFs‚Äù) that are contained within a website or email. When your browser opens a webpage or email that contains a web beacon, it automatically connects to the web server that hosts the image (typically operated by a third party). This allows that web server to log information about your device and to set and read its own cookies. In the same way, third-party content on our websites (such as embedded videos, plug-ins, or ads) results in your browser connecting to the third-party web server that hosts that content. \n Mobile identifiers for analytics can be accessed and used by apps on mobile devices in much the same way that websites access and use cookies. When visiting Enterprise Marketing pages, like resources.github.com, on a mobile device these may allow us and our third-party analytics and advertising partners to collect data for sales and marketing purposes. \n We may also use so-called ‚Äúflash cookies‚Äù (also known as ‚ÄúLocal Shared Objects‚Äù or ‚ÄúLSOs‚Äù) to collect and store information about your use of our Services. Flash cookies are commonly used for advertisements and videos. \n\n## How do we and our partners use cookies and similar technologies? \n\n The GitHub Services use cookies and similar technologies for a variety of purposes, including to store your preferences and settings, enable you to sign-in, analyze how our Services perform, track your interaction with the Services, develop inferences, combat fraud, and fulfill other legitimate purposes. Some of these cookies and technologies may be provided by third parties, including service providers and advertising partners. For example, our analytics and advertising partners may use these technologies in our Services to collect personal information (such as the pages you visit, the links you click on, and similar usage information, identifiers, and device information) related to your online activities over time and across Services for various purposes, including targeted advertising. GitHub will place non-essential cookies on pages where we market products and services to enterprise customers, for example, on resources.github.com. \n We and/or our partners also share the information we collect or infer with third parties for these purposes. \n The table below provides additional information about how we use different types of cookies: \n\n Purpose Description Required Cookies GitHub uses required cookies to perform essential website functions and to provide the services. For example, cookies are used to log you in, save your language preferences, provide a shopping cart experience, improve performance, route traffic between web servers, detect the size of your screen, determine page load times, improve user experience, and for audience measurement. These cookies are necessary for our websites to work. Analytics We allow third parties to use analytics cookies to understand how you use our websites so we can make them better. For example, cookies are used to gather information about the pages you visit and how many clicks you need to accomplish a task. We also use some analytics cookies to provide personalized advertising. Social Media GitHub and third parties use social media cookies to show you ads and content based on your social media profiles and activity on GitHub‚Äôs websites. This ensures that the ads and content you see on our websites and on social media will better reflect your interests. This also enables third parties to develop and improve their products, which they may use on websites that are not owned or operated by GitHub. Advertising In addition, GitHub and third parties use advertising cookies to show you new ads based on ads you've already seen. Cookies also track which ads you click or purchases you make after clicking an ad. This is done both for payment purposes and to show you ads that are more relevant to you. For example, cookies are used to detect when you click an ad and to show you ads based on your social media interests and website browsing history. \n\n## What are your cookie choices and controls? \n\n You have several options to disable non-essential cookies: \n \n\n‚Ä¢ \n Specifically on GitHub Enterprise Marketing Pages \n Any GitHub page that serves non-essential cookies will have a link in the page‚Äôs footer to cookie settings. You can express your preferences at any time by clicking on that linking and updating your settings. \n Some users will also be able to manage non-essential cookies via a cookie consent banner, including the options to accept, manage, and reject all non-essential cookies. \n \n\n‚Ä¢ \n Generally for all websites \nYou can control the cookies you encounter on the web using a variety of widely-available tools. For example: \n \n \n \n\n‚Ä¢ If your browser sends a Do Not Track (DNT) signal, GitHub will not set non-essential cookies and will not load third party resources which set non-essential cookies. \n\n‚Ä¢ Many browsers provide cookie controls which may limit the types of cookies you encounter online. Check out the documentation for your browser to learn more. \n\n‚Ä¢ If you enable a browser extension designed to block tracking, such as Privacy Badger , non-essential cookies set by a website or third parties may be disabled. \n\n‚Ä¢ If you enable a browser extension designed to block unwanted content, such as uBlock Origin , non-essential cookies will be disabled to the extent that content that sets non-essential cookies will be blocked. \n\n‚Ä¢ You may use the Global Privacy Control (GPC) to communicate your privacy preferences. If GitHub detects the GPC signal from your device, GitHub will not share your data (we do not sell your data). To learn more, visit Global Privacy Control ‚Äî Take Control Of Your Privacy \n\n‚Ä¢ Advertising controls. Our advertising partners may participate in associations that provide simple ways to opt out of ad targeting, which you can access at: \n\n‚Ä¢ United States: NAI and DAA \n\n‚Ä¢ Canada: Digital Advertising Alliance of Canada \n\n‚Ä¢ Europe: European Digital Advertising Alliance \n \n These choices are specific to the browser you are using. If you access our Services from other devices or browsers, take these actions from those systems to ensure your choices apply to the data collected when you use those systems. \n\n## US State Specific Information \n\n This section provides extra information specifically for residents of certain US states that have distinct data privacy laws and regulations. These laws may grant specific rights to residents of these states when the laws come into effect. This section uses the term ‚Äúpersonal information‚Äù as an equivalent to the term ‚ÄúPersonal Data.‚Äù \n\n## Privacy Rights \n\n These rights are common to the US State privacy laws: \n \n\n‚Ä¢ Right to Knowledge and Correction: You have the right to request details on the specific personal information we‚Äôve collected about you and the right to correct inaccurate information. You can exercise this right by contacting us. You can also access and edit basic account information in your settings. \n\n‚Ä¢ Right to Know Data Recipients: We share your information with service providers for legitimate business operations, such as data storage and hosting. For more details, please see ‚ÄúSharing Your Information‚Äù below. \n\n‚Ä¢ Right to request Deletion: You reserve the right to request the deletion of your data, barring a few exceptions. Such exceptions include circumstances where we are required to retain data to comply with legal obligations, detect fraudulent activity, investigate reports of abuse or other violations of our Terms of Service, or rectify security issues. Upon receiving your verified request, we will promptly delete your personal information (unless an exception applies), and instruct our service providers to do the same. We employ brief retention terms by design. \n\n‚Ä¢ Right to a Timely Response: You are allowed to make two free requests in any 12-month period. We commit to responding to your request within 45 days. In complex cases, we may extend our response time by an additional 45 days. \n\n‚Ä¢ Non-Discrimination: We will not hold it against you when you exercise any of your rights. On the contrary, we encourage you to review your privacy settings closely and contact us with any questions. \n \n\n## Notice of Collection of Personal Information \n\n We may collect various categories of personal information about our website visitors and users of \"Services\" which includes GitHub applications, software, products, or services. That information includes identifiers/contact information, demographic information, payment information, commercial information, internet or electronic network activity information, geolocation data, audio, electronic, visual, or similar information, and inferences drawn from such information. \n We collect this information for various purposes. This includes identifying accessibility gaps and offering targeted support, fostering diversity and representation, providing services, troubleshooting, conducting business operations such as billing and security, improving products and supporting research, communicating important information, ensuring personalized experiences, and promoting safety and security. \n\n## Exercising your Privacy Rights \n\n To make an access, deletion, correction, or opt-out request, please send an email to privacy[at]github[dot]com and follow the instructions provided. We may need to verify your identity before processing your request. If you choose to use an authorized agent to submit a request on your behalf, please ensure they have your signed permission or power of attorney as required. \n To opt out of the sharing of your personal information, you can click on the \"Do Not Share My Personal Information\" link on the footer of our Websites or use the Global Privacy Control (\"GPC\") if available. Authorized agents can also submit opt-out requests on your behalf. \n\n## California \n\n## Mandatory Disclosures \n\n We also make the following disclosures for purposes of compliance with California privacy law: \n \n\n‚Ä¢ We collected the following categories of personal information in the last 12 months: identifiers/contact information, demographic information (such as gender), payment card information associated with you, commercial information, Internet or other electronic network activity information, geolocation data, audio, electronic, visual or similar information, and inferences drawn from the above. \n\n‚Ä¢ The sources of personal information from whom we collected are: directly from you, automatically or from third parties. \n\n‚Ä¢ The business or commercial purposes of collecting personal information are as summarized above and in our Privacy Statement under Processing Purposes. \n\n‚Ä¢ We disclosed the following categories of personal information for a business purpose in the last 12 months: identifiers/contact information, demographic information (such as gender and rough geographic location), payment information, commercial information, Internet or other electronic network activity information, geolocation data, audio, electronic, visual or similar information, and inferences drawn from the above. We disclosed each category to third-party business partners and service providers, third-party sites or platforms such as social networking sites, and other third parties as described in the Sharing of Personal Data section of our Privacy Statement. \n\n‚Ä¢ As defined by applicable law, we ‚Äúshared‚Äù the following categories of personal information in the last 12 months: identifiers/contact information, Internet or other electronic network activity information, and inferences drawn from the above. We shared each category to or with advertising networks, data analytics providers, and social networks. \n\n‚Ä¢ The business or commercial purpose of sharing personal information is to assist us with marketing, advertising, and audience measurement. \n\n‚Ä¢ We do not ‚Äúsell‚Äù or ‚Äúshare‚Äù the personal information of known minors under 16 years of age. \n \n\n## Shine the Light Act \n\n Under California Civil Code section 1798.83, also known as the ‚ÄúShine the Light‚Äù law, California residents who have provided personal information to a business with which the individual has established a business relationship for personal, family, or household purposes (‚ÄúCalifornia Customers‚Äù) may request information about whether the business has disclosed personal information to any third parties for the third parties‚Äô direct marketing purposes. Please be aware that we do not disclose personal information to any third parties for their direct marketing purposes as defined by this law. California Customers may request further information about our compliance with this law by emailing (privacy[at]github[dot]com). Please note that businesses are required to respond to one request per California Customer each year and may not be required to respond to requests made by means other than through the designated email address. \n\n## Removal of Content \n\n California residents under the age of 18 who are registered users of online sites, services, or applications have a right under California Business and Professions Code Section 22581 to remove, or request and obtain removal of, content or information they have publicly posted. To remove content or information you have publicly posted, please submit a Private Information Removal request . Alternatively, to request that we remove such content or information, please send a detailed description of the specific content or information you wish to have removed to GitHub support . Please be aware that your request does not guarantee complete or comprehensive removal of content or information posted online and that the law may not permit or require removal in certain circumstances. If you have any questions about our privacy practices with respect to California residents, please send an email to privacy[at]github[dot]com. \n We value the trust you place in us and are committed to handling your personal information with care and respect. If you have any questions or concerns about our privacy practices, please email our Data Protection Officer at dpo[at]github[dot]com. \n\n## Colorado/Connecticut/Virginia \n\n If you live in Colorado, Connecticut, or Virginia you have some additional rights: \n \n\n‚Ä¢ If we deny your rights request, you have the right to appeal that decision. We will provide you with the necessary information to submit an appeal at that time. \n\n‚Ä¢ You have the right to opt out of profiling in furtherance of decisions that produce legal or similarly significant effects concerning the consumer. GitHub does not engage in such profiling as defined by Colorado law, so there‚Äôs no need to opt out. \n \n\n## Nevada \n\n We do not sell your covered information, as defined under Chapter 603A of the Nevada Revised Statutes. If you still have questions about your covered information or anything else in our Privacy Statement, please send an email to privacy[at]github[dot]com.",
      "chunk_ids": [],
      "metadata": {
        "source_type": "privacy",
        "source_name": "Github Privacy",
        "url": "https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement"
      },
      "is_distractor": false,
      "semantic_tags": [
        "github_privacy",
        "governing_law",
        "legal",
        "liability",
        "privacy"
      ],
      "content_hash": "ed9b7ad2c44a1334",
      "size_bytes": 41666,
      "created_at": "2026-01-02T20:42:23.534435"
    },
    {
      "doc_id": "legal_privacy_cloudflare_privacy",
      "source": "online",
      "category": "legal",
      "domain": "legal_privacy",
      "file_path": "https://www.cloudflare.com/privacypolicy/",
      "content": "‚Ä¢ Cloudflare&#x27;s Privacy Policy | Cloudflare \n‚Ä¢ \n‚Ä¢ \n\n## Privacy Policy\n Overview Policy application Information we collect How we use information we collect Data aggregation Information sharing Notice to UK and EU residents International information transfers Data subject rights and choices Communication preferences Data security, data integrity and access Data retention Notification of changes Business transactions English language controls Dispute resolution Notice to California residents Turnstile privacy addendum Contact information Legal questions \n\n## Have Questions?\n If you have questions about these terms or anything else about Cloudflare, please don&#x27;t hesitate to contact us: +1 (650) 319-8930 Cloudflare, Inc. 101 Townsend St, San Francisco, CA 94107 USA \n\n## Cloudflare Privacy Policy\n This Privacy Policy is effective as of November 4th, 2025. We have updated our October 31, 2025 Privacy Policy to include our new Addendum applicable to users in South Korea This Cloudflare Privacy Policy (‚ÄúPolicy‚Äù) outlines the personal information that Cloudflare, Inc. (‚ÄúCloudflare‚Äù, ‚Äúwe‚Äù, ‚Äúus‚Äù or ‚Äúour‚Äù) gathers, how we use that personal information, and the options you have to access, correct, or delete such personal information. \n\n## CLOUDFLARE‚ÄôS PROMISE\n Our mission to help build a better Internet is rooted in the importance we place on establishing trust with our Customers, users, and the Internet community globally. To earn and maintain that trust, we commit to communicating transparently, providing security, and protecting the privacy of data on our systems. We keep your personal information personal and private. We will not sell or rent your personal information. We will only share or otherwise disclose your personal information as necessary to provide our Services or as otherwise described in this Policy, except in cases where we first provide you with notice and the opportunity to consent. \n\n## 1. POLICY APPLICATION\n This Policy applies to Cloudflare‚Äôs collection, use, and disclosure of the personal information of the following categories of data subjects: \n‚Ä¢ Attendees : Those who visit our offices or provide their information to Cloudflare or Cloudflare representatives when they attend or register to attend Cloudflare-sponsored events or other events at which Cloudflare (and/or its representatives) participates, as well as those who participate in Cloudflare‚Äôs studies such as user experience research. \n‚Ä¢ Website Visitors : Those who visit our Websites, including those who may opt to provide an email address or other contact information to receive communications from Cloudflare, fill out a survey, or provide feedback. For the purposes of this Policy, ‚ÄúWebsites‚Äù refer collectively to www.cloudflare.com as well as any other websites Cloudflare operates for its own behalf and that link to this Policy. For clarity, ‚ÄúWebsites‚Äù does not include any sites owned or operated by our Customers, including where we serve as Registrar. \n‚Ä¢ Customers : Individuals or entities who enter into a subscription agreement with Cloudflare (or its authorized partner) and to whom Cloudflare provides Services pursuant to such agreement. For purposes of this Policy, ‚ÄúServices‚Äù shall refer to all of the cloud-based solutions offered, marketed, or sold by Cloudflare or its authorized partners that are designed to increase the performance, security, and availability of Internet properties, applications, devices, and networks, along with any software, software development kits, and application programming interfaces (\"APIs\") made available in connection with the foregoing. \n‚Ä¢ Administrative Users : Those with login credentials for a Cloudflare account and/or those who administer any of the Services for a Customer. In some cases, an Administrative User and Customer may be the same individual. In other cases, an Administrative User may be an agent acting on behalf of a Customer. \n‚Ä¢ Public DNS Resolver Users : Those who use Cloudflare‚Äôs 1.1.1.1 public recursive Domain Name System (‚ÄúDNS‚Äù) resolver service, including 1.1.1.1 for Families (\"1.1.1.1 resolver\"). Learn more about the 1.1.1.1 resolver here . \n‚Ä¢ End Users : Those who (i) access or use our Customers‚Äô domains, networks, websites, application programming interfaces, and applications, or (ii) Customers‚Äô employees, agents, or contractors, who access or use Services, such as Cloudflare Zero Trust end users. \n‚Ä¢ Registrants: Users of Cloudflare‚Äôs domain registrar services. Cloudflare is an ICANN -accredited registrar and complies with the 2013 Registrar Accreditation Agreement (‚ÄúRAA‚Äù). This Policy does not apply to ‚ÄúApplication Users‚Äù‚Äîthose individuals who use Cloudflare‚Äôs consumer-facing 1.1.1.1 Application. See the 1.1.1.1 Application Privacy Policy for more information about the data collection and use practices for Cloudflare&#x27;s 1.1.1.1 Application and the associated 1.1.1.1 Application Services. This Policy also does not apply to our Customers‚Äô domains, websites, APIs, applications, and networks, which may have their own terms and privacy policies. Our Customers are solely responsible for establishing policies for and ensuring compliance with all applicable laws and regulations, including those relating to the collection of personal information, in connection with the use of our Services by End Users with whom our Customers interact. Cloudflare‚Äôs Websites and Services are not intended for, nor designed to attract, individuals under the age of eighteen. Cloudflare does not knowingly collect or share personal information from any person under the age of eighteen. To the extent we become aware that we have the personal information of a person under the age of eighteen, we will delete that information. When Cloudflare is a reverse proxy, our IP addresses may appear in WHOIS and DNS records for websites using our Services. We are a conduit for information controlled by others. It is our Customers and their users who are responsible for the content transmitted across our network (e.g., images, written content, graphics, etc.). \n\n## 2. INFORMATION WE COLLECT (Categories of Data Subjects)\n \n‚Ä¢ Attendees \n‚Ä¢ Name, email address, and other contact information : We may ask for and collect personal information such as your name, address, phone number and email address when you visit our offices, register for or attend a sponsored event or other events at which Cloudflare (and/or its representatives) participates, or participate in Cloudflare‚Äôs studies such as user experience research. \n‚Ä¢ Image and voice : When you participate in a Cloudflare study, we may ask for your permission to record your voice and/or image during your participation in the study. \n‚Ä¢ Website Visitors \n‚Ä¢ Name, email address, and other contact information : We ask for and‚Äîat your option‚Äîcollect personal information from you when you submit web forms on our Websites, including opportunities to sign up for and agree to receive email communications from us. We may ask you to submit such personal information if you choose to use interactive features of the Websites, including participation in surveys, contests, promotions, sweepstakes, or studies, requesting customer support, submitting feedback, or otherwise communicating with us. We will send such communications in accordance with applicable law. \n‚Ä¢ Log files : Just as when you visit and interact with most websites and services delivered via the Internet, when you visit our Websites, including the Cloudflare Community Forum, we gather certain information and store it in log files. This information may include but is not limited to Internet Protocol (IP) addresses, system configuration information, URLs of referring pages, and locale and language preferences. \n‚Ä¢ Cookies and other tracking technologies : We may use cookies and other information-gathering technologies for a variety of purposes, such as providing us with information about how you interact with our Websites and assisting us in our marketing efforts. You may view a complete list of cookies and change your cookie preferences by clicking on the ‚ÄúCookie Preferences‚Äù link (or, in the United States, the ‚ÄúYour Privacy Choices‚Äù link) in the footer of the Cloudflare homepage at cloudflare.com or in the banner displayed when you visit our Websites from certain countries (such as the European Economic Area and the UK). Note that if you disable cookies entirely, Cloudflare‚Äôs Websites may not function properly. We may also use cookies and similar technologies to provide you advertising on third-party sites based upon your browsing activities and interests. In addition to exercising cookie choices through our ‚ÄúCookie Preferences‚Äù or ‚ÄúYour Privacy Choices‚Äù links, if you do not want to have cookies and similar technologies used for the purpose of serving you interest-based ads, you may opt-out by clicking here (or if located in the European Union, the United Kingdom, or Switzerland, click here ). For more information about the cookies Cloudflare uses and your privacy choices, please see our Cookie Policy . \n‚Ä¢ Material contributed in Interactive Areas : The Websites may offer publicly accessible blogs, community forums, comments sections, discussion forums, or other interactive features (‚ÄúInteractive Areas‚Äù). If you choose to participate in any of these Interactive Areas, please be aware that any information that you post in an Interactive Area might be read, collected, and used by others who access it. If you wish to remove your personal information from any of our Interactive Areas, please see the Section 8, below. \n‚Ä¢ Customers and Administrative Users \n‚Ä¢ Customer Account Information : When you register for an account, we collect contact information. Depending on subscription level, this contact information may include your Customer name, the email address(es) of your account administrator(s), telephone number, and addresses necessary to process payment and delivery of Services. In addition, when you use the Services, we collect information about how you configure your account and the Services (e.g., firewall settings for the domains you administer). We refer to all of this information collectively as ‚ÄúCustomer Account Information‚Äù for the purposes of this Policy. Customer Account Information is required to enable your access to your Cloudflare account and Services. By providing us with any personal information, you represent that you are the owner of such personal information or otherwise have the requisite consent to provide it to us. We also maintain logs of Administrative Users‚Äô activity (e.g., actions taken to configure settings in Customers‚Äô account). \n‚Ä¢ Payment information : We do not require our Customers to have payment information on file with us unless they have a paid subscription to our Services. When you sign up for one of our paid Services, you must provide payment and billing information. The information you will need to submit depends on which payment method you choose. For example, if you pay with a credit card, we will collect your card information and billing address, although we do not store full credit card numbers or personal account numbers. \n‚Ä¢ Crash Reports : When our Services encounter an unexpected error, you may be asked to submit a crash report, which may contain personal information. You will have an opportunity to review the content of the report prior to submitting the report to us. \n‚Ä¢ Public DNS Resolver Users \n‚Ä¢ Limited DNS query data : We will collect limited DNS query data that is sent to our 1.1.1.1 resolver. Our 1.1.1.1 resolver service does not log personal information, and the bulk of the limited non-personally identifiable query data is only stored for 25 hours. You can learn more about our 1.1.1.1 resolver commitment to privacy here . \n‚Ä¢ Please note that our data handling practices for our 1.1.1.1 Application, which is not covered by this Policy, are somewhat different than our 1.1.1.1 resolver data handling practices and are described here . \n‚Ä¢ End Users \n‚Ä¢ Cloudflare processes End Users‚Äô interactions with Customer‚Äôs Internet Properties and the Services. This information is processed when End Users access or use our Customers‚Äô domains, websites, APIs, applications, devices, end points, and networks that use one or more of our Services, and when End Users access or use Services, such as Cloudflare Zero Trust. The information processed may include but is not limited to IP addresses, traffic routing data, system configuration information, and other information about traffic to and from Customers‚Äô websites, devices, applications, and/or networks. \n‚Ä¢ The End User data that we make available to our Customers via the Service dashboard or other online interface are specifically defined as ‚ÄúCustomer Logs‚Äù. \n‚Ä¢ Registrants \n‚Ä¢ Contact and domain information: We collect data such as domain name and status, contact information (such as name, organization, address, phone number and email address), name server, DNSSEC, and Form of Approval (i.e., full WHOIS capture at time of transfer into our system, including the IP address that initiated the transfer). Network Data. Cloudflare collects and stores Network Data, which are models, observations, reports, analyses, statistics, databases and other information created, compiled, analyzed, generated or derived by Cloudflare from server, network or traffic data generated by Cloudflare in the course of providing the Service, including information required to help Cloudflare identify, analyze, mitigate, prevent, and block malicious activities on Cloudflare‚Äôs network. Examples of Network Data include service uptime and service availability metrics, request volumes, error rates, cache rates, origin and nature of malware, and IP threat scores. \n\n## 3. HOW WE USE INFORMATION WE COLLECT\n Cloudflare only processes personal information in a way that is compatible with and relevant to the purpose for which it was collected or authorized. As a general matter, for the categories of data described in Section 2 above, except 1.1.1.1 resolver user data as explained below, we may use your personal information to: \n‚Ä¢ Provide, operate, maintain, improve, and promote the Websites and Services for all users of the Websites and Services; \n‚Ä¢ Enable you to access and use the Websites and Services; \n‚Ä¢ Process and complete transactions, and send you related information, including purchase confirmations and invoices; \n‚Ä¢ Send transactional messages, including responses to your comments, questions, and requests; provide customer service and support; and send you technical notices, updates, security alerts, and support and administrative messages; \n‚Ä¢ Comply with legal obligations as well as to investigate and prevent fraudulent transactions, unauthorized access to the Services, and other illegal activities; \n‚Ä¢ For other purposes for which we obtain your consent. In addition, we may use the information we collect from Attendees, Websites Visitors, and Registrants, as well as Customer Account Information for the following purposes: \n‚Ä¢ Send commercial communications, in accordance with your communication preferences, such as providing you with information about products and services, features, surveys, newsletters, offers, promotions, contests, and events about us and our partners; and send other news or information about us and our partners. See Section 9 below for information on managing your communication preferences. \n‚Ä¢ Process and deliver contest or sweepstakes entries and rewards; \n‚Ä¢ Monitor and analyze trends, usage, and activities in connection with the Websites and Services and for marketing or advertising purposes; \n‚Ä¢ Personalize the Websites and Services, including by providing features or content that match your interests and preferences; \n‚Ä¢ To register visitors to our offices and to manage non-disclosure agreements that visitors may be required to sign, to the extent such processing is necessary for our legitimate interest in protecting our offices and our confidential information against unauthorized access; and Public DNS Resolver Users . We use information we collect from 1.1.1.1 resolver users to operate and improve the 1.1.1.1 resolver, such as to assist us in our debugging efforts if an issue arises. Our 1.1.1.1 resolver service does not store 1.1.1.1 resolver users‚Äô personal information. We will not combine any information collected from DNS queries to our 1.1.1.1 resolver with any other Cloudflare or third party data in any way that can be used to identify individual end users. Cloudflare may store aggregated data, as outlined within our 1.1.1.1 resolver commitments to privacy, indefinitely in order to power Cloudflare Radar and assist Cloudflare in improving Cloudflare services, such as, enhancing the overall performance of the Cloudflare Resolver and identifying security threats. Learn more about our 1.1.1.1 resolver commitment to privacy here . Information from Third Party Services . We may combine information we collect as described in Section 2 above with personal information we obtain from third parties. For example, we may combine information entered on a Cloudflare sales submission form with information we receive from a third-party sales intelligence platform vendor to enhance our ability to market our Services to Customers or potential Customers. \n\n## 4. DATA AGGREGATION\n Cloudflare may aggregate data we acquire about our Customers, Administrators, and End Users. For example, we may assemble data to determine how Web crawlers index the Internet and whether they are engaged in malicious activity or to compile web traffic reports and statistics. Non-personally identifiable, aggregated data may be shared with third parties. \n\n## 5. INFORMATION SHARING\n We work with other companies who provide us with services that help run our business and the Cloudflare Service (‚ÄúService Providers‚Äù). These companies provide services to help us deliver customer support, process credit card payments, manage and contact our existing Customers and Administrators as well as sales leads, provide marketing support, and otherwise operate and improve our Services. These Service Providers may only process personal information pursuant to our instructions and in compliance both with this Privacy Policy, the contracts we have in place with such Service Providers, and other applicable confidentiality, data protection, and security measures and regulations. Specifically, we do not permit our Service Providers to sell any personal information we share with them or to use any personal information we share with them for their own marketing purposes or for any purpose other than in connection with the services they provide to us. In addition to sharing with Service Providers as described above, we also may share your information with others in the following circumstances: \n‚Ä¢ Within the Cloudflare Group (defined for the purposes of this Policy as Cloudflare, Inc. (United States) and its subsidiaries listed Section 15); \n‚Ä¢ With our resellers and other sales partners who may help us distribute the Services to Customers; \n‚Ä¢ With an app developer when you install an app from our App Marketplace; \n‚Ä¢ In the event of a merger, sale, change in control, or reorganization of all or part of our business; \n‚Ä¢ When we are required to disclose personal information to respond to subpoenas, court orders, or legal process, or to establish or exercise our legal rights or defend against legal claims. (Learn more about how we handle law enforcement requests here ); \n‚Ä¢ Where we have a good-faith belief sharing is necessary to investigate, prevent or take action regarding illegal activities, suspected fraud, situations involving potential threats to the physical safety of any person, or violations of our Website Terms of Use, Self-Serve Subscription Agreement, and/or Enterprise Subscription Terms of Service; or as otherwise required to comply with our legal obligations; or \n‚Ä¢ As you may otherwise consent from time to time. Additional Information on Sharing Public DNS Resolver Users. Cloudflare does not share 1.1.1.1 resolver logs with any third parties except for anonymous logs shared with APNIC pursuant to a Research Cooperative Agreement. Learn more about information sharing specific to the 1.1.1.1 resolver here . Registrants. If you purchase a domain name from Cloudflare‚Äôs registrar service, ICANN (The Internet Corporation for Assigned Names and Numbers) and the relevant registry operators overseeing the domain‚Äôs top-level domain require us to collect registrant data for the purposes of domain registration and via the WHOIS protocol. We may also be required to share this public data with ICANN, the relevant registry operators and other such providers with whom we contract in order to provide our domain name services, and additionally upon the legitimate request of third parties. Registrant data may include the domain name, registrant name and other contact information, and domain name server information. See our Domain Registration Agreement here . Marketing & Advertising Partners. Our marketing and advertising partners may collect or receive personal information about you and/or collect certain information about your interactions with our Websites, or your email communications with Cloudflare, including through the use of cookies, beacons, and similar technologies, in order to gain insights that may help us market and advertise our services to you. You may opt out of such sharing using our ‚ÄúCookie Preferences‚Äù link (or, in the United States, the ‚ÄúYour Privacy Choices‚Äù link) on the cloudflare.com homepage. In addition, we may also provide these marketing and advertising partners with your email address or other limited account information. You may opt out of such sharing by emailing us at sar@cloudflare.com. These partners‚Äô use of your information will be based on their own privacy policies. We share this personal information for our business purposes. California residents can find additional information about data sharing for marketing and advertising purposes and their data subject rights in Section 16, below \n\n## 6. NOTICE TO EU, UK, AND SWISS RESIDENTS\n ‚ÄúPersonal information‚Äù as referenced in this Privacy Policy means ‚Äúpersonal data‚Äù as that term is defined under the European Union (‚ÄúEU‚Äù) General Data Protection Regulations (‚ÄúGDPR‚Äù) and its United Kingdom (‚ÄúUK‚Äù) GDPR counterpart. Cloudflare is a data controller for the personal information collected from all categories of data subjects listed above, with the following exceptions: Cloudflare is a data processor of Customer Logs, Administrative User Audit Logs, and some account settings information. In addition, Cloudflare is a data processor for any of the content provided by Customers and End Users through the Services that transits, or in some cases, is stored on, the Cloudflare network. Where Cloudflare is a data processor, Cloudflare processes data on behalf of its Customers pursuant to their data processing instructions. If you are an individual from the European Economic Area (the ‚ÄúEEA‚Äù), the UK or Switzerland, please note that our legal basis for collecting and using your personal information will depend on the personal information collected and the specific context in which we collect it. We normally will collect personal information from you only where: (a) we have your consent to do so, (b) where we need your personal information to perform a contract with you (e.g. to deliver the Cloudflare Services you have requested), or (c) where the processing is in our legitimate interests. Please note that in most cases, if you do not provide the requested information, Cloudflare will not be able to provide the requested service to you. In some cases, we may also have a legal obligation to collect personal information from you, or may otherwise need the personal information to protect your vital interests or those of another person. Where we rely on your consent to process your personal data, you have the right to withdraw or decline consent at any time. Where we rely on our legitimate interests to process your personal data, you have the right to object by emailing us at sar@cloudflare.com. If you have any questions about or need further information concerning the legal basis on which we collect and use your personal information, please contact us at privacyquestions@cloudflare.com . \n\n## 7. INTERNATIONAL INFORMATION TRANSFERS\n Cloudflare is a U.S. based, global company. We primarily store your information in the United States and the European Economic Area. To facilitate our global operations, we may transfer and access such information from around the world, including from other countries in which the Cloudflare Group has operations for the purposes described in this Policy. Whenever a Cloudflare company transfers personal information originating from one country to another Cloudflare group company or a third party service provider or partner in a different country, we will implement appropriate safeguards, consistent with the laws of the territory from which the data is exported. We describe the safeguards we implement here . If you have any questions about or need further information concerning the safeguards Cloudflare has in place to protect your personal information, please contact us at privacyquestions@cloudflare.com . \n‚Ä¢ Transfers from countries participating in the Global Cross Border Privacy Rules System: When Cloudflare transfers personal data from a country that recognizes the Global Cross Border Privacy Rules (‚ÄúCBPR‚Äù) System and the Global Privacy Recognition for Processors (‚ÄúPRP‚Äù) System as lawful data transfer mechanisms, we rely on our certifications under the CBPR System and Global PRP System, as applicable. The Global CBPR System means the data privacy framework established by the Global CBPR Forum against which data controllers can voluntarily certify and undergo assessment by third-party accountability agents to enable accountable cross-border data flows among participating jurisdictions, and the Global PRP System means the complementary framework to the Global CBPR System against which data processors can voluntarily certify and undergo assessment by third-party accountability agents to enable accountable cross-border data flows among participating jurisdictions of personal information they process on behalf of data controllers, as these systems are described further at www.globalcbpr.org. Details of our certifications can be viewed at https://www.globalcbpr.org/privacy-certifications/directory/ . If you have any questions about Cloudflare&#x27;s compliance with the Global CBPR System, please contact us at dpo@cloudflare.com. If you have unresolved privacy concerns related to the Global CBPR System, that we have not addressed satisfactorily, you may contact our third-party dispute resolution provider . \n‚Ä¢ Transfers from countries in the EEA, Switzerland, and the UK: When Cloudflare transfers personal data from the EEA, Switzerland, or the United Kingdom (UK) to the United States, we rely on our certifications under the EU-U.S. Data Privacy Framework (EU-U.S. DPF), the Swiss-U.S. Data Privacy Framework (Swiss-U.S. DPF), and the UK Extension to the EU-U.S. DPF. Should these certifications lapse or become otherwise invalidated, Cloudflare relies on the standard contractual clauses, including supplementary measures as necessary for transfers to the United States. We also use standard contractual clauses for other international transfers from the EEA, Switzerland, or the United Kingdom. Self-certification to the Data Privacy Framework Cloudflare complies with the EU-U.S. DPF, the UK Extension to the EU-U.S. DPF, and the Swiss-U.S. DPF as set forth by the U.S. Department of Commerce. Cloudflare has certified to the U.S. Department of Commerce that it adheres to the EU-U.S. Data Privacy Framework Principles (EU-U.S. DPF Principles) with regard to the processing of personal data received from the European Union in reliance on the EU-U.S. DPF and from the United Kingdom (and Gibraltar) in reliance on the UK Extension to the EU-U.S. DPF. Cloudflare has also certified to the U.S. Department of Commerce that it adheres to the Swiss-U.S. Data Privacy Framework Principles (Swiss-U.S. DPF Principles) with regard to the processing of personal data received from Switzerland in reliance on the Swiss-U.S. DPF. If there is any conflict between the terms in this privacy policy and the EU-U.S. DPF Principles and/or the Swiss-U.S. DPF Principles, the Principles shall govern. To learn more about the Data Privacy Framework (DPF) program, and to view our certification, please visit https://www.dataprivacyframework.gov/ . In compliance with the EU-U.S. DPF, the UK Extension to the EU-U.S. DPF, and the Swiss-U.S. DPF (together, the ‚ÄúDPFs‚Äù), Cloudflare commits to resolve DPF Principles-related complaints about our collection and use of your personal information. EU, UK, and Swiss individuals with inquiries or complaints regarding our handling of personal data received in reliance on the DPFs should first contact us by emailing sar@cloudflare.com or via mail to: Cloudflare, Inc., 101 Townsend St., San Francisco, CA 94107, Attn: Data Protection Officer. We will respond to your inquiry within 30 days of receipt and verification of your identity. In compliance with the DPFs, Cloudflare commits to refer unresolved complaints concerning our handling of personal information received in reliance on the DPFs to TRUSTe, an alternative dispute resolution provider based in the United States. If you do not receive timely acknowledgment of your DPF Principles-related complaint from us, or if we have not addressed your DPF Principles-related complaint to your satisfaction, please visit https://feedback-form.truste.com/watchdog/request for more information or to file a complaint. The services of TRUSTe, LLC are provided at no cost to you. You have the possibility, under certain conditions, to invoke binding arbitration for complaints regarding DPF compliance not resolved by any of the other mechanisms set out in this DPF Notice or our Privacy Notice. For more information, please see Annex 1 of the DPF Principles, available here . The Federal Trade Commission has jurisdiction over Cloudflare‚Äôs compliance with the EU-U.S. Data Privacy Framework (EU-U.S. DPF) and the UK Extension to the EU-U.S. DPF, and the Swiss-U.S. Data Privacy Framework (Swiss-U.S. DPF). We may be required to disclose personal information we receive under the EU-U.S. DPF, the UK Extension to the EU-U.S. DPF, and the Swiss-U.S. DPF in response to lawful requests by public authorities, including to meet national security or law enforcement requirements. Cloudflare is liable for the processing of personal information it receives under the DPF Principles and subsequently transfers to a third party acting as an agent on its behalf. Cloudflare shall remain liable under the DPF Principles if its agent processes such personal information in a manner inconsistent with the DPF Principles, unless Cloudflare proves that it is not responsible for the event giving rise to the damage. \n\n## 8. DATA SUBJECT RIGHTS AND CHOICES\n Cloudflare recognizes individuals‚Äô data protection rights. You have the right to access, correct, update, port, or delete your personal information, and to restrict or object to the processing of your personal information (each of these a ‚ÄúRights Request‚Äù). You may email us at sar@cloudflare.com with any Rights Request, and we will respond within thirty (30) days. Customers and Administrative Users also can access, correct, export, or update their Account Information by editing their profile or organization record at Cloudflare.com. Please note that before we can complete your Rights Request, we will need to verify that your identity matches that of the data in which you are requesting to exercise your rights. You can expect a verification email under separate cover, to the email address associated with your personal information on file. If you are making a Rights Request on behalf of another individual as an authorized agent, we require that either (a) the data subject must verify their identity and directly confirm with Cloudflare they provided the authorized agent permission to submit the Rights Request, (b) the authorized agent must be provided power of attorney by the data subject in accordance with the law of the data subject‚Äôs jurisdiction, or (c) the Rights Request must otherwise be submitted in accordance with applicable privacy law. For any Rights Request, we will need to verify a requestor is inquiring about their own information before we can assist. Where a Rights Request may implicate the personal information of another individual, we must balance the request against the risk of violating another person‚Äôs privacy rights. We will comply with Rights Requests to the extent required by applicable law or the Swiss-U.S. or EU-U.S. Data Privacy Framework. In the event that your Rights Request is denied, residents of the U.S. states Virginia and Colorado may appeal our decision by responding to the email informing them of the denial or by submitting a Rights Request to appeal to sar@cloudflare.com, and we will respond within sixty (60) days. In the EEA, the UK, and Switzerland, you also have the right to lodge a complaint with a supervisory authority. Please note that we do not retain any personal information about 1.1.1.1 resolver users that would be subject to the Rights Requests described above. In addition, Cloudflare has no direct relationship with End Users. Even where ‚ÄúCloudflare‚Äù may be indicated as the authoritative name server for a domain, unless Cloudflare is the owner of that domain, we have no control over a domain‚Äôs content. Accordingly, we rely upon our Customers to comply with the underlying legal requirements for Rights Requests in accordance with their obligations under applicable data protection laws. If an End User requests that we fulfill a Rights Request, we will direct that End User to contact the Customer website(s) with which they interacted directly. Our Customers are solely responsible for ensuring compliance with all applicable laws and regulations with respect to their website users. \n\n## 9. COMMUNICATION PREFERENCES\n Cloudflare will send you commercial communications based on the communication preferences in your account settings. Cloudflare also will send you service-related communications. You may manage your receipt of commercial communications by clicking on the ‚Äúunsubscribe‚Äù link located on the bottom of such emails, through your account settings if you have a Cloudflare account, or you may send a request to unsubscribe@cloudflare.com. \n\n## 10. DATA SECURITY, DATA INTEGRITY AND ACCESS\n We take all reasonable steps to protect information we receive from you from accidental or unlawful destruction, loss, alteration, and unauthorized disclosure or access. We have put in place appropriate physical, technical and administrative measures to safeguard and secure your information, and we make use of privacy-enhancing technologies such as encryption. If you have any questions about the security of your personal information, you can contact us at privacyquestions@cloudflare.com . \n\n## 11. DATA RETENTION\n We store your personal information for a period of time that is consistent with the business purposes set forth in Section 3 of this policy or as long as needed to fulfill and comply with legal obligations. The criteria we used to determine how long we store your personal information will vary depending on several different factors. We typically consider the following when determining data retention: \n‚Ä¢ The purpose for collecting the personal information in the first place. For example, if you have an active account with us, we need to keep your contact information during the entirety of that time in order to provide you with support or contact you regarding your account; \n‚Ä¢ The volume, nature, and sensitivity of the personal information we are processing; \n‚Ä¢ The potential risk of harm from unauthorized use or disclosure of the personal information; \n‚Ä¢ Whether we can achieve the purposes for processing with less data or through other means \n‚Ä¢ Legal requirements that may apply to the data, such as applicable statutes of limitation or contractual obligations. When the data retention period expires for a given type of data, we will delete or destroy it. If, for technical reasons, we are unable to do so, we will implement appropriate security measures to prevent any further use of such data. \n\n## 12. NOTIFICATION OF CHANGES\n If we make changes to this Policy that we believe materially impact the privacy of your personal information, we will promptly provide notice of any such changes (and, where necessary, obtain consent), as well as post the updated Policy on this website noting the effective date of any changes. \n\n## 13. BUSINESS TRANSACTIONS\n We may assign or transfer this Policy, as well as information covered by this Policy, in the event of a merger, sale, change in control, or reorganization of all or part of our business. \n\n## 14. ENGLISH LANGUAGE CONTROLS\n Non-English translations of this Policy are provided for convenience only. In the event of any ambiguity or conflict between translations, the English version is authoritative and controls. \n\n## 15. DISPUTE RESOLUTION\n If you have an unresolved privacy or data-use concern that we have not addressed satisfactorily, please contact our U.S.-based third party dispute resolution provider (free of charge) at https://feedback-form.truste.com/watchdog/request . \n\n## 16. NOTICE TO CALIFORNIA RESIDENTS\n This section applies only to California residents. It describes how we collect, use, and share Personal Information of California residents in operating our business, and their rights with respect to that Personal Information. For purposes of this section, ‚ÄúPersonal Information‚Äù means information that identifies, relates to, describes, is reasonably capable of being associated with, or could reasonably be linked, directly or indirectly, with a particular consumer or household as defined in the CCPA. It does not include information exempted from the scope of the CCPA. How We Collect, Use, and Share Your Personal Information under the CCPA We may collect, use, and disclose for our business and commercial purposes, the following categories of Personal Information: \n‚Ä¢ Identifiers for the categories of individuals/users defined in Section 1 of the Cloudflare Privacy Policy (e.g., email address of Customers and Administrative Users, name and contact information of Attendees); \n‚Ä¢ Payment and customer records information of our Customers; \n‚Ä¢ Protected classification characteristics (e.g., age, ethnicity, race, languages spoken, or gender) to the extent these characteristics are voluntarily disclosed to us or contained in any content transmitted across or stored on our network; \n‚Ä¢ Commercial information (e.g., records of products or services purchased, obtained, or considered, or other purchasing or usage histories); \n‚Ä¢ Professional or employment information; \n‚Ä¢ Internet or other electronic network activity information; and \n‚Ä¢ Inferences (e.g., information about your interests or preferences). The sources from which we collect information are described in Section 2 of the Cloudflare Privacy Policy. The business and commercial purposes for which we collect and use this information are described in Section 3 of the Cloudflare Privacy Policy. The categories of third parties to whom we ‚Äúdisclose‚Äù the information for a business purpose are described in Section 5 of the Cloudflare Privacy Policy. Your California Privacy Rights As a California resident, you have the rights listed below. However, these rights are not absolute, and in certain cases we may decline your request as permitted by law. \n‚Ä¢ Knowledge . You can request information about what personal information we have collected about you, including: \n‚Ä¢ the categories of personal information; \n‚Ä¢ the categories of sources from which the personal information is collected; \n‚Ä¢ the business or commercial purpose for collecting, selling, or sharing personal information; \n‚Ä¢ the categories of third parties to whom we disclose personal information; \n‚Ä¢ the specific pieces of personal information that we have collected about you. \n‚Ä¢ Access . You can request a copy of the Personal Information that we have collected about you. \n‚Ä¢ Deletion . You can ask us to delete the Personal Information that we have collected from you. \n‚Ä¢ Correction . You can ask us to rectify inaccurate personal information and, taking into account the purpose of processing the personal information, ensure it is complete; \n‚Ä¢ Opt-out of sales or sharing . You can ask that we do not ‚Äúsell‚Äù or ‚Äúshare‚Äù your Personal Information as ‚Äúsell‚Äù and ‚Äúshare‚Äù are explicitly defined under the CCPA. For more information, please refer to the section titled ‚ÄúRight to Opt Out of the Sale and Sharing of Your Personal Information‚Äù below. \n‚Ä¢ Nondiscrimination . You are entitled to exercise the rights described above free from discrimination. This means that we will not penalize you for exercising your rights by taking actions such as denying you the Services; increasing the price/rate of the Services; decreasing service quality; or suggesting that we may penalize you as described above for exercising your rights. In order to submit a request to exercise your right of information, access, or deletion pursuant to the CCPA, please follow the instructions for the submitting a Rights Request detailed in Section 8, above. Please note, we reserve the right to confirm your California residence to process your requests and may need to confirm your identity to process certain requests using the verification methods described in Section 8. For example, we take reasonable precautions to verify the identities of those California residents submitting requests to delete or access Personal Information. Right to Opt Out of the Sale and Sharing of Your Personal Information Cloudflare does not sell your Personal Information in the conventional sense (i.e., for money). Like many companies, however, we use services that help deliver interest-based ads to you and may transfer Personal Information to business partners for their use. Making Personal Information (such as online identifiers or browsing activity) available to these companies may be considered a ‚Äúsale‚Äù or ‚Äúsharing‚Äù of your Personal Information under the CCPA. You can request to opt out of such ‚Äúsale‚Äù or ‚Äúsharing‚Äù of your Personal Information using the ‚Äú Your Privacy Choices‚Äù link in the footer below . In addition, some internet browsers offer the option to enable opt-out signals such as Global Privacy Control that lets you tell websites that you do not want to have your online activities tracked. Cloudflare responds to these signals by processing them as a request to opt out of the ‚Äúsale‚Äù or ‚Äúsharing‚Äù of your Personal Information as discussed above. Please note that you will still see some advertising, regardless of your selection. We do not impose verification protocols for processing opt out requests unless we have reason to question the authenticity of a requester‚Äôs identity, in which case we may request evidence of identity and California residency. \n\n## 17. SOUTH KOREA PRIVACY ADDENDUM\n Please see our Addendum applicable to users in South Korea for more information about how we process the personal information of users in South Korea. \n\n## 18. TURNSTILE PRIVACY ADDENDUM\n For more information about how we process your personal data for Cloudflare Turnstile, please see the Turnstile Privacy Addendum . \n\n## 19. CONTACT INFORMATION\n Cloudflare, Inc. 101 Townsend St. San Francisco, CA 94107 Attention: Data Protection Officer dpo@cloudflare.com Cloudflare (Canada) Information Technology Co., Ltd. Suite 2600, Three Bentall Centre 595 Burrard Street, P.O. Box 49314 Vancouver, BC V7X 1L3 Attention: Data Protection Officer dpo@cloudflare.com Cloudflare, Ltd. County Hall/The Riverside Building Belvedere Road London, SE1 7PB Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Portugal, Unipessoal Lda. Largo Rafael Bordalo Pinheiro 29 1200-369 Lisboa Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Germany GmbH c/o Design Offices M√ºnchen Atlas Rosenheimer Stra√üe 143C - 8th floor 81671 M√ºnchen Germany Attention: Data Protection Officer dpo@cloudflare.com Cloudflare France SAS 6 place de la Madeleine 75008 Paris Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Netherlands B.V. Keizersgracht 62, 1015CS Amsterdam Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Pte., Ltd. 182 Cecil Street, #35-01 Frasers Tower, Singapore 069547 Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Australia Pty Ltd. 333 George St., 5th Floor Sydney, NSW 2000 Attention: Data Protection Officer dpo@cloudflare.com Cloudflare (Beijing) Information Technology Co., Ltd. 16 South Guangshun Street Donghuang Building 17th Floor Chaoyang District Beijing 100015 Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Japan K.K. Kyobashi Edogrand 26F 2-2-1 Kyobashi, Chuo-ku Tokyo, 104-0031 Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Middle East FZ-LLC DIC 1 Internet City Road Building 1, Ground Floor, Office 17 Jumeirah Dubai UAE Attention: Data Protection Officer dpo@cloudflare.com Cloudflare India Private Limited No. 215 Richmond Towers, 12 Richmond Road, Richmond Town Banglore, Bangalore, Karnataka, India, 560025 Attention: Grievance Officer dpo@cloudflare.com Area 1 Security, LLC 838 Walker Road Suite 21-2, Dover, DE, 19904 Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Korea LLC 6F, 55 Seocho-daero 77-gil Seocho-gu, Seoul, South Korea, 06611 Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Mexico S. de R.L de C.V. Bosque de Ciruelos No. 180 int. PP 101, Col. Bosque de las Lomas, Miguel Hidalgo Ciudad de M√©xico, 11700, M√©xico Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Malaysia Sdn. Bhd. Level 21, Suite 21.01, The Gardens South Tower, Mid Valley City, Lingkaran Syed Putra, Kuala Lumpur Wilayah Persekutuan 59200 Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Capability Center (India) Private Limited 14, 1 Cross 4F NS Halli, Gundappa Lane, Sanjaya Nagar, R.M.V. Extension II Stage Bangalore North, Bangalore - 560094, Karnataka, India Attention: Grievance Officer dpo@cloudflare.com Cloudflare Sweden AB c/o Setterwalls Advokatbyr√• Att: J. Johannesson Box 1050 101 39 Stockholm Sweden Attention: Data Protection Officer dpo@cloudflare.com Cloudflare Switzerland GmbH c/o Steinmann Schneider Services GmbH Postfach 7652 Bahnhofstrasse 10 6302 Zug Switzerland Attention: Data Protection Officer dpo@cloudflare.com GETTING STARTED \n‚Ä¢ Free plans \n‚Ä¢ Small business plans \n‚Ä¢ For enterprises \n‚Ä¢ Get a recommendation \n‚Ä¢ Request a demo \n‚Ä¢ Contact sales SOLUTIONS \n‚Ä¢ Connectivity cloud \n‚Ä¢ Application services \n‚Ä¢ SASE and workspace security \n‚Ä¢ Network services \n‚Ä¢ Developer platform SUPPORT \n‚Ä¢ Help center \n‚Ä¢ Customer support \n‚Ä¢ Community forum \n‚Ä¢ Developers Discord \n‚Ä¢ Lost account access? \n‚Ä¢ Cloudflare status COMPLIANCE \n‚Ä¢ Compliance resources \n‚Ä¢ Trust \n‚Ä¢ GDPR \n‚Ä¢ Responsible AI \n‚Ä¢ Transparency report \n‚Ä¢ Report abuse PUBLIC INTEREST \n‚Ä¢ Project Galileo \n‚Ä¢ Athenian Project \n‚Ä¢ Cloudflare for Campaigns \n‚Ä¢ Project Fairshot COMPANY \n‚Ä¢ About Cloudflare \n‚Ä¢ Network map \n‚Ä¢ Our team \n‚Ä¢ Logos & press kit \n‚Ä¢ Diversity, equity, & inclusion \n‚Ä¢ Impact/ESG ¬© 2026 Cloudflare, Inc. Privacy Policy Terms of Use Report Security Issues Cookie Preferences Trademark",
      "chunk_ids": [],
      "metadata": {
        "source_type": "privacy",
        "source_name": "Cloudflare Privacy",
        "url": "https://www.cloudflare.com/privacypolicy/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "cloudflare_privacy",
        "governing_law",
        "legal",
        "privacy"
      ],
      "content_hash": "84524e6b2c251285",
      "size_bytes": 48247,
      "created_at": "2026-01-02T20:42:23.534739"
    },
    {
      "doc_id": "legal_privacy_mozilla_privacy",
      "source": "online",
      "category": "legal",
      "domain": "legal_privacy",
      "file_path": "https://www.mozilla.org/en-US/privacy/",
      "content": "Mozilla Privacy \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n‚Ä¢ \n \n \n \n \n‚Ä¢ \n\n \n \n \n \n\n \n \n \n \n‚Ä¢ \n \n \n\n \n \n \n \n‚Ä¢ \n \n \n‚Ä¢ \n \n \n \n\n \n \n \n‚Ä¢ \n\n \n\n \n \n \n\n \n \n \n \n\n \n\n \n \n \n \n \n\n \n\n \n \n \n \n\n \n \n\n \n \n\n \n\n \n \n\n \n\n \n\n \n\n \n\n \n\n \n\n \n\n \n \n\n \n \n \n \n \n \n \n\n## What do we mean by \"personal information?\"\n\n For us, \"personal information\" means information which either directly identifies you (like your name, email address, or billing information) or can be reasonably linked or combined to identify you (like an account identification number or IP address). We‚Äôll always tell you what personal information we‚Äôre collecting from you. See each product‚Äôs Privacy Notice for specific details. \n Any information that falls outside of this is \"non-personal information.\" \n If we store your personal information with information that is non-personal, we will consider the combination as personal information. If we remove all personal information from a set of data then the remaining is non-personal information. \n \n\n## How do we learn information about you?\n\n We learn information about you when: \n \n\n‚Ä¢ you give it to us directly (e.g., when you choose to send us crash reports); \n\n‚Ä¢ we collect it automatically through our products and services (e.g., when your Firefox browser checks with us to see if it is up to date); \n\n‚Ä¢ someone else tells us information about you (e.g., when Thunderbird works with your email providers to set up your account); or \n\n‚Ä¢ when we try and understand more about you based on information you've given to us (e.g., when we use your IP address to customize language for some of our services). \n \n \n\n## What do we do with your information once we have it?\n\n When you give us information, we will use it in the ways for which you've given us permission. Generally, we use your information to help us provide and improve our products and services for you. \n For users in the EU, EEA, Switzerland, and California: see here for more information. \n \n\n## When do we share your information with others?\n\n \n\n‚Ä¢ When we have asked and received your permission to share it. \n\n‚Ä¢ For processing or providing products and services to you, but only if those entities receiving your information are contractually obligated to handle the data in ways that are approved by Mozilla. \n\n‚Ä¢ When we are fulfilling our mission of being open . We sometimes release information to make our products better and foster an open web, but when we do so, we will remove your personal information and try to disclose it in a way that minimizes the risk of you being re-identified. \n\n‚Ä¢ When the law requires it. We follow the law whenever we receive requests about you from a government or related to a lawsuit. We'll notify you when we're asked to hand over your personal information in this way unless we're legally prohibited from doing so. When we receive requests like this, we'll only release your personal information if we have a good faith belief that the law requires us to do so. Nothing in this policy is intended to limit any legal defenses or objections that you may have to a third party's request to disclose your information. \n\n‚Ä¢ When we believe it is necessary to prevent harm to you or someone else. We will only share your information in this way if we have a good faith belief that it is reasonably necessary to protect the rights, property or safety of you, our other users, Mozilla or the public. \n\n‚Ä¢ If our organizational structure or status changes (if we undergo a restructuring, are acquired, or go bankrupt) we may pass your information to a successor or affiliate. \n \n \n\n## How do we store and protect your personal information?\n\n We are committed to protecting your personal information once we have it. We implement physical, business and technical security measures. Despite our efforts, if we learn of a security breach, we'll notify you so that you can take appropriate protective steps. \n We also don't want your personal information for any longer than we need it, so we only keep it long enough to do what we collected it for. Once we don't need it, we take steps to destroy it unless we are required by law to keep it longer. \n \n\n## What if we change this privacy policy or any of our privacy notices?\n\n We may need to change this policy and our notices. The updates will be posted online. If the changes are substantive, we will announce the update through Mozilla's usual channels for such announcements such as blog posts and forums. Your continued use of the product or service after the effective date of such changes constitutes your acceptance of such changes. To make your review more convenient, we will post an effective date at the top of the page.",
      "chunk_ids": [],
      "metadata": {
        "source_type": "privacy",
        "source_name": "Mozilla Privacy",
        "url": "https://www.mozilla.org/en-US/privacy/"
      },
      "is_distractor": false,
      "semantic_tags": [
        "governing_law",
        "legal",
        "mozilla_privacy",
        "privacy"
      ],
      "content_hash": "6ff0c0da9d3f8087",
      "size_bytes": 4846,
      "created_at": "2026-01-02T20:42:23.534835"
    },
    {
      "doc_id": "distractor_0000",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0000",
      "content": "In a remote village, the tradition of database has been passed down for generations. The elders speak of SELECT with reverence, while JOIN remains a mystery. Young apprentices learn the secrets of index through careful observation. The ritual of query is performed during the harvest moon. The history of database dates back to ancient times when people first discovered query. Over centuries, the understanding of schema evolved significantly. Modern research has shown that index plays a crucial role in database. Experts agree that without table, the field would not have progressed as far. The history of database dates back to ancient times when people first discovered query. Over centuries, the understanding of index evolved significantly. Modern research has shown that table plays a crucial role in database. Experts agree that without JOIN, the field would not have progressed as far. The history of database dates back to ancient times when people first discovered index. Over centuries, the understanding of JOIN evolved significantly. Modern research has shown that SELECT plays a crucial role in database. Experts agree that without query, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.534965",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "database",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "database"
      ],
      "content_hash": "0de8bd46d5f0f7ab",
      "size_bytes": 1198,
      "created_at": "2026-01-02T20:42:23.534969"
    },
    {
      "doc_id": "distractor_0001",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0001",
      "content": "The history of support dates back to ancient times when people first discovered help. Over centuries, the understanding of issue evolved significantly. Modern research has shown that ticket plays a crucial role in support. Experts agree that without resolved, the field would not have progressed as far. In a remote village, the tradition of support has been passed down for generations. The elders speak of thanks with reverence, while resolved remains a mystery. Young apprentices learn the secrets of help through careful observation. The ritual of issue is performed during the harvest moon. The history of support dates back to ancient times when people first discovered ticket. Over centuries, the understanding of issue evolved significantly. Modern research has shown that thanks plays a crucial role in support. Experts agree that without resolved, the field would not have progressed as far. In a remote village, the tradition of support has been passed down for generations. The elders speak of resolved with reverence, while issue remains a mystery. Young apprentices learn the secrets of help through careful observation. The ritual of ticket is performed during the harvest moon. The history of support dates back to ancient times when people first discovered thanks. Over centuries, the understanding of issue evolved significantly. Modern research has shown that ticket plays a crucial role in support. Experts agree that without help, the field would not have progressed as far. In a remote village, the tradition of support has been passed down for generations. The elders speak of resolved with reverence, while help remains a mystery. Young apprentices learn the secrets of ticket through careful observation. The ritual of issue is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.534987",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "support",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "support"
      ],
      "content_hash": "08fbc4d602a48a4a",
      "size_bytes": 1787,
      "created_at": "2026-01-02T20:42:23.534988"
    },
    {
      "doc_id": "distractor_0002",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0002",
      "content": "In a remote village, the tradition of networking has been passed down for generations. The elders speak of TCP with reverence, while HTTP remains a mystery. Young apprentices learn the secrets of socket through careful observation. The ritual of packet is performed during the harvest moon. The history of networking dates back to ancient times when people first discovered latency. Over centuries, the understanding of protocol evolved significantly. Modern research has shown that HTTP plays a crucial role in networking. Experts agree that without socket, the field would not have progressed as far. The history of networking dates back to ancient times when people first discovered TCP. Over centuries, the understanding of packet evolved significantly. Modern research has shown that protocol plays a crucial role in networking. Experts agree that without HTTP, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.534998",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "networking"
      ],
      "content_hash": "0f529f875a297eba",
      "size_bytes": 910,
      "created_at": "2026-01-02T20:42:23.534999"
    },
    {
      "doc_id": "distractor_0003",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0003",
      "content": "The history of compiler dates back to ancient times when people first discovered parser. Over centuries, the understanding of lexer evolved significantly. Modern research has shown that AST plays a crucial role in compiler. Experts agree that without optimization, the field would not have progressed as far. The history of compiler dates back to ancient times when people first discovered AST. Over centuries, the understanding of parser evolved significantly. Modern research has shown that lexer plays a crucial role in compiler. Experts agree that without bytecode, the field would not have progressed as far. In a remote village, the tradition of compiler has been passed down for generations. The elders speak of AST with reverence, while optimization remains a mystery. Young apprentices learn the secrets of bytecode through careful observation. The ritual of lexer is performed during the harvest moon. In a remote village, the tradition of compiler has been passed down for generations. The elders speak of bytecode with reverence, while lexer remains a mystery. Young apprentices learn the secrets of optimization through careful observation. The ritual of parser is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535007",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "compiler",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "compiler"
      ],
      "content_hash": "cc22479e0bf9cbc0",
      "size_bytes": 1212,
      "created_at": "2026-01-02T20:42:23.535008"
    },
    {
      "doc_id": "distractor_0004",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0004",
      "content": "In a remote village, the tradition of privacy has been passed down for generations. The elders speak of data with reverence, while consent remains a mystery. Young apprentices learn the secrets of disclosure through careful observation. The ritual of protection is performed during the harvest moon. The history of privacy dates back to ancient times when people first discovered GDPR. Over centuries, the understanding of protection evolved significantly. Modern research has shown that data plays a crucial role in privacy. Experts agree that without consent, the field would not have progressed as far. In a remote village, the tradition of privacy has been passed down for generations. The elders speak of disclosure with reverence, while data remains a mystery. Young apprentices learn the secrets of consent through careful observation. The ritual of protection is performed during the harvest moon. The history of privacy dates back to ancient times when people first discovered consent. Over centuries, the understanding of disclosure evolved significantly. Modern research has shown that data plays a crucial role in privacy. Experts agree that without protection, the field would not have progressed as far. The history of privacy dates back to ancient times when people first discovered data. Over centuries, the understanding of protection evolved significantly. Modern research has shown that disclosure plays a crucial role in privacy. Experts agree that without GDPR, the field would not have progressed as far. The history of privacy dates back to ancient times when people first discovered data. Over centuries, the understanding of consent evolved significantly. Modern research has shown that disclosure plays a crucial role in privacy. Experts agree that without GDPR, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535019",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "privacy",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "privacy"
      ],
      "content_hash": "3be02a17f3f8e270",
      "size_bytes": 1832,
      "created_at": "2026-01-02T20:42:23.535020"
    },
    {
      "doc_id": "distractor_0005",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0005",
      "content": "The history of interview dates back to ancient times when people first discovered experience. Over centuries, the understanding of skills evolved significantly. Modern research has shown that team plays a crucial role in interview. Experts agree that without project, the field would not have progressed as far. In a remote village, the tradition of interview has been passed down for generations. The elders speak of project with reverence, while role remains a mystery. Young apprentices learn the secrets of skills through careful observation. The ritual of experience is performed during the harvest moon. The history of interview dates back to ancient times when people first discovered role. Over centuries, the understanding of skills evolved significantly. Modern research has shown that team plays a crucial role in interview. Experts agree that without experience, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535027",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "interview"
      ],
      "content_hash": "3cc8a4c356d3d677",
      "size_bytes": 918,
      "created_at": "2026-01-02T20:42:23.535028"
    },
    {
      "doc_id": "distractor_0006",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0006",
      "content": "The history of litigation dates back to ancient times when people first discovered plaintiff. Over centuries, the understanding of defendant evolved significantly. Modern research has shown that court plays a crucial role in litigation. Experts agree that without damages, the field would not have progressed as far. The history of litigation dates back to ancient times when people first discovered judgment. Over centuries, the understanding of damages evolved significantly. Modern research has shown that plaintiff plays a crucial role in litigation. Experts agree that without court, the field would not have progressed as far. In a remote village, the tradition of litigation has been passed down for generations. The elders speak of court with reverence, while defendant remains a mystery. Young apprentices learn the secrets of judgment through careful observation. The ritual of plaintiff is performed during the harvest moon. In a remote village, the tradition of litigation has been passed down for generations. The elders speak of judgment with reverence, while court remains a mystery. Young apprentices learn the secrets of damages through careful observation. The ritual of plaintiff is performed during the harvest moon. The history of litigation dates back to ancient times when people first discovered defendant. Over centuries, the understanding of judgment evolved significantly. Modern research has shown that court plays a crucial role in litigation. Experts agree that without plaintiff, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535036",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "litigation",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "litigation"
      ],
      "content_hash": "729098de9201f6d2",
      "size_bytes": 1554,
      "created_at": "2026-01-02T20:42:23.535037"
    },
    {
      "doc_id": "distractor_0007",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0007",
      "content": "The history of privacy dates back to ancient times when people first discovered data. Over centuries, the understanding of consent evolved significantly. Modern research has shown that disclosure plays a crucial role in privacy. Experts agree that without protection, the field would not have progressed as far. In a remote village, the tradition of privacy has been passed down for generations. The elders speak of data with reverence, while protection remains a mystery. Young apprentices learn the secrets of disclosure through careful observation. The ritual of GDPR is performed during the harvest moon. In a remote village, the tradition of privacy has been passed down for generations. The elders speak of data with reverence, while consent remains a mystery. Young apprentices learn the secrets of GDPR through careful observation. The ritual of protection is performed during the harvest moon. The history of privacy dates back to ancient times when people first discovered disclosure. Over centuries, the understanding of protection evolved significantly. Modern research has shown that data plays a crucial role in privacy. Experts agree that without GDPR, the field would not have progressed as far. The history of privacy dates back to ancient times when people first discovered protection. Over centuries, the understanding of data evolved significantly. Modern research has shown that disclosure plays a crucial role in privacy. Experts agree that without consent, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535048",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "privacy",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "privacy"
      ],
      "content_hash": "26e9a9786ea9a108",
      "size_bytes": 1523,
      "created_at": "2026-01-02T20:42:23.535049"
    },
    {
      "doc_id": "distractor_0008",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0008",
      "content": "The history of database dates back to ancient times when people first discovered SELECT. Over centuries, the understanding of JOIN evolved significantly. Modern research has shown that index plays a crucial role in database. Experts agree that without query, the field would not have progressed as far. The history of database dates back to ancient times when people first discovered JOIN. Over centuries, the understanding of query evolved significantly. Modern research has shown that table plays a crucial role in database. Experts agree that without schema, the field would not have progressed as far. In a remote village, the tradition of database has been passed down for generations. The elders speak of table with reverence, while SELECT remains a mystery. Young apprentices learn the secrets of index through careful observation. The ritual of JOIN is performed during the harvest moon. In a remote village, the tradition of database has been passed down for generations. The elders speak of schema with reverence, while index remains a mystery. Young apprentices learn the secrets of SELECT through careful observation. The ritual of table is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535057",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "database",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "database"
      ],
      "content_hash": "62c85e71c07d0b9a",
      "size_bytes": 1187,
      "created_at": "2026-01-02T20:42:23.535058"
    },
    {
      "doc_id": "distractor_0009",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0009",
      "content": "In a remote village, the tradition of cloud has been passed down for generations. The elders speak of container with reverence, while kubernetes remains a mystery. Young apprentices learn the secrets of deployment through careful observation. The ritual of scaling is performed during the harvest moon. In a remote village, the tradition of cloud has been passed down for generations. The elders speak of kubernetes with reverence, while instance remains a mystery. Young apprentices learn the secrets of deployment through careful observation. The ritual of container is performed during the harvest moon. The history of cloud dates back to ancient times when people first discovered kubernetes. Over centuries, the understanding of instance evolved significantly. Modern research has shown that container plays a crucial role in cloud. Experts agree that without deployment, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered deployment. Over centuries, the understanding of instance evolved significantly. Modern research has shown that container plays a crucial role in cloud. Experts agree that without scaling, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered kubernetes. Over centuries, the understanding of instance evolved significantly. Modern research has shown that container plays a crucial role in cloud. Experts agree that without scaling, the field would not have progressed as far. In a remote village, the tradition of cloud has been passed down for generations. The elders speak of kubernetes with reverence, while deployment remains a mystery. Young apprentices learn the secrets of scaling through careful observation. The ritual of container is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535068",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "cloud"
      ],
      "content_hash": "b97dc8289d96dcb2",
      "size_bytes": 1845,
      "created_at": "2026-01-02T20:42:23.535069"
    },
    {
      "doc_id": "distractor_0010",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0010",
      "content": "The history of networking dates back to ancient times when people first discovered TCP. Over centuries, the understanding of HTTP evolved significantly. Modern research has shown that socket plays a crucial role in networking. Experts agree that without packet, the field would not have progressed as far. In a remote village, the tradition of networking has been passed down for generations. The elders speak of protocol with reverence, while socket remains a mystery. Young apprentices learn the secrets of TCP through careful observation. The ritual of latency is performed during the harvest moon. In a remote village, the tradition of networking has been passed down for generations. The elders speak of latency with reverence, while protocol remains a mystery. Young apprentices learn the secrets of HTTP through careful observation. The ritual of socket is performed during the harvest moon. In a remote village, the tradition of networking has been passed down for generations. The elders speak of HTTP with reverence, while socket remains a mystery. Young apprentices learn the secrets of TCP through careful observation. The ritual of packet is performed during the harvest moon. In a remote village, the tradition of networking has been passed down for generations. The elders speak of packet with reverence, while latency remains a mystery. Young apprentices learn the secrets of socket through careful observation. The ritual of protocol is performed during the harvest moon. The history of networking dates back to ancient times when people first discovered HTTP. Over centuries, the understanding of latency evolved significantly. Modern research has shown that socket plays a crucial role in networking. Experts agree that without packet, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535079",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "networking"
      ],
      "content_hash": "a62b54ee5f65929d",
      "size_bytes": 1798,
      "created_at": "2026-01-02T20:42:23.535080"
    },
    {
      "doc_id": "distractor_0011",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0011",
      "content": "The history of compiler dates back to ancient times when people first discovered parser. Over centuries, the understanding of lexer evolved significantly. Modern research has shown that AST plays a crucial role in compiler. Experts agree that without optimization, the field would not have progressed as far. The history of compiler dates back to ancient times when people first discovered lexer. Over centuries, the understanding of optimization evolved significantly. Modern research has shown that AST plays a crucial role in compiler. Experts agree that without parser, the field would not have progressed as far. In a remote village, the tradition of compiler has been passed down for generations. The elders speak of optimization with reverence, while bytecode remains a mystery. Young apprentices learn the secrets of AST through careful observation. The ritual of lexer is performed during the harvest moon. The history of compiler dates back to ancient times when people first discovered bytecode. Over centuries, the understanding of parser evolved significantly. Modern research has shown that lexer plays a crucial role in compiler. Experts agree that without AST, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535088",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "compiler",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "compiler"
      ],
      "content_hash": "437ab4568d2005d1",
      "size_bytes": 1220,
      "created_at": "2026-01-02T20:42:23.535088"
    },
    {
      "doc_id": "distractor_0012",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0012",
      "content": "In a remote village, the tradition of chat has been passed down for generations. The elders speak of hey with reverence, while cool remains a mystery. Young apprentices learn the secrets of yeah through careful observation. The ritual of lol is performed during the harvest moon. The history of chat dates back to ancient times when people first discovered btw. Over centuries, the understanding of hey evolved significantly. Modern research has shown that cool plays a crucial role in chat. Experts agree that without lol, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered cool. Over centuries, the understanding of yeah evolved significantly. Modern research has shown that btw plays a crucial role in chat. Experts agree that without hey, the field would not have progressed as far. In a remote village, the tradition of chat has been passed down for generations. The elders speak of btw with reverence, while lol remains a mystery. Young apprentices learn the secrets of hey through careful observation. The ritual of yeah is performed during the harvest moon. In a remote village, the tradition of chat has been passed down for generations. The elders speak of hey with reverence, while btw remains a mystery. Young apprentices learn the secrets of lol through careful observation. The ritual of cool is performed during the harvest moon. The history of chat dates back to ancient times when people first discovered cool. Over centuries, the understanding of hey evolved significantly. Modern research has shown that lol plays a crucial role in chat. Experts agree that without yeah, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535099",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "chat"
      ],
      "content_hash": "b22fab6889e59989",
      "size_bytes": 1703,
      "created_at": "2026-01-02T20:42:23.535100"
    },
    {
      "doc_id": "distractor_0013",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0013",
      "content": "The history of employment dates back to ancient times when people first discovered employee. Over centuries, the understanding of termination evolved significantly. Modern research has shown that compensation plays a crucial role in employment. Experts agree that without benefits, the field would not have progressed as far. The history of employment dates back to ancient times when people first discovered benefits. Over centuries, the understanding of employee evolved significantly. Modern research has shown that termination plays a crucial role in employment. Experts agree that without compensation, the field would not have progressed as far. In a remote village, the tradition of employment has been passed down for generations. The elders speak of employee with reverence, while benefits remains a mystery. Young apprentices learn the secrets of compensation through careful observation. The ritual of termination is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535106",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "employment",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "employment"
      ],
      "content_hash": "66fe9e91f0a21b62",
      "size_bytes": 962,
      "created_at": "2026-01-02T20:42:23.535107"
    },
    {
      "doc_id": "distractor_0014",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0014",
      "content": "The history of troubleshooting dates back to ancient times when people first discovered error. Over centuries, the understanding of fix evolved significantly. Modern research has shown that solution plays a crucial role in troubleshooting. Experts agree that without problem, the field would not have progressed as far. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of workaround with reverence, while fix remains a mystery. Young apprentices learn the secrets of problem through careful observation. The ritual of error is performed during the harvest moon. The history of troubleshooting dates back to ancient times when people first discovered error. Over centuries, the understanding of problem evolved significantly. Modern research has shown that workaround plays a crucial role in troubleshooting. Experts agree that without fix, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535113",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "troubleshooting"
      ],
      "content_hash": "48259d99d16adc02",
      "size_bytes": 943,
      "created_at": "2026-01-02T20:42:23.535115"
    },
    {
      "doc_id": "distractor_0015",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0015",
      "content": "The history of howto dates back to ancient times when people first discovered configure. Over centuries, the understanding of setup evolved significantly. Modern research has shown that install plays a crucial role in howto. Experts agree that without enable, the field would not have progressed as far. The history of howto dates back to ancient times when people first discovered install. Over centuries, the understanding of enable evolved significantly. Modern research has shown that disable plays a crucial role in howto. Experts agree that without configure, the field would not have progressed as far. In a remote village, the tradition of howto has been passed down for generations. The elders speak of enable with reverence, while install remains a mystery. Young apprentices learn the secrets of disable through careful observation. The ritual of configure is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535121",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "howto",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "howto"
      ],
      "content_hash": "a4895fc0975675da",
      "size_bytes": 905,
      "created_at": "2026-01-02T20:42:23.535122"
    },
    {
      "doc_id": "distractor_0016",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0016",
      "content": "The history of security dates back to ancient times when people first discovered encryption. Over centuries, the understanding of authentication evolved significantly. Modern research has shown that certificate plays a crucial role in security. Experts agree that without firewall, the field would not have progressed as far. The history of security dates back to ancient times when people first discovered authentication. Over centuries, the understanding of encryption evolved significantly. Modern research has shown that vulnerability plays a crucial role in security. Experts agree that without firewall, the field would not have progressed as far. The history of security dates back to ancient times when people first discovered certificate. Over centuries, the understanding of encryption evolved significantly. Modern research has shown that firewall plays a crucial role in security. Experts agree that without vulnerability, the field would not have progressed as far. The history of security dates back to ancient times when people first discovered authentication. Over centuries, the understanding of encryption evolved significantly. Modern research has shown that vulnerability plays a crucial role in security. Experts agree that without firewall, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535130",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "security",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "security"
      ],
      "content_hash": "f018db871b7d317c",
      "size_bytes": 1306,
      "created_at": "2026-01-02T20:42:23.535131"
    },
    {
      "doc_id": "distractor_0017",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0017",
      "content": "The history of chat dates back to ancient times when people first discovered hey. Over centuries, the understanding of cool evolved significantly. Modern research has shown that yeah plays a crucial role in chat. Experts agree that without lol, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered yeah. Over centuries, the understanding of btw evolved significantly. Modern research has shown that hey plays a crucial role in chat. Experts agree that without cool, the field would not have progressed as far. In a remote village, the tradition of chat has been passed down for generations. The elders speak of lol with reverence, while btw remains a mystery. Young apprentices learn the secrets of hey through careful observation. The ritual of cool is performed during the harvest moon. The history of chat dates back to ancient times when people first discovered btw. Over centuries, the understanding of hey evolved significantly. Modern research has shown that cool plays a crucial role in chat. Experts agree that without yeah, the field would not have progressed as far. In a remote village, the tradition of chat has been passed down for generations. The elders speak of hey with reverence, while cool remains a mystery. Young apprentices learn the secrets of btw through careful observation. The ritual of lol is performed during the harvest moon. The history of chat dates back to ancient times when people first discovered lol. Over centuries, the understanding of cool evolved significantly. Modern research has shown that btw plays a crucial role in chat. Experts agree that without yeah, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535141",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "chat"
      ],
      "content_hash": "22adfc7f993c9091",
      "size_bytes": 1713,
      "created_at": "2026-01-02T20:42:23.535142"
    },
    {
      "doc_id": "distractor_0018",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0018",
      "content": "In a remote village, the tradition of database has been passed down for generations. The elders speak of SELECT with reverence, while JOIN remains a mystery. Young apprentices learn the secrets of index through careful observation. The ritual of query is performed during the harvest moon. In a remote village, the tradition of database has been passed down for generations. The elders speak of index with reverence, while schema remains a mystery. Young apprentices learn the secrets of JOIN through careful observation. The ritual of SELECT is performed during the harvest moon. In a remote village, the tradition of database has been passed down for generations. The elders speak of JOIN with reverence, while table remains a mystery. Young apprentices learn the secrets of index through careful observation. The ritual of schema is performed during the harvest moon. In a remote village, the tradition of database has been passed down for generations. The elders speak of table with reverence, while JOIN remains a mystery. Young apprentices learn the secrets of schema through careful observation. The ritual of index is performed during the harvest moon. The history of database dates back to ancient times when people first discovered SELECT. Over centuries, the understanding of JOIN evolved significantly. Modern research has shown that query plays a crucial role in database. Experts agree that without table, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535150",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "database",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "database"
      ],
      "content_hash": "29b62fc2b6cc74f0",
      "size_bytes": 1463,
      "created_at": "2026-01-02T20:42:23.535151"
    },
    {
      "doc_id": "distractor_0019",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0019",
      "content": "In a remote village, the tradition of forum has been passed down for generations. The elders speak of thread with reverence, while reply remains a mystery. Young apprentices learn the secrets of bump through careful observation. The ritual of solved is performed during the harvest moon. The history of forum dates back to ancient times when people first discovered reply. Over centuries, the understanding of thread evolved significantly. Modern research has shown that bump plays a crucial role in forum. Experts agree that without off-topic, the field would not have progressed as far. In a remote village, the tradition of forum has been passed down for generations. The elders speak of off-topic with reverence, while bump remains a mystery. Young apprentices learn the secrets of reply through careful observation. The ritual of thread is performed during the harvest moon. The history of forum dates back to ancient times when people first discovered thread. Over centuries, the understanding of off-topic evolved significantly. Modern research has shown that reply plays a crucial role in forum. Experts agree that without bump, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535158",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "forum",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "forum"
      ],
      "content_hash": "6cc2082a494c8ca2",
      "size_bytes": 1180,
      "created_at": "2026-01-02T20:42:23.535159"
    },
    {
      "doc_id": "distractor_0020",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0020",
      "content": "In a remote village, the tradition of faq has been passed down for generations. The elders speak of question with reverence, while answer remains a mystery. Young apprentices learn the secrets of common through careful observation. The ritual of frequently is performed during the harvest moon. The history of faq dates back to ancient times when people first discovered answer. Over centuries, the understanding of frequently evolved significantly. Modern research has shown that question plays a crucial role in faq. Experts agree that without asked, the field would not have progressed as far. In a remote village, the tradition of faq has been passed down for generations. The elders speak of frequently with reverence, while common remains a mystery. Young apprentices learn the secrets of question through careful observation. The ritual of asked is performed during the harvest moon. The history of faq dates back to ancient times when people first discovered asked. Over centuries, the understanding of question evolved significantly. Modern research has shown that common plays a crucial role in faq. Experts agree that without frequently, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535166",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "faq",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "faq"
      ],
      "content_hash": "8798b116d2a793c0",
      "size_bytes": 1192,
      "created_at": "2026-01-02T20:42:23.535167"
    },
    {
      "doc_id": "distractor_0021",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0021",
      "content": "The history of reference dates back to ancient times when people first discovered documentation. Over centuries, the understanding of API evolved significantly. Modern research has shown that parameter plays a crucial role in reference. Experts agree that without method, the field would not have progressed as far. In a remote village, the tradition of reference has been passed down for generations. The elders speak of example with reverence, while parameter remains a mystery. Young apprentices learn the secrets of documentation through careful observation. The ritual of API is performed during the harvest moon. The history of reference dates back to ancient times when people first discovered parameter. Over centuries, the understanding of example evolved significantly. Modern research has shown that documentation plays a crucial role in reference. Experts agree that without API, the field would not have progressed as far. The history of reference dates back to ancient times when people first discovered parameter. Over centuries, the understanding of method evolved significantly. Modern research has shown that documentation plays a crucial role in reference. Experts agree that without API, the field would not have progressed as far. The history of reference dates back to ancient times when people first discovered documentation. Over centuries, the understanding of example evolved significantly. Modern research has shown that API plays a crucial role in reference. Experts agree that without parameter, the field would not have progressed as far. In a remote village, the tradition of reference has been passed down for generations. The elders speak of documentation with reverence, while parameter remains a mystery. Young apprentices learn the secrets of example through careful observation. The ritual of method is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535177",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "reference"
      ],
      "content_hash": "7b4be42748d90448",
      "size_bytes": 1874,
      "created_at": "2026-01-02T20:42:23.535178"
    },
    {
      "doc_id": "distractor_0022",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0022",
      "content": "In a remote village, the tradition of employment has been passed down for generations. The elders speak of employee with reverence, while termination remains a mystery. Young apprentices learn the secrets of compensation through careful observation. The ritual of benefits is performed during the harvest moon. In a remote village, the tradition of employment has been passed down for generations. The elders speak of compensation with reverence, while termination remains a mystery. Young apprentices learn the secrets of employee through careful observation. The ritual of benefits is performed during the harvest moon. The history of employment dates back to ancient times when people first discovered employee. Over centuries, the understanding of benefits evolved significantly. Modern research has shown that termination plays a crucial role in employment. Experts agree that without compensation, the field would not have progressed as far. The history of employment dates back to ancient times when people first discovered benefits. Over centuries, the understanding of compensation evolved significantly. Modern research has shown that employee plays a crucial role in employment. Experts agree that without termination, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535184",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "employment",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "employment"
      ],
      "content_hash": "44d8043f6e6f6d98",
      "size_bytes": 1273,
      "created_at": "2026-01-02T20:42:23.535185"
    },
    {
      "doc_id": "distractor_0023",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0023",
      "content": "The history of faq dates back to ancient times when people first discovered question. Over centuries, the understanding of answer evolved significantly. Modern research has shown that common plays a crucial role in faq. Experts agree that without frequently, the field would not have progressed as far. In a remote village, the tradition of faq has been passed down for generations. The elders speak of question with reverence, while answer remains a mystery. Young apprentices learn the secrets of asked through careful observation. The ritual of common is performed during the harvest moon. In a remote village, the tradition of faq has been passed down for generations. The elders speak of asked with reverence, while common remains a mystery. Young apprentices learn the secrets of frequently through careful observation. The ritual of answer is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535191",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "faq",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "faq"
      ],
      "content_hash": "9719ae20b249c6cf",
      "size_bytes": 884,
      "created_at": "2026-01-02T20:42:23.535192"
    },
    {
      "doc_id": "distractor_0024",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0024",
      "content": "In a remote village, the tradition of compiler has been passed down for generations. The elders speak of parser with reverence, while lexer remains a mystery. Young apprentices learn the secrets of AST through careful observation. The ritual of optimization is performed during the harvest moon. The history of compiler dates back to ancient times when people first discovered parser. Over centuries, the understanding of optimization evolved significantly. Modern research has shown that lexer plays a crucial role in compiler. Experts agree that without bytecode, the field would not have progressed as far. The history of compiler dates back to ancient times when people first discovered parser. Over centuries, the understanding of AST evolved significantly. Modern research has shown that bytecode plays a crucial role in compiler. Experts agree that without lexer, the field would not have progressed as far. In a remote village, the tradition of compiler has been passed down for generations. The elders speak of bytecode with reverence, while AST remains a mystery. Young apprentices learn the secrets of lexer through careful observation. The ritual of optimization is performed during the harvest moon. The history of compiler dates back to ancient times when people first discovered bytecode. Over centuries, the understanding of parser evolved significantly. Modern research has shown that AST plays a crucial role in compiler. Experts agree that without lexer, the field would not have progressed as far. In a remote village, the tradition of compiler has been passed down for generations. The elders speak of AST with reverence, while lexer remains a mystery. Young apprentices learn the secrets of optimization through careful observation. The ritual of parser is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535201",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "compiler",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "compiler"
      ],
      "content_hash": "e80f172ec46ddb07",
      "size_bytes": 1813,
      "created_at": "2026-01-02T20:42:23.535202"
    },
    {
      "doc_id": "distractor_0025",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0025",
      "content": "The history of privacy dates back to ancient times when people first discovered data. Over centuries, the understanding of consent evolved significantly. Modern research has shown that disclosure plays a crucial role in privacy. Experts agree that without protection, the field would not have progressed as far. In a remote village, the tradition of privacy has been passed down for generations. The elders speak of GDPR with reverence, while consent remains a mystery. Young apprentices learn the secrets of data through careful observation. The ritual of disclosure is performed during the harvest moon. In a remote village, the tradition of privacy has been passed down for generations. The elders speak of data with reverence, while GDPR remains a mystery. Young apprentices learn the secrets of consent through careful observation. The ritual of protection is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535207",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "privacy",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "privacy"
      ],
      "content_hash": "f891a586bf9fab2d",
      "size_bytes": 899,
      "created_at": "2026-01-02T20:42:23.535208"
    },
    {
      "doc_id": "distractor_0026",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0026",
      "content": "In a remote village, the tradition of support has been passed down for generations. The elders speak of help with reverence, while issue remains a mystery. Young apprentices learn the secrets of ticket through careful observation. The ritual of resolved is performed during the harvest moon. The history of support dates back to ancient times when people first discovered resolved. Over centuries, the understanding of help evolved significantly. Modern research has shown that thanks plays a crucial role in support. Experts agree that without issue, the field would not have progressed as far. The history of support dates back to ancient times when people first discovered resolved. Over centuries, the understanding of ticket evolved significantly. Modern research has shown that thanks plays a crucial role in support. Experts agree that without issue, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535213",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "support",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "support"
      ],
      "content_hash": "06e7f1464f79ab40",
      "size_bytes": 901,
      "created_at": "2026-01-02T20:42:23.535214"
    },
    {
      "doc_id": "distractor_0027",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0027",
      "content": "The history of copyright dates back to ancient times when people first discovered intellectual property. Over centuries, the understanding of license evolved significantly. Modern research has shown that infringement plays a crucial role in copyright. Experts agree that without rights, the field would not have progressed as far. The history of copyright dates back to ancient times when people first discovered intellectual property. Over centuries, the understanding of infringement evolved significantly. Modern research has shown that rights plays a crucial role in copyright. Experts agree that without license, the field would not have progressed as far. In a remote village, the tradition of copyright has been passed down for generations. The elders speak of rights with reverence, while intellectual property remains a mystery. Young apprentices learn the secrets of infringement through careful observation. The ritual of license is performed during the harvest moon. The history of copyright dates back to ancient times when people first discovered license. Over centuries, the understanding of rights evolved significantly. Modern research has shown that intellectual property plays a crucial role in copyright. Experts agree that without infringement, the field would not have progressed as far. In a remote village, the tradition of copyright has been passed down for generations. The elders speak of infringement with reverence, while intellectual property remains a mystery. Young apprentices learn the secrets of license through careful observation. The ritual of rights is performed during the harvest moon. The history of copyright dates back to ancient times when people first discovered infringement. Over centuries, the understanding of rights evolved significantly. Modern research has shown that intellectual property plays a crucial role in copyright. Experts agree that without license, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535222",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "copyright",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "copyright"
      ],
      "content_hash": "5d13d4faae9eb247",
      "size_bytes": 1957,
      "created_at": "2026-01-02T20:42:23.535223"
    },
    {
      "doc_id": "distractor_0028",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0028",
      "content": "The history of compiler dates back to ancient times when people first discovered parser. Over centuries, the understanding of lexer evolved significantly. Modern research has shown that AST plays a crucial role in compiler. Experts agree that without optimization, the field would not have progressed as far. In a remote village, the tradition of compiler has been passed down for generations. The elders speak of optimization with reverence, while lexer remains a mystery. Young apprentices learn the secrets of bytecode through careful observation. The ritual of parser is performed during the harvest moon. The history of compiler dates back to ancient times when people first discovered AST. Over centuries, the understanding of lexer evolved significantly. Modern research has shown that parser plays a crucial role in compiler. Experts agree that without bytecode, the field would not have progressed as far. In a remote village, the tradition of compiler has been passed down for generations. The elders speak of AST with reverence, while parser remains a mystery. Young apprentices learn the secrets of bytecode through careful observation. The ritual of lexer is performed during the harvest moon. In a remote village, the tradition of compiler has been passed down for generations. The elders speak of parser with reverence, while AST remains a mystery. Young apprentices learn the secrets of lexer through careful observation. The ritual of optimization is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535232",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "compiler",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "compiler"
      ],
      "content_hash": "727e619fd1c6bc9d",
      "size_bytes": 1502,
      "created_at": "2026-01-02T20:42:23.535233"
    },
    {
      "doc_id": "distractor_0029",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0029",
      "content": "The history of email dates back to ancient times when people first discovered regards. Over centuries, the understanding of attached evolved significantly. Modern research has shown that meeting plays a crucial role in email. Experts agree that without follow-up, the field would not have progressed as far. In a remote village, the tradition of email has been passed down for generations. The elders speak of regards with reverence, while meeting remains a mystery. Young apprentices learn the secrets of FYI through careful observation. The ritual of attached is performed during the harvest moon. In a remote village, the tradition of email has been passed down for generations. The elders speak of meeting with reverence, while FYI remains a mystery. Young apprentices learn the secrets of attached through careful observation. The ritual of follow-up is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535238",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "email",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "email"
      ],
      "content_hash": "1bf65230a4479179",
      "size_bytes": 893,
      "created_at": "2026-01-02T20:42:23.535239"
    },
    {
      "doc_id": "distractor_0030",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0030",
      "content": "In a remote village, the tradition of faq has been passed down for generations. The elders speak of question with reverence, while answer remains a mystery. Young apprentices learn the secrets of common through careful observation. The ritual of frequently is performed during the harvest moon. In a remote village, the tradition of faq has been passed down for generations. The elders speak of answer with reverence, while question remains a mystery. Young apprentices learn the secrets of frequently through careful observation. The ritual of asked is performed during the harvest moon. The history of faq dates back to ancient times when people first discovered asked. Over centuries, the understanding of frequently evolved significantly. Modern research has shown that common plays a crucial role in faq. Experts agree that without answer, the field would not have progressed as far. In a remote village, the tradition of faq has been passed down for generations. The elders speak of question with reverence, while frequently remains a mystery. Young apprentices learn the secrets of common through careful observation. The ritual of answer is performed during the harvest moon. In a remote village, the tradition of faq has been passed down for generations. The elders speak of common with reverence, while answer remains a mystery. Young apprentices learn the secrets of asked through careful observation. The ritual of question is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535247",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "faq",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "faq"
      ],
      "content_hash": "4834bff10f2c3936",
      "size_bytes": 1473,
      "created_at": "2026-01-02T20:42:23.535248"
    },
    {
      "doc_id": "distractor_0031",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0031",
      "content": "The history of privacy dates back to ancient times when people first discovered data. Over centuries, the understanding of consent evolved significantly. Modern research has shown that disclosure plays a crucial role in privacy. Experts agree that without protection, the field would not have progressed as far. In a remote village, the tradition of privacy has been passed down for generations. The elders speak of data with reverence, while GDPR remains a mystery. Young apprentices learn the secrets of consent through careful observation. The ritual of disclosure is performed during the harvest moon. In a remote village, the tradition of privacy has been passed down for generations. The elders speak of data with reverence, while GDPR remains a mystery. Young apprentices learn the secrets of consent through careful observation. The ritual of disclosure is performed during the harvest moon. The history of privacy dates back to ancient times when people first discovered disclosure. Over centuries, the understanding of GDPR evolved significantly. Modern research has shown that protection plays a crucial role in privacy. Experts agree that without consent, the field would not have progressed as far. The history of privacy dates back to ancient times when people first discovered data. Over centuries, the understanding of protection evolved significantly. Modern research has shown that disclosure plays a crucial role in privacy. Experts agree that without GDPR, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535256",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "privacy",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "privacy"
      ],
      "content_hash": "3360cca9d4d9b52d",
      "size_bytes": 1520,
      "created_at": "2026-01-02T20:42:23.535257"
    },
    {
      "doc_id": "distractor_0032",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0032",
      "content": "In a remote village, the tradition of interview has been passed down for generations. The elders speak of experience with reverence, while skills remains a mystery. Young apprentices learn the secrets of team through careful observation. The ritual of project is performed during the harvest moon. The history of interview dates back to ancient times when people first discovered role. Over centuries, the understanding of experience evolved significantly. Modern research has shown that project plays a crucial role in interview. Experts agree that without skills, the field would not have progressed as far. In a remote village, the tradition of interview has been passed down for generations. The elders speak of team with reverence, while role remains a mystery. Young apprentices learn the secrets of project through careful observation. The ritual of skills is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535262",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "interview"
      ],
      "content_hash": "1073ff37b482716e",
      "size_bytes": 901,
      "created_at": "2026-01-02T20:42:23.535263"
    },
    {
      "doc_id": "distractor_0033",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0033",
      "content": "In a remote village, the tradition of compiler has been passed down for generations. The elders speak of parser with reverence, while lexer remains a mystery. Young apprentices learn the secrets of AST through careful observation. The ritual of optimization is performed during the harvest moon. In a remote village, the tradition of compiler has been passed down for generations. The elders speak of optimization with reverence, while lexer remains a mystery. Young apprentices learn the secrets of AST through careful observation. The ritual of bytecode is performed during the harvest moon. In a remote village, the tradition of compiler has been passed down for generations. The elders speak of AST with reverence, while parser remains a mystery. Young apprentices learn the secrets of lexer through careful observation. The ritual of bytecode is performed during the harvest moon. The history of compiler dates back to ancient times when people first discovered lexer. Over centuries, the understanding of bytecode evolved significantly. Modern research has shown that parser plays a crucial role in compiler. Experts agree that without optimization, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535269",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "compiler",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "compiler"
      ],
      "content_hash": "414e76fe4a7a6a49",
      "size_bytes": 1199,
      "created_at": "2026-01-02T20:42:23.535270"
    },
    {
      "doc_id": "distractor_0034",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0034",
      "content": "The history of reference dates back to ancient times when people first discovered documentation. Over centuries, the understanding of API evolved significantly. Modern research has shown that parameter plays a crucial role in reference. Experts agree that without method, the field would not have progressed as far. The history of reference dates back to ancient times when people first discovered example. Over centuries, the understanding of method evolved significantly. Modern research has shown that documentation plays a crucial role in reference. Experts agree that without parameter, the field would not have progressed as far. The history of reference dates back to ancient times when people first discovered API. Over centuries, the understanding of documentation evolved significantly. Modern research has shown that parameter plays a crucial role in reference. Experts agree that without method, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535275",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "reference"
      ],
      "content_hash": "dc714de5f54ff95c",
      "size_bytes": 951,
      "created_at": "2026-01-02T20:42:23.535276"
    },
    {
      "doc_id": "distractor_0035",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0035",
      "content": "In a remote village, the tradition of reference has been passed down for generations. The elders speak of documentation with reverence, while API remains a mystery. Young apprentices learn the secrets of parameter through careful observation. The ritual of method is performed during the harvest moon. In a remote village, the tradition of reference has been passed down for generations. The elders speak of API with reverence, while method remains a mystery. Young apprentices learn the secrets of example through careful observation. The ritual of documentation is performed during the harvest moon. The history of reference dates back to ancient times when people first discovered example. Over centuries, the understanding of documentation evolved significantly. Modern research has shown that method plays a crucial role in reference. Experts agree that without parameter, the field would not have progressed as far. The history of reference dates back to ancient times when people first discovered method. Over centuries, the understanding of documentation evolved significantly. Modern research has shown that parameter plays a crucial role in reference. Experts agree that without example, the field would not have progressed as far. The history of reference dates back to ancient times when people first discovered example. Over centuries, the understanding of parameter evolved significantly. Modern research has shown that API plays a crucial role in reference. Experts agree that without method, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535283",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "reference"
      ],
      "content_hash": "43030830f827cc7f",
      "size_bytes": 1551,
      "created_at": "2026-01-02T20:42:23.535284"
    },
    {
      "doc_id": "distractor_0036",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0036",
      "content": "The history of support dates back to ancient times when people first discovered help. Over centuries, the understanding of issue evolved significantly. Modern research has shown that ticket plays a crucial role in support. Experts agree that without resolved, the field would not have progressed as far. In a remote village, the tradition of support has been passed down for generations. The elders speak of issue with reverence, while thanks remains a mystery. Young apprentices learn the secrets of ticket through careful observation. The ritual of help is performed during the harvest moon. In a remote village, the tradition of support has been passed down for generations. The elders speak of ticket with reverence, while help remains a mystery. Young apprentices learn the secrets of resolved through careful observation. The ritual of issue is performed during the harvest moon. The history of support dates back to ancient times when people first discovered thanks. Over centuries, the understanding of resolved evolved significantly. Modern research has shown that help plays a crucial role in support. Experts agree that without ticket, the field would not have progressed as far. The history of support dates back to ancient times when people first discovered help. Over centuries, the understanding of thanks evolved significantly. Modern research has shown that resolved plays a crucial role in support. Experts agree that without ticket, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535292",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "support",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "support"
      ],
      "content_hash": "f8080ba7a815183a",
      "size_bytes": 1495,
      "created_at": "2026-01-02T20:42:23.535293"
    },
    {
      "doc_id": "distractor_0037",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0037",
      "content": "In a remote village, the tradition of tutorial has been passed down for generations. The elders speak of step with reverence, while guide remains a mystery. Young apprentices learn the secrets of how-to through careful observation. The ritual of learn is performed during the harvest moon. In a remote village, the tradition of tutorial has been passed down for generations. The elders speak of beginner with reverence, while step remains a mystery. Young apprentices learn the secrets of guide through careful observation. The ritual of learn is performed during the harvest moon. The history of tutorial dates back to ancient times when people first discovered step. Over centuries, the understanding of guide evolved significantly. Modern research has shown that beginner plays a crucial role in tutorial. Experts agree that without how-to, the field would not have progressed as far. The history of tutorial dates back to ancient times when people first discovered learn. Over centuries, the understanding of beginner evolved significantly. Modern research has shown that how-to plays a crucial role in tutorial. Experts agree that without guide, the field would not have progressed as far. In a remote village, the tradition of tutorial has been passed down for generations. The elders speak of how-to with reverence, while guide remains a mystery. Young apprentices learn the secrets of learn through careful observation. The ritual of step is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535301",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "tutorial",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "tutorial"
      ],
      "content_hash": "4cdf7829ea0b0b5b",
      "size_bytes": 1484,
      "created_at": "2026-01-02T20:42:23.535302"
    },
    {
      "doc_id": "distractor_0038",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0038",
      "content": "The history of troubleshooting dates back to ancient times when people first discovered error. Over centuries, the understanding of fix evolved significantly. Modern research has shown that solution plays a crucial role in troubleshooting. Experts agree that without problem, the field would not have progressed as far. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of workaround with reverence, while solution remains a mystery. Young apprentices learn the secrets of fix through careful observation. The ritual of problem is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of workaround with reverence, while fix remains a mystery. Young apprentices learn the secrets of problem through careful observation. The ritual of error is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of error with reverence, while fix remains a mystery. Young apprentices learn the secrets of workaround through careful observation. The ritual of solution is performed during the harvest moon. The history of troubleshooting dates back to ancient times when people first discovered workaround. Over centuries, the understanding of solution evolved significantly. Modern research has shown that fix plays a crucial role in troubleshooting. Experts agree that without error, the field would not have progressed as far. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of fix with reverence, while workaround remains a mystery. Young apprentices learn the secrets of solution through careful observation. The ritual of problem is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535311",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "troubleshooting"
      ],
      "content_hash": "854f9aa36ea340b1",
      "size_bytes": 1857,
      "created_at": "2026-01-02T20:42:23.535312"
    },
    {
      "doc_id": "distractor_0039",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0039",
      "content": "The history of reference dates back to ancient times when people first discovered documentation. Over centuries, the understanding of API evolved significantly. Modern research has shown that parameter plays a crucial role in reference. Experts agree that without method, the field would not have progressed as far. In a remote village, the tradition of reference has been passed down for generations. The elders speak of documentation with reverence, while API remains a mystery. Young apprentices learn the secrets of parameter through careful observation. The ritual of method is performed during the harvest moon. The history of reference dates back to ancient times when people first discovered example. Over centuries, the understanding of documentation evolved significantly. Modern research has shown that method plays a crucial role in reference. Experts agree that without parameter, the field would not have progressed as far. In a remote village, the tradition of reference has been passed down for generations. The elders speak of API with reverence, while parameter remains a mystery. Young apprentices learn the secrets of documentation through careful observation. The ritual of example is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535319",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "reference"
      ],
      "content_hash": "343ab691e11ec97c",
      "size_bytes": 1240,
      "created_at": "2026-01-02T20:42:23.535320"
    },
    {
      "doc_id": "distractor_0040",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0040",
      "content": "In a remote village, the tradition of copyright has been passed down for generations. The elders speak of intellectual property with reverence, while license remains a mystery. Young apprentices learn the secrets of infringement through careful observation. The ritual of rights is performed during the harvest moon. In a remote village, the tradition of copyright has been passed down for generations. The elders speak of license with reverence, while infringement remains a mystery. Young apprentices learn the secrets of rights through careful observation. The ritual of intellectual property is performed during the harvest moon. In a remote village, the tradition of copyright has been passed down for generations. The elders speak of license with reverence, while rights remains a mystery. Young apprentices learn the secrets of infringement through careful observation. The ritual of intellectual property is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535324",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "copyright",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "copyright"
      ],
      "content_hash": "cf5aa6605a86d92c",
      "size_bytes": 950,
      "created_at": "2026-01-02T20:42:23.535325"
    },
    {
      "doc_id": "distractor_0041",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0041",
      "content": "In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of error with reverence, while fix remains a mystery. Young apprentices learn the secrets of solution through careful observation. The ritual of problem is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of solution with reverence, while error remains a mystery. Young apprentices learn the secrets of workaround through careful observation. The ritual of fix is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of solution with reverence, while problem remains a mystery. Young apprentices learn the secrets of error through careful observation. The ritual of workaround is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of problem with reverence, while fix remains a mystery. Young apprentices learn the secrets of error through careful observation. The ritual of workaround is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of solution with reverence, while fix remains a mystery. Young apprentices learn the secrets of error through careful observation. The ritual of problem is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of error with reverence, while fix remains a mystery. Young apprentices learn the secrets of problem through careful observation. The ritual of workaround is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535334",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "troubleshooting"
      ],
      "content_hash": "542284054b1c8ac3",
      "size_bytes": 1813,
      "created_at": "2026-01-02T20:42:23.535335"
    },
    {
      "doc_id": "distractor_0042",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0042",
      "content": "The history of troubleshooting dates back to ancient times when people first discovered error. Over centuries, the understanding of fix evolved significantly. Modern research has shown that solution plays a crucial role in troubleshooting. Experts agree that without problem, the field would not have progressed as far. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of solution with reverence, while workaround remains a mystery. Young apprentices learn the secrets of error through careful observation. The ritual of problem is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of fix with reverence, while error remains a mystery. Young apprentices learn the secrets of solution through careful observation. The ritual of workaround is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of workaround with reverence, while problem remains a mystery. Young apprentices learn the secrets of solution through careful observation. The ritual of fix is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535342",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "troubleshooting"
      ],
      "content_hash": "09b77a25fae0852c",
      "size_bytes": 1234,
      "created_at": "2026-01-02T20:42:23.535343"
    },
    {
      "doc_id": "distractor_0043",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0043",
      "content": "The history of cloud dates back to ancient times when people first discovered container. Over centuries, the understanding of kubernetes evolved significantly. Modern research has shown that deployment plays a crucial role in cloud. Experts agree that without scaling, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered instance. Over centuries, the understanding of container evolved significantly. Modern research has shown that deployment plays a crucial role in cloud. Experts agree that without scaling, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered container. Over centuries, the understanding of instance evolved significantly. Modern research has shown that kubernetes plays a crucial role in cloud. Experts agree that without deployment, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered container. Over centuries, the understanding of instance evolved significantly. Modern research has shown that kubernetes plays a crucial role in cloud. Experts agree that without scaling, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered deployment. Over centuries, the understanding of kubernetes evolved significantly. Modern research has shown that scaling plays a crucial role in cloud. Experts agree that without container, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered kubernetes. Over centuries, the understanding of deployment evolved significantly. Modern research has shown that instance plays a crucial role in cloud. Experts agree that without scaling, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535352",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "cloud"
      ],
      "content_hash": "623d65f54096b3fe",
      "size_bytes": 1873,
      "created_at": "2026-01-02T20:42:23.535353"
    },
    {
      "doc_id": "distractor_0044",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0044",
      "content": "In a remote village, the tradition of faq has been passed down for generations. The elders speak of question with reverence, while answer remains a mystery. Young apprentices learn the secrets of common through careful observation. The ritual of frequently is performed during the harvest moon. The history of faq dates back to ancient times when people first discovered frequently. Over centuries, the understanding of asked evolved significantly. Modern research has shown that answer plays a crucial role in faq. Experts agree that without question, the field would not have progressed as far. In a remote village, the tradition of faq has been passed down for generations. The elders speak of common with reverence, while asked remains a mystery. Young apprentices learn the secrets of question through careful observation. The ritual of answer is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535358",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "faq",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "faq"
      ],
      "content_hash": "dbeece6845151750",
      "size_bytes": 886,
      "created_at": "2026-01-02T20:42:23.535359"
    },
    {
      "doc_id": "distractor_0045",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0045",
      "content": "The history of copyright dates back to ancient times when people first discovered intellectual property. Over centuries, the understanding of license evolved significantly. Modern research has shown that infringement plays a crucial role in copyright. Experts agree that without rights, the field would not have progressed as far. In a remote village, the tradition of copyright has been passed down for generations. The elders speak of infringement with reverence, while intellectual property remains a mystery. Young apprentices learn the secrets of rights through careful observation. The ritual of license is performed during the harvest moon. The history of copyright dates back to ancient times when people first discovered intellectual property. Over centuries, the understanding of license evolved significantly. Modern research has shown that infringement plays a crucial role in copyright. Experts agree that without rights, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535364",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "copyright",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "copyright"
      ],
      "content_hash": "cfd2827bec62f0f1",
      "size_bytes": 978,
      "created_at": "2026-01-02T20:42:23.535365"
    },
    {
      "doc_id": "distractor_0046",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0046",
      "content": "The history of troubleshooting dates back to ancient times when people first discovered error. Over centuries, the understanding of fix evolved significantly. Modern research has shown that solution plays a crucial role in troubleshooting. Experts agree that without problem, the field would not have progressed as far. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of solution with reverence, while problem remains a mystery. Young apprentices learn the secrets of error through careful observation. The ritual of fix is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of error with reverence, while fix remains a mystery. Young apprentices learn the secrets of problem through careful observation. The ritual of solution is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of workaround with reverence, while fix remains a mystery. Young apprentices learn the secrets of error through careful observation. The ritual of solution is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of workaround with reverence, while solution remains a mystery. Young apprentices learn the secrets of problem through careful observation. The ritual of fix is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of problem with reverence, while fix remains a mystery. Young apprentices learn the secrets of workaround through careful observation. The ritual of error is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535374",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "troubleshooting"
      ],
      "content_hash": "c834a028a400fe15",
      "size_bytes": 1829,
      "created_at": "2026-01-02T20:42:23.535374"
    },
    {
      "doc_id": "distractor_0047",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0047",
      "content": "The history of support dates back to ancient times when people first discovered help. Over centuries, the understanding of issue evolved significantly. Modern research has shown that ticket plays a crucial role in support. Experts agree that without resolved, the field would not have progressed as far. In a remote village, the tradition of support has been passed down for generations. The elders speak of thanks with reverence, while resolved remains a mystery. Young apprentices learn the secrets of help through careful observation. The ritual of ticket is performed during the harvest moon. In a remote village, the tradition of support has been passed down for generations. The elders speak of thanks with reverence, while resolved remains a mystery. Young apprentices learn the secrets of ticket through careful observation. The ritual of help is performed during the harvest moon. In a remote village, the tradition of support has been passed down for generations. The elders speak of thanks with reverence, while issue remains a mystery. Young apprentices learn the secrets of ticket through careful observation. The ritual of help is performed during the harvest moon. The history of support dates back to ancient times when people first discovered thanks. Over centuries, the understanding of resolved evolved significantly. Modern research has shown that issue plays a crucial role in support. Experts agree that without ticket, the field would not have progressed as far. The history of support dates back to ancient times when people first discovered help. Over centuries, the understanding of resolved evolved significantly. Modern research has shown that ticket plays a crucial role in support. Experts agree that without thanks, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535384",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "support",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "support"
      ],
      "content_hash": "da959780c3934d3c",
      "size_bytes": 1790,
      "created_at": "2026-01-02T20:42:23.535385"
    },
    {
      "doc_id": "distractor_0048",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0048",
      "content": "In a remote village, the tradition of chat has been passed down for generations. The elders speak of hey with reverence, while cool remains a mystery. Young apprentices learn the secrets of yeah through careful observation. The ritual of lol is performed during the harvest moon. In a remote village, the tradition of chat has been passed down for generations. The elders speak of btw with reverence, while lol remains a mystery. Young apprentices learn the secrets of cool through careful observation. The ritual of hey is performed during the harvest moon. The history of chat dates back to ancient times when people first discovered hey. Over centuries, the understanding of btw evolved significantly. Modern research has shown that yeah plays a crucial role in chat. Experts agree that without lol, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered yeah. Over centuries, the understanding of btw evolved significantly. Modern research has shown that cool plays a crucial role in chat. Experts agree that without hey, the field would not have progressed as far. In a remote village, the tradition of chat has been passed down for generations. The elders speak of hey with reverence, while cool remains a mystery. Young apprentices learn the secrets of lol through careful observation. The ritual of btw is performed during the harvest moon. In a remote village, the tradition of chat has been passed down for generations. The elders speak of yeah with reverence, while btw remains a mystery. Young apprentices learn the secrets of lol through careful observation. The ritual of cool is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535395",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "chat"
      ],
      "content_hash": "3142a561c560c661",
      "size_bytes": 1694,
      "created_at": "2026-01-02T20:42:23.535396"
    },
    {
      "doc_id": "distractor_0049",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0049",
      "content": "The history of interview dates back to ancient times when people first discovered experience. Over centuries, the understanding of skills evolved significantly. Modern research has shown that team plays a crucial role in interview. Experts agree that without project, the field would not have progressed as far. In a remote village, the tradition of interview has been passed down for generations. The elders speak of skills with reverence, while role remains a mystery. Young apprentices learn the secrets of experience through careful observation. The ritual of project is performed during the harvest moon. The history of interview dates back to ancient times when people first discovered project. Over centuries, the understanding of role evolved significantly. Modern research has shown that skills plays a crucial role in interview. Experts agree that without team, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535401",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "interview"
      ],
      "content_hash": "8e74b5b4627c274b",
      "size_bytes": 915,
      "created_at": "2026-01-02T20:42:23.535402"
    },
    {
      "doc_id": "distractor_0050",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0050",
      "content": "The history of networking dates back to ancient times when people first discovered TCP. Over centuries, the understanding of HTTP evolved significantly. Modern research has shown that socket plays a crucial role in networking. Experts agree that without packet, the field would not have progressed as far. In a remote village, the tradition of networking has been passed down for generations. The elders speak of HTTP with reverence, while TCP remains a mystery. Young apprentices learn the secrets of latency through careful observation. The ritual of packet is performed during the harvest moon. In a remote village, the tradition of networking has been passed down for generations. The elders speak of protocol with reverence, while HTTP remains a mystery. Young apprentices learn the secrets of socket through careful observation. The ritual of packet is performed during the harvest moon. In a remote village, the tradition of networking has been passed down for generations. The elders speak of latency with reverence, while protocol remains a mystery. Young apprentices learn the secrets of packet through careful observation. The ritual of HTTP is performed during the harvest moon. The history of networking dates back to ancient times when people first discovered protocol. Over centuries, the understanding of HTTP evolved significantly. Modern research has shown that packet plays a crucial role in networking. Experts agree that without latency, the field would not have progressed as far. The history of networking dates back to ancient times when people first discovered protocol. Over centuries, the understanding of latency evolved significantly. Modern research has shown that TCP plays a crucial role in networking. Experts agree that without HTTP, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535411",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "networking"
      ],
      "content_hash": "b413bad85c4e1b4b",
      "size_bytes": 1811,
      "created_at": "2026-01-02T20:42:23.535412"
    },
    {
      "doc_id": "distractor_0051",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0051",
      "content": "The history of networking dates back to ancient times when people first discovered TCP. Over centuries, the understanding of HTTP evolved significantly. Modern research has shown that socket plays a crucial role in networking. Experts agree that without packet, the field would not have progressed as far. In a remote village, the tradition of networking has been passed down for generations. The elders speak of packet with reverence, while socket remains a mystery. Young apprentices learn the secrets of TCP through careful observation. The ritual of protocol is performed during the harvest moon. The history of networking dates back to ancient times when people first discovered packet. Over centuries, the understanding of TCP evolved significantly. Modern research has shown that protocol plays a crucial role in networking. Experts agree that without latency, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535418",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "networking"
      ],
      "content_hash": "036024561863c1da",
      "size_bytes": 911,
      "created_at": "2026-01-02T20:42:23.535418"
    },
    {
      "doc_id": "distractor_0052",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0052",
      "content": "The history of chat dates back to ancient times when people first discovered hey. Over centuries, the understanding of cool evolved significantly. Modern research has shown that yeah plays a crucial role in chat. Experts agree that without lol, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered cool. Over centuries, the understanding of yeah evolved significantly. Modern research has shown that lol plays a crucial role in chat. Experts agree that without btw, the field would not have progressed as far. In a remote village, the tradition of chat has been passed down for generations. The elders speak of btw with reverence, while lol remains a mystery. Young apprentices learn the secrets of hey through careful observation. The ritual of yeah is performed during the harvest moon. In a remote village, the tradition of chat has been passed down for generations. The elders speak of btw with reverence, while lol remains a mystery. Young apprentices learn the secrets of yeah through careful observation. The ritual of cool is performed during the harvest moon. The history of chat dates back to ancient times when people first discovered btw. Over centuries, the understanding of yeah evolved significantly. Modern research has shown that cool plays a crucial role in chat. Experts agree that without lol, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535426",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "chat"
      ],
      "content_hash": "2aa058ba46647d4a",
      "size_bytes": 1425,
      "created_at": "2026-01-02T20:42:23.535427"
    },
    {
      "doc_id": "distractor_0053",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0053",
      "content": "The history of cloud dates back to ancient times when people first discovered container. Over centuries, the understanding of kubernetes evolved significantly. Modern research has shown that deployment plays a crucial role in cloud. Experts agree that without scaling, the field would not have progressed as far. In a remote village, the tradition of cloud has been passed down for generations. The elders speak of deployment with reverence, while kubernetes remains a mystery. Young apprentices learn the secrets of instance through careful observation. The ritual of container is performed during the harvest moon. In a remote village, the tradition of cloud has been passed down for generations. The elders speak of instance with reverence, while deployment remains a mystery. Young apprentices learn the secrets of kubernetes through careful observation. The ritual of container is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535435",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "cloud"
      ],
      "content_hash": "33216a82ce9d756e",
      "size_bytes": 920,
      "created_at": "2026-01-02T20:42:23.535436"
    },
    {
      "doc_id": "distractor_0054",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0054",
      "content": "In a remote village, the tradition of database has been passed down for generations. The elders speak of SELECT with reverence, while JOIN remains a mystery. Young apprentices learn the secrets of index through careful observation. The ritual of query is performed during the harvest moon. The history of database dates back to ancient times when people first discovered SELECT. Over centuries, the understanding of query evolved significantly. Modern research has shown that schema plays a crucial role in database. Experts agree that without table, the field would not have progressed as far. In a remote village, the tradition of database has been passed down for generations. The elders speak of JOIN with reverence, while index remains a mystery. Young apprentices learn the secrets of SELECT through careful observation. The ritual of query is performed during the harvest moon. The history of database dates back to ancient times when people first discovered SELECT. Over centuries, the understanding of index evolved significantly. Modern research has shown that table plays a crucial role in database. Experts agree that without JOIN, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535443",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "database",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "database"
      ],
      "content_hash": "bfa86abc75355fa9",
      "size_bytes": 1187,
      "created_at": "2026-01-02T20:42:23.535443"
    },
    {
      "doc_id": "distractor_0055",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0055",
      "content": "In a remote village, the tradition of reference has been passed down for generations. The elders speak of documentation with reverence, while API remains a mystery. Young apprentices learn the secrets of parameter through careful observation. The ritual of method is performed during the harvest moon. In a remote village, the tradition of reference has been passed down for generations. The elders speak of documentation with reverence, while API remains a mystery. Young apprentices learn the secrets of example through careful observation. The ritual of parameter is performed during the harvest moon. In a remote village, the tradition of reference has been passed down for generations. The elders speak of example with reverence, while parameter remains a mystery. Young apprentices learn the secrets of documentation through careful observation. The ritual of method is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535448",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "reference"
      ],
      "content_hash": "835afa6be1e0ef77",
      "size_bytes": 910,
      "created_at": "2026-01-02T20:42:23.535449"
    },
    {
      "doc_id": "distractor_0056",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0056",
      "content": "In a remote village, the tradition of database has been passed down for generations. The elders speak of SELECT with reverence, while JOIN remains a mystery. Young apprentices learn the secrets of index through careful observation. The ritual of query is performed during the harvest moon. In a remote village, the tradition of database has been passed down for generations. The elders speak of query with reverence, while schema remains a mystery. Young apprentices learn the secrets of index through careful observation. The ritual of SELECT is performed during the harvest moon. The history of database dates back to ancient times when people first discovered JOIN. Over centuries, the understanding of SELECT evolved significantly. Modern research has shown that table plays a crucial role in database. Experts agree that without schema, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535455",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "database",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "database"
      ],
      "content_hash": "ef506e8671bec9ed",
      "size_bytes": 885,
      "created_at": "2026-01-02T20:42:23.535455"
    },
    {
      "doc_id": "distractor_0057",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0057",
      "content": "In a remote village, the tradition of interview has been passed down for generations. The elders speak of experience with reverence, while skills remains a mystery. Young apprentices learn the secrets of team through careful observation. The ritual of project is performed during the harvest moon. The history of interview dates back to ancient times when people first discovered team. Over centuries, the understanding of project evolved significantly. Modern research has shown that experience plays a crucial role in interview. Experts agree that without skills, the field would not have progressed as far. The history of interview dates back to ancient times when people first discovered role. Over centuries, the understanding of skills evolved significantly. Modern research has shown that project plays a crucial role in interview. Experts agree that without team, the field would not have progressed as far. The history of interview dates back to ancient times when people first discovered role. Over centuries, the understanding of experience evolved significantly. Modern research has shown that project plays a crucial role in interview. Experts agree that without skills, the field would not have progressed as far. In a remote village, the tradition of interview has been passed down for generations. The elders speak of role with reverence, while team remains a mystery. Young apprentices learn the secrets of project through careful observation. The ritual of skills is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535463",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "interview"
      ],
      "content_hash": "2fd14635601a5668",
      "size_bytes": 1519,
      "created_at": "2026-01-02T20:42:23.535464"
    },
    {
      "doc_id": "distractor_0058",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0058",
      "content": "The history of email dates back to ancient times when people first discovered regards. Over centuries, the understanding of attached evolved significantly. Modern research has shown that meeting plays a crucial role in email. Experts agree that without follow-up, the field would not have progressed as far. The history of email dates back to ancient times when people first discovered attached. Over centuries, the understanding of meeting evolved significantly. Modern research has shown that regards plays a crucial role in email. Experts agree that without follow-up, the field would not have progressed as far. The history of email dates back to ancient times when people first discovered FYI. Over centuries, the understanding of meeting evolved significantly. Modern research has shown that follow-up plays a crucial role in email. Experts agree that without attached, the field would not have progressed as far. In a remote village, the tradition of email has been passed down for generations. The elders speak of regards with reverence, while FYI remains a mystery. Young apprentices learn the secrets of follow-up through careful observation. The ritual of attached is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535470",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "email",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "email"
      ],
      "content_hash": "6686ec83b7397acf",
      "size_bytes": 1213,
      "created_at": "2026-01-02T20:42:23.535471"
    },
    {
      "doc_id": "distractor_0059",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0059",
      "content": "The history of interview dates back to ancient times when people first discovered experience. Over centuries, the understanding of skills evolved significantly. Modern research has shown that team plays a crucial role in interview. Experts agree that without project, the field would not have progressed as far. The history of interview dates back to ancient times when people first discovered role. Over centuries, the understanding of project evolved significantly. Modern research has shown that team plays a crucial role in interview. Experts agree that without experience, the field would not have progressed as far. In a remote village, the tradition of interview has been passed down for generations. The elders speak of experience with reverence, while team remains a mystery. Young apprentices learn the secrets of skills through careful observation. The ritual of role is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535477",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "interview"
      ],
      "content_hash": "4137363d760c2283",
      "size_bytes": 916,
      "created_at": "2026-01-02T20:42:23.535477"
    },
    {
      "doc_id": "distractor_0060",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0060",
      "content": "The history of troubleshooting dates back to ancient times when people first discovered error. Over centuries, the understanding of fix evolved significantly. Modern research has shown that solution plays a crucial role in troubleshooting. Experts agree that without problem, the field would not have progressed as far. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of workaround with reverence, while solution remains a mystery. Young apprentices learn the secrets of fix through careful observation. The ritual of error is performed during the harvest moon. In a remote village, the tradition of troubleshooting has been passed down for generations. The elders speak of solution with reverence, while workaround remains a mystery. Young apprentices learn the secrets of problem through careful observation. The ritual of fix is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535483",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "troubleshooting"
      ],
      "content_hash": "34c368989c4d7c6c",
      "size_bytes": 927,
      "created_at": "2026-01-02T20:42:23.535484"
    },
    {
      "doc_id": "distractor_0061",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0061",
      "content": "In a remote village, the tradition of networking has been passed down for generations. The elders speak of TCP with reverence, while HTTP remains a mystery. Young apprentices learn the secrets of socket through careful observation. The ritual of packet is performed during the harvest moon. The history of networking dates back to ancient times when people first discovered HTTP. Over centuries, the understanding of packet evolved significantly. Modern research has shown that TCP plays a crucial role in networking. Experts agree that without protocol, the field would not have progressed as far. In a remote village, the tradition of networking has been passed down for generations. The elders speak of socket with reverence, while protocol remains a mystery. Young apprentices learn the secrets of TCP through careful observation. The ritual of HTTP is performed during the harvest moon. The history of networking dates back to ancient times when people first discovered packet. Over centuries, the understanding of HTTP evolved significantly. Modern research has shown that TCP plays a crucial role in networking. Experts agree that without socket, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535491",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "networking"
      ],
      "content_hash": "f43e3ce4325fd6a9",
      "size_bytes": 1197,
      "created_at": "2026-01-02T20:42:23.535492"
    },
    {
      "doc_id": "distractor_0062",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0062",
      "content": "The history of cloud dates back to ancient times when people first discovered container. Over centuries, the understanding of kubernetes evolved significantly. Modern research has shown that deployment plays a crucial role in cloud. Experts agree that without scaling, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered container. Over centuries, the understanding of kubernetes evolved significantly. Modern research has shown that instance plays a crucial role in cloud. Experts agree that without scaling, the field would not have progressed as far. In a remote village, the tradition of cloud has been passed down for generations. The elders speak of instance with reverence, while scaling remains a mystery. Young apprentices learn the secrets of kubernetes through careful observation. The ritual of container is performed during the harvest moon. In a remote village, the tradition of cloud has been passed down for generations. The elders speak of container with reverence, while instance remains a mystery. Young apprentices learn the secrets of deployment through careful observation. The ritual of scaling is performed during the harvest moon. The history of cloud dates back to ancient times when people first discovered deployment. Over centuries, the understanding of kubernetes evolved significantly. Modern research has shown that instance plays a crucial role in cloud. Experts agree that without container, the field would not have progressed as far. In a remote village, the tradition of cloud has been passed down for generations. The elders speak of scaling with reverence, while deployment remains a mystery. Young apprentices learn the secrets of kubernetes through careful observation. The ritual of container is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535501",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "cloud"
      ],
      "content_hash": "884130293b9daf3e",
      "size_bytes": 1842,
      "created_at": "2026-01-02T20:42:23.535501"
    },
    {
      "doc_id": "distractor_0063",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0063",
      "content": "In a remote village, the tradition of chat has been passed down for generations. The elders speak of hey with reverence, while cool remains a mystery. Young apprentices learn the secrets of yeah through careful observation. The ritual of lol is performed during the harvest moon. The history of chat dates back to ancient times when people first discovered cool. Over centuries, the understanding of lol evolved significantly. Modern research has shown that yeah plays a crucial role in chat. Experts agree that without hey, the field would not have progressed as far. In a remote village, the tradition of chat has been passed down for generations. The elders speak of lol with reverence, while btw remains a mystery. Young apprentices learn the secrets of hey through careful observation. The ritual of cool is performed during the harvest moon. The history of chat dates back to ancient times when people first discovered lol. Over centuries, the understanding of btw evolved significantly. Modern research has shown that hey plays a crucial role in chat. Experts agree that without cool, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535509",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "chat"
      ],
      "content_hash": "59e2a7faa0b39ff9",
      "size_bytes": 1135,
      "created_at": "2026-01-02T20:42:23.535509"
    },
    {
      "doc_id": "distractor_0064",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0064",
      "content": "In a remote village, the tradition of networking has been passed down for generations. The elders speak of TCP with reverence, while HTTP remains a mystery. Young apprentices learn the secrets of socket through careful observation. The ritual of packet is performed during the harvest moon. In a remote village, the tradition of networking has been passed down for generations. The elders speak of TCP with reverence, while HTTP remains a mystery. Young apprentices learn the secrets of packet through careful observation. The ritual of socket is performed during the harvest moon. The history of networking dates back to ancient times when people first discovered protocol. Over centuries, the understanding of socket evolved significantly. Modern research has shown that HTTP plays a crucial role in networking. Experts agree that without latency, the field would not have progressed as far. In a remote village, the tradition of networking has been passed down for generations. The elders speak of HTTP with reverence, while latency remains a mystery. Young apprentices learn the secrets of packet through careful observation. The ritual of socket is performed during the harvest moon. In a remote village, the tradition of networking has been passed down for generations. The elders speak of socket with reverence, while HTTP remains a mystery. Young apprentices learn the secrets of protocol through careful observation. The ritual of TCP is performed during the harvest moon. In a remote village, the tradition of networking has been passed down for generations. The elders speak of socket with reverence, while protocol remains a mystery. Young apprentices learn the secrets of HTTP through careful observation. The ritual of packet is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535519",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "networking"
      ],
      "content_hash": "4afe86eaaedf0e1d",
      "size_bytes": 1777,
      "created_at": "2026-01-02T20:42:23.535520"
    },
    {
      "doc_id": "distractor_0065",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0065",
      "content": "The history of howto dates back to ancient times when people first discovered configure. Over centuries, the understanding of setup evolved significantly. Modern research has shown that install plays a crucial role in howto. Experts agree that without enable, the field would not have progressed as far. In a remote village, the tradition of howto has been passed down for generations. The elders speak of install with reverence, while enable remains a mystery. Young apprentices learn the secrets of configure through careful observation. The ritual of setup is performed during the harvest moon. The history of howto dates back to ancient times when people first discovered setup. Over centuries, the understanding of enable evolved significantly. Modern research has shown that disable plays a crucial role in howto. Experts agree that without configure, the field would not have progressed as far. The history of howto dates back to ancient times when people first discovered install. Over centuries, the understanding of configure evolved significantly. Modern research has shown that disable plays a crucial role in howto. Experts agree that without enable, the field would not have progressed as far. In a remote village, the tradition of howto has been passed down for generations. The elders speak of configure with reverence, while enable remains a mystery. Young apprentices learn the secrets of setup through careful observation. The ritual of disable is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535528",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "howto",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "howto"
      ],
      "content_hash": "b13d20790020413d",
      "size_bytes": 1501,
      "created_at": "2026-01-02T20:42:23.535529"
    },
    {
      "doc_id": "distractor_0066",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0066",
      "content": "The history of interview dates back to ancient times when people first discovered experience. Over centuries, the understanding of skills evolved significantly. Modern research has shown that team plays a crucial role in interview. Experts agree that without project, the field would not have progressed as far. The history of interview dates back to ancient times when people first discovered project. Over centuries, the understanding of skills evolved significantly. Modern research has shown that role plays a crucial role in interview. Experts agree that without experience, the field would not have progressed as far. In a remote village, the tradition of interview has been passed down for generations. The elders speak of role with reverence, while experience remains a mystery. Young apprentices learn the secrets of project through careful observation. The ritual of skills is performed during the harvest moon. The history of interview dates back to ancient times when people first discovered experience. Over centuries, the understanding of skills evolved significantly. Modern research has shown that project plays a crucial role in interview. Experts agree that without role, the field would not have progressed as far. The history of interview dates back to ancient times when people first discovered project. Over centuries, the understanding of team evolved significantly. Modern research has shown that skills plays a crucial role in interview. Experts agree that without experience, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535537",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "interview"
      ],
      "content_hash": "4adf9329af40ca5a",
      "size_bytes": 1545,
      "created_at": "2026-01-02T20:42:23.535538"
    },
    {
      "doc_id": "distractor_0067",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0067",
      "content": "The history of chat dates back to ancient times when people first discovered hey. Over centuries, the understanding of cool evolved significantly. Modern research has shown that yeah plays a crucial role in chat. Experts agree that without lol, the field would not have progressed as far. In a remote village, the tradition of chat has been passed down for generations. The elders speak of lol with reverence, while btw remains a mystery. Young apprentices learn the secrets of cool through careful observation. The ritual of yeah is performed during the harvest moon. The history of chat dates back to ancient times when people first discovered cool. Over centuries, the understanding of btw evolved significantly. Modern research has shown that hey plays a crucial role in chat. Experts agree that without lol, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered yeah. Over centuries, the understanding of lol evolved significantly. Modern research has shown that btw plays a crucial role in chat. Experts agree that without hey, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered hey. Over centuries, the understanding of lol evolved significantly. Modern research has shown that btw plays a crucial role in chat. Experts agree that without cool, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered lol. Over centuries, the understanding of hey evolved significantly. Modern research has shown that yeah plays a crucial role in chat. Experts agree that without btw, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535547",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "chat"
      ],
      "content_hash": "90313b9d35aab847",
      "size_bytes": 1720,
      "created_at": "2026-01-02T20:42:23.535548"
    },
    {
      "doc_id": "distractor_0068",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0068",
      "content": "In a remote village, the tradition of tutorial has been passed down for generations. The elders speak of step with reverence, while guide remains a mystery. Young apprentices learn the secrets of how-to through careful observation. The ritual of learn is performed during the harvest moon. The history of tutorial dates back to ancient times when people first discovered step. Over centuries, the understanding of guide evolved significantly. Modern research has shown that beginner plays a crucial role in tutorial. Experts agree that without how-to, the field would not have progressed as far. The history of tutorial dates back to ancient times when people first discovered step. Over centuries, the understanding of how-to evolved significantly. Modern research has shown that learn plays a crucial role in tutorial. Experts agree that without guide, the field would not have progressed as far. The history of tutorial dates back to ancient times when people first discovered step. Over centuries, the understanding of beginner evolved significantly. Modern research has shown that guide plays a crucial role in tutorial. Experts agree that without learn, the field would not have progressed as far. In a remote village, the tradition of tutorial has been passed down for generations. The elders speak of guide with reverence, while how-to remains a mystery. Young apprentices learn the secrets of step through careful observation. The ritual of learn is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535556",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "tutorial",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "tutorial"
      ],
      "content_hash": "d2cc600ee4276ac3",
      "size_bytes": 1493,
      "created_at": "2026-01-02T20:42:23.535556"
    },
    {
      "doc_id": "distractor_0069",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0069",
      "content": "The history of employment dates back to ancient times when people first discovered employee. Over centuries, the understanding of termination evolved significantly. Modern research has shown that compensation plays a crucial role in employment. Experts agree that without benefits, the field would not have progressed as far. In a remote village, the tradition of employment has been passed down for generations. The elders speak of termination with reverence, while benefits remains a mystery. Young apprentices learn the secrets of compensation through careful observation. The ritual of employee is performed during the harvest moon. In a remote village, the tradition of employment has been passed down for generations. The elders speak of compensation with reverence, while termination remains a mystery. Young apprentices learn the secrets of benefits through careful observation. The ritual of employee is performed during the harvest moon. In a remote village, the tradition of employment has been passed down for generations. The elders speak of compensation with reverence, while employee remains a mystery. Young apprentices learn the secrets of benefits through careful observation. The ritual of termination is performed during the harvest moon. The history of employment dates back to ancient times when people first discovered compensation. Over centuries, the understanding of employee evolved significantly. Modern research has shown that termination plays a crucial role in employment. Experts agree that without benefits, the field would not have progressed as far. In a remote village, the tradition of employment has been passed down for generations. The elders speak of benefits with reverence, while compensation remains a mystery. Young apprentices learn the secrets of termination through careful observation. The ritual of employee is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535565",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "employment",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "employment"
      ],
      "content_hash": "e9b319d7838506a5",
      "size_bytes": 1895,
      "created_at": "2026-01-02T20:42:23.535566"
    },
    {
      "doc_id": "distractor_0070",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0070",
      "content": "The history of privacy dates back to ancient times when people first discovered data. Over centuries, the understanding of consent evolved significantly. Modern research has shown that disclosure plays a crucial role in privacy. Experts agree that without protection, the field would not have progressed as far. The history of privacy dates back to ancient times when people first discovered protection. Over centuries, the understanding of consent evolved significantly. Modern research has shown that GDPR plays a crucial role in privacy. Experts agree that without disclosure, the field would not have progressed as far. The history of privacy dates back to ancient times when people first discovered protection. Over centuries, the understanding of disclosure evolved significantly. Modern research has shown that GDPR plays a crucial role in privacy. Experts agree that without data, the field would not have progressed as far. The history of privacy dates back to ancient times when people first discovered consent. Over centuries, the understanding of data evolved significantly. Modern research has shown that disclosure plays a crucial role in privacy. Experts agree that without GDPR, the field would not have progressed as far. The history of privacy dates back to ancient times when people first discovered consent. Over centuries, the understanding of protection evolved significantly. Modern research has shown that GDPR plays a crucial role in privacy. Experts agree that without disclosure, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535574",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "privacy",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "privacy"
      ],
      "content_hash": "ef98228d1198bf2f",
      "size_bytes": 1550,
      "created_at": "2026-01-02T20:42:23.535575"
    },
    {
      "doc_id": "distractor_0071",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0071",
      "content": "In a remote village, the tradition of tutorial has been passed down for generations. The elders speak of step with reverence, while guide remains a mystery. Young apprentices learn the secrets of how-to through careful observation. The ritual of learn is performed during the harvest moon. In a remote village, the tradition of tutorial has been passed down for generations. The elders speak of how-to with reverence, while guide remains a mystery. Young apprentices learn the secrets of learn through careful observation. The ritual of beginner is performed during the harvest moon. In a remote village, the tradition of tutorial has been passed down for generations. The elders speak of how-to with reverence, while learn remains a mystery. Young apprentices learn the secrets of guide through careful observation. The ritual of beginner is performed during the harvest moon. The history of tutorial dates back to ancient times when people first discovered learn. Over centuries, the understanding of step evolved significantly. Modern research has shown that beginner plays a crucial role in tutorial. Experts agree that without how-to, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535581",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "tutorial",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "tutorial"
      ],
      "content_hash": "301e91d77bab8de9",
      "size_bytes": 1183,
      "created_at": "2026-01-02T20:42:23.535582"
    },
    {
      "doc_id": "distractor_0072",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0072",
      "content": "In a remote village, the tradition of chat has been passed down for generations. The elders speak of hey with reverence, while cool remains a mystery. Young apprentices learn the secrets of yeah through careful observation. The ritual of lol is performed during the harvest moon. The history of chat dates back to ancient times when people first discovered cool. Over centuries, the understanding of lol evolved significantly. Modern research has shown that hey plays a crucial role in chat. Experts agree that without yeah, the field would not have progressed as far. In a remote village, the tradition of chat has been passed down for generations. The elders speak of btw with reverence, while cool remains a mystery. Young apprentices learn the secrets of yeah through careful observation. The ritual of hey is performed during the harvest moon. In a remote village, the tradition of chat has been passed down for generations. The elders speak of btw with reverence, while lol remains a mystery. Young apprentices learn the secrets of cool through careful observation. The ritual of hey is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535589",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "chat"
      ],
      "content_hash": "0787b082494c4028",
      "size_bytes": 1127,
      "created_at": "2026-01-02T20:42:23.535590"
    },
    {
      "doc_id": "distractor_0073",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0073",
      "content": "The history of chat dates back to ancient times when people first discovered hey. Over centuries, the understanding of cool evolved significantly. Modern research has shown that yeah plays a crucial role in chat. Experts agree that without lol, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered btw. Over centuries, the understanding of cool evolved significantly. Modern research has shown that lol plays a crucial role in chat. Experts agree that without yeah, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered cool. Over centuries, the understanding of hey evolved significantly. Modern research has shown that yeah plays a crucial role in chat. Experts agree that without btw, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered yeah. Over centuries, the understanding of cool evolved significantly. Modern research has shown that btw plays a crucial role in chat. Experts agree that without lol, the field would not have progressed as far. The history of chat dates back to ancient times when people first discovered yeah. Over centuries, the understanding of lol evolved significantly. Modern research has shown that btw plays a crucial role in chat. Experts agree that without cool, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535598",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "chat"
      ],
      "content_hash": "21d08ee24604814b",
      "size_bytes": 1444,
      "created_at": "2026-01-02T20:42:23.535598"
    },
    {
      "doc_id": "distractor_0074",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0074",
      "content": "In a remote village, the tradition of interview has been passed down for generations. The elders speak of experience with reverence, while skills remains a mystery. Young apprentices learn the secrets of team through careful observation. The ritual of project is performed during the harvest moon. In a remote village, the tradition of interview has been passed down for generations. The elders speak of role with reverence, while team remains a mystery. Young apprentices learn the secrets of project through careful observation. The ritual of skills is performed during the harvest moon. The history of interview dates back to ancient times when people first discovered project. Over centuries, the understanding of skills evolved significantly. Modern research has shown that experience plays a crucial role in interview. Experts agree that without role, the field would not have progressed as far. In a remote village, the tradition of interview has been passed down for generations. The elders speak of experience with reverence, while team remains a mystery. Young apprentices learn the secrets of skills through careful observation. The ritual of role is performed during the harvest moon. The history of interview dates back to ancient times when people first discovered experience. Over centuries, the understanding of team evolved significantly. Modern research has shown that skills plays a crucial role in interview. Experts agree that without role, the field would not have progressed as far. The history of interview dates back to ancient times when people first discovered team. Over centuries, the understanding of role evolved significantly. Modern research has shown that skills plays a crucial role in interview. Experts agree that without experience, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535607",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "interview"
      ],
      "content_hash": "e122ee52dab08475",
      "size_bytes": 1814,
      "created_at": "2026-01-02T20:42:23.535609"
    },
    {
      "doc_id": "distractor_0075",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0075",
      "content": "The history of email dates back to ancient times when people first discovered regards. Over centuries, the understanding of attached evolved significantly. Modern research has shown that meeting plays a crucial role in email. Experts agree that without follow-up, the field would not have progressed as far. In a remote village, the tradition of email has been passed down for generations. The elders speak of regards with reverence, while follow-up remains a mystery. Young apprentices learn the secrets of attached through careful observation. The ritual of FYI is performed during the harvest moon. The history of email dates back to ancient times when people first discovered FYI. Over centuries, the understanding of regards evolved significantly. Modern research has shown that attached plays a crucial role in email. Experts agree that without meeting, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535614",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "email",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "email"
      ],
      "content_hash": "64dbe3ad5f07d8c8",
      "size_bytes": 903,
      "created_at": "2026-01-02T20:42:23.535615"
    },
    {
      "doc_id": "distractor_0076",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0076",
      "content": "In a remote village, the tradition of interview has been passed down for generations. The elders speak of experience with reverence, while skills remains a mystery. Young apprentices learn the secrets of team through careful observation. The ritual of project is performed during the harvest moon. The history of interview dates back to ancient times when people first discovered team. Over centuries, the understanding of role evolved significantly. Modern research has shown that skills plays a crucial role in interview. Experts agree that without project, the field would not have progressed as far. The history of interview dates back to ancient times when people first discovered role. Over centuries, the understanding of team evolved significantly. Modern research has shown that experience plays a crucial role in interview. Experts agree that without project, the field would not have progressed as far. The history of interview dates back to ancient times when people first discovered experience. Over centuries, the understanding of project evolved significantly. Modern research has shown that role plays a crucial role in interview. Experts agree that without team, the field would not have progressed as far. The history of interview dates back to ancient times when people first discovered experience. Over centuries, the understanding of project evolved significantly. Modern research has shown that team plays a crucial role in interview. Experts agree that without skills, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535622",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "interview"
      ],
      "content_hash": "a16b2e81c6523126",
      "size_bytes": 1535,
      "created_at": "2026-01-02T20:42:23.535623"
    },
    {
      "doc_id": "distractor_0077",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0077",
      "content": "In a remote village, the tradition of email has been passed down for generations. The elders speak of regards with reverence, while attached remains a mystery. Young apprentices learn the secrets of meeting through careful observation. The ritual of follow-up is performed during the harvest moon. The history of email dates back to ancient times when people first discovered regards. Over centuries, the understanding of follow-up evolved significantly. Modern research has shown that attached plays a crucial role in email. Experts agree that without meeting, the field would not have progressed as far. In a remote village, the tradition of email has been passed down for generations. The elders speak of FYI with reverence, while meeting remains a mystery. Young apprentices learn the secrets of follow-up through careful observation. The ritual of regards is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535628",
        "similarity_level": "very_different",
        "base_category": "conversational",
        "topic": "email",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "email"
      ],
      "content_hash": "bad349311e5467e3",
      "size_bytes": 898,
      "created_at": "2026-01-02T20:42:23.535629"
    },
    {
      "doc_id": "distractor_0078",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0078",
      "content": "In a remote village, the tradition of howto has been passed down for generations. The elders speak of configure with reverence, while setup remains a mystery. Young apprentices learn the secrets of install through careful observation. The ritual of enable is performed during the harvest moon. In a remote village, the tradition of howto has been passed down for generations. The elders speak of disable with reverence, while setup remains a mystery. Young apprentices learn the secrets of configure through careful observation. The ritual of enable is performed during the harvest moon. In a remote village, the tradition of howto has been passed down for generations. The elders speak of disable with reverence, while install remains a mystery. Young apprentices learn the secrets of enable through careful observation. The ritual of configure is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535634",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "howto",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "howto"
      ],
      "content_hash": "4e2a23dc07ed3bb9",
      "size_bytes": 883,
      "created_at": "2026-01-02T20:42:23.535635"
    },
    {
      "doc_id": "distractor_0079",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0079",
      "content": "In a remote village, the tradition of faq has been passed down for generations. The elders speak of question with reverence, while answer remains a mystery. Young apprentices learn the secrets of common through careful observation. The ritual of frequently is performed during the harvest moon. In a remote village, the tradition of faq has been passed down for generations. The elders speak of frequently with reverence, while answer remains a mystery. Young apprentices learn the secrets of asked through careful observation. The ritual of question is performed during the harvest moon. In a remote village, the tradition of faq has been passed down for generations. The elders speak of common with reverence, while question remains a mystery. Young apprentices learn the secrets of frequently through careful observation. The ritual of asked is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535652",
        "similarity_level": "very_different",
        "base_category": "knowledge_base",
        "topic": "faq",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "faq"
      ],
      "content_hash": "ca48e2d0aa0bc7ce",
      "size_bytes": 882,
      "created_at": "2026-01-02T20:42:23.535652"
    },
    {
      "doc_id": "distractor_0080",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0080",
      "content": "The history of networking dates back to ancient times when people first discovered TCP. Over centuries, the understanding of HTTP evolved significantly. Modern research has shown that socket plays a crucial role in networking. Experts agree that without packet, the field would not have progressed as far. In a remote village, the tradition of networking has been passed down for generations. The elders speak of packet with reverence, while latency remains a mystery. Young apprentices learn the secrets of HTTP through careful observation. The ritual of protocol is performed during the harvest moon. The history of networking dates back to ancient times when people first discovered latency. Over centuries, the understanding of HTTP evolved significantly. Modern research has shown that protocol plays a crucial role in networking. Experts agree that without packet, the field would not have progressed as far. In a remote village, the tradition of networking has been passed down for generations. The elders speak of socket with reverence, while HTTP remains a mystery. Young apprentices learn the secrets of latency through careful observation. The ritual of TCP is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535659",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "networking"
      ],
      "content_hash": "c09ef073bf540473",
      "size_bytes": 1206,
      "created_at": "2026-01-02T20:42:23.535660"
    },
    {
      "doc_id": "distractor_0081",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0081",
      "content": "In a remote village, the tradition of cloud has been passed down for generations. The elders speak of container with reverence, while kubernetes remains a mystery. Young apprentices learn the secrets of deployment through careful observation. The ritual of scaling is performed during the harvest moon. The history of cloud dates back to ancient times when people first discovered deployment. Over centuries, the understanding of scaling evolved significantly. Modern research has shown that container plays a crucial role in cloud. Experts agree that without kubernetes, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered deployment. Over centuries, the understanding of instance evolved significantly. Modern research has shown that scaling plays a crucial role in cloud. Experts agree that without kubernetes, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered container. Over centuries, the understanding of instance evolved significantly. Modern research has shown that scaling plays a crucial role in cloud. Experts agree that without kubernetes, the field would not have progressed as far. The history of cloud dates back to ancient times when people first discovered container. Over centuries, the understanding of scaling evolved significantly. Modern research has shown that instance plays a crucial role in cloud. Experts agree that without kubernetes, the field would not have progressed as far.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535668",
        "similarity_level": "very_different",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "cloud"
      ],
      "content_hash": "73bc7776f8013426",
      "size_bytes": 1549,
      "created_at": "2026-01-02T20:42:23.535669"
    },
    {
      "doc_id": "distractor_0082",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0082",
      "content": "The history of employment dates back to ancient times when people first discovered employee. Over centuries, the understanding of termination evolved significantly. Modern research has shown that compensation plays a crucial role in employment. Experts agree that without benefits, the field would not have progressed as far. The history of employment dates back to ancient times when people first discovered employee. Over centuries, the understanding of benefits evolved significantly. Modern research has shown that compensation plays a crucial role in employment. Experts agree that without termination, the field would not have progressed as far. The history of employment dates back to ancient times when people first discovered termination. Over centuries, the understanding of compensation evolved significantly. Modern research has shown that benefits plays a crucial role in employment. Experts agree that without employee, the field would not have progressed as far. In a remote village, the tradition of employment has been passed down for generations. The elders speak of employee with reverence, while benefits remains a mystery. Young apprentices learn the secrets of compensation through careful observation. The ritual of termination is performed during the harvest moon.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535675",
        "similarity_level": "very_different",
        "base_category": "legal",
        "topic": "employment",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_different",
        "employment"
      ],
      "content_hash": "1ca155dd938b2bb4",
      "size_bytes": 1288,
      "created_at": "2026-01-02T20:42:23.535676"
    },
    {
      "doc_id": "distractor_0083",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0083",
      "content": "This guide covers the fundamentals of cloud for intermediate users. We'll explore how container interacts with kubernetes. Pay special attention to deployment as it's frequently a source of errors. Advanced techniques involving scaling will be covered in the next section. This guide covers the fundamentals of cloud for intermediate users. We'll explore how container interacts with deployment. Pay special attention to instance as it's frequently a source of errors. Advanced techniques involving scaling will be covered in the next section. When working with cloud, it's important to understand instance. Many practitioners overlook deployment, which can lead to issues. Best practices suggest that scaling should be prioritized. The relationship between instance and kubernetes is often misunderstood. This guide covers the fundamentals of cloud for intermediate users. We'll explore how deployment interacts with container. Pay special attention to instance as it's frequently a source of errors. Advanced techniques involving kubernetes will be covered in the next section. This guide covers the fundamentals of cloud for intermediate users. We'll explore how scaling interacts with container. Pay special attention to kubernetes as it's frequently a source of errors. Advanced techniques involving instance will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535686",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "cloud"
      ],
      "content_hash": "c062ce63f5cf7786",
      "size_bytes": 1350,
      "created_at": "2026-01-02T20:42:23.535687"
    },
    {
      "doc_id": "distractor_0084",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0084",
      "content": "When working with interview, it's important to understand experience. Many practitioners overlook skills, which can lead to issues. Best practices suggest that team should be prioritized. The relationship between experience and project is often misunderstood. When working with interview, it's important to understand role. Many practitioners overlook team, which can lead to issues. Best practices suggest that skills should be prioritized. The relationship between role and experience is often misunderstood. When working with interview, it's important to understand team. Many practitioners overlook role, which can lead to issues. Best practices suggest that project should be prioritized. The relationship between team and experience is often misunderstood. This guide covers the fundamentals of interview for intermediate users. We'll explore how skills interacts with team. Pay special attention to experience as it's frequently a source of errors. Advanced techniques involving project will be covered in the next section. This guide covers the fundamentals of interview for intermediate users. We'll explore how skills interacts with project. Pay special attention to experience as it's frequently a source of errors. Advanced techniques involving team will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535695",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "interview"
      ],
      "content_hash": "3cbe8f384dc8a916",
      "size_bytes": 1298,
      "created_at": "2026-01-02T20:42:23.535696"
    },
    {
      "doc_id": "distractor_0085",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0085",
      "content": "This guide covers the fundamentals of howto for intermediate users. We'll explore how configure interacts with setup. Pay special attention to install as it's frequently a source of errors. Advanced techniques involving enable will be covered in the next section. This guide covers the fundamentals of howto for intermediate users. We'll explore how install interacts with setup. Pay special attention to disable as it's frequently a source of errors. Advanced techniques involving configure will be covered in the next section. This guide covers the fundamentals of howto for intermediate users. We'll explore how configure interacts with enable. Pay special attention to install as it's frequently a source of errors. Advanced techniques involving disable will be covered in the next section. When working with howto, it's important to understand disable. Many practitioners overlook enable, which can lead to issues. Best practices suggest that setup should be prioritized. The relationship between disable and install is often misunderstood. This guide covers the fundamentals of howto for intermediate users. We'll explore how install interacts with setup. Pay special attention to enable as it's frequently a source of errors. Advanced techniques involving configure will be covered in the next section. When working with howto, it's important to understand configure. Many practitioners overlook enable, which can lead to issues. Best practices suggest that setup should be prioritized. The relationship between configure and disable is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535705",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "howto",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "howto"
      ],
      "content_hash": "4c78f1a4465d6368",
      "size_bytes": 1564,
      "created_at": "2026-01-02T20:42:23.535706"
    },
    {
      "doc_id": "distractor_0086",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0086",
      "content": "When working with cloud, it's important to understand container. Many practitioners overlook kubernetes, which can lead to issues. Best practices suggest that deployment should be prioritized. The relationship between container and scaling is often misunderstood. This guide covers the fundamentals of cloud for intermediate users. We'll explore how scaling interacts with kubernetes. Pay special attention to container as it's frequently a source of errors. Advanced techniques involving deployment will be covered in the next section. This guide covers the fundamentals of cloud for intermediate users. We'll explore how kubernetes interacts with container. Pay special attention to scaling as it's frequently a source of errors. Advanced techniques involving deployment will be covered in the next section. When working with cloud, it's important to understand instance. Many practitioners overlook deployment, which can lead to issues. Best practices suggest that kubernetes should be prioritized. The relationship between instance and scaling is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535712",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "cloud"
      ],
      "content_hash": "164a63adddc29a34",
      "size_bytes": 1071,
      "created_at": "2026-01-02T20:42:23.535713"
    },
    {
      "doc_id": "distractor_0087",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0087",
      "content": "When working with chat, it's important to understand hey. Many practitioners overlook cool, which can lead to issues. Best practices suggest that yeah should be prioritized. The relationship between hey and lol is often misunderstood. When working with chat, it's important to understand yeah. Many practitioners overlook cool, which can lead to issues. Best practices suggest that lol should be prioritized. The relationship between yeah and btw is often misunderstood. This guide covers the fundamentals of chat for intermediate users. We'll explore how cool interacts with yeah. Pay special attention to hey as it's frequently a source of errors. Advanced techniques involving lol will be covered in the next section. This guide covers the fundamentals of chat for intermediate users. We'll explore how lol interacts with cool. Pay special attention to hey as it's frequently a source of errors. Advanced techniques involving yeah will be covered in the next section. This guide covers the fundamentals of chat for intermediate users. We'll explore how hey interacts with cool. Pay special attention to lol as it's frequently a source of errors. Advanced techniques involving yeah will be covered in the next section. This guide covers the fundamentals of chat for intermediate users. We'll explore how btw interacts with yeah. Pay special attention to cool as it's frequently a source of errors. Advanced techniques involving hey will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535723",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "chat"
      ],
      "content_hash": "aca648bb670d3437",
      "size_bytes": 1470,
      "created_at": "2026-01-02T20:42:23.535724"
    },
    {
      "doc_id": "distractor_0088",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0088",
      "content": "This guide covers the fundamentals of cloud for intermediate users. We'll explore how container interacts with kubernetes. Pay special attention to deployment as it's frequently a source of errors. Advanced techniques involving scaling will be covered in the next section. This guide covers the fundamentals of cloud for intermediate users. We'll explore how scaling interacts with container. Pay special attention to instance as it's frequently a source of errors. Advanced techniques involving kubernetes will be covered in the next section. This guide covers the fundamentals of cloud for intermediate users. We'll explore how instance interacts with deployment. Pay special attention to container as it's frequently a source of errors. Advanced techniques involving scaling will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535729",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "cloud"
      ],
      "content_hash": "a2bdc0875bc9c741",
      "size_bytes": 814,
      "created_at": "2026-01-02T20:42:23.535730"
    },
    {
      "doc_id": "distractor_0089",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0089",
      "content": "When working with compiler, it's important to understand parser. Many practitioners overlook lexer, which can lead to issues. Best practices suggest that AST should be prioritized. The relationship between parser and optimization is often misunderstood. When working with compiler, it's important to understand bytecode. Many practitioners overlook parser, which can lead to issues. Best practices suggest that lexer should be prioritized. The relationship between bytecode and AST is often misunderstood. This guide covers the fundamentals of compiler for intermediate users. We'll explore how parser interacts with bytecode. Pay special attention to AST as it's frequently a source of errors. Advanced techniques involving optimization will be covered in the next section. When working with compiler, it's important to understand parser. Many practitioners overlook optimization, which can lead to issues. Best practices suggest that AST should be prioritized. The relationship between parser and bytecode is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535737",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "compiler",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "compiler"
      ],
      "content_hash": "040ca6b884e05b00",
      "size_bytes": 1031,
      "created_at": "2026-01-02T20:42:23.535737"
    },
    {
      "doc_id": "distractor_0090",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0090",
      "content": "This guide covers the fundamentals of howto for intermediate users. We'll explore how configure interacts with setup. Pay special attention to install as it's frequently a source of errors. Advanced techniques involving enable will be covered in the next section. When working with howto, it's important to understand configure. Many practitioners overlook setup, which can lead to issues. Best practices suggest that disable should be prioritized. The relationship between configure and install is often misunderstood. This guide covers the fundamentals of howto for intermediate users. We'll explore how setup interacts with install. Pay special attention to configure as it's frequently a source of errors. Advanced techniques involving enable will be covered in the next section. This guide covers the fundamentals of howto for intermediate users. We'll explore how enable interacts with setup. Pay special attention to configure as it's frequently a source of errors. Advanced techniques involving install will be covered in the next section. This guide covers the fundamentals of howto for intermediate users. We'll explore how configure interacts with install. Pay special attention to disable as it's frequently a source of errors. Advanced techniques involving enable will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535745",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "howto",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "howto"
      ],
      "content_hash": "20ce21a5dcff0e50",
      "size_bytes": 1313,
      "created_at": "2026-01-02T20:42:23.535746"
    },
    {
      "doc_id": "distractor_0091",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0091",
      "content": "This guide covers the fundamentals of interview for intermediate users. We'll explore how experience interacts with skills. Pay special attention to team as it's frequently a source of errors. Advanced techniques involving project will be covered in the next section. When working with interview, it's important to understand experience. Many practitioners overlook team, which can lead to issues. Best practices suggest that skills should be prioritized. The relationship between experience and project is often misunderstood. When working with interview, it's important to understand role. Many practitioners overlook project, which can lead to issues. Best practices suggest that skills should be prioritized. The relationship between role and experience is often misunderstood. This guide covers the fundamentals of interview for intermediate users. We'll explore how experience interacts with skills. Pay special attention to role as it's frequently a source of errors. Advanced techniques involving team will be covered in the next section. When working with interview, it's important to understand experience. Many practitioners overlook role, which can lead to issues. Best practices suggest that project should be prioritized. The relationship between experience and team is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535754",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "interview"
      ],
      "content_hash": "6371fef8dbc890d0",
      "size_bytes": 1304,
      "created_at": "2026-01-02T20:42:23.535755"
    },
    {
      "doc_id": "distractor_0092",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0092",
      "content": "When working with contract, it's important to understand party. Many practitioners overlook agreement, which can lead to issues. Best practices suggest that terms should be prioritized. The relationship between party and obligation is often misunderstood. When working with contract, it's important to understand obligation. Many practitioners overlook party, which can lead to issues. Best practices suggest that terms should be prioritized. The relationship between obligation and agreement is often misunderstood. When working with contract, it's important to understand liability. Many practitioners overlook terms, which can lead to issues. Best practices suggest that agreement should be prioritized. The relationship between liability and obligation is often misunderstood. When working with contract, it's important to understand liability. Many practitioners overlook obligation, which can lead to issues. Best practices suggest that terms should be prioritized. The relationship between liability and party is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535763",
        "similarity_level": "somewhat_similar",
        "base_category": "legal",
        "topic": "contract",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "contract"
      ],
      "content_hash": "ec8b8cab60d7594c",
      "size_bytes": 1040,
      "created_at": "2026-01-02T20:42:23.535764"
    },
    {
      "doc_id": "distractor_0093",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0093",
      "content": "This guide covers the fundamentals of reference for intermediate users. We'll explore how documentation interacts with API. Pay special attention to parameter as it's frequently a source of errors. Advanced techniques involving method will be covered in the next section. This guide covers the fundamentals of reference for intermediate users. We'll explore how API interacts with documentation. Pay special attention to method as it's frequently a source of errors. Advanced techniques involving example will be covered in the next section. When working with reference, it's important to understand method. Many practitioners overlook documentation, which can lead to issues. Best practices suggest that parameter should be prioritized. The relationship between method and API is often misunderstood. When working with reference, it's important to understand parameter. Many practitioners overlook example, which can lead to issues. Best practices suggest that documentation should be prioritized. The relationship between parameter and API is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535772",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "reference"
      ],
      "content_hash": "46764fcc75b56ec9",
      "size_bytes": 1065,
      "created_at": "2026-01-02T20:42:23.535772"
    },
    {
      "doc_id": "distractor_0094",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0094",
      "content": "This guide covers the fundamentals of faq for intermediate users. We'll explore how question interacts with answer. Pay special attention to common as it's frequently a source of errors. Advanced techniques involving frequently will be covered in the next section. When working with faq, it's important to understand frequently. Many practitioners overlook asked, which can lead to issues. Best practices suggest that answer should be prioritized. The relationship between frequently and question is often misunderstood. This guide covers the fundamentals of faq for intermediate users. We'll explore how common interacts with answer. Pay special attention to question as it's frequently a source of errors. Advanced techniques involving frequently will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535778",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "faq",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "faq"
      ],
      "content_hash": "4c79b72dc21e7444",
      "size_bytes": 785,
      "created_at": "2026-01-02T20:42:23.535779"
    },
    {
      "doc_id": "distractor_0095",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0095",
      "content": "When working with chat, it's important to understand hey. Many practitioners overlook cool, which can lead to issues. Best practices suggest that yeah should be prioritized. The relationship between hey and lol is often misunderstood. When working with chat, it's important to understand cool. Many practitioners overlook hey, which can lead to issues. Best practices suggest that btw should be prioritized. The relationship between cool and yeah is often misunderstood. When working with chat, it's important to understand cool. Many practitioners overlook hey, which can lead to issues. Best practices suggest that lol should be prioritized. The relationship between cool and btw is often misunderstood. When working with chat, it's important to understand hey. Many practitioners overlook yeah, which can lead to issues. Best practices suggest that cool should be prioritized. The relationship between hey and lol is often misunderstood. When working with chat, it's important to understand cool. Many practitioners overlook yeah, which can lead to issues. Best practices suggest that btw should be prioritized. The relationship between cool and hey is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535787",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "chat"
      ],
      "content_hash": "a72a7eeead768788",
      "size_bytes": 1176,
      "created_at": "2026-01-02T20:42:23.535788"
    },
    {
      "doc_id": "distractor_0096",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0096",
      "content": "When working with troubleshooting, it's important to understand error. Many practitioners overlook fix, which can lead to issues. Best practices suggest that solution should be prioritized. The relationship between error and problem is often misunderstood. This guide covers the fundamentals of troubleshooting for intermediate users. We'll explore how error interacts with solution. Pay special attention to workaround as it's frequently a source of errors. Advanced techniques involving fix will be covered in the next section. This guide covers the fundamentals of troubleshooting for intermediate users. We'll explore how problem interacts with workaround. Pay special attention to fix as it's frequently a source of errors. Advanced techniques involving error will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535794",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "troubleshooting"
      ],
      "content_hash": "d3dc8ba32a4c415f",
      "size_bytes": 801,
      "created_at": "2026-01-02T20:42:23.535795"
    },
    {
      "doc_id": "distractor_0097",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0097",
      "content": "When working with contract, it's important to understand party. Many practitioners overlook agreement, which can lead to issues. Best practices suggest that terms should be prioritized. The relationship between party and obligation is often misunderstood. This guide covers the fundamentals of contract for intermediate users. We'll explore how party interacts with liability. Pay special attention to terms as it's frequently a source of errors. Advanced techniques involving obligation will be covered in the next section. When working with contract, it's important to understand agreement. Many practitioners overlook party, which can lead to issues. Best practices suggest that obligation should be prioritized. The relationship between agreement and liability is often misunderstood. When working with contract, it's important to understand terms. Many practitioners overlook liability, which can lead to issues. Best practices suggest that party should be prioritized. The relationship between terms and obligation is often misunderstood. This guide covers the fundamentals of contract for intermediate users. We'll explore how agreement interacts with party. Pay special attention to terms as it's frequently a source of errors. Advanced techniques involving liability will be covered in the next section. When working with contract, it's important to understand obligation. Many practitioners overlook agreement, which can lead to issues. Best practices suggest that terms should be prioritized. The relationship between obligation and party is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535804",
        "similarity_level": "somewhat_similar",
        "base_category": "legal",
        "topic": "contract",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "contract"
      ],
      "content_hash": "255cb62adc615144",
      "size_bytes": 1573,
      "created_at": "2026-01-02T20:42:23.535804"
    },
    {
      "doc_id": "distractor_0098",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0098",
      "content": "When working with support, it's important to understand help. Many practitioners overlook issue, which can lead to issues. Best practices suggest that ticket should be prioritized. The relationship between help and resolved is often misunderstood. When working with support, it's important to understand ticket. Many practitioners overlook resolved, which can lead to issues. Best practices suggest that help should be prioritized. The relationship between ticket and issue is often misunderstood. This guide covers the fundamentals of support for intermediate users. We'll explore how thanks interacts with resolved. Pay special attention to ticket as it's frequently a source of errors. Advanced techniques involving issue will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535810",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "support",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "support"
      ],
      "content_hash": "d1bee70b627a2c30",
      "size_bytes": 761,
      "created_at": "2026-01-02T20:42:23.535811"
    },
    {
      "doc_id": "distractor_0099",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0099",
      "content": "This guide covers the fundamentals of compiler for intermediate users. We'll explore how parser interacts with lexer. Pay special attention to AST as it's frequently a source of errors. Advanced techniques involving optimization will be covered in the next section. This guide covers the fundamentals of compiler for intermediate users. We'll explore how AST interacts with parser. Pay special attention to bytecode as it's frequently a source of errors. Advanced techniques involving optimization will be covered in the next section. This guide covers the fundamentals of compiler for intermediate users. We'll explore how optimization interacts with bytecode. Pay special attention to lexer as it's frequently a source of errors. Advanced techniques involving parser will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535816",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "compiler",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "compiler"
      ],
      "content_hash": "479e619a4fdd4263",
      "size_bytes": 805,
      "created_at": "2026-01-02T20:42:23.535817"
    },
    {
      "doc_id": "distractor_0100",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0100",
      "content": "When working with networking, it's important to understand TCP. Many practitioners overlook HTTP, which can lead to issues. Best practices suggest that socket should be prioritized. The relationship between TCP and packet is often misunderstood. This guide covers the fundamentals of networking for intermediate users. We'll explore how latency interacts with HTTP. Pay special attention to packet as it's frequently a source of errors. Advanced techniques involving protocol will be covered in the next section. When working with networking, it's important to understand latency. Many practitioners overlook protocol, which can lead to issues. Best practices suggest that TCP should be prioritized. The relationship between latency and HTTP is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535823",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "networking"
      ],
      "content_hash": "17c89b21ce521f67",
      "size_bytes": 765,
      "created_at": "2026-01-02T20:42:23.535823"
    },
    {
      "doc_id": "distractor_0101",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0101",
      "content": "This guide covers the fundamentals of forum for intermediate users. We'll explore how thread interacts with reply. Pay special attention to bump as it's frequently a source of errors. Advanced techniques involving solved will be covered in the next section. This guide covers the fundamentals of forum for intermediate users. We'll explore how off-topic interacts with solved. Pay special attention to bump as it's frequently a source of errors. Advanced techniques involving reply will be covered in the next section. When working with forum, it's important to understand off-topic. Many practitioners overlook thread, which can lead to issues. Best practices suggest that bump should be prioritized. The relationship between off-topic and solved is often misunderstood. When working with forum, it's important to understand solved. Many practitioners overlook bump, which can lead to issues. Best practices suggest that reply should be prioritized. The relationship between solved and off-topic is often misunderstood. This guide covers the fundamentals of forum for intermediate users. We'll explore how reply interacts with bump. Pay special attention to thread as it's frequently a source of errors. Advanced techniques involving solved will be covered in the next section. This guide covers the fundamentals of forum for intermediate users. We'll explore how off-topic interacts with thread. Pay special attention to solved as it's frequently a source of errors. Advanced techniques involving reply will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535832",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "forum",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "forum"
      ],
      "content_hash": "320c012612f5115a",
      "size_bytes": 1541,
      "created_at": "2026-01-02T20:42:23.535833"
    },
    {
      "doc_id": "distractor_0102",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0102",
      "content": "This guide covers the fundamentals of database for intermediate users. We'll explore how SELECT interacts with JOIN. Pay special attention to index as it's frequently a source of errors. Advanced techniques involving query will be covered in the next section. When working with database, it's important to understand schema. Many practitioners overlook query, which can lead to issues. Best practices suggest that index should be prioritized. The relationship between schema and table is often misunderstood. This guide covers the fundamentals of database for intermediate users. We'll explore how query interacts with schema. Pay special attention to index as it's frequently a source of errors. Advanced techniques involving JOIN will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535838",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "database",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "database"
      ],
      "content_hash": "8675ddab7742f6ba",
      "size_bytes": 768,
      "created_at": "2026-01-02T20:42:23.535839"
    },
    {
      "doc_id": "distractor_0103",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0103",
      "content": "When working with reference, it's important to understand documentation. Many practitioners overlook API, which can lead to issues. Best practices suggest that parameter should be prioritized. The relationship between documentation and method is often misunderstood. When working with reference, it's important to understand method. Many practitioners overlook example, which can lead to issues. Best practices suggest that documentation should be prioritized. The relationship between method and parameter is often misunderstood. This guide covers the fundamentals of reference for intermediate users. We'll explore how example interacts with method. Pay special attention to documentation as it's frequently a source of errors. Advanced techniques involving parameter will be covered in the next section. This guide covers the fundamentals of reference for intermediate users. We'll explore how API interacts with method. Pay special attention to documentation as it's frequently a source of errors. Advanced techniques involving example will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535846",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "reference"
      ],
      "content_hash": "f87c24141af681fa",
      "size_bytes": 1076,
      "created_at": "2026-01-02T20:42:23.535846"
    },
    {
      "doc_id": "distractor_0104",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0104",
      "content": "This guide covers the fundamentals of howto for intermediate users. We'll explore how configure interacts with setup. Pay special attention to install as it's frequently a source of errors. Advanced techniques involving enable will be covered in the next section. This guide covers the fundamentals of howto for intermediate users. We'll explore how configure interacts with setup. Pay special attention to disable as it's frequently a source of errors. Advanced techniques involving install will be covered in the next section. This guide covers the fundamentals of howto for intermediate users. We'll explore how enable interacts with configure. Pay special attention to disable as it's frequently a source of errors. Advanced techniques involving install will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535852",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "howto",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "howto"
      ],
      "content_hash": "178db38dbee03b4e",
      "size_bytes": 794,
      "created_at": "2026-01-02T20:42:23.535852"
    },
    {
      "doc_id": "distractor_0105",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0105",
      "content": "When working with faq, it's important to understand question. Many practitioners overlook answer, which can lead to issues. Best practices suggest that common should be prioritized. The relationship between question and frequently is often misunderstood. When working with faq, it's important to understand asked. Many practitioners overlook answer, which can lead to issues. Best practices suggest that common should be prioritized. The relationship between asked and question is often misunderstood. This guide covers the fundamentals of faq for intermediate users. We'll explore how common interacts with question. Pay special attention to frequently as it's frequently a source of errors. Advanced techniques involving answer will be covered in the next section. This guide covers the fundamentals of faq for intermediate users. We'll explore how asked interacts with question. Pay special attention to frequently as it's frequently a source of errors. Advanced techniques involving common will be covered in the next section. This guide covers the fundamentals of faq for intermediate users. We'll explore how answer interacts with frequently. Pay special attention to asked as it's frequently a source of errors. Advanced techniques involving question will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535860",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "faq",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "faq"
      ],
      "content_hash": "e74cd83e8c0b240b",
      "size_bytes": 1294,
      "created_at": "2026-01-02T20:42:23.535861"
    },
    {
      "doc_id": "distractor_0106",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0106",
      "content": "This guide covers the fundamentals of security for intermediate users. We'll explore how encryption interacts with authentication. Pay special attention to certificate as it's frequently a source of errors. Advanced techniques involving firewall will be covered in the next section. When working with security, it's important to understand certificate. Many practitioners overlook encryption, which can lead to issues. Best practices suggest that firewall should be prioritized. The relationship between certificate and vulnerability is often misunderstood. This guide covers the fundamentals of security for intermediate users. We'll explore how authentication interacts with vulnerability. Pay special attention to firewall as it's frequently a source of errors. Advanced techniques involving encryption will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535866",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "security",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "security"
      ],
      "content_hash": "bfd58e90dc03f39a",
      "size_bytes": 842,
      "created_at": "2026-01-02T20:42:23.535867"
    },
    {
      "doc_id": "distractor_0107",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0107",
      "content": "When working with cloud, it's important to understand container. Many practitioners overlook kubernetes, which can lead to issues. Best practices suggest that deployment should be prioritized. The relationship between container and scaling is often misunderstood. This guide covers the fundamentals of cloud for intermediate users. We'll explore how container interacts with scaling. Pay special attention to instance as it's frequently a source of errors. Advanced techniques involving deployment will be covered in the next section. This guide covers the fundamentals of cloud for intermediate users. We'll explore how container interacts with scaling. Pay special attention to kubernetes as it's frequently a source of errors. Advanced techniques involving deployment will be covered in the next section. This guide covers the fundamentals of cloud for intermediate users. We'll explore how deployment interacts with container. Pay special attention to kubernetes as it's frequently a source of errors. Advanced techniques involving scaling will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535873",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "cloud"
      ],
      "content_hash": "48596d2e1c219e29",
      "size_bytes": 1080,
      "created_at": "2026-01-02T20:42:23.535874"
    },
    {
      "doc_id": "distractor_0108",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0108",
      "content": "When working with troubleshooting, it's important to understand error. Many practitioners overlook fix, which can lead to issues. Best practices suggest that solution should be prioritized. The relationship between error and problem is often misunderstood. This guide covers the fundamentals of troubleshooting for intermediate users. We'll explore how fix interacts with workaround. Pay special attention to solution as it's frequently a source of errors. Advanced techniques involving error will be covered in the next section. When working with troubleshooting, it's important to understand workaround. Many practitioners overlook fix, which can lead to issues. Best practices suggest that problem should be prioritized. The relationship between workaround and solution is often misunderstood. This guide covers the fundamentals of troubleshooting for intermediate users. We'll explore how solution interacts with error. Pay special attention to problem as it's frequently a source of errors. Advanced techniques involving workaround will be covered in the next section. This guide covers the fundamentals of troubleshooting for intermediate users. We'll explore how error interacts with solution. Pay special attention to problem as it's frequently a source of errors. Advanced techniques involving fix will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535882",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "troubleshooting"
      ],
      "content_hash": "cb50bbcc0cf66d7b",
      "size_bytes": 1343,
      "created_at": "2026-01-02T20:42:23.535882"
    },
    {
      "doc_id": "distractor_0109",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0109",
      "content": "This guide covers the fundamentals of forum for intermediate users. We'll explore how thread interacts with reply. Pay special attention to bump as it's frequently a source of errors. Advanced techniques involving solved will be covered in the next section. When working with forum, it's important to understand off-topic. Many practitioners overlook solved, which can lead to issues. Best practices suggest that thread should be prioritized. The relationship between off-topic and reply is often misunderstood. When working with forum, it's important to understand reply. Many practitioners overlook solved, which can lead to issues. Best practices suggest that bump should be prioritized. The relationship between reply and thread is often misunderstood. When working with forum, it's important to understand bump. Many practitioners overlook solved, which can lead to issues. Best practices suggest that reply should be prioritized. The relationship between bump and off-topic is often misunderstood. When working with forum, it's important to understand solved. Many practitioners overlook bump, which can lead to issues. Best practices suggest that off-topic should be prioritized. The relationship between solved and reply is often misunderstood. This guide covers the fundamentals of forum for intermediate users. We'll explore how solved interacts with reply. Pay special attention to off-topic as it's frequently a source of errors. Advanced techniques involving thread will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535892",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "forum",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "forum"
      ],
      "content_hash": "1f6a704d84736322",
      "size_bytes": 1515,
      "created_at": "2026-01-02T20:42:23.535892"
    },
    {
      "doc_id": "distractor_0110",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0110",
      "content": "When working with tutorial, it's important to understand step. Many practitioners overlook guide, which can lead to issues. Best practices suggest that how-to should be prioritized. The relationship between step and learn is often misunderstood. When working with tutorial, it's important to understand beginner. Many practitioners overlook guide, which can lead to issues. Best practices suggest that learn should be prioritized. The relationship between beginner and how-to is often misunderstood. When working with tutorial, it's important to understand guide. Many practitioners overlook how-to, which can lead to issues. Best practices suggest that step should be prioritized. The relationship between guide and learn is often misunderstood. When working with tutorial, it's important to understand learn. Many practitioners overlook how-to, which can lead to issues. Best practices suggest that step should be prioritized. The relationship between learn and guide is often misunderstood. This guide covers the fundamentals of tutorial for intermediate users. We'll explore how learn interacts with step. Pay special attention to guide as it's frequently a source of errors. Advanced techniques involving beginner will be covered in the next section. This guide covers the fundamentals of tutorial for intermediate users. We'll explore how guide interacts with step. Pay special attention to how-to as it's frequently a source of errors. Advanced techniques involving beginner will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535901",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "tutorial",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "tutorial"
      ],
      "content_hash": "dc85a2244689f881",
      "size_bytes": 1518,
      "created_at": "2026-01-02T20:42:23.535902"
    },
    {
      "doc_id": "distractor_0111",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0111",
      "content": "When working with employment, it's important to understand employee. Many practitioners overlook termination, which can lead to issues. Best practices suggest that compensation should be prioritized. The relationship between employee and benefits is often misunderstood. When working with employment, it's important to understand employee. Many practitioners overlook compensation, which can lead to issues. Best practices suggest that termination should be prioritized. The relationship between employee and benefits is often misunderstood. This guide covers the fundamentals of employment for intermediate users. We'll explore how termination interacts with benefits. Pay special attention to compensation as it's frequently a source of errors. Advanced techniques involving employee will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535907",
        "similarity_level": "somewhat_similar",
        "base_category": "legal",
        "topic": "employment",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "employment"
      ],
      "content_hash": "cb0f0a79aa0bcdf0",
      "size_bytes": 822,
      "created_at": "2026-01-02T20:42:23.535908"
    },
    {
      "doc_id": "distractor_0112",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0112",
      "content": "This guide covers the fundamentals of contract for intermediate users. We'll explore how party interacts with agreement. Pay special attention to terms as it's frequently a source of errors. Advanced techniques involving obligation will be covered in the next section. This guide covers the fundamentals of contract for intermediate users. We'll explore how agreement interacts with obligation. Pay special attention to terms as it's frequently a source of errors. Advanced techniques involving party will be covered in the next section. When working with contract, it's important to understand terms. Many practitioners overlook party, which can lead to issues. Best practices suggest that liability should be prioritized. The relationship between terms and obligation is often misunderstood. When working with contract, it's important to understand liability. Many practitioners overlook agreement, which can lead to issues. Best practices suggest that obligation should be prioritized. The relationship between liability and party is often misunderstood. When working with contract, it's important to understand party. Many practitioners overlook obligation, which can lead to issues. Best practices suggest that terms should be prioritized. The relationship between party and liability is often misunderstood. When working with contract, it's important to understand obligation. Many practitioners overlook party, which can lead to issues. Best practices suggest that liability should be prioritized. The relationship between obligation and agreement is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535918",
        "similarity_level": "somewhat_similar",
        "base_category": "legal",
        "topic": "contract",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "contract"
      ],
      "content_hash": "93dbfca36eadbba3",
      "size_bytes": 1578,
      "created_at": "2026-01-02T20:42:23.535919"
    },
    {
      "doc_id": "distractor_0113",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0113",
      "content": "This guide covers the fundamentals of howto for intermediate users. We'll explore how configure interacts with setup. Pay special attention to install as it's frequently a source of errors. Advanced techniques involving enable will be covered in the next section. When working with howto, it's important to understand setup. Many practitioners overlook enable, which can lead to issues. Best practices suggest that disable should be prioritized. The relationship between setup and install is often misunderstood. This guide covers the fundamentals of howto for intermediate users. We'll explore how enable interacts with install. Pay special attention to disable as it's frequently a source of errors. Advanced techniques involving configure will be covered in the next section. This guide covers the fundamentals of howto for intermediate users. We'll explore how disable interacts with enable. Pay special attention to setup as it's frequently a source of errors. Advanced techniques involving install will be covered in the next section. When working with howto, it's important to understand disable. Many practitioners overlook configure, which can lead to issues. Best practices suggest that setup should be prioritized. The relationship between disable and enable is often misunderstood. This guide covers the fundamentals of howto for intermediate users. We'll explore how setup interacts with enable. Pay special attention to disable as it's frequently a source of errors. Advanced techniques involving install will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535929",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "howto",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "howto"
      ],
      "content_hash": "5471eceb3c211e82",
      "size_bytes": 1555,
      "created_at": "2026-01-02T20:42:23.535929"
    },
    {
      "doc_id": "distractor_0114",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0114",
      "content": "When working with security, it's important to understand encryption. Many practitioners overlook authentication, which can lead to issues. Best practices suggest that certificate should be prioritized. The relationship between encryption and firewall is often misunderstood. When working with security, it's important to understand vulnerability. Many practitioners overlook encryption, which can lead to issues. Best practices suggest that authentication should be prioritized. The relationship between vulnerability and certificate is often misunderstood. When working with security, it's important to understand vulnerability. Many practitioners overlook firewall, which can lead to issues. Best practices suggest that authentication should be prioritized. The relationship between vulnerability and certificate is often misunderstood. This guide covers the fundamentals of security for intermediate users. We'll explore how firewall interacts with certificate. Pay special attention to vulnerability as it's frequently a source of errors. Advanced techniques involving authentication will be covered in the next section. This guide covers the fundamentals of security for intermediate users. We'll explore how authentication interacts with certificate. Pay special attention to encryption as it's frequently a source of errors. Advanced techniques involving vulnerability will be covered in the next section. When working with security, it's important to understand firewall. Many practitioners overlook authentication, which can lead to issues. Best practices suggest that vulnerability should be prioritized. The relationship between firewall and encryption is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535938",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "security",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "security"
      ],
      "content_hash": "fe8c406dd3475f53",
      "size_bytes": 1687,
      "created_at": "2026-01-02T20:42:23.535939"
    },
    {
      "doc_id": "distractor_0115",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0115",
      "content": "This guide covers the fundamentals of tutorial for intermediate users. We'll explore how step interacts with guide. Pay special attention to how-to as it's frequently a source of errors. Advanced techniques involving learn will be covered in the next section. This guide covers the fundamentals of tutorial for intermediate users. We'll explore how learn interacts with beginner. Pay special attention to how-to as it's frequently a source of errors. Advanced techniques involving guide will be covered in the next section. This guide covers the fundamentals of tutorial for intermediate users. We'll explore how step interacts with how-to. Pay special attention to learn as it's frequently a source of errors. Advanced techniques involving beginner will be covered in the next section. This guide covers the fundamentals of tutorial for intermediate users. We'll explore how beginner interacts with how-to. Pay special attention to step as it's frequently a source of errors. Advanced techniques involving guide will be covered in the next section. This guide covers the fundamentals of tutorial for intermediate users. We'll explore how step interacts with beginner. Pay special attention to guide as it's frequently a source of errors. Advanced techniques involving learn will be covered in the next section. When working with tutorial, it's important to understand learn. Many practitioners overlook guide, which can lead to issues. Best practices suggest that step should be prioritized. The relationship between learn and beginner is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535947",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "tutorial",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "tutorial"
      ],
      "content_hash": "30fb719fc7c59065",
      "size_bytes": 1560,
      "created_at": "2026-01-02T20:42:23.535948"
    },
    {
      "doc_id": "distractor_0116",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0116",
      "content": "When working with privacy, it's important to understand data. Many practitioners overlook consent, which can lead to issues. Best practices suggest that disclosure should be prioritized. The relationship between data and protection is often misunderstood. This guide covers the fundamentals of privacy for intermediate users. We'll explore how GDPR interacts with disclosure. Pay special attention to consent as it's frequently a source of errors. Advanced techniques involving protection will be covered in the next section. This guide covers the fundamentals of privacy for intermediate users. We'll explore how GDPR interacts with data. Pay special attention to consent as it's frequently a source of errors. Advanced techniques involving disclosure will be covered in the next section. This guide covers the fundamentals of privacy for intermediate users. We'll explore how data interacts with GDPR. Pay special attention to protection as it's frequently a source of errors. Advanced techniques involving consent will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535954",
        "similarity_level": "somewhat_similar",
        "base_category": "legal",
        "topic": "privacy",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "privacy"
      ],
      "content_hash": "00393ec84be9c876",
      "size_bytes": 1053,
      "created_at": "2026-01-02T20:42:23.535955"
    },
    {
      "doc_id": "distractor_0117",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0117",
      "content": "This guide covers the fundamentals of privacy for intermediate users. We'll explore how data interacts with consent. Pay special attention to disclosure as it's frequently a source of errors. Advanced techniques involving protection will be covered in the next section. This guide covers the fundamentals of privacy for intermediate users. We'll explore how data interacts with disclosure. Pay special attention to protection as it's frequently a source of errors. Advanced techniques involving consent will be covered in the next section. This guide covers the fundamentals of privacy for intermediate users. We'll explore how consent interacts with GDPR. Pay special attention to data as it's frequently a source of errors. Advanced techniques involving disclosure will be covered in the next section. When working with privacy, it's important to understand protection. Many practitioners overlook consent, which can lead to issues. Best practices suggest that disclosure should be prioritized. The relationship between protection and data is often misunderstood. When working with privacy, it's important to understand consent. Many practitioners overlook data, which can lead to issues. Best practices suggest that GDPR should be prioritized. The relationship between consent and disclosure is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535962",
        "similarity_level": "somewhat_similar",
        "base_category": "legal",
        "topic": "privacy",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "privacy"
      ],
      "content_hash": "73b3fb64a39017c7",
      "size_bytes": 1318,
      "created_at": "2026-01-02T20:42:23.535963"
    },
    {
      "doc_id": "distractor_0118",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0118",
      "content": "When working with reference, it's important to understand documentation. Many practitioners overlook API, which can lead to issues. Best practices suggest that parameter should be prioritized. The relationship between documentation and method is often misunderstood. When working with reference, it's important to understand documentation. Many practitioners overlook method, which can lead to issues. Best practices suggest that example should be prioritized. The relationship between documentation and API is often misunderstood. This guide covers the fundamentals of reference for intermediate users. We'll explore how example interacts with API. Pay special attention to parameter as it's frequently a source of errors. Advanced techniques involving method will be covered in the next section. This guide covers the fundamentals of reference for intermediate users. We'll explore how API interacts with documentation. Pay special attention to parameter as it's frequently a source of errors. Advanced techniques involving method will be covered in the next section. This guide covers the fundamentals of reference for intermediate users. We'll explore how API interacts with parameter. Pay special attention to method as it's frequently a source of errors. Advanced techniques involving documentation will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535971",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "reference"
      ],
      "content_hash": "919a2998a5e9b05d",
      "size_bytes": 1341,
      "created_at": "2026-01-02T20:42:23.535971"
    },
    {
      "doc_id": "distractor_0119",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0119",
      "content": "When working with chat, it's important to understand hey. Many practitioners overlook cool, which can lead to issues. Best practices suggest that yeah should be prioritized. The relationship between hey and lol is often misunderstood. This guide covers the fundamentals of chat for intermediate users. We'll explore how cool interacts with yeah. Pay special attention to btw as it's frequently a source of errors. Advanced techniques involving hey will be covered in the next section. This guide covers the fundamentals of chat for intermediate users. We'll explore how hey interacts with yeah. Pay special attention to lol as it's frequently a source of errors. Advanced techniques involving btw will be covered in the next section. This guide covers the fundamentals of chat for intermediate users. We'll explore how yeah interacts with hey. Pay special attention to btw as it's frequently a source of errors. Advanced techniques involving cool will be covered in the next section. This guide covers the fundamentals of chat for intermediate users. We'll explore how lol interacts with btw. Pay special attention to cool as it's frequently a source of errors. Advanced techniques involving yeah will be covered in the next section. When working with chat, it's important to understand hey. Many practitioners overlook lol, which can lead to issues. Best practices suggest that btw should be prioritized. The relationship between hey and yeah is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535980",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "chat"
      ],
      "content_hash": "14d395ccd66fcc5e",
      "size_bytes": 1467,
      "created_at": "2026-01-02T20:42:23.535981"
    },
    {
      "doc_id": "distractor_0120",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0120",
      "content": "This guide covers the fundamentals of faq for intermediate users. We'll explore how question interacts with answer. Pay special attention to common as it's frequently a source of errors. Advanced techniques involving frequently will be covered in the next section. This guide covers the fundamentals of faq for intermediate users. We'll explore how asked interacts with answer. Pay special attention to common as it's frequently a source of errors. Advanced techniques involving frequently will be covered in the next section. This guide covers the fundamentals of faq for intermediate users. We'll explore how answer interacts with frequently. Pay special attention to asked as it's frequently a source of errors. Advanced techniques involving common will be covered in the next section. When working with faq, it's important to understand answer. Many practitioners overlook frequently, which can lead to issues. Best practices suggest that asked should be prioritized. The relationship between answer and question is often misunderstood. When working with faq, it's important to understand frequently. Many practitioners overlook question, which can lead to issues. Best practices suggest that common should be prioritized. The relationship between frequently and answer is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535989",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "faq",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "faq"
      ],
      "content_hash": "4e160d92de59eb22",
      "size_bytes": 1297,
      "created_at": "2026-01-02T20:42:23.535989"
    },
    {
      "doc_id": "distractor_0121",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0121",
      "content": "This guide covers the fundamentals of interview for intermediate users. We'll explore how experience interacts with skills. Pay special attention to team as it's frequently a source of errors. Advanced techniques involving project will be covered in the next section. When working with interview, it's important to understand team. Many practitioners overlook role, which can lead to issues. Best practices suggest that experience should be prioritized. The relationship between team and skills is often misunderstood. This guide covers the fundamentals of interview for intermediate users. We'll explore how role interacts with team. Pay special attention to project as it's frequently a source of errors. Advanced techniques involving skills will be covered in the next section. This guide covers the fundamentals of interview for intermediate users. We'll explore how team interacts with project. Pay special attention to role as it's frequently a source of errors. Advanced techniques involving skills will be covered in the next section. When working with interview, it's important to understand skills. Many practitioners overlook project, which can lead to issues. Best practices suggest that team should be prioritized. The relationship between skills and experience is often misunderstood. This guide covers the fundamentals of interview for intermediate users. We'll explore how role interacts with experience. Pay special attention to project as it's frequently a source of errors. Advanced techniques involving skills will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.535998",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "interview"
      ],
      "content_hash": "ee163ae07b6a392f",
      "size_bytes": 1566,
      "created_at": "2026-01-02T20:42:23.535999"
    },
    {
      "doc_id": "distractor_0122",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0122",
      "content": "This guide covers the fundamentals of forum for intermediate users. We'll explore how thread interacts with reply. Pay special attention to bump as it's frequently a source of errors. Advanced techniques involving solved will be covered in the next section. This guide covers the fundamentals of forum for intermediate users. We'll explore how solved interacts with bump. Pay special attention to reply as it's frequently a source of errors. Advanced techniques involving thread will be covered in the next section. This guide covers the fundamentals of forum for intermediate users. We'll explore how thread interacts with solved. Pay special attention to bump as it's frequently a source of errors. Advanced techniques involving reply will be covered in the next section. When working with forum, it's important to understand off-topic. Many practitioners overlook solved, which can lead to issues. Best practices suggest that thread should be prioritized. The relationship between off-topic and bump is often misunderstood. This guide covers the fundamentals of forum for intermediate users. We'll explore how bump interacts with off-topic. Pay special attention to solved as it's frequently a source of errors. Advanced techniques involving reply will be covered in the next section. This guide covers the fundamentals of forum for intermediate users. We'll explore how thread interacts with off-topic. Pay special attention to bump as it's frequently a source of errors. Advanced techniques involving reply will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536007",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "forum",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "forum"
      ],
      "content_hash": "6f0264a023b5d4bd",
      "size_bytes": 1548,
      "created_at": "2026-01-02T20:42:23.536008"
    },
    {
      "doc_id": "distractor_0123",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0123",
      "content": "This guide covers the fundamentals of faq for intermediate users. We'll explore how question interacts with answer. Pay special attention to common as it's frequently a source of errors. Advanced techniques involving frequently will be covered in the next section. When working with faq, it's important to understand answer. Many practitioners overlook asked, which can lead to issues. Best practices suggest that question should be prioritized. The relationship between answer and common is often misunderstood. This guide covers the fundamentals of faq for intermediate users. We'll explore how common interacts with asked. Pay special attention to answer as it's frequently a source of errors. Advanced techniques involving question will be covered in the next section. This guide covers the fundamentals of faq for intermediate users. We'll explore how question interacts with common. Pay special attention to frequently as it's frequently a source of errors. Advanced techniques involving asked will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536014",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "faq",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "faq"
      ],
      "content_hash": "1ed92762791c8554",
      "size_bytes": 1036,
      "created_at": "2026-01-02T20:42:23.536015"
    },
    {
      "doc_id": "distractor_0124",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0124",
      "content": "This guide covers the fundamentals of reference for intermediate users. We'll explore how documentation interacts with API. Pay special attention to parameter as it's frequently a source of errors. Advanced techniques involving method will be covered in the next section. This guide covers the fundamentals of reference for intermediate users. We'll explore how example interacts with method. Pay special attention to parameter as it's frequently a source of errors. Advanced techniques involving documentation will be covered in the next section. When working with reference, it's important to understand example. Many practitioners overlook method, which can lead to issues. Best practices suggest that API should be prioritized. The relationship between example and documentation is often misunderstood. This guide covers the fundamentals of reference for intermediate users. We'll explore how documentation interacts with example. Pay special attention to parameter as it's frequently a source of errors. Advanced techniques involving method will be covered in the next section. When working with reference, it's important to understand method. Many practitioners overlook parameter, which can lead to issues. Best practices suggest that API should be prioritized. The relationship between method and documentation is often misunderstood. When working with reference, it's important to understand parameter. Many practitioners overlook documentation, which can lead to issues. Best practices suggest that example should be prioritized. The relationship between parameter and API is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536025",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "reference"
      ],
      "content_hash": "229b2cede65f1f21",
      "size_bytes": 1606,
      "created_at": "2026-01-02T20:42:23.536025"
    },
    {
      "doc_id": "distractor_0125",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0125",
      "content": "When working with employment, it's important to understand employee. Many practitioners overlook termination, which can lead to issues. Best practices suggest that compensation should be prioritized. The relationship between employee and benefits is often misunderstood. This guide covers the fundamentals of employment for intermediate users. We'll explore how benefits interacts with termination. Pay special attention to employee as it's frequently a source of errors. Advanced techniques involving compensation will be covered in the next section. When working with employment, it's important to understand compensation. Many practitioners overlook benefits, which can lead to issues. Best practices suggest that employee should be prioritized. The relationship between compensation and termination is often misunderstood. This guide covers the fundamentals of employment for intermediate users. We'll explore how benefits interacts with employee. Pay special attention to compensation as it's frequently a source of errors. Advanced techniques involving termination will be covered in the next section. When working with employment, it's important to understand compensation. Many practitioners overlook benefits, which can lead to issues. Best practices suggest that employee should be prioritized. The relationship between compensation and termination is often misunderstood. This guide covers the fundamentals of employment for intermediate users. We'll explore how employee interacts with compensation. Pay special attention to benefits as it's frequently a source of errors. Advanced techniques involving termination will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536034",
        "similarity_level": "somewhat_similar",
        "base_category": "legal",
        "topic": "employment",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "employment"
      ],
      "content_hash": "5ee5c9cb696ed2c1",
      "size_bytes": 1663,
      "created_at": "2026-01-02T20:42:23.536035"
    },
    {
      "doc_id": "distractor_0126",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0126",
      "content": "This guide covers the fundamentals of interview for intermediate users. We'll explore how experience interacts with skills. Pay special attention to team as it's frequently a source of errors. Advanced techniques involving project will be covered in the next section. When working with interview, it's important to understand team. Many practitioners overlook role, which can lead to issues. Best practices suggest that skills should be prioritized. The relationship between team and experience is often misunderstood. When working with interview, it's important to understand experience. Many practitioners overlook project, which can lead to issues. Best practices suggest that team should be prioritized. The relationship between experience and role is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536040",
        "similarity_level": "somewhat_similar",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "interview"
      ],
      "content_hash": "a06230f8d6f5e166",
      "size_bytes": 776,
      "created_at": "2026-01-02T20:42:23.536042"
    },
    {
      "doc_id": "distractor_0127",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0127",
      "content": "This guide covers the fundamentals of privacy for intermediate users. We'll explore how data interacts with consent. Pay special attention to disclosure as it's frequently a source of errors. Advanced techniques involving protection will be covered in the next section. This guide covers the fundamentals of privacy for intermediate users. We'll explore how disclosure interacts with data. Pay special attention to consent as it's frequently a source of errors. Advanced techniques involving GDPR will be covered in the next section. When working with privacy, it's important to understand data. Many practitioners overlook consent, which can lead to issues. Best practices suggest that GDPR should be prioritized. The relationship between data and disclosure is often misunderstood. This guide covers the fundamentals of privacy for intermediate users. We'll explore how consent interacts with data. Pay special attention to GDPR as it's frequently a source of errors. Advanced techniques involving disclosure will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536048",
        "similarity_level": "somewhat_similar",
        "base_category": "legal",
        "topic": "privacy",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "privacy"
      ],
      "content_hash": "19c6a379523c7eaa",
      "size_bytes": 1047,
      "created_at": "2026-01-02T20:42:23.536049"
    },
    {
      "doc_id": "distractor_0128",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0128",
      "content": "This guide covers the fundamentals of cloud for intermediate users. We'll explore how container interacts with kubernetes. Pay special attention to deployment as it's frequently a source of errors. Advanced techniques involving scaling will be covered in the next section. This guide covers the fundamentals of cloud for intermediate users. We'll explore how deployment interacts with instance. Pay special attention to container as it's frequently a source of errors. Advanced techniques involving scaling will be covered in the next section. This guide covers the fundamentals of cloud for intermediate users. We'll explore how scaling interacts with container. Pay special attention to kubernetes as it's frequently a source of errors. Advanced techniques involving instance will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536054",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "cloud"
      ],
      "content_hash": "652bc38ab4cef4e0",
      "size_bytes": 814,
      "created_at": "2026-01-02T20:42:23.536054"
    },
    {
      "doc_id": "distractor_0129",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0129",
      "content": "When working with troubleshooting, it's important to understand error. Many practitioners overlook fix, which can lead to issues. Best practices suggest that solution should be prioritized. The relationship between error and problem is often misunderstood. When working with troubleshooting, it's important to understand fix. Many practitioners overlook solution, which can lead to issues. Best practices suggest that workaround should be prioritized. The relationship between fix and error is often misunderstood. This guide covers the fundamentals of troubleshooting for intermediate users. We'll explore how solution interacts with workaround. Pay special attention to fix as it's frequently a source of errors. Advanced techniques involving error will be covered in the next section.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536059",
        "similarity_level": "somewhat_similar",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "troubleshooting"
      ],
      "content_hash": "6c450912537f26d5",
      "size_bytes": 787,
      "created_at": "2026-01-02T20:42:23.536060"
    },
    {
      "doc_id": "distractor_0130",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0130",
      "content": "When working with employment, it's important to understand employee. Many practitioners overlook termination, which can lead to issues. Best practices suggest that compensation should be prioritized. The relationship between employee and benefits is often misunderstood. When working with employment, it's important to understand benefits. Many practitioners overlook employee, which can lead to issues. Best practices suggest that termination should be prioritized. The relationship between benefits and compensation is often misunderstood. This guide covers the fundamentals of employment for intermediate users. We'll explore how compensation interacts with benefits. Pay special attention to employee as it's frequently a source of errors. Advanced techniques involving termination will be covered in the next section. This guide covers the fundamentals of employment for intermediate users. We'll explore how compensation interacts with employee. Pay special attention to benefits as it's frequently a source of errors. Advanced techniques involving termination will be covered in the next section. When working with employment, it's important to understand compensation. Many practitioners overlook termination, which can lead to issues. Best practices suggest that benefits should be prioritized. The relationship between compensation and employee is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536067",
        "similarity_level": "somewhat_similar",
        "base_category": "legal",
        "topic": "employment",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "employment"
      ],
      "content_hash": "3289134ec868aa38",
      "size_bytes": 1378,
      "created_at": "2026-01-02T20:42:23.536068"
    },
    {
      "doc_id": "distractor_0131",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0131",
      "content": "When working with networking, it's important to understand TCP. Many practitioners overlook HTTP, which can lead to issues. Best practices suggest that socket should be prioritized. The relationship between TCP and packet is often misunderstood. When working with networking, it's important to understand protocol. Many practitioners overlook packet, which can lead to issues. Best practices suggest that HTTP should be prioritized. The relationship between protocol and latency is often misunderstood. This guide covers the fundamentals of networking for intermediate users. We'll explore how protocol interacts with socket. Pay special attention to latency as it's frequently a source of errors. Advanced techniques involving packet will be covered in the next section. When working with networking, it's important to understand packet. Many practitioners overlook HTTP, which can lead to issues. Best practices suggest that TCP should be prioritized. The relationship between packet and protocol is often misunderstood. When working with networking, it's important to understand protocol. Many practitioners overlook packet, which can lead to issues. Best practices suggest that socket should be prioritized. The relationship between protocol and TCP is often misunderstood. When working with networking, it's important to understand latency. Many practitioners overlook TCP, which can lead to issues. Best practices suggest that protocol should be prioritized. The relationship between latency and HTTP is often misunderstood.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536077",
        "similarity_level": "somewhat_similar",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "somewhat_similar",
        "networking"
      ],
      "content_hash": "307e7b7d3d448d1b",
      "size_bytes": 1530,
      "created_at": "2026-01-02T20:42:23.536078"
    },
    {
      "doc_id": "distractor_0132",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0132",
      "content": "Implementing setup requires careful consideration of configure. The install pattern ensures proper handling of edge cases. When enable is enabled, performance may be affected. We recommend testing setup thoroughly before deployment. The install system provides comprehensive support for enable. Users can configure disable through the standard interface. This enables setup without requiring manual intervention. The install approach is widely adopted in production environments. Implementing disable requires careful consideration of setup. The configure pattern ensures proper handling of edge cases. When install is enabled, performance may be affected. We recommend testing disable thoroughly before deployment. Implementing enable requires careful consideration of disable. The install pattern ensures proper handling of edge cases. When setup is enabled, performance may be affected. We recommend testing enable thoroughly before deployment.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536086",
        "similarity_level": "very_similar",
        "base_category": "knowledge_base",
        "topic": "howto",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "howto"
      ],
      "content_hash": "074225a5286950d4",
      "size_bytes": 947,
      "created_at": "2026-01-02T20:42:23.536087"
    },
    {
      "doc_id": "distractor_0133",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0133",
      "content": "The encryption system provides comprehensive support for authentication. Users can configure certificate through the standard interface. This enables firewall without requiring manual intervention. The encryption approach is widely adopted in production environments. Implementing authentication requires careful consideration of vulnerability. The firewall pattern ensures proper handling of edge cases. When encryption is enabled, performance may be affected. We recommend testing authentication thoroughly before deployment. Implementing vulnerability requires careful consideration of certificate. The firewall pattern ensures proper handling of edge cases. When authentication is enabled, performance may be affected. We recommend testing vulnerability thoroughly before deployment. The firewall system provides comprehensive support for authentication. Users can configure encryption through the standard interface. This enables vulnerability without requiring manual intervention. The firewall approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536094",
        "similarity_level": "very_similar",
        "base_category": "technical",
        "topic": "security",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "security"
      ],
      "content_hash": "cd83b1b4d8f351f4",
      "size_bytes": 1055,
      "created_at": "2026-01-02T20:42:23.536095"
    },
    {
      "doc_id": "distractor_0134",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0134",
      "content": "The error system provides comprehensive support for fix. Users can configure solution through the standard interface. This enables problem without requiring manual intervention. The error approach is widely adopted in production environments. The solution system provides comprehensive support for fix. Users can configure problem through the standard interface. This enables workaround without requiring manual intervention. The solution approach is widely adopted in production environments. The problem system provides comprehensive support for solution. Users can configure fix through the standard interface. This enables workaround without requiring manual intervention. The problem approach is widely adopted in production environments. Implementing solution requires careful consideration of fix. The error pattern ensures proper handling of edge cases. When workaround is enabled, performance may be affected. We recommend testing solution thoroughly before deployment. Implementing problem requires careful consideration of fix. The workaround pattern ensures proper handling of edge cases. When solution is enabled, performance may be affected. We recommend testing problem thoroughly before deployment. The problem system provides comprehensive support for error. Users can configure fix through the standard interface. This enables solution without requiring manual intervention. The problem approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536104",
        "similarity_level": "very_similar",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "troubleshooting"
      ],
      "content_hash": "92093d4b693a3137",
      "size_bytes": 1459,
      "created_at": "2026-01-02T20:42:23.536105"
    },
    {
      "doc_id": "distractor_0135",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0135",
      "content": "The thread system provides comprehensive support for reply. Users can configure bump through the standard interface. This enables solved without requiring manual intervention. The thread approach is widely adopted in production environments. The bump system provides comprehensive support for reply. Users can configure off-topic through the standard interface. This enables solved without requiring manual intervention. The bump approach is widely adopted in production environments. The solved system provides comprehensive support for off-topic. Users can configure thread through the standard interface. This enables reply without requiring manual intervention. The solved approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536110",
        "similarity_level": "very_similar",
        "base_category": "conversational",
        "topic": "forum",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "forum"
      ],
      "content_hash": "ebd1c1a885fd8f5d",
      "size_bytes": 731,
      "created_at": "2026-01-02T20:42:23.536111"
    },
    {
      "doc_id": "distractor_0136",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0136",
      "content": "The party system provides comprehensive support for agreement. Users can configure terms through the standard interface. This enables obligation without requiring manual intervention. The party approach is widely adopted in production environments. Implementing agreement requires careful consideration of obligation. The party pattern ensures proper handling of edge cases. When terms is enabled, performance may be affected. We recommend testing agreement thoroughly before deployment. The liability system provides comprehensive support for agreement. Users can configure obligation through the standard interface. This enables party without requiring manual intervention. The liability approach is widely adopted in production environments. Implementing obligation requires careful consideration of liability. The agreement pattern ensures proper handling of edge cases. When party is enabled, performance may be affected. We recommend testing obligation thoroughly before deployment. Implementing agreement requires careful consideration of liability. The party pattern ensures proper handling of edge cases. When terms is enabled, performance may be affected. We recommend testing agreement thoroughly before deployment. The liability system provides comprehensive support for party. Users can configure obligation through the standard interface. This enables agreement without requiring manual intervention. The liability approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536120",
        "similarity_level": "very_similar",
        "base_category": "legal",
        "topic": "contract",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "contract"
      ],
      "content_hash": "a3fdb331bab4be14",
      "size_bytes": 1483,
      "created_at": "2026-01-02T20:42:23.536121"
    },
    {
      "doc_id": "distractor_0137",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0137",
      "content": "The TCP system provides comprehensive support for HTTP. Users can configure socket through the standard interface. This enables packet without requiring manual intervention. The TCP approach is widely adopted in production environments. The protocol system provides comprehensive support for socket. Users can configure latency through the standard interface. This enables packet without requiring manual intervention. The protocol approach is widely adopted in production environments. The socket system provides comprehensive support for latency. Users can configure protocol through the standard interface. This enables packet without requiring manual intervention. The socket approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536126",
        "similarity_level": "very_similar",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "networking"
      ],
      "content_hash": "5e6570872e696d1b",
      "size_bytes": 734,
      "created_at": "2026-01-02T20:42:23.536127"
    },
    {
      "doc_id": "distractor_0138",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0138",
      "content": "Implementing consent requires careful consideration of data. The disclosure pattern ensures proper handling of edge cases. When protection is enabled, performance may be affected. We recommend testing consent thoroughly before deployment. The consent system provides comprehensive support for protection. Users can configure data through the standard interface. This enables disclosure without requiring manual intervention. The consent approach is widely adopted in production environments. The disclosure system provides comprehensive support for protection. Users can configure GDPR through the standard interface. This enables data without requiring manual intervention. The disclosure approach is widely adopted in production environments. Implementing data requires careful consideration of protection. The consent pattern ensures proper handling of edge cases. When GDPR is enabled, performance may be affected. We recommend testing data thoroughly before deployment. Implementing consent requires careful consideration of protection. The GDPR pattern ensures proper handling of edge cases. When disclosure is enabled, performance may be affected. We recommend testing consent thoroughly before deployment.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536134",
        "similarity_level": "very_similar",
        "base_category": "legal",
        "topic": "privacy",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "privacy"
      ],
      "content_hash": "d955a6b8791864cd",
      "size_bytes": 1213,
      "created_at": "2026-01-02T20:42:23.536135"
    },
    {
      "doc_id": "distractor_0139",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0139",
      "content": "The experience system provides comprehensive support for skills. Users can configure team through the standard interface. This enables project without requiring manual intervention. The experience approach is widely adopted in production environments. Implementing team requires careful consideration of skills. The experience pattern ensures proper handling of edge cases. When project is enabled, performance may be affected. We recommend testing team thoroughly before deployment. The skills system provides comprehensive support for team. Users can configure role through the standard interface. This enables project without requiring manual intervention. The skills approach is widely adopted in production environments. Implementing skills requires careful consideration of project. The role pattern ensures proper handling of edge cases. When team is enabled, performance may be affected. We recommend testing skills thoroughly before deployment. Implementing role requires careful consideration of project. The team pattern ensures proper handling of edge cases. When skills is enabled, performance may be affected. We recommend testing role thoroughly before deployment. Implementing skills requires careful consideration of team. The role pattern ensures proper handling of edge cases. When experience is enabled, performance may be affected. We recommend testing skills thoroughly before deployment.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536143",
        "similarity_level": "very_similar",
        "base_category": "conversational",
        "topic": "interview",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "interview"
      ],
      "content_hash": "358be9ea571e0ea4",
      "size_bytes": 1410,
      "created_at": "2026-01-02T20:42:23.536144"
    },
    {
      "doc_id": "distractor_0140",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0140",
      "content": "The SELECT system provides comprehensive support for JOIN. Users can configure index through the standard interface. This enables query without requiring manual intervention. The SELECT approach is widely adopted in production environments. Implementing schema requires careful consideration of JOIN. The index pattern ensures proper handling of edge cases. When table is enabled, performance may be affected. We recommend testing schema thoroughly before deployment. Implementing query requires careful consideration of index. The JOIN pattern ensures proper handling of edge cases. When schema is enabled, performance may be affected. We recommend testing query thoroughly before deployment. The SELECT system provides comprehensive support for query. Users can configure JOIN through the standard interface. This enables table without requiring manual intervention. The SELECT approach is widely adopted in production environments. Implementing table requires careful consideration of schema. The SELECT pattern ensures proper handling of edge cases. When JOIN is enabled, performance may be affected. We recommend testing table thoroughly before deployment. The query system provides comprehensive support for index. Users can configure schema through the standard interface. This enables JOIN without requiring manual intervention. The query approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536153",
        "similarity_level": "very_similar",
        "base_category": "technical",
        "topic": "database",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "database"
      ],
      "content_hash": "4f81ab3fdf2d9e57",
      "size_bytes": 1401,
      "created_at": "2026-01-02T20:42:23.536154"
    },
    {
      "doc_id": "distractor_0141",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0141",
      "content": "Implementing API requires careful consideration of documentation. The parameter pattern ensures proper handling of edge cases. When method is enabled, performance may be affected. We recommend testing API thoroughly before deployment. The method system provides comprehensive support for API. Users can configure documentation through the standard interface. This enables parameter without requiring manual intervention. The method approach is widely adopted in production environments. Implementing example requires careful consideration of API. The documentation pattern ensures proper handling of edge cases. When parameter is enabled, performance may be affected. We recommend testing example thoroughly before deployment. The example system provides comprehensive support for API. Users can configure method through the standard interface. This enables documentation without requiring manual intervention. The example approach is widely adopted in production environments. The example system provides comprehensive support for parameter. Users can configure method through the standard interface. This enables API without requiring manual intervention. The example approach is widely adopted in production environments. The API system provides comprehensive support for method. Users can configure documentation through the standard interface. This enables example without requiring manual intervention. The API approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536163",
        "similarity_level": "very_similar",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "reference"
      ],
      "content_hash": "5be7e19268eee53d",
      "size_bytes": 1471,
      "created_at": "2026-01-02T20:42:23.536164"
    },
    {
      "doc_id": "distractor_0142",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0142",
      "content": "The documentation system provides comprehensive support for API. Users can configure parameter through the standard interface. This enables method without requiring manual intervention. The documentation approach is widely adopted in production environments. Implementing parameter requires careful consideration of method. The example pattern ensures proper handling of edge cases. When API is enabled, performance may be affected. We recommend testing parameter thoroughly before deployment. The parameter system provides comprehensive support for method. Users can configure documentation through the standard interface. This enables example without requiring manual intervention. The parameter approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536170",
        "similarity_level": "very_similar",
        "base_category": "knowledge_base",
        "topic": "reference",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "reference"
      ],
      "content_hash": "edee821e026df587",
      "size_bytes": 752,
      "created_at": "2026-01-02T20:42:23.536171"
    },
    {
      "doc_id": "distractor_0143",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0143",
      "content": "Implementing issue requires careful consideration of help. The ticket pattern ensures proper handling of edge cases. When resolved is enabled, performance may be affected. We recommend testing issue thoroughly before deployment. The thanks system provides comprehensive support for resolved. Users can configure ticket through the standard interface. This enables issue without requiring manual intervention. The thanks approach is widely adopted in production environments. The issue system provides comprehensive support for resolved. Users can configure thanks through the standard interface. This enables ticket without requiring manual intervention. The issue approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536176",
        "similarity_level": "very_similar",
        "base_category": "conversational",
        "topic": "support",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "support"
      ],
      "content_hash": "5f7a984731dfe4b3",
      "size_bytes": 719,
      "created_at": "2026-01-02T20:42:23.536177"
    },
    {
      "doc_id": "distractor_0144",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0144",
      "content": "The step system provides comprehensive support for guide. Users can configure how-to through the standard interface. This enables learn without requiring manual intervention. The step approach is widely adopted in production environments. Implementing how-to requires careful consideration of beginner. The guide pattern ensures proper handling of edge cases. When step is enabled, performance may be affected. We recommend testing how-to thoroughly before deployment. The beginner system provides comprehensive support for learn. Users can configure step through the standard interface. This enables guide without requiring manual intervention. The beginner approach is widely adopted in production environments. Implementing how-to requires careful consideration of beginner. The step pattern ensures proper handling of edge cases. When guide is enabled, performance may be affected. We recommend testing how-to thoroughly before deployment. Implementing guide requires careful consideration of step. The how-to pattern ensures proper handling of edge cases. When beginner is enabled, performance may be affected. We recommend testing guide thoroughly before deployment. The learn system provides comprehensive support for beginner. Users can configure guide through the standard interface. This enables how-to without requiring manual intervention. The learn approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536185",
        "similarity_level": "very_similar",
        "base_category": "knowledge_base",
        "topic": "tutorial",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "tutorial"
      ],
      "content_hash": "a15e5cbcbb06a017",
      "size_bytes": 1416,
      "created_at": "2026-01-02T20:42:23.536186"
    },
    {
      "doc_id": "distractor_0145",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0145",
      "content": "The question system provides comprehensive support for answer. Users can configure common through the standard interface. This enables frequently without requiring manual intervention. The question approach is widely adopted in production environments. Implementing answer requires careful consideration of question. The asked pattern ensures proper handling of edge cases. When frequently is enabled, performance may be affected. We recommend testing answer thoroughly before deployment. Implementing frequently requires careful consideration of question. The answer pattern ensures proper handling of edge cases. When common is enabled, performance may be affected. We recommend testing frequently thoroughly before deployment.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536191",
        "similarity_level": "very_similar",
        "base_category": "knowledge_base",
        "topic": "faq",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "faq"
      ],
      "content_hash": "3a6f94453b239af7",
      "size_bytes": 729,
      "created_at": "2026-01-02T20:42:23.536192"
    },
    {
      "doc_id": "distractor_0146",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0146",
      "content": "Implementing agreement requires careful consideration of party. The terms pattern ensures proper handling of edge cases. When obligation is enabled, performance may be affected. We recommend testing agreement thoroughly before deployment. The obligation system provides comprehensive support for liability. Users can configure agreement through the standard interface. This enables party without requiring manual intervention. The obligation approach is widely adopted in production environments. The liability system provides comprehensive support for terms. Users can configure obligation through the standard interface. This enables party without requiring manual intervention. The liability approach is widely adopted in production environments. Implementing agreement requires careful consideration of terms. The obligation pattern ensures proper handling of edge cases. When party is enabled, performance may be affected. We recommend testing agreement thoroughly before deployment.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536199",
        "similarity_level": "very_similar",
        "base_category": "legal",
        "topic": "contract",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "contract"
      ],
      "content_hash": "36c6aa9d4c3f5917",
      "size_bytes": 988,
      "created_at": "2026-01-02T20:42:23.536200"
    },
    {
      "doc_id": "distractor_0147",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0147",
      "content": "The hey system provides comprehensive support for cool. Users can configure yeah through the standard interface. This enables lol without requiring manual intervention. The hey approach is widely adopted in production environments. Implementing cool requires careful consideration of lol. The btw pattern ensures proper handling of edge cases. When hey is enabled, performance may be affected. We recommend testing cool thoroughly before deployment. The hey system provides comprehensive support for yeah. Users can configure lol through the standard interface. This enables cool without requiring manual intervention. The hey approach is widely adopted in production environments. The cool system provides comprehensive support for yeah. Users can configure btw through the standard interface. This enables hey without requiring manual intervention. The cool approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536206",
        "similarity_level": "very_similar",
        "base_category": "conversational",
        "topic": "chat",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "chat"
      ],
      "content_hash": "f830a809c24c2a59",
      "size_bytes": 914,
      "created_at": "2026-01-02T20:42:23.536207"
    },
    {
      "doc_id": "distractor_0148",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0148",
      "content": "The plaintiff system provides comprehensive support for defendant. Users can configure court through the standard interface. This enables damages without requiring manual intervention. The plaintiff approach is widely adopted in production environments. Implementing judgment requires careful consideration of defendant. The damages pattern ensures proper handling of edge cases. When court is enabled, performance may be affected. We recommend testing judgment thoroughly before deployment. The judgment system provides comprehensive support for plaintiff. Users can configure damages through the standard interface. This enables defendant without requiring manual intervention. The judgment approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536212",
        "similarity_level": "very_similar",
        "base_category": "legal",
        "topic": "litigation",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "litigation"
      ],
      "content_hash": "7515339116afa828",
      "size_bytes": 747,
      "created_at": "2026-01-02T20:42:23.536214"
    },
    {
      "doc_id": "distractor_0149",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0149",
      "content": "The TCP system provides comprehensive support for HTTP. Users can configure socket through the standard interface. This enables packet without requiring manual intervention. The TCP approach is widely adopted in production environments. Implementing latency requires careful consideration of HTTP. The protocol pattern ensures proper handling of edge cases. When packet is enabled, performance may be affected. We recommend testing latency thoroughly before deployment. Implementing packet requires careful consideration of protocol. The TCP pattern ensures proper handling of edge cases. When HTTP is enabled, performance may be affected. We recommend testing packet thoroughly before deployment.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536219",
        "similarity_level": "very_similar",
        "base_category": "technical",
        "topic": "networking",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "networking"
      ],
      "content_hash": "c93498481b6a6bc4",
      "size_bytes": 697,
      "created_at": "2026-01-02T20:42:23.536220"
    },
    {
      "doc_id": "distractor_0150",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0150",
      "content": "The error system provides comprehensive support for fix. Users can configure solution through the standard interface. This enables problem without requiring manual intervention. The error approach is widely adopted in production environments. The error system provides comprehensive support for solution. Users can configure problem through the standard interface. This enables fix without requiring manual intervention. The error approach is widely adopted in production environments. Implementing error requires careful consideration of problem. The solution pattern ensures proper handling of edge cases. When workaround is enabled, performance may be affected. We recommend testing error thoroughly before deployment. Implementing fix requires careful consideration of solution. The problem pattern ensures proper handling of edge cases. When error is enabled, performance may be affected. We recommend testing fix thoroughly before deployment. The solution system provides comprehensive support for problem. Users can configure fix through the standard interface. This enables error without requiring manual intervention. The solution approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536227",
        "similarity_level": "very_similar",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "troubleshooting"
      ],
      "content_hash": "729294cf1580d4bc",
      "size_bytes": 1194,
      "created_at": "2026-01-02T20:42:23.536228"
    },
    {
      "doc_id": "distractor_0151",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0151",
      "content": "The help system provides comprehensive support for issue. Users can configure ticket through the standard interface. This enables resolved without requiring manual intervention. The help approach is widely adopted in production environments. Implementing thanks requires careful consideration of resolved. The ticket pattern ensures proper handling of edge cases. When help is enabled, performance may be affected. We recommend testing thanks thoroughly before deployment. Implementing resolved requires careful consideration of issue. The thanks pattern ensures proper handling of edge cases. When ticket is enabled, performance may be affected. We recommend testing resolved thoroughly before deployment. The issue system provides comprehensive support for resolved. Users can configure help through the standard interface. This enables thanks without requiring manual intervention. The issue approach is widely adopted in production environments. The help system provides comprehensive support for issue. Users can configure ticket through the standard interface. This enables thanks without requiring manual intervention. The help approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536235",
        "similarity_level": "very_similar",
        "base_category": "conversational",
        "topic": "support",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "support"
      ],
      "content_hash": "f4cf98da2495a997",
      "size_bytes": 1189,
      "created_at": "2026-01-02T20:42:23.536236"
    },
    {
      "doc_id": "distractor_0152",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0152",
      "content": "Implementing consent requires careful consideration of data. The disclosure pattern ensures proper handling of edge cases. When protection is enabled, performance may be affected. We recommend testing consent thoroughly before deployment. Implementing consent requires careful consideration of disclosure. The data pattern ensures proper handling of edge cases. When protection is enabled, performance may be affected. We recommend testing consent thoroughly before deployment. The GDPR system provides comprehensive support for disclosure. Users can configure data through the standard interface. This enables protection without requiring manual intervention. The GDPR approach is widely adopted in production environments. Implementing GDPR requires careful consideration of protection. The consent pattern ensures proper handling of edge cases. When disclosure is enabled, performance may be affected. We recommend testing GDPR thoroughly before deployment. The GDPR system provides comprehensive support for data. Users can configure protection through the standard interface. This enables consent without requiring manual intervention. The GDPR approach is widely adopted in production environments. The protection system provides comprehensive support for disclosure. Users can configure consent through the standard interface. This enables data without requiring manual intervention. The protection approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536245",
        "similarity_level": "very_similar",
        "base_category": "legal",
        "topic": "privacy",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "privacy"
      ],
      "content_hash": "db3d5856dce67875",
      "size_bytes": 1460,
      "created_at": "2026-01-02T20:42:23.536245"
    },
    {
      "doc_id": "distractor_0153",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0153",
      "content": "The container system provides comprehensive support for kubernetes. Users can configure deployment through the standard interface. This enables scaling without requiring manual intervention. The container approach is widely adopted in production environments. The deployment system provides comprehensive support for scaling. Users can configure kubernetes through the standard interface. This enables instance without requiring manual intervention. The deployment approach is widely adopted in production environments. The container system provides comprehensive support for kubernetes. Users can configure instance through the standard interface. This enables deployment without requiring manual intervention. The container approach is widely adopted in production environments. Implementing instance requires careful consideration of deployment. The scaling pattern ensures proper handling of edge cases. When container is enabled, performance may be affected. We recommend testing instance thoroughly before deployment. Implementing scaling requires careful consideration of deployment. The instance pattern ensures proper handling of edge cases. When container is enabled, performance may be affected. We recommend testing scaling thoroughly before deployment. Implementing kubernetes requires careful consideration of instance. The scaling pattern ensures proper handling of edge cases. When deployment is enabled, performance may be affected. We recommend testing kubernetes thoroughly before deployment.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536254",
        "similarity_level": "very_similar",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "cloud"
      ],
      "content_hash": "27f88b7ec5344f8c",
      "size_bytes": 1511,
      "created_at": "2026-01-02T20:42:23.536255"
    },
    {
      "doc_id": "distractor_0154",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0154",
      "content": "The party system provides comprehensive support for agreement. Users can configure terms through the standard interface. This enables obligation without requiring manual intervention. The party approach is widely adopted in production environments. The liability system provides comprehensive support for obligation. Users can configure agreement through the standard interface. This enables party without requiring manual intervention. The liability approach is widely adopted in production environments. Implementing terms requires careful consideration of party. The agreement pattern ensures proper handling of edge cases. When liability is enabled, performance may be affected. We recommend testing terms thoroughly before deployment. The terms system provides comprehensive support for agreement. Users can configure party through the standard interface. This enables obligation without requiring manual intervention. The terms approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536261",
        "similarity_level": "very_similar",
        "base_category": "legal",
        "topic": "contract",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "contract"
      ],
      "content_hash": "d5ec2884f716003c",
      "size_bytes": 988,
      "created_at": "2026-01-02T20:42:23.536262"
    },
    {
      "doc_id": "distractor_0155",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_knowledge_base",
      "file_path": "synthetic://distractor/distractor_0155",
      "content": "The error system provides comprehensive support for fix. Users can configure solution through the standard interface. This enables problem without requiring manual intervention. The error approach is widely adopted in production environments. The error system provides comprehensive support for workaround. Users can configure fix through the standard interface. This enables problem without requiring manual intervention. The error approach is widely adopted in production environments. The fix system provides comprehensive support for workaround. Users can configure problem through the standard interface. This enables error without requiring manual intervention. The fix approach is widely adopted in production environments. The fix system provides comprehensive support for error. Users can configure workaround through the standard interface. This enables problem without requiring manual intervention. The fix approach is widely adopted in production environments. The error system provides comprehensive support for fix. Users can configure solution through the standard interface. This enables workaround without requiring manual intervention. The error approach is widely adopted in production environments. The workaround system provides comprehensive support for fix. Users can configure error through the standard interface. This enables solution without requiring manual intervention. The workaround approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536270",
        "similarity_level": "very_similar",
        "base_category": "knowledge_base",
        "topic": "troubleshooting",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "troubleshooting"
      ],
      "content_hash": "24c1bf7f12e8ce30",
      "size_bytes": 1470,
      "created_at": "2026-01-02T20:42:23.536271"
    },
    {
      "doc_id": "distractor_0156",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0156",
      "content": "The parser system provides comprehensive support for lexer. Users can configure AST through the standard interface. This enables optimization without requiring manual intervention. The parser approach is widely adopted in production environments. Implementing AST requires careful consideration of optimization. The parser pattern ensures proper handling of edge cases. When bytecode is enabled, performance may be affected. We recommend testing AST thoroughly before deployment. The AST system provides comprehensive support for lexer. Users can configure bytecode through the standard interface. This enables optimization without requiring manual intervention. The AST approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536276",
        "similarity_level": "very_similar",
        "base_category": "technical",
        "topic": "compiler",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "compiler"
      ],
      "content_hash": "f805e87ce978845c",
      "size_bytes": 725,
      "created_at": "2026-01-02T20:42:23.536277"
    },
    {
      "doc_id": "distractor_0157",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_legal",
      "file_path": "synthetic://distractor/distractor_0157",
      "content": "Implementing license requires careful consideration of intellectual property. The infringement pattern ensures proper handling of edge cases. When rights is enabled, performance may be affected. We recommend testing license thoroughly before deployment. The rights system provides comprehensive support for infringement. Users can configure license through the standard interface. This enables intellectual property without requiring manual intervention. The rights approach is widely adopted in production environments. Implementing license requires careful consideration of intellectual property. The rights pattern ensures proper handling of edge cases. When infringement is enabled, performance may be affected. We recommend testing license thoroughly before deployment. The infringement system provides comprehensive support for license. Users can configure intellectual property through the standard interface. This enables rights without requiring manual intervention. The infringement approach is widely adopted in production environments. The rights system provides comprehensive support for intellectual property. Users can configure infringement through the standard interface. This enables license without requiring manual intervention. The rights approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536284",
        "similarity_level": "very_similar",
        "base_category": "legal",
        "topic": "copyright",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "copyright"
      ],
      "content_hash": "44e7e13ec6bbbe60",
      "size_bytes": 1314,
      "created_at": "2026-01-02T20:42:23.536285"
    },
    {
      "doc_id": "distractor_0158",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0158",
      "content": "The parser system provides comprehensive support for lexer. Users can configure AST through the standard interface. This enables optimization without requiring manual intervention. The parser approach is widely adopted in production environments. Implementing bytecode requires careful consideration of parser. The lexer pattern ensures proper handling of edge cases. When AST is enabled, performance may be affected. We recommend testing bytecode thoroughly before deployment. Implementing AST requires careful consideration of bytecode. The optimization pattern ensures proper handling of edge cases. When lexer is enabled, performance may be affected. We recommend testing AST thoroughly before deployment. The AST system provides comprehensive support for lexer. Users can configure parser through the standard interface. This enables optimization without requiring manual intervention. The AST approach is widely adopted in production environments. Implementing bytecode requires careful consideration of optimization. The AST pattern ensures proper handling of edge cases. When parser is enabled, performance may be affected. We recommend testing bytecode thoroughly before deployment.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536292",
        "similarity_level": "very_similar",
        "base_category": "technical",
        "topic": "compiler",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "compiler"
      ],
      "content_hash": "fe988404de8e1ceb",
      "size_bytes": 1191,
      "created_at": "2026-01-02T20:42:23.536293"
    },
    {
      "doc_id": "distractor_0159",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0159",
      "content": "The regards system provides comprehensive support for attached. Users can configure meeting through the standard interface. This enables follow-up without requiring manual intervention. The regards approach is widely adopted in production environments. Implementing regards requires careful consideration of follow-up. The attached pattern ensures proper handling of edge cases. When FYI is enabled, performance may be affected. We recommend testing regards thoroughly before deployment. The regards system provides comprehensive support for FYI. Users can configure follow-up through the standard interface. This enables meeting without requiring manual intervention. The regards approach is widely adopted in production environments. Implementing regards requires careful consideration of attached. The FYI pattern ensures proper handling of edge cases. When follow-up is enabled, performance may be affected. We recommend testing regards thoroughly before deployment. The regards system provides comprehensive support for meeting. Users can configure FYI through the standard interface. This enables attached without requiring manual intervention. The regards approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536300",
        "similarity_level": "very_similar",
        "base_category": "conversational",
        "topic": "email",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "email"
      ],
      "content_hash": "b2e82b0794153bff",
      "size_bytes": 1217,
      "created_at": "2026-01-02T20:42:23.536301"
    },
    {
      "doc_id": "distractor_0160",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0160",
      "content": "The help system provides comprehensive support for issue. Users can configure ticket through the standard interface. This enables resolved without requiring manual intervention. The help approach is widely adopted in production environments. Implementing ticket requires careful consideration of issue. The help pattern ensures proper handling of edge cases. When resolved is enabled, performance may be affected. We recommend testing ticket thoroughly before deployment. The resolved system provides comprehensive support for ticket. Users can configure help through the standard interface. This enables thanks without requiring manual intervention. The resolved approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536306",
        "similarity_level": "very_similar",
        "base_category": "conversational",
        "topic": "support",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "support"
      ],
      "content_hash": "0b40d8c9b7e9cc4d",
      "size_bytes": 718,
      "created_at": "2026-01-02T20:42:23.536307"
    },
    {
      "doc_id": "distractor_0161",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0161",
      "content": "The container system provides comprehensive support for kubernetes. Users can configure deployment through the standard interface. This enables scaling without requiring manual intervention. The container approach is widely adopted in production environments. The container system provides comprehensive support for scaling. Users can configure kubernetes through the standard interface. This enables instance without requiring manual intervention. The container approach is widely adopted in production environments. The instance system provides comprehensive support for deployment. Users can configure scaling through the standard interface. This enables kubernetes without requiring manual intervention. The instance approach is widely adopted in production environments. Implementing instance requires careful consideration of container. The deployment pattern ensures proper handling of edge cases. When scaling is enabled, performance may be affected. We recommend testing instance thoroughly before deployment. Implementing container requires careful consideration of instance. The scaling pattern ensures proper handling of edge cases. When deployment is enabled, performance may be affected. We recommend testing container thoroughly before deployment.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536316",
        "similarity_level": "very_similar",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "cloud"
      ],
      "content_hash": "fe6fdc715602ced2",
      "size_bytes": 1262,
      "created_at": "2026-01-02T20:42:23.536317"
    },
    {
      "doc_id": "distractor_0162",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_conversational",
      "file_path": "synthetic://distractor/distractor_0162",
      "content": "Implementing issue requires careful consideration of help. The ticket pattern ensures proper handling of edge cases. When resolved is enabled, performance may be affected. We recommend testing issue thoroughly before deployment. The resolved system provides comprehensive support for ticket. Users can configure help through the standard interface. This enables issue without requiring manual intervention. The resolved approach is widely adopted in production environments. The issue system provides comprehensive support for help. Users can configure thanks through the standard interface. This enables resolved without requiring manual intervention. The issue approach is widely adopted in production environments.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536322",
        "similarity_level": "very_similar",
        "base_category": "conversational",
        "topic": "support",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "support"
      ],
      "content_hash": "f8c8197b60ab322a",
      "size_bytes": 717,
      "created_at": "2026-01-02T20:42:23.536323"
    },
    {
      "doc_id": "distractor_0163",
      "source": "synthetic",
      "category": "synthetic",
      "domain": "synthetic_technical",
      "file_path": "synthetic://distractor/distractor_0163",
      "content": "The container system provides comprehensive support for kubernetes. Users can configure deployment through the standard interface. This enables scaling without requiring manual intervention. The container approach is widely adopted in production environments. The container system provides comprehensive support for instance. Users can configure scaling through the standard interface. This enables deployment without requiring manual intervention. The container approach is widely adopted in production environments. Implementing deployment requires careful consideration of container. The kubernetes pattern ensures proper handling of edge cases. When instance is enabled, performance may be affected. We recommend testing deployment thoroughly before deployment. Implementing deployment requires careful consideration of container. The instance pattern ensures proper handling of edge cases. When scaling is enabled, performance may be affected. We recommend testing deployment thoroughly before deployment.",
      "chunk_ids": [],
      "metadata": {
        "generated_at": "2026-01-02T20:42:23.536329",
        "similarity_level": "very_similar",
        "base_category": "technical",
        "topic": "cloud",
        "generator": "template"
      },
      "is_distractor": true,
      "semantic_tags": [
        "distractor",
        "very_similar",
        "cloud"
      ],
      "content_hash": "93e49668f1babdc8",
      "size_bytes": 1010,
      "created_at": "2026-01-02T20:42:23.536330"
    }
  ]
}